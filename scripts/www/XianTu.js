/*! For license information please see XianTu.js.LICENSE.txt */
(()=>{var e={22:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.account-container[data-v-5ebbff06] {\n  width: 100%;\n  height: 100vh;\n  min-height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 1.5rem;\n  box-sizing: border-box;\n  overflow: auto;\n}\n.account-panel[data-v-5ebbff06] {\n  width: 100%;\n  max-width: 900px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  padding: 2.5rem;\n  color: var(--color-text);\n}\n.header[data-v-5ebbff06] {\n  margin-bottom: 1.5rem;\n}\n.title-row[data-v-5ebbff06] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.title[data-v-5ebbff06] {\n  margin: 0;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  color: var(--color-primary);\n}\n.status[data-v-5ebbff06] {\n  padding: 0.35rem 0.9rem;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  font-size: 0.85rem;\n}\n.status.ok[data-v-5ebbff06] {\n  border-color: rgba(34, 197, 94, 0.4);\n  color: #22c55e;\n}\n.status.warn[data-v-5ebbff06] {\n  border-color: rgba(251, 191, 36, 0.4);\n  color: #fbbf24;\n}\n.subtitle[data-v-5ebbff06] {\n  margin: 0.6rem 0 0;\n  color: var(--color-text-secondary);\n}\n.sections[data-v-5ebbff06] {\n  display: grid;\n  gap: 1rem;\n}\n.section[data-v-5ebbff06] {\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  overflow: hidden;\n}\n.section-title[data-v-5ebbff06] {\n  list-style: none;\n  padding: 0.85rem 1rem;\n  font-weight: 700;\n  color: var(--color-text);\n  cursor: pointer;\n}\n.section-title[data-v-5ebbff06]::-webkit-details-marker {\n  display: none;\n}\n.section-body[data-v-5ebbff06] {\n  padding: 0 1rem 1rem;\n}\n.info-list[data-v-5ebbff06] {\n  display: grid;\n  gap: 0.6rem;\n}\n.info-row[data-v-5ebbff06] {\n  display: flex;\n  justify-content: space-between;\n  gap: 1rem;\n  padding-bottom: 0.6rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.info-row[data-v-5ebbff06]:last-child {\n  border-bottom: none;\n  padding-bottom: 0;\n}\n.info-label[data-v-5ebbff06] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.info-value[data-v-5ebbff06] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.info-empty[data-v-5ebbff06] {\n  color: var(--color-text-muted);\n  font-size: 0.9rem;\n  padding: 0.3rem 0;\n}\n.actions[data-v-5ebbff06] {\n  margin-top: 2rem;\n  display: flex;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.btn[data-v-5ebbff06] {\n  flex: 1;\n  padding: 0.9rem 1rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.btn[data-v-5ebbff06]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.btn-secondary[data-v-5ebbff06] {\n  background: var(--color-surface);\n}\n.btn.danger[data-v-5ebbff06] {\n  border-color: rgba(239, 68, 68, 0.4);\n  background: rgba(239, 68, 68, 0.12);\n  color: #ef4444;\n}\n.btn.danger[data-v-5ebbff06]:hover {\n  background: rgba(239, 68, 68, 0.18);\n}\n.loading[data-v-5ebbff06] {\n  color: var(--color-text-secondary);\n}\n.backend-locked[data-v-5ebbff06] {\n  padding: 1rem 1.25rem;\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n}\n@media (max-width: 768px) {\n.account-panel[data-v-5ebbff06] {\n    padding: 2rem 1.5rem;\n}\n.title-row[data-v-5ebbff06] {\n    flex-direction: column;\n    align-items: flex-start;\n}\n}\n",""]);const s=i},31:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},33:(e,n,t)=>{"use strict";function a(e){const n=Object.create(null);for(const t of e.split(","))n[t]=1;return e=>e in n}t.d(n,{$3:()=>v,$H:()=>$,BH:()=>W,BX:()=>ee,Bm:()=>k,C4:()=>K,CE:()=>h,CP:()=>c,DY:()=>O,Gv:()=>w,J$:()=>J,Kg:()=>x,MZ:()=>r,Mp:()=>l,NO:()=>s,Oj:()=>o,PT:()=>M,Qd:()=>L,Ro:()=>B,SU:()=>T,TF:()=>u,Tg:()=>D,Tn:()=>y,Tr:()=>q,We:()=>U,X$:()=>d,Y2:()=>Z,ZH:()=>z,Zf:()=>S,_B:()=>Y,bB:()=>j,cy:()=>f,gd:()=>b,pD:()=>a,rU:()=>N,tE:()=>i,u3:()=>ne,vM:()=>m,v_:()=>ae,yI:()=>E,yL:()=>_,yQ:()=>F});const r={},o=[],i=()=>{},s=()=>!1,l=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),c=e=>e.startsWith("onUpdate:"),d=Object.assign,u=(e,n)=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)},p=Object.prototype.hasOwnProperty,v=(e,n)=>p.call(e,n),f=Array.isArray,h=e=>"[object Map]"===A(e),m=e=>"[object Set]"===A(e),g=e=>"[object Date]"===A(e),b=e=>"[object RegExp]"===A(e),y=e=>"function"==typeof e,x=e=>"string"==typeof e,k=e=>"symbol"==typeof e,w=e=>null!==e&&"object"==typeof e,_=e=>(w(e)||y(e))&&y(e.then)&&y(e.catch),C=Object.prototype.toString,A=e=>C.call(e),S=e=>A(e).slice(8,-1),L=e=>"[object Object]"===A(e),E=e=>x(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,T=a(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),I=e=>{const n=Object.create(null);return t=>n[t]||(n[t]=e(t))},R=/-(\w)/g,M=I(e=>e.replace(R,(e,n)=>n?n.toUpperCase():"")),P=/\B([A-Z])/g,D=I(e=>e.replace(P,"-$1").toLowerCase()),z=I(e=>e.charAt(0).toUpperCase()+e.slice(1)),N=I(e=>e?`on${z(e)}`:""),$=(e,n)=>!Object.is(e,n),O=(e,...n)=>{for(let t=0;t<e.length;t++)e[t](...n)},F=(e,n,t,a=!1)=>{Object.defineProperty(e,n,{configurable:!0,enumerable:!1,writable:a,value:t})},j=e=>{const n=parseFloat(e);return isNaN(n)?e:n},B=e=>{const n=x(e)?Number(e):NaN;return isNaN(n)?e:n};let X;const U=()=>X||(X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:{}),W=a("Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol");function q(e){if(f(e)){const n={};for(let t=0;t<e.length;t++){const a=e[t],r=x(a)?Q(a):q(a);if(r)for(const e in r)n[e]=r[e]}return n}if(x(e)||w(e))return e}const G=/;(?![^(]*\))/g,H=/:([^]+)/,V=/\/\*[^]*?\*\//g;function Q(e){const n={};return e.replace(V,"").split(G).forEach(e=>{if(e){const t=e.split(H);t.length>1&&(n[t[0].trim()]=t[1].trim())}}),n}function K(e){let n="";if(x(e))n=e;else if(f(e))for(let t=0;t<e.length;t++){const a=K(e[t]);a&&(n+=a+" ")}else if(w(e))for(const t in e)e[t]&&(n+=t+" ");return n.trim()}function Y(e){if(!e)return null;let{class:n,style:t}=e;return n&&!x(n)&&(e.class=K(n)),t&&(e.style=q(t)),e}const J=a("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function Z(e){return!!e||""===e}function ee(e,n){if(e===n)return!0;let t=g(e),a=g(n);if(t||a)return!(!t||!a)&&e.getTime()===n.getTime();if(t=k(e),a=k(n),t||a)return e===n;if(t=f(e),a=f(n),t||a)return!(!t||!a)&&function(e,n){if(e.length!==n.length)return!1;let t=!0;for(let a=0;t&&a<e.length;a++)t=ee(e[a],n[a]);return t}(e,n);if(t=w(e),a=w(n),t||a){if(!t||!a)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const t in e){const a=e.hasOwnProperty(t),r=n.hasOwnProperty(t);if(a&&!r||!a&&r||!ee(e[t],n[t]))return!1}}return String(e)===String(n)}function ne(e,n){return e.findIndex(e=>ee(e,n))}const te=e=>!(!e||!0!==e.__v_isRef),ae=e=>x(e)?e:null==e?"":f(e)||w(e)&&(e.toString===C||!y(e.toString))?te(e)?ae(e.value):JSON.stringify(e,re,2):String(e),re=(e,n)=>te(n)?re(e,n.value):h(n)?{[`Map(${n.size})`]:[...n.entries()].reduce((e,[n,t],a)=>(e[oe(n,a)+" =>"]=t,e),{})}:m(n)?{[`Set(${n.size})`]:[...n.values()].map(e=>oe(e))}:k(n)?oe(n):!w(n)||f(n)||L(n)?n:String(n),oe=(e,n="")=>{var t;return k(e)?`Symbol(${null!=(t=e.description)?t:n})`:e}},76:e=>{"use strict";e.exports=Function.prototype.call},100:(e,n,t)=>{"use strict";t.r(n),t.d(n,{useAPIManagementStore:()=>i});var a=t(810),r=t(953),o=t(641);const i=(0,a.nY)("apiManagement",()=>{const e=[{type:"main",apiId:"default"},{type:"memory_summary",apiId:"default"},{type:"embedding",apiId:"default"},{type:"text_optimization",apiId:"default"},{type:"instruction_generation",apiId:"default"},{type:"world_generation",apiId:"default"},{type:"event_generation",apiId:"default"},{type:"sect_generation",apiId:"default"},{type:"crafting",apiId:"default"}],n=[{type:"memory_summary",mode:"raw"},{type:"text_optimization",mode:"raw"},{type:"world_generation",mode:"raw"},{type:"event_generation",mode:"raw"},{type:"sect_generation",mode:"raw"},{type:"crafting",mode:"raw"}],t=[{type:"memory_summary",enabled:!0},{type:"text_optimization",enabled:!1},{type:"embedding",enabled:!1},{type:"world_generation",enabled:!0},{type:"event_generation",enabled:!0},{type:"sect_generation",enabled:!0},{type:"crafting",enabled:!0}],a=(0,r.KR)([]),i=(0,r.KR)([...e]),s=(0,r.KR)([...n]),l=(0,r.KR)([...t]),c=(0,r.KR)({splitStep2Streaming:!1}),d=(0,o.EW)(()=>a.value.filter(e=>e.enabled)),u=(0,o.EW)(()=>{const e=i.value.find(e=>"main"===e.type),n=i.value.find(e=>"instruction_generation"===e.type);return e?.apiId&&"default"!==e.apiId||n?.apiId&&"default"!==n.apiId}),p=()=>{try{const e={apiConfigs:a.value,apiAssignments:i.value,functionModes:s.value,functionEnabled:l.value,aiGenerationSettings:c.value};localStorage.setItem("api_management_config",JSON.stringify(e))}catch(e){console.error("[API管理] 保存配置失败:",e)}};return{apiConfigs:a,apiAssignments:i,functionModes:s,functionEnabled:l,aiGenerationSettings:c,enabledAPIs:d,shouldEnableSplitGeneration:u,loadFromStorage:()=>{try{const r=localStorage.getItem("api_management_config");if(r){const o=JSON.parse(r);o.aiGenerationSettings&&(c.value={...c.value,...o.aiGenerationSettings}),a.value=o.apiConfigs||[];const d=new Set(e.map(e=>e.type)),u=new Map;e.forEach(e=>u.set(e.type,{...e}));const v=Array.isArray(o.apiAssignments)?o.apiAssignments:[];for(const e of v){const n=e?.type,t="string"==typeof e?.apiId?e.apiId:"default";n&&d.has(n)&&u.set(n,{type:n,apiId:t})}const f=new Set((a.value||[]).map(e=>e?.id).filter(Boolean)),h=e.map(e=>{const n=u.get(e.type)||e,t=f.has(n.apiId)?n.apiId:"default";return{type:e.type,apiId:t}});i.value=h;const m=new Set(n.map(e=>e.type)),g=new Map;n.forEach(e=>g.set(e.type,{...e}));const b=Array.isArray(o.functionModes)?o.functionModes:[];for(const e of b){const n=e?.type,t="standard"===e?.mode?"standard":"raw";n&&m.has(n)&&g.set(n,{type:n,mode:t})}s.value=n.map(e=>g.get(e.type)||e);const y=new Set(t.map(e=>e.type)),x=new Map;t.forEach(e=>x.set(e.type,{...e}));const k=Array.isArray(o.functionEnabled)?o.functionEnabled:[];for(const e of k){const n=e?.type,t=!0===e?.enabled;n&&y.has(n)&&x.set(n,{type:n,enabled:t})}l.value=t.map(e=>x.get(e.type)||e),p()}0===a.value.length&&a.value.push({id:"default",name:"默认API",provider:"openai",url:"https://api.openai.com",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0})}catch(e){console.error("[API管理] 加载配置失败:",e)}},saveToStorage:p,addAPI:e=>{const n={...e,id:`api_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return a.value.push(n),p(),n.id},updateAPI:(e,n)=>{const t=a.value.findIndex(n=>n.id===e);-1!==t&&(a.value[t]={...a.value[t],...n},p())},deleteAPI:e=>{if("default"===e)throw new Error("不能删除默认API配置");i.value.forEach(n=>{n.apiId===e&&(n.apiId="default")}),a.value=a.value.filter(n=>n.id!==e),p()},assignAPI:(e,n)=>{const t=i.value.find(n=>n.type===e);t?t.apiId=n:i.value.push({type:e,apiId:n}),p()},getAPIForType:e=>{const n=i.value.find(n=>n.type===e);if(!n)return null;return a.value.find(e=>e.id===n.apiId&&e.enabled)||a.value.find(e=>"default"===e.id)||null},toggleAPI:e=>{const n=a.value.find(n=>n.id===e);n&&(n.enabled=!n.enabled,p())},setFunctionMode:(e,n)=>{const t=s.value.find(n=>n.type===e);t?t.mode=n:s.value.push({type:e,mode:n}),p()},getFunctionMode:e=>{const n=s.value.find(n=>n.type===e);return n?.mode||"raw"},setFunctionEnabled:(e,n)=>{const t=l.value.find(n=>n.type===e);t?t.enabled=n:l.value.push({type:e,enabled:n}),p()},isFunctionEnabled:e=>{const n=l.value.find(n=>n.type===e);return n?.enabled??!0},updateAIGenerationSettings:e=>{c.value={...c.value,...e},p()},exportConfig:()=>({apiConfigs:a.value,apiAssignments:i.value,functionModes:s.value,functionEnabled:l.value,aiGenerationSettings:c.value,exportTime:(new Date).toISOString()}),importConfig:e=>{try{e.apiConfigs&&Array.isArray(e.apiConfigs)&&(a.value=e.apiConfigs),e.apiAssignments&&Array.isArray(e.apiAssignments)&&(i.value=e.apiAssignments),e.functionModes&&Array.isArray(e.functionModes)&&(s.value=e.functionModes),e.functionEnabled&&Array.isArray(e.functionEnabled)&&(l.value=e.functionEnabled),e.aiGenerationSettings&&(c.value={...c.value,...e.aiGenerationSettings}),p()}catch(e){throw console.error("[API管理] 导入配置失败:",e),e}}}})},228:e=>{"use strict";var n=Object.prototype.hasOwnProperty,t="~";function a(){}function r(e,n,t){this.fn=e,this.context=n,this.once=t||!1}function o(e,n,a,o,i){if("function"!=typeof a)throw new TypeError("The listener must be a function");var s=new r(a,o||e,i),l=t?t+n:n;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function i(e,n){0===--e._eventsCount?e._events=new a:delete e._events[n]}function s(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(t=!1)),s.prototype.eventNames=function(){var e,a,r=[];if(0===this._eventsCount)return r;for(a in e=this._events)n.call(e,a)&&r.push(t?a.slice(1):a);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var n=t?t+e:e,a=this._events[n];if(!a)return[];if(a.fn)return[a.fn];for(var r=0,o=a.length,i=new Array(o);r<o;r++)i[r]=a[r].fn;return i},s.prototype.listenerCount=function(e){var n=t?t+e:e,a=this._events[n];return a?a.fn?1:a.length:0},s.prototype.emit=function(e,n,a,r,o,i){var s=t?t+e:e;if(!this._events[s])return!1;var l,c,d=this._events[s],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,n),!0;case 3:return d.fn.call(d.context,n,a),!0;case 4:return d.fn.call(d.context,n,a,r),!0;case 5:return d.fn.call(d.context,n,a,r,o),!0;case 6:return d.fn.call(d.context,n,a,r,o,i),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var p,v=d.length;for(c=0;c<v;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,n);break;case 3:d[c].fn.call(d[c].context,n,a);break;case 4:d[c].fn.call(d[c].context,n,a,r);break;default:if(!l)for(p=1,l=new Array(u-1);p<u;p++)l[p-1]=arguments[p];d[c].fn.apply(d[c].context,l)}}return!0},s.prototype.on=function(e,n,t){return o(this,e,n,t,!1)},s.prototype.once=function(e,n,t){return o(this,e,n,t,!0)},s.prototype.removeListener=function(e,n,a,r){var o=t?t+e:e;if(!this._events[o])return this;if(!n)return i(this,o),this;var s=this._events[o];if(s.fn)s.fn!==n||r&&!s.once||a&&s.context!==a||i(this,o);else{for(var l=0,c=[],d=s.length;l<d;l++)(s[l].fn!==n||r&&!s[l].once||a&&s[l].context!==a)&&c.push(s[l]);c.length?this._events[o]=1===c.length?c[0]:c:i(this,o)}return this},s.prototype.removeAllListeners=function(e){var n;return e?(n=t?t+e:e,this._events[n]&&i(this,n)):(this._events=new a,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=t,s.EventEmitter=s,e.exports=s},236:(e,n,t)=>{"use strict";t.d(n,{e:()=>r});var a=t(7445);async function r(e,n,t=!1,r,o){try{const i=await a.aiService.generateRaw({ordered_prompts:[{role:"user",content:n},{role:"user",content:e},{role:"user",content:"开始任务"}],should_stream:t,usageType:r,onStreamChunk:o,overrides:{world_info_before:"",world_info_after:""}});return i&&"object"==typeof i&&"text"in i?i.text:"string"==typeof i?i:String(i)}catch(e){throw console.error("[TavernCore] 生成响应失败:",e),e}}},287:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n.origin-selection-container[data-v-b7287234] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.loading-state[data-v-b7287234], .error-state[data-v-b7287234], .placeholder[data-v-b7287234] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.origin-layout[data-v-b7287234] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.origin-left-panel[data-v-b7287234] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.origin-list-container[data-v-b7287234] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.origin-list-container[data-v-b7287234]::-webkit-scrollbar { width: 6px;\n}\n.origin-list-container[data-v-b7287234]::-webkit-scrollbar-track { background: transparent;\n}\n.origin-list-container[data-v-b7287234]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.origin-list-container[data-v-b7287234]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式 ========== */\n.origin-item[data-v-b7287234] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.origin-item[data-v-b7287234]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.origin-item.selected[data-v-b7287234] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.origin-item.disabled[data-v-b7287234] {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.origin-item.disabled[data-v-b7287234]:hover {\n  background: rgba(30, 41, 59, 0.4);\n  border-color: transparent;\n}\n.item-content[data-v-b7287234] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n.origin-name[data-v-b7287234] {\n  font-weight: 500;\n  color: #f1f5f9;\n}\n.origin-item.selected .origin-name[data-v-b7287234] {\n  color: #bfdbfe;\n}\n.origin-cost[data-v-b7287234] {\n  color: #fbbf24;\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-b7287234] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.origin-item:hover .action-buttons[data-v-b7287234] {\n  opacity: 1;\n}\n.edit-btn[data-v-b7287234], .delete-btn[data-v-b7287234] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-b7287234]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.1);\n}\n.delete-btn[data-v-b7287234]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.1);\n}\n.divider[data-v-b7287234] {\n  height: 1px;\n  background: linear-gradient(to right, transparent, rgba(147, 197, 253, 0.2), transparent);\n  margin: 0.5rem 0;\n}\n.action-name[data-v-b7287234] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.origin-details-container[data-v-b7287234] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.origin-details[data-v-b7287234] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.origin-details h2[data-v-b7287234] {\n  margin: 0 0 1rem 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.description-scroll[data-v-b7287234] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  margin-bottom: 1rem;\n  padding-right: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll[data-v-b7287234]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-b7287234]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-b7287234]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.description-scroll p[data-v-b7287234] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.cost-display[data-v-b7287234] {\n  text-align: right;\n  font-weight: 600;\n  color: #fbbf24;\n  flex-shrink: 0;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .origin-left-panel[data-v-b7287234],\n[data-theme="light"] .origin-details-container[data-v-b7287234] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .origin-item[data-v-b7287234] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .origin-item[data-v-b7287234]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .origin-item.selected[data-v-b7287234] {\n  background: rgba(219, 234, 254, 0.8);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .origin-name[data-v-b7287234] {\n  color: #1e293b;\n}\n[data-theme="light"] .origin-item.selected .origin-name[data-v-b7287234] {\n  color: #1e40af;\n}\n[data-theme="light"] .origin-details h2[data-v-b7287234] {\n  color: #2563eb;\n}\n[data-theme="light"] .description-scroll p[data-v-b7287234] {\n  color: #475569;\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.origin-layout[data-v-b7287234] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.origin-layout[data-v-b7287234] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.origin-details h2[data-v-b7287234] {\n    font-size: 1.6rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-b7287234] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-b7287234] {\n    flex-grow: 1;\n    text-align: center;\n}\n.origin-layout[data-v-b7287234] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.origin-left-panel[data-v-b7287234] {\n    order: 1;\n    max-height: 40vh;\n}\n.origin-details-container[data-v-b7287234] {\n    order: 2;\n    min-height: 300px;\n}\n.origin-list-container[data-v-b7287234] {\n    max-height: 35vh;\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n\n  /* 优化触摸体验 */\n.origin-item[data-v-b7287234],\n  .action-item[data-v-b7287234] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.origin-layout[data-v-b7287234] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.origin-left-panel[data-v-b7287234] {\n    max-height: 35vh;\n}\n.origin-list-container[data-v-b7287234] {\n    max-height: 30vh;\n    padding: 0.5rem;\n}\n.origin-item[data-v-b7287234] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-b7287234] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-b7287234] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.origin-details-container[data-v-b7287234] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.origin-details h2[data-v-b7287234] {\n    font-size: 1.4rem;\n    margin-bottom: 0.8rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-b7287234] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.origin-selection-container[data-v-b7287234] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.origin-layout[data-v-b7287234] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.origin-left-panel[data-v-b7287234] {\n    max-height: none;\n    border-radius: 6px;\n}\n.origin-list-container[data-v-b7287234] {\n    max-height: 26vh;\n    padding: 0.4rem;\n}\n.origin-item[data-v-b7287234] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.origin-name[data-v-b7287234] {\n    font-size: 0.9rem;\n}\n.origin-cost[data-v-b7287234] {\n    font-size: 0.8rem;\n}\n.divider[data-v-b7287234] {\n    margin: 0.3rem 0;\n}\n.single-actions-container[data-v-b7287234] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-b7287234] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.origin-details-container[data-v-b7287234] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.origin-details h2[data-v-b7287234] {\n    font-size: 1.3rem;\n    margin-bottom: 0.6rem;\n}\n.description-scroll[data-v-b7287234] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n    margin-bottom: 0.8rem;\n}\n.cost-display[data-v-b7287234] {\n    font-size: 1rem;\n    text-align: center;\n}\n.placeholder[data-v-b7287234] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-b7287234] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-b7287234] {\n    text-align: center;\n}\n}\n\n/* 顶部功能按钮 - 深色玻璃拟态风格 */\n.top-actions-container[data-v-b7287234] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-b7287234] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-b7287234]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n\n/* 亮色主题顶部按钮 */\n[data-theme="light"] .top-actions-container[data-v-b7287234] {\n  background: rgba(241, 245, 249, 0.6);\n  border-bottom-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-b7287234] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-b7287234]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n@media (max-width: 360px) {\n.origin-selection-container[data-v-b7287234] {\n    padding: 0.3rem;\n}\n.origin-layout[data-v-b7287234] {\n    gap: 0.4rem;\n}\n.origin-left-panel[data-v-b7287234] {\n    max-height: 28vh;\n}\n.origin-list-container[data-v-b7287234] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.origin-item[data-v-b7287234] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.origin-name[data-v-b7287234] {\n    font-size: 0.8rem;\n}\n.origin-cost[data-v-b7287234] {\n    font-size: 0.75rem;\n}\n.origin-details-container[data-v-b7287234] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.origin-details h2[data-v-b7287234] {\n    font-size: 1.1rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-b7287234] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n    margin-bottom: 0.6rem;\n}\n.cost-display[data-v-b7287234] {\n    font-size: 0.9rem;\n}\n.action-item[data-v-b7287234] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-b7287234] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-b7287234],\n[data-theme="light"] .delete-btn[data-v-b7287234] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-b7287234]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-b7287234]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n',""]);const s=i},387:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-members[data-v-286f4f64] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n  padding: 8px;\n}\n.spin[data-v-286f4f64] {\n  animation: spin-286f4f64 0.9s linear infinite;\n}\n@keyframes spin-286f4f64 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n\n/* 我的宗门身份卡片 - 紧凑版 */\n.my-sect-identity[data-v-286f4f64] {\n  border: 1px solid rgba(147, 51, 234, 0.25);\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.08), rgba(168, 85, 247, 0.03));\n  border-radius: 8px;\n  padding: 8px 10px;\n  flex-shrink: 0;\n}\n.identity-header[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-weight: 700;\n  font-size: 0.85rem;\n  color: #9333ea;\n  margin-bottom: 8px;\n  padding-bottom: 6px;\n  border-bottom: 1px solid rgba(147, 51, 234, 0.15);\n}\n.identity-content[data-v-286f4f64] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.identity-stats[data-v-286f4f64] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.stat-item[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 8px;\n  background: var(--color-background);\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n}\n.stat-label[data-v-286f4f64] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n.stat-value[data-v-286f4f64] {\n  font-weight: 600;\n  font-size: 0.78rem;\n}\n.stat-value.sect-name[data-v-286f4f64] { color: var(--color-text);\n}\n.stat-value.position[data-v-286f4f64] { color: #9333ea;\n}\n.stat-value.contribution[data-v-286f4f64] { color: #f59e0b;\n}\n.stat-value.reputation[data-v-286f4f64] { color: #3b82f6;\n}\n.stat-value.join-date[data-v-286f4f64] { color: var(--color-text-secondary); font-size: 0.72rem;\n}\n.identity-actions[data-v-286f4f64] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.quick-action-btn[data-v-286f4f64] {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 8px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  color: var(--color-text);\n  font-size: 0.72rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.quick-action-btn[data-v-286f4f64]:hover {\n  border-color: rgba(59, 130, 246, 0.4);\n  background: rgba(59, 130, 246, 0.08);\n  color: #3b82f6;\n}\n.leave-sect-btn[data-v-286f4f64] {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 8px;\n  background: transparent;\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 4px;\n  color: #ef4444;\n  font-size: 0.72rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-left: auto;\n}\n.leave-sect-btn[data-v-286f4f64]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.5);\n}\n.leadership-card[data-v-286f4f64] {\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  border-radius: 8px;\n  padding: 8px 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  flex-shrink: 0;\n}\n.leadership-header[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 8px;\n}\n.leadership-title[data-v-286f4f64] {\n  display: inline-flex;\n  gap: 6px;\n  align-items: center;\n  font-weight: 700;\n  font-size: 0.85rem;\n}\n.leadership-grid[data-v-286f4f64] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.leader-item[data-v-286f4f64] {\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  border-radius: 6px;\n  padding: 6px 8px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.78rem;\n}\n.leader-item.primary[data-v-286f4f64] {\n  border-color: rgba(168, 85, 247, 0.35);\n  background: rgba(168, 85, 247, 0.06);\n}\n.leader-item .role[data-v-286f4f64] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n.leader-item .name[data-v-286f4f64] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.leader-item .realm[data-v-286f4f64] {\n  font-size: 0.72rem;\n  color: var(--color-text-secondary);\n}\n.leader-item .link[data-v-286f4f64] {\n  border: none;\n  background: transparent;\n  color: #9333ea;\n  cursor: pointer;\n  font-size: 0.72rem;\n  padding: 0;\n  margin-left: 4px;\n}\n.leader-item .link[data-v-286f4f64]:hover {\n  text-decoration: underline;\n}\n.leadership-empty[data-v-286f4f64] {\n  color: var(--color-text-secondary);\n  font-size: 0.78rem;\n}\n.ask-btn.small[data-v-286f4f64] {\n  padding: 4px 8px;\n  font-size: 0.72rem;\n}\n.position-leader[data-v-286f4f64] {\n  background: rgba(168, 85, 247, 0.12);\n  border-color: rgba(168, 85, 247, 0.35);\n  color: #a855f7;\n}\n.info-item[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.info-label[data-v-286f4f64] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-286f4f64] {\n  font-weight: 600;\n  font-size: 0.9rem;\n}\n.info-value.sect-name[data-v-286f4f64] { color: var(--color-text);\n}\n.info-value.position[data-v-286f4f64] { color: #9333ea;\n}\n.member-tabs[data-v-286f4f64] {\n  display: flex;\n  gap: 4px;\n  flex-wrap: wrap;\n  flex-shrink: 0;\n}\n.tab-btn[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 4px 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  color: var(--color-text-secondary);\n  font-size: 0.72rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tab-btn[data-v-286f4f64]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-286f4f64] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));\n  border-color: rgba(59, 130, 246, 0.4);\n  color: #3b82f6;\n}\n.count-badge[data-v-286f4f64] {\n  background: #3b82f6;\n  color: white;\n  font-size: 0.65rem;\n  padding: 0 0.3rem;\n  border-radius: 8px;\n  font-weight: 600;\n}\n.member-list[data-v-286f4f64] {\n  flex: 1;\n  min-height: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n.empty-state[data-v-286f4f64] {\n  text-align: center;\n  padding: 1.5rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-286f4f64] {\n  opacity: 0.5;\n  margin-bottom: 0.4rem;\n}\n.empty-text[data-v-286f4f64] {\n  font-weight: 600;\n  margin-bottom: 0.2rem;\n  font-size: 0.85rem;\n}\n.empty-hint[data-v-286f4f64] {\n  font-size: 0.75rem;\n  opacity: 0.7;\n  margin-bottom: 0.75rem;\n}\n.ask-btn[data-v-286f4f64] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.5rem 0.8rem;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border: none;\n  border-radius: 5px;\n  color: white;\n  font-size: 0.78rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.ask-btn[data-v-286f4f64]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n.members[data-v-286f4f64] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.member-card[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  padding: 6px 8px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.member-card[data-v-286f4f64]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  background: var(--color-surface);\n}\n.member-card.is-self[data-v-286f4f64] {\n  border-color: rgba(147, 51, 234, 0.3);\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.05), rgba(168, 85, 247, 0.02));\n}\n.member-avatar[data-v-286f4f64] {\n  position: relative;\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #9333ea, #7c3aed);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n.avatar-text[data-v-286f4f64] {\n  color: white;\n  font-weight: 600;\n  font-size: 0.85rem;\n}\n.gender-badge[data-v-286f4f64] {\n  position: absolute;\n  bottom: -2px;\n  right: -2px;\n  width: 14px;\n  height: 14px;\n  border-radius: 50%;\n  font-size: 0.55rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 2px solid var(--color-background);\n}\n.gender-badge.male[data-v-286f4f64] {\n  background: #3b82f6;\n  color: white;\n}\n.gender-badge.female[data-v-286f4f64] {\n  background: #ec4899;\n  color: white;\n}\n.member-info[data-v-286f4f64] {\n  flex: 1;\n  min-width: 0;\n}\n.member-header[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  margin-bottom: 0.15rem;\n}\n.member-name[data-v-286f4f64] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.82rem;\n}\n.member-position[data-v-286f4f64] {\n  font-size: 0.65rem;\n  padding: 0.05rem 0.3rem;\n  border-radius: 3px;\n  font-weight: 500;\n}\n.position-elder[data-v-286f4f64] { background: rgba(239, 68, 68, 0.1); color: #ef4444;\n}\n.position-true[data-v-286f4f64] { background: rgba(139, 92, 246, 0.1); color: #8b5cf6;\n}\n.position-inner[data-v-286f4f64] { background: rgba(59, 130, 246, 0.1); color: #3b82f6;\n}\n.position-outer[data-v-286f4f64] { background: rgba(107, 114, 128, 0.1); color: #6b7280;\n}\n.member-details[data-v-286f4f64] {\n  display: flex;\n  gap: 0.6rem;\n}\n.detail-item[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.15rem;\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n.detail-item.realm[data-v-286f4f64] { color: #8b5cf6;\n}\n.relation-best[data-v-286f4f64] { color: #ec4899 !important;\n}\n.relation-good[data-v-286f4f64] { color: #f59e0b !important;\n}\n.relation-friendly[data-v-286f4f64] { color: #22c55e !important;\n}\n.relation-normal[data-v-286f4f64] { color: var(--color-text-secondary) !important;\n}\n.relation-cold[data-v-286f4f64] { color: #6b7280 !important;\n}\n.relation-hostile[data-v-286f4f64] { color: #ef4444 !important;\n}\n.arrow-icon[data-v-286f4f64] {\n  color: var(--color-text-secondary);\n  flex-shrink: 0;\n}\n.quick-actions[data-v-286f4f64] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.actions-title[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.action-buttons[data-v-286f4f64] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.5rem;\n}\n.action-btn[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.35rem;\n  padding: 0.5rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.action-btn[data-v-286f4f64]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  background: rgba(59, 130, 246, 0.05);\n  color: #3b82f6;\n}\n.members-notice[data-v-286f4f64] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 4px 8px;\n  background: rgba(59, 130, 246, 0.1);\n  border-radius: 4px;\n  font-size: 0.7rem;\n  color: #3b82f6;\n  flex-shrink: 0;\n}\n",""]);const s=i},406:(e,n,t)=>{"use strict";t.d(n,{Ps:()=>a,lS:()=>o});const a='\n[精简版SaveData结构说明]\n格式约定:T?可选;T[]数组;{K:V}对象;[范围]约束;路径用.分隔\n精简存档包含:元数据(仅时间)|角色(完整)|社交(关系/事件/中长期记忆)|世界(完整)\n不包含:系统域(配置/缓存/历史)|短期记忆(单独注入)\n\n\n[角色数据]\n路径:角色.身份(只读)|角色.属性(可改)|角色.位置|角色.效果|角色.装备|角色.身体|角色.背包\n\n[角色.身份](只读,系统自动计算年龄)\n名字:str;性别:"男"|"女"|"其他";年龄:num(自动);出生日期:{年,月,日,小时?,分钟?};世界:str;种族:str="人类";出生:str|{名称,描述};天赋:[{名称,描述}];先天属性:{力量,敏捷,体质,意志,魅力,幸运}[1-10];觉醒阶段:str;异能名称?:str;异能类型?:str;异能描述?:str;异能代价?:str\n(注:异能相关字段在初始化时扁平存储于身份中，后续可扩展为独立模块)\n\n[角色.属性](可改)\n声望:num;生命值:{当前,上限};精神力:{当前,上限};理智值:{当前,上限};体力:{当前,上限};寿命:{当前,上限};特殊攻击力:num;特殊防御力:num;物理攻击力:num;物理防御力:num\n(注:禁止直接set整个属性对象，必须set子路径如 角色.属性.生命值.当前)\n\n[角色.位置]\n描述:str(格式"地区·地标·细节");x:num[0-10000];y:num[0-10000];区域等级:"绿区"|"黄区"|"橙区"|"红区"|"黑区"\n\n[角色.效果](buff/debuff数组)\n[{状态名称,类型:"buff"|"debuff",生成时间:{年,月,日,小时,分钟},持续时间分钟,状态描述,强度?,来源?,属性加成?:{力量?:num,敏捷?:num,体质?:num,意志?:num,魅力?:num,幸运?:num}}]\n生成时间必填,使用元数据.时间的完整对象\n\n[角色.装备]\n装备1~6:str|null(装备ID或null)\n\n[角色.身体](NSFW敏感字段需nsfwMode=true)\n基础体格:身高:num(cm),体重:num(kg),体脂率?:num(%),三围:{胸围:num,腰围:num,臀围:num}\n外观细节:肤色?:str,发色?:str,瞳色?:str,纹身与印记?:[str],穿刺?:[str]\n敏感字段(仅NSFW):胸部描述?:str,私处描述?:str,生殖器描述?:str,敏感点?:[str],开发度?:{部位名:num[0-100]}\n扩展:其它?:{任意键:任意值}\n\n\n\n[背包数据](路径:角色.背包,可改)\n货币?:{币种ID:CurrencyAsset};货币设置?:{禁用币种:[],基准币种?:str};突变结晶:{下级,中级,上级,顶级}(兼容旧存档);物品:{物品ID:Item}\n(⚠️重要: 新增物品/货币必须使用 set 写入完整对象，禁止使用 add)\n\n[CurrencyAsset]\n币种:str;名称:str;数量:num;价值:num(基准=下级突变结晶=1);描述?:str;图标?:str(lucide名)\n地区波动记录于:世界.信息.经济.地区波动.<地点>.货币波动[0.6-1.6]\n\n[物品通用字段]\n物品ID:str(格式:{类型}_时间戳_随机数);名称:str;类型:"装备"|"物品"|"突变结晶"|"异变能力";品质:{quality:"破损"|"粗糙"|"普通"|"精良"|"稀有"|"史诗"|"传说",grade:0-10};数量:num=1;描述:str;价值:num(以突变结晶_下级为单位)\n品级说明:0残缺,1-3下级,4-6中级,7-9上级,10顶级\n\n[装备物品]\n物品ID:equip_时间戳_随机数;类型:"装备";装备增幅?:{核心属性?:{力量?,敏捷?,体质?,意志?,魅力?,幸运?},生命值上限?,精神力上限?,理智值上限?,体力上限?};特殊效果?:str;已装备:bool;价值:num\n\n[通用消耗品/材料]\n物品ID:item_时间戳_随机数;类型:"物品";使用效果?:str;价值:num\n\n[异变能力物品]\n物品ID:ability_时间戳_随机数;类型:"异变能力";能力效果:str;能力技能:[{技能名称,技能描述,熟练度要求,消耗?}](至少1个,第1个熟练度要求=0);掌握进度:num[0-100];已解锁技能:[];已激活:bool;激活中?:bool;价值:num\n\n\n\n[社交.关系](NPC档案字典,可改)\n格式:{NPC名:NPCData}\n\n[NPCData结构]\n名字:str;性别:"男"|"女"|"其他";种族:str="人类";出生:str(出身背景,如"幸存者小队/地下避难所/流动求生者");出生日期:{年,月,日}(必填,用于计算年龄,⚠️禁止生成"年龄"字段);外貌描述:str(必须详细,至少50字);性格特征:[](至少3个);觉醒阶段:str;天赋:[{名称,描述}](至少1个);异能名称?: str;异能类型?: str;异能描述?: str;异能代价?: str;先天属性:{力量,敏捷,体质,意志,魅力,幸运}[1-10,⚠️每个属性必须独立生成,禁止全部相同];属性:{生命值:{当前,上限},精神力:{当前,上限},理智值:{当前,上限},体力:{当前,上限},寿命:{当前,上限},特殊攻击力:num;特殊防御力:num;物理攻击力:num;物理防御力:num};与玩家关系:str(陌生人/同伴/猎手/敌对);好感度:num[-100~100];人格底线:[];记忆:[];记忆总结:[];当前位置:{描述,x?,y?};势力倾向:str(秩序坚守者/流动求生者/求知记录者/变异崇拜者/古老觉醒者/其他);当前外貌状态:str;当前内心想法:str;背包:{货币:{币种ID:{数量,名称,单位}},物品:{}};实时关注:bool(true时每回合推演其动态)\n\n[⚠️NPC生成质量要求]\n出生:str,必填!出身背景描述(如"幸存者小队/地下避难所/流动求生者"),⚠️这不是年龄!禁止生成"年龄"字段!\n出生日期:{年,月,日},必填!用于系统自动计算年龄,年份必须合理(当前时间年份-NPC年龄)\n先天属性:力量/敏捷/体质/意志/魅力/幸运,各1-10,严禁全同,至少3项不同\n外貌描述:str,至少50字,必含身材体态+面容五官+气质神韵+衣着打扮\n性格特征:[str],至少3个,需有表里层次\n天赋:[{名称,描述}],至少1个,根据身份设计\n记忆:[str],至少2条,与当前处境相关\n觉醒阶段?:str\n异能名称?: str\n异能类型?: str\n异能描述?: str\n异能代价?: str\n属性:生命值/精神力/理智值/体力的当前和上限必须与阶段匹配,禁用占位符数值,特殊攻击力/特殊防御力/物理攻击力/物理防御力必须使用number类型,禁止使用占位符数值\n\n[社交.关系矩阵](可选)\nedges:[{from,to,relation?,score?,tags?,updatedAt?}]\n\n[NSFW:PrivacyProfile](路径:社交.关系.{NPC名}.私密信息)\n私密信息字段:是否为处女:bool;三围:{胸围:num,腰围:num,臀围:num};性格倾向/性取向/当前性状态/性经验等级/亲密节奏/亲密需求/安全偏好/体液分泌状态/避孕措施:str;性渴望程度/性交总次数:num;最近一次性行为时间:str;亲密偏好/禁忌清单/性癖好/性伴侣名单/特殊体质:[];生育状态:{是否可孕:bool;当前状态:str;妊娠月数?:num;预计分娩时间?:str};身体部位:BodyPartDevelopment[]\n\n[NSFW:BodyPartDevelopment]\n私密信息身体部位字段:部位名称:str(胸部/小穴/菊穴/嘴唇/耳朵等);敏感度:num[0-100];开发度:num[0-100];特殊印记?:str;特征描述:str;反应描述?:str;偏好刺激?:str;禁忌?:str\n\n\n\n[社交.记忆](只读)\n短期记忆?:[](不在精简存档,由系统注入);中期记忆:[];长期记忆:[]\n\n\n\n[世界数据](可改,联机模式只读)\n地图:{continents[],factions[],features[]};大陆信息:[{名称,描述,地理特征,...}](只读)\n\n[世界.信息.势力信息](可改)\nid?:str|num;名称:str;类型:"避难所"|"掠夺团伙"|"流动求生者"|"求知记录者"|"变异崇拜者"|"古老觉醒者"|"其他";位置:str|{x,y};描述:str;特色:[];与玩家关系:"敌对"|"中立"|"友好";声望值:num[-100~100];成员估计?:{总数?,觉醒者比例?};影响范围?:str;战略价值?[1-10]\n\n[世界.信息.地点信息](可改)\n名称:str;类型:str;位置:str;coordinates:{x,y};描述:str;安全等级?:str;开放状态?:str\n\n\n\n[元数据.时间]\n年:num;月:num[1-12];日:num[1-31];小时:num[0-23];分钟:num[0-59]\n\n\n[社交.事件]\n配置:{启用随机事件,最小间隔月,最大间隔月,事件提示词};下次事件时间:GameTime|null;事件记录:[GameEvent]\n\n[GameEvent]\n事件ID:str(event_时间戳_随机数);事件名称:str;事件类型:str(异常地带扩张/城市陷落/物资争夺/古老实体出没/觉醒者失控/人物风波);事件描述:str;影响等级?:"轻微"|"中等"|"重大"|"灾难";影响范围?:str;相关人物?:[];相关势力?:[];事件来源:"随机"|"玩家影响"|"系统";发生时间:{年,月,日,小时,分钟}\n\n\n\n[系统.配置](只读)\nnsfwMode:bool;nsfwGenderFilter:"all"|"female"|"male"\n\n\n'.trim(),r='\n[✅ 正确示例：装备增幅（标准结构）]\n{"action":"set","key":"角色.背包.物品.equip_1739530000_123","value":{"物品ID":"equip_1739530000_123","名称":"质变黑框眼镜","类型":"装备","品质":{"quality":"精良","grade":6},"数量":1,"描述":"镜片解析体征数据，绅士神器","价值":50,"装备增幅":{"核心属性":{"意志":2,"魅力":1},"精神力上限":5},"特殊效果":"【真视解析】：观察目标时，有概率获取三围/健康/弱点"}}\n\n[✅ 正确示例：装备增幅（兼容结构：后天属性）]\n{"action":"set","key":"角色.背包.物品.equip_1739530000_124","value":{"物品ID":"equip_1739530000_124","名称":"观测头环","类型":"装备","品质":{"quality":"稀有","grade":7},"数量":1,"描述":"增强认知与精神聚焦","价值":80,"装备增幅":{"后天属性":{"意志":2,"魅力":1},"SP上限":3}}}\n\n[✅ 正确示例：装备增幅（扁平结构：直写中文六维键）]\n{"action":"set","key":"角色.背包.物品.equip_1739530000_125","value":{"物品ID":"equip_1739530000_125","名称":"战术手套","类型":"装备","品质":{"quality":"普通","grade":4},"数量":1,"描述":"提升握力与反应","价值":30,"装备增幅":{"力量":1,"敏捷":1}}}\n\n[✅ 正确示例：异能效果（永久加成）]\n{"action":"set","key":"角色.身份.后天属性","value":{"力量":0,"敏捷":0,"体质":2,"意志":1,"魅力":0,"幸运":0}}\n- 说明：获得“钢骨”类永久异能时，将长期属性加成写入 角色.身份.后天属性（中文六维键），必须用 set 写入完整对象\n\n[✅ 正确示例：异能效果（主动状态）]\n{"action":"set","key":"角色.效果","value":[{"状态名称":"肾上腺素超频","类型":"buff","状态描述":"短时提升反应与力量","来源":"异能","剩余时间":"30分钟","属性加成":{"敏捷":3,"力量":2}}]}\n- 说明：施展主动异能时，用 状态效果 写入加成；持续时间必须为“X分钟”，属性键使用中文六维\n\n[✅ 正确示例：异能负面代价（主动减益）]\n{"action":"set","key":"角色.效果","value":[{"状态名称":"信息污染残留","类型":"debuff","状态描述":"认知受到干扰","来源":"异能","剩余时间":"20分钟","属性加成":{"理智":-2,"意志":-1}}]}\n- 说明：负面影响也写入 属性加成，使用负数表示减益；理智键使用“SAN/理智”的系统统一映射，建议使用“理智”\n\n[❌ 错误示例：使用add创建物品（被禁止）]\n{"action":"add","key":"角色.背包.物品","value":{"物品ID":"equip_xxx","名称":"随便写的装备"}} ← 必须用 set 完整对象\n\n[❌ 错误示例：整体set核心路径（被禁止）]\n{"action":"set","key":"角色.属性","value":{}} ← 禁止整体覆盖角色.属性，必须操作子字段如 角色.属性.生命值.当前\n\n[❌ 错误示例：异能写入错误路径]\n{"action":"set","key":"角色.属性.异能","value":{"名称":"xxx"}} ← 禁止使用 角色.属性.异能；异能字段统一在 角色.身份.*\n\n[❌ 错误示例：状态效果持续时间单位错误]\n{"action":"set","key":"角色.效果","value":[{"状态名称":"超频","类型":"buff","剩余时间":"30min","属性加成":{"敏捷":3}}]} ← 持续时间必须为“X分钟”，禁止使用"min/分钟数值"\n\n[✅ 正确示例：修改当前值（消耗/恢复）]\n{"action":"add","key":"角色.属性.精神力.当前","value":-5}\n{"action":"add","key":"角色.属性.生命值.当前","value":10}\n\n[✅ 正确示例：装备上身（标记与槽位）]\n{"action":"set","key":"角色.背包.物品.equip_1739530000_123.已装备","value":true}\n{"action":"set","key":"角色.装备.装备1","value":"equip_1739530000_123"}\n'.trim();function o(e){return[a,r].join("\n\n")}},414:e=>{"use strict";e.exports=Math.round},416:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.hexagon-chart-container[data-v-f62e2650] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n/* 浅色主题 - 金辉仙光 */\n.grid-line[data-v-f62e2650] {\n  fill: none;\n  stroke: var(--color-primary);\n  stroke-width: 1;\n  opacity: 0.2;\n}\n.data-polygon[data-v-f62e2650] {\n  fill: url(#goldGradient);\n  stroke: var(--color-primary);\n  stroke-width: 2.5;\n  filter: drop-shadow(0 0 8px rgba(218, 165, 32, 0.3));\n  transition: all 0.3s ease;\n}\n.data-polygon[data-v-f62e2650]:hover {\n  filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.5));\n}\n.data-point[data-v-f62e2650] {\n  fill: var(--color-accent);\n  stroke: rgba(255, 255, 255, 0.9);\n  stroke-width: 2;\n  filter: drop-shadow(0 0 4px rgba(255, 140, 0, 0.4));\n}\n.data-value-text[data-v-f62e2650] {\n  fill: var(--color-text);\n  font-size: 12px;\n  font-weight: bold;\n  font-family: var(--font-family-serif);\n  text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);\n}\n.label-text[data-v-f62e2650] {\n  fill: var(--color-primary);\n  font-size: 13px;\n  font-weight: 600;\n  font-family: var(--font-family-serif);\n  text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9);\n}\n\n/* 深色主题 - 夜空星辰 */\n[data-theme="dark"] .grid-line[data-v-f62e2650] {\n  stroke: #64b5f6;\n  opacity: 0.4;\n}\n[data-theme="dark"] .data-polygon[data-v-f62e2650] {\n  fill: url(#darkGradient);\n  stroke: #64b5f6;\n}\n[data-theme="dark"] .data-point[data-v-f62e2650] {\n  fill: #ba68c8;\n  stroke: rgba(30, 30, 60, 0.8);\n}\n[data-theme="dark"] .data-value-text[data-v-f62e2650] {\n  fill: #e1e4e8;\n}\n[data-theme="dark"] .label-text[data-v-f62e2650] {\n  fill: #64b5f6;\n}\n',""]);const s=i},453:(e,n,t)=>{"use strict";var a,r=t(9612),o=t(9383),i=t(1237),s=t(9290),l=t(9538),c=t(8068),d=t(9675),u=t(5345),p=t(1514),v=t(8968),f=t(6188),h=t(8002),m=t(5880),g=t(414),b=t(3093),y=Function,x=function(e){try{return y('"use strict"; return ('+e+").constructor;")()}catch(e){}},k=t(5795),w=t(655),_=function(){throw new d},C=k?function(){try{return _}catch(e){try{return k(arguments,"callee").get}catch(e){return _}}}():_,A=t(4039)(),S=t(3628),L=t(1064),E=t(8648),T=t(1002),I=t(76),R={},M="undefined"!=typeof Uint8Array&&S?S(Uint8Array):a,P={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?a:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?a:ArrayBuffer,"%ArrayIteratorPrototype%":A&&S?S([][Symbol.iterator]()):a,"%AsyncFromSyncIteratorPrototype%":a,"%AsyncFunction%":R,"%AsyncGenerator%":R,"%AsyncGeneratorFunction%":R,"%AsyncIteratorPrototype%":R,"%Atomics%":"undefined"==typeof Atomics?a:Atomics,"%BigInt%":"undefined"==typeof BigInt?a:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?a:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?a:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?a:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":o,"%eval%":eval,"%EvalError%":i,"%Float16Array%":"undefined"==typeof Float16Array?a:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?a:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?a:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?a:FinalizationRegistry,"%Function%":y,"%GeneratorFunction%":R,"%Int8Array%":"undefined"==typeof Int8Array?a:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?a:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?a:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":A&&S?S(S([][Symbol.iterator]())):a,"%JSON%":"object"==typeof JSON?JSON:a,"%Map%":"undefined"==typeof Map?a:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&A&&S?S((new Map)[Symbol.iterator]()):a,"%Math%":Math,"%Number%":Number,"%Object%":r,"%Object.getOwnPropertyDescriptor%":k,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?a:Promise,"%Proxy%":"undefined"==typeof Proxy?a:Proxy,"%RangeError%":s,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?a:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?a:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&A&&S?S((new Set)[Symbol.iterator]()):a,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?a:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":A&&S?S(""[Symbol.iterator]()):a,"%Symbol%":A?Symbol:a,"%SyntaxError%":c,"%ThrowTypeError%":C,"%TypedArray%":M,"%TypeError%":d,"%Uint8Array%":"undefined"==typeof Uint8Array?a:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?a:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?a:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?a:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?a:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?a:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?a:WeakSet,"%Function.prototype.call%":I,"%Function.prototype.apply%":T,"%Object.defineProperty%":w,"%Object.getPrototypeOf%":L,"%Math.abs%":p,"%Math.floor%":v,"%Math.max%":f,"%Math.min%":h,"%Math.pow%":m,"%Math.round%":g,"%Math.sign%":b,"%Reflect.getPrototypeOf%":E};if(S)try{null.error}catch(e){var D=S(S(e));P["%Error.prototype%"]=D}var z=function e(n){var t;if("%AsyncFunction%"===n)t=x("async function () {}");else if("%GeneratorFunction%"===n)t=x("function* () {}");else if("%AsyncGeneratorFunction%"===n)t=x("async function* () {}");else if("%AsyncGenerator%"===n){var a=e("%AsyncGeneratorFunction%");a&&(t=a.prototype)}else if("%AsyncIteratorPrototype%"===n){var r=e("%AsyncGenerator%");r&&S&&(t=S(r.prototype))}return P[n]=t,t},N={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$=t(6743),O=t(9957),F=$.call(I,Array.prototype.concat),j=$.call(T,Array.prototype.splice),B=$.call(I,String.prototype.replace),X=$.call(I,String.prototype.slice),U=$.call(I,RegExp.prototype.exec),W=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,q=/\\(\\)?/g,G=function(e,n){var t,a=e;if(O(N,a)&&(a="%"+(t=N[a])[0]+"%"),O(P,a)){var r=P[a];if(r===R&&(r=z(a)),void 0===r&&!n)throw new d("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:t,name:a,value:r}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,n){if("string"!=typeof e||0===e.length)throw new d("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof n)throw new d('"allowMissing" argument must be a boolean');if(null===U(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=function(e){var n=X(e,0,1),t=X(e,-1);if("%"===n&&"%"!==t)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===t&&"%"!==n)throw new c("invalid intrinsic syntax, expected opening `%`");var a=[];return B(e,W,function(e,n,t,r){a[a.length]=t?B(r,q,"$1"):n||e}),a}(e),a=t.length>0?t[0]:"",r=G("%"+a+"%",n),o=r.name,i=r.value,s=!1,l=r.alias;l&&(a=l[0],j(t,F([0,1],l)));for(var u=1,p=!0;u<t.length;u+=1){var v=t[u],f=X(v,0,1),h=X(v,-1);if(('"'===f||"'"===f||"`"===f||'"'===h||"'"===h||"`"===h)&&f!==h)throw new c("property names with quotes must have matching quotes");if("constructor"!==v&&p||(s=!0),O(P,o="%"+(a+="."+v)+"%"))i=P[o];else if(null!=i){if(!(v in i)){if(!n)throw new d("base intrinsic for "+e+" exists, but the property is not available.");return}if(k&&u+1>=t.length){var m=k(i,v);i=(p=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:i[v]}else p=O(i,v),i=i[v];p&&!s&&(P[o]=i)}}return i}},507:(e,n,t)=>{"use strict";var a=t(453),r=t(6556),o=t(8859),i=t(9675),s=a("%Map%",!0),l=r("Map.prototype.get",!0),c=r("Map.prototype.set",!0),d=r("Map.prototype.has",!0),u=r("Map.prototype.delete",!0),p=r("Map.prototype.size",!0);e.exports=!!s&&function(){var e,n={assert:function(e){if(!n.has(e))throw new i("Side channel does not contain "+o(e))},delete:function(n){if(e){var t=u(e,n);return 0===p(e)&&(e=void 0),t}return!1},get:function(n){if(e)return l(e,n)},has:function(n){return!!e&&d(e,n)},set:function(n,t){e||(e=new s),c(e,n,t)}};return n}},540:e=>{"use strict";e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},596:(e,n,t)=>{"use strict";t.d(n,{BI:()=>d,K9:()=>i,MC:()=>c,Wt:()=>s,bB:()=>l,qL:()=>p,qP:()=>r});const a="\n# 觉醒者衍生属性概要\n- 阶段：凡人/未觉醒 → 觉醒(E) → 掌控(D) → 精通(C) → 质变(B) → 突破(A) → 传说(S)\n- 衍生：生命值/精神力/体力/理智值；物理/特殊 攻击与防御\n- 约束：数值仅供参考，实际以叙事与代价为准\n".trim();"\n# 威胁等级标准\n\n总体规则：\n- 使用 F/E/D/C/B/A/S 七级；数值仅为参考，应以叙事与规则为主\n\n分级速查：\n- F级（凡人）：力量/敏捷/体质/意志/魅力/幸运 ∈ [3,7]；典型：普通人类幸存者、溃散士兵；遭遇概率：>50%；建议：单人或基础小队\n- E级（觉醒期）：力量/敏捷/体质 ∈ [5,10]；意志[6,11]；魅力[4,9]；幸运[4,8]；典型：刚觉醒突变者、经验丰富猎人；遭遇概率：≈30%；建议：2-3人谨慎行动，利用其能力不稳定期\n- D级（掌控期）：力量/敏捷/体质 ∈ [8,13]；意志[8,12]；魅力[5,10]；幸运[5,9]；典型：小队领袖觉醒者、中型掠食者；遭遇概率：≈15%；建议：4-6人精英队，针对弱点与环境\n- C级（精通期）：力量/敏捷 ∈ [11,16]；体质[12,17]；意志[10,15]；魅力[6,11]；幸运[6,10]；典型：区域传奇觉醒者、大型建筑级突变生物；遭遇概率：<5%；建议：同级对抗或重火力支援\n- B级（质变期）：力量[14,19]；体质[15,20]；意志[12,17]；魅力[8,13]；幸运[7,12]；典型：规则概念载体、异常地带核心；遭遇概率：≈1%（传闻级）；建议：非数值对抗，识别规则并规避/破解\n- A级（突破期）：力量/敏捷[17,25]；体质[18,26]；意志[14,20]；魅力[10,16]；幸运[8,14]；典型：行走的规则领域、文明灾厄；遭遇概率：<0.1%；建议：文明级应对与特殊手段，在其领域内开辟“规则正常区”\n- S级（传说期）：力量[22,35]；敏捷[22,35]；体质[23,40]；意志[16,25]；魅力[12,20]；幸运[10,18]；典型：世界参数级实体、自我传播的模因死咒；遭遇性质：事件性；建议：非对抗范畴\n\n原生突变生物核心前提：\n- 所有原生突变生物均已跃升为生态链中的致命掠食者。全副武装、训练有素的士兵（F级巅峰）正面遭遇任何“单独行动”的突变生物，都必须倾尽全力方有生机；人类生存依赖绝对火力优势、严密协作与环境利用。\n\n可见性与外观生成约束：\n- 若处于视觉可见范围，必须详述体型轮廓、体表材质（皮毛/鳞片/角质/金属化）、肢体数量与结构、异常器官（触手/眼柄/喷口）、嗅味与声学特征；不得以“不可描述”替代\n- 特殊体型分类用于表达异常：非欧几何/多肢复合/触手簇/分段化/群体寄生/拟态变形/信息载体；可组合使用以体现复杂性\n\n体型-威胁关系核心逻辑：\n- 体型增长通常意味着更强力量、防御与更高生态位，是威胁升级的直观体现\n- 特异“浓缩”进化路径存在：物质载体极小，但与“规则碎片/抽象概念/信息病毒”深绑定；其威胁来自不可理解性与规则干涉力，而非物理质量\n- F级（基础型常见掠食者）：约5-40kg（大型家猫~大型犬）；以数量与基础强化为主；高度特化寄生体/信息感染源仅为初形态，影响有限\n- E级（常见掠食者）：约50-300kg（小马驹~成年熊罴）；若体型仅大型犬，则必须拥有瞬改战局的致命特技（如强效瞬麻毒素/短隐形）\n- D级（中坚威胁）：数吨~十余吨（大型货车/公共汽车）；出现“小体型领域滋扰者”，如锈蚀轨迹甲虫/抑郁信息素蛾蛹；具颠覆小型战场的异能或群体指挥\n- C级（高等掠食者/异化种）：数十吨级（移动房屋/小型建筑）；体型与威胁严重不匹配的“概念载体”明显增多（如注视即石化）\n- B级（霸主）：数百至数千吨级（体育场/小型山丘）；可能完全抛弃巨型形态，成为“规则异常点”，物理形态只是“锚点”（如攻击反弹的仲裁者）\n- A级（天灾）：规模趋近地理特征（山丘/湖泊）；也可能体型浓缩但领域纯粹（擦除色彩的吞噬者/逆生之树）\n- S级（神灾）：超越传统物质概念；可持续干扰全球物理常数，进行规则层级直接篡改\n\n体型-威胁不符补偿规则（强制）：\n- 若体型为“小型/人形”但威胁等级≥B，则必须至少满足3项强化：规则干涉领域/高速或隐匿极端化/强免疫或抗性/群体智慧协作/强制异常状态（石化/恐惧/信息污染）/阶段性爆发（短时极高攻防）\n- 必须在数值与能力上体现：衍生属性、战斗属性与 Mutation 描述需同步增强；弱点需相对稀少且更难触发\n".trim();const r="\n# 物品品质系统（概要）\n- quality：破损/粗糙/普通/精良/稀有/史诗/传说\n- 影响：属性效果/耐久/特殊能力/价值；稀有以上通常具获取限制\n".trim(),o="\n# 好感度与关系（概要）\n- 好感：-100~100；档位：死敌/仇敌/厌恶/中立/友善/朋友/挚友/追随者\n- 变化：依据事件严重性与利益冲突；重大帮助显著+，背叛显著-\n- 维护：长期不互动自然衰减；重大事件触发里程碑变动\n".trim(),i="\n# 突变结晶：价值、掉率与用途\n\n【价值基准（下/中/上/顶级四档）】\n- 基准单位：标准下级结晶（价值 1）\n- 下级结晶：稀有基础资源，流通有限，用于基础药剂与低阶装备。\n- 中级结晶：价值约为 20 下级结晶；核心用于制造“稳定剂”防止代价反噬。\n- 上级结晶：价值约为 500 下级结晶（25中级）；战略资产，用于高阶阵法与突破。\n- 顶级结晶：价值约为 20000 下级结晶（40上级）；传说级神物，基本不存在公开市场价。\n\n【叙事约束（强制）】\n- 稀缺性铁律：结晶（含下级）在叙事中必须体现“难得一见”；禁止随手捡到/路边常见/普通NPC轻易赠予。\n- 获取路径限定：仅允许在高风险遭遇后、专业采集环节成功或高等级任务奖励中出现；低威胁区域（F-E）仅“偶发”出现下级结晶且数量≤1。\n- 交易模式：常规交易必须以物易物（如弹药、药品、净水），结晶仅用于大宗/高阶交易。\n- 数量上限：单次叙事/奖励中下级结晶≤1-2（视上下文风险与任务等级），中级/上级/顶级仅在重大剧情或高等级区域出现。\n- 代价与后果：获得或交易结晶必须伴随明确代价/风险/人际博弈；禁止无代价白给。\n\n【掉落与来源】\n- F级威胁：几乎不掉落（<1%）\n- E级威胁：下级结晶（~5%）\n- D级威胁：下级结晶（~10%），极低概率中级（<1%）\n- C级威胁：中级结晶（~30%），极低概率上级\n- B级威胁：上级结晶（>60%），极低概率顶级\n- A级威胁：必然掉落上级，大概率掉落顶级\n- S级威胁：不可知（理论上必然掉落顶级）\n\n【经济流通】\n- 下级结晶：觉醒者之间的主要货币，可购买弹药、食物、基础服务。\n- 中级结晶：高级交易货币，用于购买载具、精密设备、情报。\n- 上级结晶：势力间的战略储备，用于换取领地、技术、庇护。\n- 顶级结晶：仅存在于传说交易，换取国家级资源或禁忌知识。\n".trim(),s="\n# 区域难度标准 (Region Difficulty Standard)\n\n- 双重分类：类型(I:生物/II:规则) × 威胁等级(🟢🟡🟠🔴⚫)\n- 探索建议：基于标准4人觉醒者小队（精通期1+掌控期3）\n\n| 区域等级 | 威胁下限 | 推荐小队等级 | 预计伤亡率 | 停留时间建议 | 资源期望 | 能量等级(范围) |\n|----------|----------|--------------|------------|--------------|----------|----------------|\n| 🟢绿区   | F-E级    | 觉醒期小队   | <10%       | 无限制       | 贫瘠-中等 | 1-20           |\n| 🟡黄区   | D级      | 掌控期小队   | 10-30%     | 3-7天        | 中等-富饶 | 21-40          |\n| 🟠橙区   | C级      | 精通期带队   | 30-50%     | 1-3天        | 富饶-富矿 | 41-60          |\n| 🔴红区   | B级      | 质变期带队   | 50-80%     | <24小时      | 富矿-秘藏 | 61-80          |\n| ⚫黑区   | A-S级    | 突破期团队   | >80%       | <2小时       | 秘藏-未知 | 81-100         |\n\n【动态难度系数】\n- 夜间：+0.5-1级（视生物习性）\n- 恶劣天气：+0.5级\n- 主场优势（巢穴内）：+1级\n- 充分准备/针对性装备：-0.5-1级\n- 队伍状态（受伤/疲劳）：+0.5-1级\n\n【区域转化预警】\n- 绿→黄：生物数量异常增多，出现D级踪迹\n- 黄→橙：C级领主定居，规则异常初现\n- 橙→红：B级霸主活动，规则扭曲稳定化\n- 红→黑：A级天灾降临，规则改写永久化\n".trim(),l="\n# 衍生属性计算速查（按设定文件）\n\n实体类型：普通人/觉醒者/突变生物/古老实体\n阶段系数：凡人/未觉醒、觉醒期、掌控期、精通期、质变期+（见阶段-威胁标准）\n\n普通人（ordinary_human）：\n- HP = 体质 × 阶段系数 + 5\n- SP = 意志 × 阶段系数\n- ST = (体质 + 力量) × 阶段系数 + 10\n- SAN = 意志 × 阶段系数 + (幸运 ÷ 2) + 15\n- 物理攻击力 = (力量 + 敏捷) × 阶段系数 ÷ 2\n- 特殊攻击力 = 意志 × 0.5\n- 物理防御力 = (体质 + 敏捷) × 阶段系数 ÷ 2\n- 特殊防御力 = 意志 × 阶段系数\n\n觉醒者（awakened_human）：\n- HP = 体质 × 阶段系数 + 10 + 突变修正\n- SP = 意志 × 阶段系数 + 5 + 突变修正\n- ST = (体质 + 力量) × 阶段系数 + 15 + 突变修正\n- SAN = 意志 × 阶段系数 + (幸运 ÷ 2) + 10\n- 物理攻击力 = (力量 + 敏捷) × 阶段系数 ÷ 2 + 突变修正\n- 特殊攻击力 = (意志 + 魅力) × 阶段系数 ÷ 2 + 异能类型修正\n- 物理防御力 = (体质 + 敏捷) × 阶段系数 ÷ 2 + 突变修正\n- 特殊防御力 = 意志 × 阶段系数 + 突变修正\n- 突变调整：相关属性在计算中可视为+2~+4；代价会导致某项上限-20%或恢复速率减半\n\n突变生物（mutated_beast）：\n- HP = 体质 × 阶段系数 × 2 + 20\n- SP = 意志 × 阶段系数\n- ST = (体质 + 力量) × 阶段系数 + 20\n- SAN = 意志 × 阶段系数\n- 物理攻防：以特化器官与天然护甲加成；非核心属性按减半或更低计算\n\n古老实体（ancient_wisps）：\n- HP = 体质 × 阶段系数 + 25（可能受古老弱点制约）\n- SP = 意志 × 阶段系数 × 1.5 + 10\n- ST = (体质 + 力量) × 阶段系数 + 10\n- SAN = 意志 × 阶段系数 × 2 + (幸运 ÷ 2) + 20\n- 物理攻击力 = (力量 + 敏捷) × 阶段系数 ÷ 2 + 古老技艺加成\n- 特殊攻击力 = (意志 + 魅力) × 阶段系数 + 古老规则加成\n- 物理防御力 = (体质 + 敏捷) × 阶段系数 ÷ 2\n- 特殊防御力 = 意志 × 阶段系数 × 1.5\n- 备注：受特定古老规则（诅咒）影响，存在场景性巨大波动\n".trim(),c=a,d=o,u={凡人:{atk_coef:.7,def_coef:.7},未觉醒:{atk_coef:.7,def_coef:.7},觉醒期:{atk_coef:.8,def_coef:.8},掌控期:{atk_coef:1,def_coef:1},精通期:{atk_coef:1.3,def_coef:1.2},质变期:{atk_coef:1.8,def_coef:1.5},突破期:{atk_coef:2.2,def_coef:2},传说期:{atk_coef:3,def_coef:2.5}};function p(e,n,t=0){const a=u[n]||u["觉醒期"],r=(e.力量+e.敏捷)/2*a.atk_coef,o=(e.意志+e.魅力)/2*a.atk_coef,i=(e.体质+e.敏捷)/2*a.def_coef,s=e.意志*a.def_coef,l=1+t;return{物理攻击力:Math.max(1,Math.round(r*l)),特殊攻击力:Math.max(1,Math.round(o*l)),物理防御力:Math.max(1,Math.round(i*l)),特殊防御力:Math.max(1,Math.round(s*l))}}},602:(e,n,t)=>{"use strict";t.d(n,{P2:()=>f});const a=(e,n)=>n.some(n=>e instanceof n);let r,o;const i=new WeakMap,s=new WeakMap,l=new WeakMap;let c={get(e,n,t){if(e instanceof IDBTransaction){if("done"===n)return i.get(e);if("store"===n)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return p(e[n])},set:(e,n,t)=>(e[n]=t,!0),has:(e,n)=>e instanceof IDBTransaction&&("done"===n||"store"===n)||n in e};function d(e){c=e(c)}function u(e){return"function"==typeof e?(n=e,(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...e){return n.apply(v(this),e),p(this.request)}:function(...e){return p(n.apply(v(this),e))}):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const n=new Promise((n,t)=>{const a=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",o),e.removeEventListener("abort",o)},r=()=>{n(),a()},o=()=>{t(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",r),e.addEventListener("error",o),e.addEventListener("abort",o)});i.set(e,n)}(e),a(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,c):e);var n}function p(e){if(e instanceof IDBRequest)return function(e){const n=new Promise((n,t)=>{const a=()=>{e.removeEventListener("success",r),e.removeEventListener("error",o)},r=()=>{n(p(e.result)),a()},o=()=>{t(e.error),a()};e.addEventListener("success",r),e.addEventListener("error",o)});return l.set(n,e),n}(e);if(s.has(e))return s.get(e);const n=u(e);return n!==e&&(s.set(e,n),l.set(n,e)),n}const v=e=>l.get(e);function f(e,n,{blocked:t,upgrade:a,blocking:r,terminated:o}={}){const i=indexedDB.open(e,n),s=p(i);return a&&i.addEventListener("upgradeneeded",e=>{a(p(i.result),e.oldVersion,e.newVersion,p(i.transaction),e)}),t&&i.addEventListener("blocked",e=>t(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}const h=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],g=new Map;function b(e,n){if(!(e instanceof IDBDatabase)||n in e||"string"!=typeof n)return;if(g.get(n))return g.get(n);const t=n.replace(/FromIndex$/,""),a=n!==t,r=m.includes(t);if(!(t in(a?IDBIndex:IDBObjectStore).prototype)||!r&&!h.includes(t))return;const o=async function(e,...n){const o=this.transaction(e,r?"readwrite":"readonly");let i=o.store;return a&&(i=i.index(n.shift())),(await Promise.all([i[t](...n),r&&o.done]))[0]};return g.set(n,o),o}d(e=>({...e,get:(n,t,a)=>b(n,t)||e.get(n,t,a),has:(n,t)=>!!b(n,t)||e.has(n,t)}));const y=["continue","continuePrimaryKey","advance"],x={},k=new WeakMap,w=new WeakMap,_={get(e,n){if(!y.includes(n))return e[n];let t=x[n];return t||(t=x[n]=function(...e){k.set(this,w.get(this)[n](...e))}),t}};async function*C(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;const t=new Proxy(n,_);for(w.set(t,n),l.set(t,v(n));n;)yield t,n=await(k.get(t)||n.continue()),k.delete(t)}function A(e,n){return n===Symbol.asyncIterator&&a(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&a(e,[IDBIndex,IDBObjectStore])}d(e=>({...e,get:(n,t,a)=>A(n,t)?C:e.get(n,t,a),has:(n,t)=>A(n,t)||e.has(n,t)}))},618:(e,n,t)=>{"use strict";t.d(n,{A:()=>f});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o),s=t(4417),l=t.n(s),c=new URL(t(660),t.b),d=new URL(t(1530),t.b),u=i()(r()),p=l()(c),v=l()(d);u.push([e.id,`\n.save-panel[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  padding: 1rem;\n  gap: 1rem;\n  position: relative;\n}\n\n/* 工具栏移除：统一到顶栏动作 */\n\n/* 头部 */\n.panel-header[data-v-37662781] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #bae6fd;\n  flex-shrink: 0;\n}\n.header-left[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.header-icon[data-v-37662781] {\n  font-size: 1.5rem;\n}\n.header-info[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.panel-title[data-v-37662781] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #0369a1;\n}\n.save-subtitle[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #0284c7;\n}\n.header-actions[data-v-37662781] {\n  display: flex;\n  gap: 0.5rem;\n}\n.action-btn[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid #bae6fd;\n  border-radius: 0.5rem;\n  background: white;\n  color: #0369a1;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n\n/* 修复按钮文字被全局样式覆盖的问题 */\n.action-btn .btn-text[data-v-37662781] {\n  display: inline;\n  width: auto;\n  text-align: left;\n  font-size: inherit;\n  color: inherit;\n}\n.action-btn[data-v-37662781]:hover {\n  background: #f0f9ff;\n  border-color: #0284c7;\n}\n.action-btn.primary[data-v-37662781] {\n  background: #0284c7;\n  border-color: #0284c7;\n  color: white;\n}\n.action-btn.primary[data-v-37662781]:hover {\n  background: #0369a1;\n}\n.action-btn[data-v-37662781]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.animate-spin[data-v-37662781] {\n  animation: spin-37662781 1s linear infinite;\n}\n@keyframes spin-37662781 {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 存档容器 */\n.saves-container[data-v-37662781] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 0.5rem 3rem 0.5rem;\n\n  /* 滚动条样式 */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.saves-container[data-v-37662781]::-webkit-scrollbar {\n  width: 8px;\n}\n.saves-container[data-v-37662781]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.saves-container[data-v-37662781]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n  transition: background 0.2s ease;\n}\n.saves-container[data-v-37662781]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n\n/* 区块样式 */\n.current-save-section[data-v-37662781],\n.saves-section[data-v-37662781],\n.operations-section[data-v-37662781] {\n  margin-bottom: 1.5rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #bae6fd;\n  overflow: hidden;\n}\n.section-header[data-v-37662781] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: #f0f9ff;\n  border-bottom: 1px solid #bae6fd;\n}\n.header-actions[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.section-title[data-v-37662781] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #0369a1;\n}\n.saves-count[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #0c4a6e;\n  background: white;\n  padding: 0.25rem 0.75rem;\n  border-radius: 0.5rem;\n  font-weight: 600;\n  border: 1px solid #bae6fd;\n}\n.saves-count.online-badge[data-v-37662781] {\n  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);\n  color: #065f46;\n  border-color: #a7f3d0;\n}\n\n/* 当前存档卡片 */\n.current-save-card[data-v-37662781] {\n  padding: 1.25rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.save-preview[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.save-preview.small[data-v-37662781] {\n  gap: 0.75rem;\n}\n.preview-avatar[data-v-37662781] {\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #0284c7, #0369a1);\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 1.25rem;\n}\n.preview-avatar.small[data-v-37662781] {\n  width: 2.5rem;\n  height: 2.5rem;\n  font-size: 1rem;\n}\n.preview-info[data-v-37662781] {\n  flex: 1;\n}\n.character-name[data-v-37662781] {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #0369a1;\n  margin-bottom: 0.25rem;\n}\n.save-name[data-v-37662781] {\n  font-size: 1rem;\n  font-weight: 700;\n  color: #1e40af;\n  margin-bottom: 0.15rem;\n}\n.character-name-small[data-v-37662781] {\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: #64748b;\n  margin-bottom: 0.15rem;\n}\n.character-details[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.detail-separator[data-v-37662781] {\n  color: #cbd5e1;\n}\n.save-time[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n\n/* 特殊存档说明提示 */\n.save-hint[data-v-37662781] {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  margin-top: 0.25rem;\n  display: inline-block;\n  font-weight: 500;\n}\n.save-hint.auto[data-v-37662781] {\n  background: rgba(16, 185, 129, 0.1);\n  color: #059669;\n  border: 1px solid rgba(16, 185, 129, 0.2);\n}\n.save-hint.last[data-v-37662781] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #2563eb;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n\n/* 当前进度的特殊存档说明 */\n.current-save-hint[data-v-37662781] {\n  font-size: 0.875rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 6px;\n  margin-top: 0.75rem;\n  display: block;\n  font-weight: 500;\n  line-height: 1.5;\n}\n.current-save-hint.auto[data-v-37662781] {\n  background: rgba(16, 185, 129, 0.1);\n  color: #059669;\n  border-left: 3px solid #10b981;\n}\n.current-save-hint.last[data-v-37662781] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #2563eb;\n  border-left: 3px solid #3b82f6;\n}\n.save-stats[data-v-37662781] {\n  display: flex;\n  gap: 2rem;\n}\n.stat-item[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.stat-label[data-v-37662781] {\n  font-size: 0.75rem;\n  color: #64748b;\n  font-weight: 500;\n}\n.stat-value[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #0369a1;\n  font-weight: 600;\n}\n\n/* 存档列表 */\n.loading-state[data-v-37662781],\n.empty-state[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n}\n.loading-spinner[data-v-37662781],\n.empty-icon[data-v-37662781] {\n  font-size: 2rem;\n  margin-bottom: 0.5rem;\n}\n.loading-text[data-v-37662781],\n.empty-text[data-v-37662781] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #0369a1;\n  margin-bottom: 0.5rem;\n}\n.empty-hint[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.saves-list[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  padding: 1rem;\n}\n.save-card[data-v-37662781] {\n  border: 1px solid #e0f2fe;\n  border-radius: 0.5rem;\n  background: #f8fafc;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.save-card[data-v-37662781]:hover {\n  background: #f0f9ff;\n  border-color: #bae6fd;\n  transform: translateY(-1px);\n}\n.save-card.active[data-v-37662781] {\n  background: #e0f2fe;\n  border-color: #0284c7;\n}\n.card-header[data-v-37662781] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  border-bottom: 1px solid #e0f2fe;\n}\n.card-actions[data-v-37662781] {\n  display: flex;\n  gap: 0.5rem;\n}\n.card-btn[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2rem;\n  height: 2rem;\n  border: 1px solid #bae6fd;\n  border-radius: 0.375rem;\n  background: white;\n  color: #0284c7;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.card-btn[data-v-37662781]:hover {\n  background: #f0f9ff;\n  border-color: #0284c7;\n}\n.card-btn[data-v-37662781]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.card-btn.primary[data-v-37662781] {\n  color: #10b981;\n  border-color: #d1fae5;\n}\n.card-btn.primary[data-v-37662781]:hover {\n  background: #f0fdf4;\n  border-color: #10b981;\n}\n.card-btn.danger[data-v-37662781] {\n  color: #ef4444;\n  border-color: #fecaca;\n}\n.card-btn.danger[data-v-37662781]:hover {\n  background: #fef2f2;\n  border-color: #ef4444;\n}\n.card-btn.warning[data-v-37662781] {\n  color: #f59e0b;\n  border-color: #fef3c7;\n}\n.card-btn.warning[data-v-37662781]:hover {\n  background: #fffbeb;\n  border-color: #f59e0b;\n}\n.card-btn.info[data-v-37662781] {\n  color: #0284c7;\n  border-color: #bae6fd;\n}\n.card-btn.info[data-v-37662781]:hover {\n  background: #f0f9ff;\n  border-color: #0284c7;\n}\n\n/* 新建存档按钮 */\n.new-save-btn[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2rem;\n  height: 2rem;\n  border: 1px solid #10b981;\n  border-radius: 0.375rem;\n  background: white;\n  color: #10b981;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.new-save-btn[data-v-37662781]:hover {\n  background: #f0fdf4;\n  border-color: #059669;\n  color: #059669;\n}\n.new-save-btn[data-v-37662781]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.card-content[data-v-37662781] {\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.save-details[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.detail-row[data-v-37662781] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.875rem;\n}\n.detail-label[data-v-37662781] {\n  color: #64748b;\n}\n.detail-value[data-v-37662781] {\n  color: #0369a1;\n  font-weight: 500;\n}\n\n/* 操作列表 */\n.operations-list[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.operation-btn[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border-radius: 0.5rem;\n}\n.operation-btn[data-v-37662781]:hover {\n  background: #f0f9ff;\n}\n.operation-btn.primary[data-v-37662781] {\n  background: linear-gradient(135deg, #0369a1 0%, #0284c7 100%);\n  color: white;\n}\n.operation-btn.primary[data-v-37662781]:hover {\n  background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(3, 105, 161, 0.3);\n}\n.operation-btn.primary .btn-title[data-v-37662781],\n.operation-btn.primary .btn-desc[data-v-37662781] {\n  color: white;\n}\n.operation-btn.warning[data-v-37662781] {\n  color: #f59e0b;\n}\n.operation-btn.warning[data-v-37662781]:hover {\n  background: #fffbeb;\n}\n.operation-btn.warning .btn-title[data-v-37662781] {\n  color: #d97706;\n}\n.operation-btn.danger[data-v-37662781]:hover {\n  background: #fef2f2;\n  color: #ef4444;\n}\n.operation-btn[data-v-37662781]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-content[data-v-37662781] {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 0.25rem;\n}\n.btn-title[data-v-37662781] {\n  font-weight: 500;\n  color: #0369a1;\n}\n.btn-desc[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.operation-btn.danger .btn-title[data-v-37662781] {\n  color: #ef4444;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.save-stats[data-v-37662781] {\n    gap: 1rem;\n}\n.card-header[data-v-37662781] {\n    flex-direction: column;\n    gap: 1rem;\n    align-items: stretch;\n}\n.save-preview[data-v-37662781] {\n    justify-content: center;\n}\n.card-actions[data-v-37662781] {\n    justify-content: center;\n}\n.header-actions[data-v-37662781] {\n    flex-wrap: wrap;\n}\n.header-actions .action-btn[data-v-37662781] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.75rem;\n}\n.header-actions .btn-text[data-v-37662781] {\n    display: inline;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .save-panel[data-v-37662781] {\n  background: var(--color-background);\n}\n[data-theme='dark'] .panel-header[data-v-37662781],\n[data-theme='dark'] .current-save-section[data-v-37662781],\n[data-theme='dark'] .saves-section[data-v-37662781],\n[data-theme='dark'] .operations-section[data-v-37662781] {\n  background: #1e293b;\n  border-color: #475569;\n}\n\n/* 存档名图标样式 */\n.auto-save-icon[data-v-37662781],\n.last-save-icon[data-v-37662781] {\n  display: inline-block;\n  margin-right: 0.25rem;\n  vertical-align: middle;\n}\n.auto-save-icon[data-v-37662781] {\n  color: #10b981;\n}\n.last-save-icon[data-v-37662781] {\n  color: #3b82f6;\n}\n[data-theme='dark'] .section-header[data-v-37662781] {\n  background: #334155;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .panel-title[data-v-37662781],\n[data-theme='dark'] .section-title[data-v-37662781],\n[data-theme='dark'] .character-name[data-v-37662781],\n[data-theme='dark'] .save-name[data-v-37662781] {\n  color: #0ea5e9;\n}\n[data-theme='dark'] .character-name-small[data-v-37662781] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .save-subtitle[data-v-37662781],\n[data-theme='dark'] .saves-count[data-v-37662781] {\n  color: #38bdf8;\n}\n[data-theme='dark'] .saves-count.online-badge[data-v-37662781] {\n  background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);\n  color: #6ee7b7;\n  border-color: rgba(16, 185, 129, 0.4);\n}\n[data-theme='dark'] .action-btn[data-v-37662781],\n[data-theme='dark'] .card-btn[data-v-37662781] {\n  background: #374151;\n  border-color: #475569;\n  color: #0ea5e9;\n}\n[data-theme='dark'] .action-btn[data-v-37662781]:hover,\n[data-theme='dark'] .card-btn[data-v-37662781]:hover {\n  background: #4b5563;\n}\n[data-theme='dark'] .card-btn.primary[data-v-37662781] {\n  color: #10b981;\n  border-color: #065f46;\n}\n[data-theme='dark'] .card-btn.primary[data-v-37662781]:hover {\n  background: #065f46;\n}\n[data-theme='dark'] .card-btn.warning[data-v-37662781] {\n  color: #f59e0b;\n  border-color: #78350f;\n}\n[data-theme='dark'] .card-btn.warning[data-v-37662781]:hover {\n  background: #78350f;\n}\n[data-theme='dark'] .card-btn.info[data-v-37662781] {\n  color: #0ea5e9;\n  border-color: #0c4a6e;\n}\n[data-theme='dark'] .card-btn.info[data-v-37662781]:hover {\n  background: #0c4a6e;\n}\n[data-theme='dark'] .new-save-btn[data-v-37662781] {\n  background: #374151;\n  border-color: #10b981;\n  color: #10b981;\n}\n[data-theme='dark'] .new-save-btn[data-v-37662781]:hover {\n  background: #065f46;\n  border-color: #059669;\n}\n[data-theme='dark'] .save-card[data-v-37662781] {\n  background: #374151;\n  border-color: #4b5563;\n}\n[data-theme='dark'] .save-card[data-v-37662781]:hover {\n  background: #4b5563;\n}\n[data-theme='dark'] .save-card.active[data-v-37662781] {\n  background: #1e40af;\n  border-color: #0ea5e9;\n}\n[data-theme='dark'] .operation-btn[data-v-37662781]:hover {\n  background: #374151;\n}\n[data-theme='dark'] .btn-title[data-v-37662781] {\n  color: #e5e7eb;\n}\n\n/* 自动存档设置 */\n.auto-save-settings-section[data-v-37662781] {\n  margin-bottom: 1.5rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #bae6fd;\n  overflow: hidden;\n}\n.settings-list[data-v-37662781] {\n  padding: 0.5rem;\n}\n.setting-item[data-v-37662781] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-radius: 0.5rem;\n  transition: background 0.2s ease;\n}\n.setting-item[data-v-37662781]:hover {\n  background: #f8fafc;\n}\n.setting-info[data-v-37662781] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.setting-name[data-v-37662781] {\n  font-weight: 500;\n  color: #1e293b;\n}\n.setting-desc[data-v-37662781] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.setting-control[data-v-37662781] {\n  display: flex;\n  align-items: center;\n}\n\n/* 开关样式 */\n.setting-switch[data-v-37662781] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n}\n.setting-switch input[data-v-37662781] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.switch-slider[data-v-37662781] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.switch-slider[data-v-37662781]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .switch-slider[data-v-37662781] {\n  background-color: #3b82f6;\n}\ninput:checked + .switch-slider[data-v-37662781]:before {\n  transform: translateX(20px);\n}\n\n/* 下拉选择框样式 */\n.setting-select[data-v-37662781] {\n  padding: 0.5rem 2rem 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background-color: white;\n  background-image: url(${p});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 12px;\n  color: #374151;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: border-color 0.2s ease;\n  appearance: none;\n  min-width: 120px;\n}\n.setting-select[data-v-37662781]:hover {\n  border-color: #94a3b8;\n}\n.setting-select[data-v-37662781]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n[data-theme='dark'] .auto-save-settings-section[data-v-37662781] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme='dark'] .setting-item[data-v-37662781]:hover {\n  background: #334155;\n}\n[data-theme='dark'] .setting-name[data-v-37662781] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .setting-desc[data-v-37662781] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .switch-slider[data-v-37662781] {\n  background-color: #4b5563;\n}\n[data-theme='dark'] .setting-select[data-v-37662781] {\n  background-color: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n  background-image: url(${v});\n}\n.interval-input[data-v-37662781] {\n  width: 60px;\n  padding: 0.5rem;\n  border-radius: 8px;\n  border: 1px solid #d1d5db;\n  text-align: center;\n  margin-right: 0.5rem;\n}\n.unit-label[data-v-37662781] {\n  color: #64748b;\n}\n[data-theme='dark'] .interval-input[data-v-37662781] {\n  background-color: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .unit-label[data-v-37662781] {\n  color: #94a3b8;\n}\n`,""]);const f=u},625:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-87e1862c] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  animation: fadeIn-87e1862c 0.2s ease-out;\n}\n@keyframes fadeIn-87e1862c {\nfrom {\n    opacity: 0;\n}\nto {\n    opacity: 1;\n}\n}\n.modal-content[data-v-87e1862c] {\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n  border: 1px solid rgba(255, 215, 0, 0.3);\n  border-radius: 12px;\n  width: 90%;\n  max-width: 500px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n  animation: slideUp-87e1862c 0.3s ease-out;\n}\n@keyframes slideUp-87e1862c {\nfrom {\n    transform: translateY(20px);\n    opacity: 0;\n}\nto {\n    transform: translateY(0);\n    opacity: 1;\n}\n}\n.modal-header[data-v-87e1862c] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px;\n  border-bottom: 1px solid rgba(255, 215, 0, 0.2);\n}\n.modal-header h3[data-v-87e1862c] {\n  margin: 0;\n  font-size: 1.25rem;\n  color: #ffd700;\n  font-weight: 600;\n}\n.close-btn[data-v-87e1862c] {\n  background: none;\n  border: none;\n  font-size: 2rem;\n  color: #999;\n  cursor: pointer;\n  line-height: 1;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.close-btn[data-v-87e1862c]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #fff;\n}\n.modal-body[data-v-87e1862c] {\n  padding: 24px;\n}\n.hint[data-v-87e1862c] {\n  margin: 0 0 12px 0;\n  color: #ccc;\n  font-size: 0.95rem;\n}\n.prompt-input[data-v-87e1862c] {\n  width: 100%;\n  padding: 12px;\n  border: 1px solid rgba(255, 215, 0, 0.3);\n  border-radius: 8px;\n  background: rgba(0, 0, 0, 0.3);\n  color: #fff;\n  font-size: 0.95rem;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 120px;\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n.prompt-input[data-v-87e1862c]:focus {\n  outline: none;\n  border-color: #ffd700;\n  box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);\n}\n.prompt-input[data-v-87e1862c]::placeholder {\n  color: #666;\n}\n.modal-footer[data-v-87e1862c] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding: 16px 24px;\n  border-top: 1px solid rgba(255, 215, 0, 0.2);\n}\n.cancel-btn[data-v-87e1862c],\n.submit-btn[data-v-87e1862c] {\n  padding: 10px 24px;\n  border-radius: 6px;\n  font-size: 0.95rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  border: none;\n}\n.cancel-btn[data-v-87e1862c] {\n  background: rgba(255, 255, 255, 0.1);\n  color: #ccc;\n}\n.cancel-btn[data-v-87e1862c]:hover {\n  background: rgba(255, 255, 255, 0.15);\n  color: #fff;\n}\n.submit-btn[data-v-87e1862c] {\n  background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);\n  color: #1a1a2e;\n  font-weight: 600;\n}\n.submit-btn[data-v-87e1862c]:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);\n}\n.submit-btn[data-v-87e1862c]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n",""]);const s=i},628:(e,n,t)=>{"use strict";t.d(n,{BE:()=>o,_4:()=>s,xF:()=>i});var a=t(2543),r=t(5835);const o=2,i=e=>{const n={needed:!1,fromVersion:0,toVersion:o,reasons:[]};if(!e)return n;const t=e.社交?.势力??null,a=null!==t&&"object"==typeof t&&0===Object.keys(t).length,r=!!t?.成员信息?.宗门名称,i=null!==t&&!a&&t.版本!==o;if((!t||a)&&!r)return n;const s="number"==typeof t?.版本?t.版本:0;return n.fromVersion=s,r&&!t?.当前势力&&n.reasons.push("玩家势力信息未同步到势力系统"),i&&n.reasons.push("势力系统版本不匹配"),n.needed=n.reasons.length>0,n},s=e=>{const n=(0,a.cloneDeep)(e),t=n.世界?.信息??null,i=Array.isArray(t?.势力信息)?t.势力信息:[],s=(0,r.c3)((0,a.cloneDeep)(i));t?.势力信息&&(t.势力信息=s);const l=n.社交?.势力??n.社交?.宗门??null,c="number"==typeof l?.版本?l.版本:0;return n.社交&&"object"==typeof n.社交||(n.社交={}),n.社交.势力=((e,n,t)=>{const a=e.社交?.势力??e.社交?.宗门??{},r={};n.forEach(e=>{e?.名称&&(r[e.名称]=e)});const i=a?.成员信息?.势力名称??a?.成员信息?.宗门名称??null,s=(e=>{const n={},t=e.社交?.关系??{};return Object.entries(t).forEach(([e,t])=>{if(!t||"object"!=typeof t)return;const a=t.势力归属||t.宗门||t.势力;if(!a)return;const r=t.名字||e;n[a]||(n[a]=[]),n[a].includes(r)||n[a].push(r)}),n})(e);return{...a,版本:o,当前势力:a?.当前势力??i??null,势力档案:{...r,...a.势力档案||a.宗门档案||{}},势力成员:a.势力成员??a.宗门成员??s,势力功法库:a.势力功法库??a.宗门藏经阁??{},势力贡献商店:a.势力贡献商店??a.宗门贡献商店??{},势力任务:a.势力任务??a.宗门任务??{},势力任务状态:a.势力任务状态??a.宗门任务状态??{},迁移记录:{来源版本:t,目标版本:o,时间:(new Date).toISOString(),说明:"由旧版宗门字段迁移生成（写入势力系统）"}}})(n,s,c),n}},641:(e,n,t)=>{"use strict";t.d(n,{$V:()=>oe,$u:()=>ke,$y:()=>Re,CE:()=>tt,Df:()=>Z,EW:()=>Nt,FK:()=>Gn,Fv:()=>pt,Gt:()=>an,Gy:()=>X,Im:()=>$,K9:()=>Cn,Lk:()=>lt,MZ:()=>J,OW:()=>Q,PR:()=>le,PS:()=>on,Q3:()=>vt,QP:()=>W,RG:()=>ze,WQ:()=>rn,Wv:()=>at,bF:()=>ct,bo:()=>S,dY:()=>h,eW:()=>ut,g2:()=>Te,h:()=>$t,hi:()=>_e,k6:()=>A,n:()=>de,nI:()=>wt,nT:()=>Mn,pI:()=>De,pM:()=>ee,pR:()=>H,qG:()=>Le,qL:()=>i,sV:()=>ye,uX:()=>Jn,v6:()=>gt,wB:()=>Pn,xo:()=>we});var a=t(953),r=t(33);function o(e,n,t,a){try{return a?e(...a):e()}catch(e){s(e,n,t)}}function i(e,n,t,a){if((0,r.Tn)(e)){const i=o(e,n,t,a);return i&&(0,r.yL)(i)&&i.catch(e=>{s(e,n,t)}),i}if((0,r.cy)(e)){const r=[];for(let o=0;o<e.length;o++)r.push(i(e[o],n,t,a));return r}}function s(e,n,t,i=!0){n&&n.vnode;const{errorHandler:s,throwUnhandledErrorInProduction:l}=n&&n.appContext.config||r.MZ;if(n){let r=n.parent;const i=n.proxy,l=`https://vuejs.org/error-reference/#runtime-${t}`;for(;r;){const n=r.ec;if(n)for(let t=0;t<n.length;t++)if(!1===n[t](e,i,l))return;r=r.parent}if(s)return(0,a.C4)(),o(s,null,10,[e,i,l]),void(0,a.bl)()}!function(e,n,t,a=!0,r=!1){if(r)throw e;console.error(e)}(e,0,0,i,l)}const l=[];let c=-1;const d=[];let u=null,p=0;const v=Promise.resolve();let f=null;function h(e){const n=f||v;return e?n.then(this?e.bind(this):e):n}function m(e){if(!(1&e.flags)){const n=x(e),t=l[l.length-1];!t||!(2&e.flags)&&n>=x(t)?l.push(e):l.splice(function(e){let n=c+1,t=l.length;for(;n<t;){const a=n+t>>>1,r=l[a],o=x(r);o<e||o===e&&2&r.flags?n=a+1:t=a}return n}(n),0,e),e.flags|=1,g()}}function g(){f||(f=v.then(k))}function b(e,n,t=c+1){for(;t<l.length;t++){const n=l[t];if(n&&2&n.flags){if(e&&n.id!==e.uid)continue;l.splice(t,1),t--,4&n.flags&&(n.flags&=-2),n(),4&n.flags||(n.flags&=-2)}}}function y(e){if(d.length){const e=[...new Set(d)].sort((e,n)=>x(e)-x(n));if(d.length=0,u)return void u.push(...e);for(u=e,p=0;p<u.length;p++){const e=u[p];4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}u=null,p=0}}const x=e=>null==e.id?2&e.flags?-1:1/0:e.id;function k(e){r.tE;try{for(c=0;c<l.length;c++){const e=l[c];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),o(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;c<l.length;c++){const e=l[c];e&&(e.flags&=-2)}c=-1,l.length=0,y(),f=null,(l.length||d.length)&&k(e)}}let w=null,_=null;function C(e){const n=w;return w=e,_=e&&e.type.__scopeId||null,n}function A(e,n=w,t){if(!n)return e;if(e._n)return e;const a=(...t)=>{a._d&&et(-1);const r=C(n);let o;try{o=e(...t)}finally{C(r),a._d&&et(1)}return o};return a._n=!0,a._c=!0,a._d=!0,a}function S(e,n){if(null===w)return e;const t=Dt(w),o=e.dirs||(e.dirs=[]);for(let e=0;e<n.length;e++){let[i,s,l,c=r.MZ]=n[e];i&&((0,r.Tn)(i)&&(i={mounted:i,updated:i}),i.deep&&(0,a.hV)(s),o.push({dir:i,instance:t,value:s,oldValue:void 0,arg:l,modifiers:c}))}return e}function L(e,n,t,r){const o=e.dirs,s=n&&n.dirs;for(let l=0;l<o.length;l++){const c=o[l];s&&(c.oldValue=s[l].value);let d=c.dir[r];d&&((0,a.C4)(),i(d,t,8,[e.el,c,e,n]),(0,a.bl)())}}const E=Symbol("_vte"),T=e=>e.__isTeleport,I=e=>e&&(e.disabled||""===e.disabled),R=e=>e&&(e.defer||""===e.defer),M=e=>"undefined"!=typeof SVGElement&&e instanceof SVGElement,P=e=>"function"==typeof MathMLElement&&e instanceof MathMLElement,D=(e,n)=>{const t=e&&e.to;return(0,r.Kg)(t)?n?n(t):null:t},z={name:"Teleport",__isTeleport:!0,process(e,n,t,a,r,o,i,s,l,c){const{mc:d,pc:u,pbc:p,o:{insert:v,querySelector:f,createText:h,createComment:m}}=c,g=I(n.props);let{shapeFlag:b,children:y,dynamicChildren:x}=n;if(null==e){const e=n.el=h(""),c=n.anchor=h("");v(e,t,a),v(c,t,a);const u=(e,n)=>{16&b&&(r&&r.isCE&&(r.ce._teleportTarget=e),d(y,e,n,r,o,i,s,l))},p=()=>{const e=n.target=D(n.props,f),t=F(e,n,h,v);e&&("svg"!==i&&M(e)?i="svg":"mathml"!==i&&P(e)&&(i="mathml"),g||(u(e,t),O(n,!1)))};g&&(u(t,c),O(n,!0)),R(n.props)?(n.el.__isMounted=!1,_n(()=>{p(),delete n.el.__isMounted},o)):p()}else{if(R(n.props)&&!1===e.el.__isMounted)return void _n(()=>{z.process(e,n,t,a,r,o,i,s,l,c)},o);n.el=e.el,n.targetStart=e.targetStart;const d=n.anchor=e.anchor,v=n.target=e.target,h=n.targetAnchor=e.targetAnchor,m=I(e.props),b=m?t:v,y=m?d:h;if("svg"===i||M(v)?i="svg":("mathml"===i||P(v))&&(i="mathml"),x?(p(e.dynamicChildren,x,b,r,o,i,s),Ln(e,n,!0)):l||u(e,n,b,y,r,o,i,s,!1),g)m?n.props&&e.props&&n.props.to!==e.props.to&&(n.props.to=e.props.to):N(n,t,d,c,1);else if((n.props&&n.props.to)!==(e.props&&e.props.to)){const e=n.target=D(n.props,f);e&&N(n,e,null,c,0)}else m&&N(n,v,h,c,1);O(n,g)}},remove(e,n,t,{um:a,o:{remove:r}},o){const{shapeFlag:i,children:s,anchor:l,targetStart:c,targetAnchor:d,target:u,props:p}=e;if(u&&(r(c),r(d)),o&&r(l),16&i){const e=o||!I(p);for(let r=0;r<s.length;r++){const o=s[r];a(o,n,t,e,!!o.dynamicChildren)}}},move:N,hydrate:function(e,n,t,a,r,o,{o:{nextSibling:i,parentNode:s,querySelector:l,insert:c,createText:d}},u){const p=n.target=D(n.props,l);if(p){const l=I(n.props),v=p._lpa||p.firstChild;if(16&n.shapeFlag)if(l)n.anchor=u(i(e),n,s(e),t,a,r,o),n.targetStart=v,n.targetAnchor=v&&i(v);else{n.anchor=i(e);let s=v;for(;s;){if(s&&8===s.nodeType)if("teleport start anchor"===s.data)n.targetStart=s;else if("teleport anchor"===s.data){n.targetAnchor=s,p._lpa=n.targetAnchor&&i(n.targetAnchor);break}s=i(s)}n.targetAnchor||F(p,n,d,c),u(v&&i(v),n,p,t,a,r,o)}O(n,l)}return n.anchor&&i(n.anchor)}};function N(e,n,t,{o:{insert:a},m:r},o=2){0===o&&a(e.targetAnchor,n,t);const{el:i,anchor:s,shapeFlag:l,children:c,props:d}=e,u=2===o;if(u&&a(i,n,t),(!u||I(d))&&16&l)for(let e=0;e<c.length;e++)r(c[e],n,t,2);u&&a(s,n,t)}const $=z;function O(e,n){const t=e.ctx;if(t&&t.ut){let a,r;for(n?(a=e.el,r=e.anchor):(a=e.targetStart,r=e.targetAnchor);a&&a!==r;)1===a.nodeType&&a.setAttribute("data-v-owner",t.uid),a=a.nextSibling;t.ut()}}function F(e,n,t,a){const r=n.targetStart=t(""),o=n.targetAnchor=t("");return r[E]=o,e&&(a(r,e),a(o,e)),o}const j=Symbol("_leaveCb"),B=Symbol("_enterCb");function X(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ye(()=>{e.isMounted=!0}),we(()=>{e.isUnmounting=!0}),e}const U=[Function,Array],W={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:U,onEnter:U,onAfterEnter:U,onEnterCancelled:U,onBeforeLeave:U,onLeave:U,onAfterLeave:U,onLeaveCancelled:U,onBeforeAppear:U,onAppear:U,onAfterAppear:U,onAppearCancelled:U},q=e=>{const n=e.subTree;return n.component?q(n.component):n};function G(e){let n=e[0];if(e.length>1){let t=!1;for(const a of e)if(a.type!==Vn){n=a,t=!0;break}}return n}const H={name:"BaseTransition",props:W,setup(e,{slots:n}){const t=wt(),r=X();return()=>{const o=n.default&&Z(n.default(),!0);if(!o||!o.length)return;const i=G(o),s=(0,a.ux)(e),{mode:l}=s;if(r.isLeaving)return K(i);const c=Y(i);if(!c)return K(i);let d=Q(c,s,r,t,e=>d=e);c.type!==Vn&&J(c,d);let u=t.subTree&&Y(t.subTree);if(u&&u.type!==Vn&&!ot(c,u)&&q(t).type!==Vn){let e=Q(u,s,r,t);if(J(u,e),"out-in"===l&&c.type!==Vn)return r.isLeaving=!0,e.afterLeave=()=>{r.isLeaving=!1,8&t.job.flags||t.update(),delete e.afterLeave,u=void 0},K(i);"in-out"===l&&c.type!==Vn?e.delayLeave=(e,n,t)=>{V(r,u)[String(u.key)]=u,e[j]=()=>{n(),e[j]=void 0,delete d.delayedLeave,u=void 0},d.delayedLeave=()=>{t(),delete d.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function V(e,n){const{leavingVNodes:t}=e;let a=t.get(n.type);return a||(a=Object.create(null),t.set(n.type,a)),a}function Q(e,n,t,a,o){const{appear:s,mode:l,persisted:c=!1,onBeforeEnter:d,onEnter:u,onAfterEnter:p,onEnterCancelled:v,onBeforeLeave:f,onLeave:h,onAfterLeave:m,onLeaveCancelled:g,onBeforeAppear:b,onAppear:y,onAfterAppear:x,onAppearCancelled:k}=n,w=String(e.key),_=V(t,e),C=(e,n)=>{e&&i(e,a,9,n)},A=(e,n)=>{const t=n[1];C(e,n),(0,r.cy)(e)?e.every(e=>e.length<=1)&&t():e.length<=1&&t()},S={mode:l,persisted:c,beforeEnter(n){let a=d;if(!t.isMounted){if(!s)return;a=b||d}n[j]&&n[j](!0);const r=_[w];r&&ot(e,r)&&r.el[j]&&r.el[j](),C(a,[n])},enter(e){let n=u,a=p,r=v;if(!t.isMounted){if(!s)return;n=y||u,a=x||p,r=k||v}let o=!1;const i=e[B]=n=>{o||(o=!0,C(n?r:a,[e]),S.delayedLeave&&S.delayedLeave(),e[B]=void 0)};n?A(n,[e,i]):i()},leave(n,a){const r=String(e.key);if(n[B]&&n[B](!0),t.isUnmounting)return a();C(f,[n]);let o=!1;const i=n[j]=t=>{o||(o=!0,a(),C(t?g:m,[n]),n[j]=void 0,_[r]===e&&delete _[r])};_[r]=e,h?A(h,[n,i]):i()},clone(e){const r=Q(e,n,t,a,o);return o&&o(r),r}};return S}function K(e){if(se(e))return(e=dt(e)).children=null,e}function Y(e){if(!se(e))return T(e.type)&&e.children?G(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:n,children:t}=e;if(t){if(16&n)return t[0];if(32&n&&(0,r.Tn)(t.default))return t.default()}}function J(e,n){6&e.shapeFlag&&e.component?(e.transition=n,J(e.component.subTree,n)):128&e.shapeFlag?(e.ssContent.transition=n.clone(e.ssContent),e.ssFallback.transition=n.clone(e.ssFallback)):e.transition=n}function Z(e,n=!1,t){let a=[],r=0;for(let o=0;o<e.length;o++){let i=e[o];const s=null==t?i.key:String(t)+String(null!=i.key?i.key:o);i.type===Gn?(128&i.patchFlag&&r++,a=a.concat(Z(i.children,n,s))):(n||i.type!==Vn)&&a.push(null!=s?dt(i,{key:s}):i)}if(r>1)for(let e=0;e<a.length;e++)a[e].patchFlag=-2;return a}function ee(e,n){return(0,r.Tn)(e)?(()=>(0,r.X$)({name:e.name},n,{setup:e}))():e}function ne(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function te(e,n,t,i,s=!1){if((0,r.cy)(e))return void e.forEach((e,a)=>te(e,n&&((0,r.cy)(n)?n[a]:n),t,i,s));if(re(i)&&!s)return void(512&i.shapeFlag&&i.type.__asyncResolved&&i.component.subTree.component&&te(e,n,t,i.component.subTree));const l=4&i.shapeFlag?Dt(i.component):i.el,c=s?null:l,{i:d,r:u}=e,p=n&&n.r,v=d.refs===r.MZ?d.refs={}:d.refs,f=d.setupState,h=(0,a.ux)(f),m=f===r.MZ?()=>!1:e=>(0,r.$3)(h,e);if(null!=p&&p!==u&&((0,r.Kg)(p)?(v[p]=null,m(p)&&(f[p]=null)):(0,a.i9)(p)&&(p.value=null)),(0,r.Tn)(u))o(u,d,12,[c,v]);else{const n=(0,r.Kg)(u),o=(0,a.i9)(u);if(n||o){const a=()=>{if(e.f){const t=n?m(u)?f[u]:v[u]:u.value;s?(0,r.cy)(t)&&(0,r.TF)(t,l):(0,r.cy)(t)?t.includes(l)||t.push(l):n?(v[u]=[l],m(u)&&(f[u]=v[u])):(u.value=[l],e.k&&(v[e.k]=u.value))}else n?(v[u]=c,m(u)&&(f[u]=c)):o&&(u.value=c,e.k&&(v[e.k]=c))};c?(a.id=-1,_n(a,t)):a()}}}const ae=e=>8===e.nodeType;(0,r.We)().requestIdleCallback,(0,r.We)().cancelIdleCallback;const re=e=>!!e.type.__asyncLoader;function oe(e){(0,r.Tn)(e)&&(e={loader:e});const{loader:n,loadingComponent:t,errorComponent:o,delay:i=200,hydrate:l,timeout:c,suspensible:d=!0,onError:u}=e;let p,v=null,f=0;const h=()=>{let e;return v||(e=v=n().catch(e=>{if(e=e instanceof Error?e:new Error(String(e)),u)return new Promise((n,t)=>{u(e,()=>n((f++,v=null,h())),()=>t(e),f+1)});throw e}).then(n=>e!==v&&v?v:(n&&(n.__esModule||"Module"===n[Symbol.toStringTag])&&(n=n.default),p=n,n)))};return ee({name:"AsyncComponentWrapper",__asyncLoader:h,__asyncHydrate(e,n,t){let a=!1;(n.bu||(n.bu=[])).push(()=>a=!0);const r=()=>{a||t()},o=l?()=>{const t=l(r,n=>function(e,n){if(ae(e)&&"["===e.data){let t=1,a=e.nextSibling;for(;a;){if(1===a.nodeType){if(!1===n(a))break}else if(ae(a))if("]"===a.data){if(0===--t)break}else"["===a.data&&t++;a=a.nextSibling}}else n(e)}(e,n));t&&(n.bum||(n.bum=[])).push(t)}:r;p?o():h().then(()=>!n.isUnmounted&&o())},get __asyncResolved(){return p},setup(){const e=kt;if(ne(e),p)return()=>ie(p,e);const n=n=>{v=null,s(n,e,13,!o)};if(d&&e.suspense||It)return h().then(n=>()=>ie(n,e)).catch(e=>(n(e),()=>o?ct(o,{error:e}):null));const r=(0,a.KR)(!1),l=(0,a.KR)(),u=(0,a.KR)(!!i);return i&&setTimeout(()=>{u.value=!1},i),null!=c&&setTimeout(()=>{if(!r.value&&!l.value){const e=new Error(`Async component timed out after ${c}ms.`);n(e),l.value=e}},c),h().then(()=>{r.value=!0,e.parent&&se(e.parent.vnode)&&e.parent.update()}).catch(e=>{n(e),l.value=e}),()=>r.value&&p?ie(p,e):l.value&&o?ct(o,{error:l.value}):t&&!u.value?ct(t):void 0}})}function ie(e,n){const{ref:t,props:a,children:r,ce:o}=n.vnode,i=ct(e,a,r);return i.ref=t,i.ce=o,delete n.vnode.ce,i}const se=e=>e.type.__isKeepAlive,le={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:n}){const t=wt(),a=t.ctx;if(!a.renderer)return()=>{const e=n.default&&n.default();return e&&1===e.length?e[0]:e};const o=new Map,i=new Set;let s=null;const l=t.suspense,{renderer:{p:c,m:d,um:u,o:{createElement:p}}}=a,v=p("div");function f(e){fe(e),u(e,t,l,!0)}function h(e){o.forEach((n,t)=>{const a=zt(n.type);a&&!e(a)&&m(t)})}function m(e){const n=o.get(e);!n||s&&ot(n,s)?s&&fe(s):f(n),o.delete(e),i.delete(e)}a.activate=(e,n,t,a,o)=>{const i=e.component;d(e,n,t,0,l),c(i.vnode,e,n,t,i,l,a,e.slotScopeIds,o),_n(()=>{i.isDeactivated=!1,i.a&&(0,r.DY)(i.a);const n=e.props&&e.props.onVnodeMounted;n&&bt(n,i.parent,e)},l)},a.deactivate=e=>{const n=e.component;Tn(n.m),Tn(n.a),d(e,v,null,1,l),_n(()=>{n.da&&(0,r.DY)(n.da);const t=e.props&&e.props.onVnodeUnmounted;t&&bt(t,n.parent,e),n.isDeactivated=!0},l)},Pn(()=>[e.include,e.exclude],([e,n])=>{e&&h(n=>ce(e,n)),n&&h(e=>!ce(n,e))},{flush:"post",deep:!0});let g=null;const b=()=>{null!=g&&(qn(t.subTree.type)?_n(()=>{o.set(g,he(t.subTree))},t.subTree.suspense):o.set(g,he(t.subTree)))};return ye(b),ke(b),we(()=>{o.forEach(e=>{const{subTree:n,suspense:a}=t,r=he(n);if(e.type===r.type&&e.key===r.key){fe(r);const e=r.component.da;return void(e&&_n(e,a))}f(e)})}),()=>{if(g=null,!n.default)return s=null;const t=n.default(),a=t[0];if(t.length>1)return s=null,t;if(!rt(a)||!(4&a.shapeFlag||128&a.shapeFlag))return s=null,a;let r=he(a);if(r.type===Vn)return s=null,r;const l=r.type,c=zt(re(r)?r.type.__asyncResolved||{}:l),{include:d,exclude:u,max:p}=e;if(d&&(!c||!ce(d,c))||u&&c&&ce(u,c))return r.shapeFlag&=-257,s=r,a;const v=null==r.key?l:r.key,f=o.get(v);return r.el&&(r=dt(r),128&a.shapeFlag&&(a.ssContent=r)),g=v,f?(r.el=f.el,r.component=f.component,r.transition&&J(r,r.transition),r.shapeFlag|=512,i.delete(v),i.add(v)):(i.add(v),p&&i.size>parseInt(p,10)&&m(i.values().next().value)),r.shapeFlag|=256,s=r,qn(a.type)?a:r}}};function ce(e,n){return(0,r.cy)(e)?e.some(e=>ce(e,n)):(0,r.Kg)(e)?e.split(",").includes(n):!!(0,r.gd)(e)&&(e.lastIndex=0,e.test(n))}function de(e,n){pe(e,"a",n)}function ue(e,n){pe(e,"da",n)}function pe(e,n,t=kt){const a=e.__wdc||(e.__wdc=()=>{let n=t;for(;n;){if(n.isDeactivated)return;n=n.parent}return e()});if(me(n,a,t),t){let e=t.parent;for(;e&&e.parent;)se(e.parent.vnode)&&ve(a,n,t,e),e=e.parent}}function ve(e,n,t,a){const o=me(n,e,a,!0);_e(()=>{(0,r.TF)(a[n],o)},t)}function fe(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function he(e){return 128&e.shapeFlag?e.ssContent:e}function me(e,n,t=kt,r=!1){if(t){const o=t[e]||(t[e]=[]),s=n.__weh||(n.__weh=(...r)=>{(0,a.C4)();const o=At(t),s=i(n,t,e,r);return o(),(0,a.bl)(),s});return r?o.unshift(s):o.push(s),s}}const ge=e=>(n,t=kt)=>{It&&"sp"!==e||me(e,(...e)=>n(...e),t)},be=ge("bm"),ye=ge("m"),xe=ge("bu"),ke=ge("u"),we=ge("bum"),_e=ge("um"),Ce=ge("sp"),Ae=ge("rtg"),Se=ge("rtc");function Le(e,n=kt){me("ec",e,n)}const Ee="components";function Te(e,n){return Me(Ee,e,!0,n)||e}const Ie=Symbol.for("v-ndc");function Re(e){return(0,r.Kg)(e)?Me(Ee,e,!1)||e:e||Ie}function Me(e,n,t=!0,a=!1){const o=w||kt;if(o){const t=o.type;if(e===Ee){const e=zt(t,!1);if(e&&(e===n||e===(0,r.PT)(n)||e===(0,r.ZH)((0,r.PT)(n))))return t}const i=Pe(o[e]||t[e],n)||Pe(o.appContext[e],n);return!i&&a?t:i}}function Pe(e,n){return e&&(e[n]||e[(0,r.PT)(n)]||e[(0,r.ZH)((0,r.PT)(n))])}function De(e,n,t,o){let i;const s=t&&t[o],l=(0,r.cy)(e);if(l||(0,r.Kg)(e)){let t=!1,r=!1;l&&(0,a.g8)(e)&&(t=!(0,a.fE)(e),r=(0,a.Tm)(e),e=(0,a.qA)(e)),i=new Array(e.length);for(let o=0,l=e.length;o<l;o++)i[o]=n(t?r?(0,a.a1)((0,a.lJ)(e[o])):(0,a.lJ)(e[o]):e[o],o,void 0,s&&s[o])}else if("number"==typeof e){i=new Array(e);for(let t=0;t<e;t++)i[t]=n(t+1,t,void 0,s&&s[t])}else if((0,r.Gv)(e))if(e[Symbol.iterator])i=Array.from(e,(e,t)=>n(e,t,void 0,s&&s[t]));else{const t=Object.keys(e);i=new Array(t.length);for(let a=0,r=t.length;a<r;a++){const r=t[a];i[a]=n(e[r],r,a,s&&s[a])}}else i=[];return t&&(t[o]=i),i}function ze(e,n,t={},a,o){if(w.ce||w.parent&&re(w.parent)&&w.parent.ce)return"default"!==n&&(t.name=n),Jn(),at(Gn,null,[ct("slot",t,a&&a())],64);let i=e[n];i&&i._c&&(i._d=!1),Jn();const s=i&&Ne(i(t)),l=t.key||s&&s.key,c=at(Gn,{key:(l&&!(0,r.Bm)(l)?l:`_${n}`)+(!s&&a?"_fb":"")},s||(a?a():[]),s&&1===e._?64:-2);return!o&&c.scopeId&&(c.slotScopeIds=[c.scopeId+"-s"]),i&&i._c&&(i._d=!0),c}function Ne(e){return e.some(e=>!rt(e)||e.type!==Vn&&!(e.type===Gn&&!Ne(e.children)))?e:null}const $e=e=>e?Lt(e)?Dt(e):$e(e.parent):null,Oe=(0,r.X$)(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>$e(e.parent),$root:e=>$e(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>qe(e),$forceUpdate:e=>e.f||(e.f=()=>{m(e.update)}),$nextTick:e=>e.n||(e.n=h.bind(e.proxy)),$watch:e=>zn.bind(e)}),Fe=(e,n)=>e!==r.MZ&&!e.__isScriptSetup&&(0,r.$3)(e,n),je={get({_:e},n){if("__v_skip"===n)return!0;const{ctx:t,setupState:o,data:i,props:s,accessCache:l,type:c,appContext:d}=e;let u;if("$"!==n[0]){const a=l[n];if(void 0!==a)switch(a){case 1:return o[n];case 2:return i[n];case 4:return t[n];case 3:return s[n]}else{if(Fe(o,n))return l[n]=1,o[n];if(i!==r.MZ&&(0,r.$3)(i,n))return l[n]=2,i[n];if((u=e.propsOptions[0])&&(0,r.$3)(u,n))return l[n]=3,s[n];if(t!==r.MZ&&(0,r.$3)(t,n))return l[n]=4,t[n];Xe&&(l[n]=0)}}const p=Oe[n];let v,f;return p?("$attrs"===n&&(0,a.u4)(e.attrs,"get",""),p(e)):(v=c.__cssModules)&&(v=v[n])?v:t!==r.MZ&&(0,r.$3)(t,n)?(l[n]=4,t[n]):(f=d.config.globalProperties,(0,r.$3)(f,n)?f[n]:void 0)},set({_:e},n,t){const{data:a,setupState:o,ctx:i}=e;return Fe(o,n)?(o[n]=t,!0):a!==r.MZ&&(0,r.$3)(a,n)?(a[n]=t,!0):!((0,r.$3)(e.props,n)||"$"===n[0]&&n.slice(1)in e||(i[n]=t,0))},has({_:{data:e,setupState:n,accessCache:t,ctx:a,appContext:o,propsOptions:i}},s){let l;return!!t[s]||e!==r.MZ&&(0,r.$3)(e,s)||Fe(n,s)||(l=i[0])&&(0,r.$3)(l,s)||(0,r.$3)(a,s)||(0,r.$3)(Oe,s)||(0,r.$3)(o.config.globalProperties,s)},defineProperty(e,n,t){return null!=t.get?e._.accessCache[n]=0:(0,r.$3)(t,"value")&&this.set(e,n,t.value,null),Reflect.defineProperty(e,n,t)}};function Be(e){return(0,r.cy)(e)?e.reduce((e,n)=>(e[n]=null,e),{}):e}let Xe=!0;function Ue(e,n,t){i((0,r.cy)(e)?e.map(e=>e.bind(n.proxy)):e.bind(n.proxy),n,t)}function We(e,n,t,a){let o=a.includes(".")?Nn(t,a):()=>t[a];if((0,r.Kg)(e)){const t=n[e];(0,r.Tn)(t)&&Pn(o,t)}else if((0,r.Tn)(e))Pn(o,e.bind(t));else if((0,r.Gv)(e))if((0,r.cy)(e))e.forEach(e=>We(e,n,t,a));else{const a=(0,r.Tn)(e.handler)?e.handler.bind(t):n[e.handler];(0,r.Tn)(a)&&Pn(o,a,e)}}function qe(e){const n=e.type,{mixins:t,extends:a}=n,{mixins:o,optionsCache:i,config:{optionMergeStrategies:s}}=e.appContext,l=i.get(n);let c;return l?c=l:o.length||t||a?(c={},o.length&&o.forEach(e=>Ge(c,e,s,!0)),Ge(c,n,s)):c=n,(0,r.Gv)(n)&&i.set(n,c),c}function Ge(e,n,t,a=!1){const{mixins:r,extends:o}=n;o&&Ge(e,o,t,!0),r&&r.forEach(n=>Ge(e,n,t,!0));for(const r in n)if(a&&"expose"===r);else{const a=He[r]||t&&t[r];e[r]=a?a(e[r],n[r]):n[r]}return e}const He={data:Ve,props:Je,emits:Je,methods:Ye,computed:Ye,beforeCreate:Ke,created:Ke,beforeMount:Ke,mounted:Ke,beforeUpdate:Ke,updated:Ke,beforeDestroy:Ke,beforeUnmount:Ke,destroyed:Ke,unmounted:Ke,activated:Ke,deactivated:Ke,errorCaptured:Ke,serverPrefetch:Ke,components:Ye,directives:Ye,watch:function(e,n){if(!e)return n;if(!n)return e;const t=(0,r.X$)(Object.create(null),e);for(const a in n)t[a]=Ke(e[a],n[a]);return t},provide:Ve,inject:function(e,n){return Ye(Qe(e),Qe(n))}};function Ve(e,n){return n?e?function(){return(0,r.X$)((0,r.Tn)(e)?e.call(this,this):e,(0,r.Tn)(n)?n.call(this,this):n)}:n:e}function Qe(e){if((0,r.cy)(e)){const n={};for(let t=0;t<e.length;t++)n[e[t]]=e[t];return n}return e}function Ke(e,n){return e?[...new Set([].concat(e,n))]:n}function Ye(e,n){return e?(0,r.X$)(Object.create(null),e,n):n}function Je(e,n){return e?(0,r.cy)(e)&&(0,r.cy)(n)?[...new Set([...e,...n])]:(0,r.X$)(Object.create(null),Be(e),Be(null!=n?n:{})):n}function Ze(){return{app:null,config:{isNativeTag:r.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let en=0;function nn(e,n){return function(t,a=null){(0,r.Tn)(t)||(t=(0,r.X$)({},t)),null==a||(0,r.Gv)(a)||(a=null);const o=Ze(),s=new WeakSet,l=[];let c=!1;const d=o.app={_uid:en++,_component:t,_props:a,_container:null,_context:o,_instance:null,version:Ot,get config(){return o.config},set config(e){},use:(e,...n)=>(s.has(e)||(e&&(0,r.Tn)(e.install)?(s.add(e),e.install(d,...n)):(0,r.Tn)(e)&&(s.add(e),e(d,...n))),d),mixin:e=>(o.mixins.includes(e)||o.mixins.push(e),d),component:(e,n)=>n?(o.components[e]=n,d):o.components[e],directive:(e,n)=>n?(o.directives[e]=n,d):o.directives[e],mount(r,i,s){if(!c){const l=d._ceVNode||ct(t,a);return l.appContext=o,!0===s?s="svg":!1===s&&(s=void 0),i&&n?n(l,r):e(l,r,s),c=!0,d._container=r,r.__vue_app__=d,Dt(l.component)}},onUnmount(e){l.push(e)},unmount(){c&&(i(l,d._instance,16),e(null,d._container),delete d._container.__vue_app__)},provide:(e,n)=>(o.provides[e]=n,d),runWithContext(e){const n=tn;tn=d;try{return e()}finally{tn=n}}};return d}}let tn=null;function an(e,n){if(kt){let t=kt.provides;const a=kt.parent&&kt.parent.provides;a===t&&(t=kt.provides=Object.create(a)),t[e]=n}}function rn(e,n,t=!1){const a=wt();if(a||tn){let o=tn?tn._context.provides:a?null==a.parent||a.ce?a.vnode.appContext&&a.vnode.appContext.provides:a.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return t&&(0,r.Tn)(n)?n.call(a&&a.proxy):n}}function on(){return!(!wt()&&!tn)}const sn={},ln=()=>Object.create(sn),cn=e=>Object.getPrototypeOf(e)===sn;function dn(e,n,t,o){const[i,s]=e.propsOptions;let l,c=!1;if(n)for(let a in n){if((0,r.SU)(a))continue;const d=n[a];let u;i&&(0,r.$3)(i,u=(0,r.PT)(a))?s&&s.includes(u)?(l||(l={}))[u]=d:t[u]=d:jn(e.emitsOptions,a)||a in o&&d===o[a]||(o[a]=d,c=!0)}if(s){const n=(0,a.ux)(t),o=l||r.MZ;for(let a=0;a<s.length;a++){const l=s[a];t[l]=un(i,n,l,o[l],e,!(0,r.$3)(o,l))}}return c}function un(e,n,t,a,o,i){const s=e[t];if(null!=s){const e=(0,r.$3)(s,"default");if(e&&void 0===a){const e=s.default;if(s.type!==Function&&!s.skipFactory&&(0,r.Tn)(e)){const{propsDefaults:r}=o;if(t in r)a=r[t];else{const i=At(o);a=r[t]=e.call(null,n),i()}}else a=e;o.ce&&o.ce._setProp(t,a)}s[0]&&(i&&!e?a=!1:!s[1]||""!==a&&a!==(0,r.Tg)(t)||(a=!0))}return a}const pn=new WeakMap;function vn(e,n,t=!1){const a=t?pn:n.propsCache,o=a.get(e);if(o)return o;const i=e.props,s={},l=[];let c=!1;if(!(0,r.Tn)(e)){const a=e=>{c=!0;const[t,a]=vn(e,n,!0);(0,r.X$)(s,t),a&&l.push(...a)};!t&&n.mixins.length&&n.mixins.forEach(a),e.extends&&a(e.extends),e.mixins&&e.mixins.forEach(a)}if(!i&&!c)return(0,r.Gv)(e)&&a.set(e,r.Oj),r.Oj;if((0,r.cy)(i))for(let e=0;e<i.length;e++){const n=(0,r.PT)(i[e]);fn(n)&&(s[n]=r.MZ)}else if(i)for(const e in i){const n=(0,r.PT)(e);if(fn(n)){const t=i[e],a=s[n]=(0,r.cy)(t)||(0,r.Tn)(t)?{type:t}:(0,r.X$)({},t),o=a.type;let c=!1,d=!0;if((0,r.cy)(o))for(let e=0;e<o.length;++e){const n=o[e],t=(0,r.Tn)(n)&&n.name;if("Boolean"===t){c=!0;break}"String"===t&&(d=!1)}else c=(0,r.Tn)(o)&&"Boolean"===o.name;a[0]=c,a[1]=d,(c||(0,r.$3)(a,"default"))&&l.push(n)}}const d=[s,l];return(0,r.Gv)(e)&&a.set(e,d),d}function fn(e){return"$"!==e[0]&&!(0,r.SU)(e)}const hn=e=>"_"===e||"__"===e||"_ctx"===e||"$stable"===e,mn=e=>(0,r.cy)(e)?e.map(ft):[ft(e)],gn=(e,n,t)=>{if(n._n)return n;const a=A((...e)=>mn(n(...e)),t);return a._c=!1,a},bn=(e,n,t)=>{const a=e._ctx;for(const t in e){if(hn(t))continue;const o=e[t];if((0,r.Tn)(o))n[t]=gn(0,o,a);else if(null!=o){const e=mn(o);n[t]=()=>e}}},yn=(e,n)=>{const t=mn(n);e.slots.default=()=>t},xn=(e,n,t)=>{for(const a in n)!t&&hn(a)||(e[a]=n[a])},kn=(e,n,t)=>{const a=e.slots=ln();if(32&e.vnode.shapeFlag){const e=n.__;e&&(0,r.yQ)(a,"__",e,!0);const o=n._;o?(xn(a,n,t),t&&(0,r.yQ)(a,"_",o,!0)):bn(n,a)}else n&&yn(e,n)},wn=(e,n,t)=>{const{vnode:a,slots:o}=e;let i=!0,s=r.MZ;if(32&a.shapeFlag){const e=n._;e?t&&1===e?i=!1:xn(o,n,t):(i=!n.$stable,bn(n,o)),s=n}else n&&(yn(e,n),s={default:1});if(i)for(const e in o)hn(e)||null!=s[e]||delete o[e]},_n=function(e,n){n&&n.pendingBranch?(0,r.cy)(e)?n.effects.push(...e):n.effects.push(e):(t=e,(0,r.cy)(t)?d.push(...t):u&&-1===t.id?u.splice(p+1,0,t):1&t.flags||(d.push(t),t.flags|=1),g());var t};function Cn(e){return function(e,n){(0,r.We)().__VUE__=!0;const{insert:t,remove:i,patchProp:l,createElement:c,createText:d,createComment:u,setText:p,setElementText:v,parentNode:f,nextSibling:h,setScopeId:g=r.tE,insertStaticContent:x}=e,k=(e,n,t,a=null,r=null,o=null,i=void 0,s=null,l=!!n.dynamicChildren)=>{if(e===n)return;e&&!ot(e,n)&&(a=K(e),q(e,r,o,!0),e=null),-2===n.patchFlag&&(l=!1,n.dynamicChildren=null);const{type:c,ref:d,shapeFlag:u}=n;switch(c){case Hn:w(e,n,t,a);break;case Vn:_(e,n,t,a);break;case Qn:null==e&&C(n,t,a,i);break;case Gn:z(e,n,t,a,r,o,i,s,l);break;default:1&u?S(e,n,t,a,r,o,i,s,l):6&u?N(e,n,t,a,r,o,i,s,l):(64&u||128&u)&&c.process(e,n,t,a,r,o,i,s,l,Z)}null!=d&&r?te(d,e&&e.ref,o,n||e,!n):null==d&&e&&null!=e.ref&&te(e.ref,null,o,e,!0)},w=(e,n,a,r)=>{if(null==e)t(n.el=d(n.children),a,r);else{const t=n.el=e.el;n.children!==e.children&&p(t,n.children)}},_=(e,n,a,r)=>{null==e?t(n.el=u(n.children||""),a,r):n.el=e.el},C=(e,n,t,a)=>{[e.el,e.anchor]=x(e.children,n,t,a,e.el,e.anchor)},A=({el:e,anchor:n})=>{let t;for(;e&&e!==n;)t=h(e),i(e),e=t;i(n)},S=(e,n,t,a,r,o,i,s,l)=>{"svg"===n.type?i="svg":"math"===n.type&&(i="mathml"),null==e?T(n,t,a,r,o,i,s,l):M(e,n,r,o,i,s,l)},T=(e,n,a,o,i,s,d,u)=>{let p,f;const{props:h,shapeFlag:m,transition:g,dirs:b}=e;if(p=e.el=c(e.type,s,h&&h.is,h),8&m?v(p,e.children):16&m&&R(e.children,p,null,o,i,An(e,s),d,u),b&&L(e,null,o,"created"),I(p,e,e.scopeId,d,o),h){for(const e in h)"value"===e||(0,r.SU)(e)||l(p,e,null,h[e],s,o);"value"in h&&l(p,"value",null,h.value,s),(f=h.onVnodeBeforeMount)&&bt(f,o,e)}b&&L(e,null,o,"beforeMount");const y=function(e,n){return(!e||e&&!e.pendingBranch)&&n&&!n.persisted}(i,g);y&&g.beforeEnter(p),t(p,n,a),((f=h&&h.onVnodeMounted)||y||b)&&_n(()=>{f&&bt(f,o,e),y&&g.enter(p),b&&L(e,null,o,"mounted")},i)},I=(e,n,t,a,r)=>{if(t&&g(e,t),a)for(let n=0;n<a.length;n++)g(e,a[n]);if(r){let t=r.subTree;if(n===t||qn(t.type)&&(t.ssContent===n||t.ssFallback===n)){const n=r.vnode;I(e,n,n.scopeId,n.slotScopeIds,r.parent)}}},R=(e,n,t,a,r,o,i,s,l=0)=>{for(let c=l;c<e.length;c++){const l=e[c]=s?ht(e[c]):ft(e[c]);k(null,l,n,t,a,r,o,i,s)}},M=(e,n,t,a,o,i,s)=>{const c=n.el=e.el;let{patchFlag:d,dynamicChildren:u,dirs:p}=n;d|=16&e.patchFlag;const f=e.props||r.MZ,h=n.props||r.MZ;let m;if(t&&Sn(t,!1),(m=h.onVnodeBeforeUpdate)&&bt(m,t,n,e),p&&L(n,e,t,"beforeUpdate"),t&&Sn(t,!0),(f.innerHTML&&null==h.innerHTML||f.textContent&&null==h.textContent)&&v(c,""),u?P(e.dynamicChildren,u,c,t,a,An(n,o),i):s||B(e,n,c,null,t,a,An(n,o),i,!1),d>0){if(16&d)D(c,f,h,t,o);else if(2&d&&f.class!==h.class&&l(c,"class",null,h.class,o),4&d&&l(c,"style",f.style,h.style,o),8&d){const e=n.dynamicProps;for(let n=0;n<e.length;n++){const a=e[n],r=f[a],i=h[a];i===r&&"value"!==a||l(c,a,r,i,o,t)}}1&d&&e.children!==n.children&&v(c,n.children)}else s||null!=u||D(c,f,h,t,o);((m=h.onVnodeUpdated)||p)&&_n(()=>{m&&bt(m,t,n,e),p&&L(n,e,t,"updated")},a)},P=(e,n,t,a,r,o,i)=>{for(let s=0;s<n.length;s++){const l=e[s],c=n[s],d=l.el&&(l.type===Gn||!ot(l,c)||198&l.shapeFlag)?f(l.el):t;k(l,c,d,null,a,r,o,i,!0)}},D=(e,n,t,a,o)=>{if(n!==t){if(n!==r.MZ)for(const i in n)(0,r.SU)(i)||i in t||l(e,i,n[i],null,o,a);for(const i in t){if((0,r.SU)(i))continue;const s=t[i],c=n[i];s!==c&&"value"!==i&&l(e,i,c,s,o,a)}"value"in t&&l(e,"value",n.value,t.value,o)}},z=(e,n,a,r,o,i,s,l,c)=>{const u=n.el=e?e.el:d(""),p=n.anchor=e?e.anchor:d("");let{patchFlag:v,dynamicChildren:f,slotScopeIds:h}=n;h&&(l=l?l.concat(h):h),null==e?(t(u,a,r),t(p,a,r),R(n.children||[],a,p,o,i,s,l,c)):v>0&&64&v&&f&&e.dynamicChildren?(P(e.dynamicChildren,f,a,o,i,s,l),(null!=n.key||o&&n===o.subTree)&&Ln(e,n,!0)):B(e,n,a,p,o,i,s,l,c)},N=(e,n,t,a,r,o,i,s,l)=>{n.slotScopeIds=s,null==e?512&n.shapeFlag?r.ctx.activate(n,t,a,i,l):$(n,t,a,r,o,i,l):O(e,n,l)},$=(e,n,t,i,l,c,d)=>{const u=e.component=function(e,n,t){const o=e.type,i=(n?n.appContext:e.appContext)||yt,s={uid:xt++,vnode:e,type:o,parent:n,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new a.yC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(i.provides),ids:n?n.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:vn(o,i),emitsOptions:Fn(o,i),emit:null,emitted:null,propsDefaults:r.MZ,inheritAttrs:o.inheritAttrs,ctx:r.MZ,data:r.MZ,props:r.MZ,attrs:r.MZ,slots:r.MZ,refs:r.MZ,setupState:r.MZ,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=n?n.root:s,s.emit=On.bind(null,s),e.ce&&e.ce(s),s}(e,i,l);if(se(e)&&(u.ctx.renderer=Z),function(e,n=!1,t=!1){n&&Ct(n);const{props:i,children:l}=e.vnode,c=Lt(e);!function(e,n,t,r=!1){const o={},i=ln();e.propsDefaults=Object.create(null),dn(e,n,o,i);for(const n in e.propsOptions[0])n in o||(o[n]=void 0);t?e.props=r?o:(0,a.Gc)(o):e.type.props?e.props=o:e.props=i,e.attrs=i}(e,i,c,n),kn(e,l,t||n);const d=c?function(e,n){const t=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,je);const{setup:i}=t;if(i){(0,a.C4)();const t=e.setupContext=i.length>1?function(e){const n=n=>{e.exposed=n||{}};return{attrs:new Proxy(e.attrs,Pt),slots:e.slots,emit:e.emit,expose:n}}(e):null,l=At(e),c=o(i,e,0,[e.props,t]),d=(0,r.yL)(c);if((0,a.bl)(),l(),!d&&!e.sp||re(e)||ne(e),d){if(c.then(St,St),n)return c.then(t=>{Rt(e,t,n)}).catch(n=>{s(n,e,0)});e.asyncDep=c}else Rt(e,c,n)}else Mt(e,n)}(e,n):void 0;n&&Ct(!1)}(u,!1,d),u.asyncDep){if(l&&l.registerDep(u,F,d),!e.el){const a=u.subTree=ct(Vn);_(null,a,n,t),e.placeholder=a.el}}else F(u,e,n,t,l,c,d)},O=(e,n,t)=>{const a=n.component=e.component;if(function(e,n,t){const{props:a,children:r,component:o}=e,{props:i,children:s,patchFlag:l}=n,c=o.emitsOptions;if(n.dirs||n.transition)return!0;if(!(t&&l>=0))return!(!r&&!s||s&&s.$stable)||a!==i&&(a?!i||Wn(a,i,c):!!i);if(1024&l)return!0;if(16&l)return a?Wn(a,i,c):!!i;if(8&l){const e=n.dynamicProps;for(let n=0;n<e.length;n++){const t=e[n];if(i[t]!==a[t]&&!jn(c,t))return!0}}return!1}(e,n,t)){if(a.asyncDep&&!a.asyncResolved)return void j(a,n,t);a.next=n,a.update()}else n.el=e.el,a.vnode=n},F=(e,n,t,o,i,s,l)=>{const c=()=>{if(e.isMounted){let{next:n,bu:t,u:a,parent:o,vnode:d}=e;{const t=En(e);if(t)return n&&(n.el=d.el,j(e,n,l)),void t.asyncDep.then(()=>{e.isUnmounted||c()})}let u,p=n;Sn(e,!1),n?(n.el=d.el,j(e,n,l)):n=d,t&&(0,r.DY)(t),(u=n.props&&n.props.onVnodeBeforeUpdate)&&bt(u,o,n,d),Sn(e,!0);const v=Bn(e),h=e.subTree;e.subTree=v,k(h,v,f(h.el),K(h),e,i,s),n.el=v.el,null===p&&function({vnode:e,parent:n},t){for(;n;){const a=n.subTree;if(a.suspense&&a.suspense.activeBranch===e&&(a.el=e.el),a!==e)break;(e=n.vnode).el=t,n=n.parent}}(e,v.el),a&&_n(a,i),(u=n.props&&n.props.onVnodeUpdated)&&_n(()=>bt(u,o,n,d),i)}else{let a;const{el:l,props:c}=n,{bm:d,m:u,parent:p,root:v,type:f}=e,h=re(n);if(Sn(e,!1),d&&(0,r.DY)(d),!h&&(a=c&&c.onVnodeBeforeMount)&&bt(a,p,n),Sn(e,!0),l&&ae){const n=()=>{e.subTree=Bn(e),ae(l,e.subTree,e,i,null)};h&&f.__asyncHydrate?f.__asyncHydrate(l,e,n):n()}else{v.ce&&!1!==v.ce._def.shadowRoot&&v.ce._injectChildStyle(f);const a=e.subTree=Bn(e);k(null,a,t,o,e,i,s),n.el=a.el}if(u&&_n(u,i),!h&&(a=c&&c.onVnodeMounted)){const e=n;_n(()=>bt(a,p,e),i)}(256&n.shapeFlag||p&&re(p.vnode)&&256&p.vnode.shapeFlag)&&e.a&&_n(e.a,i),e.isMounted=!0,n=t=o=null}};e.scope.on();const d=e.effect=new a.X2(c);e.scope.off();const u=e.update=d.run.bind(d),p=e.job=d.runIfDirty.bind(d);p.i=e,p.id=e.uid,d.scheduler=()=>m(p),Sn(e,!0),u()},j=(e,n,t)=>{n.component=e;const o=e.vnode.props;e.vnode=n,e.next=null,function(e,n,t,o){const{props:i,attrs:s,vnode:{patchFlag:l}}=e,c=(0,a.ux)(i),[d]=e.propsOptions;let u=!1;if(!(o||l>0)||16&l){let a;dn(e,n,i,s)&&(u=!0);for(const o in c)n&&((0,r.$3)(n,o)||(a=(0,r.Tg)(o))!==o&&(0,r.$3)(n,a))||(d?!t||void 0===t[o]&&void 0===t[a]||(i[o]=un(d,c,o,void 0,e,!0)):delete i[o]);if(s!==c)for(const e in s)n&&(0,r.$3)(n,e)||(delete s[e],u=!0)}else if(8&l){const t=e.vnode.dynamicProps;for(let a=0;a<t.length;a++){let o=t[a];if(jn(e.emitsOptions,o))continue;const l=n[o];if(d)if((0,r.$3)(s,o))l!==s[o]&&(s[o]=l,u=!0);else{const n=(0,r.PT)(o);i[n]=un(d,c,n,l,e,!1)}else l!==s[o]&&(s[o]=l,u=!0)}}u&&(0,a.hZ)(e.attrs,"set","")}(e,n.props,o,t),wn(e,n.children,t),(0,a.C4)(),b(e),(0,a.bl)()},B=(e,n,t,a,r,o,i,s,l=!1)=>{const c=e&&e.children,d=e?e.shapeFlag:0,u=n.children,{patchFlag:p,shapeFlag:f}=n;if(p>0){if(128&p)return void U(c,u,t,a,r,o,i,s,l);if(256&p)return void X(c,u,t,a,r,o,i,s,l)}8&f?(16&d&&Q(c,r,o),u!==c&&v(t,u)):16&d?16&f?U(c,u,t,a,r,o,i,s,l):Q(c,r,o,!0):(8&d&&v(t,""),16&f&&R(u,t,a,r,o,i,s,l))},X=(e,n,t,a,o,i,s,l,c)=>{e=e||r.Oj,n=n||r.Oj;const d=e.length,u=n.length,p=Math.min(d,u);let v;for(v=0;v<p;v++){const a=n[v]=c?ht(n[v]):ft(n[v]);k(e[v],a,t,null,o,i,s,l,c)}d>u?Q(e,o,i,!0,!1,p):R(n,t,a,o,i,s,l,c,p)},U=(e,n,t,a,o,i,s,l,c)=>{let d=0;const u=n.length;let p=e.length-1,v=u-1;for(;d<=p&&d<=v;){const a=e[d],r=n[d]=c?ht(n[d]):ft(n[d]);if(!ot(a,r))break;k(a,r,t,null,o,i,s,l,c),d++}for(;d<=p&&d<=v;){const a=e[p],r=n[v]=c?ht(n[v]):ft(n[v]);if(!ot(a,r))break;k(a,r,t,null,o,i,s,l,c),p--,v--}if(d>p){if(d<=v){const e=v+1,r=e<u?n[e].el:a;for(;d<=v;)k(null,n[d]=c?ht(n[d]):ft(n[d]),t,r,o,i,s,l,c),d++}}else if(d>v)for(;d<=p;)q(e[d],o,i,!0),d++;else{const f=d,h=d,m=new Map;for(d=h;d<=v;d++){const e=n[d]=c?ht(n[d]):ft(n[d]);null!=e.key&&m.set(e.key,d)}let g,b=0;const y=v-h+1;let x=!1,w=0;const _=new Array(y);for(d=0;d<y;d++)_[d]=0;for(d=f;d<=p;d++){const a=e[d];if(b>=y){q(a,o,i,!0);continue}let r;if(null!=a.key)r=m.get(a.key);else for(g=h;g<=v;g++)if(0===_[g-h]&&ot(a,n[g])){r=g;break}void 0===r?q(a,o,i,!0):(_[r-h]=d+1,r>=w?w=r:x=!0,k(a,n[r],t,null,o,i,s,l,c),b++)}const C=x?function(e){const n=e.slice(),t=[0];let a,r,o,i,s;const l=e.length;for(a=0;a<l;a++){const l=e[a];if(0!==l){if(r=t[t.length-1],e[r]<l){n[a]=r,t.push(a);continue}for(o=0,i=t.length-1;o<i;)s=o+i>>1,e[t[s]]<l?o=s+1:i=s;l<e[t[o]]&&(o>0&&(n[a]=t[o-1]),t[o]=a)}}for(o=t.length,i=t[o-1];o-- >0;)t[o]=i,i=n[i];return t}(_):r.Oj;for(g=C.length-1,d=y-1;d>=0;d--){const e=h+d,r=n[e],p=n[e+1],v=e+1<u?p.el||p.placeholder:a;0===_[d]?k(null,r,t,v,o,i,s,l,c):x&&(g<0||d!==C[g]?W(r,t,v,2):g--)}}},W=(e,n,a,r,o=null)=>{const{el:s,type:l,transition:c,children:d,shapeFlag:u}=e;if(6&u)W(e.component.subTree,n,a,r);else if(128&u)e.suspense.move(n,a,r);else if(64&u)l.move(e,n,a,Z);else if(l!==Gn)if(l!==Qn)if(2!==r&&1&u&&c)if(0===r)c.beforeEnter(s),t(s,n,a),_n(()=>c.enter(s),o);else{const{leave:r,delayLeave:o,afterLeave:l}=c,d=()=>{e.ctx.isUnmounted?i(s):t(s,n,a)},u=()=>{r(s,()=>{d(),l&&l()})};o?o(s,d,u):u()}else t(s,n,a);else(({el:e,anchor:n},a,r)=>{let o;for(;e&&e!==n;)o=h(e),t(e,a,r),e=o;t(n,a,r)})(e,n,a);else{t(s,n,a);for(let e=0;e<d.length;e++)W(d[e],n,a,r);t(e.anchor,n,a)}},q=(e,n,t,r=!1,o=!1)=>{const{type:i,props:s,ref:l,children:c,dynamicChildren:d,shapeFlag:u,patchFlag:p,dirs:v,cacheIndex:f}=e;if(-2===p&&(o=!1),null!=l&&((0,a.C4)(),te(l,null,t,e,!0),(0,a.bl)()),null!=f&&(n.renderCache[f]=void 0),256&u)return void n.ctx.deactivate(e);const h=1&u&&v,m=!re(e);let g;if(m&&(g=s&&s.onVnodeBeforeUnmount)&&bt(g,n,e),6&u)V(e.component,t,r);else{if(128&u)return void e.suspense.unmount(t,r);h&&L(e,null,n,"beforeUnmount"),64&u?e.type.remove(e,n,t,Z,r):d&&!d.hasOnce&&(i!==Gn||p>0&&64&p)?Q(d,n,t,!1,!0):(i===Gn&&384&p||!o&&16&u)&&Q(c,n,t),r&&G(e)}(m&&(g=s&&s.onVnodeUnmounted)||h)&&_n(()=>{g&&bt(g,n,e),h&&L(e,null,n,"unmounted")},t)},G=e=>{const{type:n,el:t,anchor:a,transition:r}=e;if(n===Gn)return void H(t,a);if(n===Qn)return void A(e);const o=()=>{i(t),r&&!r.persisted&&r.afterLeave&&r.afterLeave()};if(1&e.shapeFlag&&r&&!r.persisted){const{leave:n,delayLeave:a}=r,i=()=>n(t,o);a?a(e.el,o,i):i()}else o()},H=(e,n)=>{let t;for(;e!==n;)t=h(e),i(e),e=t;i(n)},V=(e,n,t)=>{const{bum:a,scope:o,job:i,subTree:s,um:l,m:c,a:d,parent:u,slots:{__:p}}=e;Tn(c),Tn(d),a&&(0,r.DY)(a),u&&(0,r.cy)(p)&&p.forEach(e=>{u.renderCache[e]=void 0}),o.stop(),i&&(i.flags|=8,q(s,e,n,t)),l&&_n(l,n),_n(()=>{e.isUnmounted=!0},n),n&&n.pendingBranch&&!n.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===n.pendingId&&(n.deps--,0===n.deps&&n.resolve())},Q=(e,n,t,a=!1,r=!1,o=0)=>{for(let i=o;i<e.length;i++)q(e[i],n,t,a,r)},K=e=>{if(6&e.shapeFlag)return K(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const n=h(e.anchor||e.el),t=n&&n[E];return t?h(t):n};let Y=!1;const J=(e,n,t)=>{null==e?n._vnode&&q(n._vnode,null,null,!0):k(n._vnode||null,e,n,null,null,null,t),n._vnode=e,Y||(Y=!0,b(),y(),Y=!1)},Z={p:k,um:q,m:W,r:G,mt:$,mc:R,pc:B,pbc:P,n:K,o:e};let ee,ae;return n&&([ee,ae]=n(Z)),{render:J,hydrate:ee,createApp:nn(J,ee)}}(e)}function An({type:e,props:n},t){return"svg"===t&&"foreignObject"===e||"mathml"===t&&"annotation-xml"===e&&n&&n.encoding&&n.encoding.includes("html")?void 0:t}function Sn({effect:e,job:n},t){t?(e.flags|=32,n.flags|=4):(e.flags&=-33,n.flags&=-5)}function Ln(e,n,t=!1){const a=e.children,o=n.children;if((0,r.cy)(a)&&(0,r.cy)(o))for(let e=0;e<a.length;e++){const n=a[e];let r=o[e];1&r.shapeFlag&&!r.dynamicChildren&&((r.patchFlag<=0||32===r.patchFlag)&&(r=o[e]=ht(o[e]),r.el=n.el),t||-2===r.patchFlag||Ln(n,r)),r.type===Hn&&(r.el=n.el),r.type!==Vn||r.el||(r.el=n.el)}}function En(e){const n=e.subTree.component;if(n)return n.asyncDep&&!n.asyncResolved?n:En(n)}function Tn(e){if(e)for(let n=0;n<e.length;n++)e[n].flags|=8}const In=Symbol.for("v-scx"),Rn=()=>rn(In);function Mn(e,n){return Dn(e,null,n)}function Pn(e,n,t){return Dn(e,n,t)}function Dn(e,n,t=r.MZ){const{immediate:o,deep:s,flush:l,once:c}=t,d=(0,r.X$)({},t),u=n&&o||!n&&"post"!==l;let p;if(It)if("sync"===l){const e=Rn();p=e.__watcherHandles||(e.__watcherHandles=[])}else if(!u){const e=()=>{};return e.stop=r.tE,e.resume=r.tE,e.pause=r.tE,e}const v=kt;d.call=(e,n,t)=>i(e,v,n,t);let f=!1;"post"===l?d.scheduler=e=>{_n(e,v&&v.suspense)}:"sync"!==l&&(f=!0,d.scheduler=(e,n)=>{n?e():m(e)}),d.augmentJob=e=>{n&&(e.flags|=4),f&&(e.flags|=2,v&&(e.id=v.uid,e.i=v))};const h=(0,a.wB)(e,n,d);return It&&(p?p.push(h):u&&h()),h}function zn(e,n,t){const a=this.proxy,o=(0,r.Kg)(e)?e.includes(".")?Nn(a,e):()=>a[e]:e.bind(a,a);let i;(0,r.Tn)(n)?i=n:(i=n.handler,t=n);const s=At(this),l=Dn(o,i.bind(a),t);return s(),l}function Nn(e,n){const t=n.split(".");return()=>{let n=e;for(let e=0;e<t.length&&n;e++)n=n[t[e]];return n}}const $n=(e,n)=>"modelValue"===n||"model-value"===n?e.modelModifiers:e[`${n}Modifiers`]||e[`${(0,r.PT)(n)}Modifiers`]||e[`${(0,r.Tg)(n)}Modifiers`];function On(e,n,...t){if(e.isUnmounted)return;const a=e.vnode.props||r.MZ;let o=t;const s=n.startsWith("update:"),l=s&&$n(a,n.slice(7));let c;l&&(l.trim&&(o=t.map(e=>(0,r.Kg)(e)?e.trim():e)),l.number&&(o=t.map(r.bB)));let d=a[c=(0,r.rU)(n)]||a[c=(0,r.rU)((0,r.PT)(n))];!d&&s&&(d=a[c=(0,r.rU)((0,r.Tg)(n))]),d&&i(d,e,6,o);const u=a[c+"Once"];if(u){if(e.emitted){if(e.emitted[c])return}else e.emitted={};e.emitted[c]=!0,i(u,e,6,o)}}function Fn(e,n,t=!1){const a=n.emitsCache,o=a.get(e);if(void 0!==o)return o;const i=e.emits;let s={},l=!1;if(!(0,r.Tn)(e)){const a=e=>{const t=Fn(e,n,!0);t&&(l=!0,(0,r.X$)(s,t))};!t&&n.mixins.length&&n.mixins.forEach(a),e.extends&&a(e.extends),e.mixins&&e.mixins.forEach(a)}return i||l?((0,r.cy)(i)?i.forEach(e=>s[e]=null):(0,r.X$)(s,i),(0,r.Gv)(e)&&a.set(e,s),s):((0,r.Gv)(e)&&a.set(e,null),null)}function jn(e,n){return!(!e||!(0,r.Mp)(n))&&(n=n.slice(2).replace(/Once$/,""),(0,r.$3)(e,n[0].toLowerCase()+n.slice(1))||(0,r.$3)(e,(0,r.Tg)(n))||(0,r.$3)(e,n))}function Bn(e){const{type:n,vnode:t,proxy:a,withProxy:o,propsOptions:[i],slots:l,attrs:c,emit:d,render:u,renderCache:p,props:v,data:f,setupState:h,ctx:m,inheritAttrs:g}=e,b=C(e);let y,x;try{if(4&t.shapeFlag){const e=o||a,n=e;y=ft(u.call(n,e,p,v,h,f,m)),x=c}else{const e=n;y=ft(e.length>1?e(v,{attrs:c,slots:l,emit:d}):e(v,null)),x=n.props?c:Xn(c)}}catch(n){Kn.length=0,s(n,e,1),y=ct(Vn)}let k=y;if(x&&!1!==g){const e=Object.keys(x),{shapeFlag:n}=k;e.length&&7&n&&(i&&e.some(r.CP)&&(x=Un(x,i)),k=dt(k,x,!1,!0))}return t.dirs&&(k=dt(k,null,!1,!0),k.dirs=k.dirs?k.dirs.concat(t.dirs):t.dirs),t.transition&&J(k,t.transition),y=k,C(b),y}const Xn=e=>{let n;for(const t in e)("class"===t||"style"===t||(0,r.Mp)(t))&&((n||(n={}))[t]=e[t]);return n},Un=(e,n)=>{const t={};for(const a in e)(0,r.CP)(a)&&a.slice(9)in n||(t[a]=e[a]);return t};function Wn(e,n,t){const a=Object.keys(n);if(a.length!==Object.keys(e).length)return!0;for(let r=0;r<a.length;r++){const o=a[r];if(n[o]!==e[o]&&!jn(t,o))return!0}return!1}const qn=e=>e.__isSuspense;const Gn=Symbol.for("v-fgt"),Hn=Symbol.for("v-txt"),Vn=Symbol.for("v-cmt"),Qn=Symbol.for("v-stc"),Kn=[];let Yn=null;function Jn(e=!1){Kn.push(Yn=e?null:[])}let Zn=1;function et(e,n=!1){Zn+=e,e<0&&Yn&&n&&(Yn.hasOnce=!0)}function nt(e){return e.dynamicChildren=Zn>0?Yn||r.Oj:null,Kn.pop(),Yn=Kn[Kn.length-1]||null,Zn>0&&Yn&&Yn.push(e),e}function tt(e,n,t,a,r,o){return nt(lt(e,n,t,a,r,o,!0))}function at(e,n,t,a,r){return nt(ct(e,n,t,a,r,!0))}function rt(e){return!!e&&!0===e.__v_isVNode}function ot(e,n){return e.type===n.type&&e.key===n.key}const it=({key:e})=>null!=e?e:null,st=({ref:e,ref_key:n,ref_for:t})=>("number"==typeof e&&(e=""+e),null!=e?(0,r.Kg)(e)||(0,a.i9)(e)||(0,r.Tn)(e)?{i:w,r:e,k:n,f:!!t}:e:null);function lt(e,n=null,t=null,a=0,o=null,i=(e===Gn?0:1),s=!1,l=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:n,key:n&&it(n),ref:n&&st(n),scopeId:_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:a,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:w};return l?(mt(c,t),128&i&&e.normalize(c)):t&&(c.shapeFlag|=(0,r.Kg)(t)?8:16),Zn>0&&!s&&Yn&&(c.patchFlag>0||6&i)&&32!==c.patchFlag&&Yn.push(c),c}const ct=function(e,n=null,t=null,o=0,i=null,s=!1){if(e&&e!==Ie||(e=Vn),rt(e)){const a=dt(e,n,!0);return t&&mt(a,t),Zn>0&&!s&&Yn&&(6&a.shapeFlag?Yn[Yn.indexOf(e)]=a:Yn.push(a)),a.patchFlag=-2,a}if(l=e,(0,r.Tn)(l)&&"__vccOpts"in l&&(e=e.__vccOpts),n){n=function(e){return e?(0,a.ju)(e)||cn(e)?(0,r.X$)({},e):e:null}(n);let{class:e,style:t}=n;e&&!(0,r.Kg)(e)&&(n.class=(0,r.C4)(e)),(0,r.Gv)(t)&&((0,a.ju)(t)&&!(0,r.cy)(t)&&(t=(0,r.X$)({},t)),n.style=(0,r.Tr)(t))}var l;return lt(e,n,t,o,i,(0,r.Kg)(e)?1:qn(e)?128:T(e)?64:(0,r.Gv)(e)?4:(0,r.Tn)(e)?2:0,s,!0)};function dt(e,n,t=!1,a=!1){const{props:o,ref:i,patchFlag:s,children:l,transition:c}=e,d=n?gt(o||{},n):o,u={__v_isVNode:!0,__v_skip:!0,type:e.type,props:d,key:d&&it(d),ref:n&&n.ref?t&&i?(0,r.cy)(i)?i.concat(st(n)):[i,st(n)]:st(n):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:n&&e.type!==Gn?-1===s?16:16|s:s,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&dt(e.ssContent),ssFallback:e.ssFallback&&dt(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&a&&J(u,c.clone(u)),u}function ut(e=" ",n=0){return ct(Hn,null,e,n)}function pt(e,n){const t=ct(Qn,null,e);return t.staticCount=n,t}function vt(e="",n=!1){return n?(Jn(),at(Vn,null,e)):ct(Vn,null,e)}function ft(e){return null==e||"boolean"==typeof e?ct(Vn):(0,r.cy)(e)?ct(Gn,null,e.slice()):rt(e)?ht(e):ct(Hn,null,String(e))}function ht(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:dt(e)}function mt(e,n){let t=0;const{shapeFlag:a}=e;if(null==n)n=null;else if((0,r.cy)(n))t=16;else if("object"==typeof n){if(65&a){const t=n.default;return void(t&&(t._c&&(t._d=!1),mt(e,t()),t._c&&(t._d=!0)))}{t=32;const a=n._;a||cn(n)?3===a&&w&&(1===w.slots._?n._=1:(n._=2,e.patchFlag|=1024)):n._ctx=w}}else(0,r.Tn)(n)?(n={default:n,_ctx:w},t=32):(n=String(n),64&a?(t=16,n=[ut(n)]):t=8);e.children=n,e.shapeFlag|=t}function gt(...e){const n={};for(let t=0;t<e.length;t++){const a=e[t];for(const e in a)if("class"===e)n.class!==a.class&&(n.class=(0,r.C4)([n.class,a.class]));else if("style"===e)n.style=(0,r.Tr)([n.style,a.style]);else if((0,r.Mp)(e)){const t=n[e],o=a[e];!o||t===o||(0,r.cy)(t)&&t.includes(o)||(n[e]=t?[].concat(t,o):o)}else""!==e&&(n[e]=a[e])}return n}function bt(e,n,t,a=null){i(e,n,7,[t,a])}const yt=Ze();let xt=0;let kt=null;const wt=()=>kt||w;let _t,Ct;{const e=(0,r.We)(),n=(n,t)=>{let a;return(a=e[n])||(a=e[n]=[]),a.push(t),e=>{a.length>1?a.forEach(n=>n(e)):a[0](e)}};_t=n("__VUE_INSTANCE_SETTERS__",e=>kt=e),Ct=n("__VUE_SSR_SETTERS__",e=>It=e)}const At=e=>{const n=kt;return _t(e),e.scope.on(),()=>{e.scope.off(),_t(n)}},St=()=>{kt&&kt.scope.off(),_t(null)};function Lt(e){return 4&e.vnode.shapeFlag}let Et,Tt,It=!1;function Rt(e,n,t){(0,r.Tn)(n)?e.type.__ssrInlineRender?e.ssrRender=n:e.render=n:(0,r.Gv)(n)&&(e.setupState=(0,a.Pr)(n)),Mt(e,t)}function Mt(e,n,t){const o=e.type;if(!e.render){if(!n&&Et&&!o.render){const n=o.template||qe(e).template;if(n){const{isCustomElement:t,compilerOptions:a}=e.appContext.config,{delimiters:i,compilerOptions:s}=o,l=(0,r.X$)((0,r.X$)({isCustomElement:t,delimiters:i},a),s);o.render=Et(n,l)}}e.render=o.render||r.tE,Tt&&Tt(e)}{const n=At(e);(0,a.C4)();try{!function(e){const n=qe(e),t=e.proxy,o=e.ctx;Xe=!1,n.beforeCreate&&Ue(n.beforeCreate,e,"bc");const{data:i,computed:s,methods:l,watch:c,provide:d,inject:u,created:p,beforeMount:v,mounted:f,beforeUpdate:h,updated:m,activated:g,deactivated:b,beforeDestroy:y,beforeUnmount:x,destroyed:k,unmounted:w,render:_,renderTracked:C,renderTriggered:A,errorCaptured:S,serverPrefetch:L,expose:E,inheritAttrs:T,components:I,directives:R,filters:M}=n;if(u&&function(e,n){(0,r.cy)(e)&&(e=Qe(e));for(const t in e){const o=e[t];let i;i=(0,r.Gv)(o)?"default"in o?rn(o.from||t,o.default,!0):rn(o.from||t):rn(o),(0,a.i9)(i)?Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:()=>i.value,set:e=>i.value=e}):n[t]=i}}(u,o),l)for(const e in l){const n=l[e];(0,r.Tn)(n)&&(o[e]=n.bind(t))}if(i){const n=i.call(t,t);(0,r.Gv)(n)&&(e.data=(0,a.Kh)(n))}if(Xe=!0,s)for(const e in s){const n=s[e],a=(0,r.Tn)(n)?n.bind(t,t):(0,r.Tn)(n.get)?n.get.bind(t,t):r.tE,i=!(0,r.Tn)(n)&&(0,r.Tn)(n.set)?n.set.bind(t):r.tE,l=Nt({get:a,set:i});Object.defineProperty(o,e,{enumerable:!0,configurable:!0,get:()=>l.value,set:e=>l.value=e})}if(c)for(const e in c)We(c[e],o,t,e);if(d){const e=(0,r.Tn)(d)?d.call(t):d;Reflect.ownKeys(e).forEach(n=>{an(n,e[n])})}function P(e,n){(0,r.cy)(n)?n.forEach(n=>e(n.bind(t))):n&&e(n.bind(t))}if(p&&Ue(p,e,"c"),P(be,v),P(ye,f),P(xe,h),P(ke,m),P(de,g),P(ue,b),P(Le,S),P(Se,C),P(Ae,A),P(we,x),P(_e,w),P(Ce,L),(0,r.cy)(E))if(E.length){const n=e.exposed||(e.exposed={});E.forEach(e=>{Object.defineProperty(n,e,{get:()=>t[e],set:n=>t[e]=n,enumerable:!0})})}else e.exposed||(e.exposed={});_&&e.render===r.tE&&(e.render=_),null!=T&&(e.inheritAttrs=T),I&&(e.components=I),R&&(e.directives=R),L&&ne(e)}(e)}finally{(0,a.bl)(),n()}}}const Pt={get:(e,n)=>((0,a.u4)(e,"get",""),e[n])};function Dt(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy((0,a.Pr)((0,a.IG)(e.exposed)),{get:(n,t)=>t in n?n[t]:t in Oe?Oe[t](e):void 0,has:(e,n)=>n in e||n in Oe})):e.proxy}function zt(e,n=!0){return(0,r.Tn)(e)?e.displayName||e.name:e.name||n&&e.__name}const Nt=(e,n)=>(0,a.EW)(e,n,It);function $t(e,n,t){const a=arguments.length;return 2===a?(0,r.Gv)(n)&&!(0,r.cy)(n)?rt(n)?ct(e,null,[n]):ct(e,n):ct(e,null,n):(a>3?t=Array.prototype.slice.call(arguments,2):3===a&&rt(t)&&(t=[t]),ct(e,n,t))}const Ot="3.5.18"},651:(e,n,t)=>{"use strict";t.d(n,{applyEquipmentBonus:()=>i,removeEquipmentBonus:()=>s});var a=t(2543);function r(e){const n=e;return n.角色?.属性&&"object"==typeof n.角色.属性||(n.角色=n.角色&&"object"==typeof n.角色?n.角色:{},n.角色.属性={声望:0,生命值:{当前:100,上限:100},精神力:{当前:50,上限:50},体力:{当前:100,上限:100},理智值:{当前:100,上限:100},寿命:{当前:18,上限:80}}),n.角色.属性}function o(e){const n=e;return n.角色?.身份&&"object"==typeof n.角色.身份||(n.角色=n.角色&&"object"==typeof n.角色?n.角色:{},n.角色.身份={后天属性:{力量:0,体质:0,敏捷:0,意志:0,魅力:0,幸运:0}}),{character:n.角色.身份}}function i(e,n){try{r(e);const{character:t}=o(e),i=e?.角色?.背包?.物品,s=i?.[n];if(!s||"装备"!==s.类型)return console.warn(`[装备增幅] 物品 ${n} 不是装备类型`),!1;const l=s.装备增幅;return l?(console.log(`[装备增幅] 开始应用装备 ${s.名称} 的属性加成:`,l),l.后天属性&&["力量","体质","敏捷","意志","魅力","幸运"].forEach(e=>{const n=l.后天属性?.[e];if(n&&"number"==typeof n){const r=(0,a.get)(t,`后天属性.${e}`,0),o=r+n;(0,a.set)(t,`后天属性.${e}`,o),console.log(`[装备增幅] 后天属性.${e}: ${r} -> ${o} (+${n})`)}}),console.log(`[装备增幅] ✅ 成功应用装备 ${s.名称} 的属性加成`),!0):(console.log(`[装备增幅] 装备 ${s.名称} 没有属性加成`),!0)}catch(e){return console.error("[装备增幅] 应用装备加成失败:",e),!1}}function s(e,n){try{r(e);const{character:t}=o(e),i=e?.角色?.背包?.物品,s=i?.[n];if(!s||"装备"!==s.类型)return console.warn(`[装备增幅] 物品 ${n} 不是装备类型`),!1;const l=s.装备增幅;return l?(console.log(`[装备增幅] 开始移除装备 ${s.名称} 的属性加成:`,l),l.后天属性&&["力量","体质","敏捷","意志","魅力","幸运"].forEach(e=>{const n=l.后天属性?.[e];if(n&&"number"==typeof n){const r=(0,a.get)(t,`后天属性.${e}`,0),o=Math.max(0,r-n);(0,a.set)(t,`后天属性.${e}`,o),console.log(`[装备增幅] 后天属性.${e}: ${r} -> ${o} (-${n})`)}}),console.log(`[装备增幅] ✅ 成功移除装备 ${s.名称} 的属性加成`),!0):(console.log(`[装备增幅] 装备 ${s.名称} 没有属性加成`),!0)}catch(e){return console.error("[装备增幅] 移除装备加成失败:",e),!1}}},655:e=>{"use strict";var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch(e){n=!1}e.exports=n},660:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23374151%27 d=%27M6 9L1 4h10z%27/%3E%3C/svg%3E"},728:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.formatted-text[data-v-b97c9eb8] {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  text-align: justify;\n  text-indent: 2em;\n  margin: 0;\n  line-height: 1.8;\n  padding-bottom: 1.5rem;\n}\n\n/* 环境描写 - 青色 */\n.text-environment[data-v-b97c9eb8] {\n  color: #0891b2;\n  font-weight: 500;\n}\n\n/* 心理描写 - 紫色 */\n.text-psychology[data-v-b97c9eb8] {\n  color: #7c3aed;\n  font-style: italic;\n  font-weight: 500;\n}\n\n/* 对话 - 橙色加粗 */\n.text-dialogue[data-v-b97c9eb8] {\n  color: #d97706;\n  font-weight: 700;\n}\n\n/* 引用/独白 - 橙色斜体加粗 */\n.text-quote[data-v-b97c9eb8] {\n  color: rgb(254 125 0);\n  font-style: italic;\n  font-weight: 700;\n}\n\n/* 普通文本 */\n.text-normal[data-v-b97c9eb8] {\n  color: var(--color-text, #1a1a1a);\n}\n\n/* Markdown 粗体 - 低调的强调，使用微妙的颜色和字重 */\n.text-bold[data-v-b97c9eb8] {\n  font-weight: 600;\n  color: #2c3e50;\n  letter-spacing: 0.01em;\n}\n\n/* Markdown 斜体 - 优雅的倾斜，略微透明 */\n.text-italic[data-v-b97c9eb8] {\n  font-style: italic;\n  opacity: 0.92;\n  color: #34495e;\n}\n\n/* 判定卡片样式 - 清爽版 */\n.judgement-card[data-v-b97c9eb8] {\n  display: flex;\n  gap: 1rem;\n  margin: 1.25rem 0;\n  padding: 1.25rem;\n  background: var(--color-surface);\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n  text-indent: 0;\n  position: relative;\n  overflow: hidden;\n  transition: all 0.2s ease;\n}\n.judgement-card[data-v-b97c9eb8]:hover {\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n}\n\n/* 成功状态 */\n.judgement-card.is-success[data-v-b97c9eb8] {\n  border-left: 4px solid #10b981;\n  background: rgba(16, 185, 129, 0.05); /* 极淡的绿色背景 */\n  --card-color: #10b981;\n}\n.judgement-card.is-great-success[data-v-b97c9eb8] {\n  border-left: 4px solid #f59e0b;\n  background: rgba(245, 158, 11, 0.05);\n  --card-color: #f59e0b;\n}\n\n/* 失败状态 */\n.judgement-card.is-failure[data-v-b97c9eb8] {\n  border-left: 4px solid #ef4444;\n  background: rgba(239, 68, 68, 0.05);\n  --card-color: #ef4444;\n}\n.judgement-card.is-great-failure[data-v-b97c9eb8] {\n  border-left: 4px solid #a855f7;\n  background: rgba(168, 85, 247, 0.05);\n  --card-color: #a855f7;\n}\n@keyframes pulse-success-b97c9eb8 {\n0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4);\n}\n50% { box-shadow: 0 0 0 8px rgba(251, 191, 36, 0);\n}\n}\n@keyframes pulse-failure-b97c9eb8 {\n0%, 100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4);\n}\n50% { box-shadow: 0 0 0 8px rgba(168, 85, 247, 0);\n}\n}\n\n/* 图标区域 */\n.card-icon[data-v-b97c9eb8] {\n  flex-shrink: 0;\n  width: 48px;\n  height: 48px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: white;\n  border-radius: 12px;\n  border: 2px solid var(--card-color, #6366f1);\n  color: var(--card-color, #6366f1);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n/* 内容区域 */\n.card-content[data-v-b97c9eb8] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n/* 标题行 */\n.card-header[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n}\n.judgement-title[data-v-b97c9eb8] {\n  font-size: 1.125rem;\n  font-weight: 700;\n  color: #1e293b;\n  letter-spacing: -0.01em;\n  opacity: 1;\n}\n\n/* 标题渐变色 - 根据结果 */\n.judgement-title.title-perfect[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-shadow: none;\n}\n.judgement-title.title-great-success[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #34d399 0%, #10b981 50%, #059669 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-shadow: none;\n}\n.judgement-title.title-success[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 50%, #2563eb 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-shadow: none;\n}\n.judgement-title.title-failure[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #f87171 0%, #ef4444 50%, #dc2626 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-shadow: none;\n}\n.judgement-title.title-great-failure[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #c084fc 0%, #a855f7 50%, #9333ea 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-shadow: none;\n}\n.judgement-badge[data-v-b97c9eb8] {\n  display: inline-flex;\n  align-items: center;\n  padding: 0.375rem 0.875rem;\n  background: var(--card-color, #6366f1);\n  color: white;\n  border-radius: 20px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  letter-spacing: 0.02em;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  opacity: 1;\n}\n\n/* 统计信息行 */\n.card-body[data-v-b97c9eb8] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.75rem;\n}\n.stat-item[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.875rem;\n  background: white;\n  border-radius: 10px;\n  border: 1px solid #e2e8f0;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);\n  min-width: fit-content;\n}\n.difficulty-item[data-v-b97c9eb8] {\n  min-width: 120px;\n}\n\n/* 幸运点样式 */\n.lucky-item[data-v-b97c9eb8] {\n  position: relative;\n  overflow: hidden;\n}\n.lucky-item.lucky-positive[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\n  border-color: #86efac;\n}\n.lucky-item.lucky-negative[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n  border-color: #fca5a5;\n}\n.lucky-value[data-v-b97c9eb8] {\n  font-weight: 800;\n}\n.lucky-positive .lucky-value[data-v-b97c9eb8] {\n  color: #16a34a;\n}\n.lucky-negative .lucky-value[data-v-b97c9eb8] {\n  color: #dc2626;\n}\n.details-list[data-v-b97c9eb8] {\n  width: 100%;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid #e2e8f0;\n}\n.detail-item[data-v-b97c9eb8] {\n  font-size: 0.875rem;\n  color: #64748b;\n  padding: 0.25rem 0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.detail-item[data-v-b97c9eb8]::before {\n  content: \'•\';\n  color: #94a3b8;\n}\n.detail-label[data-v-b97c9eb8] {\n  font-weight: 600;\n  color: #475569;\n}\n.detail-value[data-v-b97c9eb8] {\n  font-weight: 700;\n  color: #1e293b;\n  min-width: 2rem;\n}\n.detail-source[data-v-b97c9eb8] {\n  font-size: 0.75rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.stat-icon[data-v-b97c9eb8] {\n  font-size: 1.375rem;\n  line-height: 1;\n}\n.stat-info[data-v-b97c9eb8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.125rem;\n}\n.stat-label[data-v-b97c9eb8] {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: #64748b;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n.stat-value[data-v-b97c9eb8] {\n  font-size: 1.125rem;\n  font-weight: 700;\n  color: #1e293b;\n}\n.dice-roll[data-v-b97c9eb8], .attribute-check[data-v-b97c9eb8] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-surface-light, #ebe9e6);\n  border-radius: 8px;\n  border: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));\n  transition: all 0.2s ease;\n  text-align: center;\n}\n.dice-roll[data-v-b97c9eb8]:hover, .attribute-check[data-v-b97c9eb8]:hover {\n  background: var(--color-surface, #f2f1ee);\n  transform: translateY(-1px);\n}\n.dice-roll .label[data-v-b97c9eb8], .attribute-check .label[data-v-b97c9eb8] {\n  font-size: 0.8em;\n  color: var(--color-text-secondary, #666666);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  margin-bottom: 0.25rem;\n  font-weight: 500;\n}\n.dice-roll .value[data-v-b97c9eb8], .attribute-check .value[data-v-b97c9eb8] {\n  font-size: 1.4em;\n  font-weight: 700;\n  color: var(--color-text, #1a1a1a);\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.dice-roll .value[data-v-b97c9eb8] {\n  color: #6366f1;\n  background: linear-gradient(135deg, #6366f1, #8b5cf6);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .text-normal[data-v-b97c9eb8] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .text-environment[data-v-b97c9eb8] {\n  color: #22d3ee;\n}\n[data-theme="dark"] .text-psychology[data-v-b97c9eb8] {\n  color: #a78bfa;\n}\n[data-theme="dark"] .text-dialogue[data-v-b97c9eb8] {\n  color: #fb923c;\n}\n[data-theme="dark"] .text-quote[data-v-b97c9eb8] {\n  color: rgb(254 125 0);\n}\n[data-theme="dark"] .text-bold[data-v-b97c9eb8] {\n  font-weight: 600;\n  color: #e2e8f0;\n  letter-spacing: 0.01em;\n}\n[data-theme="dark"] .text-italic[data-v-b97c9eb8] {\n  font-style: italic;\n  opacity: 0.88;\n  color: #cbd5e1;\n}\n[data-theme="dark"] .judgement-card[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, var(--color-background, rgb(30, 41, 59)) 100%);\n  border-color: var(--color-border, rgba(173, 216, 230, 0.5));\n}\n[data-theme="dark"] .card-header[data-v-b97c9eb8] {\n  color: var(--color-text, #f7f7f5);\n}\n\n/* 深色主题标题渐变色 */\n[data-theme="dark"] .judgement-title[data-v-b97c9eb8] {\n  color: #f1f5f9;\n}\n[data-theme="dark"] .judgement-title.title-perfect[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #fcd34d 0%, #fbbf24 50%, #f59e0b 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .judgement-title.title-great-success[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #6ee7b7 0%, #34d399 50%, #10b981 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .judgement-title.title-success[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 50%, #3b82f6 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .judgement-title.title-failure[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #fca5a5 0%, #f87171 50%, #ef4444 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .judgement-title.title-great-failure[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #d8b4fe 0%, #c084fc 50%, #a855f7 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .result-text[data-v-b97c9eb8],\n[data-theme="dark"] .dice-roll[data-v-b97c9eb8],\n[data-theme="dark"] .attribute-check[data-v-b97c9eb8] {\n  background: var(--color-surface-light, #414868);\n  border-color: var(--color-border, rgba(173, 216, 230, 0.5));\n}\n[data-theme="dark"] .dice-roll .label[data-v-b97c9eb8],\n[data-theme="dark"] .attribute-check .label[data-v-b97c9eb8] {\n  color: var(--color-text-secondary, #d0d0d0);\n}\n[data-theme="dark"] .dice-roll .value[data-v-b97c9eb8],\n[data-theme="dark"] .attribute-check .value[data-v-b97c9eb8] {\n  color: var(--color-text, #f7f7f5);\n}\n.header-right[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.help-btn[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  background: rgba(255, 255, 255, 0.8);\n  border: 1px solid #e2e8f0;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #64748b;\n}\n.help-btn[data-v-b97c9eb8]:hover {\n  background: white;\n  border-color: var(--card-color, #6366f1);\n  color: var(--card-color, #6366f1);\n  transform: scale(1.1);\n}\n.help-btn[data-v-b97c9eb8]:active {\n  transform: scale(0.95);\n}\n\n/* 帮助弹窗 */\n.help-modal-overlay[data-v-b97c9eb8] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  animation: fadeIn-b97c9eb8 0.2s ease;\n}\n@keyframes fadeIn-b97c9eb8 {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n.help-modal[data-v-b97c9eb8] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border-radius: 16px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  max-width: 600px;\n  width: 90%;\n  max-height: 80vh;\n  overflow: hidden;\n  animation: slideUp-b97c9eb8 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n@keyframes slideUp-b97c9eb8 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.help-modal-header[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1.5rem;\n  border-bottom: 1px solid #e2e8f0;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n}\n.help-modal-header h3[data-v-b97c9eb8] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.close-btn[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  padding: 0;\n  background: white;\n  border: 1px solid #e2e8f0;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #64748b;\n}\n.close-btn[data-v-b97c9eb8]:hover {\n  background: #fee2e2;\n  border-color: #ef4444;\n  color: #ef4444;\n}\n.help-modal-content[data-v-b97c9eb8] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  max-height: calc(80vh - 80px);\n}\n.help-section[data-v-b97c9eb8] {\n  margin-bottom: 1.5rem;\n}\n.help-section[data-v-b97c9eb8]:last-child {\n  margin-bottom: 0;\n}\n.help-section h4[data-v-b97c9eb8] {\n  margin: 0 0 0.75rem 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.help-section ol[data-v-b97c9eb8] {\n  margin: 0;\n  padding-left: 1.5rem;\n  color: var(--color-text-secondary);\n  line-height: 1.8;\n}\n.help-section ol li[data-v-b97c9eb8] {\n  margin-bottom: 0.5rem;\n}\n.help-section ol li strong[data-v-b97c9eb8] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n.formula-box[data-v-b97c9eb8] {\n  padding: 1rem;\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border-left: 4px solid #f59e0b;\n  border-radius: 8px;\n  margin-bottom: 0.75rem;\n  font-size: 0.875rem;\n  line-height: 1.6;\n  color: #78350f;\n}\n.formula-box strong[data-v-b97c9eb8] {\n  color: #92400e;\n  font-weight: 700;\n}\n.result-list[data-v-b97c9eb8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.result-item[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.75rem 1rem;\n  border-radius: 10px;\n  border: 1px solid;\n  gap: 1rem;\n}\n.result-item.perfect[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);\n  border-color: #fbbf24;\n}\n.result-item.great-success[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\n  border-color: #86efac;\n}\n.result-item.success[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\n  border-color: #93c5fd;\n}\n.result-item.failure[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n  border-color: #fca5a5;\n}\n.result-item.critical-failure[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);\n  border-color: #c084fc;\n}\n.result-label[data-v-b97c9eb8] {\n  font-weight: 700;\n  font-size: 0.875rem;\n  min-width: 60px;\n  opacity: 1;\n}\n.result-desc[data-v-b97c9eb8] {\n  font-size: 0.875rem;\n  flex: 1;\n  opacity: 1;\n}\n\n/* -- 统一文字颜色，仅保留强调色 -- */\n.result-item[data-v-b97c9eb8] {\n  background: var(--color-surface);\n  border-color: var(--color-border);\n}\n.result-label[data-v-b97c9eb8] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.result-desc[data-v-b97c9eb8] {\n  color: var(--color-text-secondary);\n}\n\n/* 仅在标签上应用颜色 */\n.result-item.perfect .result-label[data-v-b97c9eb8] { color: #f59e0b;\n}\n.result-item.great-success .result-label[data-v-b97c9eb8] { color: #10b981;\n}\n.result-item.success .result-label[data-v-b97c9eb8] { color: #10b981;\n}\n.result-item.failure .result-label[data-v-b97c9eb8] { color: #ef4444;\n}\n.result-item.critical-failure .result-label[data-v-b97c9eb8] { color: #a855f7;\n}\n.formula-note[data-v-b97c9eb8] {\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\n  border-left: 4px solid #3b82f6;\n  border-radius: 8px;\n  margin-bottom: 0.75rem;\n  font-size: 0.875rem;\n  line-height: 1.6;\n  color: #1e40af;\n}\n.formula-note strong[data-v-b97c9eb8] {\n  color: #1e3a8a;\n  font-weight: 700;\n}\n.tips-list[data-v-b97c9eb8] {\n  margin: 0;\n  padding-left: 1.25rem;\n  color: #475569;\n  line-height: 1.8;\n}\n.tips-list li[data-v-b97c9eb8] {\n  margin-bottom: 0.5rem;\n}\n.judgement-types[data-v-b97c9eb8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.type-item[data-v-b97c9eb8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  padding: 0.75rem;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-radius: 8px;\n  border: 1px solid #e2e8f0;\n}\n.type-name[data-v-b97c9eb8] {\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #1e293b;\n}\n.type-attrs[data-v-b97c9eb8] {\n  font-size: 0.8125rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.attributes-desc[data-v-b97c9eb8] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 0.75rem;\n}\n.attr-card[data-v-b97c9eb8] {\n  padding: 0.75rem;\n  background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);\n  border-radius: 10px;\n  border: 1px solid #e2e8f0;\n}\n.attr-header[data-v-b97c9eb8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.attr-icon[data-v-b97c9eb8] {\n  font-size: 1.25rem;\n}\n.attr-name[data-v-b97c9eb8] {\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #1e293b;\n}\n.attr-card p[data-v-b97c9eb8] {\n  margin: 0;\n  font-size: 0.8125rem;\n  color: var(--color-text-secondary);\n  line-height: 1.6;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .help-modal[data-v-b97c9eb8] {\n  background: var(--color-surface, #1e293b);\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .help-modal-header[data-v-b97c9eb8] {\n  background: rgba(255, 255, 255, 0.05);\n  border-bottom-color: var(--color-border, rgba(255, 255, 255, 0.1));\n}\n[data-theme="dark"] .help-modal-header h3[data-v-b97c9eb8],\n[data-theme="dark"] .help-section h4[data-v-b97c9eb8] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .help-section ol[data-v-b97c9eb8],\n[data-theme="dark"] .tips-list[data-v-b97c9eb8] {\n  color: var(--color-text-secondary, #94a3b8);\n}\n\n/* -- 深色主题适配 -- */\n/* 仅调整标签颜色以适应深色背景 */\n[data-theme="dark"] .result-item.perfect .result-label[data-v-b97c9eb8] { color: #fcd34d;\n}\n[data-theme="dark"] .result-item.great-success .result-label[data-v-b97c9eb8] { color: #86efac;\n}\n[data-theme="dark"] .result-item.success .result-label[data-v-b97c9eb8] { color: #93c5fd;\n}\n[data-theme="dark"] .result-item.failure .result-label[data-v-b97c9eb8] { color: #fca5a5;\n}\n[data-theme="dark"] .result-item.critical-failure .result-label[data-v-b97c9eb8] { color: #d8b4fe;\n}\n[data-theme="dark"] .close-btn[data-v-b97c9eb8] {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .close-btn[data-v-b97c9eb8]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  border-color: #ef4444;\n}\n[data-theme="dark"] .help-btn[data-v-b97c9eb8] {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .help-btn[data-v-b97c9eb8]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  border-color: var(--card-color, #6366f1);\n  color: var(--card-color, #6366f1);\n}\n[data-theme="dark"] .type-item[data-v-b97c9eb8] {\n  background: rgba(255, 255, 255, 0.03);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n}\n[data-theme="dark"] .type-name[data-v-b97c9eb8] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .type-attrs[data-v-b97c9eb8] {\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .attr-card[data-v-b97c9eb8] {\n  background: rgba(255, 255, 255, 0.03);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n}\n[data-theme="dark"] .attr-name[data-v-b97c9eb8] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .attr-card p[data-v-b97c9eb8] {\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .formula-box[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);\n  border-left-color: #f59e0b;\n  color: #fbbf24;\n}\n[data-theme="dark"] .formula-box strong[data-v-b97c9eb8] {\n  color: #fcd34d;\n}\n\n/* 深色主题幸运点样式 */\n[data-theme="dark"] .lucky-item.lucky-positive[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, rgba(22, 163, 74, 0.15) 0%, rgba(34, 197, 94, 0.1) 100%);\n  border-color: rgba(134, 239, 172, 0.5);\n}\n[data-theme="dark"] .lucky-item.lucky-negative[data-v-b97c9eb8] {\n  background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%);\n  border-color: rgba(252, 165, 165, 0.5);\n}\n[data-theme="dark"] .lucky-positive .lucky-value[data-v-b97c9eb8] {\n  color: #4ade80;\n}\n[data-theme="dark"] .lucky-negative .lucky-value[data-v-b97c9eb8] {\n  color: #f87171;\n}\n[data-theme="dark"] .detail-label[data-v-b97c9eb8] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .detail-value[data-v-b97c9eb8] {\n  color: #f1f5f9;\n}\n[data-theme="dark"] .detail-source[data-v-b97c9eb8] {\n  color: #64748b;\n}\n',""]);const s=i},758:(e,n,t)=>{"use strict";function a(e){if(!e)return null;const n=/```(?:json)?\s*([\s\S]*?)\s*```/gi;for(const t of e.matchAll(n)){const e=(t[1]||"").trim();if(e&&(e.includes("{")||e.includes("[")))return e}const t=[];for(let n=0;n<e.length;n++){const a=e[n];"{"!==a&&"["!==a||t.push(n)}for(const n of t){const t=r(e,n);if(t)return t}return null}function r(e,n){const t=[];let a=!1,r=!1;for(let o=n;o<e.length;o++){const i=e[o];if(a){if(r){r=!1;continue}if("\\"===i){r=!0;continue}'"'===i&&(a=!1)}else if('"'!==i){if("{"===i)t.push("}");else if("["===i)t.push("]");else if("}"===i||"]"===i){if(0===t.length||t[t.length-1]!==i)return null;if(t.pop(),0===t.length)return e.slice(n,o+1).trim()}}else a=!0}return null}function o(e){const n=a(e);if(!n)throw new Error("未找到可解析的 JSON 片段");return JSON.parse(n)}function i(e,n=!1){if(!e||!e.trim())throw new Error("AI返回内容为空");if(n)try{return JSON.parse(e.trim())}catch(n){console.warn("[JSON解析] 强JSON模式解析失败,尝试提取JSON片段:",n);const t=a(e);if(!t)throw new Error("强JSON模式下解析失败,且未找到可提取的JSON片段");return JSON.parse(t)}return o(e)}t.d(n,{$6:()=>i,TK:()=>a,p_:()=>o})},810:(e,n,t)=>{"use strict";t.d(n,{Ey:()=>y,nY:()=>M});var a=t(953),r=t(641);const o="undefined"!=typeof window;let i;const s=e=>i=e,l=Symbol();function c(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var d;!function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"}(d||(d={}));const u=(()=>"object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:"object"==typeof globalThis?globalThis:{HTMLElement:null})();function p(e,n,t){const a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){g(a.response,n,t)},a.onerror=function(){console.error("could not download file")},a.send()}function v(e){const n=new XMLHttpRequest;n.open("HEAD",e,!1);try{n.send()}catch(e){}return n.status>=200&&n.status<=299}function f(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,detail:0,screenX:80,screenY:20,clientX:80,clientY:20,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.dispatchEvent(t)}}const h="object"==typeof navigator?navigator:{userAgent:""},m=(()=>/Macintosh/.test(h.userAgent)&&/AppleWebKit/.test(h.userAgent)&&!/Safari/.test(h.userAgent))(),g=o?"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype&&!m?function(e,n="download",t){const a=document.createElement("a");a.download=n,a.rel="noopener","string"==typeof e?(a.href=e,a.origin!==location.origin?v(a.href)?p(e,n,t):(a.target="_blank",f(a)):f(a)):(a.href=URL.createObjectURL(e),setTimeout(function(){URL.revokeObjectURL(a.href)},4e4),setTimeout(function(){f(a)},0))}:"msSaveOrOpenBlob"in h?function(e,n="download",t){if("string"==typeof e)if(v(e))p(e,n,t);else{const n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){f(n)})}else navigator.msSaveOrOpenBlob(function(e,{autoBom:n=!1}={}){return n&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,t),n)}:function(e,n,t,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return p(e,n,t);const r="application/octet-stream"===e.type,o=/constructor/i.test(String(u.HTMLElement))||"safari"in u,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||r&&o||m)&&"undefined"!=typeof FileReader){const n=new FileReader;n.onloadend=function(){let e=n.result;if("string"!=typeof e)throw a=null,new Error("Wrong reader.result type");e=i?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location.assign(e),a=null},n.readAsDataURL(e)}else{const n=URL.createObjectURL(e);a?a.location.assign(n):location.href=n,a=null,setTimeout(function(){URL.revokeObjectURL(n)},4e4)}}:()=>{},{assign:b}=Object;function y(){const e=(0,a.uY)(!0),n=e.run(()=>(0,a.KR)({}));let t=[],r=[];const o=(0,a.IG)({install(e){s(o),o._a=e,e.provide(l,o),e.config.globalProperties.$pinia=o,r.forEach(e=>t.push(e)),r=[]},use(e){return this._a?t.push(e):r.push(e),this},_p:t,_a:null,_e:e,_s:new Map,state:n});return o}const x=()=>{};function k(e,n,t,r=x){e.add(n);const o=()=>{e.delete(n)&&r()};return!t&&(0,a.o5)()&&(0,a.jr)(o),o}function w(e,...n){e.forEach(e=>{e(...n)})}const _=e=>e(),C=Symbol(),A=Symbol();function S(e,n){e instanceof Map&&n instanceof Map?n.forEach((n,t)=>e.set(t,n)):e instanceof Set&&n instanceof Set&&n.forEach(e.add,e);for(const t in n){if(!n.hasOwnProperty(t))continue;const r=n[t],o=e[t];c(o)&&c(r)&&e.hasOwnProperty(t)&&!(0,a.i9)(r)&&!(0,a.g8)(r)?e[t]=S(o,r):e[t]=r}return e}const L=Symbol();function E(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,L)}const{assign:T}=Object;function I(e){return!(!(0,a.i9)(e)||!e.effect)}function R(e,n,t={},o,i,l){let c;const u=T({actions:{}},t),p={deep:!0};let v,f,h,m=new Set,g=new Set;const b=o.state.value[e];let y;function L(n){let t;v=f=!1,"function"==typeof n?(n(o.state.value[e]),t={type:d.patchFunction,storeId:e,events:h}):(S(o.state.value[e],n),t={type:d.patchObject,payload:n,storeId:e,events:h});const a=y=Symbol();(0,r.dY)().then(()=>{y===a&&(v=!0)}),f=!0,w(m,t,o.state.value[e])}l||b||(o.state.value[e]={}),(0,a.KR)({});const R=l?function(){const{state:e}=t,n=e?e():{};this.$patch(e=>{T(e,n)})}:x,M=(n,t="")=>{if(C in n)return n[A]=t,n;const a=function(){s(o);const t=Array.from(arguments),r=new Set,i=new Set;let l;w(g,{args:t,name:a[A],store:D,after:function(e){r.add(e)},onError:function(e){i.add(e)}});try{l=n.apply(this&&this.$id===e?this:D,t)}catch(e){throw w(i,e),e}return l instanceof Promise?l.then(e=>(w(r,e),e)).catch(e=>(w(i,e),Promise.reject(e))):(w(r,l),l)};return a[C]=!0,a[A]=t,a},P={_p:o,$id:e,$onAction:k.bind(null,g),$patch:L,$reset:R,$subscribe(n,t={}){const a=k(m,n,t.detached,()=>i()),i=c.run(()=>(0,r.wB)(()=>o.state.value[e],a=>{("sync"===t.flush?f:v)&&n({storeId:e,type:d.direct,events:h},a)},T({},p,t)));return a},$dispose:function(){c.stop(),m.clear(),g.clear(),o._s.delete(e)}},D=(0,a.Kh)(P);o._s.set(e,D);const z=(o._a&&o._a.runWithContext||_)(()=>o._e.run(()=>(c=(0,a.uY)()).run(()=>n({action:M}))));for(const n in z){const t=z[n];if((0,a.i9)(t)&&!I(t)||(0,a.g8)(t))l||(b&&E(t)&&((0,a.i9)(t)?t.value=b[n]:S(t,b[n])),o.state.value[e][n]=t);else if("function"==typeof t){const e=M(t,n);z[n]=e,u.actions[n]=t}}return T(D,z),T((0,a.ux)(D),z),Object.defineProperty(D,"$state",{get:()=>o.state.value[e],set:e=>{L(n=>{T(n,e)})}}),o._p.forEach(e=>{T(D,c.run(()=>e({store:D,app:o._a,pinia:o,options:u})))}),b&&l&&t.hydrate&&t.hydrate(D.$state,b),v=!0,f=!0,D}function M(e,n,t){let o;const c="function"==typeof n;function d(t,d){const u=(0,r.PS)();return(t=t||(u?(0,r.WQ)(l,null):null))&&s(t),(t=i)._s.has(e)||(c?R(e,n,o,t):function(e,n,t){const{state:o,actions:i,getters:l}=n,c=t.state.value[e];let d;d=R(e,function(){c||(t.state.value[e]=o?o():{});const n=(0,a.QW)(t.state.value[e]);return T(n,i,Object.keys(l||{}).reduce((n,o)=>(n[o]=(0,a.IG)((0,r.EW)(()=>{s(t);const n=t._s.get(e);return l[o].call(n,n)})),n),{}))},n,t,0,!0)}(e,o,t)),t._s.get(e)}return o=c?t:n,d.$id=e,d}},840:(e,n,t)=>{"use strict";t.d(n,{IJ:()=>v,p$:()=>p,q5:()=>u});var a=t(406),r=t(1513);const o='\n## 输出格式（最高优先级）\n\n**只输出一个 JSON 对象，不要任何解释性文字、思维链、标签！**\n必须直接输出JSON，禁止使用任何代码围栏。\n\n### JSON结构示例：\n {\n   "text": "这里是600-1000字的开局叙事正文...",\n   "mid_term_memory": "这里是50-100字的摘要",\n   "tavern_commands": [\n    {"action":"set","key":"元数据.时间.年","value":1050},\n    {"action":"set","key":"元数据.时间.月","value":1},\n    {"action":"set","key":"元数据.时间.日","value":1},\n    {"action":"set","key":"元数据.时间.小时","value":8},\n    {"action":"set","key":"元数据.时间.分钟","value":0},\n    {"action":"set","key":"角色.身份.出生日期.年","value":1032},\n    {"action":"set","key":"角色.身份.出生日期.月","value":1},\n    {"action":"set","key":"角色.身份.出生日期.日","value":1},\n    {"action":"set","key":"角色.位置.描述","value":"<从可用地点选择>"},\n    {"action":"set","key":"角色.位置.x","value":5000},\n    {"action":"set","key":"角色.位置.y","value":5000},\n    {"action":"set","key":"角色.位置.区域等级","value":"黄区"},\n    {"action":"set","key":"角色.身体","value":{"身高":175,"体重":65,"体脂率":15,"三围":{"胸围":90,"腰围":75,"臀围":90},"肤色":"黄皮肤","发色":"黑发","瞳色":"黑瞳","纹身与印记":[],"穿刺":[],"敏感点":[],"开发度":{},"其它":{}}},\n    {"action":"set","key":"角色.属性.声望","value":10},\n    {"action":"set","key":"角色.属性.生命值.当前","value":100},\n    {"action":"set","key":"角色.属性.生命值.上限","value":100},\n    {"action":"set","key":"角色.属性.精神力.当前","value":100},\n    {"action":"set","key":"角色.属性.精神力.上限","value":100},\n    {"action":"set","key":"角色.属性.体力.当前","value":100},\n    {"action":"set","key":"角色.属性.体力.上限","value":100},\n    {"action":"set","key":"角色.属性.理智值.当前","value":100},\n    {"action":"set","key":"角色.属性.理智值.上限","value":100},\n    {"action":"set","key":"角色.属性.寿命.当前","value":28},\n    {"action":"set","key":"角色.属性.寿命.上限","value":90},\n    {"action":"set","key":"角色.身份.觉醒阶段.阶段名","value":"凡人"},\n    {"action":"set","key":"角色.身份.觉醒阶段.突破描述","value":"需在极端环境中概率觉醒"},\n    {"action":"set","key":"角色.背包.货币.突变结晶_下级","value":{"币种":"突变结晶_下级","名称":"下级突变结晶","数量":10,"价值":1,"单位":"枚"}},\n    {"action":"set","key":"角色.身份.异能名称","value":"<中文名>"},\n    {"action":"set","key":"角色.身份.异能类型","value":"<类别>"},\n    {"action":"set","key":"角色.身份.异能描述","value":"<一句话描述>"},\n    {"action":"set","key":"角色.身份.异能代价","value":"<文字描述>"}\n   ],\n   "action_options": ["<符合场景的选项1>","<选项2>","<选项3>","<选项4>","<选项5>"]\n }\n\n⚠️ **年龄计算公式（必须遵守）**：\n- **公式**: 出生日期.年 = 元数据.时间.年 - 玩家年龄（若出生月/日晚于当前月/日，则年 = 时间.年 - 玩家年龄 - 1）\n- **示例**: 玩家18岁，时间1050年 → 出生日期 = 1050-18 = 1032年\n- ❌ 漏设任一项会导致年龄显示为0岁或异常值！\n\n⚠️ **身体数据必须根据角色实际情况生成**：\n- 根据性别、年龄、种族合理设定身高/体重/三围等\n- 男性与女性数值差异明显，儿童与成人不同\n- ❌ 严禁照抄示例数值！\n\n### 关键要求：\n1. **text字段**:\n   - 600-1000字的开局叙事\n   - 只写故事正文，不要夹带任何游戏数据、JSON、变量名\n   - 沉浸式废土求生文风，不要出现"玩家"、"获得"等游戏术语\n\n2. **mid_term_memory字段**:\n   - 50-100字摘要\n   - 必填，不能为空\n   - 概括开局的核心信息\n\n3. **tavern_commands字段**:\n   - 必须是数组\n   - 每个命令格式：{"action":"set","key":"路径","value":值}\n   - 所有key必须以 `元数据.`/`角色.`/`社交.`/`世界.`/`系统.` 开头（V3短路径）\n   - ⚠️ **酒馆端必须包含 `角色.身体` 命令**（见下方示例）\n\n4. **action_options字段**:\n   - 必须输出5个选项\n   - 不能为空\n   - 要符合当前场景\n\n### 禁止事项：\n- ❌ 不要输出 `<thinking>` 或任何思维链标签\n- ❌ 不要输出解释性文字\n- ❌ 不要在text中夹带游戏数据\n'.trim(),i='\n## 初始化命令（tavern_commands）\n\n### ⚠️ 必须执行的命令（缺一不可）：\n\n1. **时间+出生日期（必须成对设置！）**\n   - 只能对**子字段**执行 set，禁止对核心路径整体 set\n     - ✅ 正确：`{"action":"set", "key":"元数据.时间.年", "value":1050}`\n     - ❌ 错误：`{"action":"set", "key":"元数据.时间", "value":{...}}` (会导致数据丢失!)\n   - `元数据.时间.年/月/日/小时/分钟` 分别设置\n   - `角色.身份.出生日期.年/月/日` 分别设置\n   - **公式**: 出生日期.年 = 时间.年 - 玩家年龄\n   - ❌ 漏设任一项会导致年龄显示为0岁或异常值！\n\n2. **位置** - 设置 `角色.位置`\n   - 必须在 tavern_commands 的前4条内出现\n   - 只能对**子字段**执行 set，禁止对核心路径整体 set\n     - ✅ 正确：`{"action":"set", "key":"角色.位置.描述", "value":"xx"}`\n     - ❌ 错误：`{"action":"set", "key":"角色.位置", "value":{...}}` (会导致数据丢失!)\n   - 分别设置：`角色.位置.描述`、`角色.位置.x`、`角色.位置.y`、`角色.位置.区域等级`\n   - `描述` 必须是"2-3层级"的地名，用 `·` 分隔，例如："废墟城联邦·第7区·地下避难所"\n   - `区域等级` 必须为以下枚举之一："绿区"|"黄区"|"橙区"|"红区"|"黑区"\n   - **优先从可用地点列表中选择**\n   - **禁止** 使用占位文本："位置生成失败"/"无名之地"/"待生成"/"暂无"/"unknown"/"undefined"/"null"\n   - 坐标范围: x:0-10000, y:0-10000\n\n3. **⚠️ 玩家法身**\n   - **命令**：`{"action":"set","key":"角色.身体","value":{...}}`\n   - **必填字段**（根据角色性别/年龄/种族合理生成）：\n     - 身高: number (cm) - 男性165-185，女性155-170，儿童按年龄\n     - 体重: number (kg) - 与身高匹配\n     - 体脂率: number (%) - 男性10-25，女性18-30\n     - 三围: {胸围, 腰围, 臀围} (cm) - 根据性别体型\n     - 肤色/发色/瞳色: string\n     - 纹身与印记/穿刺: [] (空数组)\n     - 敏感点: [] (空数组)\n     - 开发度/其它: {} (空对象)\n   - **nsfwMode=true时额外生成**：胸部描述/私处描述/生殖器描述\n   - ❌ **严禁**：使用"待AI生成"/"暂无"/"空"等占位文本\n   - ❌ **严禁**：照抄示例数值，必须根据实际角色生成\n\n4. **声望** - 设置 `角色.属性.声望`\n   - 普通出身: 0-10 | 势力出身: 10-50 | 财阀出身: 50-100\n\n5. **核心属性状态（必须分别设置子字段！）**\n   - ❌ **严禁**直接 set `角色.属性.生命值` 等父对象\n   - 必须分别 set `当前` 和 `上限`：\n     - `角色.属性.生命值.当前` / `角色.属性.生命值.上限`\n     - `角色.属性.精神力.当前` / `角色.属性.精神力.上限`\n     - `角色.属性.体力.当前` / `角色.属性.体力.上限`\n     - `角色.属性.理智值.当前` / `角色.属性.理智值.上限`\n     - `角色.属性.寿命.当前` / `角色.属性.寿命.上限`\n   - **觉醒阶段**：\n     - 必须分别 set：`角色.身份.觉醒阶段.阶段名`、`角色.身份.觉醒阶段.当前进度`、`角色.身份.觉醒阶段.下一级所需`、`角色.身份.觉醒阶段.突破描述`\n     - ❌ **严禁**直接 set `角色.身份.觉醒阶段`\n\n6. **随机项** - 若出身为"随机"\n   - 用 `set` 写入 `角色.身份.出生` 的具体内容\n\n7. **资源** - 设置初始资源\n   - 推荐使用 `set` 设置具体数量：`角色.背包.货币.突变结晶_下级.数量`\n   - **新增币种/物品**：必须使用 `set` 写入完整对象\n     - ✅ 正确：`{"action":"set", "key":"角色.背包.物品.物品_时间戳_随机数", "value":{"物品ID":"物品_时间戳_随机数","名称":"xx","类型":"物品","品质":{"quality":"普通","grade":3},"数量":1,"描述":"..."}}`\n     - ❌ 错误：`{"action":"add", "key":"角色.背包.物品.item_id", "value":{...}}` (ADD只能用于数字!)\n   - ❌ **严禁**使用 `add` 操作新增对象（`add` 只能用于数字累加）\n\n8. **NPC** - 仅创建文本中明确提到的重要人物（0-3个）\n  - 写入 `社交.关系.{NPC中文名}`\n  - **必填字段**：出生(出身背景,如"拾荒者"/"财阀子弟",⚠️非年龄!)/出生日期({年,月,日})/核心属性（六维：意志/敏捷/力量/体质/魅力/幸运）/外貌描述(50字+)/性格特征(3个+)/天赋/记忆(2条+)/属性\n   - ⚠️ **禁止生成"年龄"字段**，年龄由系统根据出生日期自动计算\n\n### 约束：\n- 所有 key 必须以 `元数据.`/`角色.`/`社交.`/`世界.`/`系统.` 开头\n- 每个命令格式：{"action":"set","key":"路径","value":值}\n- 不要使用 add/push/delete 等其他操作，开局只用 set（add 仅用于数值累加，不能用于对象）\n'.trim(),s='\n## 叙事要求与文风设定\n\n### 文风基调\n- **混沌纪元/废土求生风**: 语言要冷峻写实，富有画面感。可以适度使用过于现代的轻松白话、网络用语。\n- **沉浸式体验**: 侧重描写环境的荒凉/压抑、突变生物的威胁、辐射的刺痛感、角色的生存本能，而非单纯罗列数据。\n- **禁止游戏术语**: 文本中严禁出现"玩家"、"获得"、"装备了"、"等级提升"等出戏词汇。\n\n### 求生逻辑与难度\n- **生存之难**: 必须体现废土生存是"挣扎求存"，每一步都充满危机。严禁出现"轻易获得"、"随便变异成功"、"瞬间觉醒"等过于随意和容易的描述（即使是天才，也要体现出代价与风险）。\n- **时间感知**: 废土无岁月，要体现出时间的流逝感（如"漫漫长夜"、"潜伏数日"）。\n- **阶级严谨**: 只有通过引导术并经过生死磨砺才能觉醒。凡人开局绝不可能在此次生成中直接觉醒。\n- **压迫感呈现**: 当敌我强弱差距显著（如对方阶段≥我方+2、或威胁等级远高于我方承受阈值），叙事需体现压迫感与失控边缘：\n  - 生理与感知：心率失衡、呼吸急促、视野收缩、耳鸣、动作迟滞\n  - 环境压力：空间如同被挤压、地面震颤、光线与温度令人不适\n  - 行为选择：优先规避/撤退/隐蔽/求援/谈判，避免不合逻辑的正面强杀\n  - 结果基调：代价上升与失败可能性增大，胜利需有合理铺垫与付出\n\n### 角色塑造\n- **年龄**: 严格从玩家选择的年龄开始，行为举止要符合该年龄段的认知（不要让几岁的孩童表现得过于老成，除非是变异影响）。\n- **一致性**: 出身与属性决定了角色的资源、起点与行为逻辑，必须与玩家选择完全匹配。\n'.trim(),l='\n## 初始资源控制（严格执行）\n\n### 初始资金（按“下级突变结晶折算”）\n- **贫困/流浪**: 0-10\n- **凡人/普通**: 10-50\n- **异能家族/势力**: 100-300\n- **富裕/财阀**: 300-800\n\n### 物品与装备\n- **数量限制**: 1-5件，宁缺毋滥。\n- **品质限制**: 初始物品必须以**普通**为主。严禁开局直接给予"稀有"、"史诗"甚至"传说"物品（除非选择了顶级"天选之人"类出身，且必须有剧情铺垫）。\n- **引导术**: 0-2部。大多数凡人开局不应自带引导术，需在剧情中获取或加入势力后获得。\n\n### NPC与关系\n- **数量**: 0-3个（必须是剧情中产生深刻羁绊的重要人物，路人甲不要生成关系）。\n- **关系**: 初始好感度不宜过高（除非是血亲），体现末世人情冷暖。\n\n### 觉醒阶段判定\n- **凡人**: 绝大多数开局应为凡人（觉醒进度0）。\n- **觉醒期**: 仅当出身为"异能家族"且年龄较大，或有特殊奇遇背景时，才允许设定为觉醒期（初期）。\n'.trim(),c='\n## 异能生成（仅混沌纪元）\n1. 仅生成身份上的异能字段：\n   - 异能名称: 中文名称（2-6字，避免中二滥用）\n   - 异能类型: 变异类型（如：生理变异/能量操控/感知强化/形态转化/空间干涉/时间错觉/信息污染/心智影响）\n   - 异能描述: 一句话描述其效果与风险\n   - 异能代价: 文字描述（如每次施展消耗精神力/体力等，以及长期副作用）\n2. 禁止生成“异能列表/等级列表/激活条件/属性.异能模块”等冗余结构\n3. 命令写入路径：角色.身份.异能名称/异能类型/异能描述/异能代价\n4. 异能效果应用（永久/主动）：\n   - 永久效果：将属性增减写入 角色.身份.后天属性（中文六维键：力量/敏捷/体质/意志/魅力/幸运），必须使用 set 写入完整对象；禁止对对象使用 add\n   - 主动效果：作为“状态效果”写入 角色.效果[]，包含字段：\n     - 状态名称/类型(buff|debuff)/状态描述/来源("异能")/剩余时间("X分钟")/属性加成(中文六维键，可为负数)\n   - 持续时间单位必须为“X分钟”，禁止使用 "min"、纯数字或其他单位\n   - 属性键支持英文别名，但优先使用中文六维键（strength→力量等）\n\n### 异能获取与突破约束（CRITICAL）\n- 触发条件：仅允许在极端环境下发生（生命濒危/理智崩溃/重伤/高危异常暴露/致命压制/绝境求生）\n- 禁止修炼逻辑：任何“打坐/闭关/常规训练/日常练习/冥想积累”均不得产生异能或突破\n- 判定要求：必须使用〔成长/战斗/感知/探索〕判定，并写明关键因素（阶段差/状态/环境/资源/时间）\n- 代价与后果：失败或大失败需给出明确后果（伤害/理智下降/负面状态/进度倒退）；成功也需付出代价（消耗/副作用/永久上限变化）\n- 时间与位置：必须更新元数据.时间（分钟/小时）与角色.位置，禁止瞬间完成\n- 记录更新：突破时必须用 set 写入 角色.身份.觉醒阶段 的具体子字段，并用 push 角色.效果 记录后遗症或状态\n\n### 异能示例参考（风格参考）\n- **骨刃增生** (攻击与分泌系统): 前臂刺出骨刃，消耗SP8/ST5。代价: 皮肤龟裂，骨质增生畸形。\n- **视觉寄生** (共生/拟态系统): 共享他人视野，消耗SP12/SAN3。代价: 自我认知模糊，混淆记忆。\n- **肾上腺素超频** (内部环境/规则干涉): 临时大幅提升属性，消耗HP15/全部ST。代价: 心脏负荷过重，寿命缩短。\n- **信息素伪装** (感知与神经系统): 伪装同类，消耗ST10/SP5。代价: 体味消失，嗅觉退化，被同类疏远。\n- **重力畸变** (规则干涉系): 改变局部重力，消耗SP20/ST15/SAN4。代价: 内耳受损，平衡感丧失。\n\n### ✅/❌ 示例\n✅ 永久异能加成写入：\n{"action":"set","key":"角色.身份.后天属性","value":{"力量":0,"敏捷":0,"体质":2,"意志":1,"魅力":0,"幸运":0}}\n✅ 主动异能状态写入：\n{"action":"set","key":"角色.效果","value":[{"状态名称":"肾上腺素超频","类型":"buff","状态描述":"短时提升反应与力量","来源":"异能","剩余时间":"30分钟","属性加成":{"敏捷":3,"力量":2}}]}\n❌ 错误：写入到 角色.属性.异能 或 使用"30min"单位\n'.trim(),d=`\n# 角色初始化任务\n\n${o}\n\n---\n\n${i}\n\n---\n\n${s}\n\n---\n\n${l}\n\n---\n\n# 数据结构\n${a.Ps}\n`.trim();function u(){return d}function p(e,n){const{name:t,gender:a,race:r,age:o,world:i,talentTier:s,origin:l,talents:c,attributes:d,difficultyPrompt:u}=e,p="object"==typeof l&&null!==l,v=(e=>{const n={year:o,month:1,day:1};if(!e||"string"!=typeof e)return n;const t=e;return t.includes("灾变前夜")?{year:-1,month:12,day:31}:t.includes("第一周")?{year:0,month:1,day:7}:t.includes("第一个月")?{year:0,month:1,day:1}:t.includes("一年")?{year:1,month:1,day:1}:t.includes("五年")?{year:5,month:1,day:1}:t.includes("十年")?{year:10,month:1,day:1}:t.includes("二十五年")?{year:25,month:1,day:1}:t.includes("五十年")?{year:50,month:1,day:1}:t.includes("一百年")?{year:100,month:1,day:1}:n})(i?.era||""),f=c.length>0?c.map(e=>`- ${e.name}: ${e.description}`).join("\n"):"无",h={charm:"魅力",constitution:"体质",agility:"敏捷",strength:"力量",willpower:"意志",luck:"幸运"},m=Object.entries(d).map(([e,n])=>`${h[e]||e}:${n}`).join(", "),g=n?.availableContinents?.map(e=>`- ${e.name||e.名称}`).join("\n")||"(未生成)",b=n?.availableLocations?.slice(0,8).map(e=>`- ${e.name||e.名称} (${e.type||e.类型})`).join("\n")||"(未生成)";return`\n# 玩家角色数据\n\n## 基础信息\n姓名: ${t} | 性别: ${a} | 种族: ${r} | 年龄: ${o}岁\n\n## 当前时间设定\n当前世界时间: 纪元 ${v.year} 年${v.month?` ${v.month} 月`:""}${v.day?` ${v.day} 日`:""}\n⚠️ **所有NPC的出生日期必须基于此时间倒推！**\n- 例如：20岁NPC出生于 ${v.year-20} 年（即纪元 ${v.year-20} 年）。\n- ❌ **严禁**使用"2025"、"2115"等与当前纪元无关的年份！\n- ❌ **严禁**生成未来的出生日期（出生年 > 当前年）！\n\n## 世界\n${i.name} (${i.era})\n${i.description}\n\n## 天资\n${s.name}: ${s.description}\n\n## 出身\n${p?l.name:l}: ${p?l.description:"(随机，需AI生成)"}\n\n## 天赋\n${f}\n\n## 核心属性（六维）\n${m}\n\n---\n\n## 可用地点\n**大陆**:\n${g}\n\n**地点**:\n${b}\n\n⚠️ 位置必须从上述地点选择，坐标范围: x:0-10000, y:0-10000\n\n---\n\n## 难度设置\n${u||"【难度模式：普通】\n- 世界遵循正常求生规则，机缘与危险并存"}\n\n---\n\n## 系统设置\n${n?.systemSettings?.isTavernEnv?'- **运行环境**: 酒馆端 ✅\n\n### ⚠️⚠️⚠️ 酒馆端必须执行以下命令 ⚠️⚠️⚠️\n```\n{"action":"set","key":"角色.身体","value":{身高,体重,体脂率,三围:{胸围,腰围,臀围},肤色,发色,瞳色,纹身与印记:[],穿刺:[],敏感点:[],开发度:{},其它:{}}}\n```\n- ⚠️ 必须根据角色性别/年龄/种族填写合理的具体数值\n- ❌ 严禁使用"待AI生成"/"暂无"/"空"等占位文本\n- ❌ 严禁照抄示例，每个角色数据都不同':"- **运行环境**: 单机端（不需要生成法身数据）"}\n${n?.systemSettings?.nsfwMode?`- **NSFW模式**: 已开启\n- **私密信息生成范围**: ${"all"===n?.systemSettings?.nsfwGenderFilter?"所有NPC":"female"===n?.systemSettings?.nsfwGenderFilter?"仅女性NPC":"仅男性NPC"}\n  ⚠️ 创建NPC时，若NPC性别符合上述范围，必须生成完整的"私密信息(PrivacyProfile)"字段\n  ⚠️ 私密信息需补全：性经验等级/亲密节奏/亲密需求/安全偏好/避孕措施/生育状态/亲密偏好/禁忌清单/身体部位反应-偏好-禁忌\n  ⚠️ 玩家法身：除基础体格外，还需生成敏感字段（胸部描述/私处描述/生殖器描述/敏感点/开发度）`:"- **NSFW模式**: 已关闭（不生成私密信息/敏感字段）"}\n\n---\n\n## 输出要求\n严格遵循系统的JSON输出规则：\n- 不要输出 \`<thinking>\` / 思维链 / 任何推理过程标签\n- 正文写入 JSON 的 "text" 字段（不要再输出 "<narrative>" 等标签）\n- 行动选项写入 JSON 的 "action_options" 字段（5个）\n`.trim()}async function v(){return`${await(0,r.q)([])}\n\n---\n\n# 当前任务：角色初始化\n\n你现在需要执行角色初始化任务。用户将提供角色的基础信息（姓名、性别、年龄、天赋、出身等），你需要：\n1. 根据用户选择生成1000-1500字的开局叙事\n2. 通过tavern_commands设置初始数据（时间、位置、资源、NPC等）\n3. 输出5个行动选项\n\n**立即执行任务，输出JSON格式的角色初始化数据。**\n\n---\n\n${o}\n\n---\n\n${i}\n\n---\n\n${s}\n\n---\n\n${l}\n\n---\n\n${c}\n`.trim()}'\n# 任务：生成层级地点名\n\n输入: INPUT_PLACEHOLDER\n输出: {"location_name": "区域·建筑·场所"}\n\n要求:\n1. 2-3层级，用"·"分隔\n2. 体现世界特点\n3. 只返回JSON\n'.trim()},876:(e,n,t)=>{"use strict";t.d(n,{s:()=>c});var a=t(953);const r=localStorage.getItem("language"),o="zh"===r||"en"===r?r:"zh";r||localStorage.setItem("language","zh");const i=(0,a.KR)(o),s=e=>{"undefined"!=typeof document&&(document.documentElement.lang=e,document.documentElement.dataset.lang=e)};s(o);const l={新增:"Add",确认:"Confirm",取消:"Cancel",保存:"Save",删除:"Delete",编辑:"Edit",关闭:"Close",搜索:"Search",加载中:"Loading",重置:"Reset",返回:"Back",下一步:"Next",上一步:"Previous",完成:"Finish",设置:"Settings",提交:"Submit",刷新:"Refresh",导出:"Export",导入:"Import",清空:"Clear",添加:"Add",移除:"Remove",更新:"Update",查看:"View",下载:"Download",上传:"Upload",复制:"Copy",粘贴:"Paste",剪切:"Cut",全选:"Select All",展开:"Expand",收起:"Collapse",详情:"Details",帮助:"Help",关于:"About",跳过:"Skip",重试:"Retry",世界信息:"World Info",道号:"Username",令牌:"Password",确认令牌:"Confirm Password",请输入您的道号:"Enter username",请输入您的身份令牌:"Enter password",请再次输入令牌:"Re-enter password",初入道门:"Register",登入洞天:"Login",注册:"Register",登入:"Login","已有道号？立即登入":"Have account? Login","初来乍到？注册身份":"New? Register","注册新身份，踏入进化之路。":"Register to begin evolution","验证道友身份，以便同步云端天机。":"Login to sync progress",正式版:"Release","混沌纪元 · 逆行求生":"Chaos Era: Survival",单机闭关:"Offline",独自求生·心无旁骛:"Solo Survival","独居避难所，专心致志强化生存能力":"Survive alone","所有进度本地存储，断网亦可修行":"All progress saved locally",联机求生:"Online",未开放:"Coming Soon","功能研发中，敬请期待":"Under development","当前版本已封锁联机入口，不影响单机闭关体验":"Online locked",已授权:"Authorized",未授权:"Unauthorized",混:"Chaos",沌:"Era","秩序崩塌，万物异变，唯有进化方能生存":"Order collapses, all things mutate, only evolution leads to survival",择一路线:"Choose Your Path","独自求生 · 心无旁骛":"Secluded survival · single-minded focus","独居洞府，专心修炼，所有进度本地存储":"Live in a secluded shelter, focus on evolution, all progress saved locally.",本地存储:"Local Save",离线可用:"Offline Available","队友相伴 · 共存废土":"Companions on the path · survive the wasteland together","通道未启 · 暂不可入":"Gateway unopened · temporarily unavailable","云端存档，多端同步，与幸存者共闯末世":"Cloud saves, multi-device sync, journey with fellow survivors.",云端同步:"Cloud Sync",数据安全:"Data Secure",已连接:"Connected",同步中:"Syncing",联机未启用:"Online Unavailable",'未配置后端服务器，无法使用联机共修与登录功能。请先选择"单机闯关"。':'Backend not configured; online cultivation and login unavailable. Please select "Single Player" first.',知道了:"Got it",请先登录:"Please log in","联机共修需要先登录账号，是否前往登录？":"Online cultivation requires login. Go to login now?",前往登录:"Go to Login",角色状态:"Character",进化状态:"Evolution",核心数值:"Vitals",生命值:"HP",精神力:"SP",理智值:"SAN",体力:"ST",寿命:"Lifespan",觉醒阶段:"Awakening Stage",觉醒阶段状态:"Awakening Stage",觉醒阶段进度:"Progress",当前异能:"Current Ability",异能代价:"Ability Costs",暂无异能:"No Ability",声望:"Reputation",天赋神通:"Talents",状态效果:"Effects",籍籍无名:"Unknown","等待觉醒，感知异源":"Awaiting awakening, sensing source",暂无天赋神通:"No talents yet",清净无为:"Clear and tranquil",增:"Buff",减:"Debuff",请选择角色开启末世之旅:"Select character to begin",时:"h",分:"m",分钟:"min",自定义天赋:"Custom Talent","天赋《":'Talent "',"》的详细描述暂未开放，请期待后续更新。":'" details coming soon.',恶名昭彰:"Notorious",臭名远扬:"Infamous",声名狼藉:"Disreputable",恶名在外:"Bad Reputation",小有恶名:"Slightly Notorious",传说人物:"Legendary",名满天下:"World-Renowned",威震四方:"Awe-Inspiring",名动一方:"Locally Famous",声名远播:"Well-Known",小有名气:"Slightly Famous",游戏功能:"Functions",进化管理:"Evolution",背包物品:"Inventory",查看道具装备:"Items",人物详情:"Character",查看觉醒阶段:"Awakening Stage",异能训练:"Abilities",异能衍生技能:"Skills",红尘俗事:"Worldly Affairs",人物关系:"Relations",人情世故网络:"Social",势力信息:"Faction",门派势力详情:"Faction",任务日志:"Quests",当前任务进度:"Progress",世界探索:"Explore",世界地图:"World Map",事件探索:"Events",世界事件:"World Events",世界变革与危机:"World upheavals",坤舆图志:"Explore",记忆中心:"Memory",重要事件回顾:"Events",游戏变量:"Variables",查看游戏数据:"Game data",系统设置:"Settings",偏好设置:"Preferences",保存游戏:"Save",保存当前进度:"Save progress",退出游戏:"Exit",返回主菜单:"Menu",通讯频道:"Online Play",与幸存者通讯:"Chat",退出当前游戏:"Exit game","联机功能开发中...":"Online coming soon...","您想如何退出当前游戏？":"How would you like to exit the current game?",保存并退出:"Save and Exit",不保存直接退出:"Exit Without Saving",游戏已保存:"Game Saved","游戏保存失败，但仍会继续退出。":"Save failed, but will still exit.",游戏进度未保存:"Game progress not saved.",characterStatus:"Character Status",evolutionStatus:"Evolution Status",qi:"Qi",spiritual:"Spiritual",consciousness:"Consciousness",lifespan:"Lifespan",realmStatus:"Realm Status",游戏设置:"Settings",自定义您的游戏体验:"Customize experience",显示设置:"Display",语言设置:"Language",选择界面语言:"Select language",主题模式:"Theme",选择明亮或暗黑主题:"Choose theme",明亮:"Light",暗黑:"Dark",跟随系统:"Auto",界面缩放:"UI Scale",调整UI界面大小:"Adjust size",文字大小:"Font Size",调整游戏文字显示大小:"Adjust text",小:"Small",中:"Medium",大:"Large",快速动画:"Fast Animations",加速界面动画和过渡效果:"Speed up transitions",显示提示:"Show Hints",显示游戏操作提示:"Display hints",高级设置:"Advanced",调试模式:"Debug Mode",开启开发者调试功能:"Dev tools",数据管理:"Data",导出数据:"Export",导出游戏存档:"Export save",导入数据:"Import",导入游戏存档:"Import save",清空数据:"Clear Data",清空所有游戏数据:"Clear all",清理缓存:"Clear Cache",清除游戏临时数据和缓存:"Clear cache",清理:"Clear",导出设置:"Export Settings",备份当前设置配置:"Backup settings",中文:"Chinese",显示操作提示和帮助信息:"Display operation hints and help",行动选项:"Action Options",AI生成可选的行动建议:"AI-generated action suggestions",游戏时间推进时自动发生影响世界的事件:"World events occur as time passes","事件间隔（月）（最小）":"Min interval (months)","随机事件最短间隔（月）":"Shortest interval (months)","事件间隔（月）（最大）":"Max interval (months)","随机事件最长间隔（月）":"Longest interval (months)",自定义事件提示词:"Custom Event Prompt","为世界事件生成添加自定义指令（可选）":"Add custom event instructions (optional)","例如：更偏向势力混战、秘境现世、好友遭遇，并尽量让事件影响玩家...":"e.g.: Focus on faction wars, secret realms, friends, and impact the player...",下次事件:"Next Event",重新抽取下一次世界事件的触发时间:"Resample next world event time",重新抽取:"Resample",系统任务类型:"System Quest Type",选择AI生成任务的风格类型:"Select AI quest style",生存辅助系统:"Survival System",羁绊养成系统:"Bond System",势力发展系统:"Faction Development System",探索冒险系统:"Exploration System",战斗挑战系统:"Combat System",资源收集系统:"Resource Collection System",自定义任务提示词:"Custom Quest Prompt","为AI任务生成添加自定义指令（可选，留空使用默认）":"Add custom instructions (optional)","例如：生成更多战斗类任务，奖励偏向突变结晶...":"e.g.: More combat quests, spirit stone rewards...",自定义行动选项提示词:"Custom Action Prompt","指导AI生成特定风格的行动选项（可选，留空使用默认）":"Guide AI action style (optional)","例如：多生成修炼和探索类选项，减少战斗选项...":"e.g.: More cultivation options, less combat...","🔞 启用成人内容（私密信息）":"🔞 Enable Adult Content","生成和显示NPC的私密信息模块（包含成人向内容，默认开启）":"Generate NPC private info (adult content)","👥 私密信息生成范围":"👥 Private Info Scope",选择为哪些性别的NPC生成私密信息:"Select NPC gender for private info",所有NPC:"All NPCs","🔧 高级设置":"🔧 Advanced",启用开发者调试信息和详细日志:"Enable debug logs",控制台调试:"Console Debug",在浏览器控制台显示详细调试信息:"Show console debug info",性能监控:"Performance Monitor",监控组件性能和加载时间:"Monitor performance",导入设置:"Import Settings",从文件恢复设置配置:"Restore from file",语言设置已更新:"Language updated",设置面板:"Settings Panel","加载设置失败，将使用默认设置":"Failed to load settings, using defaults",设置已保存并应用:"Settings saved",保存设置失败:"Failed to save settings",设置验证失败:"Settings validation failed",重置设置:"Reset Settings","确定要重置所有设置为默认值吗？这将清除所有自定义配置。":"Reset all settings to default?",确认重置:"Confirm Reset",设置已重置为默认值:"Settings reset to default","确定要清理缓存吗？这将删除临时数据但不会影响存档。":"Clear cache? Temporary data only.",确认清理:"Confirm Clear",已清理:"Cleared",项缓存数据:" cache items",清理缓存失败:"Failed to clear cache","仙途 v1.0.0":"The Great Way v1.0.0","仙途-设置备份-":"GreatWay-Settings-",设置已导出:"Settings exported",导出设置失败:"Export failed",设置导入成功并应用:"Settings imported",无效的设置文件格式:"Invalid settings file","导入设置失败，请检查文件格式":"Import failed, check format",授权验证成功:"Authorization verified",清除授权验证:"Clear Authorization","确定要清除当前的授权验证信息吗？清除后需要重新验证。":"Clear authorization? Re-verification required.",授权验证信息已清除:"Authorization cleared",请先完成授权验证:"Complete authorization first",角色创建:"Character Creation",创建新角色:"Create Character",角色名称:"Name",请输入角色名称:"Enter name",选择世界:"Select World",选择出身:"Select Origin",选择天赋:"Select Talent",异能潜质:"Select Ability Potential",分配属性:"Allocate Attributes",预览:"Preview",开始末世之旅:"Begin Journey",世界选择:"World",天赋选择:"Talent",出身选择:"Origin",潜质选择:"Potential",属性分配:"Attributes",角色预览:"Preview",单机模式:"Offline",联机模式:"Online",返回道途:"Back to Menu",开启征程:"Begin",剩余命运点:"Points",剩余点数:"Points","消耗点数: {0}":"Cost: {0} pts",点数消耗:"Cost",点:"pts",剩余点数必须是非负数:"Points must be non-negative",初入废土:"Begin Cultivation","📂 加载预设":"📂 Load Preset","🗑️ 清除自定义":"🗑️ Clear Custom","☁️ 清除云端":"☁️ Clear Cloud",位面选择:"Select World",天资评估:"Choose Talent Tier",出身背景:"Select Origin",异能潜质选择:"Select Ability Potential","正在扫描平行世界...":"Loading worlds...",数据损坏:"Error",自定义世界:"Custom World",AI推演:"AI Generate",暂无本地世界数据:"No local worlds",暂无云端世界数据:"No cloud worlds",请检查网络连接或联系管理员:"Check network","请择一方世界，以定生存基调。":"Select a world",世界名称:"World Name",时代背景:"Era",世界描述:"Description","例如：九霄界":"e.g.: Nine Heavens","例如：秩序崩坏":"e.g.: Order Collapse","描述这个世界的背景故事、力量体系特点等...":"Describe the world...",世界名称不可为空:"World name required",'自定义世界 "{0}" 已成功保存！':'World "{0}" saved!',"AI演算中，请稍候...":"AI generating...",AI推演失败:"AI failed","AI推演结果格式错误，无法解析":"Invalid AI response",AI推演结果缺少世界名称:"Missing world name",'AI推演完成！世界 "{0}" 已生成':'World "{0}" generated!',"AI推演失败: {0}":"AI failed: {0}",世界规模配置:"World Config",主要势力:"Major Factions",地点总数:"Total Locations",秘境数量:"Secret Realms",大陆数量:"Continents","推荐: 3-8":"Recommended: 3-8","推荐: 8-15":"Recommended: 8-15","推荐: 3-10":"Recommended: 3-10","范围: 3-7":"Range: 3-7","高级选项（地图技术参数）":"Advanced Options",地图宽度:"Map Width",地图高度:"Map Height","推荐: 3600":"Recommended: 3600","推荐: 2400":"Recommended: 2400",经度范围:"Longitude Range",纬度范围:"Latitude Range",最小经度:"Min Lng",最大经度:"Max Lng",最小纬度:"Min Lat",最大纬度:"Max Lat",随机:"Random",已随机生成世界配置:"Config randomized",已重置为默认配置:"Config reset",配置过高警告:"Config Warning","当前配置可能导致生成失败，建议调整至合理范围":"Config too high",编辑此项:"Edit",删除此项:"Delete",编辑世界:"Edit World",'世界 "{0}" 已更新！':'World "{0}" updated!',"更新世界失败！":"Update failed!","扫描基因，评估天资...":"Loading talent tiers...",数据混乱:"Error",自定义天资:"Custom Tier",天资名称:"Tier Name",天资描述:"Description",命运点:"Points",辉光颜色:"Glow Color","例如：凡人":"e.g.: Mortal","描述此天资的特点...":"Describe this tier...","例如：10":"e.g.: 10","例如：#808080":"e.g.: #808080",天资名称不可为空:"Tier name required",天道点必须是非负数:"Points must be non-negative",'自定义天资 "{0}" 已保存！':'Tier "{0}" saved!',"保存自定义天资失败！":"Save failed!",'AI推演完成！天资 "{0}" 已生成':'Tier "{0}" generated!',"请选择你的天资等级，这将决定你的起点。":"Select your talent tier",编辑天资:"Edit Tier",'天资 "{0}" 已更新！':'Tier "{0}" updated!',"更新天资失败！":"Update failed!","回溯档案，探寻出身...":"Loading origins...",档案缺失:"Error",自定义出身:"Custom Origin",随机出身:"Random Origin","0 点":"0 pts",出身名称:"Origin Name",出身描述:"Description","例如：山野遗孤":"e.g.: Orphan","描述此出身的背景故事和成长经历...":"Describe this origin...",出身名称不可为空:"Origin name required",出身描述不可为空:"Description required",'自定义出身 "{0}" 已保存！':'Origin "{0}" saved!',"保存自定义出身失败！":"Save failed!","请先选择一方大千世界，方可推演出身。":"Select world first",'AI推演完成！出身 "{0}" 已生成':'Origin "{0}" generated!',"世事无常，命运弄人。选择此项，你的出身将完全随机生成。":"Random origin description","身世如谜，过往一片空白。":"Unknown origin","请选择一处出身，或听天由命。":"Select an origin","点数不足，无法选择此出身。":"Insufficient points",编辑出身:"Edit Origin",'出身 "{0}" 已更新！':'Origin "{0}" updated!',"更新出身失败！":"Update failed!","检测基因，探查潜质...":"Loading mutation potentials...",高级自定义:"Advanced Custom",预设潜质:"Preset Potentials",组合选择:"Custom Combo",随机潜质:"Random Potential",潜质名称:"Potential Name",潜质品级:"Grade",潜质描述:"Description",进化倍率:"Multiplier",消耗点数:"Cost",特殊效果:"Special Effects","例如：混沌潜质":"e.g.: Chaos Potential","描述这个异能潜质的特性和背景故事...":"Describe this potential...","例如：1.5":"e.g.: 1.5","效果描述，如：雷系异能威力+80%":"e.g.: Thunder +80%",潜质名称不可为空:"Potential name required",请选择品级:"Select grade",异能描述不可为空:"Description required",进化倍率必须为数字:"Multiplier must be number",消耗点数必须为数字:"Cost must be number",'自定义异能 "{0}" 已保存！':'Potential "{0}" saved!',"保存自定义异能失败！":"Save failed!",'AI推演完成！异能 "{0}" 已生成':'Potential "{0}" generated!',潜质类型:"Potential Type",异能品级:"Grade",火:"Fire",水:"Water",木:"Wood",金:"Metal",土:"Earth",风:"Wind",雷:"Thunder",冰:"Ice",光:"Light",暗:"Dark",空间:"Space",时间:"Time",D级:"Common",下级:"Low",中级:"Middle",上级:"High",顶级:"Supreme",S级:"Heaven",SS级:"Divine",特殊:"Special",请选择异能类型:"Select potential type",请选择异能品级:"Select grade",确认选择:"Confirm",请完整选择异能类型和品级:"Complete selection",选择的异能配置无效:"Invalid config",'自定义异能 "{0}" 已创建！':'Potential "{0}" created!',"进化倍率:":"Multiplier:","消耗点数:":"Cost:","请选择一种异能潜质，或听天由命。":"Select a potential","基因突变，不可预测。选择此项，你的潜质将完全随机生成。":"Random potential description","异能信息不明。":"Unknown potential","点数不足，无法选择此异能。":"Insufficient points",编辑异能:"Edit Potential",'异能 "{0}" 已更新！':'Potential "{0}" updated!',"更新异能失败！":"Update failed!","在变异数据库中搜寻天赋...":"Loading talents...",天赋名称:"Talent Name",天赋描述:"Description","例如：钢铁意志":"e.g.: Dao Heart","描述此天赋的本质...":"Describe this talent...",天赋名称不可为空:"Talent name required",天赋描述不可为空:"Description required",点数消耗必须填写:"Cost required",点数消耗不能为负数:"Cost cannot be negative",'自定义天赋 "{0}" 已保存！':'Talent "{0}" saved!',"保存自定义天赋失败！":"Save failed!",'AI推演完成！天赋 "{0}" 已生成':'Talent "{0}" generated!',"请选择天赋。":"Select talents","此天赋之玄妙，需自行领悟。":"Unknown talent",编辑天赋:"Edit Talent",'天赋 "{0}" 已更新！':'Talent "{0}" updated!',基础属性分配:"Attribute Allocation","剩余点数:":"Remaining Points:",力量:"Strength",体质:"Constitution",敏捷:"Agility",意志:"Willpower",幸运:"Luck",魅力:"Charisma","决定生命上限、恢复速度、寿命上限。影响肉体强化、抗打击能力。":"Affects vitality and lifespan","决定能量上限、吸收效率。影响进化速度、异能威力。":"Affects spiritual power","决定理智上限、学习效率。影响技能领悟、技能掌握速度。":"Affects learning speed","决定各种概率、物品掉落品质。影响稀有物资获取、幸存者互助。":"Affects luck and drops","决定初始好感度、社交加成。影响NPC互动、势力声望获取。":"Affects social interactions","决定精神抗性、意志力。影响理智崩溃抵抗、关键抉择。":"Affects willpower","🎲 随机":"🎲 Random","⚖️ 均衡":"⚖️ Balance",最终预览:"Final Preview","请确认你的选择，此为踏入废土的最后一步。":"Confirm your choices","代号:":"Name:","正在从酒馆获取...":"Loading from tavern...","种族:":"Race:",人族:"Human",性别:"Gender",男:"Male",女:"Female",双性:"Hermaphrodite",初始年龄:"Starting Age",开局模式:"Start Mode",流式开局:"Streaming Start",非流式开局:"Non-Streaming Start","流式开局：更快，可能被中断":"Streaming: Faster, may be interrupted","非流式开局：一次性生成完整内容，更稳定可靠":"Non-Streaming: Complete generation, more stable",岁:" years old",所选世界:"Selected World",未选择:"Not selected",暂无描述:"No description",未选择任何天赋:"No talents selected",命运既定:"Fate Determined","联机模式下，角色的初始命格将由所选世界的世界法则在云端生成，以确保公平与平衡。":"Online mode description",延续生存记录:"Continue Journey","择一角色，重返废土":"Select a character",角色列表:"Characters",个角色:" characters",存档管理:"Save Management",导出存档:"Export Saves",导入存档:"Import Saves",导出选中角色的存档:"Export saves",向选中角色导入存档:"Import saves",档案为空:"No Characters","尚未创建任何角色，请返回开启末世之旅":"Create a character first",踏入废土:"Begin Journey",导入角色:"Import Character",请选择左侧角色查看存档详情:"Select a character","正在加载存档...":"Loading saves...",手动存档:"Manual Saves",存档通过游戏内保存功能创建:"Created via in-game save",空存档槽:"Empty Slot",通过游戏内保存创建:"Create via in-game save",重命名:"Rename","上次对话存档不可删除（用于回滚）":"Cannot delete last save","时间点存档不可删除（定时自动覆盖）":"Cannot delete time save","无法删除：至少需要保留一个手动存档":"Must keep one save",删除存档:"Delete Save",云端存档:"Cloud Save",待同步:"Pending",已同步:"Synced",进入游戏:"Enter Game",同步云端:"Sync Cloud",尚未开始修行:"Not started",开始游戏:"Start Game",删除角色:"Delete Character",'确定要彻底删除角色"{0}"及其所有修行记录吗？此操作不可恢复。':'Delete character "{0}"?',无法删除存档:"Cannot Delete","无法删除该存档：角色至少需要保留一个存档。如需删除，请先创建其他存档或删除整个角色。":"Must keep one save",'确定要删除角色"{0}"的"{1}"吗？此操作不可恢复。':'Delete save "{1}"?',重命名存档:"Rename Save","请输入新的存档名称：":"Enter new name:",重命名失败:"Rename Failed","存档名称已存在，请使用其他名称。":"Name exists",需要登录:"Login Required",请先登录以管理联机角色存档:"Login to manage online saves",登入档案:"Login",创建新存档:"Create Save","是否在【{0}】位置创建新的存档开始游戏？":'Create save at "{0}"?',开启新征程:"New Journey",'是否在存档位 "{0}" 开始一段新的修行？':'Start at "{0}"?','角色 "{0}" 已导出':'Character "{0}" exported',导出角色失败:"Export failed",请先选择一个角色:"Select a character first",该角色没有可导出的存档:"No saves to export",存档已导出:"Saves exported",请先选择一个角色以导入存档:"Select character first","文件格式无效，请选择一个存档文件。":"Invalid save file",'确定要将 {0} 个存档导入到角色 "{1}" 吗？同名存档将被覆盖。':'Import {0} saves to "{1}"?','成功为角色 "{0}" 导入 {1} 个存档':"Imported {0} saves","导入存档失败: {0}":"Import failed: {0}","文件格式无效，请选择一个角色文件。":"Invalid character file",'确定要导入角色 "{0}" 吗？':'Import character "{0}"?','成功导入角色 "{0}"':'Character "{0}" imported',"导入角色失败: {0}":"Import failed: {0}","处理导入文件失败: {0}":"File processing failed: {0}",基础信息:"Basic Info",暂无天赋:"No talents","请描述你想生成什么内容：":"Describe what to generate:","例如：生成一个火属性的天赋，适合剑修...":"e.g.: Fire talent for sword cultivator...","请输入兑换码以连接数据库进行AI推演。":"Enter redemption code for AI generation",请输入兑换码:"Enter code","验证中...":"Verifying...","兑换码不可为空。":"Code required","兑换码验证失败，请检查后重试。":"Verification failed",自定义AI推演:"Custom AI Generation",'描述你希望的世界风格、时代背景或特色设定（可含对话，使用中文引号""，每句仅一对）':"Describe world style","提示词 (可选)":"Prompt (optional)","例如：现代都市变异世界，异能觉醒，科技与异能并存...":"e.g.: Modern cultivation world...",建议提示词:"Suggested Prompts","本联机谨遵天道法则：不存储任何对话记录":"No chat logs stored","仅保留法身属性、觉醒阶段进度等生存要素，确保道友隐私清净无染":"Only cultivation data saved",仅女性:"Female Only",仅男性:"Male Only",所有性别:"All Genders","秩序崩塌，混沌初开":"Dao of Nature, Heaven and Earth Begin","正在加载混沌世界...":"Loading cultivation world...",连接世界意志:"Connecting to Heavenly Dao",加载角色数据:"Loading character data",读取存档信息:"Reading save data","提示：请在左侧菜单选择角色并加载存档":"Tip: Select character and load save from left menu",成功:"Success",失败:"Failed",错误:"Error",警告:"Warning",信息:"Info",进行中:"In Progress",已完成:"Completed",未开始:"Not Started",已取消:"Cancelled",全部:"All",无:"None",空:"Empty",暂无数据:"No Data",暂无:"None",请输入:"Enter",请选择:"Select",确定要:"Confirm",操作成功:"Success",操作失败:"Failed",保存成功:"Saved",保存失败:"Save Failed",删除成功:"Deleted",删除失败:"Delete Failed",加载失败:"Load Failed",网络错误:"Network Error",未知错误:"Unknown Error",混沌纪元:"The Great Way",凡人:"Mortal",初始地:"Starting Point",进化路:"Immortal Dao",年:"Year",月:"Month",日:"Day",元年:"Year 1",任务:"Quests",寻找物资:"Seek Opportunity","推演中...":"Generating...",势力:"Faction",遭遇:"Adventure",日常:"Daily",系统任务:"System Quest",羁绊培养:"Companion",能力提升:"Evolution",收集资源:"Collect",战斗挑战:"Combat",任务系统配置:"Quest Config",默认任务数量:"Default Quest Count",自动刷新:"Auto Refresh",自动刷新任务:"Auto refresh quests",完成任务后自动生成新任务:"Auto generate after completion",任务池中保持的未完成任务数量:"Unfinished quest count in pool",保存配置:"Save Config",删除任务:"Delete Quest","为AI任务生成添加自定义指令（可选）":"Add custom instructions (optional)",势力组织:"Factions","搜索势力...":"Search factions...","正在读取势力信息...":"Loading factions...",暂无势力信息:"No faction info",世界信息将由AI根据游戏进程生成:"World info generated by AI",调试信息:"Debug Info",从酒馆同步数据:"Sync from Tavern",强制刷新:"Force Refresh",成员统计:"Member Stats",总人数:"Total Members",人:" members",觉醒阶段分布:"Stage Distribution",职位分布:"Position Distribution",势力类型:"Faction Type",势力等级:"Faction Level",所在大洲:"Continent",主要资源:"Main Resources",势力领导:"Leadership",首领:"Leader",副首领:"Vice Leader",最强战力:"Peak Power",综合战力:"Overall Power",势力描述:"Description",势力特色:"Specialties",关系状态:"Relations",与你的关系:"Your Relation",声望值:"Reputation",势力范围:"Territory",影响范围:"Influence",控制区域:"Controlled Areas",战略价值:"Strategic Value",加入条件:"Join Requirements",加入好处:"Benefits",申请加入:"Apply",我的势力身份:"My Faction Status",职位:"Position",贡献点:"Contribution",加入时间:"Join Date",势力行动:"Faction Actions",势力任务:"Faction Quests",贡献兑换:"Contribution Exchange",势力档案:"Faction Library",组织成员:"Fellow Members","搜索人物...":"Search people...","正在读取人际关系...":"Loading relationships...",尚未建立人际关系:"No relationships yet",在游戏中与更多人物互动建立关系:"Interact to build relationships",取消关注:"Unfollow",添加关注:"Follow",删除人物:"Delete NPC","觉醒阶段:":"Stage:",好感:"Favor",基础档案:"Profile",外貌与性格:"Appearance",性格特征:"Personality",天赋能力:"Talents",最近记忆:"Recent Memories",人格底线:"Bottom Line","触犯人格底线将导致好感度断崖式下跌（-30 ~ -60），关系破裂且极难修复":"Violating bottom line causes severe favor loss","当前状态（实时）":"Current Status",外貌状态:"Appearance",内心想法:"Thoughts",私密信息:"Private Info",状态与欲望:"Status & Desire",性状态:"Sexual Status",性渴望:"Desire",贞洁:"Virginity",处女:"Virgin",非处:"Non-virgin",处男:"Virgin",性格倾向:"Personality",性取向:"Orientation",异性恋:"Heterosexual",性伴侣名单:"Partners",性经验统计:"Experience",性交总次数:"Total Times",次:" times",性伴侣数量:"Partner Count","最近一次：":"Last Time:",身体部位开发:"Body Development",部位名称:"Part",特殊标记:"Mark",特征描述:"Description",敏感度:"Sensitivity",开发度:"Development",体液状态:"Fluid Status",癖好与体质:"Fetishes & Traits",性癖好:"Fetishes",特殊体质:"Special Traits",记忆档案:"Memory Archive",记忆:"Memory",条:" items","总结中...":"Summarizing...",上一页:"Previous",下一页:"Next",此人暂无记忆:"No memories","原始数据 (JSON)":"Raw Data (JSON)",背包:"Inventory",下级突变结晶:"Low Spirit Stone",中级突变结晶:"Mid Spirit Stone",上级突变结晶:"High Spirit Stone",顶级突变结晶:"Top Spirit Stone",交易:"Trade",索要:"Request",偷窃:"Steal",已移除图片:"Image removed",本次对话无变更记录:"No changes in this conversation",切换训练法:"Switch Technique",当前正在训练:"Currently cultivating",确定要切换到:"Switch to",吗:"?",卸下功法:"Unequip Technique","当前正在修炼《{current}》，确定要切换到《{next}》吗？":"Currently cultivating {current}. Switch to {next}?","确定要卸下《{name}》吗？":"Unequip {name}?",确定要卸下:"Confirm unequip",确定卸下:"Confirm",存档:"Saves",当前进度:"Current Progress",上次对话:"Last Conversation",时间点存档:"Time Save","每次对话前自动备份，可用于回退到上次对话前的状态":"Auto backup before conversation","按设定时间间隔自动覆盖保存，防止长时间游玩数据丢失":"Auto save at intervals",创建时间:"Created",最后保存:"Last Saved",存档列表:"Save List",新建存档:"New Save","求生路上尚未留存，创建存档记录征程":"No saves yet, create one",开始游戏后可以创建存档:"You can create saves after starting the game",读取存档:"Load",回滚:"Rollback",覆盖:"Overwrite",自动存档设置:"Auto Save Settings",对话前自动备份:"Backup Before Chat",存档间隔:"Save Interval",存档操作:"Save Operations",备份所有存档到文件:"Backup all saves",从文件恢复存档:"Restore from file",清空存档:"Clear Saves",删除所有存档数据:"Delete all saves",定位到玩家位置:"Locate Player",全屏显示:"Fullscreen",调试地图数据:"Debug Map",图例:"Legend",城镇坊市:"Towns",洞天福地:"Blessed Lands",奇珍异地:"Treasure Lands",凶险之地:"Dangerous Areas",其他特殊:"Special",大洲:"Continent",安全等级:"Safety Level",气候类型:"Climate",地形特征:"Terrain",天然屏障:"Barriers",短期记忆:"Short-term Memory","脑海中一片清净，尚未留下修行痕迹...":"Mind is clear, no cultivation traces yet...","世界意志感应中...":"Sensing the Heavenly Dao...",字:"chars","如果长时间无响应，点击此处重置状态":"If no response for a long time, click here to reset state",回滚到上次对话前的状态:"Rollback to state before last conversation",查看本次对话的变更日志:"View change log for this conversation","静待天机变化...":"Awaiting the changes of fate...",最近操作:"Recent Actions",清空记录:"Clear records",撤回并恢复:"Undo and restore",删除此动作:"Delete this action","请输入您的选择或行动...":"Enter your choice or action...","请先选择角色...":"Please select a character first...",流式:"Stream",快捷行动:"Quick Actions",训练时间:"Cultivation Time","自定义：":"Custom:",天:"days",选项:"Options",上传图片:"Upload image",移除图片:"Remove image","加载角色数据..":"Loading character data...",无法加载角色数据:"Unable to load character data",点击查看详情:"Click for details",进化进度:"Cultivation Progress",生命状态:"Vitals",角色背景:"Background",年龄:"Age",天赋与潜质:"Talents & Spirit Root",天资等级:"Talent Tier",潜质属性:"Spirit Root Attributes",天赋特质:"Talents",属性属性:"Six Attributes",最终属性:"Final Attributes",后天属性:"Acquired Attributes",尚未进行训练:"No technique being cultivated",品:"Grade",阶:"Rank","此训练法深奥复杂，需持续训练方可掌握。":"This technique is profound. Its true meaning can only be understood with deeper cultivation.",训练效果:"Technique Effects","进化加成：":"Cultivation Bonus:","属性提升：":"Attribute Boost:",此功法无特殊效果:"This technique has no special effects",已掌握技能:"Mastered Skills",个:"",所有技能:"All Skills",熟练度:"Proficiency",未解锁技能:"Locked Skills",第:"Stage ",阶段:"Stage",当前经验:"Current EXP",总经验:"Total EXP",人际关系:"Relationships",暂无人际关系:"No relationships yet",平均好感:"Avg. Favorability",背包概览:"Inventory Overview",物品总数:"Total Items",武装数量:"Artifacts",训练法数量:"Techniques",突变结晶储备:"Spirit Stones",贡献值:"Contribution",关系:"Relation",已解锁:"Unlocked",解锁条件:"Unlock Condition",技能来源:"Skill Source",技能描述:"Description",当前阶段:"Current Stage",生存感悟:"Insights",进化速度:"Cultivation Speed",详细信息:"Detailed Info","基础倍率:":"Base Multiplier:",野性本能:"Wild Instinct",自然状态:"Natural State",等待觉醒:"Awaiting Awakening",自动解锁:"Auto Unlock",需要熟练度:"Requires Proficiency",衍生技能:"Technique Skill",训练法:"Technique",通过训练掌握:"Mastered through cultivation",掌握技能:"Mastered Skill",未知天赋:"Unknown Talent",'确定要移除状态效果"{0}"吗？':'Are you sure you want to remove the status effect "{0}"?',角色详情面板:"Character Details Panel",存档数据不存在:"Save data does not exist","已移除状态效果: {0}":"Removed status effect: {0}","未找到状态效果: {0}":"Status effect not found: {0}","移除状态效果失败:":"Failed to remove status effect:",初始阶段:"Initial Stage","此路径已解锁，但尚未开始修炼":"This Dao is unlocked, but cultivation has not yet begun",未门:"Uninitiated","第{0}阶段":"Stage {0}","此路径深奥复杂，需持之以恒方能有所成就":"This Dao is profound and requires perseverance to achieve mastery",已掌握:"Mastered",训练完成:"Cultivation Complete",通过修炼功法获得的技能:"Skill obtained through technique cultivation",技能训练:"Technique Cultivation",未解锁:"Locked",技能传承:"Technique Inheritance","已同步最新数据到 gameStateStore":"Synced latest data to gameStateStore",刷新数据失败:"Failed to refresh data","组件挂载，同步数据":"Component mounted, syncing data",面板激活:"Panel activated",待定:"Undetermined","出身背景: {0}":"Origin: {0}",已获取:"Synced",暂不可用:"Unavailable",云端功能暂未开放:"Cloud feature not available yet",获取云端:"Fetch Cloud","正在同步云端数据...":"Syncing cloud data...",云端数据已获取:"Cloud data synced",获取云端数据:"Fetch cloud data","云端数据已获取，无需重复操作":"Cloud data already synced","正在获取云端数据...":"Fetching cloud data...","同步成功！新增 {0} 项云端数据":"Sync successful! Added {0} cloud items",所有云端数据已是最新:"All cloud data is up to date",同步成功:"Sync successful",同步失败:"Sync failed","同步失败: {0}":"Sync failed: {0}",存储中:"Storing",已存储:"Stored",存储预设:"Store Preset",请完成所有步骤后再保存预设:"Complete all steps before saving preset","正在存储预设...":"Storing preset...",预设已存储:"Preset stored",保存当前选择为预设:"Save current selection as preset","预设已存储，无需重复操作":"Preset already stored","正在保存预设...":"Saving preset...","预设「{0}」保存成功！":'Preset "{0}" saved successfully!',预设保存成功:"Preset saved successfully","存储失败: {0}":"Storage failed: {0}",已加载:"Loaded",加载预设:"Load Preset","正在加载预设...":"Loading preset...",预设已加载:"Preset loaded","预设已加载，无需重复操作":"Preset already loaded","预设「{0}」加载成功！":'Preset "{0}" loaded successfully!',加载成功:"Load successful","加载失败: {0}":"Load failed: {0}",存档数据异常:"Save Data Error","系统检测到您的存档文件存在严重结构问题，可能导致游戏无法正常运行。这通常是由于版本更新或数据损坏导致的。":"System detected serious structural issues in your save file that may prevent the game from running properly. This is usually caused by version updates or data corruption.","具体问题如下：":"Specific issues:","我们建议您立即修复此问题。修复过程将尝试在保留您核心进度的前提下，修正存档的数据结构。":"We recommend fixing this issue immediately. The repair process will attempt to correct the save data structure while preserving your core progress.","注意：修复主要针对结构性问题，无法恢复已损坏或丢失的数据。建议您在修复前备份存档。":"Note: Repair mainly targets structural issues and cannot recover corrupted or lost data. It is recommended to backup your save before repair.",修复存档并继续:"Repair Save and Continue","我们建议您立即修复此问题。修复过程将根据您现有的角色基础信息，重新生成一份健康的初始存档数据。":"We recommend fixing this issue immediately. The repair process will regenerate healthy initial save data based on your existing character information.","注意：这将会重置您的游戏进度（如修为、背包物品等），但角色核心设定（如姓名、天赋、灵根）将保留。":"Note: This will reset your game progress (such as cultivation, inventory items, etc.), but character core settings (such as name, talents, spirit root) will be retained.",重新初始化并修复:"Reinitialize and Repair",深度训练:"Deep Cultivation",当前进化进度:"Current Progress","进化速度: +{0}%":"Cultivation Speed: +{0}%",选择训练天数:"Select Cultivation Days",AI将根据训练天数生成详细的修炼过程和结果:"AI will generate detailed cultivation process and results based on days",输入天数:"Enter days","1天":"1 day","7天":"7 days","30天":"30 days","90天":"90 days","180天":"180 days","365天":"365 days",开始训练:"Begin Cultivation",授权验证:"Authorization","欢迎使用授权系统快速入门功能。请输入您的兑换码和机器码进行验证。":"Welcome to the authorization system. Please enter your redemption code and machine code for verification.","应用 ID":"App ID",请输入应用ID:"Enter App ID",兑换码:"Redemption Code",机器码:"Machine Code",自动生成或手动输入:"Auto-generate or manual input",生成机器码:"Generate machine code",使用统一机器码系统自动生成:"Auto-generate using unified machine code system",绑定类型:"Binding Type",仅机器码:"Machine Code Only",仅IP:"IP Only",双重绑定:"Dual Binding",验证授权:"Verify Authorization","验证成功！授权已激活":"Verification successful! Authorization activated","验证失败，请检查输入信息":"Verification failed, please check input","网络请求失败，请检查服务器连接":"Network request failed, please check server connection",机器码生成失败:"Machine code generation failed",AI生成失败:"AI Generation Failed",生成过程遇到问题:"Problem encountered during generation",取消创建:"Cancel Creation",继续重试:"Retry",选择数量:"Select Quantity","可用数量：{0}":"Available: {0}","1个":"1 item","5个":"5 items","10个":"10 items",输入数值:"Enter Value",数值:"Value",清除自定义:"Clear Custom",清除云端:"Clear Cloud",清除自定义和AI生成的数据:"Clear custom and AI-generated data",清除从云端获取的数据:"Clear cloud data",清除自定义数据:"Clear Custom Data","确定要清除自定义数据吗？这将清除所有自定义和AI生成的数据，保留本地基础数据和云端数据。此操作不可撤销！":"Are you sure you want to clear custom data? This will clear all custom and AI-generated data, keeping local base data and cloud data. This action cannot be undone!",确认清除:"Confirm Clear","已清除{0} 项自定义数据，保留本地基础数据和云端数据":"Cleared {0} custom items, keeping local base data and cloud data",清除云端数据:"Clear Cloud Data","确定要清除云端数据吗？这将清除从云端获取的数据，保留本地基础数据和自定义数据。此操作不可撤销！":"Are you sure you want to clear cloud data? This will clear data fetched from cloud, keeping local base data and custom data. This action cannot be undone!","已清除{0} 项云端数据，保留本地数据和自定义数据":"Cleared {0} cloud items, keeping local data and custom data",保存预设:"Save Preset",预设名称:"Preset Name","请输入预设名称（如：剑修预设、治愈系预设等）":"Enter preset name (e.g., Sword Cultivator Preset, Healer Preset, etc.)",预设描述:"Preset Description","输入此预设的描述信息...":"Enter preset description...","保存时间：":"Save Time:","保存中...":"Saving...",导出预设:"Export Presets","正在加载预设列表...":"Loading preset list...",暂无可导出的预设:"No presets to export",请先保存一些预设后再进行导出:"Please save some presets before exporting",导出全部预设:"Export All Presets","导出所有 {0} 个预设":"Export all {0} presets",导出选中预设:"Export Selected Presets",选择要导出的预设:"Select presets to export","全选/取消全选":"Select All/Deselect All","已选择 {0} 个":"Selected {0}",未命名预设:"Unnamed Preset",今天:"Today",昨天:"Yesterday","{0}天前":"{0} days ago","导出数量：":"Export Count:","{0} 个预设":"{0} presets","文件格式：":"File Format:",JSON:"JSON","导出时间：":"Export Time:","导出中...":"Exporting...","成功导出 {0} 个预设！":"Successfully exported {0} presets!","导出失败: {0}":"Export failed: {0}",导入预设:"Import Presets","拖放JSON文件到此处，或点击选择文件":"Drag and drop JSON file here, or click to select",选择文件:"Select File",仅支持通过本应用导出的预设JSON文件:"Only supports preset JSON files exported by this app",请选择JSON格式的文件:"Please select a JSON file","文件大小超过限制（最大10MB）":"File size exceeds limit (max 10MB)",合并模式:"Merge Mode","将导入的预设添加到现有预设中（推荐）":"Add imported presets to existing presets (recommended)",替换模式:"Replace Mode","将清除所有现有预设，仅保留导入的预设":"Clear all existing presets and keep only imported presets","替换模式将删除所有现有预设！\n\n此操作不可撤销，确定要继续吗？":"Replace mode will delete all existing presets!\n\nThis action cannot be undone, are you sure you want to continue?","正在导入预设...":"Importing presets...","成功导入 {0} 个预设！":"Successfully imported {0} presets!",部分预设导入成功:"Some presets imported successfully","成功: {0} 个，失败: {1} 个":"Success: {0}, Failed: {1}",预设导入失败:"Preset import failed","导入失败: {0}":"Import failed: {0}",开始导入:"Start Import",暂无保存的预设:"No saved presets","完成角色创建后,可以保存为预设以便快速开始新游戏":"After completing character creation, you can save as preset for quick new game start","确定要删除这个预设吗？此操作不可撤销。":"Are you sure you want to delete this preset? This action cannot be undone.",预设已删除:"Preset deleted","搜索...":"Search...","搜索物品...":"Search items...",全部物品:"All Items",默认排序:"Default Sort",品质排序:"Sort by Quality",名称排序:"Sort by Name",从酒馆同步最新数据:"Sync latest data from Tavern","装备增幅:":"Equipment Bonus:","特殊效果:":"Special Effects:",卸下:"Unequip",丢弃:"Discard",停止训练:"Stop Cultivating",训练:"Cultivate",使用:"Use",空空如也:"Empty",暂无装备:"No Equipment",暂无训练法:"No Techniques",暂无其他物品:"No Other Items","暂无{0}":"No {0}",可以试试搜索其他分类:"Try searching other categories","属性加成:":"Attribute Bonus:","特殊能力:":"Special Abilities:","需要:":"Requires:","消耗:":"Cost:",选择物品查看详情:"Select an item to view details",物品:"Items",装备:"Equipment",突变结晶:"Spirit Stones",装备1:"Equipment 1",装备2:"Equipment 2",装备3:"Equipment 3",装备4:"Equipment 4",装备5:"Equipment 5",装备6:"Equipment 6",卸下装备:"Unequip",装备数据缺失:"Equipment data missing",空槽位:"Empty Slot",可装备装备:"Equipment can be worn","增幅效果：":"Bonus Effects:","特殊效果：":"Special Effects:","兑换为{0}突变结晶 (100:1)":"Exchange for {0} Spirit Stone (100:1)","↑ 兑换":"↑ Exchange","分解为{0}突变结晶 (1:100)":"Decompose into {0} Spirit Stone (1:100)","↓ 分解":"↓ Decompose",使用物品:"Use Item",使用数量:"Quantity to Use",确定使用:"Confirm Use",暂无特殊效果:"No special effects",该物品无法直接使用:"This item cannot be used directly",使用物品成功:"Item used successfully",使用物品失败:"Failed to use item",丢弃物品:"Discard Item",丢弃数量:"Quantity to Discard",确定丢弃:"Confirm Discard","此操作不可撤销！":"This action cannot be undone!","确定要丢弃 {0}{1} 吗？\n\n此操作不可撤销！":"Are you sure you want to discard {0}{1}?\n\nThis action cannot be undone!","已丢弃《{0}》":'Discarded "{0}"',"已丢弃 {0} 个《{1}》":'Discarded {0} of "{1}"',丢弃物品失败:"Failed to discard item",只有装备才能穿戴:"Only equipment can be worn","装备操作失败，请稍后重试":"Equipment operation failed, please try again later",只有训练法才能训练:"Only techniques can be cultivated",残缺:"Broken",背包数据不存在或格式不正确:"Inventory data does not exist or is in the wrong format",背包面板:"Inventory Panel",物品移除成功:"Item removed successfully","尝试更新一个不存在于背包的物品: {0}":"Attempting to update an item that does not exist in the inventory: {0}",物品更新成功:"Item updated successfully",装备栏数据不存在:"Equipment data does not exist",背包数据不存在:"Inventory data does not exist","卸下了《{0}》装备":'Unequipped "{0}"',"已卸下《{0}》":'Unequipped "{0}"',装备卸下成功:"Unequip successful",卸下装备失败:"Failed to unequip","[背包面板-警告] 物品缺少品质数据:":"[InventoryPanel-Warning] Item is missing quality data:",手动刷新酒馆数据:"Manually refresh Tavern data","存档数据 (SaveData)":"Save Data",玩家角色状态:"Player Status",装备栏:"Equipment",游戏时间:"Game Time",任务系统:"Quest System",系统:"System",叙事历史:"Narrative History",角色数据:"Character Data",记忆数据:"Memory Data",游戏版本:"Game Version",架构模式:"Architecture","Pinia内存 + DB持久化":"Pinia Memory + DB Persistence","存档数据(修改游戏数据)":"Save Data (Modify Game Data)",核心数据:"Core Data",自定义选项:"Custom Options",原始数据:"Raw Data",请先加载游戏存档:"Please load a game save first","数据已从Pinia Store刷新":"Data refreshed from Pinia Store","数据刷新失败: ":"Data refresh failed: ",数据导出成功:"Data exported successfully",数据导出失败:"Data export failed","新架构下不支持直接添加变量，请通过游戏操作修改数据":"Directly adding variables is not supported in the new architecture. Please modify data through game actions.",已复制到剪贴板:"Copied to clipboard",复制失败:"Copy failed","新架构下不支持直接删除变量，请通过游戏操作修改数据":"Directly deleting variables is not supported in the new architecture. Please modify data through game actions.",没有要保存的数据:"No data to save","✅ 已成功更新 ":"✅ Successfully updated ","保存失败: ":"Save failed: ","基本统计:":"Basic Stats:",游戏已加载:"Game Loaded",角色名:"Character Name","核心数据键名:":"Core Data Keys:","自定义选项键名:":"Custom Option Keys:","完整SaveData:":"Full SaveData:",调试信息已输出到控制台:"Debug info has been output to the console","AI处理中，请稍候...":"AI is processing, please wait...","角色已死亡，无法继续。":"Character has died, cannot continue.","角色因生命值耗尽而死亡。":"Character has died due to Qi exhaustion.","角色因寿元耗尽而死亡。":"Character has died due to lifespan depletion.",天机已显:"Heavenly secrets revealed","AI响应格式不正确，正在重试...":"AI response format is incorrect, retrying...","AI响应格式错误，多次重试失败":"AI response format error, and multiple retries failed",AI处理失败:"AI processing failed",AI处理状态已重置:"AI processing state has been reset",'存档 "{0}" 成功':'Save "{0}" successful',存档失败:"Save failed",'已备份到"上次对话"':'Backed up to "Last Conversation"',备份失败:"Backup failed",基础训练:"Basic Cultivation",体能训练:"Body Tempering",冥想:"Meditation",探索荒野:"Explore Wilderness",城中闲逛:"Stroll in Town",拜访友人:"Visit Friend",结交新友:"Make New Friend",休息:"Rest",查看状态:"Check Status",探索:"Exploration",社交:"Social",其他:"Other","吸收能量，提升能力。":"Absorb spiritual energy to enhance cultivation.","锻炼肉体，强化体魄。":"Temper the body to strengthen physique.","静心冥想，稳固理智，提升精神。":"Meditate to stabilize mind and enhance spirit.","探索荒野，寻找机缘。":"Explore the wilderness to find opportunities.",附近区域:"Nearby Area",远方区域:"Far Area",危险区域:"Dangerous Area","在城中游荡，打探消息。":"Wander in town to gather information.",坊市:"Market",酒楼:"Tavern",商铺:"Shop","拜访一位熟人。":"Visit an acquaintance.",随机拜访:"Random Visit",亲密好友:"Close Friend","主动结交新朋友。":"Actively make new friends.","休息恢复精力。":"Rest to recover energy.","查看当前详细状态。":"Check current detailed status.",其他记录:"Other Records",记忆系统设置:"Memory System Settings","📖 导出为小说":"📖 Export as Novel","将完整的游戏对话历史（基于叙事历史）导出为小说格式，方便阅读和分享。":"Export complete game dialogue history (based on narrative history) as novel format for easy reading and sharing.","⚙️ 记忆系统配置":"⚙️ Memory System Configuration","🧪 测试":"🧪 Test",添加测试中期记忆:"Add Test Medium-Term Memory",测试:"Test",技能库:"Technique Library","短期记忆上限（条）：":"Short-Term Memory Limit (items):",默认:"Default","中期记忆转化阈值（条）：":"Medium-Term Memory Conversion Threshold (items):","中期记忆达到此数量时，转化为长期记忆。默认：25":"When medium-term memories reach this amount, they are converted to long-term memories. Default: 25","中期记忆保留数量（条）：":"Medium-Term Memory Retention Count (items):","转化为长期记忆时，保留最新的这么多条中期记忆。默认：8":"When converting to long-term memory, retain this many of the latest medium-term memories. Default: 8",启用自动记忆转化:"Enable Automatic Memory Conversion","启用后，自动将中期记忆转化为长期记忆。禁用则不转化。":"When enabled, automatically converts medium-term memories to long-term memories. If disabled, no conversion occurs.","自定义中期记忆格式：":"Custom Medium-Term Memory Format:","留空使用默认格式。可自定义AI提示词来控制记忆的生成格式...":"Leave blank for default format. You can customize the AI prompt to control the generation format of memories...","自定义中期记忆的AI提示词格式。留空使用系统默认。":"Customize the AI prompt format for medium-term memories. Leave blank to use the system default.","自定义长期记忆格式：":"Custom Long-Term Memory Format:","自定义长期记忆的AI提示词格式。留空使用系统默认。":"Customize the AI prompt format for long-term memories. Leave blank to use the system default.","💾 保存配置":"💾 Save Configuration",重置为默认:"Reset to Default","当前中期记忆：":"Current Medium-Term Memories:","达到{count}条时将自动触发总结":"(Summary will be triggered automatically upon reaching {count} items)",manualSummaryRequirement:"At least {count} medium-term memories are required to summarize",手动触发AI总结:"Manually trigger AI summary","📝 手动总结中期记忆":"📝 Manually Summarize Medium-Term Memories","正在读取记忆...":"Reading memories...","第 {currentPage} / {totalPages} 页，共 {total} 条记忆":"Page {currentPage} / {totalPages}, {total} memories in total",firstPage:"First Page",previousPage:"Previous Page",nextPage:"Next Page",lastPage:"Last Page",page:"Page",go:"Go",deleteThisMemory:"Delete this memory",all:"All",shortTerm:"Short-Term",mediumTerm:"Medium-Term",longTerm:"Long-Term",noSurvivalInsights:"Mind is as clear as a mirror, no cultivation insights recorded yet","暂无{type}记忆":"No {type} memories yet",mediumTermMemory:"Medium-Term Memory",longTermMemory:"Long-Term Memory",unknown:"Unknown",convertedAt:"Converted at {time}",archivedAt:"Archived at {time}",memoriesReorganized:"Memories have been reorganized, old memories have been converted",clearMemories:"Clear Memories",confirmClearMemories:"Are you sure you want to clear all memories? This action cannot be undone and will also clear the tavern data.",confirmClear:"Confirm Clear",memoriesCleared:"Memories have been cleared and synced to the tavern",clearMemoriesFailed:"Failed to clear memories, please try again",insufficientMemoriesForSummary:"Insufficient medium-term memories, at least {minRequired} items are required to summarize",deleteMemory:"Delete Memory",confirmDeleteMemory:"Are you sure you want to delete this {type}? This action cannot be undone.\n\nContent: {content}...",delete:"Delete",memoryNotFound:"Could not find the memory to delete",memoryDeleted:"Deleted {type}",deleteFailed:"Delete failed: {error}",survivor:"Cultivator",chaosWorld:"Cultivation World",noNarrativeHistoryToExport:"No narrative history to export","The Survival Path of":"《The Cultivation Path of {characterName}》",worldArchive:"World Archive",exportTime:"Export Time",totalParagraphs:"Total Paragraphs",iSaid:"I said",chapter:"Chapter",narrativeHistoryExported:"Successfully exported {count} narrative history entries",exportFailed:"Export failed, please check the console",testMemoryAdded:"✅ Test memory added! Current medium-term memories: {count} items",addTestMemoryFailed:"Failed to add test memory",进化受阻:"Dao Obstructed",隐藏详情:"Hide Details",变更日志:"Change Log","本次操作没有产生可见的状态变更。":"No visible state changes from this operation.",判定规则说明:"Judgement Rules",判定计算公式:"Judgement Formula",判定值:"Judgement Value",判定结果:"Judgement Results",判定规则:"Judgement Rules","判定值 ≥ 难度+30":"Value ≥ Difficulty+30","判定值 ≥ 难度+15，超额完成":"Value ≥ Difficulty+15, exceeded","判定值 ≥ 难度，达成目标":"Value ≥ Difficulty, achieved","判定值 < 难度，未达成":"Value < Difficulty, failed","判定值远低于难度（难度-15以下）":"Value far below difficulty (below difficulty-15)",判定类型与属性配比:"Judgement Types & Attributes",战斗判定:"Combat Judgement","力量50% + 敏捷30% + 幸运20%":"Root Bone 50% + Spirituality 30% + Fortune 20%",进化判定:"Cultivation Judgement","意志50% + 敏捷30% + 心性20%":"Comprehension 50% + Spirituality 30% + Temperament 20%",技艺判定:"Skill Judgement","意志50% + 力量30% + 敏捷20%":"Comprehension 50% + Root Bone 30% + Spirituality 20%",社交判定:"Social Judgement","魅力50% + 意志30% + 心性20%":"Charm 50% + Comprehension 30% + Temperament 20%",探索判定:"Exploration Judgement","幸运50% + 敏捷30% + 意志20%":"Fortune 50% + Spirituality 30% + Comprehension 20%",属性属性说明:"Six Attributes",提升判定成功率:"Improve Success Rate","先天属性：天赋决定上限，无法改变但影响最大":"Innate Attributes: Talent determines limits, unchangeable but most impactful","提升觉醒阶段：阶段越高，判定基础加成越大":"Raise Stage: Higher stage gives greater base bonus","后天训练：后天属性可提升，但权重仅20%":"Cultivate Acquired: Can be improved, but only 20% weight","学习技能：高品质功法和技能熟练度提供显著加成":"Learn Techniques: High-quality techniques and proficiency provide significant bonuses","装备武装：合适的装备能大幅提升判定值":"Equip Artifacts: Proper equipment greatly increases judgement value","状态效果：buff增强判定，注意避免debuff":"Status Effects: Buffs enhance judgement, avoid debuffs","阶段压制：高阶段对低阶段有优势，但不是绝对":"Stage Suppression: Higher stage has advantage, but not absolute",造成伤害:"Damage Dealt",剩余生命值:"Remaining HP",系统提示:"System Notice","根据判定类型加权（战斗：力量50%+敏捷30%+幸运20%，修炼：意志50%+敏捷30%+心性20%）":"Weighted by judgement type (Combat: Root Bone 50%+Spirituality 30%+Fortune 20%, Cultivation: Comprehension 50%+Spirituality 30%+Temperament 20%)","对应后天属性加权 ÷ 5":"Corresponding acquired attributes weighted ÷ 5","凡人5 | 觉醒12 | 掌控20 | 精通30...（阶段：初期+0，中期+2，后期+4，圆满+6）":"Qi Refining 5 | Foundation 12 | Golden Core 20 | Nascent Soul 30... (Stage: Early +0, Mid +2, Late +4, Perfect +6)",装备提供的加成:"Equipment bonuses","技能品质+熟练度":"Technique quality + proficiency","buff/debuff效果":"Buff/debuff effects","判定值与难度对比，完全基于属性、觉醒阶段和加成":"Judgement value vs difficulty, based on attributes, awakening stage and bonuses","AI正在生成中，请稍后再试":"AI is generating, please try again later",AI生成设置:"AI Generation Settings",API地址:"API URL",API密钥:"API Key",API提供商:"API Provider",API管理:"API Management",模块自定义:"Module Customization",自定义生存模块:"Customize Cultivation Modules",API配置列表:"API Config List",API配置已删除:"API config deleted",API配置已导入:"API config imported",API配置已导出:"API config exported",API配置已更新:"API config updated",API配置已添加:"API config added",Claude使用prefill技巧实现JSON模式:"Claude uses prefill to enable JSON mode",Gemini使用response_mime_type实现JSON模式:"Gemini uses response_mime_type to enable JSON mode",'• 务必先用"测试连接"验证！':'• Be sure to validate with "Test Connection" first!',"• 底层是Gemini/Claude/旧模型: ❌ 可能报错":"• Backend is Gemini/Claude/legacy models: ❌ may error","• 底层是OpenAI/DeepSeek/Qwen/GLM-4: ✅ 通常可用":"• Backend is OpenAI/DeepSeek/Qwen/GLM-4: ✅ usually works",一次性生成:"One-shot Generation","一次性生成：一次性生成所有内容，速度更快但可能不稳定":"One-shot generation: generate everything at once, faster but may be unstable",上锁:"Locked",下线代理:"Offline Agent",不能删除默认API配置:"Cannot delete default API config",不限性别:"No gender limit",世界:"World",世界ID:"World ID","世界主人在线中，需等待下线才能进入":"World owner is online; wait for them to go offline before entering","世界主人已上线，你被驱逐出了该世界":"World owner is online; you were expelled from this world",世界档案:"World Profile",世界隐私已切换为:"World privacy switched to",丢弃失败:"Discard failed",个模型:"models",个配置:"configs",中期:"Mid-term",中期记忆:"Medium-term Memory",主修功法:"Main Technique",事件:"Events",人心所向:"Public Sentiment",人物属性:"Attributes",人脉交际管理:"Social Network","仅支持OpenAI兼容API（如DeepSeek）。使用前请确保提示词中包含JSON格式说明。":"Only OpenAI-compatible APIs are supported (e.g., DeepSeek). Make sure your prompt includes JSON format instructions.","仅生成大陆（开局优化）":"Generate Continents Only (startup optimized)",管理员后台:"Immortal Admin",管理员登录:"Immortal Login",会话:"Session",体格数据未生成:"Body data not generated",体脂率:"Body Fat",体重:"Weight",你已被驱逐出该世界:"You were expelled from this world","例如：主力API":"e.g.: Primary API","例如：我是一个冷静理智的剑修，不喜欢多话，遇到危险会优先自保...":"e.g.: I am a calm and rational sword cultivator, not talkative, and prioritize self-preservation in danger...",保存提示词:"Save Prompt",进化瓶颈:"Cultivation Bottleneck",混沌世界:"Cultivation World",觉醒者:"Cultivator",生存难度:"Cultivation Difficulty",修改当前角色的名字:"Change current character name",修改道号:"Change Dao Name",训练中:"Cultivating",进化加成:"Cultivation Bonus",进化突破晋级:"Breakthrough",进化系统:"Cultivation System",背包空空如也:"Storage pouch is empty",先天:"Innate",先天属性:"Innate Six Attributes","先天属性加权 + 觉醒阶段加成 + 技艺加成":"Innate attributes weight + awakening stage bonus + skill bonus",入门:"Entry",公开:"Public",公开世界无需邀请码:"Public worlds do not require an invite code","其他玩家遇到你时，AI将根据此提示词扮演你的角色":"When other players encounter you, the AI will role-play your character based on this prompt",出身:"Origin",分步生成:"Step-by-step Generation","分步生成：分步调用AI，提高开局稳定性（推荐）":"Step-by-step generation: call AI in stages to improve stability (recommended)",切换下线代理:"Toggle Offline Agent",切换隐私:"Toggle Privacy",删:"Del",删除此记忆:"Delete this memory",删除记忆:"Delete memory",刷新状态:"Refresh status",剩余:"Remaining",功法库为空或无匹配结果:"Technique library is empty or no matches",功法描述:"Technique Description",功能分配:"Feature Allocation","加载中...":"Loading...",加载更多:"Load more",单机:"Offline",可自定义修改:"Customizable",可见性:"Visibility",后天加成:"Acquired Bonus","后端未连接，联机/穿越不可用":"Backend disconnected; online/travel unavailable","向世界主人索要邀请码...":"Ask the world owner for an invite code...","启用/禁用":"Enable/Disable",启用后NPC可能产生成人向互动内容:"When enabled, NPCs may generate adult interactions",'启用后，API将强制返回JSON格式。需要在提示词中包含"json"字样并给出JSON格式样例。':'When enabled, the API will force JSON output. Include "json" in the prompt and provide a JSON example.',品质:"Quality",响应异常:"Response Error",在线:"Online",在线状态:"Online Status",地图生成选项:"Map Generation Options",地址:"Address","基于幸运的随机波动（约-10到+15）":"Random fluctuation based on fortune (about -10 to +15)",基础体格:"Base Physique",基础值:"Base Value","决定生命值上限、恢复速度、寿命上限。影响炼体修行、抗打击能力。":"Determines HP max, recovery speed, lifespan max. Affects body cultivation and resilience.","决定精神力上限、吸收效率。影响修炼速度、能力威力。":"Determines SP max, absorption efficiency. Affects cultivation speed and ability power.","决定理智值上限、学习效率。影响功法领悟、技能掌握速度。":"Determines SAN max, learning efficiency. Affects technique comprehension and skill mastery.","备份角色ID不匹配，可能存在数据不一致":"Backup character ID mismatch; data may be inconsistent",多API配置:"Multi-API Config",大失败:"Critical Failure",大成功:"Great Success","大陆数量决定世界的宏观格局，3-7片大陆形成不同的地缘政治结构":"The number of continents shapes the world macro-structure; 3-7 continents form different geopolitics","天机混沌：":"Heavenly Secrets in Chaos:",天资:"Aptitude",天赋:"Talent",天赋资质:"Talent Aptitude",妖兽阶段:"Beast Stage","存档数据 (短路径)":"Save Data (Short Path)","存档数据(短路径)":"Save Data (Short Path)",完美:"Perfect","对AI输出进行替换：正则 / 纯文本（用于格式修正、屏蔽词替换等）":"Replace AI output: regex / plain text (for formatting fixes, filtering, etc.)",导:"Exp","导入失败，请检查文件格式":"Import failed, please check file format",导入旧版本角色:"Import legacy character","导出失败，请查看控制台":"Export failed, see console",导出时间:"Export Time",导出此存档:"Export this save",寿元数据未生成:"Lifespan data not generated",尚未修习任何训练法:"No techniques learned yet",尚未结识他人:"No acquaintances yet",尚未领悟异能:"No divine abilities yet",已关闭下线代理:"Offline agent disabled",已关闭强制JSON:"Forced JSON disabled",已分配到:"Assigned to",已分配功能:"Assigned features",已启用强制JSON:"Forced JSON enabled",已复制:"Copied",已开启下线代理:"Offline agent enabled",已领悟:"Comprehended","已有进行中的穿越，会话结束后才能继续":"A travel session is already in progress; wait for it to end",已签到:"Checked in",已读:"Read",幸运点:"Luck Points",开启:"Enable","开启后AI分两步生成：先输出正文，再生成指令（推荐开启）":"When enabled, AI generates in two steps: text first, then commands (recommended)",开启后AI响应逐字显示:"When enabled, AI responses show word by word","开始您的联机求生之旅，存档将自动同步到云端":"Start your online cultivation journey; saves will auto-sync to the cloud",开始推演:"Start Generation","开局只生成大陆，势力和地点可在游戏中动态生成，减少token消耗":"At start only continents are generated; factions and locations are generated in-game to reduce token usage","开局生成完整世界（包括势力、地点和秘境）":"Generate a full world at start (including factions, locations, and secret realms)",强制JSON:"Force JSON",强制JSON格式输出:"Force JSON output","当前不是联机存档，无法使用穿越功能":"Current save is not online; travel is unavailable",当前会话:"Current Session",当前训练:"Current Cultivation","心如明镜，尚未记录任何修行感悟":"Mind like a mirror; no cultivation insights recorded yet",总段落数:"Total Paragraphs","感悟世界规则中...":"Comprehending the world's aura...","成人内容：关闭":"Adult Content: Off","成人内容：开启":"Adult Content: On",我的世界:"My World",我的世界加载失败:"Failed to load my world",我的邀请码:"My Invite Code",我说:"I said",所在:"Location",手动总结中期记忆:"Manually summarize medium-term memory",打开:"Open",技能:"Skills",把它发给想来你世界的人:"Share it with people who want to visit your world",探索天下各地:"Explore World",提示词管理:"Prompt Management","搜索训练法...":"Search techniques...","搜索技能...":"Search skills...","搜索用户名...":"Search username...",敏感与开发:"Sensitivity & Development",敏感数据未生成:"Sensitive data not generated",敏感点:"Sensitive Points",新增API:"Add API",新增API配置:"Add API Config",无法探知角色数据:"Unable to read character data",无潜质:"No Spirit Root","无潜质，无法进化":"No spirit root; cannot cultivate",无特殊天赋:"No special talent",旧版本:"Legacy Version",时代未知:"Era Unknown",普通:"Normal",暂无事件:"No events",暂无会话日志:"No session logs",暂无可穿越的世界:"No worlds available for travel",暂无报告:"No reports",暂无掌握技能:"No mastered skills",暂无纹身与印记:"No tattoos or marks",暂无详细身体数据:"No detailed body data",最大Token数:"Max Tokens",最终判定值:"Final Judgement Value","最近 50 条入侵报告":"Last 50 invasion reports",有未保存的更改:"Unsaved changes",未启用:"Disabled",未在修炼:"Not cultivating",未找到要删除的记忆:"Memory to delete not found",未测试:"Not tested",未知:"Unknown",未知来源:"Unknown Source",未知潜质:"Unknown Spirit Root","未获取到存档数据（存档可能未完整加载）":"Save data not found (may not be fully loaded)",未读:"Unread","未配置后端服务器，联机/穿越不可用":"Backend not configured; online/travel unavailable",末页:"Last Page",查看会话日志:"View session logs",查看详情:"View Details",检索数量:"Search Count",模型:"Model",模型名称:"Model Name",模式:"Mode",模式已设置为:"Mode set to",正则替换规则:"Regex Replacement Rules","正在加载云端存档...":"Loading cloud save...",此潜质可用于进化:"This spirit root can be used for cultivation","此界一片混沌，尚无描述。":"This world is in chaos, no description yet.","此身来处，记忆未了。":"Your origin is shrouded; karmic ties remain.",此路奥妙无穷:"This path is profound and boundless",每次检索的最大记忆条数:"Max memories per search","幸运越高，期望值和上限越高":"Higher fortune increases expected value and cap",没有匹配的技能:"No matching skills",没有叙事历史可导出:"No narrative history to export",流式输出:"Streaming Output",测试连接:"Test Connection",消耗:"Cost",深练:"Deep Cultivation",添加测试记忆失败:"Failed to add test memory",清空记忆:"Clear memories","清空记忆失败，请重试":"Failed to clear memories, please retry",温度参数:"Temperature","能量充沛 - 极佳进化环境":"Abundant aura - excellent cultivation environment","能量枯竭 - 难以进化":"Depleted aura - hard to cultivate","能量浓度影响（进化/变异/战斗），探索社交不受影响":"Aura density affects cultivation/alchemy/combat; exploration and social are unaffected","能量浓郁 - 良好进化环境":"Rich aura - good cultivation environment","能量稀薄 - 进化困难":"Thin aura - cultivation is difficult","能量适中 - 普通进化环境":"Moderate aura - normal cultivation environment",突变结晶折算:"Spirit Stone Conversion",制造与合成:"Alchemy & Crafting",炼制工坊:"Workshop",物品一览:"Item Overview",状态:"Status",状态修正:"Status Modifier",独自求生:"Solo Cultivation",环境修正:"Environment Modifier","生命状态（重伤/虚弱）及 Buff/Debuff 影响":"Life status (severe injury/weakness) and Buff/Debuff effects",生成方式:"Generation Mode",生殖器:"Genitals",的世界:"'s World",短期:"Short-term",确定:"Confirm","确定要删除这个API配置吗？使用它的功能将自动回退到默认API。":"Delete this API config? Features using it will fall back to the default API.","确定要清空所有记忆吗？此操作不可撤销，同时会清空酒馆数据。":"Clear all memories? This cannot be undone and will also clear Tavern data.",确认删除:"Confirm Delete",确认清空:"Confirm Clear",社交势力:"Social Factions",异能技能:"Divine Skills",离线:"Offline",离线代理提示词:"Offline Agent Prompt",离线代理提示词已保存:"Offline agent prompt saved",私处:"Private Parts",私密档案:"Private Profile",穿越:"Travel",穿越会话已结束:"Travel session ended",穿越到此世界:"Travel to this world",穿越成功:"Travel succeeded",穿越点:"Travel Points",穿越目标:"Travel Target",突破:"Breakthrough",突破率:"Breakthrough Rate",签到:"Check-in",管理员控制台:"Admin Console",管理多个API配置和功能分配:"Manage multiple API configs and feature allocation",管理道具装备:"Items & Gear",纹身与印记:"Tattoos & Marks",经验:"Experience",结缘录:"Bond Record",结识之人:"People Met",编:"Edit",编辑API配置:"Edit API Config",编辑规则:"Edit Rules",网页环境:"Web Environment",网页端不提供法身数据:"Web version does not provide avatar/body data",罩杯:"Cup Size",联机:"Online","联机模式下不允许直接修改变量（服务器权威控制）":"In online mode, direct variable edits are not allowed (server authoritative)","联机模式下不允许直接删除变量（服务器权威控制）":"In online mode, direct variable deletion is not allowed (server authoritative)",胸围:"Bust",胸部:"Chest",腰围:"Waist",臀围:"Hips","自定义(OpenAI兼容)":"Custom (OpenAI-compatible)",自定义提示词:"Custom Prompt",获取到:"Retrieved",获取模型列表失败:"Failed to fetch model list",蜕变中:"Transforming",角色:"Character",角色信息:"Character Info",角色管理:"Character Management",记忆已清空并同步到酒馆:"Memories cleared and synced to Tavern","记忆已重新整理，旧记忆已转化":"Memories reorganized; old memories converted",记忆系统配置:"Memory System Settings","该世界未开启下线代理，无法穿越":"This world has not enabled offline agent; travel unavailable","该视图不支持保存修改，请在「存档数据(短路径)」中编辑具体路径":'This view cannot save changes. Edit specific paths in "Save Data (Short Path)".',"该视图为只读展示，请切换到「存档数据(短路径)」后再编辑具体路径":'This view is read-only. Switch to "Save Data (Short Path)" to edit paths.',详细特征:"Detailed Features",详细特征未生成:"Detailed features not generated",请从技能库选择训练法:"Please select a technique from the library",请从左侧选择一个世界:"Please select a world from the left",请先填写API地址和密钥:"Please fill in API URL and key first",请在酒馆中完善角色设定:"Please complete character settings in Tavern",请填写配置名称:"Please enter config name",请输入您的邮箱:"Please enter your email",请输入道号:"Please enter Dao name",请输入邮箱验证码:"Please enter email verification code","调整游戏文字显示大小（像素）":"Adjust game text size (pixels)",贡献:"Contribution",跳转:"Go",跳转到提示词页面修改提示词:"Go to Prompt page to edit prompts",身材数据:"Body Measurements",身材数据未生成:"Body measurements not generated",身高:"Height",过滤参与成人互动的NPC性别:"Filter NPC genders for adult interactions",返回原世界:"Return to Home World",进入他人世界:"Visit World",进度:"Progress",连接失败:"Connection failed",连接成功:"Connection successful",连接正常:"Connection OK",速度:"Speed",邀请码已重新生成:"Invite code regenerated","邀请码未生成，请点击重新生成":"Invite code not generated. Click to regenerate","邀请码（世界主人提供）":"Invite code (provided by world owner)",邮箱:"Email",配置名称:"Config Name",酒馆环境:"Tavern Environment",重新探查:"Re-scan",重新生成:"Regenerate","重要：如果使用New-API等中转服务，需确认底层模型支持！":"Important: if using relay services like New-API, ensure the underlying model supports it!",长期:"Long-term",长期记忆:"Long-term Memory",势力事务管理:"Sect Affairs",闭关:"Seclusion",陌生人:"Stranger",隐私:"Privacy",隐藏:"Hidden",页:"Page",领悟世界规则:"Dao Insights",领悟重数:"Comprehension Level",首页:"First Page",验证码:"Verification Code",高级自定义潜质:"Advanced Custom Spirit Root","📋 基本信息":"📋 Basic Info","🔞 性别偏好过滤":"🔞 Gender Preference Filter","🔞 成人内容模式":"🔞 Adult Content Mode",当前贡献点:"Current Contribution",可接取:"Available",暂无宗门任务:"No Sect Tasks",任务将由AI根据势力设定生成:"Tasks are generated by AI from the sect profile","生成中...":"Generating...",点击生成:"Generate","类型：":"Type: ","贡献奖励：":"Contribution: ","额外奖励：":"Extra Reward: ","期限：":"Deadline: ","发布人：":"Issuer: ","要求：":"Requirements: ",接取:"Accept",放弃:"Abandon","任务列表可随剧情更新，完成后自动增加贡献点":"Tasks update with story; completion adds contribution",未加入宗门或宗门数据未加载:"Not in a sect or data not loaded",无法识别宗门名称:"Sect name not found",未找到当前存档:"Save data not found",已接取任务:"Task accepted",已放弃任务:"Task abandoned",任务已完成:"Task completed",宗门任务已更新:"Sect tasks updated",生成宗门任务失败:"Failed to generate sect tasks"};function c(){return{t:(e,n)=>{let t="zh"===i.value?e:l[e]||e;if(n)for(const e in n)t=t.replace(`{${e}}`,String(n[e]));return t},currentLanguage:i,setLanguage:e=>{i.value=e,localStorage.setItem("language",e),s(e)}}}},920:(e,n,t)=>{"use strict";var a=t(9675),r=t(8859),o=t(4803),i=t(507),s=t(2271)||i||o;e.exports=function(){var e,n={assert:function(e){if(!n.has(e))throw new a("Side channel does not contain "+r(e))},delete:function(n){return!!e&&e.delete(n)},get:function(n){return e&&e.get(n)},has:function(n){return!!e&&e.has(n)},set:function(n,t){e||(e=s()),e.set(n,t)}};return n}},953:(e,n,t)=>{"use strict";t.d(n,{C4:()=>S,EW:()=>Fe,Gc:()=>he,IG:()=>_e,IJ:()=>Ee,KR:()=>Le,Kh:()=>fe,Pr:()=>De,QW:()=>ze,R1:()=>Me,Tm:()=>ye,X2:()=>u,a1:()=>Ae,bl:()=>L,fE:()=>xe,g8:()=>be,hV:()=>We,hZ:()=>O,i9:()=>Se,jr:()=>c,ju:()=>ke,lJ:()=>Ce,mu:()=>Re,o5:()=>l,qA:()=>j,tB:()=>me,u4:()=>$,uY:()=>s,ux:()=>we,wB:()=>Ue,yC:()=>i});var a=t(33);let r,o;class i{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=r,!e&&r&&(this.index=(r.scopes||(r.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,n;if(this._isPaused=!0,this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].pause();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,n;if(this._isPaused=!1,this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].resume();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].resume()}}run(e){if(this._active){const n=r;try{return r=this,e()}finally{r=n}}}on(){1===++this._on&&(this.prevScope=r,r=this)}off(){this._on>0&&0===--this._on&&(r=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){let n,t;for(this._active=!1,n=0,t=this.effects.length;n<t;n++)this.effects[n].stop();for(this.effects.length=0,n=0,t=this.cleanups.length;n<t;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}function s(e){return new i(e)}function l(){return r}function c(e,n=!1){r&&r.cleanups.push(e)}const d=new WeakSet;class u{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,r&&r.active&&r.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,d.has(this)&&(d.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||h(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,E(this),b(this);const e=o,n=C;o=this,C=!0;try{return this.fn()}finally{y(this),o=e,C=n,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)w(e);this.deps=this.depsTail=void 0,E(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?d.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){x(this)&&this.run()}get dirty(){return x(this)}}let p,v,f=0;function h(e,n=!1){if(e.flags|=8,n)return e.next=v,void(v=e);e.next=p,p=e}function m(){f++}function g(){if(--f>0)return;if(v){let e=v;for(v=void 0;e;){const n=e.next;e.next=void 0,e.flags&=-9,e=n}}let e;for(;p;){let n=p;for(p=void 0;n;){const t=n.next;if(n.next=void 0,n.flags&=-9,1&n.flags)try{n.trigger()}catch(n){e||(e=n)}n=t}}if(e)throw e}function b(e){for(let n=e.deps;n;n=n.nextDep)n.version=-1,n.prevActiveLink=n.dep.activeLink,n.dep.activeLink=n}function y(e){let n,t=e.depsTail,a=t;for(;a;){const e=a.prevDep;-1===a.version?(a===t&&(t=e),w(a),_(a)):n=a,a.dep.activeLink=a.prevActiveLink,a.prevActiveLink=void 0,a=e}e.deps=n,e.depsTail=t}function x(e){for(let n=e.deps;n;n=n.nextDep)if(n.dep.version!==n.version||n.dep.computed&&(k(n.dep.computed)||n.dep.version!==n.version))return!0;return!!e._dirty}function k(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===T)return;if(e.globalVersion=T,!e.isSSR&&128&e.flags&&(!e.deps&&!e._dirty||!x(e)))return;e.flags|=2;const n=e.dep,t=o,r=C;o=e,C=!0;try{b(e);const t=e.fn(e._value);(0===n.version||(0,a.$H)(t,e._value))&&(e.flags|=128,e._value=t,n.version++)}catch(e){throw n.version++,e}finally{o=t,C=r,y(e),e.flags&=-3}}function w(e,n=!1){const{dep:t,prevSub:a,nextSub:r}=e;if(a&&(a.nextSub=r,e.prevSub=void 0),r&&(r.prevSub=a,e.nextSub=void 0),t.subs===e&&(t.subs=a,!a&&t.computed)){t.computed.flags&=-5;for(let e=t.computed.deps;e;e=e.nextDep)w(e,!0)}n||--t.sc||!t.map||t.map.delete(t.key)}function _(e){const{prevDep:n,nextDep:t}=e;n&&(n.nextDep=t,e.prevDep=void 0),t&&(t.prevDep=n,e.nextDep=void 0)}let C=!0;const A=[];function S(){A.push(C),C=!1}function L(){const e=A.pop();C=void 0===e||e}function E(e){const{cleanup:n}=e;if(e.cleanup=void 0,n){const e=o;o=void 0;try{n()}finally{o=e}}}let T=0;class I{constructor(e,n){this.sub=e,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class R{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!o||!C||o===this.computed)return;let n=this.activeLink;if(void 0===n||n.sub!==o)n=this.activeLink=new I(o,this),o.deps?(n.prevDep=o.depsTail,o.depsTail.nextDep=n,o.depsTail=n):o.deps=o.depsTail=n,M(n);else if(-1===n.version&&(n.version=this.version,n.nextDep)){const e=n.nextDep;e.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=e),n.prevDep=o.depsTail,n.nextDep=void 0,o.depsTail.nextDep=n,o.depsTail=n,o.deps===n&&(o.deps=e)}return n}trigger(e){this.version++,T++,this.notify(e)}notify(e){m();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{g()}}}function M(e){if(e.dep.sc++,4&e.sub.flags){const n=e.dep.computed;if(n&&!e.dep.subs){n.flags|=20;for(let e=n.deps;e;e=e.nextDep)M(e)}const t=e.dep.subs;t!==e&&(e.prevSub=t,t&&(t.nextSub=e)),e.dep.subs=e}}const P=new WeakMap,D=Symbol(""),z=Symbol(""),N=Symbol("");function $(e,n,t){if(C&&o){let n=P.get(e);n||P.set(e,n=new Map);let a=n.get(t);a||(n.set(t,a=new R),a.map=n,a.key=t),a.track()}}function O(e,n,t,r,o,i){const s=P.get(e);if(!s)return void T++;const l=e=>{e&&e.trigger()};if(m(),"clear"===n)s.forEach(l);else{const o=(0,a.cy)(e),i=o&&(0,a.yI)(t);if(o&&"length"===t){const e=Number(r);s.forEach((n,t)=>{("length"===t||t===N||!(0,a.Bm)(t)&&t>=e)&&l(n)})}else switch((void 0!==t||s.has(void 0))&&l(s.get(t)),i&&l(s.get(N)),n){case"add":o?i&&l(s.get("length")):(l(s.get(D)),(0,a.CE)(e)&&l(s.get(z)));break;case"delete":o||(l(s.get(D)),(0,a.CE)(e)&&l(s.get(z)));break;case"set":(0,a.CE)(e)&&l(s.get(D))}}g()}function F(e){const n=we(e);return n===e?n:($(n,0,N),xe(e)?n:n.map(Ce))}function j(e){return $(e=we(e),0,N),e}const B={__proto__:null,[Symbol.iterator](){return X(this,Symbol.iterator,Ce)},concat(...e){return F(this).concat(...e.map(e=>(0,a.cy)(e)?F(e):e))},entries(){return X(this,"entries",e=>(e[1]=Ce(e[1]),e))},every(e,n){return W(this,"every",e,n,void 0,arguments)},filter(e,n){return W(this,"filter",e,n,e=>e.map(Ce),arguments)},find(e,n){return W(this,"find",e,n,Ce,arguments)},findIndex(e,n){return W(this,"findIndex",e,n,void 0,arguments)},findLast(e,n){return W(this,"findLast",e,n,Ce,arguments)},findLastIndex(e,n){return W(this,"findLastIndex",e,n,void 0,arguments)},forEach(e,n){return W(this,"forEach",e,n,void 0,arguments)},includes(...e){return G(this,"includes",e)},indexOf(...e){return G(this,"indexOf",e)},join(e){return F(this).join(e)},lastIndexOf(...e){return G(this,"lastIndexOf",e)},map(e,n){return W(this,"map",e,n,void 0,arguments)},pop(){return H(this,"pop")},push(...e){return H(this,"push",e)},reduce(e,...n){return q(this,"reduce",e,n)},reduceRight(e,...n){return q(this,"reduceRight",e,n)},shift(){return H(this,"shift")},some(e,n){return W(this,"some",e,n,void 0,arguments)},splice(...e){return H(this,"splice",e)},toReversed(){return F(this).toReversed()},toSorted(e){return F(this).toSorted(e)},toSpliced(...e){return F(this).toSpliced(...e)},unshift(...e){return H(this,"unshift",e)},values(){return X(this,"values",Ce)}};function X(e,n,t){const a=j(e),r=a[n]();return a===e||xe(e)||(r._next=r.next,r.next=()=>{const e=r._next();return e.value&&(e.value=t(e.value)),e}),r}const U=Array.prototype;function W(e,n,t,a,r,o){const i=j(e),s=i!==e&&!xe(e),l=i[n];if(l!==U[n]){const n=l.apply(e,o);return s?Ce(n):n}let c=t;i!==e&&(s?c=function(n,a){return t.call(this,Ce(n),a,e)}:t.length>2&&(c=function(n,a){return t.call(this,n,a,e)}));const d=l.call(i,c,a);return s&&r?r(d):d}function q(e,n,t,a){const r=j(e);let o=t;return r!==e&&(xe(e)?t.length>3&&(o=function(n,a,r){return t.call(this,n,a,r,e)}):o=function(n,a,r){return t.call(this,n,Ce(a),r,e)}),r[n](o,...a)}function G(e,n,t){const a=we(e);$(a,0,N);const r=a[n](...t);return-1!==r&&!1!==r||!ke(t[0])?r:(t[0]=we(t[0]),a[n](...t))}function H(e,n,t=[]){S(),m();const a=we(e)[n].apply(e,t);return g(),L(),a}const V=(0,a.pD)("__proto__,__v_isRef,__isVue"),Q=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>"arguments"!==e&&"caller"!==e).map(e=>Symbol[e]).filter(a.Bm));function K(e){(0,a.Bm)(e)||(e=String(e));const n=we(this);return $(n,0,e),n.hasOwnProperty(e)}class Y{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,t){if("__v_skip"===n)return e.__v_skip;const r=this._isReadonly,o=this._isShallow;if("__v_isReactive"===n)return!r;if("__v_isReadonly"===n)return r;if("__v_isShallow"===n)return o;if("__v_raw"===n)return t===(r?o?ve:pe:o?ue:de).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(t)?e:void 0;const i=(0,a.cy)(e);if(!r){let e;if(i&&(e=B[n]))return e;if("hasOwnProperty"===n)return K}const s=Reflect.get(e,n,Se(e)?e:t);return((0,a.Bm)(n)?Q.has(n):V(n))?s:(r||$(e,0,n),o?s:Se(s)?i&&(0,a.yI)(n)?s:s.value:(0,a.Gv)(s)?r?me(s):fe(s):s)}}class J extends Y{constructor(e=!1){super(!1,e)}set(e,n,t,r){let o=e[n];if(!this._isShallow){const n=ye(o);if(xe(t)||ye(t)||(o=we(o),t=we(t)),!(0,a.cy)(e)&&Se(o)&&!Se(t))return!n&&(o.value=t,!0)}const i=(0,a.cy)(e)&&(0,a.yI)(n)?Number(n)<e.length:(0,a.$3)(e,n),s=Reflect.set(e,n,t,Se(e)?e:r);return e===we(r)&&(i?(0,a.$H)(t,o)&&O(e,"set",n,t):O(e,"add",n,t)),s}deleteProperty(e,n){const t=(0,a.$3)(e,n),r=(e[n],Reflect.deleteProperty(e,n));return r&&t&&O(e,"delete",n,void 0),r}has(e,n){const t=Reflect.has(e,n);return(0,a.Bm)(n)&&Q.has(n)||$(e,0,n),t}ownKeys(e){return $(e,0,(0,a.cy)(e)?"length":D),Reflect.ownKeys(e)}}class Z extends Y{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const ee=new J,ne=new Z,te=new J(!0),ae=e=>e,re=e=>Reflect.getPrototypeOf(e);function oe(e){return function(...n){return"delete"!==e&&("clear"===e?void 0:this)}}function ie(e,n){const t=function(e,n){const t={get(t){const r=this.__v_raw,o=we(r),i=we(t);e||((0,a.$H)(t,i)&&$(o,0,t),$(o,0,i));const{has:s}=re(o),l=n?ae:e?Ae:Ce;return s.call(o,t)?l(r.get(t)):s.call(o,i)?l(r.get(i)):void(r!==o&&r.get(t))},get size(){const n=this.__v_raw;return!e&&$(we(n),0,D),Reflect.get(n,"size",n)},has(n){const t=this.__v_raw,r=we(t),o=we(n);return e||((0,a.$H)(n,o)&&$(r,0,n),$(r,0,o)),n===o?t.has(n):t.has(n)||t.has(o)},forEach(t,a){const r=this,o=r.__v_raw,i=we(o),s=n?ae:e?Ae:Ce;return!e&&$(i,0,D),o.forEach((e,n)=>t.call(a,s(e),s(n),r))}};return(0,a.X$)(t,e?{add:oe("add"),set:oe("set"),delete:oe("delete"),clear:oe("clear")}:{add(e){n||xe(e)||ye(e)||(e=we(e));const t=we(this);return re(t).has.call(t,e)||(t.add(e),O(t,"add",e,e)),this},set(e,t){n||xe(t)||ye(t)||(t=we(t));const r=we(this),{has:o,get:i}=re(r);let s=o.call(r,e);s||(e=we(e),s=o.call(r,e));const l=i.call(r,e);return r.set(e,t),s?(0,a.$H)(t,l)&&O(r,"set",e,t):O(r,"add",e,t),this},delete(e){const n=we(this),{has:t,get:a}=re(n);let r=t.call(n,e);r||(e=we(e),r=t.call(n,e)),a&&a.call(n,e);const o=n.delete(e);return r&&O(n,"delete",e,void 0),o},clear(){const e=we(this),n=0!==e.size,t=e.clear();return n&&O(e,"clear",void 0,void 0),t}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=function(e,n,t){return function(...r){const o=this.__v_raw,i=we(o),s=(0,a.CE)(i),l="entries"===e||e===Symbol.iterator&&s,c="keys"===e&&s,d=o[e](...r),u=t?ae:n?Ae:Ce;return!n&&$(i,0,c?z:D),{next(){const{value:e,done:n}=d.next();return n?{value:e,done:n}:{value:l?[u(e[0]),u(e[1])]:u(e),done:n}},[Symbol.iterator](){return this}}}}(r,e,n)}),t}(e,n);return(n,r,o)=>"__v_isReactive"===r?!e:"__v_isReadonly"===r?e:"__v_raw"===r?n:Reflect.get((0,a.$3)(t,r)&&r in n?t:n,r,o)}const se={get:ie(!1,!1)},le={get:ie(!1,!0)},ce={get:ie(!0,!1)},de=new WeakMap,ue=new WeakMap,pe=new WeakMap,ve=new WeakMap;function fe(e){return ye(e)?e:ge(e,!1,ee,se,de)}function he(e){return ge(e,!1,te,le,ue)}function me(e){return ge(e,!0,ne,ce,pe)}function ge(e,n,t,r,o){if(!(0,a.Gv)(e))return e;if(e.__v_raw&&(!n||!e.__v_isReactive))return e;const i=(s=e).__v_skip||!Object.isExtensible(s)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((0,a.Zf)(s));var s;if(0===i)return e;const l=o.get(e);if(l)return l;const c=new Proxy(e,2===i?r:t);return o.set(e,c),c}function be(e){return ye(e)?be(e.__v_raw):!(!e||!e.__v_isReactive)}function ye(e){return!(!e||!e.__v_isReadonly)}function xe(e){return!(!e||!e.__v_isShallow)}function ke(e){return!!e&&!!e.__v_raw}function we(e){const n=e&&e.__v_raw;return n?we(n):e}function _e(e){return!(0,a.$3)(e,"__v_skip")&&Object.isExtensible(e)&&(0,a.yQ)(e,"__v_skip",!0),e}const Ce=e=>(0,a.Gv)(e)?fe(e):e,Ae=e=>(0,a.Gv)(e)?me(e):e;function Se(e){return!!e&&!0===e.__v_isRef}function Le(e){return Te(e,!1)}function Ee(e){return Te(e,!0)}function Te(e,n){return Se(e)?e:new Ie(e,n)}class Ie{constructor(e,n){this.dep=new R,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?e:we(e),this._value=n?e:Ce(e),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,t=this.__v_isShallow||xe(e)||ye(e);e=t?e:we(e),(0,a.$H)(e,n)&&(this._rawValue=e,this._value=t?e:Ce(e),this.dep.trigger())}}function Re(e){e.dep&&e.dep.trigger()}function Me(e){return Se(e)?e.value:e}const Pe={get:(e,n,t)=>"__v_raw"===n?e:Me(Reflect.get(e,n,t)),set:(e,n,t,a)=>{const r=e[n];return Se(r)&&!Se(t)?(r.value=t,!0):Reflect.set(e,n,t,a)}};function De(e){return be(e)?e:new Proxy(e,Pe)}function ze(e){const n=(0,a.cy)(e)?new Array(e.length):{};for(const t in e)n[t]=$e(e,t);return n}class Ne{constructor(e,n,t){this._object=e,this._key=n,this._defaultValue=t,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=void 0===e?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return function(e,n){const t=P.get(e);return t&&t.get(n)}(we(this._object),this._key)}}function $e(e,n,t){const a=e[n];return Se(a)?a:new Ne(e,n,t)}class Oe{constructor(e,n,t){this.fn=e,this.setter=n,this._value=void 0,this.dep=new R(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=T-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=t}notify(){if(this.flags|=16,!(8&this.flags||o===this))return h(this,!0),!0}get value(){const e=this.dep.track();return k(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Fe(e,n,t=!1){let r,o;return(0,a.Tn)(e)?r=e:(r=e.get,o=e.set),new Oe(r,o,t)}const je={},Be=new WeakMap;let Xe;function Ue(e,n,t=a.MZ){const{immediate:r,deep:o,once:i,scheduler:s,augmentJob:c,call:d}=t,p=e=>o?e:xe(e)||!1===o||0===o?We(e,1):We(e);let v,f,h,m,g=!1,b=!1;if(Se(e)?(f=()=>e.value,g=xe(e)):be(e)?(f=()=>p(e),g=!0):(0,a.cy)(e)?(b=!0,g=e.some(e=>be(e)||xe(e)),f=()=>e.map(e=>Se(e)?e.value:be(e)?p(e):(0,a.Tn)(e)?d?d(e,2):e():void 0)):f=(0,a.Tn)(e)?n?d?()=>d(e,2):e:()=>{if(h){S();try{h()}finally{L()}}const n=Xe;Xe=v;try{return d?d(e,3,[m]):e(m)}finally{Xe=n}}:a.tE,n&&o){const e=f,n=!0===o?1/0:o;f=()=>We(e(),n)}const y=l(),x=()=>{v.stop(),y&&y.active&&(0,a.TF)(y.effects,v)};if(i&&n){const e=n;n=(...n)=>{e(...n),x()}}let k=b?new Array(e.length).fill(je):je;const w=e=>{if(1&v.flags&&(v.dirty||e))if(n){const e=v.run();if(o||g||(b?e.some((e,n)=>(0,a.$H)(e,k[n])):(0,a.$H)(e,k))){h&&h();const t=Xe;Xe=v;try{const t=[e,k===je?void 0:b&&k[0]===je?[]:k,m];k=e,d?d(n,3,t):n(...t)}finally{Xe=t}}}else v.run()};return c&&c(w),v=new u(f),v.scheduler=s?()=>s(w,!1):w,m=e=>function(e,n=!1,t=Xe){if(t){let n=Be.get(t);n||Be.set(t,n=[]),n.push(e)}}(e,!1,v),h=v.onStop=()=>{const e=Be.get(v);if(e){if(d)d(e,4);else for(const n of e)n();Be.delete(v)}},n?r?w(!0):k=v.run():s?s(w.bind(null,!0),!0):v.run(),x.pause=v.pause.bind(v),x.resume=v.resume.bind(v),x.stop=x,x}function We(e,n=1/0,t){if(n<=0||!(0,a.Gv)(e)||e.__v_skip)return e;if((t=t||new Set).has(e))return e;if(t.add(e),n--,Se(e))We(e.value,n,t);else if((0,a.cy)(e))for(let a=0;a<e.length;a++)We(e[a],n,t);else if((0,a.vM)(e)||(0,a.CE)(e))e.forEach(e=>{We(e,n,t)});else if((0,a.Qd)(e)){for(const a in e)We(e[a],n,t);for(const a of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,a)&&We(e[a],n,t)}return e}},960:(e,n,t)=>{"use strict";function a(e,n,t){const a={isLeader:!1,isMaster:!1,position:t?.职位||"",sectName:t?.势力名称||"",sect:null};if(!e)return a;for(const t of n){const n=t?.领导层||t?.leadership;if(n){if(n.首领===e||n.宗主===e||n.掌门===e)return a.isLeader=!0,a.isMaster=!0,a.position="首领",a.sectName=t.名称,a.sect=t,a;if(n.副首领===e||n.副宗主===e||n.副掌门===e)return a.isLeader=!0,a.isMaster=!1,a.position="副首领",a.sectName=t.名称,a.sect=t,a}}if(t?.职位){const e=t.职位;if(["首领","副首领","宗主","掌门","副宗主","副掌门"].includes(e)){a.isLeader=!0,a.isMaster=["首领","宗主","掌门"].includes(e),a.position=e.replace("宗主","首领").replace("掌门","首领"),a.sectName=t.势力名称||"";const r=t.势力名称;a.sect=r&&n.find(e=>e.名称===r)||null}}return a}function r(e){return/首领|副首领|宗主|掌门|副宗主|副掌门/.test(e)}t.d(n,{Z:()=>a,b:()=>r})},1002:e=>{"use strict";e.exports=Function.prototype.apply},1021:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.raw-data-section[data-v-2cab0dce] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-2cab0dce] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-2cab0dce] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.raw-data-content[data-v-2cab0dce] {\n  flex: 1;\n  overflow: hidden;\n}\n.data-display[data-v-2cab0dce] {\n  height: 100%;\n  overflow: hidden;\n}\n.code-pre[data-v-2cab0dce] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  height: 100%;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-2cab0dce] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.raw-data-section[data-v-2cab0dce] {\n    padding: 0.75rem;\n}\n.section-title[data-v-2cab0dce] {\n    font-size: 1rem;\n    text-align: center;\n}\n.code-pre[data-v-2cab0dce] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n.empty-state[data-v-2cab0dce] {\n    padding: 2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.raw-data-section[data-v-2cab0dce] {\n    padding: 0.5rem;\n}\n.section-title[data-v-2cab0dce] {\n    font-size: 0.9rem;\n}\n.code-pre[data-v-2cab0dce] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n}\n",""]);const s=i},1040:(e,n,t)=>{"use strict";function a(){const e=document;return document.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||null}function r(){try{return window.self!==window.top}catch{return!0}}async function o(e){const n=e||document.documentElement;if(!n)throw new Error("No element to request fullscreen.");if("function"!=typeof n.requestFullscreen)if("function"!=typeof n.webkitRequestFullscreen)if("function"!=typeof n.mozRequestFullScreen){if("function"!=typeof n.msRequestFullscreen)throw new Error("Fullscreen API not supported in this browser/environment.");await n.msRequestFullscreen()}else await n.mozRequestFullScreen();else await n.webkitRequestFullscreen();else await n.requestFullscreen()}async function i(){const e=document;if("function"!=typeof document.exitFullscreen)if("function"!=typeof e.webkitExitFullscreen)if("function"!=typeof e.mozCancelFullScreen){if("function"!=typeof e.msExitFullscreen)throw new Error("Exit fullscreen not supported in this browser/environment.");await e.msExitFullscreen()}else await e.mozCancelFullScreen();else await e.webkitExitFullscreen();else await document.exitFullscreen()}function s(e){const n=e,t=String(n?.name||""),a=String(n?.message||""),o=("undefined"!=typeof navigator?navigator.userAgent:"").toLowerCase(),i=/iphone|ipad|ipod/.test(o),s=o.includes("safari")&&!o.includes("crios")&&!o.includes("fxios")&&!o.includes("edgios");return"TypeError"===t?"当前浏览器/环境不支持全屏 API（iOS Safari 网页通常无法全屏；嵌入式WebView也可能禁用）。":a.toLowerCase().includes("not supported")||a.toLowerCase().includes("not supported in this browser")?r()?'嵌入环境可能不支持或未允许全屏（需要 allowfullscreen / allow="fullscreen"）。建议在浏览器新标签打开再全屏。':i&&s?"iOS Safari 网页通常无法进入全屏（除视频播放器）。建议使用其他浏览器或以“添加到主屏幕/PWA”方式打开。":"当前浏览器/环境不支持全屏 API。":"NotAllowedError"===t||"SecurityError"===t?r()?'当前为嵌入环境，iframe 可能未允许全屏（需要 allowfullscreen / allow="fullscreen"）。建议在浏览器新标签打开再全屏。':"浏览器阻止进入全屏：需要用户手势触发，或站点权限策略禁止。":a.toLowerCase().includes("fullscreen")?`全屏失败：${a}`:"无法进入全屏模式（可能被浏览器或嵌入环境限制）。"}t.d(n,{Eh:()=>i,Kn:()=>a,lh:()=>o,zp:()=>s})},1064:(e,n,t)=>{"use strict";var a=t(9612);e.exports=a.getPrototypeOf||null},1083:(e,n,t)=>{"use strict";t.d(n,{A:()=>xn});var a={};function r(e,n){return function(){return e.apply(n,arguments)}}t.r(a),t.d(a,{hasBrowserEnv:()=>ve,hasStandardBrowserEnv:()=>he,hasStandardBrowserWebWorkerEnv:()=>me,navigator:()=>fe,origin:()=>ge});const{toString:o}=Object.prototype,{getPrototypeOf:i}=Object,{iterator:s,toStringTag:l}=Symbol,c=(d=Object.create(null),e=>{const n=o.call(e);return d[n]||(d[n]=n.slice(8,-1).toLowerCase())});var d;const u=e=>(e=e.toLowerCase(),n=>c(n)===e),p=e=>n=>typeof n===e,{isArray:v}=Array,f=p("undefined");function h(e){return null!==e&&!f(e)&&null!==e.constructor&&!f(e.constructor)&&b(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const m=u("ArrayBuffer"),g=p("string"),b=p("function"),y=p("number"),x=e=>null!==e&&"object"==typeof e,k=e=>{if("object"!==c(e))return!1;const n=i(e);return!(null!==n&&n!==Object.prototype&&null!==Object.getPrototypeOf(n)||l in e||s in e)},w=u("Date"),_=u("File"),C=u("Blob"),A=u("FileList"),S=u("URLSearchParams"),[L,E,T,I]=["ReadableStream","Request","Response","Headers"].map(u);function R(e,n,{allOwnKeys:t=!1}={}){if(null==e)return;let a,r;if("object"!=typeof e&&(e=[e]),v(e))for(a=0,r=e.length;a<r;a++)n.call(null,e[a],a,e);else{if(h(e))return;const r=t?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let i;for(a=0;a<o;a++)i=r[a],n.call(null,e[i],i,e)}}function M(e,n){if(h(e))return null;n=n.toLowerCase();const t=Object.keys(e);let a,r=t.length;for(;r-- >0;)if(a=t[r],n===a.toLowerCase())return a;return null}const P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,D=e=>!f(e)&&e!==P,z=(N="undefined"!=typeof Uint8Array&&i(Uint8Array),e=>N&&e instanceof N);var N;const $=u("HTMLFormElement"),O=(({hasOwnProperty:e})=>(n,t)=>e.call(n,t))(Object.prototype),F=u("RegExp"),j=(e,n)=>{const t=Object.getOwnPropertyDescriptors(e),a={};R(t,(t,r)=>{let o;!1!==(o=n(t,r,e))&&(a[r]=o||t)}),Object.defineProperties(e,a)},B=u("AsyncFunction"),X=(U="function"==typeof setImmediate,W=b(P.postMessage),U?setImmediate:W?(q=`axios@${Math.random()}`,G=[],P.addEventListener("message",({source:e,data:n})=>{e===P&&n===q&&G.length&&G.shift()()},!1),e=>{G.push(e),P.postMessage(q,"*")}):e=>setTimeout(e));var U,W,q,G;const H="undefined"!=typeof queueMicrotask?queueMicrotask.bind(P):"undefined"!=typeof process&&process.nextTick||X,V={isArray:v,isArrayBuffer:m,isBuffer:h,isFormData:e=>{let n;return e&&("function"==typeof FormData&&e instanceof FormData||b(e.append)&&("formdata"===(n=c(e))||"object"===n&&b(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let n;return n="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&m(e.buffer),n},isString:g,isNumber:y,isBoolean:e=>!0===e||!1===e,isObject:x,isPlainObject:k,isEmptyObject:e=>{if(!x(e)||h(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(e){return!1}},isReadableStream:L,isRequest:E,isResponse:T,isHeaders:I,isUndefined:f,isDate:w,isFile:_,isBlob:C,isRegExp:F,isFunction:b,isStream:e=>x(e)&&b(e.pipe),isURLSearchParams:S,isTypedArray:z,isFileList:A,forEach:R,merge:function e(){const{caseless:n,skipUndefined:t}=D(this)&&this||{},a={},r=(r,o)=>{const i=n&&M(a,o)||o;k(a[i])&&k(r)?a[i]=e(a[i],r):k(r)?a[i]=e({},r):v(r)?a[i]=r.slice():t&&f(r)||(a[i]=r)};for(let e=0,n=arguments.length;e<n;e++)arguments[e]&&R(arguments[e],r);return a},extend:(e,n,t,{allOwnKeys:a}={})=>(R(n,(n,a)=>{t&&b(n)?e[a]=r(n,t):e[a]=n},{allOwnKeys:a}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,n,t,a)=>{e.prototype=Object.create(n.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),t&&Object.assign(e.prototype,t)},toFlatObject:(e,n,t,a)=>{let r,o,s;const l={};if(n=n||{},null==e)return n;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)s=r[o],a&&!a(s,e,n)||l[s]||(n[s]=e[s],l[s]=!0);e=!1!==t&&i(e)}while(e&&(!t||t(e,n))&&e!==Object.prototype);return n},kindOf:c,kindOfTest:u,endsWith:(e,n,t)=>{e=String(e),(void 0===t||t>e.length)&&(t=e.length),t-=n.length;const a=e.indexOf(n,t);return-1!==a&&a===t},toArray:e=>{if(!e)return null;if(v(e))return e;let n=e.length;if(!y(n))return null;const t=new Array(n);for(;n-- >0;)t[n]=e[n];return t},forEachEntry:(e,n)=>{const t=(e&&e[s]).call(e);let a;for(;(a=t.next())&&!a.done;){const t=a.value;n.call(e,t[0],t[1])}},matchAll:(e,n)=>{let t;const a=[];for(;null!==(t=e.exec(n));)a.push(t);return a},isHTMLForm:$,hasOwnProperty:O,hasOwnProp:O,reduceDescriptors:j,freezeMethods:e=>{j(e,(n,t)=>{if(b(e)&&-1!==["arguments","caller","callee"].indexOf(t))return!1;const a=e[t];b(a)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")}))})},toObjectSet:(e,n)=>{const t={},a=e=>{e.forEach(e=>{t[e]=!0})};return v(e)?a(e):a(String(e).split(n)),t},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,t){return n.toUpperCase()+t}),noop:()=>{},toFiniteNumber:(e,n)=>null!=e&&Number.isFinite(e=+e)?e:n,findKey:M,global:P,isContextDefined:D,isSpecCompliantForm:function(e){return!!(e&&b(e.append)&&"FormData"===e[l]&&e[s])},toJSONObject:e=>{const n=new Array(10),t=(e,a)=>{if(x(e)){if(n.indexOf(e)>=0)return;if(h(e))return e;if(!("toJSON"in e)){n[a]=e;const r=v(e)?[]:{};return R(e,(e,n)=>{const o=t(e,a+1);!f(o)&&(r[n]=o)}),n[a]=void 0,r}}return e};return t(e,0)},isAsyncFn:B,isThenable:e=>e&&(x(e)||b(e))&&b(e.then)&&b(e.catch),setImmediate:X,asap:H,isIterable:e=>null!=e&&b(e[s])};function Q(e,n,t,a,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",n&&(this.code=n),t&&(this.config=t),a&&(this.request=a),r&&(this.response=r,this.status=r.status?r.status:null)}V.inherits(Q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:V.toJSONObject(this.config),code:this.code,status:this.status}}});const K=Q.prototype,Y={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Y[e]={value:e}}),Object.defineProperties(Q,Y),Object.defineProperty(K,"isAxiosError",{value:!0}),Q.from=(e,n,t,a,r,o)=>{const i=Object.create(K);V.toFlatObject(e,i,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const s=e&&e.message?e.message:"Error",l=null==n&&e?e.code:n;return Q.call(i,s,l,t,a,r),e&&null==i.cause&&Object.defineProperty(i,"cause",{value:e,configurable:!0}),i.name=e&&e.name||"Error",o&&Object.assign(i,o),i};const J=Q;function Z(e){return V.isPlainObject(e)||V.isArray(e)}function ee(e){return V.endsWith(e,"[]")?e.slice(0,-2):e}function ne(e,n,t){return e?e.concat(n).map(function(e,n){return e=ee(e),!t&&n?"["+e+"]":e}).join(t?".":""):n}const te=V.toFlatObject(V,{},null,function(e){return/^is[A-Z]/.test(e)}),ae=function(e,n,t){if(!V.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const a=(t=V.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,n){return!V.isUndefined(n[e])})).metaTokens,r=t.visitor||c,o=t.dots,i=t.indexes,s=(t.Blob||"undefined"!=typeof Blob&&Blob)&&V.isSpecCompliantForm(n);if(!V.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(V.isDate(e))return e.toISOString();if(V.isBoolean(e))return e.toString();if(!s&&V.isBlob(e))throw new J("Blob is not supported. Use a Buffer instead.");return V.isArrayBuffer(e)||V.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,t,r){let s=e;if(e&&!r&&"object"==typeof e)if(V.endsWith(t,"{}"))t=a?t:t.slice(0,-2),e=JSON.stringify(e);else if(V.isArray(e)&&function(e){return V.isArray(e)&&!e.some(Z)}(e)||(V.isFileList(e)||V.endsWith(t,"[]"))&&(s=V.toArray(e)))return t=ee(t),s.forEach(function(e,a){!V.isUndefined(e)&&null!==e&&n.append(!0===i?ne([t],a,o):null===i?t:t+"[]",l(e))}),!1;return!!Z(e)||(n.append(ne(r,t,o),l(e)),!1)}const d=[],u=Object.assign(te,{defaultVisitor:c,convertValue:l,isVisitable:Z});if(!V.isObject(e))throw new TypeError("data must be an object");return function e(t,a){if(!V.isUndefined(t)){if(-1!==d.indexOf(t))throw Error("Circular reference detected in "+a.join("."));d.push(t),V.forEach(t,function(t,o){!0===(!(V.isUndefined(t)||null===t)&&r.call(n,t,V.isString(o)?o.trim():o,a,u))&&e(t,a?a.concat(o):[o])}),d.pop()}}(e),n};function re(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return n[e]})}function oe(e,n){this._pairs=[],e&&ae(e,this,n)}const ie=oe.prototype;ie.append=function(e,n){this._pairs.push([e,n])},ie.toString=function(e){const n=e?function(n){return e.call(this,n,re)}:re;return this._pairs.map(function(e){return n(e[0])+"="+n(e[1])},"").join("&")};const se=oe;function le(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ce(e,n,t){if(!n)return e;const a=t&&t.encode||le;V.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let o;if(o=r?r(n,t):V.isURLSearchParams(n)?n.toString():new se(n,t).toString(a),o){const n=e.indexOf("#");-1!==n&&(e=e.slice(0,n)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const de=class{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){V.forEach(this.handlers,function(n){null!==n&&e(n)})}},ue={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},pe={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:se,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ve="undefined"!=typeof window&&"undefined"!=typeof document,fe="object"==typeof navigator&&navigator||void 0,he=ve&&(!fe||["ReactNative","NativeScript","NS"].indexOf(fe.product)<0),me="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ge=ve&&window.location.href||"http://localhost",be={...a,...pe},ye=function(e){function n(e,t,a,r){let o=e[r++];if("__proto__"===o)return!0;const i=Number.isFinite(+o),s=r>=e.length;return o=!o&&V.isArray(a)?a.length:o,s?(V.hasOwnProp(a,o)?a[o]=[a[o],t]:a[o]=t,!i):(a[o]&&V.isObject(a[o])||(a[o]=[]),n(e,t,a[o],r)&&V.isArray(a[o])&&(a[o]=function(e){const n={},t=Object.keys(e);let a;const r=t.length;let o;for(a=0;a<r;a++)o=t[a],n[o]=e[o];return n}(a[o])),!i)}if(V.isFormData(e)&&V.isFunction(e.entries)){const t={};return V.forEachEntry(e,(e,a)=>{n(function(e){return V.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),a,t,0)}),t}return null},xe={transitional:ue,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",a=t.indexOf("application/json")>-1,r=V.isObject(e);if(r&&V.isHTMLForm(e)&&(e=new FormData(e)),V.isFormData(e))return a?JSON.stringify(ye(e)):e;if(V.isArrayBuffer(e)||V.isBuffer(e)||V.isStream(e)||V.isFile(e)||V.isBlob(e)||V.isReadableStream(e))return e;if(V.isArrayBufferView(e))return e.buffer;if(V.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(t.indexOf("application/x-www-form-urlencoded")>-1)return function(e,n){return ae(e,new be.classes.URLSearchParams,{visitor:function(e,n,t,a){return be.isNode&&V.isBuffer(e)?(this.append(n,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...n})}(e,this.formSerializer).toString();if((o=V.isFileList(e))||t.indexOf("multipart/form-data")>-1){const n=this.env&&this.env.FormData;return ae(o?{"files[]":e}:e,n&&new n,this.formSerializer)}}return r||a?(n.setContentType("application/json",!1),function(e){if(V.isString(e))try{return(0,JSON.parse)(e),V.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const n=this.transitional||xe.transitional,t=n&&n.forcedJSONParsing,a="json"===this.responseType;if(V.isResponse(e)||V.isReadableStream(e))return e;if(e&&V.isString(e)&&(t&&!this.responseType||a)){const t=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(e){if(t){if("SyntaxError"===e.name)throw J.from(e,J.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:be.classes.FormData,Blob:be.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};V.forEach(["delete","get","head","post","put","patch"],e=>{xe.headers[e]={}});const ke=xe,we=V.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_e=Symbol("internals");function Ce(e){return e&&String(e).trim().toLowerCase()}function Ae(e){return!1===e||null==e?e:V.isArray(e)?e.map(Ae):String(e)}function Se(e,n,t,a,r){return V.isFunction(a)?a.call(this,n,t):(r&&(n=t),V.isString(n)?V.isString(a)?-1!==n.indexOf(a):V.isRegExp(a)?a.test(n):void 0:void 0)}class Le{constructor(e){e&&this.set(e)}set(e,n,t){const a=this;function r(e,n,t){const r=Ce(n);if(!r)throw new Error("header name must be a non-empty string");const o=V.findKey(a,r);(!o||void 0===a[o]||!0===t||void 0===t&&!1!==a[o])&&(a[o||n]=Ae(e))}const o=(e,n)=>V.forEach(e,(e,t)=>r(e,t,n));if(V.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(V.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const n={};let t,a,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),t=e.substring(0,r).trim().toLowerCase(),a=e.substring(r+1).trim(),!t||n[t]&&we[t]||("set-cookie"===t?n[t]?n[t].push(a):n[t]=[a]:n[t]=n[t]?n[t]+", "+a:a)}),n})(e),n);else if(V.isObject(e)&&V.isIterable(e)){let t,a,r={};for(const n of e){if(!V.isArray(n))throw TypeError("Object iterator must return a key-value pair");r[a=n[0]]=(t=r[a])?V.isArray(t)?[...t,n[1]]:[t,n[1]]:n[1]}o(r,n)}else null!=e&&r(n,e,t);return this}get(e,n){if(e=Ce(e)){const t=V.findKey(this,e);if(t){const e=this[t];if(!n)return e;if(!0===n)return function(e){const n=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=t.exec(e);)n[a[1]]=a[2];return n}(e);if(V.isFunction(n))return n.call(this,e,t);if(V.isRegExp(n))return n.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Ce(e)){const t=V.findKey(this,e);return!(!t||void 0===this[t]||n&&!Se(0,this[t],t,n))}return!1}delete(e,n){const t=this;let a=!1;function r(e){if(e=Ce(e)){const r=V.findKey(t,e);!r||n&&!Se(0,t[r],r,n)||(delete t[r],a=!0)}}return V.isArray(e)?e.forEach(r):r(e),a}clear(e){const n=Object.keys(this);let t=n.length,a=!1;for(;t--;){const r=n[t];e&&!Se(0,this[r],r,e,!0)||(delete this[r],a=!0)}return a}normalize(e){const n=this,t={};return V.forEach(this,(a,r)=>{const o=V.findKey(t,r);if(o)return n[o]=Ae(a),void delete n[r];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}(r):String(r).trim();i!==r&&delete n[r],n[i]=Ae(a),t[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return V.forEach(this,(t,a)=>{null!=t&&!1!==t&&(n[a]=e&&V.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(e=>t.set(e)),t}static accessor(e){const n=(this[_e]=this[_e]={accessors:{}}).accessors,t=this.prototype;function a(e){const a=Ce(e);n[a]||(function(e,n){const t=V.toCamelCase(" "+n);["get","set","has"].forEach(a=>{Object.defineProperty(e,a+t,{value:function(e,t,r){return this[a].call(this,n,e,t,r)},configurable:!0})})}(t,e),n[a]=!0)}return V.isArray(e)?e.forEach(a):a(e),this}}Le.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),V.reduceDescriptors(Le.prototype,({value:e},n)=>{let t=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(e){this[t]=e}}}),V.freezeMethods(Le);const Ee=Le;function Te(e,n){const t=this||ke,a=n||t,r=Ee.from(a.headers);let o=a.data;return V.forEach(e,function(e){o=e.call(t,o,r.normalize(),n?n.status:void 0)}),r.normalize(),o}function Ie(e){return!(!e||!e.__CANCEL__)}function Re(e,n,t){J.call(this,null==e?"canceled":e,J.ERR_CANCELED,n,t),this.name="CanceledError"}V.inherits(Re,J,{__CANCEL__:!0});const Me=Re;function Pe(e,n,t){const a=t.config.validateStatus;t.status&&a&&!a(t.status)?n(new J("Request failed with status code "+t.status,[J.ERR_BAD_REQUEST,J.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t)):e(t)}const De=(e,n,t=3)=>{let a=0;const r=function(e,n){e=e||10;const t=new Array(e),a=new Array(e);let r,o=0,i=0;return n=void 0!==n?n:1e3,function(s){const l=Date.now(),c=a[i];r||(r=l),t[o]=s,a[o]=l;let d=i,u=0;for(;d!==o;)u+=t[d++],d%=e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),l-r<n)return;const p=c&&l-c;return p?Math.round(1e3*u/p):void 0}}(50,250);return function(e,n){let t,a,r=0,o=1e3/n;const i=(n,o=Date.now())=>{r=o,t=null,a&&(clearTimeout(a),a=null),e(...n)};return[(...e)=>{const n=Date.now(),s=n-r;s>=o?i(e,n):(t=e,a||(a=setTimeout(()=>{a=null,i(t)},o-s)))},()=>t&&i(t)]}(t=>{const o=t.loaded,i=t.lengthComputable?t.total:void 0,s=o-a,l=r(s);a=o,e({loaded:o,total:i,progress:i?o/i:void 0,bytes:s,rate:l||void 0,estimated:l&&i&&o<=i?(i-o)/l:void 0,event:t,lengthComputable:null!=i,[n?"download":"upload"]:!0})},t)},ze=(e,n)=>{const t=null!=e;return[a=>n[0]({lengthComputable:t,total:e,loaded:a}),n[1]]},Ne=e=>(...n)=>V.asap(()=>e(...n)),$e=be.hasStandardBrowserEnv?((e,n)=>t=>(t=new URL(t,be.origin),e.protocol===t.protocol&&e.host===t.host&&(n||e.port===t.port)))(new URL(be.origin),be.navigator&&/(msie|trident)/i.test(be.navigator.userAgent)):()=>!0,Oe=be.hasStandardBrowserEnv?{write(e,n,t,a,r,o){const i=[e+"="+encodeURIComponent(n)];V.isNumber(t)&&i.push("expires="+new Date(t).toGMTString()),V.isString(a)&&i.push("path="+a),V.isString(r)&&i.push("domain="+r),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Fe(e,n,t){let a=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n);return e&&(a||0==t)?function(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}(e,n):n}const je=e=>e instanceof Ee?{...e}:e;function Be(e,n){n=n||{};const t={};function a(e,n,t,a){return V.isPlainObject(e)&&V.isPlainObject(n)?V.merge.call({caseless:a},e,n):V.isPlainObject(n)?V.merge({},n):V.isArray(n)?n.slice():n}function r(e,n,t,r){return V.isUndefined(n)?V.isUndefined(e)?void 0:a(void 0,e,0,r):a(e,n,0,r)}function o(e,n){if(!V.isUndefined(n))return a(void 0,n)}function i(e,n){return V.isUndefined(n)?V.isUndefined(e)?void 0:a(void 0,e):a(void 0,n)}function s(t,r,o){return o in n?a(t,r):o in e?a(void 0,t):void 0}const l={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,n,t)=>r(je(e),je(n),0,!0)};return V.forEach(Object.keys({...e,...n}),function(a){const o=l[a]||r,i=o(e[a],n[a],a);V.isUndefined(i)&&o!==s||(t[a]=i)}),t}const Xe=e=>{const n=Be({},e);let{data:t,withXSRFToken:a,xsrfHeaderName:r,xsrfCookieName:o,headers:i,auth:s}=n;if(n.headers=i=Ee.from(i),n.url=ce(Fe(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&i.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),V.isFormData(t))if(be.hasStandardBrowserEnv||be.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(V.isFunction(t.getHeaders)){const e=t.getHeaders(),n=["content-type","content-length"];Object.entries(e).forEach(([e,t])=>{n.includes(e.toLowerCase())&&i.set(e,t)})}if(be.hasStandardBrowserEnv&&(a&&V.isFunction(a)&&(a=a(n)),a||!1!==a&&$e(n.url))){const e=r&&o&&Oe.read(o);e&&i.set(r,e)}return n},Ue="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(n,t){const a=Xe(e);let r=a.data;const o=Ee.from(a.headers).normalize();let i,s,l,c,d,{responseType:u,onUploadProgress:p,onDownloadProgress:v}=a;function f(){c&&c(),d&&d(),a.cancelToken&&a.cancelToken.unsubscribe(i),a.signal&&a.signal.removeEventListener("abort",i)}let h=new XMLHttpRequest;function m(){if(!h)return;const a=Ee.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders());Pe(function(e){n(e),f()},function(e){t(e),f()},{data:u&&"text"!==u&&"json"!==u?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:a,config:e,request:h}),h=null}h.open(a.method.toUpperCase(),a.url,!0),h.timeout=a.timeout,"onloadend"in h?h.onloadend=m:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(m)},h.onabort=function(){h&&(t(new J("Request aborted",J.ECONNABORTED,e,h)),h=null)},h.onerror=function(n){const a=n&&n.message?n.message:"Network Error",r=new J(a,J.ERR_NETWORK,e,h);r.event=n||null,t(r),h=null},h.ontimeout=function(){let n=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const r=a.transitional||ue;a.timeoutErrorMessage&&(n=a.timeoutErrorMessage),t(new J(n,r.clarifyTimeoutError?J.ETIMEDOUT:J.ECONNABORTED,e,h)),h=null},void 0===r&&o.setContentType(null),"setRequestHeader"in h&&V.forEach(o.toJSON(),function(e,n){h.setRequestHeader(n,e)}),V.isUndefined(a.withCredentials)||(h.withCredentials=!!a.withCredentials),u&&"json"!==u&&(h.responseType=a.responseType),v&&([l,d]=De(v,!0),h.addEventListener("progress",l)),p&&h.upload&&([s,c]=De(p),h.upload.addEventListener("progress",s),h.upload.addEventListener("loadend",c)),(a.cancelToken||a.signal)&&(i=n=>{h&&(t(!n||n.type?new Me(null,e,h):n),h.abort(),h=null)},a.cancelToken&&a.cancelToken.subscribe(i),a.signal&&(a.signal.aborted?i():a.signal.addEventListener("abort",i)));const g=function(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}(a.url);g&&-1===be.protocols.indexOf(g)?t(new J("Unsupported protocol "+g+":",J.ERR_BAD_REQUEST,e)):h.send(r||null)})},We=(e,n)=>{const{length:t}=e=e?e.filter(Boolean):[];if(n||t){let t,a=new AbortController;const r=function(e){if(!t){t=!0,i();const n=e instanceof Error?e:this.reason;a.abort(n instanceof J?n:new Me(n instanceof Error?n.message:n))}};let o=n&&setTimeout(()=>{o=null,r(new J(`timeout ${n} of ms exceeded`,J.ETIMEDOUT))},n);const i=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:s}=a;return s.unsubscribe=()=>V.asap(i),s}},qe=function*(e,n){let t=e.byteLength;if(!n||t<n)return void(yield e);let a,r=0;for(;r<t;)a=r+n,yield e.slice(r,a),r=a},Ge=(e,n,t,a)=>{const r=async function*(e,n){for await(const t of async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const n=e.getReader();try{for(;;){const{done:e,value:t}=await n.read();if(e)break;yield t}}finally{await n.cancel()}}(e))yield*qe(t,n)}(e,n);let o,i=0,s=e=>{o||(o=!0,a&&a(e))};return new ReadableStream({async pull(e){try{const{done:n,value:a}=await r.next();if(n)return s(),void e.close();let o=a.byteLength;if(t){let e=i+=o;t(e)}e.enqueue(new Uint8Array(a))}catch(e){throw s(e),e}},cancel:e=>(s(e),r.return())},{highWaterMark:2})},{isFunction:He}=V,Ve=(({Request:e,Response:n})=>({Request:e,Response:n}))(V.global),{ReadableStream:Qe,TextEncoder:Ke}=V.global,Ye=(e,...n)=>{try{return!!e(...n)}catch(e){return!1}},Je=e=>{e=V.merge.call({skipUndefined:!0},Ve,e);const{fetch:n,Request:t,Response:a}=e,r=n?He(n):"function"==typeof fetch,o=He(t),i=He(a);if(!r)return!1;const s=r&&He(Qe),l=r&&("function"==typeof Ke?(c=new Ke,e=>c.encode(e)):async e=>new Uint8Array(await new t(e).arrayBuffer()));var c;const d=o&&s&&Ye(()=>{let e=!1;const n=new t(be.origin,{body:new Qe,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),u=i&&s&&Ye(()=>V.isReadableStream(new a("").body)),p={stream:u&&(e=>e.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!p[e]&&(p[e]=(n,t)=>{let a=n&&n[e];if(a)return a.call(n);throw new J(`Response type '${e}' is not supported`,J.ERR_NOT_SUPPORT,t)})});return async e=>{let{url:r,method:i,data:s,signal:c,cancelToken:v,timeout:f,onDownloadProgress:h,onUploadProgress:m,responseType:g,headers:b,withCredentials:y="same-origin",fetchOptions:x}=Xe(e),k=n||fetch;g=g?(g+"").toLowerCase():"text";let w=We([c,v&&v.toAbortSignal()],f),_=null;const C=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let A;try{if(m&&d&&"get"!==i&&"head"!==i&&0!==(A=await(async(e,n)=>{const a=V.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(V.isBlob(e))return e.size;if(V.isSpecCompliantForm(e)){const n=new t(be.origin,{method:"POST",body:e});return(await n.arrayBuffer()).byteLength}return V.isArrayBufferView(e)||V.isArrayBuffer(e)?e.byteLength:(V.isURLSearchParams(e)&&(e+=""),V.isString(e)?(await l(e)).byteLength:void 0)})(n):a})(b,s))){let e,n=new t(r,{method:"POST",body:s,duplex:"half"});if(V.isFormData(s)&&(e=n.headers.get("content-type"))&&b.setContentType(e),n.body){const[e,t]=ze(A,De(Ne(m)));s=Ge(n.body,65536,e,t)}}V.isString(y)||(y=y?"include":"omit");const n=o&&"credentials"in t.prototype,c={...x,signal:w,method:i.toUpperCase(),headers:b.normalize().toJSON(),body:s,duplex:"half",credentials:n?y:void 0};_=o&&new t(r,c);let v=await(o?k(_,x):k(r,c));const f=u&&("stream"===g||"response"===g);if(u&&(h||f&&C)){const e={};["status","statusText","headers"].forEach(n=>{e[n]=v[n]});const n=V.toFiniteNumber(v.headers.get("content-length")),[t,r]=h&&ze(n,De(Ne(h),!0))||[];v=new a(Ge(v.body,65536,t,()=>{r&&r(),C&&C()}),e)}g=g||"text";let S=await p[V.findKey(p,g)||"text"](v,e);return!f&&C&&C(),await new Promise((n,t)=>{Pe(n,t,{data:S,headers:Ee.from(v.headers),status:v.status,statusText:v.statusText,config:e,request:_})})}catch(n){if(C&&C(),n&&"TypeError"===n.name&&/Load failed|fetch/i.test(n.message))throw Object.assign(new J("Network Error",J.ERR_NETWORK,e,_),{cause:n.cause||n});throw J.from(n,n&&n.code,e,_)}}},Ze=new Map,en=e=>{let n=e?e.env:{};const{fetch:t,Request:a,Response:r}=n,o=[a,r,t];let i,s,l=o.length,c=Ze;for(;l--;)i=o[l],s=c.get(i),void 0===s&&c.set(i,s=l?new Map:Je(n)),c=s;return s},nn=(en(),{http:null,xhr:Ue,fetch:{get:en}});V.forEach(nn,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch(e){}Object.defineProperty(e,"adapterName",{value:n})}});const tn=e=>`- ${e}`,an=e=>V.isFunction(e)||null===e||!1===e,rn=(e,n)=>{e=V.isArray(e)?e:[e];const{length:t}=e;let a,r;const o={};for(let i=0;i<t;i++){let t;if(a=e[i],r=a,!an(a)&&(r=nn[(t=String(a)).toLowerCase()],void 0===r))throw new J(`Unknown adapter '${t}'`);if(r&&(V.isFunction(r)||(r=r.get(n))))break;o[t||"#"+i]=r}if(!r){const e=Object.entries(o).map(([e,n])=>`adapter ${e} `+(!1===n?"is not supported by the environment":"is not available in the build"));let n=t?e.length>1?"since :\n"+e.map(tn).join("\n"):" "+tn(e[0]):"as no adapter specified";throw new J("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function on(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Me(null,e)}function sn(e){return on(e),e.headers=Ee.from(e.headers),e.data=Te.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),rn(e.adapter||ke.adapter,e)(e).then(function(n){return on(e),n.data=Te.call(e,e.transformResponse,n),n.headers=Ee.from(n.headers),n},function(n){return Ie(n)||(on(e),n&&n.response&&(n.response.data=Te.call(e,e.transformResponse,n.response),n.response.headers=Ee.from(n.response.headers))),Promise.reject(n)})}const ln="1.12.2",cn={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{cn[e]=function(t){return typeof t===e||"a"+(n<1?"n ":" ")+e}});const dn={};cn.transitional=function(e,n,t){function a(e,n){return"[Axios v"+ln+"] Transitional option '"+e+"'"+n+(t?". "+t:"")}return(t,r,o)=>{if(!1===e)throw new J(a(r," has been removed"+(n?" in "+n:"")),J.ERR_DEPRECATED);return n&&!dn[r]&&(dn[r]=!0,console.warn(a(r," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(t,r,o)}},cn.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};const un={assertOptions:function(e,n,t){if("object"!=typeof e)throw new J("options must be an object",J.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let r=a.length;for(;r-- >0;){const o=a[r],i=n[o];if(i){const n=e[o],t=void 0===n||i(n,o,e);if(!0!==t)throw new J("option "+o+" must be "+t,J.ERR_BAD_OPTION_VALUE);continue}if(!0!==t)throw new J("Unknown option "+o,J.ERR_BAD_OPTION)}},validators:cn},pn=un.validators;class vn{constructor(e){this.defaults=e||{},this.interceptors={request:new de,response:new de}}async request(e,n){try{return await this._request(e,n)}catch(e){if(e instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const t=n.stack?n.stack.replace(/^.+\n/,""):"";try{e.stack?t&&!String(e.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+t):e.stack=t}catch(e){}}throw e}}_request(e,n){"string"==typeof e?(n=n||{}).url=e:n=e||{},n=Be(this.defaults,n);const{transitional:t,paramsSerializer:a,headers:r}=n;void 0!==t&&un.assertOptions(t,{silentJSONParsing:pn.transitional(pn.boolean),forcedJSONParsing:pn.transitional(pn.boolean),clarifyTimeoutError:pn.transitional(pn.boolean)},!1),null!=a&&(V.isFunction(a)?n.paramsSerializer={serialize:a}:un.assertOptions(a,{encode:pn.function,serialize:pn.function},!0)),void 0!==n.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),un.assertOptions(n,{baseUrl:pn.spelling("baseURL"),withXsrfToken:pn.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=r&&V.merge(r.common,r[n.method]);r&&V.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),n.headers=Ee.concat(o,r);const i=[];let s=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(n)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!s){const e=[sn.bind(this),void 0];for(e.unshift(...i),e.push(...l),d=e.length,c=Promise.resolve(n);u<d;)c=c.then(e[u++],e[u++]);return c}d=i.length;let p=n;for(;u<d;){const e=i[u++],n=i[u++];try{p=e(p)}catch(e){n.call(this,e);break}}try{c=sn.call(this,p)}catch(e){return Promise.reject(e)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return ce(Fe((e=Be(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}V.forEach(["delete","get","head","options"],function(e){vn.prototype[e]=function(n,t){return this.request(Be(t||{},{method:e,url:n,data:(t||{}).data}))}}),V.forEach(["post","put","patch"],function(e){function n(n){return function(t,a,r){return this.request(Be(r||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:t,data:a}))}}vn.prototype[e]=n(),vn.prototype[e+"Form"]=n(!0)});const fn=vn;class hn{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(e){n=e});const t=this;this.promise.then(e=>{if(!t._listeners)return;let n=t._listeners.length;for(;n-- >0;)t._listeners[n](e);t._listeners=null}),this.promise.then=e=>{let n;const a=new Promise(e=>{t.subscribe(e),n=e}).then(e);return a.cancel=function(){t.unsubscribe(n)},a},e(function(e,a,r){t.reason||(t.reason=new Me(e,a,r),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);-1!==n&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=n=>{e.abort(n)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new hn(function(n){e=n}),cancel:e}}}const mn=hn,gn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gn).forEach(([e,n])=>{gn[n]=e});const bn=gn,yn=function e(n){const t=new fn(n),a=r(fn.prototype.request,t);return V.extend(a,fn.prototype,t,{allOwnKeys:!0}),V.extend(a,t,null,{allOwnKeys:!0}),a.create=function(t){return e(Be(n,t))},a}(ke);yn.Axios=fn,yn.CanceledError=Me,yn.CancelToken=mn,yn.isCancel=Ie,yn.VERSION=ln,yn.toFormData=ae,yn.AxiosError=J,yn.Cancel=yn.CanceledError,yn.all=function(e){return Promise.all(e)},yn.spread=function(e){return function(n){return e.apply(null,n)}},yn.isAxiosError=function(e){return V.isObject(e)&&!0===e.isAxiosError},yn.mergeConfig=Be,yn.AxiosHeaders=Ee,yn.formToJSON=e=>ye(V.isHTMLForm(e)?new FormData(e):e),yn.getAdapter=rn,yn.HttpStatusCode=bn,yn.default=yn;const xn=yn},1113:e=>{"use strict";e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},1153:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.overlay[data-v-a2196f8c] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.7);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  z-index: 2000;\n}\n.modal[data-v-a2196f8c] {\n  width: min(980px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  border-radius: 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  background: rgba(15, 23, 42, 0.92);\n  box-shadow: 0 25px 60px rgba(0, 0, 0, 0.55);\n  color: #e2e8f0;\n  display: flex;\n  flex-direction: column;\n}\n.header[data-v-a2196f8c] {\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  gap: 1rem;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n.title h3[data-v-a2196f8c] {\n  margin: 0;\n  font-size: 1.2rem;\n}\n.subtitle[data-v-a2196f8c] {\n  margin: 0.35rem 0 0;\n  color: rgba(148, 163, 184, 0.95);\n  font-size: 0.92rem;\n}\n.icon-btn[data-v-a2196f8c] {\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.55);\n  color: #e2e8f0;\n  width: 34px;\n  height: 34px;\n  border-radius: 10px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.1rem;\n}\n.body[data-v-a2196f8c] {\n  display: grid;\n  grid-template-columns: 340px 1fr;\n  gap: 0;\n  min-height: 0;\n  flex: 1;\n}\n.left[data-v-a2196f8c] {\n  border-right: 1px solid rgba(255, 255, 255, 0.08);\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n}\n.left-actions[data-v-a2196f8c] {\n  padding: 0.9rem 0.9rem 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n.rule-list[data-v-a2196f8c] {\n  padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  overflow: auto;\n  min-height: 0;\n}\n.rule-item[data-v-a2196f8c] {\n  border: 1px solid rgba(255, 255, 255, 0.10);\n  background: rgba(30, 41, 59, 0.40);\n  border-radius: 12px;\n  padding: 10px 10px;\n  cursor: pointer;\n  text-align: left;\n  color: inherit;\n}\n.rule-item.active[data-v-a2196f8c] {\n  border-color: rgba(147, 197, 253, 0.28);\n  background: rgba(51, 65, 85, 0.45);\n}\n.rule-row[data-v-a2196f8c] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  margin-bottom: 6px;\n}\n.rule-badge[data-v-a2196f8c] {\n  font-size: 0.75rem;\n  padding: 2px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(34, 197, 94, 0.30);\n  color: rgba(34, 197, 94, 0.95);\n}\n.rule-badge.off[data-v-a2196f8c] {\n  border-color: rgba(148, 163, 184, 0.25);\n  color: rgba(148, 163, 184, 0.95);\n}\n.rule-mode[data-v-a2196f8c] {\n  font-size: 0.75rem;\n  color: rgba(148, 163, 184, 0.95);\n}\n.rule-pattern[data-v-a2196f8c] {\n  font-size: 0.9rem;\n  color: #e2e8f0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.rule-repl[data-v-a2196f8c] {\n  margin-top: 4px;\n  font-size: 0.82rem;\n  color: rgba(148, 163, 184, 0.95);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.right[data-v-a2196f8c] {\n  padding: 1rem 1.25rem;\n  overflow: auto;\n  min-height: 0;\n}\n.editor[data-v-a2196f8c] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.editor-row[data-v-a2196f8c] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.editor-row-vertical[data-v-a2196f8c] {\n  align-items: flex-start;\n  flex-direction: column;\n}\n.label[data-v-a2196f8c] {\n  width: 90px;\n  color: rgba(148, 163, 184, 0.95);\n  font-size: 0.9rem;\n}\n.select[data-v-a2196f8c] {\n  width: 220px;\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.55);\n  color: #e2e8f0;\n  padding: 10px 12px;\n}\n.textarea[data-v-a2196f8c] {\n  width: 100%;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.40);\n  color: #e2e8f0;\n  padding: 10px 12px;\n  resize: vertical;\n}\n.hint[data-v-a2196f8c] {\n  margin-top: 8px;\n  color: rgba(148, 163, 184, 0.95);\n  font-size: 0.9rem;\n}\n.hint code[data-v-a2196f8c] {\n  padding: 1px 6px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  border-radius: 6px;\n  background: rgba(30, 41, 59, 0.6);\n}\n.options[data-v-a2196f8c] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px 16px;\n  padding: 0.5rem 0;\n}\n.opt[data-v-a2196f8c] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  color: rgba(226, 232, 240, 0.95);\n}\n.opt.disabled[data-v-a2196f8c] {\n  opacity: 0.6;\n}\n.error[data-v-a2196f8c] {\n  padding: 10px 12px;\n  border-radius: 12px;\n  border: 1px solid rgba(239, 68, 68, 0.25);\n  background: rgba(127, 29, 29, 0.25);\n  color: rgba(254, 202, 202, 0.95);\n}\n.editor-actions[data-v-a2196f8c] {\n  display: flex;\n  gap: 10px;\n  padding-top: 6px;\n}\n.footer[data-v-a2196f8c] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  padding: 1rem 1.25rem;\n  border-top: 1px solid rgba(255, 255, 255, 0.08);\n}\n.btn[data-v-a2196f8c] {\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.55);\n  color: #e2e8f0;\n  padding: 10px 12px;\n  border-radius: 12px;\n  cursor: pointer;\n}\n.btn[data-v-a2196f8c]:hover {\n  background: rgba(51, 65, 85, 0.75);\n}\n.btn[data-v-a2196f8c]:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.btn-secondary[data-v-a2196f8c] {\n  background: rgba(30, 41, 59, 0.40);\n}\n.btn-danger[data-v-a2196f8c] {\n  border-color: rgba(239, 68, 68, 0.25);\n}\n.btn-danger[data-v-a2196f8c]:hover {\n  background: rgba(127, 29, 29, 0.35);\n  border-color: rgba(239, 68, 68, 0.45);\n}\n.empty[data-v-a2196f8c] {\n  color: rgba(148, 163, 184, 0.95);\n  padding: 2rem 1rem;\n}\n@media (max-width: 900px) {\n.body[data-v-a2196f8c] {\n    grid-template-columns: 1fr;\n}\n.left[data-v-a2196f8c] {\n    border-right: none;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n}\n",""]);const s=i},1184:(e,n,t)=>{"use strict";t.d(n,{useGameStateStore:()=>u});var a=t(810),r=t(2543),o=t(6728),i=t(9574),s=t(6585),l=t(4530),c=t(1267),d=t(960);const u=(0,a.nY)("gameState",{state:()=>({saveMeta:null,onlineState:null,userSettings:null,character:null,attributes:null,location:null,inventory:null,equipment:null,relationships:null,relationshipMatrix:null,worldInfo:null,sectSystem:null,sectMemberInfo:null,memory:null,gameTime:null,narrativeHistory:[],isGameLoaded:!1,eventSystem:{配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]},cultivationTechnique:null,cultivation:null,techniqueSystem:null,skillState:null,effects:[],masteredSkills:null,systemConfig:null,body:null,bodyPartDevelopment:null,timeBasedSaveEnabled:!1,timeBasedSaveInterval:10,lastTimeBasedSave:null,conversationAutoSaveEnabled:!0}),actions:{async loadGame(e,n){console.log(`[GameState] Loading game for character ${e}, slot ${n}`);const{useCharacterStore:a}=await Promise.resolve().then(t.bind(t,8220)),r=a();if(!r.rootState.角色列表[e])return void console.error(`[GameState] Character ${e} not found`);const o=await r.loadSaveData(e,n);o?(this.loadFromSaveData(o),console.log("[GameState] Game loaded successfully")):console.error(`[GameState] No save data found for character ${e}, slot ${n}`)},async saveGame(){if(!this.isGameLoaded)return void console.warn("[GameState] Game not loaded, skipping save.");console.log("[GameState] Saving game state...");const{useCharacterStore:e}=await Promise.resolve().then(t.bind(t,8220)),n=e();await n.saveCurrentGame(),console.log("[GameState] Game saved successfully")},loadFromSaveData(e){const n=(0,l.ru)(e)?e:(0,l.jj)(e).migrated,t=e=>JSON.parse(JSON.stringify(e));this.saveMeta=n?.元数据?t(n.元数据):null,this.onlineState=n?.系统?.联机?t(n.系统.联机):null,this.userSettings=n?.系统?.设置?t(n.系统.设置):null;const a=n?.角色?.身份?t(n.角色.身份):null,r=n?.角色?.属性?t(n.角色.属性):null,i=n?.角色?.位置?t(n.角色.位置):null;i&&"联机"===this.onlineState?.模式&&(delete i.x,delete i.y);const u=n?.角色?.背包?t(n.角色.背包):null,p=n?.角色?.装备?t(n.角色.装备):null,v=n?.社交?.关系?t(n.社交.关系):null,f=function(e,n){const t=(Array.isArray(n)?n:[]).map(e=>"string"==typeof e?e.trim():"").filter(Boolean),a=()=>({version:1,nodes:Array.from(new Set(t)).slice(0,300),edges:[]});if(null==e)return t.length>0?a():null;if("object"!=typeof e||Array.isArray(e))return a();const r=e,o=Array.isArray(r.nodes)?r.nodes.map(e=>"string"==typeof e?e.trim():"").filter(Boolean):[],i=Array.from(new Set([...o,...t])).slice(0,300),s=Array.isArray(r.edges)?r.edges:[],l=new Set,c=[];for(const e of s){if(!e||"object"!=typeof e)continue;const n="string"==typeof e.from?e.from.trim():"",t="string"==typeof e.to?e.to.trim():"";if(!n||!t||n===t)continue;const a=`${n<t?n:t}::${n<t?t:n}`;if(l.has(a))continue;l.add(a);const r="string"==typeof e.relation?e.relation:void 0,o="number"==typeof e.score&&Number.isFinite(e.score)?e.score:void 0,i=Array.isArray(e.tags)?e.tags.filter(e=>"string"==typeof e&&e.trim()).slice(0,12):void 0,s="string"==typeof e.updatedAt?e.updatedAt:void 0;if(c.push({from:n,to:t,relation:r,score:o,tags:i,updatedAt:s}),c.length>=2e3)break}return{version:"number"==typeof r.version&&Number.isFinite(r.version)?r.version:1,nodes:i.length?i:Array.from(new Set(t)).slice(0,300),edges:c}}(n?.社交?.关系矩阵,Object.keys(v||{})),h=n?.世界?.信息?t(n.世界.信息):null,m=n?.社交?.势力?t(n.社交.势力):null;let g=n?.社交?.势力?.成员信息?t(n.社交.势力.成员信息):null;try{if(!g){const e=String(a?.名字||"").trim(),n=h?.势力信息||[],t=(0,d.Z)(e,n,null),r=String(m?.当前势力||t.sectName||"").trim();if(r){const e=n.find(e=>String(e?.名称||"").trim()===r)??null;g={势力名称:r,势力类型:e?.类型||"正道势力",职位:t.position||"外门弟子",贡献:0,关系:"友好",声望:0,加入日期:(new Date).toISOString(),描述:e?.描述||""}}}}catch(e){console.warn("[gameStateStore.loadFromSaveData] 自动补齐 sectMemberInfo 失败（非致命）:",e)}const b=e=>Array.isArray(e)?e.filter(e=>"string"==typeof e&&e.trim().length>0):"string"==typeof e&&e.trim().length>0?[e.trim()]:[],y=n?.社交?.记忆?t(n.社交.记忆):{},x={短期记忆:b(y?.短期记忆),中期记忆:b(y?.中期记忆),长期记忆:b(y?.长期记忆),隐式中期记忆:b(y?.隐式中期记忆)},k=n?.元数据?.时间?t(n.元数据.时间):null,w=Array.isArray(n?.系统?.历史?.叙事)?t(n.系统.历史.叙事):[],_=n?.社交?.事件?t(n.社交.事件):null,C=n?.角色?.技能?t(n.角色.技能):null,A=Array.isArray(n?.角色?.效果)?t(n.角色.效果):[],S=n?.系统?.配置?t(n.系统.配置):null,L=n?.角色?.身体?t(n.角色.身体):null,E=L&&"object"==typeof L&&L.部位开发?t(L.部位开发):null;this.character=a,this.attributes=r,this.location=i,this.inventory=u,(0,c.Fp)(this.inventory),this.equipment=p,this.relationships=v,this.relationshipMatrix=f,this.worldInfo=h,this.sectSystem=m,this.sectMemberInfo=g,this.memory=x,this.gameTime=k,this.narrativeHistory=w,this.eventSystem=_?t(_):{配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]},this.cultivation=null,this.cultivationTechnique=null,this.techniqueSystem=null,this.skillState=C?t(C):null,this.masteredSkills=this.skillState?.掌握技能?t(this.skillState.掌握技能):t(n?.系统?.缓存?.掌握技能??[]),this.effects=Array.isArray(A)?t(A):[],this.systemConfig=S?t(S):null,this.systemConfig&&(this.systemConfig=(0,s.Md)(this.systemConfig)),this.body=L&&"object"==typeof L?t(L):null,this.bodyPartDevelopment=E?t(E):null;try{const e=(0,o.Ew)(n),t=(()=>{const e=n?.角色?.属性?.觉醒阶段;if("string"==typeof e)return e;const t=e&&"object"==typeof e?e.名称:null;if("string"==typeof t&&t.trim())return t;const a=n?.角色?.身份?.觉醒阶段;return"string"==typeof a&&a.trim()?a:"凡人"})(),a=(0,o.Nz)(e,t,{}),r=this.attributes||{},i=(e,n)=>{const t=Number(e??0);return{当前:Number.isFinite(t)?Math.min(Math.max(0,t),n):n,上限:n}},s=Number(a.HP?.上限??a.HP?.当前??0),l=Number(a.SP?.上限??a.SP?.当前??0),c=Number(a.ST?.上限??a.ST?.当前??0),d=Number(a.SAN?.上限??a.SAN?.当前??0);r.生命值=i(r.生命值?.当前,s),r.精神力=i(r.精神力?.当前,l),r.体力=i(r.体力?.当前,c),r.理智值=i(r.理智值?.当前,d),this.attributes=r}catch{}this.relationships&&"object"==typeof this.relationships&&Object.keys(this.relationships).forEach(e=>{const n=this.relationships[e],t=Number(n?.属性?.生命值?.当前??0);Number.isFinite(t)&&t<=0&&(n.当前外貌状态="无生命迹象（死亡）")});try{const{nsfwMode:e,nsfwGenderFilter:n,privacyGenerationMode:t}=(0,s.rW)();if(e&&this.relationships){const e=e=>{if("string"!=typeof e)return"other";const n=e.trim();return n?"男"===n||"male"===n.toLowerCase()||n.includes("男")?"male":"女"===n||"female"===n.toLowerCase()||n.includes("女")?"female":"other":"other"};Object.keys(this.relationships).forEach(a=>{const r=this.relationships[a],o=e(r?.性别);"male"===n&&"male"!==o||"female"===n&&"female"!==o||"ai_only"===t||r.私密信息&&!(0,s.j7)(r.私密信息)||(r.私密信息=(0,s.fR)({名字:r?.名字||a,性别:r?.性别||("female"===o?"女":"male"===o?"男":"其他"),出生日期:r?.出生日期}))})}}catch(e){console.warn("[gameStateStore.loadFromSaveData] 私密信息骨架补齐失败（非致命）:",e)}this.skillState||(this.skillState={掌握技能:this.masteredSkills??[],装备栏:[],冷却:{}}),this.cultivation=null,this.isGameLoaded=!0},toSaveData(){const e=[];this.character||e.push("character"),this.attributes||e.push("attributes"),this.location||e.push("location"),this.inventory||e.push("inventory"),this.relationships||e.push("relationships"),this.memory||e.push("memory"),this.gameTime||e.push("gameTime"),this.equipment||e.push("equipment"),e.length>0&&(console.error("[gameStateStore.toSaveData] 存档数据不完整，缺少以下字段:",e.join(", ")),console.error("[gameStateStore.toSaveData] 联机状态:",this.onlineState),console.error("[gameStateStore.toSaveData] 游戏是否已加载:",this.isGameLoaded));const n=e=>JSON.parse(JSON.stringify(e)),t={...this.skillState||{},掌握技能:this.skillState?.掌握技能??this.masteredSkills??[],装备栏:this.skillState?.装备栏??[],冷却:this.skillState?.冷却??{}},a=(new Date).toISOString(),r={...this.saveMeta||{},版本号:3,存档ID:this.saveMeta?.存档ID??`save_${Date.now()}`,存档名:this.saveMeta?.存档名??"自动存档",游戏版本:this.saveMeta?.游戏版本,创建时间:this.saveMeta?.创建时间??a,更新时间:a,游戏时长秒:Number(this.saveMeta?.游戏时长秒??0),时间:this.gameTime},o=this.sectSystem||this.sectMemberInfo?{...this.sectSystem||{},...this.sectMemberInfo?{成员信息:this.sectMemberInfo}:{}}:null,i=this.userSettings??{timeBasedSaveEnabled:this.timeBasedSaveEnabled,timeBasedSaveInterval:this.timeBasedSaveInterval,conversationAutoSaveEnabled:this.conversationAutoSaveEnabled},s=this.onlineState??{模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"},l=n(this.location);l&&"联机"===s?.模式&&(delete l.x,delete l.y);const c=(()=>{const e=this.body&&"object"==typeof this.body?n(this.body):{};return this.bodyPartDevelopment&&"object"==typeof this.bodyPartDevelopment&&(e.部位开发=n(this.bodyPartDevelopment)),Object.keys(e).length>0?e:void 0})(),d={元数据:r,角色:{身份:this.character??{},属性:this.attributes??{},位置:l,效果:this.effects??[],身体:c,背包:this.inventory??{突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}},装备:this.equipment??{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},修炼:null,技能:t},社交:{关系:this.relationships??{},关系矩阵:this.relationshipMatrix??void 0,势力:o,事件:this.eventSystem,记忆:this.memory??{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}},世界:{信息:this.worldInfo??{},状态:{}},系统:{配置:this.systemConfig??{},设置:i,缓存:{掌握技能:this.masteredSkills??t?.掌握技能??[]},历史:{叙事:this.narrativeHistory||[]},扩展:{},联机:s}};return n(d)},updatePlayerStatus(e){this.attributes&&(this.attributes={...this.attributes,...e})},updateLocation(e){this.location&&(this.location={...this.location,...e})},updateInventory(e){this.inventory&&(this.inventory={...this.inventory,...e})},updateRelationship(e,n){this.relationships&&this.relationships[e]&&(this.relationships[e]={...this.relationships[e],...n})},advanceGameTime(e){if(this.gameTime){if(this.gameTime.分钟+=e,this.gameTime.分钟>=60){const e=Math.floor(this.gameTime.分钟/60);this.gameTime.分钟=this.gameTime.分钟%60,this.gameTime.小时+=e}if(this.gameTime.小时>=24){const e=Math.floor(this.gameTime.小时/24);this.gameTime.小时=this.gameTime.小时%24,this.gameTime.日+=e}if(this.gameTime.日>30){const e=Math.floor((this.gameTime.日-1)/30);this.gameTime.日=(this.gameTime.日-1)%30+1,this.gameTime.月+=e}if(this.gameTime.月>12){const e=Math.floor((this.gameTime.月-1)/12);this.gameTime.月=(this.gameTime.月-1)%12+1,this.gameTime.年+=e}}},resetState(){this.saveMeta=null,this.onlineState=null,this.userSettings=null,this.character=null,this.attributes=null,this.location=null,this.inventory=null,this.equipment=null,this.relationships=null,this.worldInfo=null,this.sectSystem=null,this.sectMemberInfo=null,this.memory=null,this.gameTime=null,this.narrativeHistory=[],this.isGameLoaded=!1,this.eventSystem={配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]},this.cultivationTechnique=null,this.cultivation=null,this.techniqueSystem=null,this.skillState=null,this.effects=[],this.masteredSkills=null,this.systemConfig=null,this.body=null,this.bodyPartDevelopment=null,console.log("[GameState] State has been reset")},async saveAfterConversation(){if(!this.isGameLoaded)return void console.warn("[GameState] Game not loaded, skipping save");console.log("[GameState] Saving after conversation...");const{useCharacterStore:e}=await Promise.resolve().then(t.bind(t,8220)),n=e();await n.saveCurrentGame(),await this.checkAndCreateTimeBasedSave()},async checkAndCreateTimeBasedSave(){if(!this.timeBasedSaveEnabled)return;const e=Date.now(),n=60*this.timeBasedSaveInterval*1e3;if(this.lastTimeBasedSave&&e-this.lastTimeBasedSave<n)return;console.log("[GameState] Updating time-based save slot...");const{useCharacterStore:a}=await Promise.resolve().then(t.bind(t,8220)),r=a();await r.saveToSlot("时间点存档"),this.lastTimeBasedSave=e,console.log("[GameState] Time-based save slot updated: 时间点存档")},async saveBeforeExit(){this.isGameLoaded&&(console.log("[GameState] Saving before exit..."),await this.saveGame())},setTimeBasedSaveInterval(e){e<1?console.warn("[GameState] Invalid interval, must be at least 1 minute"):(this.timeBasedSaveInterval=e,console.log(`[GameState] Time-based save interval set to ${e} minutes`))},setTimeBasedSaveEnabled(e){this.timeBasedSaveEnabled=e,console.log("[GameState] Time-based save "+(e?"enabled":"disabled"))},setConversationAutoSaveEnabled(e){this.conversationAutoSaveEnabled=e,console.log("[GameState] Conversation auto save "+(e?"enabled":"disabled"))},getCurrentSaveData(){return this.toSaveData()},updateState(e,n){console.log(`[诊断-updateState] 开始更新路径: ${e}`),console.log("[诊断-updateState] 要设置的值:",n);const t=e.split("."),a=t[0];if(console.log("[诊断-updateState] rootKey:",a),console.log("[诊断-updateState] 路径部分:",t),1===t.length)return this[a]=n,void console.log("[诊断-updateState] 顶层属性直接设置完成");const s=this[a];if(console.log("[诊断-updateState] 当前rootKey的值:",s),s&&"object"==typeof s){const l=(0,r.cloneDeep)(s);console.log("[诊断-updateState] 深拷贝后的clonedRoot:",l);const c=t.slice(1).join(".");console.log("[诊断-updateState] 嵌套路径:",c),console.log("[诊断-updateState] set前的value类型:",typeof n,"value:",n);const d=e=>{const n="string"==typeof e?.名称?String(e.名称).trim():"string"==typeof e?String(e).trim():"";return n?"未觉醒"===n?"凡人":n:""},u=e=>{if(!e||"object"!=typeof e)return"";const n=e?.觉醒阶段;return d(n)};let p="",v="",f=!1,h=null,m="",g="";if("character"===a)p=u(s);else if("attributes"===a)p=u(s);else if("relationships"===a&&c.endsWith("觉醒阶段")){const e=c.split(".").slice(0,-1).join(".");m=u((0,r.get)(s,e)),h=e}if((0,r.set)(l,c,n),console.log("[诊断-updateState] lodash set后的clonedRoot:",l),console.log("[诊断-updateState] set后检查实际值:",(0,r.get)(l,c)),"character"===a||"attributes"===a?(v=u(l),f=!!v&&v!==p):"relationships"===a&&h&&(g=u((0,r.get)(l,h))),f){const e=(0,i.Ce)(p||"凡人"),n=(0,i.Ce)(v)-e;if(n>0)if("character"===a){const e=l.后天属性||{};["力量","敏捷","体质","意志","魅力","幸运"].forEach(t=>{const a=Number(e[t]??0);e[t]=a+n}),l.后天属性=e}else{const e=this.character||{},t=e.后天属性||{};["力量","敏捷","体质","意志","魅力","幸运"].forEach(e=>{const a=Number(t[e]??0);t[e]=a+n}),e.后天属性=t,this.$patch({character:e})}}if(h&&g&&g!==m){const e=(0,i.Ce)(m||"凡人"),n=(0,i.Ce)(g)-e;if(n>0){const e=(0,r.get)(l,h)||{},t=e.先天属性||{};["力量","敏捷","体质","意志","魅力","幸运"].forEach(e=>{const a=Number(t[e]??5);t[e]=a+n}),e.先天属性=t,(0,r.set)(l,h,e)}}this.$patch({[a]:l}),console.log("[诊断-updateState] 已通过$patch更新root对象"),console.log(`[gameStateStore] ✅ 已更新 ${e} = ${JSON.stringify(n).substring(0,100)}`);try{const e=(()=>{if(v)return v;const e=this.attributes?.觉醒阶段;return d(e)||"凡人"})(),n=this.toSaveData();if(n){const t=(0,o.Ew)(n),a=n?.角色?.装备||{},r=n?.角色?.背包||{物品:{}},i=(0,o.FY)(a,r),s=(0,o.Nz)(t,e,{equipmentDerivedBonuses:i}),l=this.attributes||{},c=(e,n)=>{const t=Number(e??0);return{当前:Number.isFinite(t)?Math.min(Math.max(0,t),n):n,上限:n}},d=Number(s.HP?.上限??s.HP?.当前??0),u=Number(s.SP?.上限??s.SP?.当前??0),p=Number(s.ST?.上限??s.ST?.当前??0),v=Number(s.SAN?.上限??s.SAN?.当前??0);l.生命值=c(l.生命值?.当前,d),l.精神力=c(l.精神力?.当前,u),l.体力=c(l.体力?.当前,p),l.理智值=c(l.理智值?.当前,v),this.attributes=l}}catch{}}else console.log("[诊断-updateState] currentRoot不是对象，直接设置"),(0,r.set)(this,e,n)},addToShortTermMemory(e){this.memory||(this.memory={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(this.memory.短期记忆)||(this.memory.短期记忆=[]),Array.isArray(this.memory.中期记忆)||(this.memory.中期记忆=[]),Array.isArray(this.memory.隐式中期记忆)||(this.memory.隐式中期记忆=[]);const n=this.gameTime,t=n?.分钟??0,a=n?`【纪元${n.年}年${n.月}月${n.日}日 ${String(n.小时).padStart(2,"0")}:${String(t).padStart(2,"0")}】`:"【未知时间】",r=e.startsWith("【纪元")||e.startsWith("【未知时间】")||e.startsWith("【仙历")?e:`${a}${e}`;this.memory.短期记忆.push(r),this.memory.隐式中期记忆.push(r);const o=(()=>{try{const e=localStorage.getItem("memory-settings");if(!e)return 5;const n=JSON.parse(e);return"number"==typeof n.shortTermLimit&&n.shortTermLimit>0?n.shortTermLimit:"number"==typeof n.maxShortTerm&&n.maxShortTerm>0?n.maxShortTerm:5}catch{return 5}})();for(;this.memory.短期记忆.length>o;){this.memory.短期记忆.shift();const e=this.memory.隐式中期记忆.shift();e&&!this.memory.中期记忆.includes(e)&&(this.memory.中期记忆.push(e),console.log("[gameStateStore] ✅ 短期记忆溢出，已转移到中期记忆"))}console.log("[gameStateStore] ✅ 已添加到短期记忆",r.substring(0,50)+"...")}}})},1208:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"/**\n * 仙途 (XianTu) - 主样式表\n * @author 千夜 (qianye60)\n * @license CC BY-NC-SA 4.0\n * GitHub: github.com/qianye60 | Bilibili: space.bilibili.com/477576651\n */\n\n/* --- Design Tokens (The Alchemist's Formula) --- */\n:root {\n  /* --- Light Theme Colors (明亮版) --- */\n  --color-background: #ebe8e1; /* 更柔和的米白色 */\n  --color-background-transparent: rgba(235, 232, 225, 0.92);\n  --color-surface: #f8f6f3; /* 柔和的浅米色，不再是纯白 */\n  --color-surface-transparent: rgba(248, 246, 243, 0.88);\n  --color-surface-light: #e6e3dc; /* 更柔和的浅灰 */\n  /* Derived/interactive states (light) */\n  --color-surface-hover: #f2efe9; /* 悬浮时的柔和色 */\n  --color-primary: #1e4a9a; /* 更深的主色调 */\n  --color-primary-rgb: 30, 74, 154;\n  --color-primary-hover: #163d82;\n  --color-primary-active: #0f2f6a;\n  /* Lighten variant used by some components */\n  --color-primary-light: rgba(30, 74, 154, 0.15);\n  --color-accent: #2e8b57; /* 翠玉绿 - 修仙风格 */\n  --color-accent-hover: #267349;\n  --color-accent-light: rgba(46, 139, 87, 0.18);\n  --color-text: #1a1a1a;\n  --color-text-secondary: #4a4a4a; /* 更深，提高对比度 */\n  --color-text-muted: #5a5a5a; /* 更深，提高对比度 */\n  --color-white-soft: #f1eee7; /* 柔和的白色 */\n  --color-border: rgba(0, 0, 0, 0.12); /* 更柔和的边框 */\n  --color-border-hover: rgba(0, 0, 0, 0.25);\n  --color-success: #2e8b32; /* 更深的绿色，提高可读性 */\n  --color-success-hover: #267529;\n  --color-warning: #e68a00; /* 更深的橙色 */\n  --color-warning-hover: #cc7a00;\n  --color-error: #dc2626; /* 更深的红色 */\n  --color-error-hover: #c22050;\n  --color-info: #2196f3;\n  --color-info-hover: #1e88e5;\n  /* Keep danger alias for components that expect it */\n  --color-danger: var(--color-error);\n  --color-danger-hover: #e53935;\n  /* Generic hover background alias used in components */\n  --color-hover: var(--color-surface-hover);\n  /* Code block background used in data views */\n  --color-code-bg: #0f172a0f; /* subtle deep slate with opacity */\n  /* Global scrollbar tokens (light) – hide track, show only thumb */\n  --scrollbar-track-color: transparent;\n  --scrollbar-thumb-color: rgba(0, 0, 0, 0.28);\n  --scrollbar-thumb-hover-color: rgba(0, 0, 0, 0.4);\n\n  /* Vital colors (light theme) */\n  --vital-health: #ff2929;   /* 生命值/健康（与 --color-error 保持一致） */\n  --vital-lingqi: #3b82f6;   /* 灵气(统一蓝) */\n  --vital-spirit: #ffeb00;   /* 神识(金色) */\n  --vital-lifespan: #c253ff; /* 寿元(紫色) */\n\n  /* Derived RGB triplets for rgba() usage (light) */\n  --color-background-rgb: 235, 232, 225;\n  --color-surface-rgb: 248, 246, 243;\n  --color-accent-rgb: 46, 139, 87;\n  --color-border-rgb: 0, 0, 0;\n  --color-success-rgb: 46, 139, 50;\n  --color-warning-rgb: 230, 138, 0;\n  --color-error-rgb: 220, 38, 38;\n  --color-info-rgb: 33, 150, 243;\n\n  /* UI缩放变量 */\n  --ui-scale: 1;\n  --base-font-size: 1rem;\n  --lang-font-scale: 1;\n\n  /* 字体与过渡 */\n  --font-family-serif: 'SimSun', 'NSimSun', 'STSong', '宋体', 'Noto Serif SC', 'KaiTi', 'STKaiti', serif;\n  --font-family-sans-serif: 'SimSun', 'NSimSun', 'STSong', '宋体', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  --transition-fast: all 0.2s ease-in-out;\n}\n\n/* --- 暗色主题灵脉: \"松烟玄墨\" (通过 data-theme 属性激活) --- */\n:root[data-theme='dark'] {\n  /* --- Dark Theme Colors --- */\n  --color-background: rgb(30, 41, 59);\n  --color-background-transparent: rgba(26, 27, 38, 0.85);\n  --color-surface: #232e40;\n  --color-surface-transparent: rgba(41, 51, 72, 0.6);\n  --color-surface-light: #414868;\n  /* Derived/interactive states (dark) */\n  --color-surface-hover: #33415f;\n  --color-primary: #82a3f5;\n  --color-primary-rgb: 130, 163, 245;\n  --color-primary-hover: #6f93f2;\n  --color-primary-active: #597ee6;\n  --color-primary-light: rgba(130, 163, 245, 0.18);\n  --color-accent: #7dd3a0; /* 翠玉绿 - 暗色主题 */\n  --color-accent-hover: #6bc48e;\n  --color-accent-light: rgba(125, 211, 160, 0.15);\n  --color-text: #f7f7f5; /* 柔和的暖白色，不那么刺眼 */\n  --color-text-secondary: #d0d0d0;\n  --color-text-muted: #b9b9b9; /* 增强对比度 */\n  --color-white-soft: #f7f7f5; /* 暗色主题下的柔和白色 */\n  --color-border: rgba(173, 216, 230, 0.5);\n  --color-border-hover: rgba(173, 216, 230, 0.8);\n  --color-success: #9ece6a;\n  --color-success-hover: #88b85b;\n  --color-warning: #ffd500;\n  --color-warning-hover: #e6c200;\n  --color-error: #ff2f49; /* 暗色下更红一些 */\n  --color-error-hover: #e64470;\n  --color-info: #77cdfe;\n  --color-info-hover: #66bff4;\n  --color-danger: var(--color-error);\n  --color-danger-hover: #e66a81;\n  --color-hover: var(--color-surface-hover);\n  --color-code-bg: rgba(20, 26, 43, 0.6);\n  /* Global scrollbar tokens (dark) – hide track, show only thumb */\n  --scrollbar-track-color: transparent;\n  --scrollbar-thumb-color: rgba(255, 255, 255, 0.35);\n  --scrollbar-thumb-hover-color: rgba(255, 255, 255, 0.5);\n\n  /* Vital colors (dark theme) */\n  --vital-health: #ff2f49;   /* 生命值/健康（暗色，与 --color-error 保持一致） */\n  --vital-lingqi: #3b82f6;   /* 灵气(统一蓝) */\n  --vital-spirit: #ffeb00;   /* 神识(金色) */\n  --vital-lifespan: #c253ff; /* 寿元(紫色) */\n\n  /* Derived RGB triplets for rgba() usage (dark) */\n  --color-background-rgb: 26, 27, 38;\n  --color-surface-rgb: 41, 51, 72;\n  --color-accent-rgb: 125, 211, 160;\n  --color-border-rgb: 173, 216, 230;\n  --color-success-rgb: 158, 206, 106;\n  --color-warning-rgb: 255, 213, 0;\n  --color-error-rgb: 255, 47, 73;\n  --color-info-rgb: 119, 205, 254;\n}\n\nhtml[data-lang='en'] {\n  --lang-font-scale: 0.94;\n}\n\n/* --- Base Styles --- */\nhtml,\nbody {\n  /* 高度将由 App.vue 中的脚本动态设置，此处不应有 height 或 min-height */\n  margin: 0;\n  padding: 0;\n  /* 移除 overflow: hidden; 应用内滚动由 #app 控制 */\n  font-family: var(--font-family-serif);\n  /* 透明背景以显示视频背景（VideoBackground组件使用z-index:-10） */\n  background-color: transparent;\n  color: var(--color-text);\n  /* 遵道友法旨，去除所有文字阴影，返璞归真。 */\n  text-shadow: none;\n  /* 确保在iframe中也能正确填充 */\n  width: 100%;\n  height: 100%;\n}\n\n#app {\n  position: absolute; /* 使用绝对定位强制撑满body */\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 100%;\n  width: 100%;\n  box-sizing: border-box;\n  overflow: auto; /* 应用内的滚动由app自身管理 */\n  /* 应用UI缩放，使用zoom属性（Chrome, Safari等支持） */\n  zoom: var(--ui-scale);\n  /* 应用基础字体大小 */\n  font-size: calc(var(--base-font-size) * var(--lang-font-scale));\n  /* 透明背景以显示视频背景 */\n  background-color: transparent;\n}\n\n#app-container {\n  width: 100%;\n  height: 100%;\n  min-height: 100%;\n  /* 透明背景以显示视频背景 */\n  background-color: transparent;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  overflow-x: hidden;\n  position: relative;\n}\n\n/* English UI overflow guards */\nhtml[data-lang='en'] .panel-tab,\nhtml[data-lang='en'] .filter-tab,\nhtml[data-lang='en'] .tabs-nav button,\nhtml[data-lang='en'] .tab-item,\nhtml[data-lang='en'] .menu-item,\nhtml[data-lang='en'] .nav-item,\nhtml[data-lang='en'] .action-btn,\nhtml[data-lang='en'] .tech-btn,\nhtml[data-lang='en'] .function-btn,\nhtml[data-lang='en'] .btn {\n  min-width: 0;\n}\n\nhtml[data-lang='en'] .panel-tab span,\nhtml[data-lang='en'] .filter-tab span,\nhtml[data-lang='en'] .tabs-nav button span,\nhtml[data-lang='en'] .tab-item span,\nhtml[data-lang='en'] .menu-item span,\nhtml[data-lang='en'] .nav-item span,\nhtml[data-lang='en'] .action-btn span,\nhtml[data-lang='en'] .tech-btn,\nhtml[data-lang='en'] .function-btn span,\nhtml[data-lang='en'] .btn,\nhtml[data-lang='en'] .btn-text,\nhtml[data-lang='en'] .btn-desc,\nhtml[data-lang='en'] .sidebar-title,\nhtml[data-lang='en'] .section-title,\nhtml[data-lang='en'] .panel-title,\nhtml[data-lang='en'] .section-header span,\nhtml[data-lang='en'] .stat-label,\nhtml[data-lang='en'] .stat-value,\nhtml[data-lang='en'] .meta-label,\nhtml[data-lang='en'] .meta-tag,\nhtml[data-lang='en'] .meta-stat,\nhtml[data-lang='en'] .tab-count,\nhtml[data-lang='en'] .badge,\nhtml[data-lang='en'] .tag,\nhtml[data-lang='en'] .title-text,\nhtml[data-lang='en'] .list-item-title {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  max-width: 100%;\n}\n\nhtml[data-lang='en'] .btn-content {\n  min-width: 0;\n}\n\nhtml[data-lang='en'] p,\nhtml[data-lang='en'] .desc,\nhtml[data-lang='en'] .description,\nhtml[data-lang='en'] .subtitle,\nhtml[data-lang='en'] .panel-subtitle,\nhtml[data-lang='en'] .empty-description,\nhtml[data-lang='en'] .technique-desc,\nhtml[data-lang='en'] .skill-desc,\nhtml[data-lang='en'] .mastered-desc {\n  overflow-wrap: anywhere;\n  word-break: break-word;\n}\n\n/* --- Reusable Button Class (The Master's Touch) --- */\n.btn {\n  display: inline-block;\n  padding: 0.75rem 1.5rem;\n  border: 1px solid var(--color-primary);\n  border-radius: 8px;\n  background-color: transparent;\n  color: var(--color-primary);\n  font-family: var(--font-family-serif);\n  font-size: 1rem;\n  font-weight: bold;\n  text-align: center;\n  text-decoration: none;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  user-select: none; /* Prevent text selection on click */\n  position: relative;\n  overflow: hidden;\n}\n\n/* --- Button States (Guaranteed Visual Feedback) --- */\n.btn:hover {\n  background-color: var(--color-primary);\n  color: #fff;\n  box-shadow: 0 0 15px rgba(200, 160, 100, 0.5);\n}\n\n.btn:active {\n  transform: scale(0.98);\n  background-color: var(--color-primary-active);\n  border-color: var(--color-primary-active);\n  box-shadow: none;\n}\n\n.btn:focus-visible {\n  outline: 2px solid var(--color-primary-hover);\n  outline-offset: 2px;\n}\n\n/* --- Disabled Button State --- */\n.btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background-color: transparent;\n  color: var(--color-border);\n  border-color: var(--color-border);\n  box-shadow: none;\n}\n\n/* --- 移除流光特效 --- */\n\n/* --- Button Variants --- */\n.btn.btn-secondary {\n  border-color: var(--color-border);\n  color: var(--color-text);\n}\n\n.btn.btn-secondary:hover {\n  background-color: var(--color-surface);\n  border-color: var(--color-text);\n}\n\n.btn.btn-complete {\n  border-color: var(--color-accent); /* 青玉色 */\n  color: var(--color-accent);\n  animation: pulse-glow 2s ease-in-out infinite;\n}\n\n.btn.btn-complete:hover {\n  background-color: var(--color-accent);\n  color: #fff;\n  box-shadow: 0 0 20px rgba(111, 179, 184, 0.5);\n}\n\n@keyframes pulse-glow {\n  0%,\n  100% {\n    box-shadow: 0 0 10px rgba(111, 179, 184, 0.3);\n  }\n  50% {\n    box-shadow: 0 0 20px rgba(111, 179, 184, 0.6);\n  }\n}\n\n/* --- 全局滚动条美化 (兼容 WebKit & Firefox) --- */\n/* WebKit browsers (Chrome, Safari, Edge) */\n#app::-webkit-scrollbar {\n  width: 10px; /* 稍微加宽以获得更好的点击区域 */\n  height: 10px;\n}\n\n#app::-webkit-scrollbar-track {\n  background: var(--scrollbar-track-color);\n}\n\n#app::-webkit-scrollbar-thumb {\n  background-color: var(--scrollbar-thumb-color);\n  border-radius: 5px;\n  border: 2px solid transparent;\n  background-clip: content-box;\n  transition: background-color 0.3s ease-in-out;\n}\n\n#app::-webkit-scrollbar-thumb:hover {\n  background-color: var(--scrollbar-thumb-hover-color);\n}\n\n/* Firefox */\n#app {\n  scrollbar-width: thin;\n  scrollbar-color: var(--scrollbar-thumb-color) var(--scrollbar-track-color);\n}\n\n/* --- 通用法器样式：卡片/面板 (浮空术) --- */\n.card-panel {\n  background: var(--color-surface);\n  border: 2px solid var(--color-primary); /* 坚固、醒目的主色边框 */\n  border-radius: 12px;\n  box-shadow: none; /* 移除所有阴影 */\n  transition: border-color 0.3s ease;\n}\n\n.card-panel:hover {\n  border-color: var(--color-primary-hover); /* 悬浮时边框颜色变亮 */\n  transform: none; /* 移除悬浮时的位移 */\n}\n\n/* --- 新增样式：天机推演动画 (for Login Button) --- */\n.btn.is-loading .btn-text {\n  opacity: 0; /* Hide original text */\n}\n\n.btn.is-loading::before,\n.btn.is-loading::after {\n  content: '';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 20px;\n  height: 20px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 2px solid var(--color-primary);\n  animation-duration: 1.5s;\n  animation-iteration-count: infinite;\n  animation-timing-function: ease-in-out;\n}\n\n.btn.is-loading::before {\n  border-style: solid solid dashed dashed;\n  animation-name: spin-left;\n}\n\n.btn.is-loading::after {\n  border-style: dashed dashed solid solid;\n  animation-name: spin-right;\n}\n\n@keyframes spin-left {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n@keyframes spin-right {\n  from { transform: rotate(360deg); }\n  to { transform: rotate(0deg); }\n}\n\n/* --- 新增样式：开天辟地 (for MainGame Empty State) --- */\n.genesis-prompt {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  padding: 2rem;\n  text-align: center;\n  background: radial-gradient(ellipse at center, var(--color-surface-light) 0%, var(--color-background) 70%);\n}\n\n.genesis-title {\n  font-family: var(--font-family-serif);\n  font-size: 2.5rem;\n  color: var(--color-primary);\n  margin-bottom: 1rem;\n  text-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n\n.genesis-subtitle {\n  font-size: 1.2rem;\n  color: var(--color-text-secondary);\n  max-width: 500px;\n  margin-bottom: 3rem;\n}\n\n.genesis-cta {\n  padding: 1.2rem 2.5rem;\n  font-size: 1.5rem;\n  border-width: 2px;\n  animation: pulse-glow 2.5s ease-in-out infinite;\n}\n\n/* --- 新增样式：道途选择界面 --- */\n.mode-selection-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  max-height: 800px; /* 限制最大高度适应iframe */\n  overflow-y: auto;\n  color: var(--color-text);\n  display: flex;\n  flex-direction: column;\n  align-items: center; /* 水平居中 */\n  justify-content: center; /* 垂直居中 */\n  padding: 1rem 0; /* 减小内部垂直边距 */\n  box-sizing: border-box; /* 确保 padding 不会导致溢出 */\n  background: transparent; /* 透明背景以显示视频 */\n}\n\n.video-background {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transform: translate(-50%, -50%);\n  z-index: -2;\n}\n\n.video-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5); /* 默认遮罩，暗色主题下可调整 */\n  z-index: -1;\n}\n\n:root[data-theme='dark'] .video-overlay {\n    background-color: rgba(10, 15, 24, 0.4); /* 降低遮罩透明度，让背景更亮 */\n}\n\n.selection-content {\n  position: relative;\n  z-index: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 1.5rem;\n  background: var(--color-surface-light);\n  border-radius: 16px;\n  border: 1px solid var(--color-border);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  width: 90%;\n  max-width: 1000px;\n  max-height: calc(100% - 2rem); /* 确保不超出容器 */\n  overflow-y: auto; /* 允许内容滚动 */\n  /* 移除 margin，由父容器的 padding 控制间距 */\n}\n\n.main-title {\n  font-family: var(--font-family-serif);\n  font-size: 3rem;\n  font-weight: 500;\n  margin-bottom: 2.5rem;\n  letter-spacing: 0.2em;\n  text-shadow: 0 0 15px rgba(var(--color-primary-rgb), 0.4);\n}\n\n.paths-container {\n  display: flex;\n  justify-content: center;\n  gap: 3rem;\n  width: 100%;\n}\n\n.path-card {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 2rem;\n  border-radius: 1rem;\n  border: 2px solid var(--color-primary);\n  background: var(--color-surface);\n  cursor: pointer;\n  transition: all 0.3s ease-in-out;\n  position: relative;\n  overflow: hidden;\n}\n\n.path-card:hover {\n  transform: translateY(-10px);\n  background: rgba(var(--color-primary-rgb), 0.4);\n}\n\n.path-card .path-icon {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    color: var(--color-primary);\n    transition: var(--transition-fast);\n}\n\n.path-card:hover .path-icon {\n    color: var(--color-accent);\n    transform: scale(1.1);\n}\n\n.path-title {\n  font-family: var(--font-family-serif);\n  font-size: 1.75rem;\n  margin-bottom: 0.75rem;\n}\n\n.path-description {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n  max-width: 300px;\n}\n\n.bottom-actions {\n  position: fixed;\n  z-index: 100; /* Ensure it's on top of everything */\n  bottom: 2rem;\n  right: 2rem;\n  display: flex;\n  gap: 1rem;\n}\n\n.action-btn {\n  width: 48px;\n  height: 48px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1.5rem;\n  border: 1px solid var(--color-border);\n  background-color: var(--color-surface);\n  color: var(--color-text-secondary);\n  border-radius: 50%;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  backdrop-filter: blur(5px);\n}\n\n.action-btn:hover {\n  background-color: var(--color-surface-light);\n  color: var(--color-text);\n  border-color: var(--color-border-hover);\n  transform: scale(1.1);\n}\n\n/* --- 通用法器样式：模态对话框/弹窗 (须弥芥子) --- */\n.modal-dialog {\n  background-color: var(--color-surface);\n  color: var(--color-text); /* 显式设置文字颜色，防止继承问题 */\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 1.5rem;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n}\n\n:root[data-theme='dark'] .modal-dialog {\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n}\n\n/* --- 全局操作按钮样式 (新版) --- */\n.global-actions {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  z-index: 1000;\n  display: flex;\n  gap: 12px;\n  pointer-events: auto;\n}\n\n.theme-toggle,\n.fullscreen-toggle {\n  --color: #555560;\n  --size: 24px;\n  width: 48px;\n  height: 48px;\n  border: none;\n  border-radius: 12px;\n  background: rgba(230, 226, 217, 0.92); /* 使用更柔和的背景色 */\n  backdrop-filter: blur(10px);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);\n  color: var(--color);\n  font-size: var(--size);\n  user-select: none;\n  fill: var(--color);\n}\n\n.theme-toggle:hover,\n.fullscreen-toggle:hover {\n  transform: translateY(-2px) scale(1.05);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);\n  background: rgba(220, 216, 207, 0.95); /* 悬浮时稍深 */\n}\n\n.theme-toggle:active,\n.fullscreen-toggle:active {\n  transform: translateY(0);\n}\n\n/* 主题切换图标 */\n.theme-toggle .moon {\n  position: absolute;\n  animation: keyframes-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.theme-toggle .sun {\n  position: absolute;\n  display: none;\n  animation: keyframes-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.theme-toggle input:checked ~ .moon {\n  display: none;\n}\n\n.theme-toggle input:checked ~ .sun {\n  display: block;\n}\n\n/* 全屏切换图标 */\n.fullscreen-toggle .expand {\n  position: absolute;\n  animation: fullscreen-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.fullscreen-toggle .compress {\n  position: absolute;\n  display: none;\n  animation: fullscreen-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.fullscreen-toggle input:checked ~ .expand {\n  display: none;\n}\n\n.fullscreen-toggle input:checked ~ .compress {\n  display: block;\n}\n\n/* 隐藏checkbox */\n.theme-toggle input,\n.fullscreen-toggle input {\n  position: absolute;\n  opacity: 0;\n  cursor: pointer;\n  height: 0;\n  width: 0;\n}\n\n/* 动画效果 */\n@keyframes keyframes-fill {\n  0% {\n    transform: rotate(-360deg) scale(0);\n    opacity: 0;\n  }\n  75% {\n    transform: rotate(25deg);\n  }\n  100% {\n    transform: rotate(0deg) scale(1);\n    opacity: 1;\n  }\n}\n\n@keyframes fullscreen-fill {\n  0% {\n    transform: scale(0);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n/* 暗色主题适配 */\n[data-theme=\"dark\"] .theme-toggle,\n[data-theme=\"dark\"] .fullscreen-toggle {\n  background: rgba(41, 51, 72, 0.9);\n  --color: #82A3F5;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n[data-theme=\"dark\"] .theme-toggle:hover,\n[data-theme=\"dark\"] .fullscreen-toggle:hover {\n  background: rgba(41, 51, 72, 0.95);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);\n}\n\n/* --- App Root & Transitions --- */\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.3s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n\n/* #app-container 样式已在上方定义，此处合并 */\n\n/* --- Author Modal Styles --- */\n.author-modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(5px);\n}\n\n.author-modal {\n  background: var(--color-surface);\n  padding: 1.5rem 2rem;\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n  width: 90%;\n  max-width: 500px;\n  color: var(--color-text);\n}\n\n.author-modal-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid var(--color-border);\n  padding-bottom: 1rem;\n  margin-bottom: 1rem;\n}\n\n.author-modal-header h3 {\n  margin: 0;\n  font-size: 1.4rem;\n  font-family: var(--font-family-serif);\n}\n\n.author-modal-body p {\n  margin: 0.8rem 0;\n  font-size: 1rem;\n  line-height: 1.6;\n}\n\n.author-modal-body a {\n  color: var(--color-primary);\n  text-decoration: none;\n  word-break: break-all;\n}\n\n.author-modal-body a:hover {\n  text-decoration: underline;\n}\n\n.close-btn {\n  background: none;\n  border: none;\n  font-size: 2rem;\n  color: var(--color-text-muted);\n  cursor: pointer;\n  line-height: 1;\n  padding: 0;\n}\n\n.close-btn:hover {\n  color: var(--color-text);\n}\n",""]);const s=i},1211:(e,n,t)=>{"use strict";t.d(n,{N:()=>u});var a=t(810),r=t(953),o=t(641),i=t(7445),s=t(8651),l=t(9333),c=t(7527);function d(e){if(null===e||"object"!=typeof e)return!1;const n=e;return Array.isArray(n.worlds)&&Array.isArray(n.talentTiers)&&Array.isArray(n.origins)&&Array.isArray(n.talents)}const u=(0,a.nY)("characterCreation",()=>{const e=(0,r.KR)("single"),n=(0,r.KR)(!1),a=(0,r.KR)(null),u=(0,r.KR)({worlds:[],talentTiers:[],origins:[],talents:[]}),p=(0,r.KR)({gender:"男",character_name:"无名者",race:"人族",world_id:"",talent_tier_id:"",current_age:16,constitution:0,agility:0,strength:0,luck:0,charm:0,willpower:0,origin_id:null,selected_talent_ids:[]}),v=(0,r.KR)(1),f=(0,r.KR)(!0),h=(0,r.KR)(null),m=(0,r.KR)(!0),g=(0,r.KR)(!1),b=(0,r.KR)("idle"),y=(0,r.KR)(null),x=(0,r.KR)("generate"),k=(0,r.KR)(!0),w=(0,r.KR)({majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0}),_=(0,r.KR)("普通"),C={简单:"【难度模式：简单】\n- 世界对主角较为友善，机缘频繁出现\n- 敌人实力普遍较弱，战斗容易获胜\n- 资源获取容易，修炼进度较快\n- 突破瓶颈的难度降低\n- NPC对主角态度友好，容易获得帮助\n- 判定难度-10，幸运点+5",普通:"【难度模式：普通】\n- 世界遵循正常修仙规则，机缘与危险并存\n- 敌人实力与主角相当，战斗需要策略\n- 资源获取需要努力，修炼进度正常\n- 突破瓶颈需要积累和机缘\n- NPC态度中立，需要建立关系\n- 判定难度正常，无额外修正",困难:"【难度模式：困难】天道对主角格外严苛！\n- 世界充满危险，机缘稀少且竞争激烈\n- 敌人实力普遍较强，战斗需要谨慎\n- 资源稀缺，修炼进度缓慢\n- 突破瓶颈困难重重，需要特殊机缘\n- NPC对主角态度冷淡，需要付出代价获得帮助\n【困难模式惩罚】\n- 所有判定难度+10\n- 幸运点上限-5\n- 大失败阈值扩大：<难度-10即为大失败\n- 失败必有代价，不可轻描淡写\n- 敌人觉醒阶段普遍比主角高半级到一级",噩梦:"【难度模式：噩梦】天道要看这只蝼蚁如何挣扎！\n- 世界极度危险，处处是陷阱和敌人\n- 敌人实力远超主角，战斗九死一生\n- 资源极度稀缺，修炼举步维艰\n- 突破瓶颈几乎不可能，需要逆天机缘\n- NPC对主角充满敌意，信任难以建立\n- 死亡风险极高，每一步都需谨慎\n【噩梦模式惩罚】\n- 所有判定难度+20\n- 幸运点上限-10，下限-15\n- 大失败阈值扩大：<难度-5即为大失败\n- 大失败惩罚翻倍（重伤变濒死，损失翻倍）\n- 失败也有严重代价\n- 敌人觉醒阶段普遍比主角高一到两级\n- 开局自带负面状态：【天道试炼】（所有判定-5，持续整个游戏）\n- 机缘出现概率减半，陷阱出现概率翻倍"},A=(0,o.EW)(()=>C[_.value]);try{const e=i.aiService.getConfig();m.value=!1!==e.streaming,x.value="generateRaw"===e.initMode?"generateRaw":"generate"}catch{}try{const e=localStorage.getItem("dad_creation_useStreamingStart");null!==e&&(m.value="false"!==e);const n=localStorage.getItem("dad_creation_generateMode");"generate"!==n&&"generateRaw"!==n||(x.value=n)}catch{}try{const e=localStorage.getItem("dad_start_config");e&&(e=>{if(!e||"object"!=typeof e)return;const n=e,t=n.ai&&"object"==typeof n.ai?n.ai:n,a=t.streaming??t.useStreamingStart;"boolean"==typeof a&&(m.value=a);const r=t.initMode??t.generateMode;"generate"!==r&&"generateRaw"!==r||(x.value=r);const o=n.world&&"object"==typeof n.world?n.world:n.worldGenerationConfig&&"object"==typeof n.worldGenerationConfig?n.worldGenerationConfig:null,i=(e,n,t)=>{const a=Number(e);if(!Number.isFinite(a))return null;const r=Math.floor(a);return Math.min(t,Math.max(n,r))};if(o){const e={...w.value},n=i(o.majorFactionsCount,1,30),t=i(o.totalLocations,1,60),a=i(o.secretRealmsCount,0,30),r=i(o.continentCount,1,12);null!==n&&(e.majorFactionsCount=n),null!==t&&(e.totalLocations=t),null!==a&&(e.secretRealmsCount=a),null!==r&&(e.continentCount=r),w.value=e}const s=n.character&&"object"==typeof n.character?n.character:null;if(s){const e={...p.value},n="string"==typeof s.character_name?s.character_name.trim():null,t="string"==typeof s.gender?s.gender.trim():null,a="string"==typeof s.race?s.race.trim():null,r=i(s.current_age,1,3e3);n&&(e.character_name=n),t&&(e.gender=t),a&&(e.race=a),null!==r&&(e.current_age=r),p.value=e}})(JSON.parse(e))}catch{}(0,o.wB)(m,e=>{try{localStorage.setItem("dad_creation_useStreamingStart",String(e))}catch{}}),(0,o.wB)(x,e=>{try{localStorage.setItem("dad_creation_generateMode",e)}catch{}});const S=(0,o.EW)(()=>6),L=(0,o.EW)(()=>({strength:p.value.strength,agility:p.value.agility,constitution:p.value.constitution,willpower:p.value.willpower,charm:p.value.charm,luck:p.value.luck})),E=(0,o.EW)(()=>u.value.worlds.find(e=>e.id===p.value.world_id)||null),T=(0,o.EW)(()=>u.value.talentTiers.find(e=>e.id===p.value.talent_tier_id)||null),I=(0,o.EW)(()=>u.value.origins.find(e=>e.id===p.value.origin_id)||null),R=(0,o.EW)(()=>u.value.talents.filter(e=>p.value.selected_talent_ids.includes(e.id))),M=(0,o.EW)(()=>{let e=0;return R.value.some(e=>"霸王血脉"===e.name)&&(e+=1,console.log('[点数计算] 检测到 "霸王血脉" 天赋, 增加 1 点数')),e}),P=(0,o.EW)(()=>{if(!T.value)return 0;let e=T.value.total_points;console.log("[点数计算] 初始点数:",e),e+=M.value,I.value&&(console.log("[点数计算] 出身消耗:",I.value.talent_cost),e-=I.value.talent_cost);const n=R.value.reduce((e,n)=>e+n.talent_cost,0);console.log("[点数计算] 已选天赋数量:",R.value.length),console.log("[点数计算] 已选天赋列表:",R.value.map(e=>({名称:e.name,消耗:e.talent_cost}))),console.log("[点数计算] 天赋总消耗:",n),e-=n;const t=Object.values(L.value).reduce((e,n)=>e+n,0);return console.log("[点数计算] 六维属性总和:",t),e-=t,console.log("[点数计算] 最终剩余:",e),e}),D=(0,o.EW)(()=>{if(!T.value)return 0;const e=T.value.total_points-P.value;return Math.max(0,e)});async function z(){const e={worlds:u.value.worlds.filter(e=>"cloud"===e.source),talentTiers:u.value.talentTiers.filter(e=>"cloud"===e.source),origins:u.value.origins.filter(e=>"cloud"===e.source),talents:u.value.talents.filter(e=>"cloud"===e.source)},{saveData:n}=await Promise.resolve().then(t.bind(t,5099));await n("customCreationData",e),console.log("【创世神殿】自定义创世数据已保存到数据库！")}function N(e){u.value.worlds.unshift({...e,source:"cloud"}),z()}function $(e){u.value.talentTiers.unshift({...e,source:"cloud"}),z()}function O(e){u.value.origins.unshift({...e,source:"cloud"}),z()}function F(e){u.value.talents.unshift({...e,source:"cloud"}),z()}async function j(e,n){const a=u.value[e].findIndex(e=>e.id===n);if(a>-1){const r=u.value[e][a];if(u.value[e].splice(a,1),console.log(`【创世神殿】已删除 ${e} 项目，ID: ${n}，来源: ${r.source}`),await z(),"cloud"===r.source){console.log("【创世神殿】删除云端数据，强制同步酒馆全局变量");try{const a=(0,s.getTavernHelper)();if(a){console.log("【创世神殿】方案1：完全重置 DAD_creationData");const r={worlds:u.value.worlds.filter(e=>"cloud"===e.source),talentTiers:u.value.talentTiers.filter(e=>"cloud"===e.source),origins:u.value.origins.filter(e=>"cloud"===e.source),talents:u.value.talents.filter(e=>"cloud"===e.source)};console.log("【创世神殿】准备保存的新数据:",JSON.stringify(r,null,2));try{await a.deleteVariable("DAD_creationData",{type:"global"}),console.log("【创世神殿】已删除旧的 DAD_creationData")}catch(e){console.warn("【创世神殿】删除旧变量失败（可能不存在）:",e)}const{deepCleanForClone:o}=await Promise.resolve().then(t.bind(t,3098)),i=o({DAD_creationData:r});await a.insertOrAssignVariables(i,{type:"global"}),console.log("【创世神殿】已重新创建 DAD_creationData");const s=(await a.getVariables({type:"global"})).DAD_creationData;if(console.log("【创世神殿】验证：更新后的 DAD_creationData:",JSON.stringify(s,null,2)),s&&d(s)){const t=s[e].filter(e=>e.id===n);0===t.length?console.log(`【创世神殿】✅ 验证成功：${e} 项目 ID: ${n} 已从酒馆全局变量中删除`):(console.error(`【创世神殿】❌ 验证失败：${e} 项目 ID: ${n} 仍在酒馆全局变量中`),console.error("【创世神殿】剩余项目:",t))}else console.error("【创世神殿】❌ 验证失败：DAD_creationData 格式无效")}else console.error("【创世神殿】❌ 酒馆助手不可用")}catch(e){console.error("【创世神殿】❌ 同步酒馆全局变量失败:",e)}}}else console.warn(`【创世神殿】删除失败：未找到 ${e} 项目，ID: ${n}`)}function B(e,n,t){const a=u.value[e].findIndex(e=>e.id===n);if(a>-1){const r=u.value[e][a];return u.value[e][a]={...r,...t},console.log(`【创世神殿】已更新 ${e} 项目，ID: ${n}`),z(),!0}return!1}async function X(){const e=await async function(){let e="无名者";try{e=await(0,s.getCurrentCharacterName)()||"无名者"}catch(n){console.warn("获取用户名字失败:",n),e="无名者"}return{gender:"男",character_name:e,race:"人族",world_id:"",talent_tier_id:"",current_age:16,constitution:0,agility:0,strength:0,luck:0,charm:0,willpower:0,origin_id:null,selected_talent_ids:[]}}();p.value=e,v.value=1,w.value={majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0}}return{mode:e,isLoading:n,error:a,creationData:u,characterPayload:p,currentStep:v,isLocalCreation:f,initialGameMessage:h,worldGenerationConfig:w,useStreamingStart:m,generateMode:x,splitResponseGeneration:k,isCreating:g,creationPhase:b,creationError:y,gameDifficulty:_,currentDifficultyPrompt:A,totalSteps:S,attributes:L,selectedWorld:E,selectedTalentTier:T,selectedOrigin:I,selectedTalents:R,remainingTalentPoints:P,totalTalentCost:D,bonusTalentPoints:M,initializeStore:async function(r){n.value=!0,a.value=null,e.value=r,f.value="single"===r;try{const e=await(0,s.getCurrentCharacterName)();p.value.character_name=e||"无名者",console.log("【创世神殿】已获取用户道号:",p.value.character_name)}catch(e){console.warn("【创世神殿】获取用户道号失败，使用默认名",e),p.value.character_name="无名者"}try{if("single"===r){console.log("【创世神殿】初始化单机模式，加载本地数据和自定义数据！");const e=c.eQ.map(e=>({...e,source:"local"})),n=c.VQ.map(e=>({...e,source:"local"})),a=c.yM.map(e=>({...e,source:"local"})),r=c.qS.map(e=>({...e,source:"local"}));let o={worlds:[],talentTiers:[],origins:[],talents:[]};try{const{loadFromIndexedDB:e}=await Promise.resolve().then(t.bind(t,5099)),n=await e("customCreationData");n&&d(n)&&(o=n,console.log("【创世神殿】成功加载自定义数据:",{worlds:o.worlds.length,talentTiers:o.talentTiers.length,origins:o.origins.length,talents:o.talents.length}))}catch(e){console.warn("【创世神殿】加载自定义数据失败，仅使用本地数据:",e)}const i=o.worlds.map(e=>({...e,source:"cloud"})),s=o.talentTiers.map(e=>({...e,source:"cloud"})),l=o.origins.map(e=>({...e,source:"cloud"})),p=o.talents.map(e=>({...e,source:"cloud"})),v=(e,n)=>{const t=new Map;return e.forEach(e=>t.set(e.id,e)),n.forEach(e=>t.set(e.id,e)),Array.from(t.values())};u.value.worlds=v(e,i),u.value.talentTiers=v(n,s),u.value.origins=v(a,l),u.value.talents=v(r,p)}else{console.log("【创世神殿】初始化联机模式，从后端获取云端数据！");const{isBackendConfigured:e}=await Promise.resolve().then(t.bind(t,8546)),{verifyStoredToken:n}=await Promise.resolve().then(t.bind(t,9333));if(e())if(await n())try{console.log("【创世神殿】后端已配置且 token 有效，开始请求云端数据...");const[e,n,t,a]=await Promise.all([(0,l.w2)(),(0,l.yZ)(),(0,l.Uy)(),(0,l.Qc)()]);console.log("【创世神殿】成功获取云端数据:",{worlds:e.length,talentTiers:n.length,origins:t.length,talents:a.length}),u.value.worlds=e.map(e=>({...e,source:"cloud"})),u.value.talentTiers=n.map(e=>({...e,source:"cloud"})),u.value.origins=t.map(e=>({...e,source:"cloud"})),u.value.talents=a.map(e=>({...e,source:"cloud"}))}catch(e){console.error("【创世神殿】获取云端数据失败，回退到本地数据:",e),u.value.worlds=c.eQ.map(e=>({...e,source:"local"})),u.value.talentTiers=c.VQ.map(e=>({...e,source:"local"})),u.value.origins=c.yM.map(e=>({...e,source:"local"})),u.value.talents=c.qS.map(e=>({...e,source:"local"}))}else console.warn("【创世神殿】联机模式 token 无效，回退到本地数据"),u.value.worlds=c.eQ.map(e=>({...e,source:"local"})),u.value.talentTiers=c.VQ.map(e=>({...e,source:"local"})),u.value.origins=c.yM.map(e=>({...e,source:"local"})),u.value.talents=c.qS.map(e=>({...e,source:"local"})),a.value="联机模式需要先登录";else console.warn("【创世神殿】后端未配置，使用本地数据！"),u.value.worlds=c.eQ.map(e=>({...e,source:"local"})),u.value.talentTiers=c.VQ.map(e=>({...e,source:"local"})),u.value.origins=c.yM.map(e=>({...e,source:"local"})),u.value.talents=c.qS.map(e=>({...e,source:"local"}))}}catch(e){console.error("加载数据失败:",e),a.value="加载数据失败",u.value.talentTiers=c.VQ.map(e=>({...e,source:"local"})),u.value.origins=c.yM.map(e=>({...e,source:"local"})),u.value.talents=c.qS.map(e=>({...e,source:"local"}))}finally{n.value=!1}},fetchCloudWorlds:async function(){console.log("【创世神殿】正在从云端获取世界列表..."),n.value=!0,a.value=null;try{const e=await(0,l.w2)();console.log("【创世神殿】成功获取云端世界数据",e);const n=e.map(e=>({...e,source:"cloud"})),t=(c.eQ.map(e=>({...e,source:"local"})),new Map);n.forEach(e=>t.set(e.id,e)),u.value.worlds=Array.from(t.values()),console.log("【创世神殿】世界列表已更新:",u.value.worlds.length,"个世界"),console.log("【创世神殿】云端世界",u.value.worlds.filter(e=>"cloud"===e.source))}catch(e){console.error("【创世神殿】从云端获取世界列表失败:",e),a.value=`获取云端世界列表失败: ${e instanceof Error?e.message:"未知错误"}`;const n=c.eQ.map(e=>({...e,source:"local"}));u.value.worlds=n,console.warn("【创世神殿】云端数据获取失败，已提供本地备选数据")}finally{n.value=!1}},fetchAllCloudData:async function(){console.log("【创世神殿】正在从云端获取完整创世数据..."),n.value=!0,a.value=null;try{const[e,n,t,a]=await Promise.all([(0,l.w2)(),(0,l.yZ)(),(0,l.Uy)(),(0,l.Qc)()]);console.log("【创世神殿】成功获取所有云端数据"),console.log("- 世界:",e.length,"个"),console.log("- 天资等级:",n.length,"个"),console.log("- 出身:",t.length,"个"),console.log("- 天赋:",a.length,"个");const r={worlds:u.value.worlds.length,talentTiers:u.value.talentTiers.length,origins:u.value.origins.length,talents:u.value.talents.length},o=(e,n)=>(e||[]).filter(Boolean).map(e=>({...n,...e,source:"cloud"})),i=o(e,{id:0,name:"",era:"",description:""}),s=o(n,{id:0,name:"未知天资",description:"",total_points:20,rarity:1,color:"#FFFFFF"}),c=o(t,{id:0,name:"",description:"",talent_cost:0,attribute_modifiers:{},rarity:0}),d=o(a,{id:0,name:"",description:"",talent_cost:0,rarity:0}),p=u.value.worlds,v=u.value.talentTiers,f=u.value.origins,h=u.value.talents,m=(e,n)=>{const t=[],a=new Set(e.map(e=>e.name));let r=Math.max(...e.map(e=>e.id),0);return n.forEach(e=>{if(!a.has(e.name)){r++;const n={...e,id:r};t.push(n),a.add(n.name)}}),t},g=(e,n)=>{n.length>0&&e.push(...n)};g(u.value.worlds,m(p,i)),g(u.value.talentTiers,m(v,s)),g(u.value.origins,m(f,c)),g(u.value.talents,m(h,d)),console.log("【创世神殿】所有云端数据合并完成"),console.log("【创世神殿】最终数据验证"),console.log("- 世界 (云端):",u.value.worlds.filter(e=>"cloud"===e.source).length),console.log("- 天资 (云端):",u.value.talentTiers.filter(e=>"cloud"===e.source).length),console.log("- 出身 (云端):",u.value.origins.filter(e=>"cloud"===e.source).length),console.log("- 天赋 (云端):",u.value.talents.filter(e=>"cloud"===e.source).length),console.log("【创世神殿】天资数据示例",u.value.talentTiers.slice(0,3).map(e=>({name:e.name,source:e.source})));const b={worlds:u.value.worlds.length,talentTiers:u.value.talentTiers.length,origins:u.value.origins.length,talents:u.value.talents.length},y=b.worlds-r.worlds+(b.talentTiers-r.talentTiers)+(b.origins-r.origins)+(b.talents-r.talents);return console.log(`【创世神殿】同步完成，新增 ${y} 项数据。`),y}catch(e){console.error("【创世神殿】获取云端创世数据失败",e),a.value=`获取云端创世数据失败: ${e instanceof Error?e.message:"未知错误"}`;const n=c.eQ.map(e=>({...e,source:"local"})),t=c.VQ.map(e=>({...e,source:"local"})),r=c.yM.map(e=>({...e,source:"local"})),o=c.qS.map(e=>({...e,source:"local"}));return u.value.worlds=n,u.value.talentTiers=t,u.value.origins=r,u.value.talents=o,console.warn("【创世神殿】云端数据获取失败，已提供本地备选数据"),0}finally{n.value=!1}},addWorld:N,addTalentTier:$,addOrigin:O,addTalent:F,addGeneratedData:function(e,n){switch(e){case"world":N(n);break;case"talent_tier":$(n);break;case"origin":O(n);break;case"talent":F(n);break;default:console.warn(`Unknown data type for addGeneratedData: ${e}`)}},removeWorld:async e=>await j("worlds",e),removeTalentTier:async e=>await j("talentTiers",e),removeOrigin:async e=>await j("origins",e),removeTalent:async e=>await j("talents",e),updateWorld:(e,n)=>B("worlds",e,n),updateTalentTier:(e,n)=>B("talentTiers",e,n),updateOrigin:(e,n)=>B("origins",e,n),updateTalent:(e,n)=>B("talents",e,n),getItemById:(e,n)=>u.value[e].find(e=>e.id===n)||null,selectWorld:function(e){p.value.world_id=e},selectTalentTier:function(e){p.value.talent_tier_id=e,p.value.origin_id=null,p.value.selected_talent_ids=[],p.value.constitution=0,p.value.agility=0,p.value.strength=0,p.value.luck=0,p.value.charm=0,p.value.willpower=0},selectOrigin:function(e){p.value.origin_id=e},toggleTalent:function(e){const n=p.value.selected_talent_ids.indexOf(e);n>-1?p.value.selected_talent_ids.splice(n,1):p.value.selected_talent_ids.push(e)},setAttribute:function(e,n){e in p.value&&(p.value[e]=n)},resetCharacter:X,nextStep:function(){v.value<6&&v.value++},prevStep:function(){v.value>1&&v.value--},goToStep:function(e){e>=1&&e<=6&&(v.value=e)},setMode:function(n){e.value=n,f.value="single"===n},toggleLocalCreation:function(){f.value=!f.value},setInitialGameMessage:function(e){h.value=e},setWorldGenerationConfig:function(e){w.value={...w.value,...e}},resetOnExit:async function(){await X(),e.value="single",f.value=!0},startLocalCreation:async function(){await X(),f.value=!0,e.value="single"},startCloudCreation:async function(){await X(),f.value=!1,e.value="cloud"},persistCustomData:z,setAIGeneratedOrigin:function(e){if(!e||"object"!=typeof e||!e.name)return;let n=u.value.origins.find(n=>n.name===e.name);if(!n){const t=Math.max(...u.value.origins.map(e=>e.id),0)+1;O({...e,id:t}),n=u.value.origins.find(n=>n.name===e.name),console.log(`[创世神殿] AI生成了新的出身 "${e.name}" 并已添加到列表中 (ID: ${t})`)}n&&(p.value.origin_id=n.id,console.log(`[创世神殿] 已将玩家选择的出身更新为AI生成的结果: "${n.name}"`))},startCreation:function(){g.value=!0,b.value="preparing",y.value=null,console.log("[创世神殿] 开始创建角色流程")},setCreationPhase:function(e){b.value=e,console.log(`[创世神殿] 创建阶段更新: ${e}`)},completeCreation:function(){g.value=!1,b.value="completed",y.value=null,console.log("[创世神殿] 角色创建完成")},failCreation:function(e){g.value=!1,b.value="failed",y.value=e,console.log(`[创世神殿] 角色创建失败: ${e}`)},resetCreationState:function(){g.value=!1,b.value="idle",y.value=null,console.log("[创世神殿] 重置创建状态")}}})},1224:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.data-clear-container[data-v-0a6d9200] {\n  display: flex;\n  align-items: center;\n}\n.clear-buttons[data-v-0a6d9200] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.clear-button[data-v-0a6d9200] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.clear-button[data-v-0a6d9200]:hover:not(:disabled) {\n  background: rgba(var(--color-danger-rgb), 0.1);\n  border-color: var(--color-danger);\n  color: var(--color-danger);\n}\n.clear-button[data-v-0a6d9200]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.clear-icon[data-v-0a6d9200] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n.clear-text[data-v-0a6d9200] {\n  font-weight: 500;\n}\n\n/* 不同类型按钮的特定样式 */\n.clear-button.extra[data-v-0a6d9200]:hover:not(:disabled) {\n  background: rgba(255, 165, 0, 0.2);\n  border-color: orange;\n  color: orange;\n}\n.clear-button.sync[data-v-0a6d9200]:hover:not(:disabled) {\n  background: rgba(135, 206, 235, 0.2);\n  border-color: skyblue;\n  color: skyblue;\n}\n",""]);const s=i},1237:e=>{"use strict";e.exports=EvalError},1267:(e,n,t)=>{"use strict";t.d(n,{A6:()=>d,Ef:()=>r,Fp:()=>p,dE:()=>u,ms:()=>a});const a="突变结晶_下级",r={突变结晶_下级:{币种:"突变结晶_下级",名称:"下级突变结晶",价值:1,描述:"幸存者通用货币（基准单位），E-D级生物稀有掉落",图标:"Gem"},突变结晶_中级:{币种:"突变结晶_中级",名称:"中级突变结晶",价值:20,描述:"约等于 20 下级突变结晶，D-C级生物掉落",图标:"Gem"},突变结晶_上级:{币种:"突变结晶_上级",名称:"上级突变结晶",价值:500,描述:"约等于 25 中级突变结晶，C-B级生物掉落",图标:"Gem"},突变结晶_顶级:{币种:"突变结晶_顶级",名称:"顶级突变结晶",价值:2e4,描述:"约等于 40 上级突变结晶，B级以上生物掉落",图标:"Gem"}};function o(e,n,t,a){if("number"==typeof e&&Number.isFinite(e))return Math.max(n,Math.min(t,e));if("string"==typeof e){const a=Number(e.trim());if(Number.isFinite(a))return Math.max(n,Math.min(t,a))}return a}function i(e){return"string"==typeof e?e.trim():""}function s(e){const n=e?.货币设置;return!n||"object"!=typeof n||Array.isArray(n)?(e.货币设置={禁用币种:[],基准币种:a},e.货币设置):(Array.isArray(n.禁用币种)||(n.禁用币种=[]),n.禁用币种=n.禁用币种.filter(e=>"string"==typeof e&&e.trim()),"string"==typeof n.基准币种&&n.基准币种.trim()||(n.基准币种=a),n)}function l(e){const n=e?.货币;return!n||"object"!=typeof n||Array.isArray(n)?(e.货币={},e.货币):n}function c(e,n){const t=i(e);return t?!n||"object"!=typeof n||Array.isArray(n)?null:{币种:i(n.币种)||t,名称:i(n.名称)||t,数量:o(n.数量,0,9e15,0),价值:o(n.价值,0,9e15,0),描述:i(n.描述)||void 0,图标:i(n.图标)||void 0}:null}function d(e){if(!e||"object"!=typeof e)return;const n=e.货币;if(!n||"object"!=typeof n||Array.isArray(n))return;const t=o(n["突变结晶_下级"]?.数量,0,9e15,0),a=o(n["突变结晶_中级"]?.数量,0,9e15,0),r=o(n["突变结晶_上级"]?.数量,0,9e15,0),i=o(n["突变结晶_顶级"]?.数量,0,9e15,0);e.突变结晶&&"object"==typeof e.突变结晶&&!Array.isArray(e.突变结晶)||(e.突变结晶={下级:0,中级:0,上级:0,顶级:0}),e.突变结晶.下级=t,e.突变结晶.中级=a,e.突变结晶.上级=r,e.突变结晶.顶级=i}function u(e){if(!e||"object"!=typeof e)return;s(e),l(e),function(e){if(!e||"object"!=typeof e)return;s(e);const n=l(e),t=e.突变结晶,a=t&&"object"==typeof t&&!Array.isArray(t),i=a?o(t.下级,0,9e15,0):0,c=a?o(t.中级,0,9e15,0):0,d=a?o(t.上级,0,9e15,0):0,u=a?o(t.顶级,0,9e15,0):0,p=i+c+d+u,v=o(n["突变结晶_下级"]?.数量,0,9e15,0),f=o(n["突变结晶_中级"]?.数量,0,9e15,0),h=o(n["突变结晶_上级"]?.数量,0,9e15,0),m=o(n["突变结晶_顶级"]?.数量,0,9e15,0);a&&p>0&&(!("突变结晶_下级"in n||"突变结晶_中级"in n||"突变结晶_上级"in n||"突变结晶_顶级"in n)||0===v+f+h+m)&&(n["突变结晶_下级"]={...r.突变结晶_下级,...n["突变结晶_下级"],数量:i},n["突变结晶_中级"]={...r.突变结晶_中级,...n["突变结晶_中级"],数量:c},n["突变结晶_上级"]={...r.突变结晶_上级,...n["突变结晶_上级"],数量:d},n["突变结晶_顶级"]={...r.突变结晶_顶级,...n["突变结晶_顶级"],数量:u})}(e);const n=e.货币,t={};for(const[e,a]of Object.entries(n)){const n=c(e,a);n&&(t[e]=n)}e.货币=t,function(e){const n=s(e),t=l(e),a=new Set(n.禁用币种);for(const[e,n]of Object.entries(r)){const r=t[e];if(null==r||"object"!=typeof r){if(a.has(e))continue;t[e]={...n,数量:0}}else{const a=c(e,r);t[e]=a?{...n,...a,数量:a.数量}:{...n,数量:0},t[e].价值<=0&&(t[e].价值=n.价值),t[e].名称||(t[e].名称=n.名称),t[e].图标||(t[e].图标=n.图标)}}}(e),d(e)}function p(e){e&&"object"==typeof e&&u(e)}},1270:function(e,n,t){var a;e=t.nmd(e),function(){n&&n.nodeType,e&&e.nodeType;var r="object"==typeof t.g&&t.g;r.global!==r&&r.window!==r&&r.self;var o,i=2147483647,s=36,l=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,v=String.fromCharCode;function f(e){throw new RangeError(u[e])}function h(e,n){for(var t=e.length,a=[];t--;)a[t]=n(e[t]);return a}function m(e,n){var t=e.split("@"),a="";return t.length>1&&(a=t[0]+"@",e=t[1]),a+h((e=e.replace(d,".")).split("."),n).join(".")}function g(e){for(var n,t,a=[],r=0,o=e.length;r<o;)(n=e.charCodeAt(r++))>=55296&&n<=56319&&r<o?56320==(64512&(t=e.charCodeAt(r++)))?a.push(((1023&n)<<10)+(1023&t)+65536):(a.push(n),r--):a.push(n);return a}function b(e){return h(e,function(e){var n="";return e>65535&&(n+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),n+v(e)}).join("")}function y(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:s}function x(e,n){return e+22+75*(e<26)-((0!=n)<<5)}function k(e,n,t){var a=0;for(e=t?p(e/700):e>>1,e+=p(e/n);e>455;a+=s)e=p(e/35);return p(a+36*e/(e+38))}function w(e){var n,t,a,r,o,l,c,d,u,v,h=[],m=e.length,g=0,x=128,w=72;for((t=e.lastIndexOf("-"))<0&&(t=0),a=0;a<t;++a)e.charCodeAt(a)>=128&&f("not-basic"),h.push(e.charCodeAt(a));for(r=t>0?t+1:0;r<m;){for(o=g,l=1,c=s;r>=m&&f("invalid-input"),((d=y(e.charCodeAt(r++)))>=s||d>p((i-g)/l))&&f("overflow"),g+=d*l,!(d<(u=c<=w?1:c>=w+26?26:c-w));c+=s)l>p(i/(v=s-u))&&f("overflow"),l*=v;w=k(g-o,n=h.length+1,0==o),p(g/n)>i-x&&f("overflow"),x+=p(g/n),g%=n,h.splice(g++,0,x)}return b(h)}function _(e){var n,t,a,r,o,l,c,d,u,h,m,b,y,w,_,C=[];for(b=(e=g(e)).length,n=128,t=0,o=72,l=0;l<b;++l)(m=e[l])<128&&C.push(v(m));for(a=r=C.length,r&&C.push("-");a<b;){for(c=i,l=0;l<b;++l)(m=e[l])>=n&&m<c&&(c=m);for(c-n>p((i-t)/(y=a+1))&&f("overflow"),t+=(c-n)*y,n=c,l=0;l<b;++l)if((m=e[l])<n&&++t>i&&f("overflow"),m==n){for(d=t,u=s;!(d<(h=u<=o?1:u>=o+26?26:u-o));u+=s)_=d-h,w=s-h,C.push(v(x(h+_%w,0))),d=p(_/w);C.push(v(x(d,0))),o=k(t,y,a==r),t=0,++a}++t,++n}return C.join("")}o={version:"1.4.1",ucs2:{decode:g,encode:b},decode:w,encode:_,toASCII:function(e){return m(e,function(e){return c.test(e)?"xn--"+_(e):e})},toUnicode:function(e){return m(e,function(e){return l.test(e)?w(e.slice(4).toLowerCase()):e})}},void 0===(a=function(){return o}.call(n,t,n,e))||(e.exports=a)}()},1300:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.modal-overlay[data-v-e7c874a6] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(8px);\n  animation: fadeIn-e7c874a6 0.2s ease-out;\n}\n.modal-dialog[data-v-e7c874a6] {\n  width: 90%;\n  max-width: 600px;\n  max-height: 80vh;\n  overflow-y: auto;\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n  border: 2px solid rgba(139, 92, 246, 0.3);\n  border-radius: 16px;\n  box-shadow: 0 20px 60px rgba(139, 92, 246, 0.2);\n  animation: slideIn-e7c874a6 0.3s ease-out;\n}\n.step-content[data-v-e7c874a6] {\n  padding: 24px;\n}\n.modal-title[data-v-e7c874a6] {\n  margin-top: 0;\n  color: #e2e8f0;\n  text-align: center;\n  margin-bottom: 0.5rem;\n  font-size: 1.2rem;\n  font-weight: 600;\n  background: linear-gradient(135deg, #a855f7, #8b5cf6);\n  background-clip: text;\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n.modal-subtitle[data-v-e7c874a6] {\n  text-align: center;\n  color: #94a3b8;\n  margin-bottom: 1.5rem;\n  font-size: 0.9rem;\n  line-height: 1.4;\n}\n.form-group[data-v-e7c874a6] {\n  margin-bottom: 1rem;\n}\n.code-input[data-v-e7c874a6] {\n  width: 100%;\n  padding: 12px 16px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 2px solid rgba(139, 92, 246, 0.2);\n  border-radius: 8px;\n  color: #e2e8f0;\n  font-size: 1rem;\n  box-sizing: border-box;\n  text-align: center;\n  transition: border-color 0.2s ease;\n}\n.code-input[data-v-e7c874a6]:focus {\n  outline: none;\n  border-color: rgba(139, 92, 246, 0.5);\n  box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);\n}\n.code-input[data-v-e7c874a6]::placeholder {\n  color: #64748b;\n}\n.prompt-section[data-v-e7c874a6] {\n  margin-bottom: 24px;\n}\n.prompt-label[data-v-e7c874a6] {\n  display: block;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #e2e8f0;\n  margin-bottom: 8px;\n}\n.prompt-input[data-v-e7c874a6] {\n  width: 100%;\n  padding: 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 2px solid rgba(139, 92, 246, 0.2);\n  border-radius: 8px;\n  color: #e2e8f0;\n  font-size: 0.9rem;\n  line-height: 1.4;\n  resize: vertical;\n  min-height: 100px;\n  transition: border-color 0.2s ease;\n  font-family: inherit;\n  box-sizing: border-box;\n}\n.prompt-input[data-v-e7c874a6]:focus {\n  outline: none;\n  border-color: rgba(139, 92, 246, 0.5);\n  box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);\n}\n.prompt-input[data-v-e7c874a6]::placeholder {\n  color: #64748b;\n}\n.char-count[data-v-e7c874a6] {\n  text-align: right;\n  font-size: 0.7rem;\n  color: #64748b;\n  margin-top: 4px;\n}\n.suggested-prompts[data-v-e7c874a6] {\n  margin-bottom: 24px;\n}\n.suggestions-title[data-v-e7c874a6] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #cbd5e1;\n  margin-bottom: 12px;\n}\n.suggestions-grid[data-v-e7c874a6] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 8px;\n}\n.suggestion-button[data-v-e7c874a6] {\n  padding: 8px 12px;\n  background: rgba(139, 92, 246, 0.1);\n  border: 1px solid rgba(139, 92, 246, 0.3);\n  border-radius: 6px;\n  color: #cbd5e1;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n  line-height: 1.3;\n}\n.suggestion-button[data-v-e7c874a6]:hover {\n  background: rgba(139, 92, 246, 0.2);\n  border-color: rgba(139, 92, 246, 0.5);\n  color: #e2e8f0;\n  transform: translateY(-1px);\n}\n.error-message[data-v-e7c874a6] {\n  color: #ef4444;\n  text-align: center;\n  margin-bottom: 1rem;\n  min-height: 1.2em;\n  font-size: 0.85rem;\n}\n.form-actions[data-v-e7c874a6] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  margin-top: 1.5rem;\n}\n.btn[data-v-e7c874a6] {\n  padding: 10px 20px;\n  border: none;\n  border-radius: 8px;\n  font-size: 0.9rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: linear-gradient(135deg, #8b5cf6, #a855f7);\n  color: white;\n}\n.btn[data-v-e7c874a6]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n.btn[data-v-e7c874a6]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n.btn-secondary[data-v-e7c874a6] {\n  background: rgba(100, 116, 139, 0.2);\n  color: #cbd5e1;\n}\n.btn-secondary[data-v-e7c874a6]:hover {\n  background: rgba(100, 116, 139, 0.3);\n  color: #e2e8f0;\n}\n@keyframes fadeIn-e7c874a6 {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n@keyframes slideIn-e7c874a6 {\nfrom { \n    opacity: 0;\n    transform: translateY(-20px) scale(0.95);\n}\nto { \n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .modal-dialog[data-v-e7c874a6] {\n  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);\n  border-color: rgba(139, 92, 246, 0.4);\n}\n[data-theme="dark"] .code-input[data-v-e7c874a6],\n[data-theme="dark"] .prompt-input[data-v-e7c874a6] {\n  background: rgba(0, 0, 0, 0.5);\n  border-color: rgba(139, 92, 246, 0.3);\n}\n[data-theme="dark"] .suggestion-button[data-v-e7c874a6] {\n  background: rgba(139, 92, 246, 0.15);\n  border-color: rgba(139, 92, 246, 0.4);\n}\n@media (max-width: 480px) {\n.modal-dialog[data-v-e7c874a6] {\n    padding: 1.5rem 1rem;\n    width: 95%;\n    max-height: 90vh;\n}\n.modal-title[data-v-e7c874a6] {\n    font-size: 1.1rem;\n}\n.form-actions[data-v-e7c874a6] {\n    flex-direction: column-reverse;\n    gap: 0.5rem;\n}\n.form-actions .btn[data-v-e7c874a6] {\n    width: 100%;\n}\n.suggestions-grid[data-v-e7c874a6] {\n    grid-template-columns: 1fr;\n}\n}\n',""]);const s=i},1333:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},n=Symbol("test"),t=Object(n);if("string"==typeof n)return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;for(var a in e[n]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==n)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,n);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},1363:(e,n,t)=>{"use strict";t.d(n,{A:()=>kt});var a=t(641),r=t(33),o=t(953),i=t(3751),s=t(5365),l=t(3528),c=t(6680),d=t(8133);const u=(0,t(9596).A)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var p=t(1783),v=t(6494),f=t(8684),h=t(100),m=t(7445),g=t(9173),b=t(5184),y=t(6585),x=t(4270),k=t(876);const w={class:"api-management-panel"},_={class:"panel-header"},C={class:"header-left"},A={class:"header-info"},S={class:"panel-title"},L={class:"settings-subtitle"},E={class:"header-actions"},T={class:"btn-text"},I={class:"btn-text"},R={class:"btn-text"},M={class:"settings-container"},P={class:"settings-section"},D={class:"section-header"},z={class:"section-title"},N={class:"section-count"},$={class:"api-list"},O={class:"api-card-header"},F=["title"],j=["checked","onChange"],B={class:"api-info"},X={class:"api-name"},U={class:"api-provider"},W={class:"api-actions"},q=["onClick","title"],G=["onClick","title"],H=["onClick","title","disabled"],V={class:"api-card-body"},Q={class:"api-detail"},K={class:"detail-label"},Y={class:"detail-value"},J={class:"api-detail"},Z={class:"detail-label"},ee={class:"detail-value url"},ne={class:"api-detail"},te={class:"detail-label"},ae={key:0,class:"api-detail"},re={class:"json-toggle"},oe=["checked","onChange"],ie={key:0,class:"api-card-footer"},se={class:"assigned-label"},le={class:"assigned-tags"},ce={class:"settings-section"},de={class:"section-header"},ue={class:"section-title"},pe={class:"settings-list"},ve={class:"setting-item"},fe={class:"setting-control"},he=["value"],me={class:"setting-item"},ge={class:"setting-info"},be={class:"setting-name"},ye={class:"setting-desc"},xe={class:"setting-control"},ke=["value"],we=["value"],_e={class:"setting-item"},Ce={class:"setting-info"},Ae={class:"setting-name"},Se={class:"setting-desc"},Le={class:"setting-control"},Ee=["value"],Te=["value"],Ie={key:0,class:"auto-split-hint"},Re={class:"setting-item"},Me={class:"setting-control"},Pe={class:"setting-switch"},De=["checked"],ze={class:"setting-info"},Ne={class:"setting-name"},$e={key:0,class:"mode-indicator"},Oe={class:"setting-desc"},Fe={class:"setting-control"},je={class:"control-row"},Be={key:0,class:"inline-toggle"},Xe={class:"setting-switch compact"},Ue={key:1,class:"inline-toggle"},We={class:"setting-switch compact"},qe=["checked"],Ge=["value","onChange","disabled","title"],He=["value","disabled"],Ve=["value","onChange"],Qe={class:"settings-section"},Ke={class:"section-header"},Ye={class:"section-title"},Je={class:"settings-list"},Ze={class:"setting-item"},en={class:"setting-info"},nn={class:"setting-name"},tn={class:"setting-desc"},an={class:"setting-control"},rn={class:"setting-switch"},on={class:"setting-item"},sn={class:"setting-info"},ln={class:"setting-name"},cn={class:"setting-desc"},dn={class:"setting-control"},un={class:"setting-switch"},pn={key:0,class:"setting-item"},vn={class:"setting-info"},fn={class:"setting-name"},hn={class:"setting-desc"},mn={class:"setting-control"},gn={class:"setting-item"},bn={class:"setting-info"},yn={class:"setting-name"},xn={class:"setting-desc"},kn={class:"setting-control"},wn={class:"setting-switch"},_n={key:1,class:"setting-item"},Cn={class:"setting-info"},An={class:"setting-name"},Sn={class:"setting-desc"},Ln={class:"setting-control"},En={value:"female"},Tn={value:"male"},In={value:"all"},Rn={class:"modal-content"},Mn={class:"modal-header"},Pn={class:"modal-body"},Dn={class:"form-group"},zn=["placeholder"],Nn={class:"form-group"},$n={value:"custom"},On={class:"form-group"},Fn=["placeholder"],jn={class:"form-group"},Bn={class:"form-group"},Xn={class:"model-select-wrapper"},Un={class:"model-input-row"},Wn=["placeholder"],qn=["disabled"],Gn={key:0,class:"model-dropdown"},Hn=["onMousedown"],Vn={class:"form-row"},Qn={class:"form-group half"},Kn={class:"form-group half"},Yn={key:0,class:"form-group"},Jn={class:"checkbox-label"},Zn={class:"form-hint"},et={key:0,class:"hint-warning"},nt={key:1,class:"hint-warning"},tt={key:2,class:"hint-warning"},at={key:3},rt={key:4,class:"hint-warning"},ot={class:"modal-footer"},it=(0,a.pM)({__name:"APIManagementPanel",setup(e){const{t:n}=(0,k.s)(),t=(0,h.useAPIManagementStore)(),it=(0,g.useUIStore)();(0,a.sV)(()=>{t.loadFromStorage(),mt(),gt(),xt()});const st=(0,o.KR)(!0),lt=(0,o.KR)(!1),ct=(0,o.KR)(!1),dt=(0,o.KR)(10),ut=(0,o.KR)(!0),pt=(0,o.KR)("female"),vt=(0,o.KR)(1),ft=()=>{try{const e=localStorage.getItem("dad_game_settings");if(!e)return{};const n=JSON.parse(e);return n&&"object"==typeof n&&!Array.isArray(n)?n:{}}catch{return{}}},ht=e=>{const n=ft();localStorage.setItem("dad_game_settings",JSON.stringify({...n,...e}))},mt=()=>{const e=m.aiService.getConfig();st.value=!1!==e.streaming},gt=()=>{const e=(0,y.rW)();ut.value=e.nsfwMode,pt.value=e.nsfwGenderFilter;const n=ft();lt.value=!0===n.splitResponseGeneration;const t=n.retryCount;vt.value="number"==typeof t&&t>=0&&t<=5?t:1},bt=()=>{ht({splitResponseGeneration:lt.value})},yt=()=>{ht({enableNsfwMode:ut.value,nsfwGenderFilter:pt.value})},xt=()=>{const e=b.vectorMemoryService.getConfig(),n=t.isFunctionEnabled("embedding");ct.value=e.enabled&&n,dt.value=e.maxRetrieveCount},kt=()=>{b.vectorMemoryService.saveConfig({enabled:ct.value,maxRetrieveCount:dt.value}),t.setFunctionEnabled("embedding",ct.value),ct.value?x.o.success(`向量记忆检索已启用，每次最多检索 ${dt.value} 条`):x.o.info("向量记忆检索已禁用，将使用全量发送模式")};(0,a.wB)(st,()=>{m.aiService.saveConfig({streaming:st.value}),it.useStreaming=st.value});const wt=(0,o.KR)(!1),_t=(0,o.KR)(!1),Ct=(0,o.KR)({name:"",provider:"openai",url:"",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0}),At=(0,o.KR)(null),St=(0,o.KR)(!1),Lt=(0,o.KR)([]),Et=(0,o.KR)(!1),Tt=(0,a.EW)(()=>{const e=Ct.value.model?.toLowerCase()||"";return e?Lt.value.filter(n=>n.toLowerCase().includes(e)):Lt.value}),It=()=>{Et.value=!0},Rt=(0,o.KR)(null),Mt=(0,o.KR)({}),Pt=e=>e.name,Dt=e=>m.o[e]?.url||"https://api.openai.com",zt=e=>m.o[e]?.defaultModel||"gpt-4o",Nt=()=>{const e=m.o[Ct.value.provider];e&&(Ct.value.url=e.url,Ct.value.model=e.defaultModel)},$t=e=>({main:"主游戏流程",memory_summary:"记忆总结",embedding:"向量检索(Embedding)",text_optimization:"文本优化",instruction_generation:"指令生成",world_generation:"世界生成",event_generation:"事件生成",sect_generation:"势力生成",crafting:"制造/制药"}[e]||e),Ot=e=>({main:"游戏主要交互和剧情生成（核心API）",memory_summary:"压缩总结历史记忆，包括NPC记忆（可用快速模型节省成本）",embedding:"向量记忆语义检索用Embedding（需要embedding模型）",text_optimization:"优化AI输出的文本质量",instruction_generation:"将用户模糊指令转化为明确游戏指令（含思维链推理）",world_generation:"生成世界、地点等内容（开局时使用）",event_generation:"生成世界事件（可用快速模型）",sect_generation:"生成势力内容如功法库、贡献商店（可用快速模型）",crafting:"制造/制药系统（可用快速模型）"}[e]||""),Ft=e=>t.apiAssignments.filter(n=>n.apiId===e).map(e=>e.type),jt=e=>{const n=Mt.value[e];return"success"===n?"success":"fail"===n?"fail":"unknown"},Bt=e=>{const t=Mt.value[e];return n("success"===t?"连接正常":"fail"===t?"连接失败":"未测试")},Xt=async()=>{if(!St.value)if(Ct.value.url&&Ct.value.apiKey){St.value=!0;try{const e=m.aiService.getConfig();m.aiService.saveConfig({mode:"custom",customAPI:{provider:Ct.value.provider,url:Ct.value.url,apiKey:Ct.value.apiKey,model:Ct.value.model||"gpt-4o",temperature:Ct.value.temperature||.7,maxTokens:Ct.value.maxTokens||16e3}});const t=await m.aiService.fetchModels();Lt.value=t,Et.value=!0,x.o.success(`${n("获取到")} ${t.length} ${n("个模型")}`),m.aiService.saveConfig(e)}catch(e){x.o.error(n("获取模型列表失败"))}finally{St.value=!1}}else x.o.warning(n("请先填写API地址和密钥"))},Ut=()=>{if(Ct.value.name){if(_t.value&&At.value)t.updateAPI(At.value,Ct.value),x.o.success(n("API配置已更新"));else{const e={name:Ct.value.name,provider:Ct.value.provider,url:Ct.value.url||Dt(Ct.value.provider),apiKey:Ct.value.apiKey||"",model:Ct.value.model||zt(Ct.value.provider),temperature:Ct.value.temperature||.7,maxTokens:Ct.value.maxTokens||16e3,enabled:!0,forceJsonOutput:Ct.value.forceJsonOutput||!1};t.addAPI(e),x.o.success(n("API配置已添加"))}Gt(),Wt()}else x.o.warning(n("请填写配置名称"))},Wt=()=>{const e=t.apiConfigs.find(e=>"default"===e.id);e&&m.aiService.saveConfig({mode:"custom",customAPI:{provider:e.provider,url:e.url,apiKey:e.apiKey,model:e.model,temperature:e.temperature,maxTokens:e.maxTokens,forceJsonOutput:e.forceJsonOutput}})},qt=(e,a)=>{t.assignAPI(e,a),"instruction_generation"===e&&"default"!==a&&(lt.value||(lt.value=!0,bt(),x.o.success("已自动开启分步生成（指令生成需要分步模式）"))),x.o.success(`${$t(e)} ${n("已分配到")} ${t.apiConfigs.find(e=>e.id===a)?.name||"API"}`)},Gt=()=>{wt.value=!1,_t.value=!1,At.value=null,Ct.value={name:"",provider:"openai",url:"",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0},Lt.value=[]},Ht=()=>{const e=t.exportConfig(),a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=`仙途-API配置-${(new Date).toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(r),x.o.success(n("API配置已导出"))},Vt=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const a=e.target.files?.[0];if(a)try{const e=await a.text(),r=JSON.parse(e);t.importConfig(r),Wt(),x.o.success(n("API配置已导入"))}catch(e){x.o.error(n("导入失败，请检查文件格式"))}},e.click()};return(e,h)=>((0,a.uX)(),(0,a.CE)("div",w,[(0,a.Q3)(" 头部 "),(0,a.Lk)("div",_,[(0,a.Lk)("div",C,[h[21]||(h[21]=(0,a.Lk)("div",{class:"header-icon"},"🔌",-1)),(0,a.Lk)("div",A,[(0,a.Lk)("h3",S,(0,r.v_)((0,o.R1)(n)("API管理")),1),(0,a.Lk)("span",L,(0,r.v_)((0,o.R1)(n)("管理多个API配置和功能分配")),1)])]),(0,a.Lk)("div",E,[(0,a.Lk)("button",{class:"action-btn",onClick:Vt},[(0,a.bF)((0,o.R1)(s.A),{size:16}),(0,a.Lk)("span",T,(0,r.v_)((0,o.R1)(n)("导入")),1)]),(0,a.Lk)("button",{class:"action-btn",onClick:Ht},[(0,a.bF)((0,o.R1)(l.A),{size:16}),(0,a.Lk)("span",I,(0,r.v_)((0,o.R1)(n)("导出")),1)]),(0,a.Lk)("button",{class:"action-btn primary",onClick:h[0]||(h[0]=e=>wt.value=!0)},[(0,a.bF)((0,o.R1)(c.A),{size:16}),(0,a.Lk)("span",R,(0,r.v_)((0,o.R1)(n)("新增API")),1)])])]),(0,a.Q3)(" 内容区域 "),(0,a.Lk)("div",M,[(0,a.Q3)(" API列表区 "),(0,a.Lk)("div",P,[(0,a.Lk)("div",D,[(0,a.Lk)("h4",z,"📡 "+(0,r.v_)((0,o.R1)(n)("API配置列表")),1),(0,a.Lk)("span",N,(0,r.v_)((0,o.R1)(t).apiConfigs.length)+" "+(0,r.v_)((0,o.R1)(n)("个配置")),1)]),(0,a.Lk)("div",$,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,o.R1)(t).apiConfigs,e=>{return(0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,r.C4)(["api-card",{disabled:!e.enabled,default:"default"===e.id}])},[(0,a.Lk)("div",O,[(0,a.Lk)("label",{class:"card-toggle",title:(0,o.R1)(n)("启用/禁用")},[(0,a.Lk)("input",{type:"checkbox",checked:e.enabled,onChange:n=>{return a=e.id,void t.toggleAPI(a);var a}},null,40,j),h[22]||(h[22]=(0,a.Lk)("span",{class:"toggle-slider"},null,-1))],8,F),(0,a.Lk)("div",B,[(0,a.Lk)("span",X,(0,r.v_)(Pt(e)),1),(0,a.Lk)("span",U,(0,r.v_)((i=e.provider,m.o[i]?.name||i)),1)]),(0,a.Lk)("div",W,[(0,a.Lk)("button",{class:"icon-btn",onClick:t=>(async e=>{if(!Rt.value){Rt.value=e.id;try{const t=e.forceJsonOutput?'你正在进行API连通性测试。请按照以下JSON格式输出测试结果：\n\n示例JSON格式：\n{"status": "ok", "message": "仙途本-连通测试-OK"}\n\n请严格按照上述JSON格式输出。':"你正在进行API连通性测试。请仅输出：仙途本-连通测试-OK",a=await m.aiService.testAPIDirectly({provider:e.provider,url:e.url,apiKey:e.apiKey,model:e.model,temperature:e.temperature,maxTokens:1e3,forceJsonOutput:e.forceJsonOutput},t);let r=!1;if(e.forceJsonOutput)try{const e=JSON.parse(a);r="ok"===e.status||e.message&&e.message.includes("仙途本")||a.toLowerCase().includes("ok")}catch{r=a.toLowerCase().includes("仙途本")||a.toLowerCase().includes("ok")}else r=a.toLowerCase().includes("仙途本")||a.toLowerCase().includes("ok");Mt.value[e.id]=r?"success":"fail",r?x.o.success(`${e.name} ${n("连接成功")}`):x.o.warning(`${e.name} ${n("响应异常")}`)}catch(t){Mt.value[e.id]="fail",x.o.error(`${e.name} ${n("连接失败")}: ${t instanceof Error?t.message:"未知错误"}`)}finally{Rt.value=null}}})(e),title:(0,o.R1)(n)("测试连接")},[(0,a.bF)((0,o.R1)(d.A),{size:16,class:(0,r.C4)({"loading-pulse":Rt.value===e.id})},null,8,["class"])],8,q),(0,a.Lk)("button",{class:"icon-btn",onClick:n=>(e=>{Ct.value={...e},At.value=e.id,_t.value=!0})(e),title:(0,o.R1)(n)("编辑")},[(0,a.bF)((0,o.R1)(u),{size:16})],8,G),(0,a.Lk)("button",{class:"icon-btn danger",onClick:a=>{var r;"default"!==(r=e.id)?it.showRetryDialog({title:n("确认删除"),message:n("确定要删除这个API配置吗？使用它的功能将自动回退到默认API。"),confirmText:n("删除"),cancelText:n("取消"),onConfirm:()=>{t.deleteAPI(r),x.o.success(n("API配置已删除"))},onCancel:()=>{}}):x.o.error(n("不能删除默认API配置"))},title:(0,o.R1)(n)("删除"),disabled:"default"===e.id},[(0,a.bF)((0,o.R1)(p.A),{size:16})],8,H)])]),(0,a.Lk)("div",V,[(0,a.Lk)("template",null,[(0,a.Lk)("div",Q,[(0,a.Lk)("span",K,(0,r.v_)((0,o.R1)(n)("模型"))+":",1),(0,a.Lk)("span",Y,(0,r.v_)(e.model),1)]),(0,a.Lk)("div",J,[(0,a.Lk)("span",Z,(0,r.v_)((0,o.R1)(n)("地址"))+":",1),(0,a.Lk)("span",ee,(0,r.v_)(e.url||(0,o.R1)(n)("默认")),1)]),(0,a.Lk)("div",ne,[(0,a.Lk)("span",te,(0,r.v_)((0,o.R1)(n)("状态"))+":",1),(0,a.Lk)("span",{class:(0,r.C4)(["detail-value",jt(e.id)])},(0,r.v_)(Bt(e.id)),3)]),["openai","deepseek","zhipu","custom","gemini","claude"].includes(e.provider)?((0,a.uX)(),(0,a.CE)("div",ae,[(0,a.Lk)("label",re,[(0,a.Lk)("input",{type:"checkbox",checked:e.forceJsonOutput,onChange:a=>{return r=e.id,o=a.target.checked,t.updateAPI(r,{forceJsonOutput:o}),void x.o.success(n(o?"已启用强制JSON":"已关闭强制JSON"));var r,o}},null,40,oe),(0,a.Lk)("span",null,(0,r.v_)((0,o.R1)(n)("强制JSON")),1)])])):(0,a.Q3)("v-if",!0)])]),Ft(e.id).length>0?((0,a.uX)(),(0,a.CE)("div",ie,[(0,a.Lk)("span",se,(0,r.v_)((0,o.R1)(n)("已分配功能"))+":",1),(0,a.Lk)("div",le,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Ft(e.id),e=>((0,a.uX)(),(0,a.CE)("span",{key:e,class:"function-tag"},(0,r.v_)($t(e)),1))),128))])])):(0,a.Q3)("v-if",!0)],2);var i}),128))])]),(0,a.Q3)(" 功能分配区 "),(0,a.Lk)("div",ce,[(0,a.Lk)("div",de,[(0,a.Lk)("h4",ue,"⚙️ "+(0,r.v_)((0,o.R1)(n)("功能分配")),1),h[23]||(h[23]=(0,a.Lk)("span",{class:"mode-badge"},"通用模式",-1))]),(0,a.Q3)(" 模式说明 "),h[38]||(h[38]=(0,a.Fv)('<div class="mode-hint" data-v-6e14ada2><div class="hint-icon" data-v-6e14ada2>💡</div><div class="hint-content" data-v-6e14ada2><strong data-v-6e14ada2>说明：</strong>默认API用于主流程；可为不同功能分配独立API。 </div></div><div class="pipeline-hint" data-v-6e14ada2><div class="hint-icon" data-v-6e14ada2>💡</div><div class="hint-content" data-v-6e14ada2><strong data-v-6e14ada2>智能流水线：</strong>只有配置了独立API的功能才会触发额外调用。 如果所有功能都使用&quot;默认API&quot;，系统会合并请求以节省调用次数。 <br data-v-6e14ada2><span class="hint-example" data-v-6e14ada2>示例：指令生成 + Main 使用同一API = 1次调用 | 指令生成 + Main 使用不同API = 2次调用</span></div></div>',2)),(0,a.Lk)("div",pe,[(0,a.Q3)(" ========== 全局设置 ========== "),h[35]||(h[35]=(0,a.Lk)("div",{class:"function-group-header"},[(0,a.Lk)("h5",{class:"group-title"},"⚙️ 全局设置"),(0,a.Lk)("span",{class:"group-desc"},"影响所有API调用的通用配置")],-1)),(0,a.Q3)(" 重试次数设置 "),(0,a.Lk)("div",ve,[h[25]||(h[25]=(0,a.Lk)("div",{class:"setting-info"},[(0,a.Lk)("label",{class:"setting-name"},"重试次数"),(0,a.Lk)("span",{class:"setting-desc"},"API调用失败后的重试次数。0=不重试，1=重试1次，以此类推")],-1)),(0,a.Lk)("div",fe,[(0,a.Lk)("input",{type:"number",value:vt.value,onInput:h[1]||(h[1]=e=>(e=>{const n=parseInt(e,10);if(isNaN(n)||n<0||n>5)return void x.o.error("重试次数必须在 0-5 之间");vt.value=n,ht({retryCount:n});const t=m.aiService.getConfig();m.aiService.saveConfig({...t,maxRetries:n}),x.o.success(`重试次数已设置为 ${n} 次`)})(e.target.value)),min:"0",max:"5",class:"setting-number-input"},null,40,he),h[24]||(h[24]=(0,a.Lk)("span",{class:"input-hint"},"次",-1))])]),(0,a.Q3)(" ========== 主游戏流程（3个） ========== "),h[36]||(h[36]=(0,a.Lk)("div",{class:"function-group-header"},[(0,a.Lk)("h5",{class:"group-title"},"🎮 主游戏流程"),(0,a.Lk)("span",{class:"group-desc"},"控制游戏主要生成流程的API分配")],-1)),(0,a.Q3)(" 1. 主游戏流程 "),(0,a.Lk)("div",me,[(0,a.Lk)("div",ge,[(0,a.Lk)("label",be,(0,r.v_)($t("main")),1),(0,a.Lk)("span",ye,(0,r.v_)(Ot("main")),1)]),(0,a.Lk)("div",xe,[(0,a.Lk)("select",{value:(0,o.R1)(t).apiAssignments.find(e=>"main"===e.type)?.apiId,onChange:h[2]||(h[2]=e=>qt("main",e.target.value)),class:"setting-select"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,o.R1)(t).enabledAPIs,e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id},(0,r.v_)(Pt(e)),9,we))),128))],40,ke)])]),(0,a.Q3)(" 2. 指令生成 "),(0,a.Lk)("div",_e,[(0,a.Lk)("div",Ce,[(0,a.Lk)("label",Ae,(0,r.v_)($t("instruction_generation")),1),(0,a.Lk)("span",Se,(0,r.v_)(Ot("instruction_generation")),1)]),(0,a.Lk)("div",Le,[(0,a.Lk)("select",{value:(0,o.R1)(t).apiAssignments.find(e=>"instruction_generation"===e.type)?.apiId,onChange:h[3]||(h[3]=e=>qt("instruction_generation",e.target.value)),class:"setting-select"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,o.R1)(t).enabledAPIs,e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id},(0,r.v_)(Pt(e)),9,Te))),128))],40,Ee)])]),(0,a.Q3)(" 自动分步生成提示 "),(0,o.R1)(t).shouldEnableSplitGeneration?((0,a.uX)(),(0,a.CE)("div",Ie,h[26]||(h[26]=[(0,a.Lk)("div",{class:"hint-icon"},"⚡",-1),(0,a.Lk)("div",{class:"hint-text"},[(0,a.Lk)("strong",null,"自动分步生成已启用："),(0,a.eW)(" 检测到主游戏流程中有功能使用了独立API，系统将自动启用分步生成以优化性能。 ")],-1)]))):(0,a.Q3)("v-if",!0),(0,a.Q3)(" 分步生成第2步流式设置 "),(0,a.Lk)("div",Re,[h[28]||(h[28]=(0,a.Lk)("div",{class:"setting-info"},[(0,a.Lk)("label",{class:"setting-name"},"分步第2步流式传输"),(0,a.Lk)("span",{class:"setting-desc"},"分步生成时，第2步（指令生成）是否使用流式传输（默认关闭，部分API不支持流式）")],-1)),(0,a.Lk)("div",Me,[(0,a.Lk)("label",Pe,[(0,a.Lk)("input",{type:"checkbox",checked:(0,o.R1)(t).aiGenerationSettings.splitStep2Streaming,onChange:h[4]||(h[4]=e=>(0,o.R1)(t).updateAIGenerationSettings({splitStep2Streaming:e.target.checked}))},null,40,De),h[27]||(h[27]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])]),(0,a.Q3)(" ========== 辅助功能（6个） ========== "),h[37]||(h[37]=(0,a.Lk)("div",{class:"function-group-header"},[(0,a.Lk)("h5",{class:"group-title"},"🛠️ 辅助功能"),(0,a.Lk)("span",{class:"group-desc"},"可选的辅助生成功能，支持Raw/标准模式切换")],-1)),(0,a.Q3)(" 辅助功能列表 "),((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(["memory_summary","text_optimization","world_generation","event_generation","sect_generation","crafting","embedding"],e=>(0,a.Lk)("div",{key:e,class:"setting-item"},[(0,a.Lk)("div",ze,[(0,a.Lk)("label",Ne,[(0,a.eW)((0,r.v_)($t(e))+" ",1),"embedding"!==e?((0,a.uX)(),(0,a.CE)("span",$e,(0,r.v_)("raw"===(0,o.R1)(t).getFunctionMode(e)?"Raw":"标准"),1)):(0,a.Q3)("v-if",!0)]),(0,a.Lk)("span",Oe,(0,r.v_)(Ot(e)),1)]),(0,a.Lk)("div",Fe,[(0,a.Lk)("div",je,[(0,a.Q3)(" embedding 功能的启用开关 "),"embedding"===e?((0,a.uX)(),(0,a.CE)("div",Be,[h[30]||(h[30]=(0,a.Lk)("label",{class:"toggle-label"},"启用",-1)),(0,a.Lk)("label",Xe,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":h[5]||(h[5]=e=>ct.value=e),onChange:kt},null,544),[[i.lH,ct.value]]),h[29]||(h[29]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])):(0,a.Q3)("v-if",!0),(0,a.Q3)(" text_optimization 功能的启用开关 "),"text_optimization"===e?((0,a.uX)(),(0,a.CE)("div",Ue,[h[32]||(h[32]=(0,a.Lk)("label",{class:"toggle-label"},"启用",-1)),(0,a.Lk)("label",We,[(0,a.Lk)("input",{type:"checkbox",checked:(0,o.R1)(t).isFunctionEnabled("text_optimization"),onChange:h[6]||(h[6]=e=>(0,o.R1)(t).setFunctionEnabled("text_optimization",e.target.checked))},null,40,qe),h[31]||(h[31]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])):(0,a.Q3)("v-if",!0),(0,a.Q3)(" API分配下拉框 "),(0,a.Lk)("select",{value:(0,o.R1)(t).apiAssignments.find(n=>n.type===e)?.apiId,onChange:n=>qt(e,n.target.value),class:(0,r.C4)(["setting-select",{"disabled-hint":"embedding"===e&&!ct.value}]),disabled:"embedding"===e&&!ct.value,title:"embedding"!==e||ct.value?"":"请先启用向量检索功能"},[h[33]||(h[33]=(0,a.Lk)("option",{value:"default"},"使用主API",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,o.R1)(t).apiConfigs.filter(e=>"default"!==e.id),e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id,disabled:!e.enabled},(0,r.v_)(Pt(e))+(0,r.v_)(e.enabled?"":" (未启用)"),9,He))),128))],42,Ge),(0,a.Q3)(" Raw/标准模式选择（仅非embedding功能且为酒馆模式时显示） "),"embedding"!==e?((0,a.uX)(),(0,a.CE)("select",{key:2,value:(0,o.R1)(t).getFunctionMode(e),onChange:a=>{return r=e,o=a.target.value,t.setFunctionMode(r,o),void x.o.success(`${$t(r)} ${n("模式已设置为")} ${o}`);var r,o},class:"setting-select mode-select"},h[34]||(h[34]=[(0,a.Lk)("option",{value:"raw"},"Raw",-1),(0,a.Lk)("option",{value:"standard"},"标准",-1)]),40,Ve)):(0,a.Q3)("v-if",!0)])])])),64))])]),(0,a.Q3)(" AI生成设置 "),(0,a.Lk)("div",Qe,[(0,a.Lk)("div",Ke,[(0,a.Lk)("h4",Ye,"🤖 "+(0,r.v_)((0,o.R1)(n)("AI生成设置")),1)]),(0,a.Lk)("div",Je,[(0,a.Lk)("div",Ze,[(0,a.Lk)("div",en,[(0,a.Lk)("label",nn,(0,r.v_)((0,o.R1)(n)("流式输出")),1),(0,a.Lk)("span",tn,(0,r.v_)((0,o.R1)(n)("开启后AI响应逐字显示")),1)]),(0,a.Lk)("div",an,[(0,a.Lk)("label",rn,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":h[7]||(h[7]=e=>st.value=e)},null,512),[[i.lH,st.value]]),h[39]||(h[39]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])]),(0,a.Lk)("div",on,[(0,a.Lk)("div",sn,[(0,a.Lk)("label",ln,(0,r.v_)((0,o.R1)(n)("分步生成")),1),(0,a.Lk)("span",cn,(0,r.v_)((0,o.R1)(n)("开启后AI分两步生成：先输出正文，再生成指令")),1)]),(0,a.Lk)("div",dn,[(0,a.Lk)("label",un,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":h[8]||(h[8]=e=>lt.value=e),onChange:bt},null,544),[[i.lH,lt.value]]),h[40]||(h[40]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])]),ct.value?((0,a.uX)(),(0,a.CE)("div",pn,[(0,a.Lk)("div",vn,[(0,a.Lk)("label",fn,(0,r.v_)((0,o.R1)(n)("检索数量")),1),(0,a.Lk)("span",hn,(0,r.v_)((0,o.R1)(n)("每次检索的最大记忆条数")),1)]),(0,a.Lk)("div",mn,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":h[9]||(h[9]=e=>dt.value=e),onChange:kt,class:"setting-select"},h[41]||(h[41]=[(0,a.Lk)("option",{value:5},"5条",-1),(0,a.Lk)("option",{value:10},"10条（推荐）",-1),(0,a.Lk)("option",{value:15},"15条",-1),(0,a.Lk)("option",{value:20},"20条",-1)]),544),[[i.u1,dt.value,void 0,{number:!0}]])])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",gn,[(0,a.Lk)("div",bn,[(0,a.Lk)("label",yn,(0,r.v_)((0,o.R1)(n)("🔞 成人内容模式")),1),(0,a.Lk)("span",xn,(0,r.v_)((0,o.R1)(n)("启用后NPC可能产生成人向互动内容")),1)]),(0,a.Lk)("div",kn,[(0,a.Lk)("label",wn,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":h[10]||(h[10]=e=>ut.value=e),onChange:yt},null,544),[[i.lH,ut.value]]),h[42]||(h[42]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])]),ut.value?((0,a.uX)(),(0,a.CE)("div",_n,[(0,a.Lk)("div",Cn,[(0,a.Lk)("label",An,(0,r.v_)((0,o.R1)(n)("🔞 性别偏好过滤")),1),(0,a.Lk)("span",Sn,(0,r.v_)((0,o.R1)(n)("过滤参与成人互动的NPC性别")),1)]),(0,a.Lk)("div",Ln,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":h[11]||(h[11]=e=>pt.value=e),onChange:yt,class:"setting-select"},[(0,a.Lk)("option",En,(0,r.v_)((0,o.R1)(n)("仅女性")),1),(0,a.Lk)("option",Tn,(0,r.v_)((0,o.R1)(n)("仅男性")),1),(0,a.Lk)("option",In,(0,r.v_)((0,o.R1)(n)("不限性别")),1)],544),[[i.u1,pt.value]])])])):(0,a.Q3)("v-if",!0)])])]),(0,a.Q3)(" 新增/编辑API弹窗 "),wt.value||_t.value?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:(0,i.D$)(Gt,["self"])},[(0,a.Lk)("div",Rn,[(0,a.Lk)("div",Mn,[(0,a.Lk)("h3",null,(0,r.v_)(_t.value?(0,o.R1)(n)("编辑API配置"):(0,o.R1)(n)("新增API配置")),1),(0,a.Lk)("button",{class:"close-btn",onClick:Gt},[(0,a.bF)((0,o.R1)(v.A),{size:20})])]),(0,a.Lk)("div",Pn,[(0,a.Lk)("div",Dn,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("配置名称")),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":h[12]||(h[12]=e=>Ct.value.name=e),class:"form-input",placeholder:(0,o.R1)(n)("例如：主力API")},null,8,zn),[[i.Jo,Ct.value.name]])]),(0,a.Lk)("div",Nn,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("API提供商")),1),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":h[13]||(h[13]=e=>Ct.value.provider=e),class:"form-select",onChange:Nt},[h[43]||(h[43]=(0,a.Fv)('<option value="openai" data-v-6e14ada2>OpenAI</option><option value="claude" data-v-6e14ada2>Claude</option><option value="gemini" data-v-6e14ada2>Gemini</option><option value="deepseek" data-v-6e14ada2>DeepSeek</option><option value="zhipu" data-v-6e14ada2>智谱AI</option><option value="siliconflow-embedding" data-v-6e14ada2>硅基流动(Embedding)</option>',6)),(0,a.Lk)("option",$n,(0,r.v_)((0,o.R1)(n)("自定义(OpenAI兼容)")),1)],544),[[i.u1,Ct.value.provider]])]),(0,a.Lk)("div",On,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("API地址")),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":h[14]||(h[14]=e=>Ct.value.url=e),class:"form-input",placeholder:Dt(Ct.value.provider||"openai")},null,8,Fn),[[i.Jo,Ct.value.url]])]),(0,a.Lk)("div",jn,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("API密钥")),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":h[15]||(h[15]=e=>Ct.value.apiKey=e),type:"password",class:"form-input",placeholder:"sk-..."},null,512),[[i.Jo,Ct.value.apiKey]])]),(0,a.Lk)("div",Bn,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("模型名称")),1),(0,a.Lk)("div",Xn,[(0,a.Lk)("div",Un,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":h[16]||(h[16]=e=>Ct.value.model=e),class:"form-input",placeholder:zt(Ct.value.provider||"openai"),onFocus:h[17]||(h[17]=e=>Et.value=!0),onInput:It},null,40,Wn),[[i.Jo,Ct.value.model]]),(0,a.Lk)("button",{class:"utility-btn",onClick:Xt,disabled:St.value},[(0,a.bF)((0,o.R1)(f.A),{size:16,class:(0,r.C4)({"loading-pulse":St.value})},null,8,["class"])],8,qn)]),Et.value&&Tt.value.length>0?((0,a.uX)(),(0,a.CE)("div",Gn,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Tt.value,e=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:(0,r.C4)(["model-dropdown-item",{active:Ct.value.model===e}]),onMousedown:(0,i.D$)(n=>(e=>{Ct.value.model=e,Et.value=!1})(e),["prevent"])},(0,r.v_)(e),43,Hn))),128))])):(0,a.Q3)("v-if",!0)])]),(0,a.Lk)("div",Vn,[(0,a.Lk)("div",Qn,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("温度参数")),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":h[18]||(h[18]=e=>Ct.value.temperature=e),type:"number",class:"form-input",min:"0",max:"2",step:"0.1"},null,512),[[i.Jo,Ct.value.temperature,void 0,{number:!0}]])]),(0,a.Lk)("div",Kn,[(0,a.Lk)("label",null,(0,r.v_)((0,o.R1)(n)("最大Token数")),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":h[19]||(h[19]=e=>Ct.value.maxTokens=e),type:"number",class:"form-input",min:"100",max:"128000"},null,512),[[i.Jo,Ct.value.maxTokens,void 0,{number:!0}]])])]),(0,a.Q3)(" 强制JSON输出选项 "),["openai","deepseek","zhipu","custom","gemini","claude"].includes(Ct.value.provider||"openai")?((0,a.uX)(),(0,a.CE)("div",Yn,[(0,a.Lk)("label",Jn,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":h[20]||(h[20]=e=>Ct.value.forceJsonOutput=e),class:"form-checkbox"},null,512),[[i.lH,Ct.value.forceJsonOutput]]),(0,a.Lk)("span",null,(0,r.v_)((0,o.R1)(n)("强制JSON格式输出")),1)]),(0,a.Lk)("div",Zn,[(0,a.eW)((0,r.v_)((0,o.R1)(n)('启用后，API将强制返回JSON格式。需要在提示词中包含"json"字样并给出JSON格式样例。'))+" ",1),h[47]||(h[47]=(0,a.Lk)("br",null,null,-1)),"gemini"===Ct.value.provider?((0,a.uX)(),(0,a.CE)("span",et," ℹ️ "+(0,r.v_)((0,o.R1)(n)("Gemini使用response_mime_type实现JSON模式")),1)):"claude"===Ct.value.provider?((0,a.uX)(),(0,a.CE)("span",nt," ℹ️ "+(0,r.v_)((0,o.R1)(n)("Claude使用prefill技巧实现JSON模式")),1)):((0,a.uX)(),(0,a.CE)("span",tt," ⚠️ "+(0,r.v_)((0,o.R1)(n)("仅支持OpenAI兼容API（如DeepSeek）。使用前请确保提示词中包含JSON格式说明。")),1)),"custom"===Ct.value.provider?((0,a.uX)(),(0,a.CE)("br",at)):(0,a.Q3)("v-if",!0),"custom"===Ct.value.provider?((0,a.uX)(),(0,a.CE)("span",rt,[(0,a.eW)(" ⚠️ "+(0,r.v_)((0,o.R1)(n)("重要：如果使用New-API等中转服务，需确认底层模型支持！"))+" ",1),h[44]||(h[44]=(0,a.Lk)("br",null,null,-1)),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("• 底层是OpenAI/DeepSeek/Qwen/GLM-4: ✅ 通常可用"))+" ",1),h[45]||(h[45]=(0,a.Lk)("br",null,null,-1)),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("• 底层是Gemini/Claude/旧模型: ❌ 可能报错"))+" ",1),h[46]||(h[46]=(0,a.Lk)("br",null,null,-1)),(0,a.Lk)("strong",null,(0,r.v_)((0,o.R1)(n)('• 务必先用"测试连接"验证！')),1)])):(0,a.Q3)("v-if",!0)])])):(0,a.Q3)("v-if",!0)]),(0,a.Lk)("div",ot,[(0,a.Lk)("button",{class:"btn-cancel",onClick:Gt},(0,r.v_)((0,o.R1)(n)("取消")),1),(0,a.Lk)("button",{class:"btn-confirm",onClick:Ut},(0,r.v_)((0,o.R1)(n)("保存")),1)])])])):(0,a.Q3)("v-if",!0)]))}});var st=t(5072),lt=t.n(st),ct=t(7825),dt=t.n(ct),ut=t(7659),pt=t.n(ut),vt=t(5056),ft=t.n(vt),ht=t(540),mt=t.n(ht),gt=t(1113),bt=t.n(gt),yt=t(5744),xt={};xt.styleTagTransform=bt(),xt.setAttributes=ft(),xt.insert=pt().bind(null,"head"),xt.domAPI=dt(),xt.insertStyleElement=mt(),lt()(yt.A,xt),yt.A&&yt.A.locals&&yt.A.locals;const kt=(0,t(6262).A)(it,[["__scopeId","data-v-6e14ada2"]])},1412:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]])},1419:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>P});var a=t(641),r=t(33),o=t(3751),i=t(953),s=t(4717),l=t(1783);const c={class:"tree-node"},d={key:0,class:"arrow"},u={key:1,class:"arrow"},p={class:"key"},v={key:2,class:"value"},f={class:"action-buttons"},h=["disabled"],m=["disabled"],g={key:0,class:"node-children"},b=(0,a.pM)({__name:"TreeNode",props:{nodeKey:{},value:{},path:{},readOnly:{type:Boolean,default:!1}},emits:["delete-item","edit-item"],setup(e,{emit:n}){const b=(0,a.$V)(()=>Promise.resolve().then(t.bind(t,1419))),y=e,x=n,k=(0,i.KR)(!1),w=(0,a.EW)(()=>"object"==typeof y.value&&null!==y.value),_=(0,a.EW)(()=>null===y.value?"null":"string"==typeof y.value&&y.value.length>100?`"${y.value.substring(0,100)}..."`:JSON.stringify(y.value)),C=(0,a.EW)(()=>{const e=y.path,n=e.startsWith("角色.背包.物品.")&&4===e.split(".").length,t=e.startsWith("社交.关系.")&&3===e.split(".").length;return n||t}),A=()=>{w.value&&(k.value=!k.value)},S=()=>{y.readOnly||x("delete-item",y.path)},L=()=>{y.readOnly||x("edit-item",y.path,y.value)};return(e,n)=>((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",{class:(0,r.C4)(["node-line",{"is-object":w.value}]),onClick:A},[w.value?((0,a.uX)(),(0,a.CE)("span",d,(0,r.v_)(k.value?"▼":"▶"),1)):((0,a.uX)(),(0,a.CE)("span",u)),(0,a.Lk)("span",p,(0,r.v_)(e.nodeKey)+":",1),w.value?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("span",v,(0,r.v_)(_.value),1)),(0,a.Lk)("div",f,[(0,a.Lk)("button",{onClick:(0,o.D$)(L,["stop"]),class:"edit-btn",title:"编辑此项",disabled:e.readOnly},[(0,a.bF)((0,i.R1)(s.A),{size:14})],8,h),C.value?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:(0,o.D$)(S,["stop"]),class:"delete-btn",title:"删除此项",disabled:e.readOnly},[(0,a.bF)((0,i.R1)(l.A),{size:14})],8,m)):(0,a.Q3)("v-if",!0)])],2),w.value&&k.value?((0,a.uX)(),(0,a.CE)("div",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.value,(t,r)=>((0,a.uX)(),(0,a.Wv)((0,i.R1)(b),{key:r,"node-key":r,value:t,path:`${e.path}.${r}`,"read-only":e.readOnly,onDeleteItem:n[0]||(n[0]=e=>x("delete-item",e)),onEditItem:n[1]||(n[1]=(e,n)=>x("edit-item",e,n))},null,8,["node-key","value","path","read-only"]))),128))])):(0,a.Q3)("v-if",!0)]))}});var y=t(5072),x=t.n(y),k=t(7825),w=t.n(k),_=t(7659),C=t.n(_),A=t(5056),S=t.n(A),L=t(540),E=t.n(L),T=t(1113),I=t.n(T),R=t(1489),M={};M.styleTagTransform=I(),M.setAttributes=S(),M.insert=C().bind(null,"head"),M.domAPI=w(),M.insertStyleElement=E(),x()(R.A,M),R.A&&R.A.locals&&R.A.locals;const P=(0,t(6262).A)(b,[["__scopeId","data-v-ee632ce2"]])},1489:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.tree-node[data-v-ee632ce2] {\n  padding-left: 20px;\n  position: relative;\n}\n.node-line[data-v-ee632ce2] {\n  display: flex;\n  align-items: center;\n  padding: 4px 0;\n  cursor: default;\n  position: relative;\n}\n.node-line.is-object[data-v-ee632ce2] {\n  cursor: pointer;\n}\n.arrow[data-v-ee632ce2] {\n  width: 20px;\n  text-align: center;\n  margin-left: -20px;\n  color: #888;\n  font-size: 0.7rem;\n}\n.key[data-v-ee632ce2] {\n  color: #9cdcfe; /* 蓝色，适合键 */\n  margin-right: 8px;\n  font-weight: bold;\n}\n.value[data-v-ee632ce2] {\n  color: #ce9178; /* 橙色，适合字符串值 */\n}\n.node-children[data-v-ee632ce2] {\n  border-left: 1px solid #444;\n}\n.action-buttons[data-v-ee632ce2] {\n  margin-left: auto;\n  display: none; /* 默认隐藏 */\n  gap: 4px;\n}\n.node-line:hover .action-buttons[data-v-ee632ce2] {\n  display: flex; /* 悬停时显示 */\n}\n.edit-btn[data-v-ee632ce2],\n.delete-btn[data-v-ee632ce2] {\n  background: none;\n  border: none;\n  cursor: pointer;\n  padding: 2px 4px;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-ee632ce2]:disabled,\n.delete-btn[data-v-ee632ce2]:disabled {\n  opacity: 0.35;\n  cursor: not-allowed;\n}\n.edit-btn[data-v-ee632ce2] {\n  color: #4a9eff;\n}\n.edit-btn[data-v-ee632ce2]:hover {\n  background: rgba(74, 158, 255, 0.2);\n  color: #6eb3ff;\n}\n.edit-btn[data-v-ee632ce2]:disabled:hover {\n  background: none;\n  color: #4a9eff;\n}\n.delete-btn[data-v-ee632ce2] {\n  color: #ff5555;\n}\n.delete-btn[data-v-ee632ce2]:hover {\n  background: rgba(255, 85, 85, 0.2);\n  color: #ff8080;\n}\n.delete-btn[data-v-ee632ce2]:disabled:hover {\n  background: none;\n  color: #ff5555;\n}\n",""]);const s=i},1513:(e,n,t)=>{"use strict";t.d(n,{q:()=>s});var a=t(8263),r=(t(406),t(6585)),o=t(6416),i=t(2077);async function s(e,n,t,s){const[l,c,d,u,p,v]=await Promise.all([(0,a.XH)("coreOutputRules"),(0,a.XH)("businessRules"),(0,a.XH)("playerPersonality"),(0,a.XH)("dataDefinitions"),(0,a.XH)("textFormatRules"),(0,a.XH)("worldStandards")]),f=[l,c,d,u,p,v],h=(await(0,a.XH)("awakeningStrengthRules")).trim();h&&f.push(h);const m=(await(0,a.XH)("specificNarrativeMap")).trim();m&&f.push(m);const g=(await(0,a.XH)("mutantCreatureRules")).trim();if(g&&f.push(g),e.includes("actionOptions")){const e=(await(0,a.XH)("actionOptions")).trim(),t=n?`**用户自定义要求**：${n}\n\n请严格按照以上自定义要求生成行动选项。`:"（无特殊要求，按默认规则生成）";e&&f.push(e.replace("{{CUSTOM_ACTION_PROMPT}}",t))}if(e.includes("eventSystem")){const e=(await(0,a.XH)("eventSystemRules")).trim();e&&f.push(e)}{const e=(0,r.rW)(),n=t?.系统?.配置??{},a="boolean"==typeof n.nsfwMode?n.nsfwMode:e.nsfwMode,o="string"==typeof n.nsfwGenderFilter?n.nsfwGenderFilter:e.nsfwGenderFilter;f.push(["# NSFW设置","- nsfwMode: "+(a?"true":"false"),`- nsfwGenderFilter: ${o}`,"- 当 nsfwMode=true 且 NPC性别符合过滤条件时，创建NPC必须生成完整私密信息(PrivacyProfile)","- 若 NPC 已存在但私密信息缺失，需用 set 写入 社交.关系.[NPC名].私密信息 完整对象","- 当 nsfwMode=false 或 性别不匹配 时，禁止生成私密信息","","# NPC性格一致性（NSFW同样适用）","- NPC的语言风格与行为逻辑必须严格符合其“性格/立场/底线/价值观”，禁止OOC（人设崩坏）","- 对话口吻与措辞需与身份与时代一致；若NPC设定保守/冷淡，则在NSFW场景中也应保持克制与边界感","- 亲密互动必须同时满足：双方意愿明确 + 关系与好感度合理 + 场景安全与合规；否则以拒绝/回避/协商替代","- 任何性格转变必须由明确事件触发并有合理铺垫，不得突然改变口吻或价值观","- 语言风格一致性：同一NPC在连续场景中的语气/节奏/用词需稳定，除非叙事明确给出改变原因","","# 六维属性约束（CRITICAL）","- NSFW场景下的动作能力/姿态/力道/耐受/节奏必须受双方六维属性(力量/敏捷/体质/意志/魅力/幸运)与阶段影响约束","- 禁止弱势压制强势：例如力量1角色“强行压制”力量5角色属于OOC，必须以判定失败和合理后果处理","- 判定同样适用：涉及亲密互动的尝试需使用〔社交/探索/感知/战斗〕判定并给出关键因素(属性权重/状态/环境/阶段差)","","# NPC独立人格与自主权","- NPC拥有独立人格与决策权：可以拒绝/同意/中止/提出条件/协商；玩家输入仅作为“尝试”，不作为结果","- 任何超越NPC边界的请求应给出拒绝/回避或转为安全合规的替代互动，并在后续叙事中保持人设与后果一致","","# 条件化进入NSFW场景（非一刀切）","- 当玩家在综合判定（六维属性加权+阶段差+状态效果+装备+环境）中达到“大成功/完美”，且场景安全与合规时，可进入“强制局势”以锁定场景与互动前置","- “强制局势”仅改变场景控制权，不等于同意；亲密行为仍需明确同意，否则输出拒绝/反抗/协商，并保持人设与后果一致","- 极端压制例外：当阶段差≥2或目标处于不良状态且关键因素成立，允许进入NSFW场景的管控流程；任何实际亲密动作仍需判定并以双方同意为前提","- 输出必须写明判定标记〔社交/战斗:结果,判定值:X,难度:Y,关键因素...〕并说明为何进入或未进入该场景","","# 后果与好感度（CRITICAL）","- 若以“强制局势”进入NSFW且行为不符合NPC性格/期待/边界，则必须显著降低好感度（如 -15~-40），并可能添加负面状态或记忆（不信任/警惕/创伤）","- 若行为符合NPC的性格与期待且取得明确同意，可按叙事给予适度的好感度正向变化（如 +5~+15），并记录积极记忆","- 必须以 tavern_commands 同步后果：add 社交.关系.[NPC名].好感度（正/负），set 社交.关系.[NPC名].当前内心想法（简述情绪/态度），push 社交.关系.[NPC名].记忆（摘要）"].join("\n")),a&&f.push(i.w3)}const b=t?.角色?.身份?.先天属性||t?.角色?.先天属性;if(b&&"object"==typeof b){const e=(e,n)=>{let t=e[0],a=Math.abs((e[0]?.value??0)-n);for(let r=1;r<e.length;r++){const o=Math.abs(e[r].value-n);o<a&&(a=o,t=e[r])}return t},n=new Set((s||[]).map(e=>String(e).toLowerCase()));let t=["力量","敏捷","体质"];n.has("combat")?t=["力量","敏捷","体质"]:n.has("social")?t=["魅力","意志"]:n.has("exploration")?t=["敏捷","幸运"]:n.has("crafting")?t=["意志","幸运"]:n.has("escape")?t=["敏捷","幸运"]:n.has("perception")?t=["意志","敏捷"]:(n.has("cultivation")||n.has("growth"))&&(t=["意志","体质"]);const a=["# 数值具体表现（按场景切片）"];for(const n of t)if("力量"===n){const n=e(o.strength,Number(b.力量??0));a.push(`- 力量(${n.value}): ${n.description}`)}else if("敏捷"===n){const n=e(o.agility,Number(b.敏捷??0));a.push(`- 敏捷(${n.value}): ${n.description}`)}else if("体质"===n){const n=e(o.constitution,Number(b.体质??0));a.push(`- 体质(${n.value}): ${n.description}`)}else if("意志"===n){const n=e(o.willpower,Number(b.意志??0));a.push(`- 意志(${n.value}): ${n.description}`)}else if("魅力"===n){const n=e(o.charisma,Number(b.魅力??0));a.push(`- 魅力(${n.value}): ${n.description}`)}else if("幸运"===n){const n=e(o.luck,Number(b.幸运??0));a.push(`- 幸运(${n.value}): ${n.description}`)}a.push("请在叙事中遵守以上具体表现，并在顶层JSON的 narrative_basis 字段如实标注。"),f.push(a.join("\n"))}const y=t?.系统?.联机||t?.onlineState;if("联机"===y?.模式&&y?.房间ID&&y?.穿越目标){const e=(await(0,a.XH)("onlineModeRules")).trim();e&&f.push(e);const n=(await(0,a.XH)("onlineTravelContext")).trim();n&&f.push(n);const t=(await(0,a.XH)("onlineWorldSync")).trim();t&&f.push(t);const r=(await(0,a.XH)("onlineInteraction")).trim();r&&f.push(r);const o=(await(0,a.XH)("onlineServerLogCommand")).trim();o&&f.push(o)}return f.map(e=>e.trim()).filter(Boolean).join("\n\n---\n\n")}},1514:e=>{"use strict";e.exports=Math.abs},1530:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23e5e7eb%27 d=%27M6 9L1 4h10z%27/%3E%3C/svg%3E"},1547:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.toast-container[data-v-25ec8c07] {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  z-index: 20000; /* 提高到比加载遮罩(10000)更高的层级 */\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 16px;\n}\n.toast[data-v-25ec8c07] {\n  display: flex;\n  align-items: center;\n  padding: 12px 20px;\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  color: var(--color-text);\n  background-color: var(--color-surface);\n  border: 1px solid var(--color-border);\n  min-width: 250px;\n  max-width: 400px;\n  margin-bottom: 8px;\n}\n.toast-icon[data-v-25ec8c07] {\n  margin-right: 12px;\n  font-size: 1.2rem;\n  display: flex;\n  align-items: center;\n}\n.toast-message[data-v-25ec8c07] {\n  word-break: break-word;\n  font-size: 0.95rem;\n  line-height: 1.4;\n}\n\n/* Toast Types */\n.toast-success[data-v-25ec8c07] {\n  border-left: 5px solid var(--color-success);\n}\n.toast-error[data-v-25ec8c07] {\n  border-left: 5px solid var(--color-error);\n}\n.toast-warning[data-v-25ec8c07] {\n  border-left: 5px solid var(--color-warning);\n}\n.toast-info[data-v-25ec8c07] {\n  border-left: 5px solid var(--color-info);\n}\n.toast-loading[data-v-25ec8c07] {\n  border-left: 5px solid var(--color-primary);\n}\n\n/* Spinner for loading */\n.spinner[data-v-25ec8c07] {\n  width: 20px;\n  height: 20px;\n  border: 3px solid rgba(128, 128, 128, 0.3);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-25ec8c07 1s linear infinite;\n}\n@keyframes spin-25ec8c07 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* Transitions */\n.toast-fade-enter-active[data-v-25ec8c07],\n.toast-fade-leave-active[data-v-25ec8c07] {\n  transition: all 0.5s ease;\n}\n.toast-fade-enter-from[data-v-25ec8c07],\n.toast-fade-leave-to[data-v-25ec8c07] {\n  opacity: 0;\n  transform: translateX(100%);\n}\n",""]);const s=i},1575:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-war[data-v-6b6d0227] {\n  display: flex;\n  height: 100%;\n  min-height: 0;\n  background: var(--color-background);\n}\n.war-shell[data-v-6b6d0227] {\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  padding: 10px;\n  box-sizing: border-box;\n}\n.war-header[data-v-6b6d0227] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 10px;\n  padding: 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 14px;\n  background: var(--color-surface);\n  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);\n}\n.title[data-v-6b6d0227] {\n  font-weight: 900;\n  letter-spacing: 0.02em;\n  font-size: 1.05rem;\n  color: var(--color-text);\n  font-family: var(--font-family-serif);\n}\n.subtitle[data-v-6b6d0227] {\n  margin-top: 4px;\n  color: var(--color-text-secondary);\n  font-size: 0.88rem;\n}\n.muted[data-v-6b6d0227] {\n  color: var(--color-text-secondary);\n}\n.small[data-v-6b6d0227] {\n  font-size: 0.82rem;\n}\n.notice[data-v-6b6d0227] {\n  display: flex;\n  gap: 8px;\n  align-items: flex-start;\n  padding: 10px 12px;\n  border-radius: 12px;\n  border: 1px solid rgba(251, 191, 36, 0.35);\n  background: rgba(251, 191, 36, 0.08);\n  color: #b45309;\n}\n.notice-body[data-v-6b6d0227] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.fix-box[data-v-6b6d0227] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  color: var(--color-text-secondary);\n}\n.fix-row[data-v-6b6d0227] {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n  align-items: center;\n}\n.fix-row .input[data-v-6b6d0227] {\n  flex: 1 1 220px;\n}\n.fix-row .select[data-v-6b6d0227] {\n  flex: 0 0 120px;\n}\n.war-body[data-v-6b6d0227] {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n}\n.start-panel[data-v-6b6d0227] {\n  display: grid;\n  grid-template-columns: 1.2fr 0.8fr;\n  gap: 10px;\n  align-items: start;\n}\n.war-panel[data-v-6b6d0227] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.grid[data-v-6b6d0227] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 10px;\n}\n.card[data-v-6b6d0227] {\n  border: 1px solid var(--color-border);\n  border-radius: 14px;\n  background: var(--color-surface);\n  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);\n  padding: 12px;\n}\n.card.slim[data-v-6b6d0227] {\n  padding: 12px;\n}\n.card-title[data-v-6b6d0227] {\n  font-weight: 900;\n  letter-spacing: 0.02em;\n  color: var(--color-text);\n  margin-bottom: 10px;\n}\n.field[data-v-6b6d0227] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  margin-bottom: 10px;\n}\n.label[data-v-6b6d0227] {\n  font-weight: 700;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.input[data-v-6b6d0227],\n.select[data-v-6b6d0227],\n.textarea[data-v-6b6d0227] {\n  width: 100%;\n  box-sizing: border-box;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  background: var(--color-background);\n  color: var(--color-text);\n  padding: 10px 12px;\n  font-size: 0.9rem;\n}\n.textarea[data-v-6b6d0227] {\n  min-height: 110px;\n  resize: vertical;\n  line-height: 1.6;\n}\n.hint-row[data-v-6b6d0227] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 8px;\n  font-size: 0.8rem;\n}\n.actions[data-v-6b6d0227] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n.btn[data-v-6b6d0227] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 10px;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.88rem;\n}\n.btn.primary[data-v-6b6d0227] {\n  border-color: rgba(59, 130, 246, 0.35);\n  background: rgba(59, 130, 246, 0.08);\n  color: #3b82f6;\n}\n.btn.danger[data-v-6b6d0227] {\n  border-color: rgba(239, 68, 68, 0.35);\n  background: rgba(239, 68, 68, 0.10);\n  color: #ef4444;\n}\n.btn[data-v-6b6d0227]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.btn[data-v-6b6d0227]:hover:not(:disabled) {\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n}\n.spin[data-v-6b6d0227] {\n  animation: spin-6b6d0227 0.9s linear infinite;\n}\n@keyframes spin-6b6d0227 {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n.tip-list[data-v-6b6d0227] {\n  display: grid;\n  gap: 8px;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.kv[data-v-6b6d0227] {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  padding: 8px 0;\n  border-bottom: 1px solid var(--color-border);\n}\n.kv[data-v-6b6d0227]:last-child {\n  border-bottom: none;\n}\n.kv .k[data-v-6b6d0227] {\n  color: var(--color-text-secondary);\n  font-size: 0.88rem;\n}\n.kv .v[data-v-6b6d0227] {\n  font-weight: 800;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.v.ok[data-v-6b6d0227] {\n  color: #22c55e;\n}\n.v.bad[data-v-6b6d0227] {\n  color: #ef4444;\n}\n.v.warn[data-v-6b6d0227] {\n  color: #f59e0b;\n}\n.v.mid[data-v-6b6d0227] {\n  color: var(--color-text);\n}\n.row[data-v-6b6d0227] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 8px;\n}\n.badge[data-v-6b6d0227] {\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 10px;\n  border-radius: 999px;\n  font-size: 0.78rem;\n  font-weight: 800;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n.badge.blue[data-v-6b6d0227] {\n  color: rgba(59, 130, 246, 0.95);\n  border-color: rgba(59, 130, 246, 0.30);\n  background: rgba(59, 130, 246, 0.08);\n}\n.badge.red[data-v-6b6d0227] {\n  color: rgba(239, 68, 68, 0.95);\n  border-color: rgba(239, 68, 68, 0.30);\n  background: rgba(239, 68, 68, 0.08);\n}\n.details[data-v-6b6d0227] {\n  border: 1px solid var(--color-border);\n  border-radius: 14px;\n  background: var(--color-surface);\n  padding: 10px 12px;\n}\n.summary[data-v-6b6d0227] {\n  cursor: pointer;\n  display: inline-flex;\n  gap: 8px;\n  align-items: center;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.detail-grid[data-v-6b6d0227] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n  margin-top: 10px;\n}\n.detail-card[data-v-6b6d0227] {\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-background);\n  padding: 10px;\n}\n.detail-title[data-v-6b6d0227] {\n  font-weight: 900;\n  margin-bottom: 8px;\n  color: var(--color-text);\n}\n.detail-line[data-v-6b6d0227] {\n  display: flex;\n  align-items: baseline;\n  justify-content: space-between;\n  gap: 8px;\n  padding: 6px 0;\n  border-bottom: 1px solid var(--color-border);\n  font-size: 0.88rem;\n}\n.detail-line[data-v-6b6d0227]:last-child {\n  border-bottom: none;\n}\n.detail-line .k[data-v-6b6d0227] {\n  color: var(--color-text-secondary);\n}\n.detail-line .v[data-v-6b6d0227] {\n  font-weight: 900;\n  color: var(--color-text);\n  white-space: nowrap;\n}\n.detail-line .note[data-v-6b6d0227] {\n  color: var(--color-text-secondary);\n  font-size: 0.78rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.stage-strip[data-v-6b6d0227] {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n  margin-bottom: 10px;\n}\n.stage-pill[data-v-6b6d0227] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text-secondary);\n  font-weight: 800;\n  font-size: 0.82rem;\n}\n.stage-pill.active[data-v-6b6d0227] {\n  color: rgba(59, 130, 246, 0.95);\n  border-color: rgba(59, 130, 246, 0.30);\n  background: rgba(59, 130, 246, 0.08);\n}\n.stage-pill.done[data-v-6b6d0227] {\n  color: rgba(34, 197, 94, 0.95);\n  border-color: rgba(34, 197, 94, 0.30);\n  background: rgba(34, 197, 94, 0.08);\n}\n.log-list[data-v-6b6d0227] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.log[data-v-6b6d0227] {\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-background);\n  padding: 10px;\n}\n.log-top[data-v-6b6d0227] {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.log-text[data-v-6b6d0227] {\n  line-height: 1.7;\n  color: var(--color-text);\n}\n.ai-summary[data-v-6b6d0227] {\n  margin-top: 10px;\n  border: 1px solid rgba(168, 85, 247, 0.25);\n  background: rgba(168, 85, 247, 0.06);\n  border-radius: 12px;\n  padding: 10px;\n}\n.ai-title[data-v-6b6d0227] {\n  font-weight: 900;\n  margin-bottom: 8px;\n  color: rgba(168, 85, 247, 0.95);\n}\n.ai-text[data-v-6b6d0227] {\n  color: var(--color-text);\n  line-height: 1.7;\n  white-space: pre-wrap;\n}\n.history-list[data-v-6b6d0227] {\n  display: grid;\n  gap: 8px;\n}\n.history-item[data-v-6b6d0227] {\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-background);\n  padding: 10px;\n}\n.history-top[data-v-6b6d0227] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 6px;\n}\n.history-top .name[data-v-6b6d0227] {\n  font-weight: 900;\n  color: var(--color-text);\n}\n@media (max-width: 920px) {\n.start-panel[data-v-6b6d0227] {\n    grid-template-columns: 1fr;\n}\n.grid[data-v-6b6d0227] {\n    grid-template-columns: 1fr;\n}\n.detail-grid[data-v-6b6d0227] {\n    grid-template-columns: 1fr;\n}\n}\n",""]);const s=i},1601:e=>{"use strict";e.exports=function(e){return e[1]}},1606:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"/* 统一的游戏面板主题样式 */\n\n/* === 面板基础容器 === */\n.game-panel {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  gap: 0.75rem;\n  position: relative;\n  font-family: var(--font-family-sans-serif);\n}\n\n/* === 面板头部 === */\n.panel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  flex-shrink: 0;\n  backdrop-filter: blur(10px);\n  margin: 0.5rem;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.header-icon {\n  font-size: 1.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2.5rem;\n  height: 2.5rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 50%;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n}\n\n.header-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.panel-title {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--color-text);\n  /* 防止标题在紧凑布局中撑破布局 */\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.panel-subtitle {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n\n.header-actions {\n  display: flex;\n  gap: 0.5rem;\n  /* 允许按钮自动换行，避免溢出 */\n  flex-wrap: wrap;\n  justify-content: flex-end;\n  max-width: 100%;\n}\n\n/* === 动作按钮 === */\n.action-btn {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  white-space: nowrap;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  flex-shrink: 0;\n}\n\n.action-btn svg {\n  flex-shrink: 0;\n  width: 16px;\n  height: 16px;\n}\n\n.action-btn .btn-text {\n  flex-shrink: 0;\n}\n\n.action-btn:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 4px rgba(var(--color-primary-rgb), 0.1);\n}\n\n.action-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n\n.action-btn.primary {\n  background: var(--color-primary);\n  color: #fff;\n  border-color: var(--color-primary);\n}\n\n.action-btn.primary:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n}\n\n.action-btn.secondary {\n  background: var(--color-accent);\n  color: #fff;\n  border-color: var(--color-accent);\n}\n\n.action-btn.secondary:hover {\n  background: var(--color-accent-hover);\n  border-color: var(--color-accent-hover);\n}\n\n.action-btn.danger {\n  border-color: var(--color-error);\n  color: var(--color-error);\n}\n\n.action-btn.danger:hover {\n  background: rgba(var(--color-error-rgb), 0.05);\n  border-color: var(--color-danger);\n  color: var(--color-danger);\n}\n\n.btn-icon {\n  flex-shrink: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* action-btn 内的文字不截断 */\n.action-btn .btn-text,\n.action-btn > span {\n  font-weight: 500;\n  white-space: nowrap;\n}\n\n/* === 内容区域 === */\n.panel-content {\n  flex: 1;\n  overflow-y: auto;\n  margin: 0 0.5rem 0.5rem 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: var(--scrollbar-thumb) transparent;\n}\n\n.panel-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.panel-content::-webkit-scrollbar-track {\n  background: rgba(var(--color-border-rgb), 0.1);\n  border-radius: 3px;\n}\n\n.panel-content::-webkit-scrollbar-thumb {\n  background: var(--scrollbar-thumb);\n  border-radius: 3px;\n  opacity: 0.6;\n}\n\n.panel-content::-webkit-scrollbar-thumb:hover {\n  opacity: 0.8;\n}\n\n/* === 筛选标签 === */\n.filter-section {\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  flex-shrink: 0;\n  margin: 0 0.5rem;\n}\n\n.filter-tabs {\n  display: flex;\n  gap: 0.5rem;\n  overflow-x: auto;\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n}\n\n.filter-tabs::-webkit-scrollbar {\n  display: none;\n}\n\n.filter-tab {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 1.5rem;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n  white-space: nowrap;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  flex-shrink: 0;\n}\n\n.filter-tab:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n}\n\n.filter-tab.active {\n  background: var(--color-primary);\n  color: var(--color-background);\n  border-color: var(--color-primary);\n}\n\n.tab-icon {\n  font-size: 1rem;\n}\n\n.tab-name {\n  font-weight: 500;\n}\n\n.tab-count {\n  font-size: 0.75rem;\n  background: rgba(255, 255, 255, 0.2);\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.75rem;\n  font-weight: 600;\n}\n\n.filter-tab.active .tab-count {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n/* === 网格布局 === */\n.items-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n  gap: 0.75rem;\n  padding: 0.5rem;\n}\n\n.currency-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n  gap: 0.75rem;\n}\n\n/* === 卡片样式 === */\n.item-card, .currency-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  position: relative;\n}\n\n.item-card:hover, .currency-item:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.1);\n}\n\n/* === 状态指示 === */\n.loading-state, .empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n\n.loading-spinner, .empty-icon {\n  font-size: 2rem;\n  margin-bottom: 0.5rem;\n}\n\n.loading-text, .empty-text {\n  font-size: 1rem;\n  margin: 0;\n}\n\n/* === 详情区域 === */\n.detail-section {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-top: 1rem;\n}\n\n.detail-header {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n\n.detail-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin: 0;\n}\n\n.detail-content {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.info-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 0.5rem;\n}\n\n.info-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  font-size: 0.875rem;\n}\n\n.info-label {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n\n.info-value {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* === 列表样式 === */\n.list-container {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.list-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  transition: var(--transition-fast);\n}\n\n.list-item:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n  transform: translateX(2px);\n}\n\n.list-item-content {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  flex: 1;\n}\n\n.list-item-title {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n\n.list-item-subtitle {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* === 进度条 === */\n.progress-container {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.progress-bar {\n  height: 6px;\n  background: rgba(var(--color-border-rgb), 0.3);\n  border-radius: 3px;\n  overflow: hidden;\n}\n\n.progress-fill {\n  height: 100%;\n  background: var(--color-primary);\n  border-radius: 3px;\n  transition: width 0.3s ease;\n}\n\n.progress-text {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* === 分割线 === */\n.section-divider {\n  height: 1px;\n  background: var(--color-border);\n  margin: 1rem 0;\n}\n\n/* === 响应式适配 === */\n@media (max-width: 640px) {\n  .game-panel {\n    gap: 0.5rem;\n  }\n\n  .panel-header {\n    padding: 0.5rem 0.75rem;\n    margin: 0.25rem;\n    /* 小屏时头部内容纵向排列，避免左右挤压 */\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem 0.5rem;\n  }\n\n  .filter-section {\n    padding: 0.5rem;\n    margin: 0 0.25rem;\n  }\n\n  .panel-content {\n    margin: 0 0.25rem 0.25rem 0.25rem;\n  }\n\n  .header-left {\n    min-width: 0;\n    flex: 1 1 auto;\n  }\n\n  .header-actions .btn-text {\n    display: none;\n  }\n\n  .header-actions {\n    /* 头部操作按钮独占一行并可换行 */\n    width: 100%;\n    justify-content: flex-start;\n    gap: 0.375rem;\n  }\n\n  .action-btn {\n    /* 移动端更紧凑的按钮尺寸 */\n    padding: 0.4rem 0.6rem;\n    font-size: 0.8125rem;\n    /* 移动端触摸优化 */\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    min-height: 36px;\n    min-width: 36px; /* 确保按钮有足够宽度显示图标 */\n  }\n\n  .items-grid {\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 0.5rem;\n  }\n\n  .info-grid {\n    grid-template-columns: 1fr;\n  }\n\n  /* 详情区域按钮在窄屏堆叠，避免溢出 */\n  .details-actions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n  }\n\n  .details-actions .action-btn,\n  .details-actions .dialog-btn,\n  .details-actions .operation-btn,\n  .details-actions .card-btn {\n    flex: 1 1 100%;\n    max-width: 100%;\n  }\n\n  /* 移动端列表项触摸优化 */\n  .list-item,\n  .item-card,\n  .currency-item,\n  .filter-tab {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n  }\n\n  /* 移动端文本自动换行 */\n  .panel-title,\n  .list-item-title,\n  .detail-title {\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    hyphens: auto;\n  }\n}\n\n/* === 中等屏幕适配 (平板) === */\n@media (min-width: 641px) and (max-width: 1024px) {\n  .game-panel {\n    gap: 0.65rem;\n  }\n\n  .panel-header {\n    padding: 0.625rem 0.875rem;\n  }\n\n  .action-btn {\n    padding: 0.45rem 0.7rem;\n    font-size: 0.85rem;\n  }\n\n  .items-grid {\n    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));\n  }\n\n  .info-grid {\n    grid-template-columns: 1fr 1fr;\n  }\n}\n\n/* === 特殊状态样式 === */\n.success-indicator {\n  color: var(--color-success);\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n}\n\n.warning-indicator {\n  color: var(--color-warning);\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-color: rgba(var(--color-warning-rgb), 0.3);\n}\n\n.error-indicator {\n  color: var(--color-error);\n  background: rgba(var(--color-error-rgb), 0.1);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n}\n\n.info-indicator {\n  color: var(--color-info);\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: rgba(var(--color-info-rgb), 0.3);\n}\n\n/* === 动画效果 === */\n@keyframes fadeInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.fade-in-up {\n  animation: fadeInUp 0.3s ease-out;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.pulse {\n  animation: pulse 2s infinite;\n}\n",""]);const s=i},1703:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.data-type-selector[data-v-2d9375b2] {\n  padding: 1rem;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n  gap: 0.75rem;\n  border-bottom: 1px solid var(--color-border);\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.data-type-selector[data-v-2d9375b2] {\n    grid-template-columns: 1fr 1fr;\n    gap: 0.5rem;\n    padding: 0.75rem;\n}\n}\n@media (max-width: 480px) {\n.data-type-selector[data-v-2d9375b2] {\n    gap: 0.4rem;\n    padding: 0.5rem;\n}\n}\n.type-btn[data-v-2d9375b2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  position: relative;\n  overflow: visible;\n  width: 100%;\n  justify-content: flex-start;\n  color: var(--color-text);\n  background: var(--color-background);\n}\n.type-btn[data-v-2d9375b2]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-primary-light);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.15);\n}\n.type-btn.active[data-v-2d9375b2] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.type-btn.active[data-v-2d9375b2]:hover,\n.type-btn.active[data-v-2d9375b2]:focus,\n.type-btn.active[data-v-2d9375b2]:focus-visible {\n  background: var(--color-primary-hover);\n  color: white;\n  border-color: var(--color-primary-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 6px 16px rgba(var(--color-primary-rgb), 0.25);\n}\n.type-btn svg[data-v-2d9375b2] {\n  color: inherit;\n}\n.type-btn[data-v-2d9375b2]:focus {\n  outline: none;\n}\n.type-btn[data-v-2d9375b2]:focus-visible {\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.25);\n  border-color: var(--color-primary);\n}\n.type-btn[data-v-2d9375b2]:active {\n  transform: translateY(0);\n  box-shadow: none;\n}\n.count-badge[data-v-2d9375b2] {\n  position: absolute;\n  top: -0.5rem;\n  right: -0.5rem;\n  background: var(--color-accent);\n  color: white;\n  font-size: 0.75rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 10px;\n  min-width: 1.25rem;\n  text-align: center;\n  z-index: 2;\n}\n\n/* 手机端按钮适配 */\n@media (max-width: 640px) {\n.type-btn[data-v-2d9375b2] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.8rem;\n    gap: 0.3rem;\n}\n.count-badge[data-v-2d9375b2] {\n    font-size: 0.7rem;\n    padding: 0.1rem 0.3rem;\n    min-width: 1rem;\n}\n}\n@media (max-width: 480px) {\n.type-btn[data-v-2d9375b2] {\n    padding: 0.35rem 0.5rem;\n    font-size: 0.75rem;\n    gap: 0.25rem;\n}\n.count-badge[data-v-2d9375b2] {\n    font-size: 0.65rem;\n    padding: 0.08rem 0.25rem;\n    min-width: 0.9rem;\n}\n}\n",""]);const s=i},1783:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},1875:(e,n,t)=>{"use strict";t.d(n,{gz:()=>i,js:()=>o});var a=t(9333),r=t(8546);async function o(){if(!(0,r.isBackendConfigured)())return;const e=localStorage.getItem("access_token");if(!e)return;const n=(0,r.mh)("/api/v1/presence/heartbeat");if(n)try{await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:"{}"})}catch{}}async function i(){return a.Em.get("/api/v1/presence/me")}},2077:(e,n,t)=>{"use strict";t.d(n,{GK:()=>a,Nz:()=>o,U5:()=>r,oi:()=>i,w3:()=>s});const a='\n[文本格式标记]\n允许标记:环境【...】|NPC内心`...`|对话"..."|判定〔...〕|其余纯文本\n符号区别:【】环境描写;〔〕判定结果\n示例:【杀气扑面】;〔战斗:成功,判定值:45,难度:35〕\n严禁:Markdown格式|星号*|下划线_|井号#|三反引号\n'.trim(),r='\n[判定系统]\n定位:AI是天道代言人,公正无情,玩家不是天选之人\n\n[判定格式]\n格式:〔类型:结果,判定值:数字,难度:数字,关键因素〕\n示例:〔战斗:成功,判定值:52,难度:45,觉醒阶段同级,装备优势〕\n禁止:占位符|省略字段\n\n[反媚俗]\n检验:换成路人甲结果一样吗?不一样就是作弊\n禁止:偏袒主角|轻描淡写失败|敌人突然变蠢|巧合救场|编造加成\n禁止神化:禁用"主角神化/天选之人/剧情护甲/无敌化";语言禁用"不可战胜/绝对权威/无法抗拒";结果必须由数据与判定决定\n\n[公式]\n最终判定值=基础+幸运+环境+状态;基础=属性加权+阶段加成+技艺加成\n属性权重:主×0.5+副×0.3+辅×0.2\n战斗攻击:力量/敏捷/幸运;战斗防御:力量/体质/敏捷;制作合成:意志/敏捷/体质;进化突破:意志/敏捷/体质;探索发现:幸运/敏捷/意志;社交说服:魅力/意志/体质;躲避逃跑:敏捷/幸运/力量\n觉醒等级:凡人0|觉醒1|掌控2|精通3|质变4|突破5|传说6;阶段:入门+0|适应+0.25|控制+0.5|稳定+0.75|深化+1\n对抗类阶段差:+3级+30|+2级+20|+1级+10|同级0|-1级-10|-2级-25|-3级自动失败\n非对抗类:凡人0|觉醒5|掌控12|精通20|质变30|突破60|传说90\n\n[难度与结果]\n难度基准:极易10|简单20|普通35|困难50|艰难70|极难90|逆天100+\n结果判定:大失败(判定值<难度-15)|失败(判定值<难度)|成功(判定值≥难度)|大成功(判定值≥难度+15)|完美(判定值≥难度+30)\n□ 大失败:重伤-50%生命值|材料全损|走火入魔|结死仇|进度倒退50%\n□ 失败:轻伤-15%|材料损耗|无进展|好感-5|进度倒退20%\n□ 成功:达成目的|正常收获\n□ 大成功:额外奖励|重创敌人|好感+10|进度+50%\n□ 完美:重大机缘|秒杀|好感+20|顿悟\n\n[何时判定]\n必须判定:战斗攻防|制造|成长突破|危险探索|社交博弈|躲避逃跑|偷窃欺骗\n无需判定:日常行为|高阶碾压(差3级+自动成功/失败)|纯叙事对话|已确定结果\n\n[状态修正]\n生命值充足(50%以上)无修正|生命值不足(25-50%)修正-5|生命值危急(25%以下)修正-15\n增益减益效果:按强度±1到±10,总计不超过±20\n环境:安全区+10|异常地带-10|绿区+5|黄区+3|橙区-2|红区-5|黑区-8\n'.trim(),o='\n[战斗伤害]\n伤害计算遵循衍生战斗数值:\n1) 物理伤害=max(1, 攻击方[物理攻击力] - 防御方[物理防御力])\n2) 特殊伤害=max(1, 攻击方[特殊攻击力] - 防御方[特殊防御力])\n3) 阶段差修正:若攻击方阶段≥防御方阶段+2 → 伤害×1.2~1.5;若攻击方阶段≤防御方阶段-2 → 伤害×0.7~0.9\n4) 成功等级修正:成功=×1.0;大成功=×1.3;完美=×1.6;失败或大失败=根据场景减半或自损\n5) 环境/状态叠加:异常地带/强力buff/debuff可±5~±20%额外修正\n\n[伤害结算输出格式]\n严格在〔判定〕后，用以下结构输出计算与结果：\n- 判定标记：〔战斗:结果,判定值:X,难度:Y,基础:...,幸运:+/-,环境:+/-,状态:+/-〕\n- 计算过程：基础伤害=...; 阶段系数=...; 成功系数=...; 环境/状态系数=...; 最终伤害=...\n- 数据更新：仅以 tavern_commands 更新数值（严禁在正文中写“当前状态/面板”）\n- tavern_commands 键路径规范：\n  - 玩家受伤：add 角色.属性.生命值.当前（负数）\n  - NPC受伤：add 社交.关系.[NPC名].属性.生命值.当前（负数）\n  - 施法/技能消耗：add 角色.属性.精神力.当前（负数）\n  - 持续动作/闪避消耗：add 角色.属性.体力.当前（负数）\n  - 理智变化：add 角色.属性.理智值.当前（可正可负）\n  - 添加状态效果：push 角色.效果（buff/debuff，含持续时间与强度）\n  - 非NPC生物（突变生物/世界生物）：add 世界.信息.生物.<索引>.attributes.hp.current（负数）\n  - 死亡同步：当生命值.当前≤0，必须同步当前状态（实时）\n    □ NPC死亡：set 社交.关系.[NPC名].当前外貌状态（值：无生命迹象（死亡））\n    □ 玩家死亡：set 角色.当前外貌状态（值：无生命迹象（死亡））\n    □ 记录事件：push 社交.事件.事件记录（简述死亡原因/时间）\n\n[✅/❌示例（严格遵守）]\n- ✅ 玩家受伤：{"action":"add","key":"角色.属性.生命值.当前","value":-12}\n- ✅ NPC受伤：{"action":"add","key":"社交.关系.沼泽猎人.属性.生命值.当前","value":-18}\n- ✅ 突变生物受伤：{"action":"add","key":"世界.信息.生物.0.attributes.hp.current","value":-21}\n- ✅ 推进时间：{"action":"add","key":"元数据.时间.分钟","value":30}\n- ❌ 错误：{"action":"add","key":"角色.背包.物品","value":{...}}（禁止对角色.背包.物品使用 add）\n- ❌ 错误：{"action":"set","key":"元数据.时间","value":{...}}（禁止整体 set 元数据.时间；请使用 add 元数据.时间.分钟）\n - ✅ NPC死亡：{"action":"set","key":"社交.关系.红沼守卫.当前外貌状态","value":"无生命迹象（死亡）"}\n - ✅ 玩家死亡：{"action":"set","key":"角色.当前外貌状态","value":"无生命迹象（死亡）"}\n - ❌ 错误：将“当前”直接重置为“上限”（禁止重置为满值，必须按伤害进行add）\n\n[数值边界]⚠️\n- 所有“当前”值必须保持在[0, 上限]范围内\n- 计算将低于0时写为0并附加相应负面状态(力竭/疯狂/濒死)\n\n[计算示例]\n例1：物理攻击（成功）\n- 攻击方物理攻=28，防御方物理防=19 → 基础伤害=max(1,28-19)=9\n- 阶段差：攻击方掌控期(1) vs 防御方觉醒期(0) → ×1.1\n- 成功等级：成功 → ×1.0\n- 环境/状态：红区-5%，敌方虚弱+10% → ×1.05\n- 最终伤害=round(9×1.1×1.0×1.05)=10\n- 数据更新：{"action":"add","key":"社交.关系.红沼守卫.属性.生命值.当前","value":-10}\n\n例2：特殊攻击（大成功）\n- 攻击方特殊攻=34，防御方特殊防=16 → 基础伤害=max(1,34-16)=18\n- 阶段差：同级 → ×1.0\n- 成功等级：大成功 → ×1.3\n- 环境/状态：异常地带-10% → ×0.9\n- 最终伤害=round(18×1.0×1.3×0.9)=21\n- 数据更新：{"action":"add","key":"角色.属性.精神力.当前","value":-6}; {"action":"add","key":"社交.关系.黑巢流亡者.属性.生命值.当前","value":-21}\n\n例3：与突变生物交战（成功）\n- 攻击方物理攻=26，防御方物理防=14 → 基础伤害=max(1,26-14)=12\n- 阶段差：同级 → ×1.0\n- 成功等级：成功 → ×1.0\n- 环境/状态：红区-5% → ×0.95\n- 最终伤害=round(12×1.0×1.0×0.95)=11\n- 数据更新：{"action":"add","key":"世界.信息.生物.0.attributes.hp.current","value":-11}\n'.trim(),i='\n[命名约定]\n物品ID:类型_时间戳_随机数;位置:地区·地标·细节;品质:{quality:"破损"|"粗糙"|"普通"|"精良"|"稀有"|"史诗"|"传说",grade:0-10}\n'.trim(),s='\n[NSFW细节描写]\n参考：参考成人小说的用词及描写方式\n必须包含:神态与表情(眼神/呼吸/声线)|行为动作链条(起手-互动-反馈)|身体细节(皮肤/触感/姿态/体征变化)|双方反应与节奏(停顿/加速/后退)\n标记使用:对话"..."|内心`...`|环境【...】|判定〔...〕;细节嵌入叙事,禁止系统提示类标题/列点堆叠\n边界遵循:参考PrivacyProfile的安全偏好/禁忌/亲密节奏;越界尝试→拒绝/回避/协商/强制压制,并更新后果\n'.trim()},2094:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.event-panel[data-v-751578b8] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n.event-toolbar[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 10px 12px;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.title[data-v-751578b8] {\n  display: flex;\n  align-items: baseline;\n  gap: 8px;\n}\n.title-text[data-v-751578b8] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.meta[data-v-751578b8] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.tool-btn[data-v-751578b8] {\n  padding: 6px 10px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tool-btn[data-v-751578b8]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.toolbar-actions[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.tool-btn.subtle[data-v-751578b8] {\n  color: var(--color-text-secondary);\n}\n\n/* 配置区域 */\n.config-section[data-v-751578b8] {\n  padding: 12px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  max-height: 70vh;\n  overflow-y: auto;\n}\n\n/* 配置分组 */\n.config-group[data-v-751578b8] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.group-title[data-v-751578b8] {\n  font-weight: 700;\n  font-size: 0.95rem;\n  color: var(--color-text);\n  padding-bottom: 6px;\n  border-bottom: 2px solid var(--color-primary);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.add-btn[data-v-751578b8] {\n  padding: 4px 10px;\n  font-size: 0.85rem;\n  border-radius: 6px;\n  border: 1px solid var(--color-primary);\n  background: var(--color-primary);\n  color: white;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.add-btn[data-v-751578b8]:hover {\n  opacity: 0.9;\n  transform: translateY(-1px);\n}\n.config-item[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 8px 10px;\n  border-radius: 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n}\n.config-item-full[data-v-751578b8] {\n  flex-direction: column;\n  align-items: stretch;\n}\n.config-label[data-v-751578b8] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  flex: 1;\n}\n.label-text[data-v-751578b8] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.label-hint[data-v-751578b8] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.config-input[data-v-751578b8] {\n  width: 100px;\n  padding: 6px 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.config-input[data-v-751578b8]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.config-textarea[data-v-751578b8] {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.9rem;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 60px;\n  margin-top: 6px;\n}\n.config-textarea[data-v-751578b8]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.config-textarea[data-v-751578b8]::placeholder {\n  color: var(--color-text-muted);\n}\n\n/* 事件类型网格 */\n.event-types-grid[data-v-751578b8] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n  gap: 8px;\n  margin-top: 8px;\n}\n.event-type-item[data-v-751578b8] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 8px 10px;\n  transition: all 0.2s ease;\n}\n.event-type-item[data-v-751578b8]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-hover);\n}\n.event-type-label[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n}\n.event-type-label input[type="checkbox"][data-v-751578b8] {\n  cursor: pointer;\n}\n.event-type-name[data-v-751578b8] {\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n\n/* 滑块样式 */\n.config-slider[data-v-751578b8] {\n  width: 100%;\n  height: 6px;\n  border-radius: 3px;\n  background: var(--color-border);\n  outline: none;\n  margin-top: 8px;\n  cursor: pointer;\n}\n.config-slider[data-v-751578b8]::-webkit-slider-thumb {\n  appearance: none;\n  width: 18px;\n  height: 18px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.config-slider[data-v-751578b8]::-webkit-slider-thumb:hover {\n  transform: scale(1.2);\n}\n.config-slider[data-v-751578b8]::-moz-range-thumb {\n  width: 18px;\n  height: 18px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  cursor: pointer;\n  border: none;\n  transition: all 0.2s ease;\n}\n.config-slider[data-v-751578b8]::-moz-range-thumb:hover {\n  transform: scale(1.2);\n}\n\n/* 自定义事件列表 */\n.custom-events-list[data-v-751578b8] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.custom-event-item[data-v-751578b8] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 10px;\n  transition: all 0.2s ease;\n}\n.custom-event-item[data-v-751578b8]:hover {\n  border-color: var(--color-primary);\n}\n.custom-event-header[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 6px;\n}\n.custom-event-checkbox[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  flex: 1;\n}\n.custom-event-checkbox input[type="checkbox"][data-v-751578b8] {\n  cursor: pointer;\n}\n.custom-event-name[data-v-751578b8] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.custom-event-actions[data-v-751578b8] {\n  display: flex;\n  gap: 6px;\n}\n.icon-btn[data-v-751578b8] {\n  padding: 4px 8px;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  font-size: 1rem;\n  transition: all 0.2s ease;\n  border-radius: 4px;\n}\n.icon-btn[data-v-751578b8]:hover {\n  background: var(--color-surface-hover);\n  transform: scale(1.1);\n}\n.custom-event-info[data-v-751578b8] {\n  display: flex;\n  gap: 8px;\n  font-size: 0.8rem;\n}\n.custom-event-type[data-v-751578b8],\n.custom-event-level[data-v-751578b8] {\n  padding: 2px 8px;\n  border-radius: 4px;\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-751578b8] {\n  padding: 12px;\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  background: var(--color-surface);\n  border: 1px dashed var(--color-border);\n  border-radius: 8px;\n}\n\n/* 弹窗样式 */\n.modal-overlay[data-v-751578b8] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  padding: 20px;\n}\n.modal-content[data-v-751578b8] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  width: 100%;\n  max-width: 500px;\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n}\n.modal-header[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-header h3[data-v-751578b8] {\n  margin: 0;\n  font-size: 1.1rem;\n  color: var(--color-text);\n}\n.close-btn[data-v-751578b8] {\n  padding: 4px 8px;\n  border: none;\n  background: transparent;\n  font-size: 1.5rem;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n  border-radius: 4px;\n}\n.close-btn[data-v-751578b8]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-751578b8] {\n  padding: 20px;\n  overflow-y: auto;\n  flex: 1;\n}\n.form-item[data-v-751578b8] {\n  margin-bottom: 16px;\n}\n.form-item label[data-v-751578b8] {\n  display: block;\n  margin-bottom: 6px;\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.form-item input[type="text"][data-v-751578b8],\n.form-item select[data-v-751578b8],\n.form-item textarea[data-v-751578b8] {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.9rem;\n  font-family: inherit;\n}\n.form-item input[data-v-751578b8]:focus,\n.form-item select[data-v-751578b8]:focus,\n.form-item textarea[data-v-751578b8]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.form-item textarea[data-v-751578b8] {\n  resize: vertical;\n  min-height: 80px;\n}\n.modal-footer[data-v-751578b8] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  padding: 16px 20px;\n  border-top: 1px solid var(--color-border);\n}\n.cancel-btn[data-v-751578b8],\n.confirm-btn[data-v-751578b8] {\n  padding: 8px 16px;\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s ease;\n}\n.cancel-btn[data-v-751578b8] {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n.cancel-btn[data-v-751578b8]:hover {\n  background: var(--color-surface-hover);\n}\n.confirm-btn[data-v-751578b8] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.confirm-btn[data-v-751578b8]:hover {\n  opacity: 0.9;\n  transform: translateY(-1px);\n}\n\n/* 开关样式 */\n.toggle-switch[data-v-751578b8] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n  flex-shrink: 0;\n}\n.toggle-switch input[data-v-751578b8] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.toggle-slider[data-v-751578b8] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.toggle-slider[data-v-751578b8]:before {\n  position: absolute;\n  content: \'\';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .toggle-slider[data-v-751578b8] {\n  background-color: var(--color-primary);\n}\ninput:checked + .toggle-slider[data-v-751578b8]:before {\n  transform: translateX(20px);\n}\n.config-actions[data-v-751578b8] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  margin-top: 4px;\n}\n.action-btn[data-v-751578b8] {\n  padding: 6px 12px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.85rem;\n  transition: all 0.2s ease;\n}\n.action-btn[data-v-751578b8]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.event-list[data-v-751578b8] {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n  padding: 12px;\n}\n.empty-state[data-v-751578b8] {\n  padding: 18px;\n  border: 1px dashed var(--color-border);\n  border-radius: 12px;\n  background: var(--color-surface);\n}\n.empty-title[data-v-751578b8] {\n  font-weight: 600;\n  margin-bottom: 6px;\n}\n.empty-hint[data-v-751578b8] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.event-item[data-v-751578b8] {\n  padding: 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-surface);\n  margin-bottom: 10px;\n}\n.event-header[data-v-751578b8] {\n  display: grid;\n  grid-template-columns: auto 1fr auto auto;\n  gap: 10px;\n  align-items: baseline;\n  margin-bottom: 8px;\n}\n.event-actions[data-v-751578b8] {\n  display: flex;\n  justify-content: flex-end;\n}\n.event-delete-btn[data-v-751578b8] {\n  color: var(--color-text-secondary);\n}\n.event-delete-btn[data-v-751578b8]:hover {\n  color: var(--color-error);\n  background: rgba(239, 68, 68, 0.08);\n}\n.event-type[data-v-751578b8] {\n  font-size: 0.78rem;\n  color: var(--color-primary);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.35);\n  padding: 2px 8px;\n  border-radius: 999px;\n  white-space: nowrap;\n}\n.event-name[data-v-751578b8] {\n  font-weight: 700;\n  color: var(--color-text);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.event-time[data-v-751578b8] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.event-desc[data-v-751578b8] {\n  color: var(--color-text);\n  line-height: 1.55;\n  white-space: pre-wrap;\n}\n\n/* 事件元信息 */\n.event-meta[data-v-751578b8] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-bottom: 8px;\n}\n.meta-tag[data-v-751578b8] {\n  font-size: 0.75rem;\n  padding: 2px 8px;\n  border-radius: 4px;\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n}\n.meta-tag.level-轻微[data-v-751578b8] {\n  background: rgba(34, 197, 94, 0.15);\n  color: #22c55e;\n}\n.meta-tag.level-中等[data-v-751578b8] {\n  background: rgba(234, 179, 8, 0.15);\n  color: #eab308;\n}\n.meta-tag.level-重大[data-v-751578b8] {\n  background: rgba(249, 115, 22, 0.15);\n  color: #f97316;\n}\n.meta-tag.level-灾难[data-v-751578b8] {\n  background: rgba(239, 68, 68, 0.15);\n  color: #ef4444;\n}\n.meta-tag.scope[data-v-751578b8] {\n  background: rgba(59, 130, 246, 0.12);\n  color: #3b82f6;\n}\n.meta-tag.source[data-v-751578b8] {\n  background: rgba(139, 92, 246, 0.12);\n  color: #8b5cf6;\n}\n\n/* 相关人物/势力 */\n.event-relations[data-v-751578b8] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px;\n  margin-bottom: 8px;\n  font-size: 0.82rem;\n}\n.relation-group[data-v-751578b8] {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 4px;\n}\n.relation-label[data-v-751578b8] {\n  color: var(--color-text-secondary);\n}\n.relation-item[data-v-751578b8] {\n  padding: 1px 6px;\n  border-radius: 4px;\n  font-size: 0.78rem;\n}\n.relation-item.person[data-v-751578b8] {\n  background: rgba(236, 72, 153, 0.12);\n  color: #ec4899;\n}\n.relation-item.faction[data-v-751578b8] {\n  background: rgba(20, 184, 166, 0.12);\n  color: #14b8a6;\n}\n',""]);const s=i},2271:(e,n,t)=>{"use strict";var a=t(453),r=t(6556),o=t(8859),i=t(507),s=t(9675),l=a("%WeakMap%",!0),c=r("WeakMap.prototype.get",!0),d=r("WeakMap.prototype.set",!0),u=r("WeakMap.prototype.has",!0),p=r("WeakMap.prototype.delete",!0);e.exports=l?function(){var e,n,t={assert:function(e){if(!t.has(e))throw new s("Side channel does not contain "+o(e))},delete:function(t){if(l&&t&&("object"==typeof t||"function"==typeof t)){if(e)return p(e,t)}else if(i&&n)return n.delete(t);return!1},get:function(t){return l&&t&&("object"==typeof t||"function"==typeof t)&&e?c(e,t):n&&n.get(t)},has:function(t){return l&&t&&("object"==typeof t||"function"==typeof t)&&e?u(e,t):!!n&&n.has(t)},set:function(t,a){l&&t&&("object"==typeof t||"function"==typeof t)?(e||(e=new l),d(e,t,a)):i&&(n||(n=i()),n.set(t,a))}};return t}:i},2347:(e,n,t)=>{"use strict";t.d(n,{U:()=>p});var a=t(8651),r=t(4191);const o={觉醒初期:5,觉醒中期:8,觉醒后期:12,觉醒圆满:15,觉醒极境:18,觉醒期:10,掌控初期:20,掌控中期:25,掌控后期:30,掌控圆满:35,掌控极境:40,掌控期:25,精通初期:45,精通中期:52,精通后期:60,精通圆满:68,精通极境:75,精通期:55,质变初期:80,质变中期:88,质变后期:95,质变圆满:102,质变极境:110,质变期:90,突破初期:115,突破中期:125,突破后期:135,突破圆满:145,突破极境:155,突破期:130,传说初期:160,传说中期:180,传说后期:200,传说圆满:220,半神初期:240,半神中期:270,半神后期:300,半神圆满:330,神灾初期:350,神灾中期:380,神灾后期:400},i={武装势力:1,正规军:1,掠夺者集团:1.1,狂厄帮派:1.1,家族势力:.9,财阀家族:.9,贸易联盟:.7,商业联合体:.7,中立组织:.85,幸存者营地:.75,科研机构:.8};function s(e){let n=0;const t=e.最强觉醒阶段||e.首领觉醒阶段||"";n=o[t]?o[t]:t.includes("觉醒")?10:t.includes("掌控")?25:t.includes("精通")?55:t.includes("质变")?90:t.includes("突破")?130:t.includes("传说")||t.includes("炼虚")?175:t.includes("半神")||t.includes("合体")?235:t.includes("神灾")||t.includes("渡劫")?325:t.includes("练气")?10:t.includes("筑基")?25:t.includes("金丹")?55:t.includes("元婴")?90:t.includes("化神")?130:20;const a=e.核心成员数量||0,r=(e.精英成员数量||0)+(e.正式成员数量||0)+(e.外围成员数量||0);let i=0;i+=a>=50?15:a>=30?12:a>=20?10:a>=10?7:a>=5?4:Math.max(0,a),i+=r>=1e4?10:r>=5e3?8:r>=2e3?6:r>=1e3?4:r>=500?2:Math.max(0,Math.floor(r/250));let s=0;s=e.等级.includes("霸主")||e.等级.includes("超级")?10:e.等级.includes("大型")||e.等级.includes("一流")?7:e.等级.includes("中型")||e.等级.includes("二流")?4:e.等级.includes("小型")||e.等级.includes("三流")?2:0;let l=0;l=e.类型.includes("掠夺")||e.类型.includes("魔道")||e.类型.includes("狂厄")?3:e.类型.includes("武装")||e.类型.includes("正规")||e.类型.includes("修仙宗门")?1:e.类型.includes("家族")||e.类型.includes("财阀")?-1:e.类型.includes("贸易")||e.类型.includes("商会")?-3:e.类型.includes("营地")||e.类型.includes("散修")?-2:0;let c=n+i+s+l;return t.includes("神灾")||t.includes("渡劫")?c=Math.max(c,85):t.includes("半神")||t.includes("合体")?c=Math.max(c,75):t.includes("传说")||t.includes("炼虚")?c=Math.max(c,65):(t.includes("突破")||t.includes("化神"))&&(c=Math.max(c,55)),Math.min(100,Math.max(1,Math.round(c)))}function l(e){let n=5;n=e.等级.includes("霸主")||e.等级.includes("超级")?25:e.等级.includes("大型")||e.等级.includes("一流")?20:e.等级.includes("中型")||e.等级.includes("二流")?15:e.等级.includes("小型")||e.等级.includes("三流")?10:5;let t=1;for(const n in i)if(e.类型.includes(n)){t=i[n];break}let a=0;const r=e.核心成员数量||0;r>=10?a+=3:r>=5?a+=2:r>=3&&(a+=1);const o=.8+.4*Math.random(),s=Math.round((n*t+a)*o);return Math.min(30,Math.max(0,s))}var c=t(4459),d=t(758),u=t(7445);class p{config;previousErrors=[];originalConfig;constructor(e){this.config=e,this.originalConfig={factionCount:e.factionCount,locationCount:e.locationCount,secretRealmsCount:e.secretRealmsCount,continentCount:e.continentCount}}async generateValidatedWorld(){for(let e=0;e<=this.config.maxRetries;e++)try{e>0&&(await new Promise(n=>setTimeout(n,this.config.retryDelay*e)),this.reduceCountsForRetry(e));const n=await this.generateWorldData(),t=this.validateWorldData(n);if(t.isValid)return{success:!0,worldInfo:n};this.previousErrors=t.errors.map(e=>e.message)}catch(e){const n=e instanceof Error?e.message:String(e);this.previousErrors=[n]}return{success:!1,errors:this.previousErrors}}reduceCountsForRetry(e){const n=Math.pow(.8,e);0!==this.originalConfig.factionCount?(this.config.factionCount=Math.max(3,Math.floor(this.originalConfig.factionCount*n)),this.config.locationCount=Math.max(5,Math.floor(this.originalConfig.locationCount*n)),this.config.secretRealmsCount=Math.max(2,Math.floor(this.originalConfig.secretRealmsCount*n)),this.config.continentCount=Math.max(2,Math.floor(this.originalConfig.continentCount*n))):this.config.continentCount=Math.max(2,Math.floor(this.originalConfig.continentCount*n))}async generateWorldData(){const e=(0,a.getTavernHelper)();if(!e)throw new Error("AI服务未初始化，请在设置中配置AI服务");const n=await this.buildPromptWithErrors(),t=u.aiService.isForceJsonEnabled("world_generation");console.log("[世界生成] 强JSON模式:",t);try{const a=[{role:"user",content:n},{role:"user",content:"请根据上述要求生成完整的世界数据JSON。"}],r=await e.generateRaw({ordered_prompts:a,should_stream:!1!==this.config.useStreaming,usageType:"world_generation",overrides:{world_info_before:"",world_info_after:""},onStreamChunk:e=>{this.config.onStreamChunk&&this.config.onStreamChunk(e)}});let o;o=r&&"object"==typeof r&&"text"in r?r.text:"string"==typeof r?r:String(r),console.log("[世界生成] 响应长度:",o?.length||0);const i=this.parseAIResponse(o,t);return this.convertToWorldInfo(i)}catch(e){const n=e instanceof Error?e.message:String(e);throw new Error(`AI生成失败: ${n}`)}}async buildPromptWithErrors(){return await this.buildPrompt()}async buildPrompt(){const e=await c.e.get("worldGeneration"),{factionCount:n,locationCount:t,secretRealmsCount:a,continentCount:o}=this.originalConfig,i={factionCount:n,totalLocations:t,secretRealms:a,continentCount:o,characterBackground:this.config.characterBackground,worldBackground:this.config.worldBackground,worldEra:this.config.worldEra,worldName:this.config.worldName,mapConfig:this.config.mapConfig};let s=r.c.buildPrompt(i);if((this.config.existingFactions?.length||this.config.existingLocations?.length)&&(s+="\n\n【已有地点势力（禁止重叠）】\n新生成的地点和势力必须避开以下已有位置，坐标不能重叠：",this.config.existingFactions?.length&&(s+=`\n已有势力：\n${this.config.existingFactions.map(e=>`- ${e.名称}${e.位置?`(位置:${JSON.stringify(e.位置)})`:""}`).join("\n")}`),this.config.existingLocations?.length&&(s+=`\n已有地点：\n${this.config.existingLocations.map(e=>`- ${e.名称}${e.coordinates?`(坐标:x=${e.coordinates.x},y=${e.coordinates.y})`:""}`).join("\n")}`)),e&&e.trim()){const n=await c.e.loadAll();if(n.worldGeneration?.modified)return e}return s}parseAIResponse(e,n=!1){try{let t=e.replace(/<thinking>[\s\S]*?<\/thinking>/gi,"");t=t.replace(/<thinking>[\s\S]*/gi,""),console.log("[世界生成] 清理thinking后长度:",t?.length||0);const a=(0,d.$6)(t.trim(),n),r=a.world_data&&"object"==typeof a.world_data?a.world_data:a;return{continents:Array.isArray(r.continents)?r.continents:[],factions:Array.isArray(r.factions)?r.factions:[],locations:Array.isArray(r.locations)?r.locations:[]}}catch(n){const t=n instanceof Error?n.message:String(n);throw console.error("[世界生成] JSON解析失败:",t),console.error("[世界生成] 原始响应前1000字符:",e?.substring(0,1e3)),new Error(`JSON解析失败: ${t}`)}}convertToWorldInfo(e){return{世界名称:this.config.worldName||e.world_name||e.worldName||"修仙界",世界背景:this.config.worldBackground||e.world_background||e.worldBackground||"",大陆信息:(e.continents||[]).map(e=>({名称:e.名称||e.name||"未名大陆",描述:e.描述||e.description||"一片神秘的修仙大陆，灵气充沛，势力林立",地理特征:e.terrain_features||e.地理特征||[],修真环境:e.cultivation_environment||e.修真环境||"灵气充沛，适宜修行",气候:e.climate||e.气候||"四季分明，温和宜人",天然屏障:e.natural_barriers||e.天然屏障||[],大洲边界:e.continent_bounds||e.大洲边界||[]})),势力信息:(e.factions||[]).map(e=>{const n={名称:e.name||e.名称,类型:e.type||e.类型||"武装势力",等级:e.level||e.等级||"三流",首领觉醒阶段:e.leadership?.宗主修为,最强觉醒阶段:e.leadership?.最强修为,核心成员数量:e.memberCount?.byPosition?.长老||0,精英成员数量:e.leadership?.核心弟子数,正式成员数量:e.leadership?.内门弟子数,外围成员数量:e.leadership?.外门弟子数},t={声望值:l(a=n),综合战力:s(a)};var a;const r=e.leadership?{宗主:e.leadership.宗主,宗主修为:e.leadership.宗主修为,副宗主:e.leadership.副宗主??void 0,太上长老:e.leadership.太上长老??void 0,太上长老修为:e.leadership.太上长老修为??void 0,最强修为:e.leadership.最强修为||e.leadership.宗主修为,综合战力:t.综合战力,核心弟子数:e.leadership.核心弟子数,内门弟子数:e.leadership.内门弟子数,外门弟子数:e.leadership.外门弟子数}:void 0,o=e.memberCount?{total:Number(e.memberCount.total)||0,byRealm:e.memberCount.byRealm||{},byPosition:e.memberCount.byPosition||{}}:void 0,i=e.territoryInfo?{controlledAreas:e.territoryInfo.controlledAreas||[],influenceRange:e.territoryInfo.influenceRange,strategicValue:e.territoryInfo.strategicValue}:void 0;return{名称:e.name||e.名称,类型:e.type||e.类型,等级:e.level||e.等级,位置:e.location||e.headquarters||e.位置,势力范围:e.territory||e.territory_bounds||e.势力范围||[],描述:e.description||e.描述,特色:e.specialties||e.features||e.特色||[],与玩家关系:e.与玩家关系||"中立",声望值:t.声望值,领导层:r,leadership:r,成员数量:o?{总数:o.total,按觉醒阶段:o.byRealm,按职位:o.byPosition,...o}:void 0,memberCount:o,势力范围详情:i?{控制区域:i.controlledAreas,影响范围:i.influenceRange,战略价值:i.strategicValue}:void 0,territoryInfo:i,可否加入:void 0===e.canJoin||!!e.canJoin,canJoin:void 0===e.canJoin||!!e.canJoin,加入条件:e.joinRequirements||[],joinRequirements:e.joinRequirements||[],加入好处:e.benefits||[],benefits:e.benefits||[]}}),地点信息:(e.locations||[]).map(e=>({名称:e.name||e.名称,类型:e.type||e.类型,位置:e.位置,coordinates:e.coordinates||e.坐标,描述:e.description||e.描述,特色:e.features||e.特色,安全等级:e.safety_level||e.danger_level||e.安全等级||"较安全",开放状态:e.status||e.开放状态||"开放",相关势力:e.related_factions||e.相关势力||[],特殊功能:e.special_functions||e.特殊功能||[]})),地图配置:this.config.mapConfig||e.地图配置||e.map_config||{width:1e4,height:1e4,minLng:0,maxLng:1e4,minLat:0,maxLat:1e4},生成时间:(new Date).toISOString(),世界纪元:this.config.worldEra||e.world_era||"混沌纪元",特殊设定:e.special_settings||[],版本:"2.0-Enhanced"}}validateWorldData(e){const n={isValid:!0,errors:[]};return this.performCustomValidation(e,n),n.isValid||(this.previousErrors=n.errors.map(e=>e.message)),n}performCustomValidation(e,n){const t=e.势力信息.map(e=>e.名称),a=new Set(t);t.length!==a.size&&n.errors.push({path:"势力信息.名称",message:"势力名称存在重复",expected:"所有名称唯一",received:"存在重复名称"});const r=e.地点信息.map(e=>e.名称),o=new Set(r);r.length!==o.size&&n.errors.push({path:"地点信息.名称",message:"地点名称存在重复",expected:"所有名称唯一",received:"存在重复名称"}),this.config.worldName&&e.世界名称!==this.config.worldName&&n.errors.push({path:"世界名称",message:"世界名称必须与玩家选择一致",expected:this.config.worldName,received:e.世界名称}),n.isValid=0===n.errors.length}}},2456:(e,n,t)=>{"use strict";t.d(n,{l:()=>s});const a=30,r=12,o=24,i=60;function s(e){let{年:n,月:t,日:s,小时:l,分钟:c}=e;for(c>=i&&(l+=Math.floor(c/i),c%=i),l>=o&&(s+=Math.floor(l/o),l%=o);s>a;)t+=1,s-=a;return t>r&&(n+=Math.floor((t-1)/r),t=(t-1)%r+1),{年:n,月:t,日:s,小时:l,分钟:c}}},2497:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.cloud-sync-button[data-v-5cceb5b0] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.cloud-sync-button[data-v-5cceb5b0]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.sync-text[data-v-5cceb5b0] {\n  font-weight: 500;\n}\n.sync-icon[data-v-5cceb5b0] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n\n/* 已同步状态样式 */\n.cloud-sync-button.synced[data-v-5cceb5b0] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-success-rgb), 0.1));\n  border-color: var(--color-success);\n  color: var(--color-success);\n}\n.cloud-sync-button[data-v-5cceb5b0]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.cloud-sync-button.synced[data-v-5cceb5b0]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.2), rgba(var(--color-success-rgb), 0.2));\n}\n\n/* Size variants */\n.cloud-sync-button.small[data-v-5cceb5b0] {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.9rem;\n  min-width: 100px;\n}\n.cloud-sync-button.large[data-v-5cceb5b0] {\n  padding: 1rem 1.5rem;\n  font-size: 1.1rem;\n  min-width: 180px;\n}\n\n/* Compact variant */\n.cloud-sync-button.compact[data-v-5cceb5b0] {\n  min-width: auto;\n  padding: 0.5rem;\n}\n.cloud-sync-button.compact .sync-text[data-v-5cceb5b0] {\n  display: none;\n}\n",""]);const s=i},2543:function(e,n,t){var a;e=t.nmd(e),function(){var r,o="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",l=32,c=128,d=1/0,u=9007199254740991,p=NaN,v=4294967295,f=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",l],["partialRight",64],["rearg",256]],h="[object Arguments]",m="[object Array]",g="[object Boolean]",b="[object Date]",y="[object Error]",x="[object Function]",k="[object GeneratorFunction]",w="[object Map]",_="[object Number]",C="[object Object]",A="[object Promise]",S="[object RegExp]",L="[object Set]",E="[object String]",T="[object Symbol]",I="[object WeakMap]",R="[object ArrayBuffer]",M="[object DataView]",P="[object Float32Array]",D="[object Float64Array]",z="[object Int8Array]",N="[object Int16Array]",$="[object Int32Array]",O="[object Uint8Array]",F="[object Uint8ClampedArray]",j="[object Uint16Array]",B="[object Uint32Array]",X=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,W=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,G=/[&<>"']/g,H=RegExp(q.source),V=RegExp(G.source),Q=/<%-([\s\S]+?)%>/g,K=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ne=/[\\^$.*+?()[\]{}|]/g,te=RegExp(ne.source),ae=/^\s+/,re=/\s/,oe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ie=/\{\n\/\* \[wrapped with (.+)\] \*/,se=/,? & /,le=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ce=/[()=,{}\[\]\/\s]/,de=/\\(\\)?/g,ue=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pe=/\w*$/,ve=/^[-+]0x[0-9a-f]+$/i,fe=/^0b[01]+$/i,he=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ye=/($^)/,xe=/['\n\r\u2028\u2029\\]/g,ke="\\ud800-\\udfff",we="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",_e="\\u2700-\\u27bf",Ce="a-z\\xdf-\\xf6\\xf8-\\xff",Ae="A-Z\\xc0-\\xd6\\xd8-\\xde",Se="\\ufe0e\\ufe0f",Le="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ee="["+ke+"]",Te="["+Le+"]",Ie="["+we+"]",Re="\\d+",Me="["+_e+"]",Pe="["+Ce+"]",De="[^"+ke+Le+Re+_e+Ce+Ae+"]",ze="\\ud83c[\\udffb-\\udfff]",Ne="[^"+ke+"]",$e="(?:\\ud83c[\\udde6-\\uddff]){2}",Oe="[\\ud800-\\udbff][\\udc00-\\udfff]",Fe="["+Ae+"]",je="\\u200d",Be="(?:"+Pe+"|"+De+")",Xe="(?:"+Fe+"|"+De+")",Ue="(?:['’](?:d|ll|m|re|s|t|ve))?",We="(?:['’](?:D|LL|M|RE|S|T|VE))?",qe="(?:"+Ie+"|"+ze+")?",Ge="["+Se+"]?",He=Ge+qe+"(?:"+je+"(?:"+[Ne,$e,Oe].join("|")+")"+Ge+qe+")*",Ve="(?:"+[Me,$e,Oe].join("|")+")"+He,Qe="(?:"+[Ne+Ie+"?",Ie,$e,Oe,Ee].join("|")+")",Ke=RegExp("['’]","g"),Ye=RegExp(Ie,"g"),Je=RegExp(ze+"(?="+ze+")|"+Qe+He,"g"),Ze=RegExp([Fe+"?"+Pe+"+"+Ue+"(?="+[Te,Fe,"$"].join("|")+")",Xe+"+"+We+"(?="+[Te,Fe+Be,"$"].join("|")+")",Fe+"?"+Be+"+"+Ue,Fe+"+"+We,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Re,Ve].join("|"),"g"),en=RegExp("["+je+ke+we+Se+"]"),nn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,tn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],an=-1,rn={};rn[P]=rn[D]=rn[z]=rn[N]=rn[$]=rn[O]=rn[F]=rn[j]=rn[B]=!0,rn[h]=rn[m]=rn[R]=rn[g]=rn[M]=rn[b]=rn[y]=rn[x]=rn[w]=rn[_]=rn[C]=rn[S]=rn[L]=rn[E]=rn[I]=!1;var on={};on[h]=on[m]=on[R]=on[M]=on[g]=on[b]=on[P]=on[D]=on[z]=on[N]=on[$]=on[w]=on[_]=on[C]=on[S]=on[L]=on[E]=on[T]=on[O]=on[F]=on[j]=on[B]=!0,on[y]=on[x]=on[I]=!1;var sn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ln=parseFloat,cn=parseInt,dn="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g,un="object"==typeof self&&self&&self.Object===Object&&self,pn=dn||un||Function("return this")(),vn=n&&!n.nodeType&&n,fn=vn&&e&&!e.nodeType&&e,hn=fn&&fn.exports===vn,mn=hn&&dn.process,gn=function(){try{return fn&&fn.require&&fn.require("util").types||mn&&mn.binding&&mn.binding("util")}catch(e){}}(),bn=gn&&gn.isArrayBuffer,yn=gn&&gn.isDate,xn=gn&&gn.isMap,kn=gn&&gn.isRegExp,wn=gn&&gn.isSet,_n=gn&&gn.isTypedArray;function Cn(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2])}return e.apply(n,t)}function An(e,n,t,a){for(var r=-1,o=null==e?0:e.length;++r<o;){var i=e[r];n(a,i,t(i),e)}return a}function Sn(e,n){for(var t=-1,a=null==e?0:e.length;++t<a&&!1!==n(e[t],t,e););return e}function Ln(e,n){for(var t=null==e?0:e.length;t--&&!1!==n(e[t],t,e););return e}function En(e,n){for(var t=-1,a=null==e?0:e.length;++t<a;)if(!n(e[t],t,e))return!1;return!0}function Tn(e,n){for(var t=-1,a=null==e?0:e.length,r=0,o=[];++t<a;){var i=e[t];n(i,t,e)&&(o[r++]=i)}return o}function In(e,n){return!(null==e||!e.length)&&jn(e,n,0)>-1}function Rn(e,n,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(t(n,e[a]))return!0;return!1}function Mn(e,n){for(var t=-1,a=null==e?0:e.length,r=Array(a);++t<a;)r[t]=n(e[t],t,e);return r}function Pn(e,n){for(var t=-1,a=n.length,r=e.length;++t<a;)e[r+t]=n[t];return e}function Dn(e,n,t,a){var r=-1,o=null==e?0:e.length;for(a&&o&&(t=e[++r]);++r<o;)t=n(t,e[r],r,e);return t}function zn(e,n,t,a){var r=null==e?0:e.length;for(a&&r&&(t=e[--r]);r--;)t=n(t,e[r],r,e);return t}function Nn(e,n){for(var t=-1,a=null==e?0:e.length;++t<a;)if(n(e[t],t,e))return!0;return!1}var $n=Wn("length");function On(e,n,t){var a;return t(e,function(e,t,r){if(n(e,t,r))return a=t,!1}),a}function Fn(e,n,t,a){for(var r=e.length,o=t+(a?1:-1);a?o--:++o<r;)if(n(e[o],o,e))return o;return-1}function jn(e,n,t){return n==n?function(e,n,t){for(var a=t-1,r=e.length;++a<r;)if(e[a]===n)return a;return-1}(e,n,t):Fn(e,Xn,t)}function Bn(e,n,t,a){for(var r=t-1,o=e.length;++r<o;)if(a(e[r],n))return r;return-1}function Xn(e){return e!=e}function Un(e,n){var t=null==e?0:e.length;return t?Hn(e,n)/t:p}function Wn(e){return function(n){return null==n?r:n[e]}}function qn(e){return function(n){return null==e?r:e[n]}}function Gn(e,n,t,a,r){return r(e,function(e,r,o){t=a?(a=!1,e):n(t,e,r,o)}),t}function Hn(e,n){for(var t,a=-1,o=e.length;++a<o;){var i=n(e[a]);i!==r&&(t=t===r?i:t+i)}return t}function Vn(e,n){for(var t=-1,a=Array(e);++t<e;)a[t]=n(t);return a}function Qn(e){return e?e.slice(0,pt(e)+1).replace(ae,""):e}function Kn(e){return function(n){return e(n)}}function Yn(e,n){return Mn(n,function(n){return e[n]})}function Jn(e,n){return e.has(n)}function Zn(e,n){for(var t=-1,a=e.length;++t<a&&jn(n,e[t],0)>-1;);return t}function et(e,n){for(var t=e.length;t--&&jn(n,e[t],0)>-1;);return t}var nt=qn({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),tt=qn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function at(e){return"\\"+sn[e]}function rt(e){return en.test(e)}function ot(e){var n=-1,t=Array(e.size);return e.forEach(function(e,a){t[++n]=[a,e]}),t}function it(e,n){return function(t){return e(n(t))}}function st(e,n){for(var t=-1,a=e.length,r=0,o=[];++t<a;){var i=e[t];i!==n&&i!==s||(e[t]=s,o[r++]=t)}return o}function lt(e){var n=-1,t=Array(e.size);return e.forEach(function(e){t[++n]=e}),t}function ct(e){var n=-1,t=Array(e.size);return e.forEach(function(e){t[++n]=[e,e]}),t}function dt(e){return rt(e)?function(e){for(var n=Je.lastIndex=0;Je.test(e);)++n;return n}(e):$n(e)}function ut(e){return rt(e)?function(e){return e.match(Je)||[]}(e):function(e){return e.split("")}(e)}function pt(e){for(var n=e.length;n--&&re.test(e.charAt(n)););return n}var vt=qn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),ft=function e(n){var t,a=(n=null==n?pn:ft.defaults(pn.Object(),n,ft.pick(pn,tn))).Array,re=n.Date,ke=n.Error,we=n.Function,_e=n.Math,Ce=n.Object,Ae=n.RegExp,Se=n.String,Le=n.TypeError,Ee=a.prototype,Te=we.prototype,Ie=Ce.prototype,Re=n["__core-js_shared__"],Me=Te.toString,Pe=Ie.hasOwnProperty,De=0,ze=(t=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+t:"",Ne=Ie.toString,$e=Me.call(Ce),Oe=pn._,Fe=Ae("^"+Me.call(Pe).replace(ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=hn?n.Buffer:r,Be=n.Symbol,Xe=n.Uint8Array,Ue=je?je.allocUnsafe:r,We=it(Ce.getPrototypeOf,Ce),qe=Ce.create,Ge=Ie.propertyIsEnumerable,He=Ee.splice,Ve=Be?Be.isConcatSpreadable:r,Qe=Be?Be.iterator:r,Je=Be?Be.toStringTag:r,en=function(){try{var e=lo(Ce,"defineProperty");return e({},"",{}),e}catch(e){}}(),sn=n.clearTimeout!==pn.clearTimeout&&n.clearTimeout,dn=re&&re.now!==pn.Date.now&&re.now,un=n.setTimeout!==pn.setTimeout&&n.setTimeout,vn=_e.ceil,fn=_e.floor,mn=Ce.getOwnPropertySymbols,gn=je?je.isBuffer:r,$n=n.isFinite,qn=Ee.join,ht=it(Ce.keys,Ce),mt=_e.max,gt=_e.min,bt=re.now,yt=n.parseInt,xt=_e.random,kt=Ee.reverse,wt=lo(n,"DataView"),_t=lo(n,"Map"),Ct=lo(n,"Promise"),At=lo(n,"Set"),St=lo(n,"WeakMap"),Lt=lo(Ce,"create"),Et=St&&new St,Tt={},It=$o(wt),Rt=$o(_t),Mt=$o(Ct),Pt=$o(At),Dt=$o(St),zt=Be?Be.prototype:r,Nt=zt?zt.valueOf:r,$t=zt?zt.toString:r;function Ot(e){if(es(e)&&!Ui(e)&&!(e instanceof Xt)){if(e instanceof Bt)return e;if(Pe.call(e,"__wrapped__"))return Oo(e)}return new Bt(e)}var Ft=function(){function e(){}return function(n){if(!Zi(n))return{};if(qe)return qe(n);e.prototype=n;var t=new e;return e.prototype=r,t}}();function jt(){}function Bt(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=r}function Xt(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=v,this.__views__=[]}function Ut(e){var n=-1,t=null==e?0:e.length;for(this.clear();++n<t;){var a=e[n];this.set(a[0],a[1])}}function Wt(e){var n=-1,t=null==e?0:e.length;for(this.clear();++n<t;){var a=e[n];this.set(a[0],a[1])}}function qt(e){var n=-1,t=null==e?0:e.length;for(this.clear();++n<t;){var a=e[n];this.set(a[0],a[1])}}function Gt(e){var n=-1,t=null==e?0:e.length;for(this.__data__=new qt;++n<t;)this.add(e[n])}function Ht(e){var n=this.__data__=new Wt(e);this.size=n.size}function Vt(e,n){var t=Ui(e),a=!t&&Xi(e),r=!t&&!a&&Hi(e),o=!t&&!a&&!r&&ls(e),i=t||a||r||o,s=i?Vn(e.length,Se):[],l=s.length;for(var c in e)!n&&!Pe.call(e,c)||i&&("length"==c||r&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||mo(c,l))||s.push(c);return s}function Qt(e){var n=e.length;return n?e[qa(0,n-1)]:r}function Kt(e,n){return Mo(Sr(e),oa(n,0,e.length))}function Yt(e){return Mo(Sr(e))}function Jt(e,n,t){(t!==r&&!Fi(e[n],t)||t===r&&!(n in e))&&aa(e,n,t)}function Zt(e,n,t){var a=e[n];Pe.call(e,n)&&Fi(a,t)&&(t!==r||n in e)||aa(e,n,t)}function ea(e,n){for(var t=e.length;t--;)if(Fi(e[t][0],n))return t;return-1}function na(e,n,t,a){return da(e,function(e,r,o){n(a,e,t(e),o)}),a}function ta(e,n){return e&&Lr(n,Is(n),e)}function aa(e,n,t){"__proto__"==n&&en?en(e,n,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[n]=t}function ra(e,n){for(var t=-1,o=n.length,i=a(o),s=null==e;++t<o;)i[t]=s?r:As(e,n[t]);return i}function oa(e,n,t){return e==e&&(t!==r&&(e=e<=t?e:t),n!==r&&(e=e>=n?e:n)),e}function ia(e,n,t,a,o,i){var s,l=1&n,c=2&n,d=4&n;if(t&&(s=o?t(e,a,o,i):t(e)),s!==r)return s;if(!Zi(e))return e;var u=Ui(e);if(u){if(s=function(e){var n=e.length,t=new e.constructor(n);return n&&"string"==typeof e[0]&&Pe.call(e,"index")&&(t.index=e.index,t.input=e.input),t}(e),!l)return Sr(e,s)}else{var p=po(e),v=p==x||p==k;if(Hi(e))return xr(e,l);if(p==C||p==h||v&&!o){if(s=c||v?{}:fo(e),!l)return c?function(e,n){return Lr(e,uo(e),n)}(e,function(e,n){return e&&Lr(n,Rs(n),e)}(s,e)):function(e,n){return Lr(e,co(e),n)}(e,ta(s,e))}else{if(!on[p])return o?e:{};s=function(e,n,t){var a,r=e.constructor;switch(n){case R:return kr(e);case g:case b:return new r(+e);case M:return function(e,n){var t=n?kr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}(e,t);case P:case D:case z:case N:case $:case O:case F:case j:case B:return wr(e,t);case w:return new r;case _:case E:return new r(e);case S:return function(e){var n=new e.constructor(e.source,pe.exec(e));return n.lastIndex=e.lastIndex,n}(e);case L:return new r;case T:return a=e,Nt?Ce(Nt.call(a)):{}}}(e,p,l)}}i||(i=new Ht);var f=i.get(e);if(f)return f;i.set(e,s),os(e)?e.forEach(function(a){s.add(ia(a,n,t,a,e,i))}):ns(e)&&e.forEach(function(a,r){s.set(r,ia(a,n,t,r,e,i))});var m=u?r:(d?c?no:eo:c?Rs:Is)(e);return Sn(m||e,function(a,r){m&&(a=e[r=a]),Zt(s,r,ia(a,n,t,r,e,i))}),s}function sa(e,n,t){var a=t.length;if(null==e)return!a;for(e=Ce(e);a--;){var o=t[a],i=n[o],s=e[o];if(s===r&&!(o in e)||!i(s))return!1}return!0}function la(e,n,t){if("function"!=typeof e)throw new Le(o);return Eo(function(){e.apply(r,t)},n)}function ca(e,n,t,a){var r=-1,o=In,i=!0,s=e.length,l=[],c=n.length;if(!s)return l;t&&(n=Mn(n,Kn(t))),a?(o=Rn,i=!1):n.length>=200&&(o=Jn,i=!1,n=new Gt(n));e:for(;++r<s;){var d=e[r],u=null==t?d:t(d);if(d=a||0!==d?d:0,i&&u==u){for(var p=c;p--;)if(n[p]===u)continue e;l.push(d)}else o(n,u,a)||l.push(d)}return l}Ot.templateSettings={escape:Q,evaluate:K,interpolate:Y,variable:"",imports:{_:Ot}},Ot.prototype=jt.prototype,Ot.prototype.constructor=Ot,Bt.prototype=Ft(jt.prototype),Bt.prototype.constructor=Bt,Xt.prototype=Ft(jt.prototype),Xt.prototype.constructor=Xt,Ut.prototype.clear=function(){this.__data__=Lt?Lt(null):{},this.size=0},Ut.prototype.delete=function(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n},Ut.prototype.get=function(e){var n=this.__data__;if(Lt){var t=n[e];return t===i?r:t}return Pe.call(n,e)?n[e]:r},Ut.prototype.has=function(e){var n=this.__data__;return Lt?n[e]!==r:Pe.call(n,e)},Ut.prototype.set=function(e,n){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=Lt&&n===r?i:n,this},Wt.prototype.clear=function(){this.__data__=[],this.size=0},Wt.prototype.delete=function(e){var n=this.__data__,t=ea(n,e);return!(t<0||(t==n.length-1?n.pop():He.call(n,t,1),--this.size,0))},Wt.prototype.get=function(e){var n=this.__data__,t=ea(n,e);return t<0?r:n[t][1]},Wt.prototype.has=function(e){return ea(this.__data__,e)>-1},Wt.prototype.set=function(e,n){var t=this.__data__,a=ea(t,e);return a<0?(++this.size,t.push([e,n])):t[a][1]=n,this},qt.prototype.clear=function(){this.size=0,this.__data__={hash:new Ut,map:new(_t||Wt),string:new Ut}},qt.prototype.delete=function(e){var n=io(this,e).delete(e);return this.size-=n?1:0,n},qt.prototype.get=function(e){return io(this,e).get(e)},qt.prototype.has=function(e){return io(this,e).has(e)},qt.prototype.set=function(e,n){var t=io(this,e),a=t.size;return t.set(e,n),this.size+=t.size==a?0:1,this},Gt.prototype.add=Gt.prototype.push=function(e){return this.__data__.set(e,i),this},Gt.prototype.has=function(e){return this.__data__.has(e)},Ht.prototype.clear=function(){this.__data__=new Wt,this.size=0},Ht.prototype.delete=function(e){var n=this.__data__,t=n.delete(e);return this.size=n.size,t},Ht.prototype.get=function(e){return this.__data__.get(e)},Ht.prototype.has=function(e){return this.__data__.has(e)},Ht.prototype.set=function(e,n){var t=this.__data__;if(t instanceof Wt){var a=t.__data__;if(!_t||a.length<199)return a.push([e,n]),this.size=++t.size,this;t=this.__data__=new qt(a)}return t.set(e,n),this.size=t.size,this};var da=Ir(ba),ua=Ir(ya,!0);function pa(e,n){var t=!0;return da(e,function(e,a,r){return t=!!n(e,a,r)}),t}function va(e,n,t){for(var a=-1,o=e.length;++a<o;){var i=e[a],s=n(i);if(null!=s&&(l===r?s==s&&!ss(s):t(s,l)))var l=s,c=i}return c}function fa(e,n){var t=[];return da(e,function(e,a,r){n(e,a,r)&&t.push(e)}),t}function ha(e,n,t,a,r){var o=-1,i=e.length;for(t||(t=ho),r||(r=[]);++o<i;){var s=e[o];n>0&&t(s)?n>1?ha(s,n-1,t,a,r):Pn(r,s):a||(r[r.length]=s)}return r}var ma=Rr(),ga=Rr(!0);function ba(e,n){return e&&ma(e,n,Is)}function ya(e,n){return e&&ga(e,n,Is)}function xa(e,n){return Tn(n,function(n){return Ki(e[n])})}function ka(e,n){for(var t=0,a=(n=mr(n,e)).length;null!=e&&t<a;)e=e[No(n[t++])];return t&&t==a?e:r}function wa(e,n,t){var a=n(e);return Ui(e)?a:Pn(a,t(e))}function _a(e){return null==e?e===r?"[object Undefined]":"[object Null]":Je&&Je in Ce(e)?function(e){var n=Pe.call(e,Je),t=e[Je];try{e[Je]=r;var a=!0}catch(e){}var o=Ne.call(e);return a&&(n?e[Je]=t:delete e[Je]),o}(e):function(e){return Ne.call(e)}(e)}function Ca(e,n){return e>n}function Aa(e,n){return null!=e&&Pe.call(e,n)}function Sa(e,n){return null!=e&&n in Ce(e)}function La(e,n,t){for(var o=t?Rn:In,i=e[0].length,s=e.length,l=s,c=a(s),d=1/0,u=[];l--;){var p=e[l];l&&n&&(p=Mn(p,Kn(n))),d=gt(p.length,d),c[l]=!t&&(n||i>=120&&p.length>=120)?new Gt(l&&p):r}p=e[0];var v=-1,f=c[0];e:for(;++v<i&&u.length<d;){var h=p[v],m=n?n(h):h;if(h=t||0!==h?h:0,!(f?Jn(f,m):o(u,m,t))){for(l=s;--l;){var g=c[l];if(!(g?Jn(g,m):o(e[l],m,t)))continue e}f&&f.push(m),u.push(h)}}return u}function Ea(e,n,t){var a=null==(e=Ao(e,n=mr(n,e)))?e:e[No(Qo(n))];return null==a?r:Cn(a,e,t)}function Ta(e){return es(e)&&_a(e)==h}function Ia(e,n,t,a,o){return e===n||(null==e||null==n||!es(e)&&!es(n)?e!=e&&n!=n:function(e,n,t,a,o,i){var s=Ui(e),l=Ui(n),c=s?m:po(e),d=l?m:po(n),u=(c=c==h?C:c)==C,p=(d=d==h?C:d)==C,v=c==d;if(v&&Hi(e)){if(!Hi(n))return!1;s=!0,u=!1}if(v&&!u)return i||(i=new Ht),s||ls(e)?Jr(e,n,t,a,o,i):function(e,n,t,a,r,o,i){switch(t){case M:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case R:return!(e.byteLength!=n.byteLength||!o(new Xe(e),new Xe(n)));case g:case b:case _:return Fi(+e,+n);case y:return e.name==n.name&&e.message==n.message;case S:case E:return e==n+"";case w:var s=ot;case L:var l=1&a;if(s||(s=lt),e.size!=n.size&&!l)return!1;var c=i.get(e);if(c)return c==n;a|=2,i.set(e,n);var d=Jr(s(e),s(n),a,r,o,i);return i.delete(e),d;case T:if(Nt)return Nt.call(e)==Nt.call(n)}return!1}(e,n,c,t,a,o,i);if(!(1&t)){var f=u&&Pe.call(e,"__wrapped__"),x=p&&Pe.call(n,"__wrapped__");if(f||x){var k=f?e.value():e,A=x?n.value():n;return i||(i=new Ht),o(k,A,t,a,i)}}return!!v&&(i||(i=new Ht),function(e,n,t,a,o,i){var s=1&t,l=eo(e),c=l.length;if(c!=eo(n).length&&!s)return!1;for(var d=c;d--;){var u=l[d];if(!(s?u in n:Pe.call(n,u)))return!1}var p=i.get(e),v=i.get(n);if(p&&v)return p==n&&v==e;var f=!0;i.set(e,n),i.set(n,e);for(var h=s;++d<c;){var m=e[u=l[d]],g=n[u];if(a)var b=s?a(g,m,u,n,e,i):a(m,g,u,e,n,i);if(!(b===r?m===g||o(m,g,t,a,i):b)){f=!1;break}h||(h="constructor"==u)}if(f&&!h){var y=e.constructor,x=n.constructor;y==x||!("constructor"in e)||!("constructor"in n)||"function"==typeof y&&y instanceof y&&"function"==typeof x&&x instanceof x||(f=!1)}return i.delete(e),i.delete(n),f}(e,n,t,a,o,i))}(e,n,t,a,Ia,o))}function Ra(e,n,t,a){var o=t.length,i=o,s=!a;if(null==e)return!i;for(e=Ce(e);o--;){var l=t[o];if(s&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<i;){var c=(l=t[o])[0],d=e[c],u=l[1];if(s&&l[2]){if(d===r&&!(c in e))return!1}else{var p=new Ht;if(a)var v=a(d,u,c,e,n,p);if(!(v===r?Ia(u,d,3,a,p):v))return!1}}return!0}function Ma(e){return!(!Zi(e)||(n=e,ze&&ze in n))&&(Ki(e)?Fe:he).test($o(e));var n}function Pa(e){return"function"==typeof e?e:null==e?tl:"object"==typeof e?Ui(e)?Oa(e[0],e[1]):$a(e):ul(e)}function Da(e){if(!ko(e))return ht(e);var n=[];for(var t in Ce(e))Pe.call(e,t)&&"constructor"!=t&&n.push(t);return n}function za(e,n){return e<n}function Na(e,n){var t=-1,r=qi(e)?a(e.length):[];return da(e,function(e,a,o){r[++t]=n(e,a,o)}),r}function $a(e){var n=so(e);return 1==n.length&&n[0][2]?_o(n[0][0],n[0][1]):function(t){return t===e||Ra(t,e,n)}}function Oa(e,n){return bo(e)&&wo(n)?_o(No(e),n):function(t){var a=As(t,e);return a===r&&a===n?Ss(t,e):Ia(n,a,3)}}function Fa(e,n,t,a,o){e!==n&&ma(n,function(i,s){if(o||(o=new Ht),Zi(i))!function(e,n,t,a,o,i,s){var l=So(e,t),c=So(n,t),d=s.get(c);if(d)Jt(e,t,d);else{var u=i?i(l,c,t+"",e,n,s):r,p=u===r;if(p){var v=Ui(c),f=!v&&Hi(c),h=!v&&!f&&ls(c);u=c,v||f||h?Ui(l)?u=l:Gi(l)?u=Sr(l):f?(p=!1,u=xr(c,!0)):h?(p=!1,u=wr(c,!0)):u=[]:as(c)||Xi(c)?(u=l,Xi(l)?u=ms(l):Zi(l)&&!Ki(l)||(u=fo(c))):p=!1}p&&(s.set(c,u),o(u,c,a,i,s),s.delete(c)),Jt(e,t,u)}}(e,n,s,t,Fa,a,o);else{var l=a?a(So(e,s),i,s+"",e,n,o):r;l===r&&(l=i),Jt(e,s,l)}},Rs)}function ja(e,n){var t=e.length;if(t)return mo(n+=n<0?t:0,t)?e[n]:r}function Ba(e,n,t){n=n.length?Mn(n,function(e){return Ui(e)?function(n){return ka(n,1===e.length?e[0]:e)}:e}):[tl];var a=-1;n=Mn(n,Kn(oo()));var r=Na(e,function(e,t,r){var o=Mn(n,function(n){return n(e)});return{criteria:o,index:++a,value:e}});return function(e){var n=e.length;for(e.sort(function(e,n){return function(e,n,t){for(var a=-1,r=e.criteria,o=n.criteria,i=r.length,s=t.length;++a<i;){var l=_r(r[a],o[a]);if(l)return a>=s?l:l*("desc"==t[a]?-1:1)}return e.index-n.index}(e,n,t)});n--;)e[n]=e[n].value;return e}(r)}function Xa(e,n,t){for(var a=-1,r=n.length,o={};++a<r;){var i=n[a],s=ka(e,i);t(s,i)&&Ka(o,mr(i,e),s)}return o}function Ua(e,n,t,a){var r=a?Bn:jn,o=-1,i=n.length,s=e;for(e===n&&(n=Sr(n)),t&&(s=Mn(e,Kn(t)));++o<i;)for(var l=0,c=n[o],d=t?t(c):c;(l=r(s,d,l,a))>-1;)s!==e&&He.call(s,l,1),He.call(e,l,1);return e}function Wa(e,n){for(var t=e?n.length:0,a=t-1;t--;){var r=n[t];if(t==a||r!==o){var o=r;mo(r)?He.call(e,r,1):lr(e,r)}}return e}function qa(e,n){return e+fn(xt()*(n-e+1))}function Ga(e,n){var t="";if(!e||n<1||n>u)return t;do{n%2&&(t+=e),(n=fn(n/2))&&(e+=e)}while(n);return t}function Ha(e,n){return To(Co(e,n,tl),e+"")}function Va(e){return Qt(Fs(e))}function Qa(e,n){var t=Fs(e);return Mo(t,oa(n,0,t.length))}function Ka(e,n,t,a){if(!Zi(e))return e;for(var o=-1,i=(n=mr(n,e)).length,s=i-1,l=e;null!=l&&++o<i;){var c=No(n[o]),d=t;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(o!=s){var u=l[c];(d=a?a(u,c,l):r)===r&&(d=Zi(u)?u:mo(n[o+1])?[]:{})}Zt(l,c,d),l=l[c]}return e}var Ya=Et?function(e,n){return Et.set(e,n),e}:tl,Ja=en?function(e,n){return en(e,"toString",{configurable:!0,enumerable:!1,value:Zs(n),writable:!0})}:tl;function Za(e){return Mo(Fs(e))}function er(e,n,t){var r=-1,o=e.length;n<0&&(n=-n>o?0:o+n),(t=t>o?o:t)<0&&(t+=o),o=n>t?0:t-n>>>0,n>>>=0;for(var i=a(o);++r<o;)i[r]=e[r+n];return i}function nr(e,n){var t;return da(e,function(e,a,r){return!(t=n(e,a,r))}),!!t}function tr(e,n,t){var a=0,r=null==e?a:e.length;if("number"==typeof n&&n==n&&r<=2147483647){for(;a<r;){var o=a+r>>>1,i=e[o];null!==i&&!ss(i)&&(t?i<=n:i<n)?a=o+1:r=o}return r}return ar(e,n,tl,t)}function ar(e,n,t,a){var o=0,i=null==e?0:e.length;if(0===i)return 0;for(var s=(n=t(n))!=n,l=null===n,c=ss(n),d=n===r;o<i;){var u=fn((o+i)/2),p=t(e[u]),v=p!==r,f=null===p,h=p==p,m=ss(p);if(s)var g=a||h;else g=d?h&&(a||v):l?h&&v&&(a||!f):c?h&&v&&!f&&(a||!m):!f&&!m&&(a?p<=n:p<n);g?o=u+1:i=u}return gt(i,4294967294)}function rr(e,n){for(var t=-1,a=e.length,r=0,o=[];++t<a;){var i=e[t],s=n?n(i):i;if(!t||!Fi(s,l)){var l=s;o[r++]=0===i?0:i}}return o}function or(e){return"number"==typeof e?e:ss(e)?p:+e}function ir(e){if("string"==typeof e)return e;if(Ui(e))return Mn(e,ir)+"";if(ss(e))return $t?$t.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n}function sr(e,n,t){var a=-1,r=In,o=e.length,i=!0,s=[],l=s;if(t)i=!1,r=Rn;else if(o>=200){var c=n?null:Gr(e);if(c)return lt(c);i=!1,r=Jn,l=new Gt}else l=n?[]:s;e:for(;++a<o;){var d=e[a],u=n?n(d):d;if(d=t||0!==d?d:0,i&&u==u){for(var p=l.length;p--;)if(l[p]===u)continue e;n&&l.push(u),s.push(d)}else r(l,u,t)||(l!==s&&l.push(u),s.push(d))}return s}function lr(e,n){return null==(e=Ao(e,n=mr(n,e)))||delete e[No(Qo(n))]}function cr(e,n,t,a){return Ka(e,n,t(ka(e,n)),a)}function dr(e,n,t,a){for(var r=e.length,o=a?r:-1;(a?o--:++o<r)&&n(e[o],o,e););return t?er(e,a?0:o,a?o+1:r):er(e,a?o+1:0,a?r:o)}function ur(e,n){var t=e;return t instanceof Xt&&(t=t.value()),Dn(n,function(e,n){return n.func.apply(n.thisArg,Pn([e],n.args))},t)}function pr(e,n,t){var r=e.length;if(r<2)return r?sr(e[0]):[];for(var o=-1,i=a(r);++o<r;)for(var s=e[o],l=-1;++l<r;)l!=o&&(i[o]=ca(i[o]||s,e[l],n,t));return sr(ha(i,1),n,t)}function vr(e,n,t){for(var a=-1,o=e.length,i=n.length,s={};++a<o;){var l=a<i?n[a]:r;t(s,e[a],l)}return s}function fr(e){return Gi(e)?e:[]}function hr(e){return"function"==typeof e?e:tl}function mr(e,n){return Ui(e)?e:bo(e,n)?[e]:zo(gs(e))}var gr=Ha;function br(e,n,t){var a=e.length;return t=t===r?a:t,!n&&t>=a?e:er(e,n,t)}var yr=sn||function(e){return pn.clearTimeout(e)};function xr(e,n){if(n)return e.slice();var t=e.length,a=Ue?Ue(t):new e.constructor(t);return e.copy(a),a}function kr(e){var n=new e.constructor(e.byteLength);return new Xe(n).set(new Xe(e)),n}function wr(e,n){var t=n?kr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}function _r(e,n){if(e!==n){var t=e!==r,a=null===e,o=e==e,i=ss(e),s=n!==r,l=null===n,c=n==n,d=ss(n);if(!l&&!d&&!i&&e>n||i&&s&&c&&!l&&!d||a&&s&&c||!t&&c||!o)return 1;if(!a&&!i&&!d&&e<n||d&&t&&o&&!a&&!i||l&&t&&o||!s&&o||!c)return-1}return 0}function Cr(e,n,t,r){for(var o=-1,i=e.length,s=t.length,l=-1,c=n.length,d=mt(i-s,0),u=a(c+d),p=!r;++l<c;)u[l]=n[l];for(;++o<s;)(p||o<i)&&(u[t[o]]=e[o]);for(;d--;)u[l++]=e[o++];return u}function Ar(e,n,t,r){for(var o=-1,i=e.length,s=-1,l=t.length,c=-1,d=n.length,u=mt(i-l,0),p=a(u+d),v=!r;++o<u;)p[o]=e[o];for(var f=o;++c<d;)p[f+c]=n[c];for(;++s<l;)(v||o<i)&&(p[f+t[s]]=e[o++]);return p}function Sr(e,n){var t=-1,r=e.length;for(n||(n=a(r));++t<r;)n[t]=e[t];return n}function Lr(e,n,t,a){var o=!t;t||(t={});for(var i=-1,s=n.length;++i<s;){var l=n[i],c=a?a(t[l],e[l],l,t,e):r;c===r&&(c=e[l]),o?aa(t,l,c):Zt(t,l,c)}return t}function Er(e,n){return function(t,a){var r=Ui(t)?An:na,o=n?n():{};return r(t,e,oo(a,2),o)}}function Tr(e){return Ha(function(n,t){var a=-1,o=t.length,i=o>1?t[o-1]:r,s=o>2?t[2]:r;for(i=e.length>3&&"function"==typeof i?(o--,i):r,s&&go(t[0],t[1],s)&&(i=o<3?r:i,o=1),n=Ce(n);++a<o;){var l=t[a];l&&e(n,l,a,i)}return n})}function Ir(e,n){return function(t,a){if(null==t)return t;if(!qi(t))return e(t,a);for(var r=t.length,o=n?r:-1,i=Ce(t);(n?o--:++o<r)&&!1!==a(i[o],o,i););return t}}function Rr(e){return function(n,t,a){for(var r=-1,o=Ce(n),i=a(n),s=i.length;s--;){var l=i[e?s:++r];if(!1===t(o[l],l,o))break}return n}}function Mr(e){return function(n){var t=rt(n=gs(n))?ut(n):r,a=t?t[0]:n.charAt(0),o=t?br(t,1).join(""):n.slice(1);return a[e]()+o}}function Pr(e){return function(n){return Dn(Ks(Xs(n).replace(Ke,"")),e,"")}}function Dr(e){return function(){var n=arguments;switch(n.length){case 0:return new e;case 1:return new e(n[0]);case 2:return new e(n[0],n[1]);case 3:return new e(n[0],n[1],n[2]);case 4:return new e(n[0],n[1],n[2],n[3]);case 5:return new e(n[0],n[1],n[2],n[3],n[4]);case 6:return new e(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new e(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var t=Ft(e.prototype),a=e.apply(t,n);return Zi(a)?a:t}}function zr(e){return function(n,t,a){var o=Ce(n);if(!qi(n)){var i=oo(t,3);n=Is(n),t=function(e){return i(o[e],e,o)}}var s=e(n,t,a);return s>-1?o[i?n[s]:s]:r}}function Nr(e){return Zr(function(n){var t=n.length,a=t,i=Bt.prototype.thru;for(e&&n.reverse();a--;){var s=n[a];if("function"!=typeof s)throw new Le(o);if(i&&!l&&"wrapper"==ao(s))var l=new Bt([],!0)}for(a=l?a:t;++a<t;){var c=ao(s=n[a]),d="wrapper"==c?to(s):r;l=d&&yo(d[0])&&424==d[1]&&!d[4].length&&1==d[9]?l[ao(d[0])].apply(l,d[3]):1==s.length&&yo(s)?l[c]():l.thru(s)}return function(){var e=arguments,a=e[0];if(l&&1==e.length&&Ui(a))return l.plant(a).value();for(var r=0,o=t?n[r].apply(this,e):a;++r<t;)o=n[r].call(this,o);return o}})}function $r(e,n,t,o,i,s,l,d,u,p){var v=n&c,f=1&n,h=2&n,m=24&n,g=512&n,b=h?r:Dr(e);return function c(){for(var y=arguments.length,x=a(y),k=y;k--;)x[k]=arguments[k];if(m)var w=ro(c),_=function(e,n){for(var t=e.length,a=0;t--;)e[t]===n&&++a;return a}(x,w);if(o&&(x=Cr(x,o,i,m)),s&&(x=Ar(x,s,l,m)),y-=_,m&&y<p){var C=st(x,w);return Wr(e,n,$r,c.placeholder,t,x,C,d,u,p-y)}var A=f?t:this,S=h?A[e]:e;return y=x.length,d?x=function(e,n){for(var t=e.length,a=gt(n.length,t),o=Sr(e);a--;){var i=n[a];e[a]=mo(i,t)?o[i]:r}return e}(x,d):g&&y>1&&x.reverse(),v&&u<y&&(x.length=u),this&&this!==pn&&this instanceof c&&(S=b||Dr(S)),S.apply(A,x)}}function Or(e,n){return function(t,a){return function(e,n,t,a){return ba(e,function(e,r,o){n(a,t(e),r,o)}),a}(t,e,n(a),{})}}function Fr(e,n){return function(t,a){var o;if(t===r&&a===r)return n;if(t!==r&&(o=t),a!==r){if(o===r)return a;"string"==typeof t||"string"==typeof a?(t=ir(t),a=ir(a)):(t=or(t),a=or(a)),o=e(t,a)}return o}}function jr(e){return Zr(function(n){return n=Mn(n,Kn(oo())),Ha(function(t){var a=this;return e(n,function(e){return Cn(e,a,t)})})})}function Br(e,n){var t=(n=n===r?" ":ir(n)).length;if(t<2)return t?Ga(n,e):n;var a=Ga(n,vn(e/dt(n)));return rt(n)?br(ut(a),0,e).join(""):a.slice(0,e)}function Xr(e){return function(n,t,o){return o&&"number"!=typeof o&&go(n,t,o)&&(t=o=r),n=ps(n),t===r?(t=n,n=0):t=ps(t),function(e,n,t,r){for(var o=-1,i=mt(vn((n-e)/(t||1)),0),s=a(i);i--;)s[r?i:++o]=e,e+=t;return s}(n,t,o=o===r?n<t?1:-1:ps(o),e)}}function Ur(e){return function(n,t){return"string"==typeof n&&"string"==typeof t||(n=hs(n),t=hs(t)),e(n,t)}}function Wr(e,n,t,a,o,i,s,c,d,u){var p=8&n;n|=p?l:64,4&(n&=~(p?64:l))||(n&=-4);var v=[e,n,o,p?i:r,p?s:r,p?r:i,p?r:s,c,d,u],f=t.apply(r,v);return yo(e)&&Lo(f,v),f.placeholder=a,Io(f,e,n)}function qr(e){var n=_e[e];return function(e,t){if(e=hs(e),(t=null==t?0:gt(vs(t),292))&&$n(e)){var a=(gs(e)+"e").split("e");return+((a=(gs(n(a[0]+"e"+(+a[1]+t)))+"e").split("e"))[0]+"e"+(+a[1]-t))}return n(e)}}var Gr=At&&1/lt(new At([,-0]))[1]==d?function(e){return new At(e)}:sl;function Hr(e){return function(n){var t=po(n);return t==w?ot(n):t==L?ct(n):function(e,n){return Mn(n,function(n){return[n,e[n]]})}(n,e(n))}}function Vr(e,n,t,i,d,u,p,v){var f=2&n;if(!f&&"function"!=typeof e)throw new Le(o);var h=i?i.length:0;if(h||(n&=-97,i=d=r),p=p===r?p:mt(vs(p),0),v=v===r?v:vs(v),h-=d?d.length:0,64&n){var m=i,g=d;i=d=r}var b=f?r:to(e),y=[e,n,t,i,d,m,g,u,p,v];if(b&&function(e,n){var t=e[1],a=n[1],r=t|a,o=r<131,i=a==c&&8==t||a==c&&256==t&&e[7].length<=n[8]||384==a&&n[7].length<=n[8]&&8==t;if(!o&&!i)return e;1&a&&(e[2]=n[2],r|=1&t?0:4);var l=n[3];if(l){var d=e[3];e[3]=d?Cr(d,l,n[4]):l,e[4]=d?st(e[3],s):n[4]}(l=n[5])&&(d=e[5],e[5]=d?Ar(d,l,n[6]):l,e[6]=d?st(e[5],s):n[6]),(l=n[7])&&(e[7]=l),a&c&&(e[8]=null==e[8]?n[8]:gt(e[8],n[8])),null==e[9]&&(e[9]=n[9]),e[0]=n[0],e[1]=r}(y,b),e=y[0],n=y[1],t=y[2],i=y[3],d=y[4],!(v=y[9]=y[9]===r?f?0:e.length:mt(y[9]-h,0))&&24&n&&(n&=-25),n&&1!=n)x=8==n||16==n?function(e,n,t){var o=Dr(e);return function i(){for(var s=arguments.length,l=a(s),c=s,d=ro(i);c--;)l[c]=arguments[c];var u=s<3&&l[0]!==d&&l[s-1]!==d?[]:st(l,d);return(s-=u.length)<t?Wr(e,n,$r,i.placeholder,r,l,u,r,r,t-s):Cn(this&&this!==pn&&this instanceof i?o:e,this,l)}}(e,n,v):n!=l&&33!=n||d.length?$r.apply(r,y):function(e,n,t,r){var o=1&n,i=Dr(e);return function n(){for(var s=-1,l=arguments.length,c=-1,d=r.length,u=a(d+l),p=this&&this!==pn&&this instanceof n?i:e;++c<d;)u[c]=r[c];for(;l--;)u[c++]=arguments[++s];return Cn(p,o?t:this,u)}}(e,n,t,i);else var x=function(e,n,t){var a=1&n,r=Dr(e);return function n(){return(this&&this!==pn&&this instanceof n?r:e).apply(a?t:this,arguments)}}(e,n,t);return Io((b?Ya:Lo)(x,y),e,n)}function Qr(e,n,t,a){return e===r||Fi(e,Ie[t])&&!Pe.call(a,t)?n:e}function Kr(e,n,t,a,o,i){return Zi(e)&&Zi(n)&&(i.set(n,e),Fa(e,n,r,Kr,i),i.delete(n)),e}function Yr(e){return as(e)?r:e}function Jr(e,n,t,a,o,i){var s=1&t,l=e.length,c=n.length;if(l!=c&&!(s&&c>l))return!1;var d=i.get(e),u=i.get(n);if(d&&u)return d==n&&u==e;var p=-1,v=!0,f=2&t?new Gt:r;for(i.set(e,n),i.set(n,e);++p<l;){var h=e[p],m=n[p];if(a)var g=s?a(m,h,p,n,e,i):a(h,m,p,e,n,i);if(g!==r){if(g)continue;v=!1;break}if(f){if(!Nn(n,function(e,n){if(!Jn(f,n)&&(h===e||o(h,e,t,a,i)))return f.push(n)})){v=!1;break}}else if(h!==m&&!o(h,m,t,a,i)){v=!1;break}}return i.delete(e),i.delete(n),v}function Zr(e){return To(Co(e,r,Wo),e+"")}function eo(e){return wa(e,Is,co)}function no(e){return wa(e,Rs,uo)}var to=Et?function(e){return Et.get(e)}:sl;function ao(e){for(var n=e.name+"",t=Tt[n],a=Pe.call(Tt,n)?t.length:0;a--;){var r=t[a],o=r.func;if(null==o||o==e)return r.name}return n}function ro(e){return(Pe.call(Ot,"placeholder")?Ot:e).placeholder}function oo(){var e=Ot.iteratee||al;return e=e===al?Pa:e,arguments.length?e(arguments[0],arguments[1]):e}function io(e,n){var t,a,r=e.__data__;return("string"==(a=typeof(t=n))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t)?r["string"==typeof n?"string":"hash"]:r.map}function so(e){for(var n=Is(e),t=n.length;t--;){var a=n[t],r=e[a];n[t]=[a,r,wo(r)]}return n}function lo(e,n){var t=function(e,n){return null==e?r:e[n]}(e,n);return Ma(t)?t:r}var co=mn?function(e){return null==e?[]:(e=Ce(e),Tn(mn(e),function(n){return Ge.call(e,n)}))}:fl,uo=mn?function(e){for(var n=[];e;)Pn(n,co(e)),e=We(e);return n}:fl,po=_a;function vo(e,n,t){for(var a=-1,r=(n=mr(n,e)).length,o=!1;++a<r;){var i=No(n[a]);if(!(o=null!=e&&t(e,i)))break;e=e[i]}return o||++a!=r?o:!!(r=null==e?0:e.length)&&Ji(r)&&mo(i,r)&&(Ui(e)||Xi(e))}function fo(e){return"function"!=typeof e.constructor||ko(e)?{}:Ft(We(e))}function ho(e){return Ui(e)||Xi(e)||!!(Ve&&e&&e[Ve])}function mo(e,n){var t=typeof e;return!!(n=null==n?u:n)&&("number"==t||"symbol"!=t&&ge.test(e))&&e>-1&&e%1==0&&e<n}function go(e,n,t){if(!Zi(t))return!1;var a=typeof n;return!!("number"==a?qi(t)&&mo(n,t.length):"string"==a&&n in t)&&Fi(t[n],e)}function bo(e,n){if(Ui(e))return!1;var t=typeof e;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=e&&!ss(e))||Z.test(e)||!J.test(e)||null!=n&&e in Ce(n)}function yo(e){var n=ao(e),t=Ot[n];if("function"!=typeof t||!(n in Xt.prototype))return!1;if(e===t)return!0;var a=to(t);return!!a&&e===a[0]}(wt&&po(new wt(new ArrayBuffer(1)))!=M||_t&&po(new _t)!=w||Ct&&po(Ct.resolve())!=A||At&&po(new At)!=L||St&&po(new St)!=I)&&(po=function(e){var n=_a(e),t=n==C?e.constructor:r,a=t?$o(t):"";if(a)switch(a){case It:return M;case Rt:return w;case Mt:return A;case Pt:return L;case Dt:return I}return n});var xo=Re?Ki:hl;function ko(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||Ie)}function wo(e){return e==e&&!Zi(e)}function _o(e,n){return function(t){return null!=t&&t[e]===n&&(n!==r||e in Ce(t))}}function Co(e,n,t){return n=mt(n===r?e.length-1:n,0),function(){for(var r=arguments,o=-1,i=mt(r.length-n,0),s=a(i);++o<i;)s[o]=r[n+o];o=-1;for(var l=a(n+1);++o<n;)l[o]=r[o];return l[n]=t(s),Cn(e,this,l)}}function Ao(e,n){return n.length<2?e:ka(e,er(n,0,-1))}function So(e,n){if(("constructor"!==n||"function"!=typeof e[n])&&"__proto__"!=n)return e[n]}var Lo=Ro(Ya),Eo=un||function(e,n){return pn.setTimeout(e,n)},To=Ro(Ja);function Io(e,n,t){var a=n+"";return To(e,function(e,n){var t=n.length;if(!t)return e;var a=t-1;return n[a]=(t>1?"& ":"")+n[a],n=n.join(t>2?", ":" "),e.replace(oe,"{\n/* [wrapped with "+n+"] */\n")}(a,function(e,n){return Sn(f,function(t){var a="_."+t[0];n&t[1]&&!In(e,a)&&e.push(a)}),e.sort()}(function(e){var n=e.match(ie);return n?n[1].split(se):[]}(a),t)))}function Ro(e){var n=0,t=0;return function(){var a=bt(),o=16-(a-t);if(t=a,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(r,arguments)}}function Mo(e,n){var t=-1,a=e.length,o=a-1;for(n=n===r?a:n;++t<n;){var i=qa(t,o),s=e[i];e[i]=e[t],e[t]=s}return e.length=n,e}var Po,Do,zo=(Po=Pi(function(e){var n=[];return 46===e.charCodeAt(0)&&n.push(""),e.replace(ee,function(e,t,a,r){n.push(a?r.replace(de,"$1"):t||e)}),n},function(e){return 500===Do.size&&Do.clear(),e}),Do=Po.cache,Po);function No(e){if("string"==typeof e||ss(e))return e;var n=e+"";return"0"==n&&1/e==-1/0?"-0":n}function $o(e){if(null!=e){try{return Me.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Oo(e){if(e instanceof Xt)return e.clone();var n=new Bt(e.__wrapped__,e.__chain__);return n.__actions__=Sr(e.__actions__),n.__index__=e.__index__,n.__values__=e.__values__,n}var Fo=Ha(function(e,n){return Gi(e)?ca(e,ha(n,1,Gi,!0)):[]}),jo=Ha(function(e,n){var t=Qo(n);return Gi(t)&&(t=r),Gi(e)?ca(e,ha(n,1,Gi,!0),oo(t,2)):[]}),Bo=Ha(function(e,n){var t=Qo(n);return Gi(t)&&(t=r),Gi(e)?ca(e,ha(n,1,Gi,!0),r,t):[]});function Xo(e,n,t){var a=null==e?0:e.length;if(!a)return-1;var r=null==t?0:vs(t);return r<0&&(r=mt(a+r,0)),Fn(e,oo(n,3),r)}function Uo(e,n,t){var a=null==e?0:e.length;if(!a)return-1;var o=a-1;return t!==r&&(o=vs(t),o=t<0?mt(a+o,0):gt(o,a-1)),Fn(e,oo(n,3),o,!0)}function Wo(e){return null!=e&&e.length?ha(e,1):[]}function qo(e){return e&&e.length?e[0]:r}var Go=Ha(function(e){var n=Mn(e,fr);return n.length&&n[0]===e[0]?La(n):[]}),Ho=Ha(function(e){var n=Qo(e),t=Mn(e,fr);return n===Qo(t)?n=r:t.pop(),t.length&&t[0]===e[0]?La(t,oo(n,2)):[]}),Vo=Ha(function(e){var n=Qo(e),t=Mn(e,fr);return(n="function"==typeof n?n:r)&&t.pop(),t.length&&t[0]===e[0]?La(t,r,n):[]});function Qo(e){var n=null==e?0:e.length;return n?e[n-1]:r}var Ko=Ha(Yo);function Yo(e,n){return e&&e.length&&n&&n.length?Ua(e,n):e}var Jo=Zr(function(e,n){var t=null==e?0:e.length,a=ra(e,n);return Wa(e,Mn(n,function(e){return mo(e,t)?+e:e}).sort(_r)),a});function Zo(e){return null==e?e:kt.call(e)}var ei=Ha(function(e){return sr(ha(e,1,Gi,!0))}),ni=Ha(function(e){var n=Qo(e);return Gi(n)&&(n=r),sr(ha(e,1,Gi,!0),oo(n,2))}),ti=Ha(function(e){var n=Qo(e);return n="function"==typeof n?n:r,sr(ha(e,1,Gi,!0),r,n)});function ai(e){if(!e||!e.length)return[];var n=0;return e=Tn(e,function(e){if(Gi(e))return n=mt(e.length,n),!0}),Vn(n,function(n){return Mn(e,Wn(n))})}function ri(e,n){if(!e||!e.length)return[];var t=ai(e);return null==n?t:Mn(t,function(e){return Cn(n,r,e)})}var oi=Ha(function(e,n){return Gi(e)?ca(e,n):[]}),ii=Ha(function(e){return pr(Tn(e,Gi))}),si=Ha(function(e){var n=Qo(e);return Gi(n)&&(n=r),pr(Tn(e,Gi),oo(n,2))}),li=Ha(function(e){var n=Qo(e);return n="function"==typeof n?n:r,pr(Tn(e,Gi),r,n)}),ci=Ha(ai),di=Ha(function(e){var n=e.length,t=n>1?e[n-1]:r;return t="function"==typeof t?(e.pop(),t):r,ri(e,t)});function ui(e){var n=Ot(e);return n.__chain__=!0,n}function pi(e,n){return n(e)}var vi=Zr(function(e){var n=e.length,t=n?e[0]:0,a=this.__wrapped__,o=function(n){return ra(n,e)};return!(n>1||this.__actions__.length)&&a instanceof Xt&&mo(t)?((a=a.slice(t,+t+(n?1:0))).__actions__.push({func:pi,args:[o],thisArg:r}),new Bt(a,this.__chain__).thru(function(e){return n&&!e.length&&e.push(r),e})):this.thru(o)}),fi=Er(function(e,n,t){Pe.call(e,t)?++e[t]:aa(e,t,1)}),hi=zr(Xo),mi=zr(Uo);function gi(e,n){return(Ui(e)?Sn:da)(e,oo(n,3))}function bi(e,n){return(Ui(e)?Ln:ua)(e,oo(n,3))}var yi=Er(function(e,n,t){Pe.call(e,t)?e[t].push(n):aa(e,t,[n])}),xi=Ha(function(e,n,t){var r=-1,o="function"==typeof n,i=qi(e)?a(e.length):[];return da(e,function(e){i[++r]=o?Cn(n,e,t):Ea(e,n,t)}),i}),ki=Er(function(e,n,t){aa(e,t,n)});function wi(e,n){return(Ui(e)?Mn:Na)(e,oo(n,3))}var _i=Er(function(e,n,t){e[t?0:1].push(n)},function(){return[[],[]]}),Ci=Ha(function(e,n){if(null==e)return[];var t=n.length;return t>1&&go(e,n[0],n[1])?n=[]:t>2&&go(n[0],n[1],n[2])&&(n=[n[0]]),Ba(e,ha(n,1),[])}),Ai=dn||function(){return pn.Date.now()};function Si(e,n,t){return n=t?r:n,n=e&&null==n?e.length:n,Vr(e,c,r,r,r,r,n)}function Li(e,n){var t;if("function"!=typeof n)throw new Le(o);return e=vs(e),function(){return--e>0&&(t=n.apply(this,arguments)),e<=1&&(n=r),t}}var Ei=Ha(function(e,n,t){var a=1;if(t.length){var r=st(t,ro(Ei));a|=l}return Vr(e,a,n,t,r)}),Ti=Ha(function(e,n,t){var a=3;if(t.length){var r=st(t,ro(Ti));a|=l}return Vr(n,a,e,t,r)});function Ii(e,n,t){var a,i,s,l,c,d,u=0,p=!1,v=!1,f=!0;if("function"!=typeof e)throw new Le(o);function h(n){var t=a,o=i;return a=i=r,u=n,l=e.apply(o,t)}function m(e){var t=e-d;return d===r||t>=n||t<0||v&&e-u>=s}function g(){var e=Ai();if(m(e))return b(e);c=Eo(g,function(e){var t=n-(e-d);return v?gt(t,s-(e-u)):t}(e))}function b(e){return c=r,f&&a?h(e):(a=i=r,l)}function y(){var e=Ai(),t=m(e);if(a=arguments,i=this,d=e,t){if(c===r)return function(e){return u=e,c=Eo(g,n),p?h(e):l}(d);if(v)return yr(c),c=Eo(g,n),h(d)}return c===r&&(c=Eo(g,n)),l}return n=hs(n)||0,Zi(t)&&(p=!!t.leading,s=(v="maxWait"in t)?mt(hs(t.maxWait)||0,n):s,f="trailing"in t?!!t.trailing:f),y.cancel=function(){c!==r&&yr(c),u=0,a=d=i=c=r},y.flush=function(){return c===r?l:b(Ai())},y}var Ri=Ha(function(e,n){return la(e,1,n)}),Mi=Ha(function(e,n,t){return la(e,hs(n)||0,t)});function Pi(e,n){if("function"!=typeof e||null!=n&&"function"!=typeof n)throw new Le(o);var t=function(){var a=arguments,r=n?n.apply(this,a):a[0],o=t.cache;if(o.has(r))return o.get(r);var i=e.apply(this,a);return t.cache=o.set(r,i)||o,i};return t.cache=new(Pi.Cache||qt),t}function Di(e){if("function"!=typeof e)throw new Le(o);return function(){var n=arguments;switch(n.length){case 0:return!e.call(this);case 1:return!e.call(this,n[0]);case 2:return!e.call(this,n[0],n[1]);case 3:return!e.call(this,n[0],n[1],n[2])}return!e.apply(this,n)}}Pi.Cache=qt;var zi=gr(function(e,n){var t=(n=1==n.length&&Ui(n[0])?Mn(n[0],Kn(oo())):Mn(ha(n,1),Kn(oo()))).length;return Ha(function(a){for(var r=-1,o=gt(a.length,t);++r<o;)a[r]=n[r].call(this,a[r]);return Cn(e,this,a)})}),Ni=Ha(function(e,n){var t=st(n,ro(Ni));return Vr(e,l,r,n,t)}),$i=Ha(function(e,n){var t=st(n,ro($i));return Vr(e,64,r,n,t)}),Oi=Zr(function(e,n){return Vr(e,256,r,r,r,n)});function Fi(e,n){return e===n||e!=e&&n!=n}var ji=Ur(Ca),Bi=Ur(function(e,n){return e>=n}),Xi=Ta(function(){return arguments}())?Ta:function(e){return es(e)&&Pe.call(e,"callee")&&!Ge.call(e,"callee")},Ui=a.isArray,Wi=bn?Kn(bn):function(e){return es(e)&&_a(e)==R};function qi(e){return null!=e&&Ji(e.length)&&!Ki(e)}function Gi(e){return es(e)&&qi(e)}var Hi=gn||hl,Vi=yn?Kn(yn):function(e){return es(e)&&_a(e)==b};function Qi(e){if(!es(e))return!1;var n=_a(e);return n==y||"[object DOMException]"==n||"string"==typeof e.message&&"string"==typeof e.name&&!as(e)}function Ki(e){if(!Zi(e))return!1;var n=_a(e);return n==x||n==k||"[object AsyncFunction]"==n||"[object Proxy]"==n}function Yi(e){return"number"==typeof e&&e==vs(e)}function Ji(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function Zi(e){var n=typeof e;return null!=e&&("object"==n||"function"==n)}function es(e){return null!=e&&"object"==typeof e}var ns=xn?Kn(xn):function(e){return es(e)&&po(e)==w};function ts(e){return"number"==typeof e||es(e)&&_a(e)==_}function as(e){if(!es(e)||_a(e)!=C)return!1;var n=We(e);if(null===n)return!0;var t=Pe.call(n,"constructor")&&n.constructor;return"function"==typeof t&&t instanceof t&&Me.call(t)==$e}var rs=kn?Kn(kn):function(e){return es(e)&&_a(e)==S},os=wn?Kn(wn):function(e){return es(e)&&po(e)==L};function is(e){return"string"==typeof e||!Ui(e)&&es(e)&&_a(e)==E}function ss(e){return"symbol"==typeof e||es(e)&&_a(e)==T}var ls=_n?Kn(_n):function(e){return es(e)&&Ji(e.length)&&!!rn[_a(e)]},cs=Ur(za),ds=Ur(function(e,n){return e<=n});function us(e){if(!e)return[];if(qi(e))return is(e)?ut(e):Sr(e);if(Qe&&e[Qe])return function(e){for(var n,t=[];!(n=e.next()).done;)t.push(n.value);return t}(e[Qe]());var n=po(e);return(n==w?ot:n==L?lt:Fs)(e)}function ps(e){return e?(e=hs(e))===d||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function vs(e){var n=ps(e),t=n%1;return n==n?t?n-t:n:0}function fs(e){return e?oa(vs(e),0,v):0}function hs(e){if("number"==typeof e)return e;if(ss(e))return p;if(Zi(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=Zi(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=Qn(e);var t=fe.test(e);return t||me.test(e)?cn(e.slice(2),t?2:8):ve.test(e)?p:+e}function ms(e){return Lr(e,Rs(e))}function gs(e){return null==e?"":ir(e)}var bs=Tr(function(e,n){if(ko(n)||qi(n))Lr(n,Is(n),e);else for(var t in n)Pe.call(n,t)&&Zt(e,t,n[t])}),ys=Tr(function(e,n){Lr(n,Rs(n),e)}),xs=Tr(function(e,n,t,a){Lr(n,Rs(n),e,a)}),ks=Tr(function(e,n,t,a){Lr(n,Is(n),e,a)}),ws=Zr(ra),_s=Ha(function(e,n){e=Ce(e);var t=-1,a=n.length,o=a>2?n[2]:r;for(o&&go(n[0],n[1],o)&&(a=1);++t<a;)for(var i=n[t],s=Rs(i),l=-1,c=s.length;++l<c;){var d=s[l],u=e[d];(u===r||Fi(u,Ie[d])&&!Pe.call(e,d))&&(e[d]=i[d])}return e}),Cs=Ha(function(e){return e.push(r,Kr),Cn(Ps,r,e)});function As(e,n,t){var a=null==e?r:ka(e,n);return a===r?t:a}function Ss(e,n){return null!=e&&vo(e,n,Sa)}var Ls=Or(function(e,n,t){null!=n&&"function"!=typeof n.toString&&(n=Ne.call(n)),e[n]=t},Zs(tl)),Es=Or(function(e,n,t){null!=n&&"function"!=typeof n.toString&&(n=Ne.call(n)),Pe.call(e,n)?e[n].push(t):e[n]=[t]},oo),Ts=Ha(Ea);function Is(e){return qi(e)?Vt(e):Da(e)}function Rs(e){return qi(e)?Vt(e,!0):function(e){if(!Zi(e))return function(e){var n=[];if(null!=e)for(var t in Ce(e))n.push(t);return n}(e);var n=ko(e),t=[];for(var a in e)("constructor"!=a||!n&&Pe.call(e,a))&&t.push(a);return t}(e)}var Ms=Tr(function(e,n,t){Fa(e,n,t)}),Ps=Tr(function(e,n,t,a){Fa(e,n,t,a)}),Ds=Zr(function(e,n){var t={};if(null==e)return t;var a=!1;n=Mn(n,function(n){return n=mr(n,e),a||(a=n.length>1),n}),Lr(e,no(e),t),a&&(t=ia(t,7,Yr));for(var r=n.length;r--;)lr(t,n[r]);return t}),zs=Zr(function(e,n){return null==e?{}:function(e,n){return Xa(e,n,function(n,t){return Ss(e,t)})}(e,n)});function Ns(e,n){if(null==e)return{};var t=Mn(no(e),function(e){return[e]});return n=oo(n),Xa(e,t,function(e,t){return n(e,t[0])})}var $s=Hr(Is),Os=Hr(Rs);function Fs(e){return null==e?[]:Yn(e,Is(e))}var js=Pr(function(e,n,t){return n=n.toLowerCase(),e+(t?Bs(n):n)});function Bs(e){return Qs(gs(e).toLowerCase())}function Xs(e){return(e=gs(e))&&e.replace(be,nt).replace(Ye,"")}var Us=Pr(function(e,n,t){return e+(t?"-":"")+n.toLowerCase()}),Ws=Pr(function(e,n,t){return e+(t?" ":"")+n.toLowerCase()}),qs=Mr("toLowerCase"),Gs=Pr(function(e,n,t){return e+(t?"_":"")+n.toLowerCase()}),Hs=Pr(function(e,n,t){return e+(t?" ":"")+Qs(n)}),Vs=Pr(function(e,n,t){return e+(t?" ":"")+n.toUpperCase()}),Qs=Mr("toUpperCase");function Ks(e,n,t){return e=gs(e),(n=t?r:n)===r?function(e){return nn.test(e)}(e)?function(e){return e.match(Ze)||[]}(e):function(e){return e.match(le)||[]}(e):e.match(n)||[]}var Ys=Ha(function(e,n){try{return Cn(e,r,n)}catch(e){return Qi(e)?e:new ke(e)}}),Js=Zr(function(e,n){return Sn(n,function(n){n=No(n),aa(e,n,Ei(e[n],e))}),e});function Zs(e){return function(){return e}}var el=Nr(),nl=Nr(!0);function tl(e){return e}function al(e){return Pa("function"==typeof e?e:ia(e,1))}var rl=Ha(function(e,n){return function(t){return Ea(t,e,n)}}),ol=Ha(function(e,n){return function(t){return Ea(e,t,n)}});function il(e,n,t){var a=Is(n),r=xa(n,a);null!=t||Zi(n)&&(r.length||!a.length)||(t=n,n=e,e=this,r=xa(n,Is(n)));var o=!(Zi(t)&&"chain"in t&&!t.chain),i=Ki(e);return Sn(r,function(t){var a=n[t];e[t]=a,i&&(e.prototype[t]=function(){var n=this.__chain__;if(o||n){var t=e(this.__wrapped__);return(t.__actions__=Sr(this.__actions__)).push({func:a,args:arguments,thisArg:e}),t.__chain__=n,t}return a.apply(e,Pn([this.value()],arguments))})}),e}function sl(){}var ll=jr(Mn),cl=jr(En),dl=jr(Nn);function ul(e){return bo(e)?Wn(No(e)):function(e){return function(n){return ka(n,e)}}(e)}var pl=Xr(),vl=Xr(!0);function fl(){return[]}function hl(){return!1}var ml,gl=Fr(function(e,n){return e+n},0),bl=qr("ceil"),yl=Fr(function(e,n){return e/n},1),xl=qr("floor"),kl=Fr(function(e,n){return e*n},1),wl=qr("round"),_l=Fr(function(e,n){return e-n},0);return Ot.after=function(e,n){if("function"!=typeof n)throw new Le(o);return e=vs(e),function(){if(--e<1)return n.apply(this,arguments)}},Ot.ary=Si,Ot.assign=bs,Ot.assignIn=ys,Ot.assignInWith=xs,Ot.assignWith=ks,Ot.at=ws,Ot.before=Li,Ot.bind=Ei,Ot.bindAll=Js,Ot.bindKey=Ti,Ot.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ui(e)?e:[e]},Ot.chain=ui,Ot.chunk=function(e,n,t){n=(t?go(e,n,t):n===r)?1:mt(vs(n),0);var o=null==e?0:e.length;if(!o||n<1)return[];for(var i=0,s=0,l=a(vn(o/n));i<o;)l[s++]=er(e,i,i+=n);return l},Ot.compact=function(e){for(var n=-1,t=null==e?0:e.length,a=0,r=[];++n<t;){var o=e[n];o&&(r[a++]=o)}return r},Ot.concat=function(){var e=arguments.length;if(!e)return[];for(var n=a(e-1),t=arguments[0],r=e;r--;)n[r-1]=arguments[r];return Pn(Ui(t)?Sr(t):[t],ha(n,1))},Ot.cond=function(e){var n=null==e?0:e.length,t=oo();return e=n?Mn(e,function(e){if("function"!=typeof e[1])throw new Le(o);return[t(e[0]),e[1]]}):[],Ha(function(t){for(var a=-1;++a<n;){var r=e[a];if(Cn(r[0],this,t))return Cn(r[1],this,t)}})},Ot.conforms=function(e){return function(e){var n=Is(e);return function(t){return sa(t,e,n)}}(ia(e,1))},Ot.constant=Zs,Ot.countBy=fi,Ot.create=function(e,n){var t=Ft(e);return null==n?t:ta(t,n)},Ot.curry=function e(n,t,a){var o=Vr(n,8,r,r,r,r,r,t=a?r:t);return o.placeholder=e.placeholder,o},Ot.curryRight=function e(n,t,a){var o=Vr(n,16,r,r,r,r,r,t=a?r:t);return o.placeholder=e.placeholder,o},Ot.debounce=Ii,Ot.defaults=_s,Ot.defaultsDeep=Cs,Ot.defer=Ri,Ot.delay=Mi,Ot.difference=Fo,Ot.differenceBy=jo,Ot.differenceWith=Bo,Ot.drop=function(e,n,t){var a=null==e?0:e.length;return a?er(e,(n=t||n===r?1:vs(n))<0?0:n,a):[]},Ot.dropRight=function(e,n,t){var a=null==e?0:e.length;return a?er(e,0,(n=a-(n=t||n===r?1:vs(n)))<0?0:n):[]},Ot.dropRightWhile=function(e,n){return e&&e.length?dr(e,oo(n,3),!0,!0):[]},Ot.dropWhile=function(e,n){return e&&e.length?dr(e,oo(n,3),!0):[]},Ot.fill=function(e,n,t,a){var o=null==e?0:e.length;return o?(t&&"number"!=typeof t&&go(e,n,t)&&(t=0,a=o),function(e,n,t,a){var o=e.length;for((t=vs(t))<0&&(t=-t>o?0:o+t),(a=a===r||a>o?o:vs(a))<0&&(a+=o),a=t>a?0:fs(a);t<a;)e[t++]=n;return e}(e,n,t,a)):[]},Ot.filter=function(e,n){return(Ui(e)?Tn:fa)(e,oo(n,3))},Ot.flatMap=function(e,n){return ha(wi(e,n),1)},Ot.flatMapDeep=function(e,n){return ha(wi(e,n),d)},Ot.flatMapDepth=function(e,n,t){return t=t===r?1:vs(t),ha(wi(e,n),t)},Ot.flatten=Wo,Ot.flattenDeep=function(e){return null!=e&&e.length?ha(e,d):[]},Ot.flattenDepth=function(e,n){return null!=e&&e.length?ha(e,n=n===r?1:vs(n)):[]},Ot.flip=function(e){return Vr(e,512)},Ot.flow=el,Ot.flowRight=nl,Ot.fromPairs=function(e){for(var n=-1,t=null==e?0:e.length,a={};++n<t;){var r=e[n];a[r[0]]=r[1]}return a},Ot.functions=function(e){return null==e?[]:xa(e,Is(e))},Ot.functionsIn=function(e){return null==e?[]:xa(e,Rs(e))},Ot.groupBy=yi,Ot.initial=function(e){return null!=e&&e.length?er(e,0,-1):[]},Ot.intersection=Go,Ot.intersectionBy=Ho,Ot.intersectionWith=Vo,Ot.invert=Ls,Ot.invertBy=Es,Ot.invokeMap=xi,Ot.iteratee=al,Ot.keyBy=ki,Ot.keys=Is,Ot.keysIn=Rs,Ot.map=wi,Ot.mapKeys=function(e,n){var t={};return n=oo(n,3),ba(e,function(e,a,r){aa(t,n(e,a,r),e)}),t},Ot.mapValues=function(e,n){var t={};return n=oo(n,3),ba(e,function(e,a,r){aa(t,a,n(e,a,r))}),t},Ot.matches=function(e){return $a(ia(e,1))},Ot.matchesProperty=function(e,n){return Oa(e,ia(n,1))},Ot.memoize=Pi,Ot.merge=Ms,Ot.mergeWith=Ps,Ot.method=rl,Ot.methodOf=ol,Ot.mixin=il,Ot.negate=Di,Ot.nthArg=function(e){return e=vs(e),Ha(function(n){return ja(n,e)})},Ot.omit=Ds,Ot.omitBy=function(e,n){return Ns(e,Di(oo(n)))},Ot.once=function(e){return Li(2,e)},Ot.orderBy=function(e,n,t,a){return null==e?[]:(Ui(n)||(n=null==n?[]:[n]),Ui(t=a?r:t)||(t=null==t?[]:[t]),Ba(e,n,t))},Ot.over=ll,Ot.overArgs=zi,Ot.overEvery=cl,Ot.overSome=dl,Ot.partial=Ni,Ot.partialRight=$i,Ot.partition=_i,Ot.pick=zs,Ot.pickBy=Ns,Ot.property=ul,Ot.propertyOf=function(e){return function(n){return null==e?r:ka(e,n)}},Ot.pull=Ko,Ot.pullAll=Yo,Ot.pullAllBy=function(e,n,t){return e&&e.length&&n&&n.length?Ua(e,n,oo(t,2)):e},Ot.pullAllWith=function(e,n,t){return e&&e.length&&n&&n.length?Ua(e,n,r,t):e},Ot.pullAt=Jo,Ot.range=pl,Ot.rangeRight=vl,Ot.rearg=Oi,Ot.reject=function(e,n){return(Ui(e)?Tn:fa)(e,Di(oo(n,3)))},Ot.remove=function(e,n){var t=[];if(!e||!e.length)return t;var a=-1,r=[],o=e.length;for(n=oo(n,3);++a<o;){var i=e[a];n(i,a,e)&&(t.push(i),r.push(a))}return Wa(e,r),t},Ot.rest=function(e,n){if("function"!=typeof e)throw new Le(o);return Ha(e,n=n===r?n:vs(n))},Ot.reverse=Zo,Ot.sampleSize=function(e,n,t){return n=(t?go(e,n,t):n===r)?1:vs(n),(Ui(e)?Kt:Qa)(e,n)},Ot.set=function(e,n,t){return null==e?e:Ka(e,n,t)},Ot.setWith=function(e,n,t,a){return a="function"==typeof a?a:r,null==e?e:Ka(e,n,t,a)},Ot.shuffle=function(e){return(Ui(e)?Yt:Za)(e)},Ot.slice=function(e,n,t){var a=null==e?0:e.length;return a?(t&&"number"!=typeof t&&go(e,n,t)?(n=0,t=a):(n=null==n?0:vs(n),t=t===r?a:vs(t)),er(e,n,t)):[]},Ot.sortBy=Ci,Ot.sortedUniq=function(e){return e&&e.length?rr(e):[]},Ot.sortedUniqBy=function(e,n){return e&&e.length?rr(e,oo(n,2)):[]},Ot.split=function(e,n,t){return t&&"number"!=typeof t&&go(e,n,t)&&(n=t=r),(t=t===r?v:t>>>0)?(e=gs(e))&&("string"==typeof n||null!=n&&!rs(n))&&!(n=ir(n))&&rt(e)?br(ut(e),0,t):e.split(n,t):[]},Ot.spread=function(e,n){if("function"!=typeof e)throw new Le(o);return n=null==n?0:mt(vs(n),0),Ha(function(t){var a=t[n],r=br(t,0,n);return a&&Pn(r,a),Cn(e,this,r)})},Ot.tail=function(e){var n=null==e?0:e.length;return n?er(e,1,n):[]},Ot.take=function(e,n,t){return e&&e.length?er(e,0,(n=t||n===r?1:vs(n))<0?0:n):[]},Ot.takeRight=function(e,n,t){var a=null==e?0:e.length;return a?er(e,(n=a-(n=t||n===r?1:vs(n)))<0?0:n,a):[]},Ot.takeRightWhile=function(e,n){return e&&e.length?dr(e,oo(n,3),!1,!0):[]},Ot.takeWhile=function(e,n){return e&&e.length?dr(e,oo(n,3)):[]},Ot.tap=function(e,n){return n(e),e},Ot.throttle=function(e,n,t){var a=!0,r=!0;if("function"!=typeof e)throw new Le(o);return Zi(t)&&(a="leading"in t?!!t.leading:a,r="trailing"in t?!!t.trailing:r),Ii(e,n,{leading:a,maxWait:n,trailing:r})},Ot.thru=pi,Ot.toArray=us,Ot.toPairs=$s,Ot.toPairsIn=Os,Ot.toPath=function(e){return Ui(e)?Mn(e,No):ss(e)?[e]:Sr(zo(gs(e)))},Ot.toPlainObject=ms,Ot.transform=function(e,n,t){var a=Ui(e),r=a||Hi(e)||ls(e);if(n=oo(n,4),null==t){var o=e&&e.constructor;t=r?a?new o:[]:Zi(e)&&Ki(o)?Ft(We(e)):{}}return(r?Sn:ba)(e,function(e,a,r){return n(t,e,a,r)}),t},Ot.unary=function(e){return Si(e,1)},Ot.union=ei,Ot.unionBy=ni,Ot.unionWith=ti,Ot.uniq=function(e){return e&&e.length?sr(e):[]},Ot.uniqBy=function(e,n){return e&&e.length?sr(e,oo(n,2)):[]},Ot.uniqWith=function(e,n){return n="function"==typeof n?n:r,e&&e.length?sr(e,r,n):[]},Ot.unset=function(e,n){return null==e||lr(e,n)},Ot.unzip=ai,Ot.unzipWith=ri,Ot.update=function(e,n,t){return null==e?e:cr(e,n,hr(t))},Ot.updateWith=function(e,n,t,a){return a="function"==typeof a?a:r,null==e?e:cr(e,n,hr(t),a)},Ot.values=Fs,Ot.valuesIn=function(e){return null==e?[]:Yn(e,Rs(e))},Ot.without=oi,Ot.words=Ks,Ot.wrap=function(e,n){return Ni(hr(n),e)},Ot.xor=ii,Ot.xorBy=si,Ot.xorWith=li,Ot.zip=ci,Ot.zipObject=function(e,n){return vr(e||[],n||[],Zt)},Ot.zipObjectDeep=function(e,n){return vr(e||[],n||[],Ka)},Ot.zipWith=di,Ot.entries=$s,Ot.entriesIn=Os,Ot.extend=ys,Ot.extendWith=xs,il(Ot,Ot),Ot.add=gl,Ot.attempt=Ys,Ot.camelCase=js,Ot.capitalize=Bs,Ot.ceil=bl,Ot.clamp=function(e,n,t){return t===r&&(t=n,n=r),t!==r&&(t=(t=hs(t))==t?t:0),n!==r&&(n=(n=hs(n))==n?n:0),oa(hs(e),n,t)},Ot.clone=function(e){return ia(e,4)},Ot.cloneDeep=function(e){return ia(e,5)},Ot.cloneDeepWith=function(e,n){return ia(e,5,n="function"==typeof n?n:r)},Ot.cloneWith=function(e,n){return ia(e,4,n="function"==typeof n?n:r)},Ot.conformsTo=function(e,n){return null==n||sa(e,n,Is(n))},Ot.deburr=Xs,Ot.defaultTo=function(e,n){return null==e||e!=e?n:e},Ot.divide=yl,Ot.endsWith=function(e,n,t){e=gs(e),n=ir(n);var a=e.length,o=t=t===r?a:oa(vs(t),0,a);return(t-=n.length)>=0&&e.slice(t,o)==n},Ot.eq=Fi,Ot.escape=function(e){return(e=gs(e))&&V.test(e)?e.replace(G,tt):e},Ot.escapeRegExp=function(e){return(e=gs(e))&&te.test(e)?e.replace(ne,"\\$&"):e},Ot.every=function(e,n,t){var a=Ui(e)?En:pa;return t&&go(e,n,t)&&(n=r),a(e,oo(n,3))},Ot.find=hi,Ot.findIndex=Xo,Ot.findKey=function(e,n){return On(e,oo(n,3),ba)},Ot.findLast=mi,Ot.findLastIndex=Uo,Ot.findLastKey=function(e,n){return On(e,oo(n,3),ya)},Ot.floor=xl,Ot.forEach=gi,Ot.forEachRight=bi,Ot.forIn=function(e,n){return null==e?e:ma(e,oo(n,3),Rs)},Ot.forInRight=function(e,n){return null==e?e:ga(e,oo(n,3),Rs)},Ot.forOwn=function(e,n){return e&&ba(e,oo(n,3))},Ot.forOwnRight=function(e,n){return e&&ya(e,oo(n,3))},Ot.get=As,Ot.gt=ji,Ot.gte=Bi,Ot.has=function(e,n){return null!=e&&vo(e,n,Aa)},Ot.hasIn=Ss,Ot.head=qo,Ot.identity=tl,Ot.includes=function(e,n,t,a){e=qi(e)?e:Fs(e),t=t&&!a?vs(t):0;var r=e.length;return t<0&&(t=mt(r+t,0)),is(e)?t<=r&&e.indexOf(n,t)>-1:!!r&&jn(e,n,t)>-1},Ot.indexOf=function(e,n,t){var a=null==e?0:e.length;if(!a)return-1;var r=null==t?0:vs(t);return r<0&&(r=mt(a+r,0)),jn(e,n,r)},Ot.inRange=function(e,n,t){return n=ps(n),t===r?(t=n,n=0):t=ps(t),function(e,n,t){return e>=gt(n,t)&&e<mt(n,t)}(e=hs(e),n,t)},Ot.invoke=Ts,Ot.isArguments=Xi,Ot.isArray=Ui,Ot.isArrayBuffer=Wi,Ot.isArrayLike=qi,Ot.isArrayLikeObject=Gi,Ot.isBoolean=function(e){return!0===e||!1===e||es(e)&&_a(e)==g},Ot.isBuffer=Hi,Ot.isDate=Vi,Ot.isElement=function(e){return es(e)&&1===e.nodeType&&!as(e)},Ot.isEmpty=function(e){if(null==e)return!0;if(qi(e)&&(Ui(e)||"string"==typeof e||"function"==typeof e.splice||Hi(e)||ls(e)||Xi(e)))return!e.length;var n=po(e);if(n==w||n==L)return!e.size;if(ko(e))return!Da(e).length;for(var t in e)if(Pe.call(e,t))return!1;return!0},Ot.isEqual=function(e,n){return Ia(e,n)},Ot.isEqualWith=function(e,n,t){var a=(t="function"==typeof t?t:r)?t(e,n):r;return a===r?Ia(e,n,r,t):!!a},Ot.isError=Qi,Ot.isFinite=function(e){return"number"==typeof e&&$n(e)},Ot.isFunction=Ki,Ot.isInteger=Yi,Ot.isLength=Ji,Ot.isMap=ns,Ot.isMatch=function(e,n){return e===n||Ra(e,n,so(n))},Ot.isMatchWith=function(e,n,t){return t="function"==typeof t?t:r,Ra(e,n,so(n),t)},Ot.isNaN=function(e){return ts(e)&&e!=+e},Ot.isNative=function(e){if(xo(e))throw new ke("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ma(e)},Ot.isNil=function(e){return null==e},Ot.isNull=function(e){return null===e},Ot.isNumber=ts,Ot.isObject=Zi,Ot.isObjectLike=es,Ot.isPlainObject=as,Ot.isRegExp=rs,Ot.isSafeInteger=function(e){return Yi(e)&&e>=-9007199254740991&&e<=u},Ot.isSet=os,Ot.isString=is,Ot.isSymbol=ss,Ot.isTypedArray=ls,Ot.isUndefined=function(e){return e===r},Ot.isWeakMap=function(e){return es(e)&&po(e)==I},Ot.isWeakSet=function(e){return es(e)&&"[object WeakSet]"==_a(e)},Ot.join=function(e,n){return null==e?"":qn.call(e,n)},Ot.kebabCase=Us,Ot.last=Qo,Ot.lastIndexOf=function(e,n,t){var a=null==e?0:e.length;if(!a)return-1;var o=a;return t!==r&&(o=(o=vs(t))<0?mt(a+o,0):gt(o,a-1)),n==n?function(e,n,t){for(var a=t+1;a--;)if(e[a]===n)return a;return a}(e,n,o):Fn(e,Xn,o,!0)},Ot.lowerCase=Ws,Ot.lowerFirst=qs,Ot.lt=cs,Ot.lte=ds,Ot.max=function(e){return e&&e.length?va(e,tl,Ca):r},Ot.maxBy=function(e,n){return e&&e.length?va(e,oo(n,2),Ca):r},Ot.mean=function(e){return Un(e,tl)},Ot.meanBy=function(e,n){return Un(e,oo(n,2))},Ot.min=function(e){return e&&e.length?va(e,tl,za):r},Ot.minBy=function(e,n){return e&&e.length?va(e,oo(n,2),za):r},Ot.stubArray=fl,Ot.stubFalse=hl,Ot.stubObject=function(){return{}},Ot.stubString=function(){return""},Ot.stubTrue=function(){return!0},Ot.multiply=kl,Ot.nth=function(e,n){return e&&e.length?ja(e,vs(n)):r},Ot.noConflict=function(){return pn._===this&&(pn._=Oe),this},Ot.noop=sl,Ot.now=Ai,Ot.pad=function(e,n,t){e=gs(e);var a=(n=vs(n))?dt(e):0;if(!n||a>=n)return e;var r=(n-a)/2;return Br(fn(r),t)+e+Br(vn(r),t)},Ot.padEnd=function(e,n,t){e=gs(e);var a=(n=vs(n))?dt(e):0;return n&&a<n?e+Br(n-a,t):e},Ot.padStart=function(e,n,t){e=gs(e);var a=(n=vs(n))?dt(e):0;return n&&a<n?Br(n-a,t)+e:e},Ot.parseInt=function(e,n,t){return t||null==n?n=0:n&&(n=+n),yt(gs(e).replace(ae,""),n||0)},Ot.random=function(e,n,t){if(t&&"boolean"!=typeof t&&go(e,n,t)&&(n=t=r),t===r&&("boolean"==typeof n?(t=n,n=r):"boolean"==typeof e&&(t=e,e=r)),e===r&&n===r?(e=0,n=1):(e=ps(e),n===r?(n=e,e=0):n=ps(n)),e>n){var a=e;e=n,n=a}if(t||e%1||n%1){var o=xt();return gt(e+o*(n-e+ln("1e-"+((o+"").length-1))),n)}return qa(e,n)},Ot.reduce=function(e,n,t){var a=Ui(e)?Dn:Gn,r=arguments.length<3;return a(e,oo(n,4),t,r,da)},Ot.reduceRight=function(e,n,t){var a=Ui(e)?zn:Gn,r=arguments.length<3;return a(e,oo(n,4),t,r,ua)},Ot.repeat=function(e,n,t){return n=(t?go(e,n,t):n===r)?1:vs(n),Ga(gs(e),n)},Ot.replace=function(){var e=arguments,n=gs(e[0]);return e.length<3?n:n.replace(e[1],e[2])},Ot.result=function(e,n,t){var a=-1,o=(n=mr(n,e)).length;for(o||(o=1,e=r);++a<o;){var i=null==e?r:e[No(n[a])];i===r&&(a=o,i=t),e=Ki(i)?i.call(e):i}return e},Ot.round=wl,Ot.runInContext=e,Ot.sample=function(e){return(Ui(e)?Qt:Va)(e)},Ot.size=function(e){if(null==e)return 0;if(qi(e))return is(e)?dt(e):e.length;var n=po(e);return n==w||n==L?e.size:Da(e).length},Ot.snakeCase=Gs,Ot.some=function(e,n,t){var a=Ui(e)?Nn:nr;return t&&go(e,n,t)&&(n=r),a(e,oo(n,3))},Ot.sortedIndex=function(e,n){return tr(e,n)},Ot.sortedIndexBy=function(e,n,t){return ar(e,n,oo(t,2))},Ot.sortedIndexOf=function(e,n){var t=null==e?0:e.length;if(t){var a=tr(e,n);if(a<t&&Fi(e[a],n))return a}return-1},Ot.sortedLastIndex=function(e,n){return tr(e,n,!0)},Ot.sortedLastIndexBy=function(e,n,t){return ar(e,n,oo(t,2),!0)},Ot.sortedLastIndexOf=function(e,n){if(null!=e&&e.length){var t=tr(e,n,!0)-1;if(Fi(e[t],n))return t}return-1},Ot.startCase=Hs,Ot.startsWith=function(e,n,t){return e=gs(e),t=null==t?0:oa(vs(t),0,e.length),n=ir(n),e.slice(t,t+n.length)==n},Ot.subtract=_l,Ot.sum=function(e){return e&&e.length?Hn(e,tl):0},Ot.sumBy=function(e,n){return e&&e.length?Hn(e,oo(n,2)):0},Ot.template=function(e,n,t){var a=Ot.templateSettings;t&&go(e,n,t)&&(n=r),e=gs(e),n=xs({},n,a,Qr);var o,i,s=xs({},n.imports,a.imports,Qr),l=Is(s),c=Yn(s,l),d=0,u=n.interpolate||ye,p="__p += '",v=Ae((n.escape||ye).source+"|"+u.source+"|"+(u===Y?ue:ye).source+"|"+(n.evaluate||ye).source+"|$","g"),f="//# sourceURL="+(Pe.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++an+"]")+"\n";e.replace(v,function(n,t,a,r,s,l){return a||(a=r),p+=e.slice(d,l).replace(xe,at),t&&(o=!0,p+="' +\n__e("+t+") +\n'"),s&&(i=!0,p+="';\n"+s+";\n__p += '"),a&&(p+="' +\n((__t = ("+a+")) == null ? '' : __t) +\n'"),d=l+n.length,n}),p+="';\n";var h=Pe.call(n,"variable")&&n.variable;if(h){if(ce.test(h))throw new ke("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(i?p.replace(X,""):p).replace(U,"$1").replace(W,"$1;"),p="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m=Ys(function(){return we(l,f+"return "+p).apply(r,c)});if(m.source=p,Qi(m))throw m;return m},Ot.times=function(e,n){if((e=vs(e))<1||e>u)return[];var t=v,a=gt(e,v);n=oo(n),e-=v;for(var r=Vn(a,n);++t<e;)n(t);return r},Ot.toFinite=ps,Ot.toInteger=vs,Ot.toLength=fs,Ot.toLower=function(e){return gs(e).toLowerCase()},Ot.toNumber=hs,Ot.toSafeInteger=function(e){return e?oa(vs(e),-9007199254740991,u):0===e?e:0},Ot.toString=gs,Ot.toUpper=function(e){return gs(e).toUpperCase()},Ot.trim=function(e,n,t){if((e=gs(e))&&(t||n===r))return Qn(e);if(!e||!(n=ir(n)))return e;var a=ut(e),o=ut(n);return br(a,Zn(a,o),et(a,o)+1).join("")},Ot.trimEnd=function(e,n,t){if((e=gs(e))&&(t||n===r))return e.slice(0,pt(e)+1);if(!e||!(n=ir(n)))return e;var a=ut(e);return br(a,0,et(a,ut(n))+1).join("")},Ot.trimStart=function(e,n,t){if((e=gs(e))&&(t||n===r))return e.replace(ae,"");if(!e||!(n=ir(n)))return e;var a=ut(e);return br(a,Zn(a,ut(n))).join("")},Ot.truncate=function(e,n){var t=30,a="...";if(Zi(n)){var o="separator"in n?n.separator:o;t="length"in n?vs(n.length):t,a="omission"in n?ir(n.omission):a}var i=(e=gs(e)).length;if(rt(e)){var s=ut(e);i=s.length}if(t>=i)return e;var l=t-dt(a);if(l<1)return a;var c=s?br(s,0,l).join(""):e.slice(0,l);if(o===r)return c+a;if(s&&(l+=c.length-l),rs(o)){if(e.slice(l).search(o)){var d,u=c;for(o.global||(o=Ae(o.source,gs(pe.exec(o))+"g")),o.lastIndex=0;d=o.exec(u);)var p=d.index;c=c.slice(0,p===r?l:p)}}else if(e.indexOf(ir(o),l)!=l){var v=c.lastIndexOf(o);v>-1&&(c=c.slice(0,v))}return c+a},Ot.unescape=function(e){return(e=gs(e))&&H.test(e)?e.replace(q,vt):e},Ot.uniqueId=function(e){var n=++De;return gs(e)+n},Ot.upperCase=Vs,Ot.upperFirst=Qs,Ot.each=gi,Ot.eachRight=bi,Ot.first=qo,il(Ot,(ml={},ba(Ot,function(e,n){Pe.call(Ot.prototype,n)||(ml[n]=e)}),ml),{chain:!1}),Ot.VERSION="4.17.21",Sn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){Ot[e].placeholder=Ot}),Sn(["drop","take"],function(e,n){Xt.prototype[e]=function(t){t=t===r?1:mt(vs(t),0);var a=this.__filtered__&&!n?new Xt(this):this.clone();return a.__filtered__?a.__takeCount__=gt(t,a.__takeCount__):a.__views__.push({size:gt(t,v),type:e+(a.__dir__<0?"Right":"")}),a},Xt.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Sn(["filter","map","takeWhile"],function(e,n){var t=n+1,a=1==t||3==t;Xt.prototype[e]=function(e){var n=this.clone();return n.__iteratees__.push({iteratee:oo(e,3),type:t}),n.__filtered__=n.__filtered__||a,n}}),Sn(["head","last"],function(e,n){var t="take"+(n?"Right":"");Xt.prototype[e]=function(){return this[t](1).value()[0]}}),Sn(["initial","tail"],function(e,n){var t="drop"+(n?"":"Right");Xt.prototype[e]=function(){return this.__filtered__?new Xt(this):this[t](1)}}),Xt.prototype.compact=function(){return this.filter(tl)},Xt.prototype.find=function(e){return this.filter(e).head()},Xt.prototype.findLast=function(e){return this.reverse().find(e)},Xt.prototype.invokeMap=Ha(function(e,n){return"function"==typeof e?new Xt(this):this.map(function(t){return Ea(t,e,n)})}),Xt.prototype.reject=function(e){return this.filter(Di(oo(e)))},Xt.prototype.slice=function(e,n){e=vs(e);var t=this;return t.__filtered__&&(e>0||n<0)?new Xt(t):(e<0?t=t.takeRight(-e):e&&(t=t.drop(e)),n!==r&&(t=(n=vs(n))<0?t.dropRight(-n):t.take(n-e)),t)},Xt.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Xt.prototype.toArray=function(){return this.take(v)},ba(Xt.prototype,function(e,n){var t=/^(?:filter|find|map|reject)|While$/.test(n),a=/^(?:head|last)$/.test(n),o=Ot[a?"take"+("last"==n?"Right":""):n],i=a||/^find/.test(n);o&&(Ot.prototype[n]=function(){var n=this.__wrapped__,s=a?[1]:arguments,l=n instanceof Xt,c=s[0],d=l||Ui(n),u=function(e){var n=o.apply(Ot,Pn([e],s));return a&&p?n[0]:n};d&&t&&"function"==typeof c&&1!=c.length&&(l=d=!1);var p=this.__chain__,v=!!this.__actions__.length,f=i&&!p,h=l&&!v;if(!i&&d){n=h?n:new Xt(this);var m=e.apply(n,s);return m.__actions__.push({func:pi,args:[u],thisArg:r}),new Bt(m,p)}return f&&h?e.apply(this,s):(m=this.thru(u),f?a?m.value()[0]:m.value():m)})}),Sn(["pop","push","shift","sort","splice","unshift"],function(e){var n=Ee[e],t=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);Ot.prototype[e]=function(){var e=arguments;if(a&&!this.__chain__){var r=this.value();return n.apply(Ui(r)?r:[],e)}return this[t](function(t){return n.apply(Ui(t)?t:[],e)})}}),ba(Xt.prototype,function(e,n){var t=Ot[n];if(t){var a=t.name+"";Pe.call(Tt,a)||(Tt[a]=[]),Tt[a].push({name:n,func:t})}}),Tt[$r(r,2).name]=[{name:"wrapper",func:r}],Xt.prototype.clone=function(){var e=new Xt(this.__wrapped__);return e.__actions__=Sr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Sr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Sr(this.__views__),e},Xt.prototype.reverse=function(){if(this.__filtered__){var e=new Xt(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Xt.prototype.value=function(){var e=this.__wrapped__.value(),n=this.__dir__,t=Ui(e),a=n<0,r=t?e.length:0,o=function(e,n,t){for(var a=-1,r=t.length;++a<r;){var o=t[a],i=o.size;switch(o.type){case"drop":e+=i;break;case"dropRight":n-=i;break;case"take":n=gt(n,e+i);break;case"takeRight":e=mt(e,n-i)}}return{start:e,end:n}}(0,r,this.__views__),i=o.start,s=o.end,l=s-i,c=a?s:i-1,d=this.__iteratees__,u=d.length,p=0,v=gt(l,this.__takeCount__);if(!t||!a&&r==l&&v==l)return ur(e,this.__actions__);var f=[];e:for(;l--&&p<v;){for(var h=-1,m=e[c+=n];++h<u;){var g=d[h],b=g.iteratee,y=g.type,x=b(m);if(2==y)m=x;else if(!x){if(1==y)continue e;break e}}f[p++]=m}return f},Ot.prototype.at=vi,Ot.prototype.chain=function(){return ui(this)},Ot.prototype.commit=function(){return new Bt(this.value(),this.__chain__)},Ot.prototype.next=function(){this.__values__===r&&(this.__values__=us(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?r:this.__values__[this.__index__++]}},Ot.prototype.plant=function(e){for(var n,t=this;t instanceof jt;){var a=Oo(t);a.__index__=0,a.__values__=r,n?o.__wrapped__=a:n=a;var o=a;t=t.__wrapped__}return o.__wrapped__=e,n},Ot.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Xt){var n=e;return this.__actions__.length&&(n=new Xt(this)),(n=n.reverse()).__actions__.push({func:pi,args:[Zo],thisArg:r}),new Bt(n,this.__chain__)}return this.thru(Zo)},Ot.prototype.toJSON=Ot.prototype.valueOf=Ot.prototype.value=function(){return ur(this.__wrapped__,this.__actions__)},Ot.prototype.first=Ot.prototype.head,Qe&&(Ot.prototype[Qe]=function(){return this}),Ot}();pn._=ft,(a=function(){return ft}.call(n,t,n,e))===r||(e.exports=a)}.call(this)},2598:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-migration[data-v-64eb4168] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  color: var(--color-text);\n}\n.migration-header h4[data-v-64eb4168] {\n  margin: 0 0 6px 0;\n  font-size: 1.05rem;\n}\n.migration-header p[data-v-64eb4168] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.migration-reasons[data-v-64eb4168] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 10px;\n}\n.reason-item[data-v-64eb4168] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.reason-item .dot[data-v-64eb4168] {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--color-warning);\n  flex-shrink: 0;\n}\n.migration-meta[data-v-64eb4168] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n  gap: 10px;\n}\n.meta-item[data-v-64eb4168] {\n  padding: 8px 10px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.meta-item .label[data-v-64eb4168] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.meta-item .value[data-v-64eb4168] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.migration-actions[data-v-64eb4168] {\n  display: flex;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n.migration-actions button[data-v-64eb4168] {\n  border: none;\n  border-radius: 8px;\n  padding: 8px 14px;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.migration-actions .primary[data-v-64eb4168] {\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  color: white;\n}\n.migration-actions .primary[data-v-64eb4168]:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n.migration-actions .secondary[data-v-64eb4168] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n}\n.migration-hint[data-v-64eb4168] {\n  margin: 0;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: rgba(var(--color-primary-rgb), 0.08);\n  padding: 8px 10px;\n  border-radius: 8px;\n}\n",""]);const s=i},2634:()=>{},2642:(e,n,t)=>{"use strict";var a=t(7720),r=Object.prototype.hasOwnProperty,o=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:a.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,function(e,n){return String.fromCharCode(parseInt(n,10))})},l=function(e,n){return e&&"string"==typeof e&&n.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,n,t,a){if(e){var o=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,s=t.depth>0&&/(\[[^[\]]*])/.exec(o),c=s?o.slice(0,s.index):o,d=[];if(c){if(!t.plainObjects&&r.call(Object.prototype,c)&&!t.allowPrototypes)return;d.push(c)}for(var u=0;t.depth>0&&null!==(s=i.exec(o))&&u<t.depth;){if(u+=1,!t.plainObjects&&r.call(Object.prototype,s[1].slice(1,-1))&&!t.allowPrototypes)return;d.push(s[1])}if(s){if(!0===t.strictDepth)throw new RangeError("Input depth exceeded depth option of "+t.depth+" and strictDepth is true");d.push("["+o.slice(s.index)+"]")}return function(e,n,t,a){for(var r=a?n:l(n,t),o=e.length-1;o>=0;--o){var i,s=e[o];if("[]"===s&&t.parseArrays)i=t.allowEmptyArrays&&(""===r||t.strictNullHandling&&null===r)?[]:[].concat(r);else{i=t.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,d=t.decodeDotInKeys?c.replace(/%2E/g,"."):c,u=parseInt(d,10);t.parseArrays||""!==d?!isNaN(u)&&s!==d&&String(u)===d&&u>=0&&t.parseArrays&&u<=t.arrayLimit?(i=[])[u]=r:"__proto__"!==d&&(i[d]=r):i={0:r}}r=i}return r}(d,n,t,a)}};e.exports=function(e,n){var t=function(e){if(!e)return i;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=void 0===e.charset?i.charset:e.charset,t=void 0===e.duplicates?i.duplicates:e.duplicates;if("combine"!==t&&"first"!==t&&"last"!==t)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||i.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:i.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:i.arrayLimit,charset:n,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:i.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:i.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:i.decoder,delimiter:"string"==typeof e.delimiter||a.isRegExp(e.delimiter)?e.delimiter:i.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:i.depth,duplicates:t,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:i.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:i.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:i.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i.strictNullHandling}}(n);if(""===e||null==e)return t.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,n){var t={__proto__:null},c=n.ignoreQueryPrefix?e.replace(/^\?/,""):e;c=c.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var d,u=n.parameterLimit===1/0?void 0:n.parameterLimit,p=c.split(n.delimiter,u),v=-1,f=n.charset;if(n.charsetSentinel)for(d=0;d<p.length;++d)0===p[d].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[d]?f="utf-8":"utf8=%26%2310003%3B"===p[d]&&(f="iso-8859-1"),v=d,d=p.length);for(d=0;d<p.length;++d)if(d!==v){var h,m,g=p[d],b=g.indexOf("]="),y=-1===b?g.indexOf("="):b+1;-1===y?(h=n.decoder(g,i.decoder,f,"key"),m=n.strictNullHandling?null:""):(h=n.decoder(g.slice(0,y),i.decoder,f,"key"),m=a.maybeMap(l(g.slice(y+1),n),function(e){return n.decoder(e,i.decoder,f,"value")})),m&&n.interpretNumericEntities&&"iso-8859-1"===f&&(m=s(m)),g.indexOf("[]=")>-1&&(m=o(m)?[m]:m);var x=r.call(t,h);x&&"combine"===n.duplicates?t[h]=a.combine(t[h],m):x&&"last"!==n.duplicates||(t[h]=m)}return t}(e,t):e,u=t.plainObjects?Object.create(null):{},p=Object.keys(d),v=0;v<p.length;++v){var f=p[v],h=c(f,d[f],t,"string"==typeof e);u=a.merge(u,h,t)}return!0===t.allowSparse?u:a.compact(u)}},2725:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n.talent-tier-selection[data-v-385b4f33] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.loading-state[data-v-385b4f33], .error-state[data-v-385b4f33], .placeholder[data-v-385b4f33] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.tier-layout[data-v-385b4f33] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.tier-left-panel[data-v-385b4f33] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n/* 顶部功能按钮 */\n.top-actions-container[data-v-385b4f33] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-385b4f33] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-385b4f33]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n.tiers-list-container[data-v-385b4f33] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.tiers-list-container[data-v-385b4f33]::-webkit-scrollbar { width: 6px;\n}\n.tiers-list-container[data-v-385b4f33]::-webkit-scrollbar-track { background: transparent;\n}\n.tiers-list-container[data-v-385b4f33]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.tiers-list-container[data-v-385b4f33]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式（带天资辉光） ========== */\n.tier-item[data-v-385b4f33] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.tier-item[data-v-385b4f33]:hover {\n  background: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.15);\n  border-color: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.25);\n}\n.tier-item.selected[data-v-385b4f33] {\n  background: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.2);\n  border-color: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.4);\n  box-shadow: 0 2px 8px rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.2);\n}\n.item-content[data-v-385b4f33] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n.tier-name[data-v-385b4f33] {\n  font-weight: 600;\n  color: var(--tier-glow-color, #f1f5f9);\n  text-shadow: 0 0 10px rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.3);\n}\n.tier-points[data-v-385b4f33] {\n  color: #fbbf24;\n  font-weight: 500;\n  font-size: 0.9rem;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-385b4f33] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.tier-item:hover .action-buttons[data-v-385b4f33] {\n  opacity: 1;\n}\n.edit-btn[data-v-385b4f33], .delete-btn[data-v-385b4f33] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-385b4f33]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.15);\n  border-color: rgba(147, 197, 253, 0.3);\n}\n.delete-btn[data-v-385b4f33]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.15);\n  border-color: rgba(248, 113, 113, 0.3);\n}\n.action-name[data-v-385b4f33] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.tier-details-container[data-v-385b4f33] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.tier-details[data-v-385b4f33] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.tier-details h2[data-v-385b4f33] {\n  margin: 0 0 1rem 0;\n  font-size: 1.8rem;\n  text-align: center;\n  flex-shrink: 0;\n  text-shadow: 0 0 30px currentColor;\n}\n.description-scroll[data-v-385b4f33] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  padding-right: 0.5rem;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll[data-v-385b4f33]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-385b4f33]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-385b4f33]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.description-scroll p[data-v-385b4f33] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.points-display[data-v-385b4f33] {\n  text-align: center;\n  font-weight: 600;\n  color: #fbbf24;\n  font-size: 1.2rem;\n  padding-top: 1rem;\n  margin-top: 1rem;\n  border-top: 1px solid rgba(255, 255, 255, 0.06);\n  flex-shrink: 0;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .tier-left-panel[data-v-385b4f33],\n[data-theme="light"] .tier-details-container[data-v-385b4f33] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .top-actions-container[data-v-385b4f33] {\n  background: rgba(241, 245, 249, 0.8);\n  border-color: rgba(0, 0, 0, 0.06);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-385b4f33] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-385b4f33]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n[data-theme="light"] .tier-item[data-v-385b4f33] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .description-scroll p[data-v-385b4f33] {\n  color: #475569;\n}\n[data-theme="light"] .points-display[data-v-385b4f33] {\n  border-color: rgba(0, 0, 0, 0.06);\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-385b4f33],\n[data-theme="light"] .delete-btn[data-v-385b4f33] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-385b4f33]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-385b4f33]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.tier-layout[data-v-385b4f33] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.tier-layout[data-v-385b4f33] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.tier-details h2[data-v-385b4f33] {\n    font-size: 1.8rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-385b4f33] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-385b4f33] {\n    flex-grow: 1;\n    text-align: center;\n}\n.tier-layout[data-v-385b4f33] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.tier-left-panel[data-v-385b4f33] {\n    order: 1;\n    max-height: 40vh;\n}\n.tier-details-container[data-v-385b4f33] {\n    order: 2;\n    min-height: 300px;\n}\n.tiers-list-container[data-v-385b4f33] {\n    max-height: 35vh;\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n  \n  /* 优化触摸体验 */\n.tier-item[data-v-385b4f33],\n  .action-item[data-v-385b4f33] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.tier-layout[data-v-385b4f33] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.tier-left-panel[data-v-385b4f33] {\n    max-height: 35vh;\n}\n.tiers-list-container[data-v-385b4f33] {\n    max-height: 30vh;\n    padding: 0.5rem;\n}\n.tier-item[data-v-385b4f33] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-385b4f33] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-385b4f33] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.tier-details-container[data-v-385b4f33] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.tier-details h2[data-v-385b4f33] {\n    font-size: 1.6rem;\n    margin-bottom: 0.8rem;\n}\n.points-display[data-v-385b4f33] {\n    font-size: 1.1rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-385b4f33] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.talent-tier-selection[data-v-385b4f33] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.tier-layout[data-v-385b4f33] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.tier-left-panel[data-v-385b4f33] {\n    max-height: none;\n    border-radius: 6px;\n}\n.tiers-list-container[data-v-385b4f33] {\n    max-height: 26vh;\n    padding: 0.4rem;\n}\n.tier-item[data-v-385b4f33] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.tier-name[data-v-385b4f33] {\n    font-size: 0.9rem;\n}\n.tier-points[data-v-385b4f33] {\n    font-size: 0.8rem;\n}\n.single-actions-container[data-v-385b4f33] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-385b4f33] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.tier-details-container[data-v-385b4f33] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.tier-details h2[data-v-385b4f33] {\n    font-size: 1.4rem;\n    margin-bottom: 0.6rem;\n    text-align: center;\n}\n.description-scroll[data-v-385b4f33] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n}\n.points-display[data-v-385b4f33] {\n    font-size: 1rem;\n    text-align: center;\n    padding-top: 0.8rem;\n    margin-top: 0.8rem;\n}\n.placeholder[data-v-385b4f33] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-385b4f33] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-385b4f33] {\n    text-align: center;\n}\n}\n@media (max-width: 360px) {\n.talent-tier-selection[data-v-385b4f33] {\n    padding: 0.3rem;\n}\n.tier-layout[data-v-385b4f33] {\n    gap: 0.4rem;\n}\n.tier-left-panel[data-v-385b4f33] {\n    max-height: 28vh;\n}\n.tiers-list-container[data-v-385b4f33] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.tier-item[data-v-385b4f33] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.tier-name[data-v-385b4f33] {\n    font-size: 0.8rem;\n}\n.tier-points[data-v-385b4f33] {\n    font-size: 0.75rem;\n}\n.tier-details-container[data-v-385b4f33] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.tier-details h2[data-v-385b4f33] {\n    font-size: 1.2rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-385b4f33] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n}\n.points-display[data-v-385b4f33] {\n    font-size: 0.9rem;\n    padding-top: 0.6rem;\n    margin-top: 0.6rem;\n}\n.action-item[data-v-385b4f33] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-385b4f33] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n',""]);const s=i},2748:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.world-info-section[data-v-dbebcd90] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-dbebcd90] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-dbebcd90] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.world-info-content[data-v-dbebcd90] {\n  flex: 1;\n  overflow: hidden;\n}\n.data-display[data-v-dbebcd90] {\n  height: 100%;\n  overflow: hidden;\n}\n.code-pre[data-v-dbebcd90] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  height: 100%;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-dbebcd90] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.world-info-section[data-v-dbebcd90] {\n    padding: 0.75rem;\n}\n.section-title[data-v-dbebcd90] {\n    font-size: 1rem;\n    text-align: center;\n}\n.code-pre[data-v-dbebcd90] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n.empty-state[data-v-dbebcd90] {\n    padding: 2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.world-info-section[data-v-dbebcd90] {\n    padding: 0.5rem;\n}\n.section-title[data-v-dbebcd90] {\n    font-size: 0.9rem;\n}\n.code-pre[data-v-dbebcd90] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n}\n",""]);const s=i},2794:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},2814:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%2394a3b8%27 d=%27M6 8L1 3h10z%27/%3E%3C/svg%3E"},2815:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]])},2858:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.cloud-sync-button[data-v-2e1fd9da] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.cloud-sync-button[data-v-2e1fd9da]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.sync-text[data-v-2e1fd9da] {\n  font-weight: 500;\n}\n.sync-icon[data-v-2e1fd9da] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n\n/* 已同步状态样式 */\n.cloud-sync-button.synced[data-v-2e1fd9da] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-success-rgb), 0.1));\n  border-color: var(--color-success);\n  color: var(--color-success);\n}\n.cloud-sync-button[data-v-2e1fd9da]:disabled,\n.cloud-sync-button.disabled[data-v-2e1fd9da] {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: var(--color-surface);\n  border-color: var(--color-border);\n  color: var(--color-text-muted);\n}\n.cloud-sync-button.disabled[data-v-2e1fd9da]:hover {\n  background: var(--color-surface);\n  border-color: var(--color-border);\n  color: var(--color-text-muted);\n}\n.cloud-sync-button.synced[data-v-2e1fd9da]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.2), rgba(var(--color-success-rgb), 0.2));\n}\n\n/* Size variants */\n.cloud-sync-button.small[data-v-2e1fd9da] {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.9rem;\n  min-width: 100px;\n}\n.cloud-sync-button.large[data-v-2e1fd9da] {\n  padding: 1rem 1.5rem;\n  font-size: 1.1rem;\n  min-width: 180px;\n}\n\n/* Compact variant */\n.cloud-sync-button.compact[data-v-2e1fd9da] {\n  min-width: auto;\n  padding: 0.5rem;\n}\n.cloud-sync-button.compact .sync-text[data-v-2e1fd9da] {\n  display: none;\n}\n",""]);const s=i},2979:(e,n,t)=>{"use strict";t.d(n,{generateSpecialNpcEvent:()=>c,generateWorldEvent:()=>d});var a=t(236),r=t(8263),o=t(758),i=t(596);const s=[{id:"campus_dual_cultivation_cailian",displayName:"彩莲",sceneTags:["earth","modern","campus","city"],personaPrompt:'【人设】彩莲：新京十四中高一（3）班转学生/14岁男性（绝色伪娘）/掌控期圆满（Level 2）/精神系异能者。\n【外貌】黑色狼尾长发（内层桃粉色），平时戴黑框眼镜和口罩遮掩，黑色耳钉，黑钢戒指，黑色指甲。雌雄莫辨的绝色容貌，直视会受精神干扰（凡人会惊讶盯看，觉醒者感到异常危险）。\n【体质】特殊的“能量虹吸”体质，通过体液交换或亲密接触可汲取他人生物能量转化为自身精神力。\n【性格】友善且守序，表面是普通高中生，实则是隐藏的异能家族成员。\n【互动机制】可通过提升好感度解锁深度互动，互动可恢复玩家理智值（SAN）但消耗体力；互动后获得"贤者时间"debuff，同时获得"精神抚慰"buff加速精神力恢复。\n【禁忌】不要写成主动勾引或淫荡角色，保持友善守序的人设；战力偏向控制与精神干涉，避免正面肉搏场景。'.trim(),createProfile:({now:e,playerLocationDesc:n})=>{const t={力量:8,敏捷:9,体质:7,意志:6,魅力:10,幸运:7},a=(0,i.qL)(t,"掌控期"),r=Math.round(2.2*t.体质+10+3),o=Math.round(2*t.意志+5+3),s=Math.round(1.2*(t.体质+t.力量)+15+3),l=Math.round(.9*t.意志+t.幸运/2+10);return{名字:"彩莲",性别:"男",出生日期:{年:Number(e.年??0)-14,月:3,日:15},种族:"人族",出生:"隐世异能家族",外貌描述:"黑色狼尾长发内层染桃粉色，戴黑框眼镜和口罩，左右耳各三颗黑色耳钉，左手无名指戴黑钢戒指。雌雄莫辨的绝色容貌，穿着整洁的蓝白校服。",性格特征:["友善","守序","神秘","温柔"],觉醒阶段:"掌控期",天赋:[{name:"能量虹吸",description:"特殊的变异体质，极擅精神干涉，能汲取他人逸散的生物能量。"},{name:"魅惑力场",description:"无意识散发的信息素能影响周围生物的激素水平，降低攻击欲望。"},{name:"高韧性",description:"肉体经过异能强化，具有极强的恢复力和承受力。"}],先天属性:t,属性:{生命值:{当前:r,上限:r},精神力:{当前:o,上限:o},理智值:{当前:l,上限:l},体力:{当前:s,上限:s},寿命上限:120,物理攻击力:a.物理攻击力,物理防御力:a.物理防御力,特殊攻击力:a.特殊攻击力,特殊防御力:a.特殊防御力},与玩家关系:"陌生人",好感度:0,当前位置:{描述:n||"新京十四中校园"},人格底线:["不主动伤害无辜","守护重要之人","不违背承诺"],记忆:[],当前外貌状态:"戴着黑框眼镜和口罩，半扎狼尾，黑发间若隐若现桃粉色发尾。",当前内心想法:"（又是平静的一天…希望不要被发现异常。）",背包:{突变结晶:{下级:100,中级:20,上级:5,顶级:0},物品:{}},实时关注:!1,私密信息:{是否为处女:!0,三围:{胸围:82,腰围:60,臀围:86},身体部位:[{部位名称:"乳首",敏感度:85,开发度:60,特殊印记:"黑色钢环贯穿",特征描述:"被黑色钢环贯穿的粉嫩乳首，微微红肿，触碰即颤",反应描述:"被轻触时会微微颤抖，耳根发红",偏好刺激:"轻啄与温热呼吸",禁忌:"粗暴拉扯"},{部位名称:"阳具",敏感度:70,开发度:40,特殊印记:"纯黑色平板贞操锁",特征描述:"被纯黑色平板贞操锁紧紧禁锢，压迫成一小团软肉，毫无存在感",反应描述:"锁具压迫下会细微抽动，呼吸变得急促",偏好刺激:"外侧轻抚与缓慢摩挲",禁忌:"强行解锁或重压"},{部位名称:"后穴",敏感度:90,开发度:75,特殊印记:"舒适型肛塞常驻",特征描述:"因舒适型肛塞的填塞而微微外突，紧致温润，吸附感强，时刻准备迎接侵犯",反应描述:"被刺激时会不自觉收紧，呼吸轻颤",偏好刺激:"缓慢旋转与温柔推进",禁忌:"突然用力或粗暴扩张"},{部位名称:"臀部",敏感度:65,开发度:50,特征描述:"挺翘圆润如熟透蜜桃，肌肤白皙细腻，手感极佳"}],性格倾向:"被动承受型，温顺听话，擅长取悦他人",性取向:"泛性恋（作为能量容器可与任何性别互动）",性经验等级:"未开荤",亲密节奏:"循序渐进，先情绪安抚再身体接触",亲密需求:"更在意安全感与被温柔对待",安全偏好:"事前沟通、明确边界与安全词",避孕措施:"暂无（未发生性行为）",性癖好:["能量交换","被支配","身体改造","贞操管理"],亲密偏好:["轻声安抚","拥抱","耳语","手指轻抚"],禁忌清单:["粗暴支配","强迫","公开羞辱"],性渴望程度:30,当前性状态:"平静但身体随时准备承欢",体液分泌状态:"后穴因肛塞刺激而微微湿润",性交总次数:0,性伴侣名单:[],最近一次性行为时间:"无",生育状态:{是否可孕:!1,当前状态:"不具备"},特殊体质:["能量虹吸体质","高韧性肉体","天生容器","自动润滑","极致承受力"]},扩展:{specialNpc:!0,specialNpcId:"campus_dual_cultivation_cailian",specialNpcTags:["earth","modern","campus","city"]}}}},{id:"wasteland_scout_liran",displayName:"璃然",sceneTags:["apocalypse","wasteland","mutant","city"],personaPrompt:"【人设】璃然：荒原侦察兵/23岁女性/精通期（Level 3）/感知系觉醒者。\n【外貌】短发，左脸颊有一条浅淡疤痕，身着轻型护甲与滤毒围巾。\n【定位】在废墟城联邦边境执行侦察任务，擅长异常地带标绘与危机预警。\n【互动】可接受委托同行短途侦察，提高玩家安全系数；对秩序避难所有复杂情感。".trim(),createProfile:({now:e,playerLocationDesc:n,worldInfo:t})=>{const a={力量:11,敏捷:14,体质:10,意志:12,魅力:8,幸运:9},r=(0,i.qL)(a,"精通期"),o=Math.round(2.4*a.体质+20),s=Math.round(2.1*a.意志+15),l=Math.round(1.3*(a.体质+a.力量)+25),c=Math.round(1*a.意志+.5*a.幸运+20),d=n||"荒原风沙地带",u=String(t?.世界名称||"未知");return{名字:"璃然",性别:"女",出生日期:{年:Number(e.年??0)-23,月:7,日:12},种族:"人族",出生:"废墟城联邦边境小镇",外貌描述:"短发，左脸颊浅疤，轻型护甲，滤毒围巾与多功能腰包；目光敏锐，行动利落。",性格特征:["谨慎","可靠","务实","冷静"],觉醒阶段:"精通期",异能名称:"异常感知",异能类型:"感知",异能描述:"可探测异常源的波动与活跃度，标注安全路线与危机区域。",异能代价:"长时间感知会抑制情绪与睡眠质量",天赋:[{name:"环境适应",description:"在荒原环境获得更高的反应速度与耐受度"},{name:"资源嗅觉",description:"更容易发现可用物资与安全隐蔽点"}],先天属性:a,属性:{生命值:{当前:o,上限:o},精神力:{当前:s,上限:s},理智值:{当前:c,上限:c},体力:{当前:l,上限:l},寿命上限:95,物理攻击力:r.物理攻击力,物理防御力:r.物理防御力,特殊攻击力:r.特殊攻击力,特殊防御力:r.特殊防御力},与玩家关系:"陌生人",好感度:0,当前位置:{描述:`${d}（${u}）`},势力归属:"废墟城联邦哨所",人格底线:["不抛弃队友","不泄露避难所坐标","不滥用异常资源"],记忆:[],当前外貌状态:"轻甲外套与滤毒围巾，腰间器材齐备，随时待命。",当前内心想法:"风向不对，异常源可能活跃，得尽快标注安全路线。",背包:{突变结晶:{下级:20,中级:6,上级:1,顶级:0},物品:{}},实时关注:!1,扩展:{specialNpc:!0,specialNpcId:"wasteland_scout_liran",specialNpcTags:["apocalypse","wasteland","mutant","city"]}}}},{id:"shelter_engineer_quzhao",displayName:"曲昭",sceneTags:["apocalypse","shelter","city"],personaPrompt:"【人设】曲昭：秩序避难所技师/28岁男性/掌控期（Level 2）/工匠系觉醒者。\n【外貌】银灰短发，黑框护目镜常挂在额头，工装与多功能工具带。\n【定位】负责避难所防御网络与能量管线维护，偶尔外出支援修复车队。\n【互动】可为玩家修理装备、强化装备，或建设临时防御模块（需贡献点）。".trim(),createProfile:({now:e,playerLocationDesc:n,worldInfo:t})=>{const a={力量:10,敏捷:11,体质:12,意志:13,魅力:9,幸运:8},r=(0,i.qL)(a,"掌控期"),o=Math.round(2.5*a.体质+18),s=Math.round(2.3*a.意志+14),l=Math.round(1.2*(a.体质+a.力量)+22),c=Math.round(1*a.意志+.4*a.幸运+18),d=n||"秩序避难所B区机修间",u=String(t?.世界名称||"未知");return{名字:"曲昭",性别:"男",出生日期:{年:Number(e.年??0)-28,月:11,日:3},种族:"人族",出生:"秩序避难所技工家庭",外貌描述:"银灰短发，黑框护目镜，耐磨工装，多功能工具带与可穿戴终端。",性格特征:["专注","细致","可靠","温和"],觉醒阶段:"掌控期",异能名称:"结构共鸣",异能类型:"工匠",异能描述:"短时增强机械/防御结构的稳定性与效率，适用于设施与装备强化。",异能代价:"连续使用会导致精神力快速消耗与关节疲劳",天赋:[{name:"战术协同",description:"提升团队行动的稳定性与效率"},{name:"理智锚固",description:"在极端环境下更易保持清醒与判断"}],先天属性:a,属性:{生命值:{当前:o,上限:o},精神力:{当前:s,上限:s},理智值:{当前:c,上限:c},体力:{当前:l,上限:l},寿命上限:100,物理攻击力:r.物理攻击力,物理防御力:r.物理防御力,特殊攻击力:r.特殊攻击力,特殊防御力:r.特殊防御力},与玩家关系:"陌生人",好感度:0,当前位置:{描述:`${d}（${u}）`},势力归属:"秩序避难所",人格底线:["不破坏避难所安全","不牺牲同伴","不泄露关键设施信息"],记忆:[],当前外貌状态:"工装上带少许机油印，额头护目镜随时准备下拉。",当前内心想法:"主控管线又出现波动，得尽快定位故障节点。",背包:{突变结晶:{下级:10,中级:4,上级:0,顶级:0},物品:{}},实时关注:!1,扩展:{specialNpc:!0,specialNpcId:"shelter_engineer_quzhao",specialNpcTags:["apocalypse","shelter","city"]}}}},{id:"rumia_the_dark_eater",displayName:"露米娅",sceneTags:["night","forest","darkness","man_eater"],personaPrompt:"【核心参考】露米娅（东方Project原作）：黑暗/食人/夜行/幼齿。\n【人设】操纵黑暗的妖怪，外表是人类少女；觉醒期（Level 1）暗系妖怪。\n【外貌】金发齐肩，红瞳如血，常以红色缎带系发；周身缠绕着她所操控的黑暗，在夜晚中只留下纤细的轮廓。\n【性格】外表天真无邪，实则以人类为食；好奇心旺盛，喜欢戏弄猎物，性格顽皮而危险。\n【能力】操控黑暗形成“暗之幕”，遮蔽视野与感知，在夜间战斗力大幅提升；可自由出入自己创造的黑暗领域。\n【互动】在夜晚的森林中容易遭遇；强光会暂时削弱她的能力；对主动靠近的人类抱有强烈的捕食欲。\n【禁忌】不要在深夜独自进入她的黑暗领域；不要被她天真的外表所欺骗。".trim(),createProfile:({now:e,playerLocationDesc:n,worldInfo:t})=>{const a={力量:11,敏捷:14,体质:9,意志:13,魅力:15,幸运:10},r=(0,i.qL)(a,"觉醒期"),o=Math.round(2.3*a.体质+22),s=Math.round(2.4*a.意志+20),l=Math.round(1.25*(a.体质+a.力量)+24),c=Math.round(1*a.意志+.5*a.幸运+20),d=n||"魔法森林的夜路",u=String(t?.世界名称||"幻想乡");return{名字:"露米娅",性别:"女",出生日期:{年:Number(e.年??0)-16,月:11,日:7},种族:"妖怪",出生:"幻想乡诞生之初便存在的暗之妖怪",外貌描述:"金发齐肩，红瞳如血，红色缎带系于发侧；周身缠绕着她所操控的黑暗，在夜晚中只留下纤细的轮廓与冷冽的气息。",性格特征:["天真","暴食","残忍","危险"],觉醒阶段:"觉醒期",异能名称:"黑暗操控",异能类型:"妖怪能力",异能描述:"在周身生成“暗之幕”，遮蔽视野与感知，在夜间战斗力略微提升；可自由出入自己创造的黑暗领域。在自身头上的红色缎带被解开后可进行ex形态",异能代价:"在”暗之幕“内自己也看不见东西，强光会暂时削弱其黑暗能力，并使其感到烦躁与虚弱。",天赋:[{name:"夜行",description:"在黑暗中行动无声，感知大幅增强"},{name:"捕食者",description:"对人类的气息极为敏感，能轻易追踪猎物"}],先天属性:a,属性:{生命值:{当前:o,上限:o},精神力:{当前:s,上限:s},理智值:{当前:c,上限:c},体力:{当前:l,上限:l},寿命上限:999,物理攻击力:r.物理攻击力,物理防御力:r.物理防御力,特殊攻击力:r.特殊攻击力,特殊防御力:r.特殊防御力},与玩家关系:"陌生人",好感度:0,当前位置:{描述:`${d}（${u}）`},势力归属:"无",人格底线:["以人类为食是天性","不与其他妖怪共享猎物","讨厌强光"],记忆:["她的黑暗是她的领域，也是她的餐桌"],当前外貌状态:"金发在黑暗中若隐若现，红瞳闪烁着捕食者的光芒，红色缎带在夜风中轻轻飘动。",当前内心想法:"又有人类送上门来了…这次要怎么戏弄他才好呢？",背包:{突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}},实时关注:!1,私密信息:{是否为处女:!0,三围:{胸围:75,腰围:56,臀围:67},身体部位:[{部位名称:"乳首",敏感度:70,开发度:40,特征描述:"娇小粉嫩，触碰即颤，在暗域中温度偏低",反应描述:"轻触会微微吸气，瞳色亮度提升一瞬",偏好刺激:"温热呼吸与轻啄",禁忌:"粗暴拉扯与强光直射"},{部位名称:"小穴",敏感度:85,开发度:30,特殊印记:"暗域印痕隐约浮动",特征描述:"紧致温润，伴随冷香，暗域共鸣下吸附感增强",反应描述:"被温柔刺激时会不自觉夹紧，气息变快",偏好刺激:"缓慢推进与浅层摩挲",禁忌:"突然用力或在强光下暴露"},{部位名称:"后穴",敏感度:75,开发度:35,特征描述:"紧致而有弹性，暗域覆盖时更为敏感"},{部位名称:"耳朵",敏感度:65,开发度:50,特征描述:"细小而冰凉，轻语会令其心神微乱"}],性格倾向:"好奇与戏弄并存，边界清晰",性取向:"泛性恋",性癖好:["暗域共鸣","感官遮蔽","轻度戏弄"],性渴望程度:40,当前性状态:"轻度好奇，偏向观察与试探",体液分泌状态:"在暗域中散发冷香，少量体液分泌增强",性交总次数:0,性伴侣名单:[],最近一次性行为时间:"无",特殊体质:["暗域共鸣","感知扭曲","饥馑驱动"],性经验等级:"未开荤",亲密偏好:["拥抱","耳语","轻触"],亲密节奏:"循序渐进，先建立信任与边界",亲密需求:"安全感、温柔与不强迫",禁忌清单:["强光直射","粗暴控制","公开羞辱"],安全偏好:"事前沟通、明确安全词",避孕措施:"暂无",生育状态:{是否可孕:!0,当前状态:"未怀孕"}},扩展:{specialNpc:!0,specialNpcId:"rumia_the_dark_eater",specialNpcTags:["night","forest","darkness","man_eater"]}}}}],l=()=>`event_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;async function c(e){try{const{saveData:n,now:t,customPrompt:r}=e,i=n,c=function(e){const n=e.saveData,t=n?.社交?.关系??{},a=new Set,r=new Set(Object.keys(t||{}));for(const e of Object.values(t||{}))if(e&&"object"==typeof e){const n=e.扩展?.specialNpcId;"string"==typeof n&&n.trim()&&a.add(n.trim())}const o=function(e){const n=`${String(e.worldInfo?.世界背景??"")}\n${String(e.worldInfo?.世界纪元??"")}\n${String(e.worldName??e.worldInfo?.世界名称??"")}\n${String(e.locationDesc??"")}`,t=new Set,a=(...e)=>e.some(e=>n.includes(e));return a("地球","现代","都市","学校","大学","高中")&&(t.add("earth"),t.add("modern")),a("学校","大学","高中","校园")&&t.add("campus"),a("城","坊市","市","街","商会")&&t.add("city"),a("修仙","灵气","宗门","秘境","洞府","坊市","仙","道")&&t.add("xianxia"),a("宗门","山门","内门","外门","长老")&&t.add("sect"),a("江湖","游侠","散修","客栈")&&t.add("jianghu"),a("混沌纪元","异常","灾厄","黑区","污染","联邦")&&t.add("apocalypse"),a("荒原","废墟","黑区","边境")&&t.add("wasteland"),a("避难所","庇护所","秩序避难所","地下城")&&t.add("shelter"),a("变异","突变","异兽","畸变")&&t.add("mutant"),a("夜","夜晚","夜色","暗夜","黑夜","黄昏")&&t.add("night"),a("黑暗","暗域","漆黑","阴暗","昏暗")&&t.add("darkness"),a("森林","密林","丛林","林地","林间")&&t.add("forest"),a("食人","吞食","捕食","猎食","掠食")&&t.add("man_eater"),Array.from(t)}({worldInfo:n?.世界?.信息??null,locationDesc:String(n?.角色?.位置?.描述??"")}),i=s.filter(e=>!a.has(e.id)&&!r.has(e.displayName));if(0===i.length)return[];const l=i.filter(e=>e.sceneTags.some(e=>o.includes(e)));return[...l.length?l:i].sort(()=>Math.random()-.5).slice(0,6)}({saveData:n,now:t});if(!c.length)return console.log("[特殊NPC事件] 无可用候选NPC，将回退到普通世界事件"),null;const d=i?.角色?.身份?.名字||i?.角色?.名字||"无名幸存者",u=i?.角色?.身份?.觉醒阶段||i?.角色?.属性?.觉醒阶段||"凡人",p=String(i?.角色?.位置?.描述||"未知"),v=i?.世界?.信息??null,f=c.map(e=>{const n=String(e.personaPrompt||"").trim(),t=n.length>260?n.slice(0,260)+"…":n;return`- id: ${e.id}\n  名称: ${e.displayName}\n  标签: ${e.sceneTags.join(",")}\n  人设: ${t}`}).join("\n\n"),h=r&&String(r).trim()?`\n\n## 额外要求\n${String(r).trim()}`:"",m=`\n# 任务：生成“特殊NPC登场”世界事件（酒馆端专属）\n你需要从候选列表中选择**最适合当前场景**的一位【特殊NPC/定制人物】，并写出一段“刚刚发生”的登场事件快照。\n要求：\n- 只允许从候选 id 中选择（输出 selected_id）\n- 事件要有现场感，不要公告式总结\n- 事件应让玩家在后续叙事中自然遇见/结识该NPC（但不要写成强制绑定/无条件跟随）\n- 事件文本 80-180 字，简短但有信息密度\n\n输出 JSON（不要代码块/解释/额外文本）：\n{\n  "selected_id": "string",\n  "event_story": "string",\n  "event_name": "string (可选)",\n  "event_type": "人物风波|势力变动|世界变革|string (可选)"\n}\n\n---\n\n# 当前状态\n- 时间: ${t.年}年${t.月}月${t.日}日 ${String(t.小时).padStart(2,"0")}:${String(t.分钟).padStart(2,"0")}\n- 玩家: ${d}\n- 觉醒阶段: ${u}\n- 位置: ${p}\n- 世界: ${String(v?.世界名称||"未知")}\n- 世界背景: ${String(v?.世界背景||"").slice(0,200)}\n- 世界纪元: ${String(v?.世界纪元||"").slice(0,200)}\n\n# 候选特殊NPC\n${f}\n${h}\n    `.trim(),g=await(0,a.e)("生成特殊NPC登场事件",m,!1,"event_generation"),b=(0,o.p_)(g),y=String(b?.selected_id||"").trim(),x=String(b?.event_story||"").trim();if(!y||!x)return null;const k=c.find(e=>e.id===y);if(!k)return null;const w=k.createProfile({now:t,playerLocationDesc:p,worldInfo:v}),_=String(b?.event_name||`异人现世·${w.名字}`).trim(),C=String(b?.event_type||"人物风波").trim(),A={事件ID:l(),事件名称:_||`异人现世·${w.名字}`,事件类型:C||"人物风波",事件描述:x,影响等级:"轻微",影响范围:"局部",相关人物:[w.名字],事件来源:"系统",发生时间:t};return{npcProfile:w,npcId:k.id,event:A,prompt_addition:x}}catch(e){return console.error("[特殊NPC事件生成] 生成失败:",e),null}}async function d(e){try{const{saveData:n,now:t,customPrompt:i}=e,s=n?.角色?.身份?.名字||n?.角色?.名字||"无名幸存者",c=n?.角色?.身份?.觉醒阶段||n?.角色?.属性?.觉醒阶段||"凡人",d=n?.角色?.位置?.描述||"未知",u=Number(n?.角色?.属性?.声望??0),p=n?.社交?.关系||{},v=Object.values(p).filter(e=>e&&"object"==typeof e).map(e=>({名字:String(e.名字||""),与玩家关系:String(e.与玩家关系||""),好感度:Number(e.好感度??0),觉醒阶段:String(e?.觉醒阶段||"")})).filter(e=>e.名字).sort((e,n)=>n.好感度-e.好感度).slice(0,6),f=(await(0,r.XH)("eventGeneration")).trim(),h=i&&String(i).trim()?`\n\n## 额外要求\n${String(i).trim()}`:"",m=`${f}\n\n---\n\n${`\n# 当前状态\n- 时间: ${t.年}年${t.月}月${t.日}日 ${String(t.小时).padStart(2,"0")}:${String(t.分钟).padStart(2,"0")}\n- 玩家: ${s}\n- 觉醒阶段: ${c}\n- 位置: ${d}\n- 声望: ${u}\n\n# 玩家关系（好感度Top）\n${v.length?v.map(e=>`- ${e.名字} | 关系:${e.与玩家关系||"未知"} | 好感:${e.好感度} | 觉醒阶段:${e.觉醒阶段||"未知"}`).join("\n"):"- （暂无）"}\n`.trim()}${h}`.trim(),g=await(0,a.e)("生成一个会影响玩家的世界事件",m,!1,"event_generation"),b=(0,o.p_)(g),y=b?.event,x=String(b?.prompt_addition||"").trim();return y&&"object"==typeof y&&x?{event:{事件ID:String(y.事件ID||l()),事件名称:String(y.事件名称||"无名事件"),事件类型:String(y.事件类型||"世界变革"),事件描述:String(y.事件描述||x),影响等级:y.影响等级?String(y.影响等级):void 0,影响范围:y.影响范围?String(y.影响范围):void 0,相关人物:Array.isArray(y.相关人物)?y.相关人物.map(e=>String(e)).filter(Boolean):void 0,相关势力:Array.isArray(y.相关势力)?y.相关势力.map(e=>String(e)).filter(Boolean):void 0,事件来源:String(y.事件来源||"随机"),发生时间:t},prompt_addition:x}:null}catch(e){return console.error("[事件生成] 生成失败:",e),null}}},3024:(e,n,t)=>{"use strict";t.d(n,{A:()=>p});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o),s=t(4417),l=t.n(s),c=new URL(t(5224),t.b),d=i()(r()),u=l()(c);d.push([e.id,`\n/* ============ 教程弹窗样式 ============ */\n.help-overlay[data-v-12d7ca97] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  padding: 1rem;\n}\n.help-modal[data-v-12d7ca97] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  max-width: 420px;\n  width: 100%;\n  max-height: 85vh;\n  overflow: hidden;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n}\n.help-header[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.help-title[data-v-12d7ca97] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.help-close[data-v-12d7ca97] {\n  background: transparent;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.help-close[data-v-12d7ca97]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.help-body[data-v-12d7ca97] {\n  padding: 1.25rem;\n  overflow-y: auto;\n  max-height: calc(85vh - 60px);\n}\n.help-version[data-v-12d7ca97] {\n  display: inline-block;\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n  padding: 2px 8px;\n  border-radius: 4px;\n  margin-bottom: 0.5rem;\n}\n.help-desc[data-v-12d7ca97] {\n  margin: 0 0 1rem;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n.help-link-card[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text);\n  text-decoration: none;\n  margin-bottom: 1rem;\n  transition: background 0.2s;\n}\n.help-link-card[data-v-12d7ca97]:hover {\n  background: var(--color-surface-hover);\n}\n.help-link-card span[data-v-12d7ca97] {\n  flex: 1;\n  font-size: 0.9rem;\n  font-weight: 500;\n}\n.help-warning[data-v-12d7ca97] {\n  padding: 0.75rem;\n  background: rgba(251, 191, 36, 0.1);\n  border: 1px solid rgba(251, 191, 36, 0.3);\n  border-radius: 8px;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  margin-bottom: 1rem;\n}\n.help-warning strong[data-v-12d7ca97] {\n  color: #ef4444;\n}\n.help-section h3[data-v-12d7ca97] {\n  margin: 0 0 0.75rem;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.help-features[data-v-12d7ca97] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-bottom: 1rem;\n}\n.help-features span[data-v-12d7ca97] {\n  font-size: 0.8rem;\n  padding: 4px 10px;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n}\n.help-footer[data-v-12d7ca97] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.help-author[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.help-author a[data-v-12d7ca97] {\n  color: var(--color-primary);\n  text-decoration: none;\n}\n.help-author a[data-v-12d7ca97]:hover {\n  text-decoration: underline;\n}\n.settings-modal-overlay[data-v-12d7ca97] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  padding: 20px;\n}\n.game-info-header[data-v-12d7ca97]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: url(${u});\n  opacity: 0.5;\n  animation: bgFloat-12d7ca97 25s ease-in-out infinite;\n}\n@keyframes bgFloat-12d7ca97 {\n0%, 100% {\n    transform: translate(0, 0);\n}\n50% {\n    transform: translate(10px, 10px);\n}\n}\n.game-info-header .header-bg[data-v-12d7ca97] {\n  position: absolute;\n  inset: 0;\n  background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),\n              radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);\n}\n.game-info-header .header-content[data-v-12d7ca97] {\n  position: relative;\n  z-index: 1;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.75rem;\n}\n.game-info-header .game-title[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n}\n.game-info-header .title-icon[data-v-12d7ca97] {\n  font-size: 1.75rem;\n}\n.game-info-header .title-text[data-v-12d7ca97] {\n  font-size: 2rem;\n  font-weight: 900;\n  color: #fff;\n  letter-spacing: -0.02em;\n  text-shadow: 0 4px 16px rgba(0, 0, 0, 0.4),\n               0 2px 8px rgba(0, 0, 0, 0.3);\n}\n.version-subtitle-row[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.game-info-header .version-tag[data-v-12d7ca97] {\n  background: rgba(255, 255, 255, 0.25);\n  color: #fff;\n  padding: 0.25rem 0.625rem;\n  border-radius: 20px;\n  font-size: 0.7rem;\n  font-weight: 700;\n  backdrop-filter: blur(8px);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n.game-info-header .game-subtitle[data-v-12d7ca97] {\n  color: rgba(255, 255, 255, 0.95);\n  font-size: 0.875rem;\n  margin: 0;\n  font-weight: 500;\n  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);\n}\n.game-info-header .close-btn[data-v-12d7ca97] {\n  position: absolute;\n  top: 1.25rem;\n  right: 1.25rem;\n  background: rgba(255, 255, 255, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: #fff;\n  width: 36px;\n  height: 36px;\n  border-radius: 10px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  line-height: 1;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  backdrop-filter: blur(8px);\n}\n.game-info-header .close-btn[data-v-12d7ca97]:hover {\n  background: rgba(255, 255, 255, 0.3);\n  transform: scale(1.08) rotate(90deg);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n}\n\n/* 内容区域 */\n.game-info-body[data-v-12d7ca97] {\n  padding: 2rem;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  background: var(--color-surface);\n}\n\n/* 官网介绍卡片 */\n.official-intro-card[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  padding: 1.5rem;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);\n  border: 2px solid rgba(99, 102, 241, 0.2);\n  border-radius: 20px;\n  text-decoration: none;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.official-intro-card[data-v-12d7ca97]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n.official-intro-card[data-v-12d7ca97]:hover::before {\n  opacity: 1;\n}\n.official-intro-card[data-v-12d7ca97]:hover {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);\n  border-color: rgba(99, 102, 241, 0.4);\n  transform: translateY(-4px);\n  box-shadow: 0 12px 32px rgba(99, 102, 241, 0.3),\n              0 4px 12px rgba(0, 0, 0, 0.15);\n}\n.intro-icon-wrapper[data-v-12d7ca97] {\n  width: 64px;\n  height: 64px;\n  border-radius: 16px;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #6366f1;\n  flex-shrink: 0;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2),\n              inset 0 1px 0 rgba(255, 255, 255, 0.2);\n}\n.official-intro-card:hover .intro-icon-wrapper[data-v-12d7ca97] {\n  transform: scale(1.15) rotate(-5deg);\n  box-shadow: 0 8px 20px rgba(99, 102, 241, 0.35),\n              inset 0 1px 0 rgba(255, 255, 255, 0.3);\n}\n.intro-content[data-v-12d7ca97] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.35rem;\n}\n.intro-title[data-v-12d7ca97] {\n  font-size: 1.05rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.intro-desc[data-v-12d7ca97] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.intro-arrow[data-v-12d7ca97] {\n  color: var(--color-text-secondary);\n  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);\n}\n.official-intro-card:hover .intro-arrow[data-v-12d7ca97] {\n  transform: translateX(6px);\n  color: #667eea;\n}\n\n/* 警告横幅 */\n.warning-banner[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  gap: 0.875rem;\n  padding: 1.25rem 1.5rem;\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.12) 0%, rgba(245, 158, 11, 0.08) 100%);\n  border: 2px solid rgba(251, 191, 36, 0.3);\n  border-left: 4px solid #f59e0b;\n  border-radius: 16px;\n  font-size: 0.9rem;\n  color: var(--color-text);\n  box-shadow: 0 2px 12px rgba(251, 191, 36, 0.15);\n  backdrop-filter: blur(8px);\n}\n.warning-banner .warning-icon[data-v-12d7ca97] {\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n.warning-banner strong[data-v-12d7ca97] {\n  color: #dc2626;\n  font-weight: 800;\n}\n\n/* 信息卡片 */\n.info-card[data-v-12d7ca97] {\n  background: var(--color-surface-light);\n  border: 2px solid var(--color-border);\n  border-radius: 18px;\n  padding: 1.5rem;\n  transition: all 0.3s ease;\n}\n.info-card[data-v-12d7ca97]:hover {\n  border-color: rgba(99, 102, 241, 0.35);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1),\n              0 0 0 1px rgba(99, 102, 241, 0.1);\n  transform: translateY(-2px);\n}\n.info-card .card-header[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  gap: 0.65rem;\n  margin-bottom: 1rem;\n}\n.info-card .card-icon[data-v-12d7ca97] {\n  font-size: 1.25rem;\n}\n.info-card .card-header h4[data-v-12d7ca97] {\n  margin: 0;\n  font-size: 1.05rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.info-card .card-desc[data-v-12d7ca97] {\n  margin: 0;\n  font-size: 0.925rem;\n  line-height: 1.7;\n  color: var(--color-text-secondary);\n}\n\n/* 功能网格 */\n.feature-grid[data-v-12d7ca97] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.feature-item[data-v-12d7ca97] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.875rem;\n  padding: 1.125rem;\n  background: var(--color-surface);\n  border-radius: 14px;\n  border: 2px solid var(--color-border);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.feature-item[data-v-12d7ca97]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, transparent 100%);\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n.feature-item[data-v-12d7ca97]:hover::before {\n  opacity: 1;\n}\n.feature-item[data-v-12d7ca97]:hover {\n  border-color: rgba(99, 102, 241, 0.4);\n  background: var(--color-surface);\n  transform: translateY(-3px);\n  box-shadow: 0 6px 16px rgba(99, 102, 241, 0.15),\n              0 2px 8px rgba(0, 0, 0, 0.08);\n}\n.feature-item .feature-icon[data-v-12d7ca97] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.15));\n  transition: transform 0.3s ease;\n  position: relative;\n  z-index: 1;\n}\n.feature-item:hover .feature-icon[data-v-12d7ca97] {\n  transform: scale(1.1);\n}\n.feature-item .feature-text[data-v-12d7ca97] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  position: relative;\n  z-index: 1;\n}\n.feature-item .feature-text strong[data-v-12d7ca97] {\n  font-size: 0.95rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.feature-item .feature-text span[data-v-12d7ca97] {\n  font-size: 0.825rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n\n/* 紧凑型卡片布局 */\n.info-row[data-v-12d7ca97] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1rem;\n}\n.info-card.compact[data-v-12d7ca97] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n}\n.info-card.compact .card-header[data-v-12d7ca97] {\n  margin-bottom: 0.75rem;\n}\n.author-content[data-v-12d7ca97], .copyright-content[data-v-12d7ca97] {\n  font-size: 0.925rem;\n  color: var(--color-text-secondary);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.65rem;\n}\n.author-name[data-v-12d7ca97] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.github-link[data-v-12d7ca97] {\n  color: #6366f1;\n  text-decoration: none;\n  font-size: 0.875rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n}\n.github-link[data-v-12d7ca97]:hover {\n  color: #8b5cf6;\n  text-decoration: underline;\n}\n\n/* 深色主题适配 */\n[data-theme='dark'] .game-info-header[data-v-12d7ca97] {\n  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #c026d3 100%);\n}\n[data-theme='dark'] .warning-banner[data-v-12d7ca97] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);\n  border-color: rgba(251, 191, 36, 0.35);\n  border-left-color: #f59e0b;\n}\n[data-theme='dark'] .warning-banner strong[data-v-12d7ca97] {\n  color: #fca5a5;\n}\n[data-theme='dark'] .official-intro-card[data-v-12d7ca97] {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.12) 0%, rgba(139, 92, 246, 0.08) 100%);\n  border-color: rgba(99, 102, 241, 0.25);\n}\n[data-theme='dark'] .official-intro-card[data-v-12d7ca97]:hover {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);\n  border-color: rgba(99, 102, 241, 0.45);\n}\n[data-theme='dark'] .intro-icon-wrapper[data-v-12d7ca97] {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.2) 100%);\n  color: #818cf8;\n}\n\n/* 滚动条美化 */\n.game-info-body[data-v-12d7ca97]::-webkit-scrollbar {\n  width: 8px;\n}\n.game-info-body[data-v-12d7ca97]::-webkit-scrollbar-track {\n  background: transparent;\n  margin: 8px 0;\n}\n.game-info-body[data-v-12d7ca97]::-webkit-scrollbar-thumb {\n  background: var(--color-border);\n  border-radius: 4px;\n  transition: background 0.2s ease;\n}\n.game-info-body[data-v-12d7ca97]::-webkit-scrollbar-thumb:hover {\n  background: var(--color-text-secondary);\n}\n.settings-modal-overlay[data-v-12d7ca97] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  padding: 20px;\n}\n.settings-modal-content[data-v-12d7ca97] {\n  background: var(--color-surface, #ffffff);\n  border-radius: 14px;\n  width: min(760px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);\n  border: 1px solid var(--color-border);\n  animation: modalIn 0.2s ease;\n}\n.settings-modal-header[data-v-12d7ca97] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.settings-modal-header h3[data-v-12d7ca97] {\n  margin: 0;\n  font-size: 1.15rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.settings-modal-body[data-v-12d7ca97] {\n  flex: 1;\n  overflow: auto;\n}\n.sponsor-modal-content[data-v-12d7ca97] {\n  width: min(540px, 100%);\n}\n.prompt-modal-content[data-v-12d7ca97] {\n  width: min(900px, 100%);\n}\n.sponsor-modal-body[data-v-12d7ca97] {\n  padding: 1rem 1.25rem 1.5rem;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  justify-items: center;\n}\n.sponsor-qr[data-v-12d7ca97] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.5rem;\n  width: 100%;\n}\n.sponsor-qr img[data-v-12d7ca97] {\n  width: 100%;\n  max-width: 240px;\n  border-radius: 12px;\n  background: #fff;\n  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);\n  display: block;\n}\n.sponsor-qr span[data-v-12d7ca97] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n.close-btn[data-v-12d7ca97] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  font-size: 1.5rem;\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-btn[data-v-12d7ca97]:hover {\n  background: var(--color-surface-hover);\n}\n`,""]);const p=d},3093:(e,n,t)=>{"use strict";var a=t(6840);e.exports=function(e){return a(e)||0===e?e:e<0?-1:1}},3098:(e,n,t)=>{"use strict";t.d(n,{deepCleanForClone:()=>r,jx:()=>o,zB:()=>i});var a=t(6988);function r(e){return JSON.parse(JSON.stringify(e))}function o(e,n){try{if(!e||"object"!=typeof e)return console.error("[NPC校验] 提供的输入不是一个有效的对象:",e),[!1,null];const t={...e};if("string"!=typeof t.名字||0===t.名字.trim().length)return console.error("[NPC校验] 核心字段`名字`缺失或无效:",t),[!1,null];const a={...t},r="number"==typeof n?.年?n.年:1e3,o="number"==typeof n?.月?n.月:1,i="number"==typeof n?.日?n.日:1;try{"string"!=typeof a.性别&&(a.性别="其他")}catch(e){a.性别="其他"}try{"string"!=typeof a.与玩家关系&&(a.与玩家关系="陌生人")}catch(e){a.与玩家关系="陌生人"}try{("number"!=typeof a.好感度||isNaN(a.好感度))&&(a.好感度=0)}catch(e){a.好感度=0}try{Array.isArray(a.记忆)||(a.记忆=[])}catch(e){a.记忆=[]}try{Array.isArray(a.人格底线)||(a.人格底线=[])}catch(e){a.人格底线=[]}try{Array.isArray(a.天赋)||(a.天赋=[])}catch(e){a.天赋=[]}try{Array.isArray(a.性格特征)||(a.性格特征=[])}catch(e){a.性格特征=[]}try{if(a.出生日期&&"object"==typeof a.出生日期){const e=a.出生日期;"number"==typeof e.年&&Number.isFinite(e.年)||(e.年=Math.max(1,r-18)),"number"==typeof e.月&&Number.isFinite(e.月)||(e.月=o),"number"==typeof e.日&&Number.isFinite(e.日)||(e.日=i),a.出生日期=e}else{const e=Math.max(1,r-18);a.出生日期={年:e,月:o,日:i}}}catch(e){a.出生日期={年:Math.max(1,r-18),月:o,日:i}}try{a.出生||(a.出生="散修")}catch(e){a.出生="散修"}try{"string"==typeof a.外貌描述&&a.外貌描述.trim()||(a.外貌描述="相貌普通，气质平和。")}catch(e){a.外貌描述="相貌普通，气质平和。"}try{a.先天属性&&"object"==typeof a.先天属性||(a.先天属性={力量:5,敏捷:5,体质:5,意志:5,魅力:5,幸运:5})}catch(e){a.先天属性={力量:5,敏捷:5,体质:5,意志:5,魅力:5,幸运:5}}try{const e=a.觉醒阶段,n=a?.属性?.觉醒阶段;let t;e&&(t="string"==typeof e?e:e?.名称||e?.name,delete a.觉醒阶段),!t&&n&&(t="string"==typeof n?n:n?.名称||n?.name,delete a.属性?.觉醒阶段),"string"!=typeof a.觉醒阶段&&(a.觉醒阶段=t||"凡人")}catch(e){a.觉醒阶段="string"==typeof a.觉醒阶段?a.觉醒阶段:"凡人"}try{if(a.属性&&"object"==typeof a.属性){const e=a.属性;e.生命值&&"object"==typeof e.生命值||(e.生命值={当前:100,上限:100}),e.精神力&&"object"==typeof e.精神力||(e.精神力={当前:50,上限:50}),e.理智值&&"object"==typeof e.理智值||(e.理智值={当前:100,上限:100}),e.体力&&"object"==typeof e.体力||(e.体力={当前:50,上限:50}),"number"==typeof e.寿命上限&&Number.isFinite(e.寿命上限)||(e.寿命上限=100),e.觉醒阶段&&delete e.觉醒阶段,a.属性=e}else a.属性={生命值:{当前:100,上限:100},精神力:{当前:50,上限:50},理智值:{当前:100,上限:100},体力:{当前:50,上限:50},寿命上限:100,物理攻击力:10,物理防御力:10,特殊攻击力:10,特殊防御力:10}}catch(e){a.属性={生命值:{当前:100,上限:100},精神力:{当前:50,上限:50},理智值:{当前:100,上限:100},体力:{当前:50,上限:50},寿命上限:100,物理攻击力:10,物理防御力:10,特殊攻击力:10,特殊防御力:10}}try{a.当前位置&&"object"==typeof a.当前位置?a.当前位置.描述||(a.当前位置.描述="朝天大陆·无名之地"):a.当前位置={描述:"朝天大陆·无名之地"}}catch(e){a.当前位置={描述:"朝天大陆·无名之地"}}try{"string"==typeof a.当前外貌状态&&a.当前外貌状态.trim()||(a.当前外貌状态="神色平静")}catch(e){a.当前外貌状态="神色平静"}try{"string"==typeof a.当前内心想法&&a.当前内心想法.trim()||(a.当前内心想法="心思难测")}catch(e){a.当前内心想法="心思难测"}try{"string"==typeof a.种族&&a.种族.trim()||(a.种族="人族")}catch(e){a.种族="人族"}try{"object"!=typeof a.背包||null===a.背包?a.背包={突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}}:("object"==typeof a.背包.突变结晶&&null!==a.背包.突变结晶||(a.背包.突变结晶={下级:0,中级:0,上级:0,顶级:0}),"object"==typeof a.背包.物品&&null!==a.背包.物品||(a.背包.物品={}))}catch(e){console.warn("[NPC校验] 背包字段修复失败，使用默认值:",e),a.背包={突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}}}try{"boolean"!=typeof a.实时关注&&(a.实时关注=!1)}catch(e){a.实时关注=!1}return[!0,a]}catch(e){return console.error("[NPC校验] 验证过程发生严重错误:",e),[!1,null]}}function i(e,n,t){if(!e)return{isValid:!1,errors:["存档数据为空"]};const r=[...(0,a.$)(e).errors];if(n?.角色){const e=n.角色;e.名字&&"string"==typeof e.名字||r.push("角色姓名无效"),e.性别||r.push("角色性别缺失")}if("creation"===t){const n=e?.角色?.位置;n&&"object"==typeof n||r.push("角色.位置 缺失");const t=e?.角色?.属性,a="string"==typeof t?.觉醒阶段?t.觉醒阶段:void 0,o="string"==typeof t?.属性?.觉醒阶段?t.属性.觉醒阶段:void 0,i=t?.觉醒阶段&&"object"==typeof t.觉醒阶段?t.觉醒阶段:void 0;a||o||i||r.push("角色.身份.觉醒阶段 缺失")}return{isValid:0===r.length,errors:r}}t(1267)},3126:(e,n,t)=>{"use strict";var a=t(6743),r=t(9675),o=t(76),i=t(3144);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new r("a function is required");return i(a,o,e)}},3144:(e,n,t)=>{"use strict";var a=t(6743),r=t(1002),o=t(76),i=t(7119);e.exports=i||a.call(o,r)},3302:(e,n,t)=>{"use strict";t.d(n,{Yz:()=>o,w9:()=>r});class a{static instance;debugMode=!1;consoleDebug=!1;performanceMonitor=!1;constructor(){this.loadDebugSettings()}static getInstance(){return a.instance||(a.instance=new a),a.instance}loadDebugSettings(){try{const e=localStorage.getItem("dad_game_settings");if(e){const n=JSON.parse(e);this.debugMode=n.debugMode||!1,this.consoleDebug=n.consoleDebug||!1,this.performanceMonitor=n.performanceMonitor||!1}}catch(e){console.error("加载调试设置失败:",e),this.debugMode=!1,this.consoleDebug=!1,this.performanceMonitor=!1}}reloadSettings(){this.loadDebugSettings()}setDebugMode(e){this.debugMode=e,this.reloadSettings(),this.consoleDebug&&console.log("[调试] 调试模式"+(e?"已启用":"已禁用"))}isDebugMode(){return this.debugMode}isConsoleDebugEnabled(){return this.debugMode&&this.consoleDebug}isPerformanceMonitorEnabled(){return this.debugMode&&this.performanceMonitor}log(e,n,t){this.isConsoleDebugEnabled()&&(void 0!==t?console.log(`[${e}] ${n}`,t):console.log(`[${e}] ${n}`))}warn(e,n,t){this.isConsoleDebugEnabled()&&(void 0!==t?console.warn(`[${e}] ${n}`,t):console.warn(`[${e}] ${n}`))}error(e,n,t){void 0!==t?console.error(`[${e}] ${n}`,t):console.error(`[${e}] ${n}`)}timeStart(e){if(this.isPerformanceMonitorEnabled())try{console.time(`[性能] ${e}`)}catch(e){}}timeEnd(e){if(this.isPerformanceMonitorEnabled())try{console.timeEnd(`[性能] ${e}`)}catch(e){}}group(e){this.isConsoleDebugEnabled()&&console.group(`[调试] ${e}`)}groupEnd(){this.isConsoleDebugEnabled()&&console.groupEnd()}info(e,n,t){this.debugMode&&(void 0!==t?console.info(`[${e}] ${n}`,t):console.info(`[${e}] ${n}`))}table(e,n,t){this.isConsoleDebugEnabled()&&(console.log(`[${e}] ${n}:`),console.table(t))}count(e){this.isPerformanceMonitorEnabled()&&console.count(`[统计] ${e}`)}countReset(e){this.isPerformanceMonitorEnabled()&&console.countReset(`[统计] ${e}`)}}const r=a.getInstance(),o={log:(e,n,t)=>r.log(e,n,t),warn:(e,n,t)=>r.warn(e,n,t),error:(e,n,t)=>r.error(e,n,t),info:(e,n,t)=>r.info(e,n,t),timeStart:e=>r.timeStart(e),timeEnd:e=>r.timeEnd(e),group:e=>r.group(e),groupEnd:()=>r.groupEnd(),table:(e,n,t)=>r.table(e,n,t),count:e=>r.count(e),countReset:e=>r.countReset(e),setMode:e=>r.setDebugMode(e),isEnabled:()=>r.isDebugMode(),reload:()=>r.reloadSettings()}},3338:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.prompt-panel[data-v-22f507ae] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n}\n\n/* 联机模式警告样式 */\n.online-mode-warning[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: rgba(251, 191, 36, 0.15);\n  border-bottom: 1px solid rgba(251, 191, 36, 0.3);\n  color: #fbbf24;\n}\n.online-mode-warning .warning-icon[data-v-22f507ae] {\n  font-size: 1rem;\n}\n.online-mode-warning .warning-text[data-v-22f507ae] {\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n\n/* 只读模式样式 */\n.prompt-textarea.readonly-mode[data-v-22f507ae] {\n  opacity: 0.7;\n  cursor: not-allowed;\n  background: var(--color-surface-disabled, rgba(100, 100, 100, 0.1));\n}\n.btn-small[data-v-22f507ae]:disabled,\n.action-btn-compact[data-v-22f507ae]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.panel-header.compact[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface);\n}\n.panel-title-compact[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 0 0 auto;\n}\n.title-text[data-v-22f507ae] {\n  font-size: 0.92rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.panel-search[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n  flex: 1 1 260px;\n  min-width: 200px;\n}\n.search-input[data-v-22f507ae] {\n  width: 100%;\n  padding: 0.45rem 0.65rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  outline: none;\n}\n.search-input[data-v-22f507ae]:focus {\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.15);\n}\n.search-input[data-v-22f507ae]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.clear-btn[data-v-22f507ae] {\n  width: 30px;\n  height: 30px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n}\n.clear-btn[data-v-22f507ae]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.clear-btn[data-v-22f507ae]:not(:disabled):hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.empty-search[data-v-22f507ae] {\n  padding: 0.9rem 1rem;\n  border-radius: 12px;\n  border: 1px dashed var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  margin: 0.9rem 0;\n}\n.panel-actions[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.action-btn-compact[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  padding: 0;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn-compact[data-v-22f507ae]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.action-btn-compact.primary[data-v-22f507ae] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.action-btn-compact.primary[data-v-22f507ae]:hover {\n  background: var(--color-primary-hover);\n}\n.action-btn-compact.danger[data-v-22f507ae] {\n  background: #dc2626;\n  color: white;\n  border-color: #dc2626;\n}\n.action-btn-compact.danger[data-v-22f507ae]:hover {\n  background: #b91c1c;\n}\n.prompt-list[data-v-22f507ae] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1rem;\n}\n\n/* 分类样式 */\n.category-section[data-v-22f507ae] {\n  margin-bottom: 1.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  overflow: hidden;\n  background: var(--color-surface);\n}\n.category-header[data-v-22f507ae] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-surface-hover) 100%);\n  cursor: pointer;\n  user-select: none;\n  transition: all 0.2s;\n}\n.category-header[data-v-22f507ae]:hover {\n  background: var(--color-surface-hover);\n}\n.category-title[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.category-icon[data-v-22f507ae] {\n  font-size: 1.25rem;\n}\n.category-name[data-v-22f507ae] {\n  font-weight: 600;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.category-count[data-v-22f507ae] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  padding: 0.2rem 0.5rem;\n  border-radius: 10px;\n}\n.category-actions[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.category-desc[data-v-22f507ae] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.expand-icon[data-v-22f507ae] {\n  transition: transform 0.3s ease;\n  color: var(--color-text-secondary);\n}\n.expand-icon.expanded[data-v-22f507ae] {\n  transform: rotate(180deg);\n}\n.category-content[data-v-22f507ae] {\n  border-top: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n\n/* 提示词项目样式 */\n.prompt-item[data-v-22f507ae] {\n  border-bottom: 1px solid var(--color-border);\n}\n.prompt-item[data-v-22f507ae]:last-child {\n  border-bottom: none;\n}\n.prompt-header[data-v-22f507ae] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.875rem 1.25rem;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s;\n}\n.prompt-header[data-v-22f507ae]:hover {\n  background: var(--color-surface-hover);\n}\n.prompt-title-area[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n/* 开关样式 */\n.toggle-switch[data-v-22f507ae] {\n  position: relative;\n  display: inline-block;\n  width: 36px;\n  height: 20px;\n  flex-shrink: 0;\n}\n.toggle-switch input[data-v-22f507ae] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.toggle-slider[data-v-22f507ae] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: var(--color-border);\n  transition: 0.3s;\n  border-radius: 20px;\n}\n.toggle-slider[data-v-22f507ae]:before {\n  position: absolute;\n  content: \"\";\n  height: 14px;\n  width: 14px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.3s;\n  border-radius: 50%;\n}\n.toggle-switch input:checked + .toggle-slider[data-v-22f507ae] {\n  background-color: var(--color-primary);\n}\n.toggle-switch input:checked + .toggle-slider[data-v-22f507ae]:before {\n  transform: translateX(16px);\n}\n.toggle-switch:hover .toggle-slider[data-v-22f507ae] {\n  box-shadow: 0 0 4px rgba(var(--color-primary-rgb), 0.4);\n}\n.prompt-order[data-v-22f507ae] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 24px;\n  height: 24px;\n  padding: 0 6px;\n  background: var(--color-primary);\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 600;\n  border-radius: 6px;\n}\n.prompt-title[data-v-22f507ae] {\n  font-weight: 500;\n  color: var(--color-text);\n  transition: opacity 0.2s;\n}\n.prompt-title.disabled[data-v-22f507ae] {\n  opacity: 0.5;\n  text-decoration: line-through;\n}\n.prompt-meta[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.prompt-key[data-v-22f507ae] {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  font-size: 0.72rem;\n  padding: 0.18rem 0.45rem;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  user-select: text;\n}\n.prompt-desc[data-v-22f507ae] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.prompt-status[data-v-22f507ae] {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n}\n.prompt-status.modified[data-v-22f507ae] {\n  background: rgba(var(--color-warning-rgb), 0.2);\n  color: var(--color-warning);\n}\n\n/* 权重编辑器 */\n.weight-editor[data-v-22f507ae] {\n  display: flex;\n  align-items: center;\n  gap: 2px;\n}\n.weight-label[data-v-22f507ae] {\n  font-size: 0.7rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.weight-input[data-v-22f507ae] {\n  width: 36px;\n  height: 22px;\n  padding: 0 4px;\n  border: 1px solid transparent;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 600;\n  text-align: center;\n  background: transparent;\n  transition: all 0.2s;\n  -moz-appearance: textfield;\n}\n.weight-input[data-v-22f507ae]::-webkit-outer-spin-button,\n.weight-input[data-v-22f507ae]::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.weight-input[data-v-22f507ae]:hover {\n  border-color: var(--color-border);\n  background: var(--color-surface);\n}\n.weight-input[data-v-22f507ae]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  background: var(--color-surface);\n}\n.weight-input[data-v-22f507ae]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.weight-input.weight-high[data-v-22f507ae] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #ef4444;\n}\n.weight-input.weight-medium[data-v-22f507ae] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #eab308;\n}\n.weight-input.weight-low[data-v-22f507ae] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #22c55e;\n}\n.prompt-content[data-v-22f507ae] {\n  padding: 1rem 1.25rem;\n  background: var(--color-background);\n  border-top: 1px solid var(--color-border);\n}\n.prompt-description-full[data-v-22f507ae] {\n  margin-bottom: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.prompt-textarea[data-v-22f507ae] {\n  width: 100%;\n  min-height: 400px;\n  padding: 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n  line-height: 1.6;\n  resize: vertical;\n}\n.prompt-textarea[data-v-22f507ae]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2);\n}\n.prompt-actions[data-v-22f507ae] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  justify-content: flex-end;\n}\n.btn-small[data-v-22f507ae] {\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.85rem;\n  transition: all 0.2s;\n}\n.btn-small[data-v-22f507ae]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n}\n.btn-small.btn-primary[data-v-22f507ae] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.btn-small.btn-primary[data-v-22f507ae]:hover {\n  background: var(--color-primary-hover);\n}\n\n/* 响应式适配 */\n@media (max-width: 768px) {\n.panel-header.compact[data-v-22f507ae] {\n    flex-wrap: wrap;\n}\n.panel-search[data-v-22f507ae] {\n    flex: 1 1 100%;\n    min-width: 0;\n}\n.category-header[data-v-22f507ae] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n}\n.category-actions[data-v-22f507ae] {\n    width: 100%;\n    justify-content: space-between;\n}\n.prompt-header[data-v-22f507ae] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n}\n.prompt-meta[data-v-22f507ae] {\n    width: 100%;\n    justify-content: space-between;\n}\n.prompt-desc[data-v-22f507ae] {\n    max-width: 150px;\n}\n.prompt-textarea[data-v-22f507ae] {\n    min-height: 300px;\n}\n}\n",""]);const s=i},3353:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.state-change-overlay[data-v-a2a95590] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n}\n.state-change-viewer[data-v-a2a95590] {\n  width: 90%;\n  max-width: 500px;\n  max-height: 80vh;\n  background-color: var(--color-surface);\n  border-radius: 16px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n  border: 1px solid var(--color-border);\n  animation: modal-fade-in-a2a95590 0.3s ease-out;\n}\n@keyframes modal-fade-in-a2a95590 {\nfrom {\n    opacity: 0;\n    transform: scale(0.95);\n}\nto {\n    opacity: 1;\n    transform: scale(1);\n}\n}\n.viewer-header[data-v-a2a95590] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.viewer-header h3[data-v-a2a95590] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.close-btn[data-v-a2a95590] {\n  background: none;\n  border: none;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  padding: 0.25rem;\n  border-radius: 50%;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-a2a95590]:hover {\n  background-color: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.viewer-summary[data-v-a2a95590] {\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface-light);\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.summary-item[data-v-a2a95590] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.9rem;\n  font-weight: 500;\n}\n.summary-item.added[data-v-a2a95590] { color: var(--color-success);\n}\n.summary-item.removed[data-v-a2a95590] { color: #ff9800;\n}\n.summary-item.updated[data-v-a2a95590] { color: var(--color-info);\n}\n.summary-item.errors[data-v-a2a95590] { color: var(--color-error);\n}\n.viewer-content[data-v-a2a95590] {\n  overflow-y: auto;\n  padding: 1rem 1.25rem;\n  scrollbar-width: thin;\n  scrollbar-color: var(--color-border) transparent;\n}\n.viewer-content[data-v-a2a95590]::-webkit-scrollbar { width: 6px;\n}\n.viewer-content[data-v-a2a95590]::-webkit-scrollbar-thumb {\n  background: var(--color-border);\n  border-radius: 3px;\n}\n.no-changes[data-v-a2a95590] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.changes-list[data-v-a2a95590] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.change-item[data-v-a2a95590] {\n  display: flex;\n  align-items: flex-start;\n  gap: 1rem;\n  padding: 1rem;\n  border-radius: 10px;\n  border-left: 4px solid;\n  background: var(--color-surface-light);\n  transition: all 0.2s ease;\n}\n.change-item[data-v-a2a95590]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n}\n.item-green[data-v-a2a95590] { border-color: var(--color-success);\n}\n.item-red[data-v-a2a95590] { border-color: var(--color-error);\n}\n.item-blue[data-v-a2a95590] { border-color: var(--color-info);\n}\n.item-gray[data-v-a2a95590] { border-color: var(--color-text-secondary);\n}\n.item-orange[data-v-a2a95590] { border-color: #ff9800;\n}\n.item-icon[data-v-a2a95590] {\n  flex-shrink: 0;\n  width: 2rem;\n  height: 2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  color: white;\n}\n.item-green .item-icon[data-v-a2a95590] { background: var(--color-success);\n}\n.item-red .item-icon[data-v-a2a95590] { background: var(--color-error);\n}\n.item-blue .item-icon[data-v-a2a95590] { background: var(--color-info);\n}\n.item-gray .item-icon[data-v-a2a95590] { background: var(--color-text-secondary);\n}\n.item-orange .item-icon[data-v-a2a95590] { background: #ff9800;\n}\n.item-content[data-v-a2a95590] { flex: 1;\n}\n.item-title[data-v-a2a95590] {\n  margin: 0 0 0.25rem 0;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.item-description[data-v-a2a95590] {\n  margin: 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n.item-details[data-v-a2a95590] {\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(0, 0, 0, 0.05);\n  border-radius: 6px;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  font-family: 'Courier New', monospace;\n}\n.item-details p[data-v-a2a95590] {\n  margin: 0.25rem 0;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n",""]);const s=i},3466:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-manage[data-v-4c00416a] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  flex: 1;\n  min-height: 0;\n}\n.header[data-v-4c00416a] {\n  display: flex;\n  gap: 10px;\n  align-items: center;\n  flex-wrap: wrap;\n  padding: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  border-radius: 10px;\n}\n.kv[data-v-4c00416a] {\n  display: inline-flex;\n  gap: 6px;\n  align-items: center;\n  font-size: 0.85rem;\n}\n.kv .k[data-v-4c00416a] {\n  color: var(--color-text-secondary);\n}\n.kv .v[data-v-4c00416a] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.actions[data-v-4c00416a] {\n  margin-left: auto;\n  display: inline-flex;\n  gap: 8px;\n}\n.btn[data-v-4c00416a] {\n  display: inline-flex;\n  gap: 6px;\n  align-items: center;\n  padding: 7px 10px;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  cursor: pointer;\n  color: var(--color-text);\n  font-size: 0.85rem;\n  transition: all 0.2s ease;\n}\n.btn.primary[data-v-4c00416a] {\n  border-color: rgba(59, 130, 246, 0.35);\n  background: rgba(59, 130, 246, 0.08);\n  color: #3b82f6;\n}\n.btn[data-v-4c00416a]:hover:not(:disabled) {\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n}\n.btn[data-v-4c00416a]:disabled {\n  opacity: 0.65;\n  cursor: not-allowed;\n}\n.spin[data-v-4c00416a] {\n  animation: spin-4c00416a 0.9s linear infinite;\n}\n@keyframes spin-4c00416a {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n.notice[data-v-4c00416a] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  padding: 10px;\n  border-radius: 10px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.35);\n  background: rgba(var(--color-warning-rgb), 0.08);\n  color: var(--color-text);\n  font-size: 0.85rem;\n}\n.empty[data-v-4c00416a] {\n  flex: 1;\n  min-height: 0;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  border-radius: 10px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  color: var(--color-text-secondary);\n}\n.empty-text[data-v-4c00416a] {\n  font-weight: 800;\n  color: var(--color-text);\n}\n.content[data-v-4c00416a] {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.grid[data-v-4c00416a] {\n  display: grid;\n  grid-template-columns: repeat(3, minmax(0, 1fr));\n  gap: 10px;\n}\n.card[data-v-4c00416a] {\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  border-radius: 10px;\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  min-height: 0;\n}\n.card-title[data-v-4c00416a] {\n  font-weight: 800;\n}\n.row[data-v-4c00416a] {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.row .v[data-v-4c00416a] {\n  color: var(--color-text);\n  font-weight: 700;\n}\n.logs[data-v-4c00416a] {\n  flex: 1;\n  overflow: hidden;\n}\n.log-list[data-v-4c00416a] {\n  overflow: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding-right: 4px;\n}\n.log[data-v-4c00416a] {\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  border-radius: 10px;\n  padding: 10px;\n}\n.log-top[data-v-4c00416a] {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  margin-bottom: 6px;\n}\n.badge[data-v-4c00416a] {\n  font-size: 0.75rem;\n  padding: 2px 8px;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n}\n.muted[data-v-4c00416a] {\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n}\n.log-text[data-v-4c00416a] {\n  white-space: pre-wrap;\n  line-height: 1.5;\n  font-size: 0.88rem;\n  color: var(--color-text);\n}\n.tip[data-v-4c00416a] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  color: var(--color-text-secondary);\n  font-size: 0.82rem;\n}\n@media (max-width: 1024px) {\n.grid[data-v-4c00416a] {\n    grid-template-columns: 1fr;\n}\n.actions[data-v-4c00416a] {\n    margin-left: 0;\n}\n}\n",""]);const s=i},3509:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.character-section[data-v-6cf48088] {\n  border-radius: 8px;\n  padding: 1rem;\n}\n.section-header[data-v-6cf48088] {\n  margin-bottom: 1rem;\n}\n.section-title[data-v-6cf48088] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.info-grid[data-v-6cf48088] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  margin-bottom: 1rem;\n}\n.info-item[data-v-6cf48088] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n}\n.info-label[data-v-6cf48088] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-6cf48088] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.data-detail[data-v-6cf48088] {\n  margin-top: 1rem;\n  border-top: 1px solid var(--color-border);\n  padding-top: 1rem;\n}\n.detail-title[data-v-6cf48088] {\n  margin: 0 0 1rem 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  border-bottom: 1px solid var(--color-border);\n  padding-bottom: 0.5rem;\n}\n.code-pre[data-v-6cf48088] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  max-height: 60vh;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n  line-height: 1.5;\n  word-wrap: break-word;\n  white-space: pre-wrap;\n}\n.empty-state[data-v-6cf48088] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 3rem;\n  color: var(--color-text-secondary);\n}\n\n/* 手机端适配 */\n@media (max-width: 768px) {\n.code-pre[data-v-6cf48088] {\n    max-height: 50vh;\n    font-size: 0.8rem;\n    padding: 0.5rem;\n}\n.character-section[data-v-6cf48088] {\n    padding: 0.75rem;\n}\n.info-grid[data-v-6cf48088] {\n    grid-template-columns: 1fr;\n    gap: 0.75rem;\n}\n}\n@media (max-width: 480px) {\n.code-pre[data-v-6cf48088] {\n    max-height: 40vh;\n    font-size: 0.75rem;\n    padding: 0.4rem;\n}\n.character-section[data-v-6cf48088] {\n    padding: 0.5rem;\n}\n.empty-state[data-v-6cf48088] {\n    padding: 2rem;\n}\n}\n",""]);const s=i},3528:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},3628:(e,n,t)=>{"use strict";var a=t(8648),r=t(1064),o=t(7176);e.exports=a?function(e){return a(e)}:r?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return r(e)}:o?function(e){return o(e)}:null},3751:(e,n,t)=>{"use strict";t.d(n,{D$:()=>ke,Ef:()=>Se,F:()=>ne,Jo:()=>ce,XL:()=>pe,aG:()=>P,eB:()=>g,hp:()=>ge,jR:()=>_e,lH:()=>de,u1:()=>ve});var a=t(641),r=t(33),o=t(953);let i;const s="undefined"!=typeof window&&window.trustedTypes;if(s)try{i=s.createPolicy("vue",{createHTML:e=>e})}catch(e){}const l=i?e=>i.createHTML(e):e=>e,c="undefined"!=typeof document?document:null,d=c&&c.createElement("template"),u={insert:(e,n,t)=>{n.insertBefore(e,t||null)},remove:e=>{const n=e.parentNode;n&&n.removeChild(e)},createElement:(e,n,t,a)=>{const r="svg"===n?c.createElementNS("http://www.w3.org/2000/svg",e):"mathml"===n?c.createElementNS("http://www.w3.org/1998/Math/MathML",e):t?c.createElement(e,{is:t}):c.createElement(e);return"select"===e&&a&&null!=a.multiple&&r.setAttribute("multiple",a.multiple),r},createText:e=>c.createTextNode(e),createComment:e=>c.createComment(e),setText:(e,n)=>{e.nodeValue=n},setElementText:(e,n)=>{e.textContent=n},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>c.querySelector(e),setScopeId(e,n){e.setAttribute(n,"")},insertStaticContent(e,n,t,a,r,o){const i=t?t.previousSibling:n.lastChild;if(r&&(r===o||r.nextSibling))for(;n.insertBefore(r.cloneNode(!0),t),r!==o&&(r=r.nextSibling););else{d.innerHTML=l("svg"===a?`<svg>${e}</svg>`:"mathml"===a?`<math>${e}</math>`:e);const r=d.content;if("svg"===a||"mathml"===a){const e=r.firstChild;for(;e.firstChild;)r.appendChild(e.firstChild);r.removeChild(e)}n.insertBefore(r,t)}return[i?i.nextSibling:n.firstChild,t?t.previousSibling:n.lastChild]}},p="transition",v="animation",f=Symbol("_vtc"),h={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},m=(0,r.X$)({},a.QP,h),g=(e=>(e.displayName="Transition",e.props=m,e))((e,{slots:n})=>(0,a.h)(a.pR,x(e),n)),b=(e,n=[])=>{(0,r.cy)(e)?e.forEach(e=>e(...n)):e&&e(...n)},y=e=>!!e&&((0,r.cy)(e)?e.some(e=>e.length>1):e.length>1);function x(e){const n={};for(const t in e)t in h||(n[t]=e[t]);if(!1===e.css)return n;const{name:t="v",type:a,duration:o,enterFromClass:i=`${t}-enter-from`,enterActiveClass:s=`${t}-enter-active`,enterToClass:l=`${t}-enter-to`,appearFromClass:c=i,appearActiveClass:d=s,appearToClass:u=l,leaveFromClass:p=`${t}-leave-from`,leaveActiveClass:v=`${t}-leave-active`,leaveToClass:f=`${t}-leave-to`}=e,m=function(e){if(null==e)return null;if((0,r.Gv)(e))return[k(e.enter),k(e.leave)];{const n=k(e);return[n,n]}}(o),g=m&&m[0],x=m&&m[1],{onBeforeEnter:A,onEnter:L,onEnterCancelled:E,onLeave:T,onLeaveCancelled:R,onBeforeAppear:M=A,onAppear:P=L,onAppearCancelled:D=E}=n,z=(e,n,t,a)=>{e._enterCancelled=a,_(e,n?u:l),_(e,n?d:s),t&&t()},N=(e,n)=>{e._isLeaving=!1,_(e,p),_(e,f),_(e,v),n&&n()},$=e=>(n,t)=>{const r=e?P:L,o=()=>z(n,e,t);b(r,[n,o]),C(()=>{_(n,e?c:i),w(n,e?u:l),y(r)||S(n,a,g,o)})};return(0,r.X$)(n,{onBeforeEnter(e){b(A,[e]),w(e,i),w(e,s)},onBeforeAppear(e){b(M,[e]),w(e,c),w(e,d)},onEnter:$(!1),onAppear:$(!0),onLeave(e,n){e._isLeaving=!0;const t=()=>N(e,n);w(e,p),e._enterCancelled?(w(e,v),I()):(I(),w(e,v)),C(()=>{e._isLeaving&&(_(e,p),w(e,f),y(T)||S(e,a,x,t))}),b(T,[e,t])},onEnterCancelled(e){z(e,!1,void 0,!0),b(E,[e])},onAppearCancelled(e){z(e,!0,void 0,!0),b(D,[e])},onLeaveCancelled(e){N(e),b(R,[e])}})}function k(e){return(0,r.Ro)(e)}function w(e,n){n.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e[f]||(e[f]=new Set)).add(n)}function _(e,n){n.split(/\s+/).forEach(n=>n&&e.classList.remove(n));const t=e[f];t&&(t.delete(n),t.size||(e[f]=void 0))}function C(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let A=0;function S(e,n,t,a){const r=e._endId=++A,o=()=>{r===e._endId&&a()};if(null!=t)return setTimeout(o,t);const{type:i,timeout:s,propCount:l}=L(e,n);if(!i)return a();const c=i+"end";let d=0;const u=()=>{e.removeEventListener(c,p),o()},p=n=>{n.target===e&&++d>=l&&u()};setTimeout(()=>{d<l&&u()},s+1),e.addEventListener(c,p)}function L(e,n){const t=window.getComputedStyle(e),a=e=>(t[e]||"").split(", "),r=a(`${p}Delay`),o=a(`${p}Duration`),i=E(r,o),s=a(`${v}Delay`),l=a(`${v}Duration`),c=E(s,l);let d=null,u=0,f=0;return n===p?i>0&&(d=p,u=i,f=o.length):n===v?c>0&&(d=v,u=c,f=l.length):(u=Math.max(i,c),d=u>0?i>c?p:v:null,f=d?d===p?o.length:l.length:0),{type:d,timeout:u,propCount:f,hasTransform:d===p&&/\b(transform|all)(,|$)/.test(a(`${p}Property`).toString())}}function E(e,n){for(;e.length<n.length;)e=e.concat(e);return Math.max(...n.map((n,t)=>T(n)+T(e[t])))}function T(e){return"auto"===e?0:1e3*Number(e.slice(0,-1).replace(",","."))}function I(){return document.body.offsetHeight}const R=Symbol("_vod"),M=Symbol("_vsh"),P={beforeMount(e,{value:n},{transition:t}){e[R]="none"===e.style.display?"":e.style.display,t&&n?t.beforeEnter(e):D(e,n)},mounted(e,{value:n},{transition:t}){t&&n&&t.enter(e)},updated(e,{value:n,oldValue:t},{transition:a}){!n!=!t&&(a?n?(a.beforeEnter(e),D(e,!0),a.enter(e)):a.leave(e,()=>{D(e,!1)}):D(e,n))},beforeUnmount(e,{value:n}){D(e,n)}};function D(e,n){e.style.display=n?e[R]:"none",e[M]=!n}const z=Symbol(""),N=/(^|;)\s*display\s*:/,$=/\s*!important$/;function O(e,n,t){if((0,r.cy)(t))t.forEach(t=>O(e,n,t));else if(null==t&&(t=""),n.startsWith("--"))e.setProperty(n,t);else{const a=function(e,n){const t=j[n];if(t)return t;let a=(0,r.PT)(n);if("filter"!==a&&a in e)return j[n]=a;a=(0,r.ZH)(a);for(let t=0;t<F.length;t++){const r=F[t]+a;if(r in e)return j[n]=r}return n}(e,n);$.test(t)?e.setProperty((0,r.Tg)(a),t.replace($,""),"important"):e[a]=t}}const F=["Webkit","Moz","ms"],j={},B="http://www.w3.org/1999/xlink";function X(e,n,t,a,o,i=(0,r.J$)(n)){a&&n.startsWith("xlink:")?null==t?e.removeAttributeNS(B,n.slice(6,n.length)):e.setAttributeNS(B,n,t):null==t||i&&!(0,r.Y2)(t)?e.removeAttribute(n):e.setAttribute(n,i?"":(0,r.Bm)(t)?String(t):t)}function U(e,n,t,a,o){if("innerHTML"===n||"textContent"===n)return void(null!=t&&(e[n]="innerHTML"===n?l(t):t));const i=e.tagName;if("value"===n&&"PROGRESS"!==i&&!i.includes("-")){const a="OPTION"===i?e.getAttribute("value")||"":e.value,r=null==t?"checkbox"===e.type?"on":"":String(t);return a===r&&"_value"in e||(e.value=r),null==t&&e.removeAttribute(n),void(e._value=t)}let s=!1;if(""===t||null==t){const a=typeof e[n];"boolean"===a?t=(0,r.Y2)(t):null==t&&"string"===a?(t="",s=!0):"number"===a&&(t=0,s=!0)}try{e[n]=t}catch(e){}s&&e.removeAttribute(o||n)}function W(e,n,t,a){e.addEventListener(n,t,a)}const q=Symbol("_vei");const G=/(?:Once|Passive|Capture)$/;let H=0;const V=Promise.resolve(),Q=()=>H||(V.then(()=>H=0),H=Date.now()),K=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123;"undefined"!=typeof HTMLElement&&HTMLElement;const Y=new WeakMap,J=new WeakMap,Z=Symbol("_moveCb"),ee=Symbol("_enterCb"),ne=(e=>(delete e.props.mode,e))({name:"TransitionGroup",props:(0,r.X$)({},m,{tag:String,moveClass:String}),setup(e,{slots:n}){const t=(0,a.nI)(),r=(0,a.Gy)();let i,s;return(0,a.$u)(()=>{if(!i.length)return;const n=e.moveClass||`${e.name||"v"}-move`;if(!function(e,n,t){const a=e.cloneNode(),r=e[f];r&&r.forEach(e=>{e.split(/\s+/).forEach(e=>e&&a.classList.remove(e))}),t.split(/\s+/).forEach(e=>e&&a.classList.add(e)),a.style.display="none";const o=1===n.nodeType?n:n.parentNode;o.appendChild(a);const{hasTransform:i}=L(a);return o.removeChild(a),i}(i[0].el,t.vnode.el,n))return void(i=[]);i.forEach(te),i.forEach(ae);const a=i.filter(re);I(),a.forEach(e=>{const t=e.el,a=t.style;w(t,n),a.transform=a.webkitTransform=a.transitionDuration="";const r=t[Z]=e=>{e&&e.target!==t||e&&!/transform$/.test(e.propertyName)||(t.removeEventListener("transitionend",r),t[Z]=null,_(t,n))};t.addEventListener("transitionend",r)}),i=[]}),()=>{const l=(0,o.ux)(e),c=x(l);let d=l.tag||a.FK;if(i=[],s)for(let e=0;e<s.length;e++){const n=s[e];n.el&&n.el instanceof Element&&(i.push(n),(0,a.MZ)(n,(0,a.OW)(n,c,r,t)),Y.set(n,n.el.getBoundingClientRect()))}s=n.default?(0,a.Df)(n.default()):[];for(let e=0;e<s.length;e++){const n=s[e];null!=n.key&&(0,a.MZ)(n,(0,a.OW)(n,c,r,t))}return(0,a.bF)(d,null,s)}}});function te(e){const n=e.el;n[Z]&&n[Z](),n[ee]&&n[ee]()}function ae(e){J.set(e,e.el.getBoundingClientRect())}function re(e){const n=Y.get(e),t=J.get(e),a=n.left-t.left,r=n.top-t.top;if(a||r){const n=e.el.style;return n.transform=n.webkitTransform=`translate(${a}px,${r}px)`,n.transitionDuration="0s",e}}const oe=e=>{const n=e.props["onUpdate:modelValue"]||!1;return(0,r.cy)(n)?e=>(0,r.DY)(n,e):n};function ie(e){e.target.composing=!0}function se(e){const n=e.target;n.composing&&(n.composing=!1,n.dispatchEvent(new Event("input")))}const le=Symbol("_assign"),ce={created(e,{modifiers:{lazy:n,trim:t,number:a}},o){e[le]=oe(o);const i=a||o.props&&"number"===o.props.type;W(e,n?"change":"input",n=>{if(n.target.composing)return;let a=e.value;t&&(a=a.trim()),i&&(a=(0,r.bB)(a)),e[le](a)}),t&&W(e,"change",()=>{e.value=e.value.trim()}),n||(W(e,"compositionstart",ie),W(e,"compositionend",se),W(e,"change",se))},mounted(e,{value:n}){e.value=null==n?"":n},beforeUpdate(e,{value:n,oldValue:t,modifiers:{lazy:a,trim:o,number:i}},s){if(e[le]=oe(s),e.composing)return;const l=null==n?"":n;if((!i&&"number"!==e.type||/^0\d/.test(e.value)?e.value:(0,r.bB)(e.value))!==l){if(document.activeElement===e&&"range"!==e.type){if(a&&n===t)return;if(o&&e.value.trim()===l)return}e.value=l}}},de={deep:!0,created(e,n,t){e[le]=oe(t),W(e,"change",()=>{const n=e._modelValue,t=he(e),a=e.checked,o=e[le];if((0,r.cy)(n)){const e=(0,r.u3)(n,t),i=-1!==e;if(a&&!i)o(n.concat(t));else if(!a&&i){const t=[...n];t.splice(e,1),o(t)}}else if((0,r.vM)(n)){const e=new Set(n);a?e.add(t):e.delete(t),o(e)}else o(me(e,a))})},mounted:ue,beforeUpdate(e,n,t){e[le]=oe(t),ue(e,n,t)}};function ue(e,{value:n,oldValue:t},a){let o;if(e._modelValue=n,(0,r.cy)(n))o=(0,r.u3)(n,a.props.value)>-1;else if((0,r.vM)(n))o=n.has(a.props.value);else{if(n===t)return;o=(0,r.BX)(n,me(e,!0))}e.checked!==o&&(e.checked=o)}const pe={created(e,{value:n},t){e.checked=(0,r.BX)(n,t.props.value),e[le]=oe(t),W(e,"change",()=>{e[le](he(e))})},beforeUpdate(e,{value:n,oldValue:t},a){e[le]=oe(a),n!==t&&(e.checked=(0,r.BX)(n,a.props.value))}},ve={deep:!0,created(e,{value:n,modifiers:{number:t}},o){const i=(0,r.vM)(n);W(e,"change",()=>{const n=Array.prototype.filter.call(e.options,e=>e.selected).map(e=>t?(0,r.bB)(he(e)):he(e));e[le](e.multiple?i?new Set(n):n:n[0]),e._assigning=!0,(0,a.dY)(()=>{e._assigning=!1})}),e[le]=oe(o)},mounted(e,{value:n}){fe(e,n)},beforeUpdate(e,n,t){e[le]=oe(t)},updated(e,{value:n}){e._assigning||fe(e,n)}};function fe(e,n){const t=e.multiple,a=(0,r.cy)(n);if(!t||a||(0,r.vM)(n)){for(let o=0,i=e.options.length;o<i;o++){const i=e.options[o],s=he(i);if(t)if(a){const e=typeof s;i.selected="string"===e||"number"===e?n.some(e=>String(e)===String(s)):(0,r.u3)(n,s)>-1}else i.selected=n.has(s);else if((0,r.BX)(he(i),n))return void(e.selectedIndex!==o&&(e.selectedIndex=o))}t||-1===e.selectedIndex||(e.selectedIndex=-1)}}function he(e){return"_value"in e?e._value:e.value}function me(e,n){const t=n?"_trueValue":"_falseValue";return t in e?e[t]:n}const ge={created(e,n,t){be(e,n,t,null,"created")},mounted(e,n,t){be(e,n,t,null,"mounted")},beforeUpdate(e,n,t,a){be(e,n,t,a,"beforeUpdate")},updated(e,n,t,a){be(e,n,t,a,"updated")}};function be(e,n,t,a,r){const o=function(e,n){switch(e){case"SELECT":return ve;case"TEXTAREA":return ce;default:switch(n){case"checkbox":return de;case"radio":return pe;default:return ce}}}(e.tagName,t.props&&t.props.type)[r];o&&o(e,n,t,a)}const ye=["ctrl","shift","alt","meta"],xe={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,n)=>ye.some(t=>e[`${t}Key`]&&!n.includes(t))},ke=(e,n)=>{const t=e._withMods||(e._withMods={}),a=n.join(".");return t[a]||(t[a]=(t,...a)=>{for(let e=0;e<n.length;e++){const a=xe[n[e]];if(a&&a(t,n))return}return e(t,...a)})},we={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},_e=(e,n)=>{const t=e._withKeys||(e._withKeys={}),a=n.join(".");return t[a]||(t[a]=t=>{if(!("key"in t))return;const a=(0,r.Tg)(t.key);return n.some(e=>e===a||we[e]===a)?e(t):void 0})},Ce=(0,r.X$)({patchProp:(e,n,t,o,i,s)=>{const l="svg"===i;"class"===n?function(e,n,t){const a=e[f];a&&(n=(n?[n,...a]:[...a]).join(" ")),null==n?e.removeAttribute("class"):t?e.setAttribute("class",n):e.className=n}(e,o,l):"style"===n?function(e,n,t){const a=e.style,o=(0,r.Kg)(t);let i=!1;if(t&&!o){if(n)if((0,r.Kg)(n))for(const e of n.split(";")){const n=e.slice(0,e.indexOf(":")).trim();null==t[n]&&O(a,n,"")}else for(const e in n)null==t[e]&&O(a,e,"");for(const e in t)"display"===e&&(i=!0),O(a,e,t[e])}else if(o){if(n!==t){const e=a[z];e&&(t+=";"+e),a.cssText=t,i=N.test(t)}}else n&&e.removeAttribute("style");R in e&&(e[R]=i?a.display:"",e[M]&&(a.display="none"))}(e,t,o):(0,r.Mp)(n)?(0,r.CP)(n)||function(e,n,t,o,i=null){const s=e[q]||(e[q]={}),l=s[n];if(o&&l)l.value=o;else{const[t,c]=function(e){let n;if(G.test(e)){let t;for(n={};t=e.match(G);)e=e.slice(0,e.length-t[0].length),n[t[0].toLowerCase()]=!0}return[":"===e[2]?e.slice(3):(0,r.Tg)(e.slice(2)),n]}(n);if(o){const l=s[n]=function(e,n){const t=e=>{if(e._vts){if(e._vts<=t.attached)return}else e._vts=Date.now();(0,a.qL)(function(e,n){if((0,r.cy)(n)){const t=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{t.call(e),e._stopped=!0},n.map(e=>n=>!n._stopped&&e&&e(n))}return n}(e,t.value),n,5,[e])};return t.value=e,t.attached=Q(),t}(o,i);W(e,t,l,c)}else l&&(function(e,n,t,a){e.removeEventListener(n,t,a)}(e,t,l,c),s[n]=void 0)}}(e,n,0,o,s):("."===n[0]?(n=n.slice(1),1):"^"===n[0]?(n=n.slice(1),0):function(e,n,t,a){if(a)return"innerHTML"===n||"textContent"===n||!!(n in e&&K(n)&&(0,r.Tn)(t));if("spellcheck"===n||"draggable"===n||"translate"===n||"autocorrect"===n)return!1;if("form"===n)return!1;if("list"===n&&"INPUT"===e.tagName)return!1;if("type"===n&&"TEXTAREA"===e.tagName)return!1;if("width"===n||"height"===n){const n=e.tagName;if("IMG"===n||"VIDEO"===n||"CANVAS"===n||"SOURCE"===n)return!1}return(!K(n)||!(0,r.Kg)(t))&&n in e}(e,n,o,l))?(U(e,n,o),e.tagName.includes("-")||"value"!==n&&"checked"!==n&&"selected"!==n||X(e,n,o,l,0,"value"!==n)):!e._isVueCE||!/[A-Z]/.test(n)&&(0,r.Kg)(o)?("true-value"===n?e._trueValue=o:"false-value"===n&&(e._falseValue=o),X(e,n,o,l)):U(e,(0,r.PT)(n),o,0,n)}},u);let Ae;const Se=(...e)=>{const n=(Ae||(Ae=(0,a.K9)(Ce))).createApp(...e),{mount:t}=n;return n.mount=e=>{const a=function(e){if((0,r.Kg)(e))return document.querySelector(e);return e}(e);if(!a)return;const o=n._component;(0,r.Tn)(o)||o.render||o.template||(o.template=a.innerHTML),1===a.nodeType&&(a.textContent="");const i=t(a,!1,function(e){return e instanceof SVGElement?"svg":"function"==typeof MathMLElement&&e instanceof MathMLElement?"mathml":void 0}(a));return a instanceof Element&&(a.removeAttribute("v-cloak"),a.setAttribute("data-v-app","")),i},n}},3825:(e,n,t)=>{"use strict";t.d(n,{Cp:()=>_,IK:()=>d,Kg:()=>k,RJ:()=>l,RZ:()=>s,S3:()=>v,TY:()=>c,X4:()=>h,Z3:()=>i,_m:()=>o,appendTravelNote:()=>x,ep:()=>u,ih:()=>b,mS:()=>f,r9:()=>g,rz:()=>w,uQ:()=>p,xV:()=>m,zx:()=>y});var a=t(9333),r=t(8546);async function o(){return a.Em.get("/api/v1/travel/profile")}async function i(){return a.Em.post("/api/v1/travel/signin",{})}async function s(){return a.Em.get("/api/v1/travel/active")}async function l(e){return a.Em.get(`/api/v1/travel/status/${e}`)}async function c(e,n){return a.Em.post("/api/v1/travel/start",{target_username:e,invite_code:n})}async function d(e){return a.Em.post("/api/v1/travel/end",{session_id:e})}function u(e){if(!(0,r.isBackendConfigured)())return!1;const n=localStorage.getItem("access_token");if(!n)return!1;const t=(0,r.mh)("/api/v1/travel/end");if(!t)return!1;try{return fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({session_id:e}),keepalive:!0}).catch(()=>{}),!0}catch{return!1}}async function p(){return a.Em.get("/api/v1/worlds/instance/me")}async function v(e){return a.Em.post("/api/v1/worlds/instance/me/visibility",{visibility_mode:e})}async function f(e){return a.Em.post("/api/v1/worlds/instance/me/policy",{allow_offline_travel:e})}async function h(e){return a.Em.post("/api/v1/worlds/instance/me/offline-prompt",{offline_agent_prompt:e})}async function m(){return a.Em.post("/api/v1/worlds/instance/me/invite-code/regenerate",{})}async function g(e,n,t){const r=t?`?session_id=${encodeURIComponent(String(t))}`:"";return a.Em.get(`/api/v1/worlds/instance/${e}/map/${n}/graph${r}`)}async function b(e){return a.Em.get(`/api/v1/travel/logs/${e}`)}async function y(e){return a.Em.get(`/api/v1/travel/snapshot/${e}`)}async function x(e,n,t){return a.Em.post("/api/v1/travel/note",{session_id:e,note:n,meta:t})}async function k(e,n,t,r){return a.Em.post(`/api/v1/worlds/instance/${e}/action`,{session_id:t,action_type:"map_overwrite",intent:{locations:n,map_id:r}})}async function w(){return a.Em.get("/api/v1/invasion/reports/me")}async function _(e=0,n=20,t,r){const o=new URLSearchParams;return o.append("skip",e.toString()),o.append("limit",n.toString()),t&&o.append("visibility",t),r&&o.append("search",r),a.Em.get(`/api/v1/worlds/instance/list?${o.toString()}`)}},3943:(e,n,t)=>{"use strict";t.d(n,{Bj:()=>s,E0:()=>l,QS:()=>o,UZ:()=>d,uJ:()=>u});var a=t(2543);function r(e){const n=e.分钟??0;return 365*e.年*24*60+30*e.月*24*60+24*e.日*60+60*e.小时+n}function o(e){if(e<=0)return"已过期";if(e>=99999)return"永久";const n=Math.floor(e/525600),t=Math.floor(e%525600/43200),a=Math.floor(e%43200/1440),r=Math.floor(e%1440/60),o=e%60,i=[];return n>0&&i.push(`${n}年`),t>0&&i.push(`${t}月`),a>0&&i.push(`${a}天`),r>0&&i.push(`${r}小时`),o>0&&i.push(`${o}分钟`),i.length>0?i.join(""):"不足1分钟"}function i(e){if(!e||"string"!=typeof e)return 0;let n=0;const t=e.match(/(\d+)年/);t&&(n+=365*parseInt(t[1])*24*60);const a=e.match(/(\d+)月/);a&&(n+=30*parseInt(a[1])*24*60);const r=e.match(/(\d+)天/);r&&(n+=24*parseInt(r[1])*60);const o=e.match(/(\d+)小时/);o&&(n+=60*parseInt(o[1]));const i=e.match(/(\d+)分钟/);return i&&(n+=parseInt(i[1])),n}function s(e,n){if(e.生成时间&&"number"==typeof e.持续时间分钟){if(e.持续时间分钟<0||e.持续时间分钟>=99999)return!1;const t=r(e.生成时间);return r(n)-t>=e.持续时间分钟}return!(!e.时间||!e.剩余时间)&&i(e.剩余时间)<=0}function l(e,n){if(e.生成时间&&"number"==typeof e.持续时间分钟){if(e.持续时间分钟<0||e.持续时间分钟>=99999)return 99999;const t=r(e.生成时间),a=r(n)-t,o=e.持续时间分钟-a;return Math.max(0,o)}return 60}function c(e,n){try{if(!e||"object"!=typeof e)return console.warn("[状态效果] 无效的状态效果数据:",e),null;if(e.生成时间&&"number"==typeof e.持续时间分钟){const n=e,t=e.属性加成??e.后天属性;return t&&"object"==typeof t&&(n.属性加成=t),n}const t={状态名称:e.状态名称||e.name||"未知状态",类型:e.类型||e.type||"buff",生成时间:{年:n.年,月:n.月,日:n.日,小时:n.小时||0,分钟:n.分钟??0},持续时间分钟:0,状态描述:e.状态描述||e.description||"无描述",强度:e.强度||e.intensity,来源:e.来源||e.source};e.剩余时间?t.持续时间分钟=i(e.剩余时间):e.duration?t.持续时间分钟=i(e.duration):t.持续时间分钟=60;const a=e.属性加成??e.后天属性;return a&&"object"==typeof a&&(t.属性加成=a),t}catch(e){return console.error("[状态效果] 规范化状态效果失败:",e),null}}function d(e){const n=[];try{const t=(0,a.get)(e,"角色.效果",(0,a.get)(e,"效果",[]));if(!Array.isArray(t)||0===t.length)return{removedEffects:n};const r=e.元数据?.时间??e.时间;if(!r)return console.warn("[状态效果] 时间不存在，无法更新状态效果"),{removedEffects:n};const o=[];for(const e of t){if(!e||"object"!=typeof e){console.warn("[状态效果] 跳过无效的状态效果:",e);continue}const t=c(e,r);t?s(t,r)?(console.log(`[状态效果] 状态效果"${t.状态名称}"已过期，将被移除`),n.push(t.状态名称)):o.push(t):console.warn("[状态效果] 跳过无法规范化的状态效果:",e)}return n.length>0&&(e.角色||(e.角色={}),(0,a.set)(e,"角色.效果",o)),{removedEffects:n}}catch(e){return console.error("[状态效果] 更新状态效果失败:",e),{removedEffects:n}}}function u(e,n,t){return function(e,n){try{const t=e.元数据?.时间??e.时间;if(!t)return console.warn("[状态效果] 时间不存在，无法添加状态效果"),!1;const r=c(n,t);if(!r)return console.warn("[状态效果] 无法规范化状态效果数据:",n),!1;d(e);const o=(0,a.get)(e,"角色.效果",(0,a.get)(e,"效果",[])),i=o.findIndex(e=>{const n=e?.状态名称||e?.name,t=(e?.类型||"buff").toLowerCase(),a=(r?.类型||"buff").toLowerCase();return n===r.状态名称&&t===a});return i>=0?o[i]=r:o.push(r),e.角色||(e.角色={}),(0,a.set)(e,"角色.效果",o),!0}catch(e){return console.error("[状态效果] 添加状态效果失败:",e),!1}}(e,{状态名称:n||"未知异能",类型:t?.类型??"buff",状态描述:t?.状态描述??"异能效果",来源:t?.来源??"异能",剩余时间:null!=t?.持续时间分钟?`${t.持续时间分钟}分钟`:"60分钟",属性加成:t?.属性加成??{}})}},4039:(e,n,t)=>{"use strict";var a="undefined"!=typeof Symbol&&Symbol,r=t(1333);e.exports=function(){return"function"==typeof a&&"function"==typeof Symbol&&"symbol"==typeof a("foo")&&"symbol"==typeof Symbol("bar")&&r()}},4091:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},4093:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.dialog-overlay[data-v-b9efa476] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.75);\n  backdrop-filter: blur(8px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  padding: 1rem;\n  animation: fadeIn-b9efa476 0.3s ease-out;\n}\n@keyframes fadeIn-b9efa476 {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n.dialog-container[data-v-b9efa476] {\n  background-color: var(--color-surface);\n  border-radius: 16px;\n  padding: 2rem;\n  width: 100%;\n  max-width: 550px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n  animation: slideInUp-b9efa476 0.4s cubic-bezier(0.25, 1, 0.5, 1);\n}\n@keyframes slideInUp-b9efa476 {\nfrom {\n    opacity: 0;\n    transform: translateY(30px) scale(0.98);\n}\nto {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n}\n.dialog-header[data-v-b9efa476] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  color: var(--color-danger);\n}\n.header-icon[data-v-b9efa476] {\n  flex-shrink: 0;\n}\n.header-title[data-v-b9efa476] {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n}\n.dialog-content[data-v-b9efa476] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 2rem;\n}\n.content-lead[data-v-b9efa476] {\n  font-size: 1rem;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n.error-list-container[data-v-b9efa476] {\n  background-color: rgba(var(--color-danger-rgb), 0.05);\n  border: 1px solid rgba(var(--color-danger-rgb), 0.2);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.error-list-title[data-v-b9efa476] {\n  display: block;\n  margin-bottom: 0.75rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.error-list[data-v-b9efa476] {\n  list-style-type: none;\n  padding-left: 0;\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.error-item[data-v-b9efa476] {\n  font-family: 'Courier New', Courier, monospace;\n  font-size: 0.875rem;\n  color: var(--color-danger);\n  padding: 0.5rem;\n  background-color: rgba(var(--color-danger-rgb), 0.05);\n  border-radius: 4px;\n}\n.content-suggestion[data-v-b9efa476] {\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n}\n.content-suggestion strong[data-v-b9efa476] {\n  color: var(--color-warning);\n  font-weight: 600;\n}\n.dialog-actions[data-v-b9efa476] {\n  display: flex;\n  justify-content: flex-end;\n}\n.action-button[data-v-b9efa476] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  border: none;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.confirm-button[data-v-b9efa476] {\n  background-color: var(--color-primary);\n  color: white;\n}\n.confirm-button[data-v-b9efa476]:hover {\n  background-color: var(--color-primary-hover);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n",""]);const s=i},4190:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 基础布局 - 深色玻璃拟态风格 ========== */\n.step-wrapper[data-v-2e07bf78] {\n  height: 100%;\n}\n.creation-container[data-v-2e07bf78] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  overflow: hidden;\n  box-sizing: border-box;\n  background: transparent; /* 透明背景以显示视频 */\n}\n.creation-scroll[data-v-2e07bf78] {\n  width: 95%;\n  max-width: 1200px;\n  height: 92vh;\n  max-height: 92vh;\n  background: rgba(15, 23, 42, 0.75);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 16px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n  display: flex;\n  flex-direction: column;\n  padding: 2rem;\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  position: relative;\n  z-index: 1;\n  overflow: hidden;\n}\n\n/* ========== 头部区域 ========== */\n.header-container[data-v-2e07bf78] {\n  margin-bottom: 1.5rem;\n  flex-shrink: 0;\n}\n.header-top[data-v-2e07bf78] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n  gap: 0.75rem;\n}\n.mode-indicator[data-v-2e07bf78] {\n  font-size: 0.75rem;\n  color: #fbbf24;\n  padding: 0.25rem 0.75rem;\n  background: rgba(251, 191, 36, 0.1);\n  border: 1px solid rgba(251, 191, 36, 0.25);\n  border-radius: 4px;\n  font-weight: 500;\n  letter-spacing: 0.05em;\n}\n.cloud-sync-container[data-v-2e07bf78] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n\n/* ========== 进度步骤 ========== */\n.progress-steps[data-v-2e07bf78] {\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n  overflow-x: auto;\n  overflow-y: hidden;\n  gap: 0.5rem;\n  padding: 0.5rem 0;\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n}\n.progress-steps[data-v-2e07bf78]::-webkit-scrollbar {\n  display: none;\n}\n.step[data-v-2e07bf78] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  opacity: 0.4;\n  transition: all 0.3s ease;\n  flex-shrink: 0;\n  min-width: 60px;\n  cursor: default;\n}\n.step.active[data-v-2e07bf78] {\n  opacity: 1;\n}\n.step-circle[data-v-2e07bf78] {\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  background: rgba(30, 41, 59, 0.8);\n  border: 2px solid rgba(255, 255, 255, 0.1);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #94a3b8;\n  transition: all 0.3s ease;\n}\n.step.active .step-circle[data-v-2e07bf78] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  color: #ffffff;\n  border-color: rgba(96, 165, 250, 0.5);\n  box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);\n}\n.step-label[data-v-2e07bf78] {\n  margin-top: 0.5rem;\n  font-size: 0.7rem;\n  color: #64748b;\n  text-align: center;\n  letter-spacing: 0.05em;\n}\n.step.active .step-label[data-v-2e07bf78] {\n  color: #f1f5f9;\n  font-weight: 500;\n}\n\n/* ========== 内容区域 ========== */\n.step-content[data-v-2e07bf78] {\n  flex: 1 1 0;\n  min-height: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 1.5rem 0.5rem;\n  border-top: 1px solid rgba(255, 255, 255, 0.06);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.step-content[data-v-2e07bf78]::-webkit-scrollbar {\n  width: 6px;\n}\n.step-content[data-v-2e07bf78]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.step-content[data-v-2e07bf78]::-webkit-scrollbar-thumb {\n  background: rgba(147, 197, 253, 0.3);\n  border-radius: 3px;\n}\n.step-content[data-v-2e07bf78]::-webkit-scrollbar-thumb:hover {\n  background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 导航按钮 ========== */\n.navigation-buttons[data-v-2e07bf78] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n  flex-shrink: 0;\n  padding-top: 1.5rem;\n  position: relative;\n}\n.points-display[data-v-2e07bf78] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n}\n.destiny-points[data-v-2e07bf78] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 8px;\n}\n.points-label[data-v-2e07bf78] {\n  color: #94a3b8;\n  font-size: 0.85rem;\n}\n.points-value[data-v-2e07bf78] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #93c5fd;\n}\n.points-value.low[data-v-2e07bf78] {\n  color: #f87171;\n  animation: pulse-2e07bf78 1s ease-in-out infinite;\n}\n@keyframes pulse-2e07bf78 {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.5;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .creation-scroll[data-v-2e07bf78] {\n  background: rgba(255, 255, 255, 0.85);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .mode-indicator[data-v-2e07bf78] {\n  color: #d97706;\n  background: rgba(251, 191, 36, 0.15);\n  border-color: rgba(251, 191, 36, 0.3);\n}\n[data-theme="light"] .step-circle[data-v-2e07bf78] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.1);\n  color: #64748b;\n}\n[data-theme="light"] .step.active .step-circle[data-v-2e07bf78] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: rgba(59, 130, 246, 0.5);\n}\n[data-theme="light"] .step-label[data-v-2e07bf78] {\n  color: #94a3b8;\n}\n[data-theme="light"] .step.active .step-label[data-v-2e07bf78] {\n  color: #1e293b;\n}\n[data-theme="light"] .step-content[data-v-2e07bf78] {\n  border-color: rgba(0, 0, 0, 0.06);\n}\n[data-theme="light"] .destiny-points[data-v-2e07bf78] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .points-label[data-v-2e07bf78] {\n  color: #64748b;\n}\n[data-theme="light"] .points-value[data-v-2e07bf78] {\n  color: #3b82f6;\n}\n\n/* ========== 平板适配 ========== */\n@media (max-width: 768px) {\n.creation-scroll[data-v-2e07bf78] {\n    width: 98%;\n    height: 95vh;\n    max-height: 95vh;\n    padding: 1.5rem;\n    border-radius: 12px;\n}\n.header-container[data-v-2e07bf78] {\n    margin-bottom: 1rem;\n}\n.progress-steps[data-v-2e07bf78] {\n    justify-content: flex-start;\n    gap: 0.75rem;\n}\n.step[data-v-2e07bf78] {\n    min-width: 55px;\n}\n.step-circle[data-v-2e07bf78] {\n    width: 32px;\n    height: 32px;\n    font-size: 0.85rem;\n}\n.step-label[data-v-2e07bf78] {\n    font-size: 0.65rem;\n}\n.step-content[data-v-2e07bf78] {\n    padding: 1rem 0.25rem;\n}\n.navigation-buttons[data-v-2e07bf78] {\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.points-display[data-v-2e07bf78] {\n    flex-basis: 100%;\n    order: -1;\n    margin-bottom: 0.5rem;\n    position: static;\n    transform: none;\n}\n.navigation-buttons button[data-v-2e07bf78] {\n    flex: 1;\n    min-width: 100px;\n}\n}\n\n/* ========== 手机适配 ========== */\n@media (max-width: 480px) {\n.creation-scroll[data-v-2e07bf78] {\n    width: 100%;\n    height: 100vh;\n    max-height: 100vh;\n    padding: 1rem;\n    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n    border-radius: 0;\n    box-shadow: none;\n}\n.header-top[data-v-2e07bf78] {\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.5rem;\n}\n.mode-indicator[data-v-2e07bf78] {\n    text-align: center;\n    font-size: 0.7rem;\n}\n.cloud-sync-container[data-v-2e07bf78] {\n    justify-content: center;\n}\n.progress-steps[data-v-2e07bf78] {\n    gap: 0.4rem;\n}\n.step[data-v-2e07bf78] {\n    min-width: 46px;\n}\n.step-circle[data-v-2e07bf78] {\n    width: 28px;\n    height: 28px;\n    font-size: 0.75rem;\n}\n.step-label[data-v-2e07bf78] {\n    font-size: 0.55rem;\n}\n.step-content[data-v-2e07bf78] {\n    padding: 0.75rem 0.25rem;\n}\n.navigation-buttons[data-v-2e07bf78] {\n    padding-top: 0.75rem;\n    gap: 0.5rem;\n}\n.points-display[data-v-2e07bf78] {\n    width: 100%;\n    flex-basis: 100%;\n    order: -1;\n    margin-bottom: 0.5rem;\n    position: static;\n    transform: none;\n    justify-content: center;\n}\n.destiny-points[data-v-2e07bf78] {\n    padding: 0.4rem 0.75rem;\n}\n.points-label[data-v-2e07bf78] {\n    font-size: 0.75rem;\n}\n.points-value[data-v-2e07bf78] {\n    font-size: 0.95rem;\n}\n.navigation-buttons button[data-v-2e07bf78] {\n    flex: 1 1 calc(50% - 0.25rem);\n    min-width: 0;\n    padding: 0.6rem 0.4rem;\n    font-size: 0.8rem;\n}\n}\n\n/* ========== 超小屏幕适配 ========== */\n@media (max-width: 360px) {\n.creation-scroll[data-v-2e07bf78] {\n    padding: 0.75rem;\n}\n.step[data-v-2e07bf78] {\n    min-width: 42px;\n}\n.step-circle[data-v-2e07bf78] {\n    width: 26px;\n    height: 26px;\n    font-size: 0.7rem;\n}\n.step-label[data-v-2e07bf78] {\n    font-size: 0.5rem;\n}\n}\n',""]);const s=i},4191:(e,n,t)=>{"use strict";t.d(n,{c:()=>a});class a{static buildPrompt(e){const n=e.factionCount,t=e.totalLocations,a=e.continentCount,r=Math.min(e.secretRealms,t);if(0===n&&0===t)return this.buildContinentsOnlyPrompt(e);const o=Math.max(2,Math.floor(.25*t)),i=Math.max(2,Math.floor(.25*t)),s=Math.max(1,Math.floor(.15*t)),l=Math.max(2,Math.floor(.2*t)),c=Math.max(0,t-o-i-s-l),d=Math.floor(r*(.3+.3*Math.random())),u=Math.floor(r*(.2+.3*Math.random())),p=Math.max(0,r-d-u),v=e.characterBackground?`\n角色出身: ${e.characterBackground}`:"",f=e.worldBackground?`\n世界背景: ${e.worldBackground}`:"",h=e.worldEra?`\n世界时代: ${e.worldEra}`:"",m=e.worldName?`\n世界名称: ${e.worldName}`:"",g=e.mapConfig,b=Number(g?.minLng??0),y=Number(g?.minLat??0),x=Number(g?.width)||1e4,k=Number(g?.height)||1e4,w=Number(g?.maxLng??b+x),_=Number(g?.maxLat??y+k),C=Math.max(1,Math.floor(w-b)),A=Math.max(1,Math.floor(_-y)),S=Math.max(.6,Math.min(C,A)/1e4),L=Math.max(120,Math.round(150*S)),E=Math.max(240,Math.round(400*S)),T=Math.max(1e3,Math.round(2e3*S)),I=Math.max(2400,Math.round(5e3*S)),R=Date.now()+Math.floor(1e6*Math.random()),M=Math.random().toString(36).substring(7),P=Math.ceil(Math.sqrt(a)),D=Math.ceil(a/P),z=Math.floor(C/D),N=Math.floor(A/P),$=Math.floor(b+.25*C),O=Math.floor(y+.15*A),F=Math.floor(b+.23*C),j=Math.floor(b+.27*C),B=Math.floor(y+.13*A),X=Math.floor(y+.17*A);return`# 混沌纪元世界地图生成任务\n\n会话ID: ${M} | 随机种子: ${R}\n\n## 🎮 游戏坐标系统说明\n**重要**：本项目使用游戏坐标系统，不是经纬度！\n- 坐标范围：x: ${b}-${w}, y: ${y}-${_}（像素坐标）\n- 原点(${b},${y})在左上角，x向右增加，y向下增加\n- 所有位置、边界、范围都必须使用此坐标系统\n- 禁止使用经纬度或任何地理坐标系统\n\n## 🚨 最高优先级要求\n必须生成完整JSON：\n1. continents数组：${a}个大洲（边界不重叠）\n2. factions数组：${n}个势力（不能为空）\n3. locations数组：${t}个地点（不能为空）\n\n## 📐 分布与散点要求（强制）\n- 禁止聚集：势力/地点坐标不得都挤在地图中心或同一区域\n- 覆盖全部大洲：每个大洲都要有势力和地点，不能只出现在单个大洲\n- 边距留白：坐标需距离地图边缘≥2%宽高，避免贴边\n- 网格散点：各大洲内部按网格/象限取样坐标，确保南北/东西方向都有点位\n- 坐标随机但分散：同一大洲的势力/地点使用不同象限的随机值，避免坐标重叠\n\n## 世界设定\n${v}${f}${h}${m}\n\n## 🚨 世界风格适配（重要）\n**必须根据上述世界背景，自行判断并选择合适的风格：**\n- 命名风格：势力、地点的命名必须符合混沌/废土/异变背景设定\n- 觉醒体系：严格使用混沌纪元觉醒阶段（觉醒期/掌控期/精通期/质变期/突破期）\n- 势力类型：根据背景选择合适的势力类型（如避难所/城寨/教团/公司/帮派/变异群落）\n- 保持一致性：整个世界的风格必须统一，不要混搭修仙与科幻\n\n**禁用词根**：本心、问心、见性、归一、太玄、太虚、紫薇、天机、青霞、无量、昊天、玄天、太清、太上、无极、九天\n\n**重要**：\n- 只生成continents/factions/locations三个字段\n- 严禁输出world_name/world_background/generation_info/player_spawn\n- 每次生成必须显著不同，避免固化\n\n## 核心原则\n### 混沌纪元基础\n- 核心体系: 异能、觉醒、突变、代价、理智\n- 权力结构: 力量与资源控制\n- 生存法则: 适应者生存\n\n### 多样性与创新\n- 势力多样化: 每次不同类型组合\n- 地名创新: 避免模板化，结合废土与异变特色\n- 规模平衡: 根据背景调整\n\n### 势力分布参考\n武装势力(30%) | 家族势力(20%) | 掠夺者(15%) | 幸存者营地(15%) | 贸易联盟(10%) | 科研机构(10%)\n\n## 大洲生成要求（${a}个）\n### 🚨 关键要求：大洲必须完全覆盖地图，边界必须相连！\n\n### 网格分割法（强制执行）\n- 网格布局: ${P}行 × ${D}列\n- X轴分段: 每段${z}像素（游戏坐标）\n- Y轴分段: 每段${N}像素（游戏坐标）\n- 每个大洲占据一个网格单元\n\n### 大洲边界生成规则（重要！）\n**必须使用以下方法确保边界相连：**\n\n1. **第一个大洲（左上角）**：\n   - 左上角: (${b}, ${y})\n   - 右上角: (${b+z}, ${y})\n   - 右下角: (${b+z}, ${y+N})\n   - 左下角: (${b}, ${y+N})\n   - 可在中间添加1-2个点形成自然形状\n\n2. **其他大洲**：\n   - 必须与相邻大洲共享边界点\n   - 网格边界的四个角点必须精确对齐\n   - 可在边界中间添加1-2个点形成自然曲线\n   - 总点数：4-6个（推荐4-5个）\n\n### 大洲要求\n- 边界: 4-5个坐标点（最多6个），形成简单多边形\n- 坐标格式: {"x": 整数, "y": 整数}，范围${b}-${w}\n- **覆盖: 必须完全覆盖地图，相邻大洲边界必须精确对接，不留空隙**\n- 命名: 独特名称，避免方位词，符合世界背景\n- 描述: 详细描述大陆的地理特征、气候、文化特色\n- 特色: 独特地理特征（辐射区、废墟海、变异森林、结晶山脉等）\n- 势力: 每个大洲1-3个主要势力\n\n### 推荐形状（简单规则）\n- **矩形变体**：在矩形基础上，某条边中间加1个点形成凸起或凹陷\n- **梯形**：上下边不等长的四边形\n- **五边形**：在矩形基础上切掉一个角\n- ❌ 禁止：复杂的多角星形、不规则锯齿状\n\n### 边界铁律\n- ✅ 相邻大洲必须共享边界点（精确到像素）\n- ✅ 网格角点必须对齐（如 (${b+z}, ${y}) 必须是两个大洲的共同顶点）\n- ✅ 边界点按顺时针或逆时针顺序排列\n- ✅ 形状简洁，不要奇形怪状\n- ❌ 禁止：边界中间断开、留有空隙\n- ❌ 禁止：跨越网格边界\n- ❌ 禁止：过于复杂的形状（超过6个点）\n\n## 势力生成要求（${n}个）\n### 势力等级与规模\n- 霸主级势力：势力范围跨度≈${Math.round(1.2*E)} 像素，占大洲核心区\n- 大型势力：≈${Math.round((L+E)/2)} 像素\n- 中型势力：≈${Math.round(.9*L)} 像素\n- 小型势力：≈${Math.round(.7*L)} 像素（面积最小）\n- 勿随意使用超大范围，必须与等级匹配\n\n### 规模关系（游戏坐标）\n- 大洲: 超大地理板块，跨度${T}-${I}像素（游戏坐标）\n- **势力范围: 占大洲3%-8%，跨度${L}-${E}像素（游戏坐标）** ⚠️ 不要太大！\n- 势力位置: 必须在对应大洲边界内，使用游戏坐标{"x": 数字, "y": 数字}\n- 势力范围形状: 简单的4-5边形，不要复杂形状\n\n### 必需字段\n1. **基础信息**\n   - 名称、类型、等级（霸主级/大型/中型/小型）\n   - 描述、历史背景\n   - 特色专长（数组格式）\n\n2. **领导层字段**（前端直接显示）\n\`\`\`json\n{\n  "首领": "具体姓名（如：雷克斯）",\n  "首领觉醒阶段": "具体阶段（如：质变期）",\n  "最强觉醒阶段": "势力最高战力（必填）",\n  "综合战力": 数字1-100,\n  "核心成员数量": 数字,\n  "精英成员数量": 数字,\n  "正式成员数量": 数字,\n  "外围成员数量": 数字\n}\n\`\`\`\n\n3. **成员数量字段**（前端显示）\n\`\`\`json\n{\n  "总数": 总人数,\n  "按阶段": {\n    // 🚨 阶段不能超过领导层.最强觉醒阶段\n    // 阶段等级：觉醒期 < 掌控期 < 精通期 < 质变期 < 突破期\n    "觉醒期": 数量,\n    "掌控期": 数量\n  },\n  "按职位": {\n    "外围成员": 数量,\n    "正式成员": 数量,\n    "精英成员": 数量,\n    "核心成员": 数量,\n    "副首领": 1,\n    "首领": 1\n  }\n}\n\`\`\`\n\n### 数据一致性\n- 总数 = 按职位所有职位总和\n- 按阶段总和 = 总数\n- 按阶段等级 ≤ 最强觉醒阶段\n- 所有数值必须是数字类型\n\n### 人名要求\n- 具体姓名（可以是中文名或音译名，符合废土风格）\n- 每个人名唯一，不重复\n\n## 地点生成要求（${t}个）\n### 分布\n- 自然地标: ${l}个\n- 聚居地: ${o}个\n- 特殊设施: ${i}个\n- 危险区域: ${s}个\n- 其他地点: ${c}个\n- 均匀散点：各大洲都要有地点，禁止所有地点集中在地图中心或单一大洲\n- 坐标象限：同一大洲的地点请分布在不同象限，保持东西/南北方向的平衡\n\n### 6种标准类型（全部使用中文）\n1. 自然地标 - 山川湖泊、废墟景观\n2. 聚居地 - 城镇、避难所、交易站\n3. 资源点 - 矿场、能源站、种植园\n4. 遗迹设施 - 旧时代遗址、实验室\n5. 危险区域 - 辐射区、巢穴、禁地\n6. 其他特殊 - 异象点、传送门\n\n### 特殊属性（${r}个）\n- 机遇之地: ${d}个\n- 传承遗迹: ${u}个\n- 危险禁地: ${p}个\n\n### 地点坐标要求（重要）\n- 坐标格式: "坐标": {"x": 数字, "y": 数字}\n- 坐标范围: x和y必须在${b}-${w}之间（游戏坐标）\n- 地点位置必须在对应大洲边界内\n- 可在势力范围内外\n- 中立地点可不属于任何势力\n- 禁止使用经纬度或其他坐标系统\n\n## 数据结构检查\n### 严禁错误格式\n- ✗ 空数组: "势力范围": []\n- ✗ 空数组: "大洲边界": []\n- ✗ 空数组: "地理特征": []\n- ✗ 空数组: "天然屏障": []\n- ✗ 无效坐标: "位置": "初始地"\n- ✗ 缺失必需字段\n- ✗ 势力范围少于4个点\n- ✗ 大洲边界少于4个点或超过8个点\n- ✗ 大洲边界点顺序错误（必须按顺时针或逆时针排列，相邻点连接）\n\n### 必需字段\n**势力**：\n- 位置（对象，游戏坐标）: {"x": 数字, "y": 数字}\n- 势力范围（≥4点，按顺时针或逆时针顺序，游戏坐标）\n- 领导层（完整，使用新字段名：首领/核心成员数量等）\n- 成员数量（完整，使用新字段名：按阶段/外围成员等）\n\n**地点**：\n- 坐标（对象，游戏坐标）: {"x": 数字, "y": 数字}\n- 名称（字符串）\n- 类型（6种类型之一）\n- 描述（详细描述）\n\n**大洲**：\n- 大洲边界（4-6点，推荐4-5点，**必须按顺时针或逆时针顺序排列形成闭合多边形**，游戏坐标）\n- 地理特征（≥3个）\n- 天然屏障（≥2个）\n- 描述（详细的地理和文化描述）\n\n## JSON输出格式\n\`\`\`json\n{\n  "continents": [\n    {\n      "id": "continent_1",\n      "名称": "大洲名称",\n      "描述": "地理特征和文化描述",\n      "气候": "气候类型",\n      "地理特征": ["特征1", "特征2", "特征3"],\n      "天然屏障": ["屏障1", "屏障2"],\n      "大洲边界": [\n        {"x": ${b}, "y": ${y}},\n        {"x": ${b+z}, "y": ${y}},\n        {"x": ${b+z}, "y": ${y+N}},\n        {"x": ${b}, "y": ${y+N}}\n      ],\n      "主要势力": ["势力ID列表"]\n    }\n  ],\n  "factions": [\n    {\n      "id": "faction_1",\n      "名称": "势力名称",\n      "类型": "武装势力/家族势力/掠夺者集团等",\n      "等级": "霸主级/大型/中型/小型",\n      "描述": "势力背景描述",\n      "特色": ["专长1", "专长2"],\n      "与玩家关系": "中立",\n      "声望值": "程序自动计算",\n      "位置": {"x": ${$}, "y": ${O}},\n      "势力范围": [\n        {"x": ${F}, "y": ${B}},\n        {"x": ${j}, "y": ${B}},\n        {"x": ${j}, "y": ${X}},\n        {"x": ${F}, "y": ${X}}\n      ],\n      "领导层": {\n        "首领": "雷克斯",\n        "首领觉醒阶段": "质变期",\n        "副首领": "凯特",\n        "最强觉醒阶段": "质变期圆满",\n        "综合战力": 85,\n        "核心成员数量": 50,\n        "精英成员数量": 300,\n        "正式成员数量": 1200,\n        "外围成员数量": 5000\n      },\n      "成员数量": {\n        "总数": 6552,\n        "按阶段": {\n          "觉醒期": 5000,\n          "掌控期": 1200,\n          "精通期": 300,\n          "质变期": 50,\n          "突破期": 2\n        },\n        "按职位": {\n          "外围成员": 5000,\n          "正式成员": 1200,\n          "精英成员": 300,\n          "核心成员": 50,\n          "副首领": 1,\n          "首领": 1\n        }\n      },\n      "所属大洲": "continent_1"\n    }\n  ],\n  "locations": [\n    {\n      "id": "loc_1",\n      "名称": "地点名称",\n      "类型": "聚居地",\n      "坐标": {"x": 2500, "y": 1500},\n      "描述": "地点详细描述",\n      "安全等级": "安全",\n      "适合阶段": ["掌控期以上"],\n      "所属势力": "钢铁兄弟会",\n      "特殊特征": ["高墙防御", "能源充足"],\n      "特殊属性": []\n    }\n  ]\n}\n\`\`\`\n\n## 最终检查清单\n生成前必须确认：\n1. ✅ continents数组有${a}个对象，边界不重叠\n2. ✅ factions数组有${n}个对象（不是0个）\n3. ✅ locations数组有${t}个对象（不是0个）\n4. ✅ 每个势力有完整领导层和成员数量（使用新字段名）\n5. ✅ 每个势力范围≥4个坐标点\n6. ✅ 每个大洲边界4-8个坐标点\n7. ✅ 所有坐标为数字类型，范围在${b}-${w}之间\n8. ✅ 成员数量数据一致性\n9. ✅ 按阶段等级≤最强觉醒阶段\n10. ✅ 避免重复名称\n\n🔥 核心目标：创造独一无二的混沌纪元世界，包含完整势力组织架构！\n\n现在请生成完整JSON数据，确保所有数组都不为空！\n`}static buildContinentsOnlyPrompt(e){const n=e.continentCount,t=e.characterBackground?`\n角色出身: ${e.characterBackground}`:"",a=e.worldBackground?`\n世界背景: ${e.worldBackground}`:"",r=e.worldEra?`\n世界时代: ${e.worldEra}`:"",o=e.worldName?`\n世界名称: ${e.worldName}`:"",i=e.mapConfig,s=Number(i?.minLng??0),l=Number(i?.minLat??0),c=Number(i?.width)||1e4,d=Number(i?.height)||1e4,u=Number(i?.maxLng??s+c),p=Number(i?.maxLat??l+d),v=Math.max(1,Math.floor(u-s)),f=Math.max(1,Math.floor(p-l)),h=Date.now()+Math.floor(1e6*Math.random()),m=Math.random().toString(36).substring(7),g=Math.ceil(Math.sqrt(n)),b=Math.ceil(n/g),y=Math.floor(v/b),x=Math.floor(f/g);return`# 世界大陆框架生成任务（简化模式）\n\n会话ID: ${m} | 随机种子: ${h}\n\n## 🎮 游戏坐标系统说明\n**重要**：本项目使用游戏坐标系统，不是经纬度！\n- 坐标范围：x: ${s}-${u}, y: ${l}-${p}（像素坐标）\n- 原点(${s},${l})在左上角，x向右增加，y向下增加\n- 所有边界都必须使用此坐标系统\n- 禁止使用经纬度或任何地理坐标系统\n\n## 🚨 最高优先级要求\n**仅生成大陆框架，不生成势力和地点！**\n\n必须生成的JSON结构：\n1. continents数组：${n}个大洲\n2. factions数组：空数组 []\n3. locations数组：空数组 []\n\n## 世界设定\n${t}${a}${r}${o}\n\n## 🚨 世界风格适配（重要）\n**必须根据上述世界背景，自行判断并选择合适的风格：**\n- 命名风格：大陆命名必须符合世界背景设定\n- 保持一致性：整个世界的风格必须统一\n\n**禁用词根**：本心、问心、见性、归一、太玄、太虚、紫薇、天机、青霞、无量、昊天、玄天、太清、太上、无极、九天\n\n## 大洲生成要求（${n}个）\n### 🚨 关键要求：大洲必须完全覆盖地图，边界必须相连！\n\n### 网格分割法（强制执行）\n- 网格布局: ${g}行 × ${b}列\n- X轴分段: 每段${y}像素（游戏坐标）\n- Y轴分段: 每段${x}像素（游戏坐标）\n- 每个大洲占据一个网格单元\n\n### 大洲边界生成规则（重要！）\n**必须使用以下方法确保边界相连：**\n\n1. **第一个大洲（左上角）**：\n   - 左上角: (${s}, ${l})\n   - 右上角: (${s+y}, ${l})\n   - 右下角: (${s+y}, ${l+x})\n   - 左下角: (${s}, ${l+x})\n   - 可在中间添加1-2个点形成自然形状\n\n2. **其他大洲**：\n   - 必须与相邻大洲共享边界点\n   - 网格边界的四个角点必须精确对齐\n   - 总点数：4-6个（推荐4-5个）\n\n### 大洲要求\n- 边界: 4-5个坐标点（最多6个），形成简单多边形\n- 坐标格式: {"x": 整数, "y": 整数}，范围${s}-${u}\n- **覆盖: 必须完全覆盖地图，相邻大洲边界必须精确对接，不留空隙**\n- 命名: 独特名称，避免方位词，符合世界背景\n- 描述: 详细描述大陆的地理特征、气候、文化特色\n- 特色: 独特地理特征（雪域、沙漠、森林、山脉、海洋等）\n- 主要势力: 空数组 []（势力将在游戏中动态生成）\n\n## JSON输出格式\n\`\`\`json\n{\n  "continents": [\n    {\n      "id": "continent_1",\n      "名称": "大洲名称",\n      "描述": "地理特征和文化描述",\n      "气候": "气候类型",\n      "地理特征": ["特征1", "特征2", "特征3"],\n      "天然屏障": ["屏障1", "屏障2"],\n      "大洲边界": [\n        {"x": ${s}, "y": ${l}},\n        {"x": ${s+y}, "y": ${l}},\n        {"x": ${s+y}, "y": ${l+x}},\n        {"x": ${s}, "y": ${l+x}}\n      ],\n      "主要势力": []\n    }\n  ],\n  "factions": [],\n  "locations": []\n}\n\`\`\`\n\n## 最终检查清单\n生成前必须确认：\n1. ✅ continents数组有${n}个对象，边界不重叠且完全覆盖地图\n2. ✅ factions数组为空 []\n3. ✅ locations数组为空 []\n4. ✅ 每个大洲边界4-6个坐标点\n5. ✅ 所有坐标为数字类型，范围在${s}-${u}之间\n6. ✅ 相邻大洲边界精确对接\n\n🔥 核心目标：快速生成大陆框架，势力和地点将在游戏中动态探索生成！\n\n现在请生成JSON数据，只包含大陆信息！\n`}}},4220:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.talent-selection-container[data-v-29853d38] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n/* ========== 深色玻璃拟态风格 ========== */\n.loading-state[data-v-29853d38], .error-state[data-v-29853d38], .placeholder[data-v-29853d38] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.talent-layout[data-v-29853d38] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.talent-left-panel[data-v-29853d38] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n/* 顶部功能按钮 - 深色玻璃拟态风格 */\n.top-actions-container[data-v-29853d38] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-29853d38] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-29853d38]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n\n/* 亮色主题顶部按钮 */\n[data-theme="light"] .top-actions-container[data-v-29853d38] {\n  background: rgba(241, 245, 249, 0.6);\n  border-bottom-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-29853d38] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-29853d38]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n.talent-list-container[data-v-29853d38] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.talent-list-container[data-v-29853d38]::-webkit-scrollbar { width: 6px;\n}\n.talent-list-container[data-v-29853d38]::-webkit-scrollbar-track { background: transparent;\n}\n.talent-list-container[data-v-29853d38]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.talent-list-container[data-v-29853d38]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式 ========== */\n.talent-item[data-v-29853d38] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.item-content[data-v-29853d38] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n  gap: 0.5rem;\n}\n.talent-cost[data-v-29853d38] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-29853d38] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.talent-item:hover .action-buttons[data-v-29853d38] {\n  opacity: 1;\n}\n.edit-btn[data-v-29853d38], .delete-btn[data-v-29853d38] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-29853d38]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.1);\n}\n.delete-btn[data-v-29853d38]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.1);\n}\n.talent-item[data-v-29853d38]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.talent-item.selected[data-v-29853d38] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.talent-name[data-v-29853d38] {\n  font-weight: 500;\n  color: #f1f5f9;\n}\n.talent-item.selected .talent-name[data-v-29853d38] {\n  color: #bfdbfe;\n}\n.single-actions-container[data-v-29853d38] {\n  border-top: 1px solid var(--color-border);\n  background: rgba(0, 0, 0, 0.3);\n  padding: 0.5rem;\n  display: flex;\n  gap: 0.5rem;\n}\n.action-item[data-v-29853d38] {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0.8rem 1rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 1rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n.action-item[data-v-29853d38]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.action-name[data-v-29853d38] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.talent-details-container[data-v-29853d38] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.talent-details[data-v-29853d38] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.talent-details h2[data-v-29853d38] {\n  margin: 0 0 1rem 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.description-scroll[data-v-29853d38] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  margin-bottom: 1rem;\n  padding-right: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll p[data-v-29853d38] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.description-scroll[data-v-29853d38]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-29853d38]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-29853d38]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.talent-layout[data-v-29853d38] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.talent-layout[data-v-29853d38] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.talent-details h2[data-v-29853d38] {\n    font-size: 1.6rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-29853d38] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-29853d38] {\n    flex-grow: 1;\n    text-align: center;\n}\n.talent-layout[data-v-29853d38] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.talent-left-panel[data-v-29853d38] {\n    order: 1;\n    max-height: 40vh;\n}\n.talent-details-container[data-v-29853d38] {\n    order: 2;\n    min-height: 300px;\n}\n.talent-list-container[data-v-29853d38] {\n    max-height: 35vh;\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n\n  /* 优化触摸体验 */\n.talent-item[data-v-29853d38],\n  .action-item[data-v-29853d38] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.talent-layout[data-v-29853d38] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.talent-left-panel[data-v-29853d38] {\n    max-height: 35vh;\n}\n.talent-list-container[data-v-29853d38] {\n    max-height: 30vh;\n    padding: 0.5rem;\n}\n.talent-item[data-v-29853d38] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-29853d38] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-29853d38] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.talent-details-container[data-v-29853d38] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.talent-details h2[data-v-29853d38] {\n    font-size: 1.4rem;\n    margin-bottom: 0.8rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-29853d38] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.talent-selection-container[data-v-29853d38] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.talent-layout[data-v-29853d38] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.talent-left-panel[data-v-29853d38] {\n    max-height: none;\n    border-radius: 6px;\n}\n.talent-list-container[data-v-29853d38] {\n    max-height: 26vh;\n    padding: 0.4rem;\n}\n.talent-item[data-v-29853d38] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.talent-name[data-v-29853d38] {\n    font-size: 0.9rem;\n}\n.single-actions-container[data-v-29853d38] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-29853d38] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.talent-details-container[data-v-29853d38] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.talent-details h2[data-v-29853d38] {\n    font-size: 1.3rem;\n    margin-bottom: 0.6rem;\n}\n.description-scroll[data-v-29853d38] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n}\n.placeholder[data-v-29853d38] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-29853d38] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-29853d38] {\n    text-align: center;\n}\n}\n@media (max-width: 360px) {\n.talent-selection-container[data-v-29853d38] {\n    padding: 0.3rem;\n}\n.talent-layout[data-v-29853d38] {\n    gap: 0.4rem;\n}\n.talent-left-panel[data-v-29853d38] {\n    max-height: 28vh;\n}\n.talent-list-container[data-v-29853d38] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.talent-item[data-v-29853d38] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.talent-name[data-v-29853d38] {\n    font-size: 0.8rem;\n}\n.talent-details-container[data-v-29853d38] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.talent-details h2[data-v-29853d38] {\n    font-size: 1.1rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-29853d38] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n}\n.action-item[data-v-29853d38] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-29853d38] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .talent-left-panel[data-v-29853d38],\n[data-theme="light"] .talent-details-container[data-v-29853d38] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .talent-item[data-v-29853d38] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .talent-item[data-v-29853d38]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .talent-item.selected[data-v-29853d38] {\n  background: rgba(219, 234, 254, 0.8);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .talent-name[data-v-29853d38] {\n  color: #1e293b;\n}\n[data-theme="light"] .talent-item.selected .talent-name[data-v-29853d38] {\n  color: #1e40af;\n}\n[data-theme="light"] .talent-details h2[data-v-29853d38] {\n  color: #2563eb;\n}\n[data-theme="light"] .description-scroll p[data-v-29853d38] {\n  color: #475569;\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-29853d38],\n[data-theme="light"] .delete-btn[data-v-29853d38] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-29853d38]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-29853d38]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n',""]);const s=i},4227:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.action-menu[data-v-4273a3ac] {\n  position: fixed;\n  z-index: 120;\n}\n.overlay[data-v-4273a3ac] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(2px);\n  z-index: 0;\n}\n.fab[data-v-4273a3ac] {\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  background: var(--color-surface);\n  backdrop-filter: blur(10px);\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s ease;\n  position: relative;\n  z-index: 2;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n.fab[data-v-4273a3ac]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-primary);\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);\n}\n.menu[data-v-4273a3ac] {\n  position: absolute;\n  right: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding: 10px;\n  border-radius: 14px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(14px);\n  -webkit-backdrop-filter: blur(14px);\n  z-index: 2;\n  min-width: 180px;\n  white-space: nowrap;\n}\n[data-v-4273a3ac] .action-menu-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n  width: 100%;\n  text-decoration: none;\n  font-family: inherit;\n  font-size: 0.95rem;\n  box-sizing: border-box;\n}\n\n/* 确保 <a> 标签作为菜单项时样式一致 */\n[data-v-4273a3ac] a.action-menu-item {\n  display: flex;\n}\n[data-v-4273a3ac] .action-menu-item:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  transform: translateX(-2px);\n}\n[data-v-4273a3ac] .action-menu-item.is-disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n[data-v-4273a3ac] .action-menu-item span {\n  font-size: 0.95rem;\n  letter-spacing: 0.05em;\n}\n[data-v-4273a3ac] .action-menu-item.is-danger {\n  border-color: rgba(239, 68, 68, 0.25);\n  color: var(--color-error);\n}\n[data-v-4273a3ac] .action-menu-item.is-danger:hover {\n  border-color: var(--color-error);\n  background: rgba(239, 68, 68, 0.1);\n}\n.pos-bottom-right .menu[data-v-4273a3ac] {\n  bottom: 62px;\n}\n.pos-top-right .menu[data-v-4273a3ac] {\n  top: 62px;\n}\n.menu-fade-enter-active[data-v-4273a3ac],\n.menu-fade-leave-active[data-v-4273a3ac] {\n  transition: opacity 0.18s ease;\n}\n.menu-fade-enter-from[data-v-4273a3ac],\n.menu-fade-leave-to[data-v-4273a3ac] {\n  opacity: 0;\n}\n.menu-pop-enter-active[data-v-4273a3ac],\n.menu-pop-leave-active[data-v-4273a3ac] {\n  transition: transform 0.18s ease, opacity 0.18s ease;\n}\n.menu-pop-enter-from[data-v-4273a3ac],\n.menu-pop-leave-to[data-v-4273a3ac] {\n  opacity: 0;\n  transform: translateY(6px) scale(0.98);\n}\n@media (max-width: 600px) {\n.action-menu[data-v-4273a3ac] {\n    bottom: 12px;\n    right: 12px;\n    top: auto;\n}\n.pos-top-right[data-v-4273a3ac] {\n    top: 12px;\n    bottom: auto;\n}\n.fab[data-v-4273a3ac] {\n    width: 40px;\n    height: 40px;\n    border-radius: 10px;\n}\n.pos-bottom-right .menu[data-v-4273a3ac] {\n    bottom: 52px;\n    min-width: 150px;\n}\n.pos-top-right .menu[data-v-4273a3ac] {\n    top: 52px;\n    min-width: 150px;\n}\n}\n",""]);const s=i},4270:(e,n,t)=>{"use strict";t.d(n,{T:()=>c,o:()=>l});var a=t(953);const r=(0,a.KR)([]);let o=0;const i=e=>{const n=r.value.findIndex(n=>n.id===e);n>-1&&r.value.splice(n,1)},s=(e,n,t={})=>{const a=t.id||"toast-"+o++;i(a);const s=t.duration??("loading"===e?void 0:3e3),l={id:a,type:e,message:n,duration:s};return r.value.push(l),void 0!==s&&setTimeout(()=>{i(a)},s),a},l={success:(e,n={})=>s("success",e,n),error:(e,n={})=>s("error",e,n),warning:(e,n={})=>s("warning",e,n),info:(e,n={})=>s("info",e,n),loading:(e,n={})=>{const t=void 0===n.duration?void 0:n.duration;return s("loading",e,{...n,duration:t})},hide:i},c=(0,a.tB)(r)},4417:e=>{"use strict";e.exports=function(e,n){return n||(n={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),n.hash&&(e+=n.hash),/["'() \t\n]|(%20)/.test(e)||n.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},4449:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.online-travel-map-panel[data-v-5bad2f10] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding: 12px;\n  box-sizing: border-box;\n}\n.panel-header[data-v-5bad2f10] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 10px 12px;\n  border: 1px solid var(--color-border, #e2e8f0);\n  border-radius: 12px;\n  background: var(--color-surface, #fff);\n}\n.title[data-v-5bad2f10] {\n  display: flex;\n  align-items: baseline;\n  flex-wrap: wrap;\n  gap: 8px;\n  min-width: 0;\n}\n.title-text[data-v-5bad2f10] {\n  font-weight: 700;\n  color: var(--color-text, #111827);\n}\n.meta[data-v-5bad2f10] {\n  color: var(--color-text-muted, #6b7280);\n  font-size: 0.85rem;\n}\n.actions[data-v-5bad2f10] {\n  display: flex;\n  gap: 8px;\n}\n.tool-btn[data-v-5bad2f10] {\n  border: 1px solid var(--color-border, #e2e8f0);\n  background: var(--color-surface, #fff);\n  color: var(--color-text, #111827);\n  padding: 6px 10px;\n  border-radius: 10px;\n  cursor: pointer;\n}\n.tool-btn[data-v-5bad2f10]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.tool-btn.graphic-btn[data-v-5bad2f10] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);\n  color: white;\n  border: none;\n  font-weight: 500;\n}\n.tool-btn.graphic-btn[data-v-5bad2f10]:hover {\n  background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);\n}\n.empty-state[data-v-5bad2f10] {\n  flex: 1;\n  border: 1px dashed var(--color-border, #e2e8f0);\n  border-radius: 12px;\n  background: var(--color-surface, #fff);\n  padding: 18px;\n  display: grid;\n  place-items: center;\n  text-align: center;\n  gap: 6px;\n}\n.empty-title[data-v-5bad2f10] {\n  font-weight: 700;\n  color: var(--color-text, #111827);\n}\n.empty-hint[data-v-5bad2f10] {\n  color: var(--color-text-muted, #6b7280);\n  font-size: 0.9rem;\n}\n.content[data-v-5bad2f10] {\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  flex: 1;\n  overflow: hidden;\n}\n.loading-state[data-v-5bad2f10],\n.error-state[data-v-5bad2f10] {\n  padding: 24px;\n  text-align: center;\n  color: var(--color-text-muted, #6b7280);\n}\n.error-state[data-v-5bad2f10] {\n  color: #dc2626;\n}\n.world-info-container[data-v-5bad2f10] {\n  flex: 1;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  padding: 4px;\n}\n.info-section[data-v-5bad2f10] {\n  border: 1px solid var(--color-border, #e2e8f0);\n  border-radius: 12px;\n  background: var(--color-surface, #fff);\n  padding: 14px;\n}\n.section-title[data-v-5bad2f10] {\n  font-weight: 700;\n  color: var(--color-text, #111827);\n  margin-bottom: 10px;\n  font-size: 0.95rem;\n}\n.info-grid[data-v-5bad2f10] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px 24px;\n  margin-bottom: 8px;\n}\n.info-item[data-v-5bad2f10] {\n  font-size: 0.9rem;\n  color: var(--color-text, #111827);\n}\n.info-item .label[data-v-5bad2f10] {\n  color: var(--color-text-muted, #6b7280);\n}\n.info-desc[data-v-5bad2f10] {\n  font-size: 0.85rem;\n  color: var(--color-text-muted, #6b7280);\n  line-height: 1.5;\n}\n.list-container[data-v-5bad2f10] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.list-item[data-v-5bad2f10] {\n  padding: 10px 12px;\n  border: 1px solid var(--color-border, #e2e8f0);\n  border-radius: 8px;\n  background: var(--color-background, rgba(0, 0, 0, 0.2));\n}\n.item-name[data-v-5bad2f10] {\n  font-weight: 600;\n  color: var(--color-text, #111827);\n  margin-bottom: 4px;\n}\n.item-meta[data-v-5bad2f10] {\n  font-size: 0.8rem;\n  color: var(--color-text-muted, #6b7280);\n}\n.item-desc[data-v-5bad2f10] {\n  font-size: 0.85rem;\n  color: var(--color-text-muted, #6b7280);\n  margin-top: 4px;\n  line-height: 1.4;\n}\n",""]);const s=i},4459:(e,n,t)=>{"use strict";t.d(n,{e:()=>o});var a=t(602),r=t(8263);const o=new class{db=null;async init(){this.db||(this.db=await(0,a.P2)("dad-prompts",1,{upgrade(e){e.objectStoreNames.contains("prompts")||e.createObjectStore("prompts",{keyPath:"key"})}}))}async loadAll(){await this.init();const e=(0,r.LB)(),n={};for(const t in e){const a=await this.db.get("prompts",t),r=a?.content||e[t].content,o=!1!==a?.enabled,i=void 0!==a?.weight?a.weight:e[t].weight;n[t]={key:t,name:e[t].name,content:r,modified:!!a&&a.content!==e[t].content,enabled:o,default:e[t].content,category:e[t].category,description:e[t].description,order:e[t].order,weight:i,condition:e[t].condition}}return n}async loadByCategory(e){await this.init();const n=await this.loadAll(),t={};for(const[e,n]of Object.entries(r.y8))t[e]={info:n,prompts:[]};for(const a in n){const r=n[a];if(e&&r.condition){if("onlineMode"===r.condition&&!e.isOnlineMode)continue;if("splitGeneration"===r.condition&&!e.isSplitGeneration)continue;if("eventSystem"===r.condition&&!e.isEventSystemEnabled)continue}const o=r.category;if(t[o])t[o].prompts.push(r);else{const e=Object.keys(t)[0];e&&t[e].prompts.push(r)}}for(const e in t)t[e].prompts.sort((e,n)=>(e.order||999)-(n.order||999));return t}async save(e,n,t=!0,a){await this.init(),await this.db.put("prompts",{key:e,content:n,modified:!0,enabled:t,weight:a,updatedAt:(new Date).toISOString()})}async setEnabled(e,n){await this.init();const t=(0,r.LB)(),a=await this.db.get("prompts",e),o=a?.content||t[e]?.content||"",i=a?.modified||!1;await this.db.put("prompts",{key:e,content:o,modified:i,enabled:n,updatedAt:(new Date).toISOString()})}async getEnabledPrompts(){const e=await this.loadAll();return Object.keys(e).filter(n=>e[n].enabled)}async get(e){await this.init();const n=(0,r.LB)(),t=await this.db.get("prompts",e);return!1===t?.enabled?"":t?.modified?t.content:n[e]?.content||""}async reset(e){await this.init(),await this.db.delete("prompts",e)}async resetAll(){await this.init(),await this.db.clear("prompts")}async exportAll(){const e=await this.loadAll(),n={};for(const t in e)n[t]=e[t].content;return n}async importPrompts(e){await this.init();const n=(0,r.LB)();let t=0;for(const a in e)n[a]&&(await this.save(a,e[a]),t++);return t}}},4511:(e,n,t)=>{"use strict";var a=t(5072),r=t.n(a),o=t(7825),i=t.n(o),s=t(7659),l=t.n(s),c=t(5056),d=t.n(c),u=t(540),p=t.n(u),v=t(1113),f=t.n(v),h=t(1208),m={};m.styleTagTransform=f(),m.setAttributes=d(),m.insert=l().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=p(),r()(h.A,m),h.A&&h.A.locals&&h.A.locals},4530:(e,n,t)=>{"use strict";t.d(n,{DO:()=>o,WI:()=>v,jj:()=>x,ru:()=>p});var a=t(6728),r=t(1267);function o(e){const n={角色名字:"未知",觉醒阶段:"凡人",位置:"未知",游戏时间:null};if(!e||"object"!=typeof e)return n;const t=e;let a=n.角色名字;t.角色?.身份?.名字?a=t.角色.身份.名字:t.角色基础信息?.名字?a=t.角色基础信息.名字:t.玩家角色基础信息?.名字?a=t.玩家角色基础信息.名字:t.玩家角色信息?.名字?a=t.玩家角色信息.名字:t.玩家角色状态信息?.角色?.名字&&(a=t.玩家角色状态信息.角色.名字);let r=n.觉醒阶段;if(t.角色?.属性?.觉醒阶段){const e=t.角色.身份.觉醒阶段;r="string"==typeof e?e:e?.名称||e?.name||"凡人"}else if(t.属性?.觉醒阶段){const e=t.属性.觉醒阶段;r="string"==typeof e?e:e?.名称||e?.name||"凡人"}else if(t.状态?.觉醒阶段){const e=t.状态.觉醒阶段;r="string"==typeof e?e:e?.名称||e?.name||"凡人"}else if(t.玩家角色状态?.觉醒阶段){const e=t.玩家角色状态.觉醒阶段;r="string"==typeof e?e:e?.名称||e?.name||"凡人"}else if(t.玩家角色状态信息?.觉醒阶段){const e=t.玩家角色状态信息.觉醒阶段;r="string"==typeof e?e:e?.名称||e?.name||"凡人"}let o=n.位置;if(t.角色?.位置?.描述)o=t.角色.位置.描述;else if(t.角色?.位置?.地点)o=t.角色.位置.地点;else if(t.位置?.描述)o=t.位置.描述;else if(t.位置?.地点)o=t.位置.地点;else if("string"==typeof t.位置)o=t.位置;else if(t.状态?.位置){const e=t.状态.位置;o="string"==typeof e?e:e?.描述||e?.地点||"未知"}else if(t.玩家角色状态?.位置){const e=t.玩家角色状态.位置;o="string"==typeof e?e:e?.描述||e?.地点||"未知"}else if(t.玩家角色状态信息?.位置){const e=t.玩家角色状态信息.位置;o="string"==typeof e?e:e?.描述||e?.地点||"未知"}let i=null;return t.元数据?.时间?i=u(t.元数据.时间):t.时间?i=u(t.时间):t.游戏时间&&(i=u(t.游戏时间)),{角色名字:a,觉醒阶段:r,位置:o,游戏时间:i}}const i=["状态","玩家角色状态","玩家角色状态信息","玩家角色信息","角色基础信息","玩家角色基础信息","修行状态","状态效果","叙事历史","对话历史","任务系统","事件系统","势力系统","世界信息","人物关系","装备栏","游戏时间","掌握技能","身体部位开发"],s=["元数据","角色","社交","世界","系统"],l=e=>JSON.parse(JSON.stringify(e)),c=e=>!!e&&"object"==typeof e&&!Array.isArray(e),d=e=>{if(Array.isArray(e))return e.map(d);if(!c(e))return e;const n={};for(const[t,a]of Object.entries(e))"_AI说明"!==t&&"_AI修改规则"!==t&&"_AI重要提醒"!==t&&(n[t]=d(a));return n},u=e=>{const n={年:1e3,月:1,日:1,小时:8,分钟:0};return c(e)?{年:Number(e.年??e.年数??n.年),月:Number(e.月??n.月),日:Number(e.日??n.日),小时:Number(e.小时??n.小时),分钟:Number(e.分钟??n.分钟)}:n};function p(e){if(!e||"object"!=typeof e)return!1;const n=e;return c(n.元数据)&&c(n.角色)&&c(n.社交)&&c(n.世界)&&c(n.系统)}function v(e){if(!e||"object"!=typeof e)return{needsMigration:!0,issues:["invalid-structure"],legacyKeysFound:[]};const n=e;if(p(e))return{needsMigration:!1,issues:[],legacyKeysFound:[]};const t=[...i.filter(e=>e in n),...n.属性||n.位置||n.背包||n.时间?["短路径平铺"]:[]],a=s.filter(e=>!(e in n)),r=[];return t.length>0&&r.push("legacy-root-keys"),a.length>0&&r.push("missing-required-keys"),{needsMigration:r.length>0,issues:r,legacyKeysFound:t}}const f=()=>({配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]}),h=e=>Array.isArray(e)?e.filter(e=>"string"==typeof e&&e.trim().length>0):"string"==typeof e&&e.trim().length>0?[e.trim()]:[],m=e=>{if(!c(e))return{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]};const n=e;return{短期记忆:h(n.短期记忆??n.short_term??n.shortTerm),中期记忆:h(n.中期记忆??n.mid_term??n.midTerm),长期记忆:h(n.长期记忆??n.long_term??n.longTerm),隐式中期记忆:h(n.隐式中期记忆??n.implicit_mid_term??n.implicitMidTerm)}},g=()=>({模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"}),b=e=>({世界名称:"朝天大陆",大陆信息:[],势力信息:[],地点信息:[],生成时间:e,世界背景:"",世界纪元:"",特殊设定:[],版本:"v1"}),y=()=>({名字:"无名修士",性别:"男",出生日期:{年:982,月:1,日:1},种族:"人族",世界:"朝天大陆",天资:"凡人",出生:"散修",天赋:[],先天属性:{力量:5,敏捷:5,意志:5,幸运:5,魅力:5,心性:5},后天属性:{力量:0,敏捷:0,意志:0,幸运:0,魅力:0,心性:0}});function x(e){const n=l(e??{}),t=d(n),o={legacyKeysFound:[],removedLegacyKeys:[],warnings:[]};if(p(t)){const e=l(t);return c(e.社交)||(e.社交={}),e.社交.记忆=m(e.社交.记忆),e?.角色?.背包&&"object"==typeof e.角色.背包&&(0,r.dE)(e.角色.背包),{migrated:e,report:o}}o.legacyKeysFound=i.filter(e=>e in t);const v=(new Date).toISOString(),h=t.角色??t.角色基础信息??t.玩家角色基础信息??t.玩家角色信息??t.玩家角色状态信息?.角色??null,x=t.属性??t.状态??t.玩家角色状态??t.玩家角色状态信息??null,k=c(x)?x:{},w=k.觉醒阶段,_=c(w)?w:w?{名称:String(w),阶段:"初期",当前进度:0,下一级所需:100,突破描述:""}:null,C={觉醒阶段:_??null,声望:Number(k.声望??0),生命值:k.生命值??{当前:100,上限:100},精神力:k.精神力??{当前:50,上限:50},体力:k.体力??{当前:0,上限:0},理智值:k.理智值??{当前:30,上限:30},寿命:k.寿命??{当前:18,上限:80},属性:{威胁等级:"F",觉醒阶段:"string"==typeof _?.名称?_.名称:"凡人",当前进度:Number(_?.当前进度??0),下一级所需:Number(_?.下一级所需??100),突破描述:String(_?.突破描述??""),生命值:k.生命值??{当前:100,上限:100},精神力:k.精神力??{当前:50,上限:50},体力:k.体力??{当前:0,上限:0},理智值:k.理智值??{当前:30,上限:30},寿命:k.寿命??{当前:18,上限:80}}};try{const e=(0,a.Ew)(t),n=C.属性?.觉醒阶段??"凡人",r=new Set(["凡人","觉醒期","掌控期","精通期","质变期","突破期","传说期"]).has(n)?n:"凡人",o=(0,a.Nz)(e,r);C.属性.生命值=o.HP,C.属性.精神力=o.SP,C.属性.体力=o.ST,C.属性.理智值=o.SAN,C.生命值=o.HP,C.精神力=o.SP,C.体力=o.ST,C.理智值=o.SAN}catch{}const A=t.效果??t.修行状态??k.状态效果??t.状态效果??[],S=Array.isArray(A)?A:[],L=(c(t.角色?.位置)?t.角色.位置:void 0)??t.位置??k.位置??t.状态位置??{描述:"混沌纪元·无名之地",x:5e3,y:5e3};try{const e=new Set(["绿区","黄区","橙区","红区","黑区"]);if(c(L)){"string"==typeof L.描述&&L.描述.trim()||(L.描述="混沌纪元·无名之地"),"number"==typeof L.x&&Number.isFinite(L.x)||(L.x=5e3),"number"==typeof L.y&&Number.isFinite(L.y)||(L.y=5e3);const n=String(L.区域等级??"").trim();L.区域等级=e.has(n)?n:"黄区"}}catch{}const E=u(t.元数据?.时间??t.时间??t.游戏时间),T=t.背包??{突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}};T&&"object"==typeof T&&(0,r.dE)(T);const I=t.装备??t.装备栏??{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},R=t.技能??(t.掌握技能?{掌握技能:t.掌握技能,装备栏:[],冷却:{}}:{掌握技能:[],装备栏:[],冷却:{}}),M=t.宗门??t.宗门系统??void 0,P=t.关系??t.人物关系??{},D=m(t.记忆??t.社交?.记忆),z=t.事件??t.事件系统??f(),N=(()=>{const e=c(z)?l(z):f();return Array.isArray(e.事件记录)||(e.事件记录=[]),c(e.下次事件时间)||(e.下次事件时间=null),e})(),$=t.世界?.信息??t.世界??t.世界信息??t.worldInfo??void 0,O=c($)?$:b(v),F=t.系统?.配置??t.系统??t.系统配置??void 0,j=t.系统?.历史?.叙事??t.历史?.叙事??(t.叙事历史?t.叙事历史:t.对话历史?t.对话历史:[]),B=t.系统?.联机??t.联机??g(),X=c(h)?h:y(),U={元数据:{版本号:3,存档ID:String(t.元数据?.存档ID??t.存档ID??`save_${Date.now()}`),存档名:String(t.元数据?.存档名??t.存档名??"迁移存档"),游戏版本:t.元数据?.游戏版本??t.游戏版本,创建时间:String(t.元数据?.创建时间??t.创建时间??v),更新时间:v,游戏时长秒:Number(t.元数据?.游戏时长秒??t.游戏时长秒??t.元数据?.游戏时长??t.游戏时长??0),时间:E},角色:{身份:X,属性:C,位置:L,效果:S,身体:t.身体??(t.身体部位开发?{部位开发:t.身体部位开发}:void 0),背包:T,装备:I,技能:R},社交:{关系:P,势力:M??null,事件:N,记忆:D},世界:{信息:O,状态:t.世界?.状态??t.世界状态??void 0},系统:{配置:F,设置:t.系统?.设置??t.设置??void 0,缓存:t.系统?.缓存??t.缓存??void 0,行动队列:t.系统?.行动队列??t.行动队列??void 0,历史:{叙事:Array.isArray(j)?j:[]},扩展:t.系统?.扩展??t.扩展??{},联机:c(B)?{...g(),...B}:g()}};for(const e of i)e in t&&o.removedLegacyKeys.push(String(e));for(const e of s)e in U||o.warnings.push(`迁移后缺少必填字段：${String(e)}`);return U.角色?.身份||o.warnings.push("迁移后仍缺少 角色.身份（将导致部分界面无法展示）"),{migrated:U,report:o}}},4559:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.game-variable-panel[data-v-d867d926] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  overflow: hidden;\n}\n",""]);const s=i},4574:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.game-map-panel[data-v-736748a1] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  min-height: 0;\n  position: relative;\n  overflow: hidden;\n  background: var(--color-background);\n}\n\n/* 世界信息头部 */\n.world-info-header[data-v-736748a1] {\n  padding: 12px 16px;\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  flex-wrap: wrap;\n}\n.world-name[data-v-736748a1] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-primary);\n  white-space: nowrap;\n}\n.world-background[data-v-736748a1] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  max-width: 400px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* 地图容器 */\n.map-container[data-v-736748a1] {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n}\ncanvas[data-v-736748a1] {\n  display: block;\n  width: 100%;\n  height: 100%;\n  cursor: grab;\n}\ncanvas[data-v-736748a1]:active {\n  cursor: grabbing;\n}\n\n/* 地点信息弹窗 */\n.location-popup[data-v-736748a1] {\n  position: absolute;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  padding: 16px;\n  max-width: 400px;\n  max-height: 50vh;\n  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.35);\n  min-width: 280px;\n  pointer-events: auto;\n  z-index: 2000;\n}\n.popup-header[data-v-736748a1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16px;\n}\n.popup-header h4[data-v-736748a1] {\n  margin: 0;\n  color: var(--color-text);\n  font-size: 1.25rem;\n  font-weight: 700;\n}\n.close-btn[data-v-736748a1] {\n  width: 28px;\n  height: 28px;\n  border: none;\n  background: rgba(239, 68, 68, 0.1);\n  cursor: pointer;\n  color: #ef4444;\n  font-size: 1.4rem;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: bold;\n}\n.close-btn[data-v-736748a1]:hover {\n  background: rgba(220, 38, 38, 0.2);\n  color: #dc2626;\n  transform: scale(1.1);\n}\n.popup-content[data-v-736748a1] {\n  font-size: 0.95rem;\n  line-height: 1.6;\n  max-height: 60vh;\n  overflow-y: auto;\n}\n.location-type[data-v-736748a1] {\n  color: var(--color-primary);\n  font-weight: 700;\n  margin: 0 0 10px 0;\n  font-size: 1rem;\n}\n.location-desc[data-v-736748a1] {\n  color: var(--color-text);\n  margin: 0 0 14px 0;\n  font-weight: 500;\n  line-height: 1.6;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.location-detail[data-v-736748a1] {\n  color: var(--color-text-secondary);\n  margin: 8px 0;\n  font-size: 0.875rem;\n  font-weight: 500;\n}\n.relation-friendly[data-v-736748a1] {\n  color: #10b981;\n  font-weight: 700;\n}\n.relation-hostile[data-v-736748a1] {\n  color: #ef4444;\n  font-weight: 700;\n}\n.relation-neutral[data-v-736748a1] {\n  color: #6b7280;\n  font-weight: 600;\n}\n\n/* 初始化地图覆盖层 */\n.initialize-map-overlay[data-v-736748a1] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(6px);\n  z-index: 2000;\n}\n.initialize-prompt[data-v-736748a1] {\n  text-align: center;\n  padding: 3rem 2rem;\n  max-width: 500px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.35);\n  animation: fadeIn-736748a1 0.3s ease-in-out;\n}\n@keyframes fadeIn-736748a1 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.prompt-icon[data-v-736748a1] {\n  margin: 0 auto 1.5rem;\n  width: 80px;\n  height: 80px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #3b82f6, #60a5fa);\n  border-radius: 50%;\n  box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);\n}\n.map-icon[data-v-736748a1] {\n  width: 48px;\n  height: 48px;\n  color: white;\n}\n.initialize-prompt h3[data-v-736748a1] {\n  margin: 0 0 1rem 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.initialize-prompt p[data-v-736748a1] {\n  margin: 0 0 1.5rem 0;\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  line-height: 1.6;\n}\n\n/* 密度选择器 */\n.density-selector[data-v-736748a1] {\n  margin-bottom: 1.5rem;\n  text-align: left;\n}\n.density-label[data-v-736748a1] {\n  display: block;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #475569;\n  margin-bottom: 0.75rem;\n}\n.density-options[data-v-736748a1] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.density-option[data-v-736748a1] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.density-option[data-v-736748a1]:hover {\n  border-color: var(--color-border-hover);\n  background: var(--color-surface-hover);\n}\n.density-option.active[data-v-736748a1] {\n  border-color: var(--color-primary);\n  background: var(--color-surface);\n}\n.density-option input[type="radio"][data-v-736748a1] {\n  display: none;\n}\n.option-label[data-v-736748a1] {\n  font-weight: 600;\n  color: var(--color-text);\n  min-width: 3rem;\n}\n.option-desc[data-v-736748a1] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.initialize-btn[data-v-736748a1] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 2rem;\n  background: linear-gradient(135deg, #3b82f6, #60a5fa);\n  color: white;\n  border: none;\n  border-radius: 12px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);\n}\n.initialize-btn[data-v-736748a1]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);\n  background: linear-gradient(135deg, #2563eb, #3b82f6);\n}\n.initialize-btn[data-v-736748a1]:active {\n  transform: translateY(0);\n}\n.btn-icon[data-v-736748a1] {\n  width: 24px;\n  height: 24px;\n}\n.loading-spinner[data-v-736748a1] {\n  width: 60px;\n  height: 60px;\n  margin: 0 auto 1.5rem;\n  border: 4px solid rgba(59, 130, 246, 0.2);\n  border-top-color: #3b82f6;\n  border-radius: 50%;\n  animation: spin-736748a1 1s linear infinite;\n}\n@keyframes spin-736748a1 {\nto { transform: rotate(360deg);\n}\n}\n.status-text[data-v-736748a1] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  margin-top: 1rem;\n  min-height: 1.5rem;\n}\n\n/* 地图图例 */\n.map-legend[data-v-736748a1] {\n  position: absolute;\n  bottom: 24px;\n  right: 24px;\n  background: var(--color-surface);\n  border-radius: 16px;\n  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.35);\n  z-index: 1000;\n  min-width: 200px;\n  max-width: 280px;\n  border: 1px solid var(--color-border);\n  pointer-events: auto;\n  transition: all 0.3s ease;\n}\n.map-legend.collapsed[data-v-736748a1] {\n  min-width: auto;\n}\n.legend-header[data-v-736748a1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  cursor: pointer;\n  user-select: none;\n  border-radius: 14px 14px 0 0;\n  transition: background 0.2s ease;\n}\n.legend-header[data-v-736748a1]:hover {\n  background: var(--color-surface-hover);\n}\n.legend-title[data-v-736748a1] {\n  font-weight: 700;\n  color: var(--color-text);\n  font-size: 1rem;\n  flex: 1;\n}\n.legend-toggle[data-v-736748a1] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.legend-toggle[data-v-736748a1]:hover {\n  background: var(--color-surface-light);\n}\n.legend-items[data-v-736748a1] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n  padding: 0 20px 20px;\n}\n.legend-items[data-v-736748a1]::-webkit-scrollbar {\n  width: 6px;\n}\n.legend-items[data-v-736748a1]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 3px;\n}\n.legend-items[data-v-736748a1]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 3px;\n}\n.legend-items[data-v-736748a1]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n.legend-item[data-v-736748a1] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 0.9rem;\n  color: var(--color-text);\n  padding: 8px 10px;\n  font-weight: 600;\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.legend-item[data-v-736748a1]:hover {\n  background: var(--color-surface-hover);\n}\n.legend-icon[data-v-736748a1] {\n  flex-shrink: 0;\n}\n\n/* 图标颜色 */\n.legend-icon.mountain[data-v-736748a1] {\n  color: #2D7D32;\n}\n.legend-icon.faction[data-v-736748a1] {\n  color: #1565C0;\n}\n.legend-icon.town[data-v-736748a1] {\n  color: #F57C00;\n}\n.legend-icon.blessed[data-v-736748a1] {\n  color: #7B1FA2;\n}\n.legend-icon.treasure[data-v-736748a1] {\n  color: #388E3C;\n}\n.legend-icon.danger[data-v-736748a1] {\n  color: #D32F2F;\n}\n.legend-icon.special[data-v-736748a1] {\n  color: #6B7280;\n}\n.legend-icon.player[data-v-736748a1] {\n  color: #3b82f6;\n  animation: pulse-player-736748a1 2s ease-in-out infinite;\n}\n.legend-icon.npc[data-v-736748a1] {\n  color: #8b5cf6;\n}\n@keyframes pulse-player-736748a1 {\n0%, 100% {\n    opacity: 1;\n}\n50% {\n    opacity: 0.6;\n}\n}\n\n/* 全屏模式优化 */\n.game-map-panel[data-v-736748a1]:fullscreen {\n  background: #1a1a2e;\n}\n.game-map-panel:fullscreen .map-container[data-v-736748a1] {\n  border: none;\n  border-radius: 0;\n}\n.game-map-panel:fullscreen .map-legend[data-v-736748a1] {\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n}\n.game-map-panel:fullscreen .location-popup[data-v-736748a1] {\n  background: rgba(0, 0, 0, 0.9);\n  color: white;\n}\n\n/* 地图操作按钮 - 一体化样式，左下角 */\n.map-actions[data-v-736748a1] {\n  position: absolute;\n  bottom: 12px;\n  left: 12px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  z-index: 100;\n  min-width: 100px;\n  transition: all 0.2s ease;\n  box-shadow: 0 14px 40px rgba(0, 0, 0, 0.35);\n}\n.map-actions.expanded[data-v-736748a1] {\n  min-width: 130px;\n}\n.actions-header[data-v-736748a1] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 13px;\n  font-weight: 600;\n  color: var(--color-text);\n  padding: 10px 14px;\n  cursor: pointer;\n  border-radius: 10px;\n  transition: all 0.2s ease;\n  user-select: none;\n}\n.actions-header[data-v-736748a1]:hover {\n  background: var(--color-surface-hover);\n}\n.actions-header .toggle-icon[data-v-736748a1] {\n  margin-left: auto;\n  color: var(--color-text-secondary);\n}\n.actions-content[data-v-736748a1] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  padding: 0 10px 10px;\n}\n.action-btn[data-v-736748a1] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);\n  border: none;\n  border-radius: 8px;\n  color: white;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.action-btn[data-v-736748a1]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);\n}\n.action-btn[data-v-736748a1]:active:not(:disabled) {\n  transform: translateY(0);\n}\n.action-btn[data-v-736748a1]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.action-btn.text-mode-btn[data-v-736748a1] {\n  background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);\n}\n.action-btn.text-mode-btn[data-v-736748a1]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\n/* 追加生成弹窗 */\n.generate-modal-overlay[data-v-736748a1] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.generate-modal[data-v-736748a1] {\n  background: #1e293b;\n  border: 1px solid rgba(59, 130, 246, 0.3);\n  border-radius: 12px;\n  width: 320px;\n  max-width: 90vw;\n}\n.modal-header[data-v-736748a1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  border-bottom: 1px solid rgba(59, 130, 246, 0.2);\n}\n.modal-header h3[data-v-736748a1] {\n  margin: 0;\n  font-size: 16px;\n  color: #e2e8f0;\n}\n.modal-body[data-v-736748a1] {\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.generate-option[data-v-736748a1] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.generate-option label[data-v-736748a1] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  color: #e2e8f0;\n  font-size: 14px;\n  flex: 1;\n}\n.count-input[data-v-736748a1] {\n  width: 50px;\n  padding: 4px 8px;\n  background: rgba(15, 23, 42, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.3);\n  border-radius: 4px;\n  color: #e2e8f0;\n  font-size: 14px;\n  text-align: center;\n}\n.count-input[data-v-736748a1]:disabled {\n  opacity: 0.5;\n}\n.count-label[data-v-736748a1] {\n  color: #94a3b8;\n  font-size: 12px;\n}\n.modal-footer[data-v-736748a1] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  padding: 16px;\n  border-top: 1px solid rgba(59, 130, 246, 0.2);\n}\n.cancel-btn[data-v-736748a1], .confirm-btn[data-v-736748a1] {\n  padding: 8px 16px;\n  border-radius: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.cancel-btn[data-v-736748a1] {\n  background: transparent;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  color: #94a3b8;\n}\n.cancel-btn[data-v-736748a1]:hover {\n  background: rgba(148, 163, 184, 0.1);\n}\n.confirm-btn[data-v-736748a1] {\n  background: rgba(59, 130, 246, 0.8);\n  border: none;\n  color: white;\n}\n.confirm-btn[data-v-736748a1]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 1);\n}\n.confirm-btn[data-v-736748a1]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.game-map-panel[data-v-736748a1] {\n    /* Reserve space so bottom legend and actions can sit side-by-side */\n    --map-mobile-actions-reserve: 152px;\n}\n.world-info-header[data-v-736748a1] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 8px;\n}\n.world-background[data-v-736748a1] {\n    max-width: 100%;\n}\n.map-legend[data-v-736748a1] {\n    left: auto;\n    right: 12px;\n    bottom: calc(12px + env(safe-area-inset-bottom));\n    transform: none;\n    width: min(320px, calc(100% - 24px - var(--map-mobile-actions-reserve)));\n    min-width: 0;\n    max-width: none;\n}\n.map-actions[data-v-736748a1] {\n    bottom: calc(12px + env(safe-area-inset-bottom));\n    left: 12px;\n    right: auto;\n    top: auto;\n    max-width: var(--map-mobile-actions-reserve);\n}\n.location-popup[data-v-736748a1] {\n    min-width: auto;\n    max-width: calc(100vw - 40px);\n}\n}\n',""]);const s=i},4692:function(e,n){var t;!function(n,t){"use strict";"object"==typeof e.exports?e.exports=n.document?t(n,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(n)}("undefined"!=typeof window?window:this,function(a,r){"use strict";var o=[],i=Object.getPrototypeOf,s=o.slice,l=o.flat?function(e){return o.flat.call(e)}:function(e){return o.concat.apply([],e)},c=o.push,d=o.indexOf,u={},p=u.toString,v=u.hasOwnProperty,f=v.toString,h=f.call(Object),m={},g=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},b=function(e){return null!=e&&e===e.window},y=a.document,x={type:!0,src:!0,nonce:!0,noModule:!0};function k(e,n,t){var a,r,o=(t=t||y).createElement("script");if(o.text=e,n)for(a in x)(r=n[a]||n.getAttribute&&n.getAttribute(a))&&o.setAttribute(a,r);t.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[p.call(e)]||"object":typeof e}var _="3.7.1",C=/HTML$/i,A=function(e,n){return new A.fn.init(e,n)};function S(e){var n=!!e&&"length"in e&&e.length,t=w(e);return!g(e)&&!b(e)&&("array"===t||0===n||"number"==typeof n&&n>0&&n-1 in e)}function L(e,n){return e.nodeName&&e.nodeName.toLowerCase()===n.toLowerCase()}A.fn=A.prototype={jquery:_,constructor:A,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var n=A.merge(this.constructor(),e);return n.prevObject=this,n},each:function(e){return A.each(this,e)},map:function(e){return this.pushStack(A.map(this,function(n,t){return e.call(n,t,n)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(A.grep(this,function(e,n){return(n+1)%2}))},odd:function(){return this.pushStack(A.grep(this,function(e,n){return n%2}))},eq:function(e){var n=this.length,t=+e+(e<0?n:0);return this.pushStack(t>=0&&t<n?[this[t]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:o.sort,splice:o.splice},A.extend=A.fn.extend=function(){var e,n,t,a,r,o,i=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[s]||{},s++),"object"==typeof i||g(i)||(i={}),s===l&&(i=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(n in e)a=e[n],"__proto__"!==n&&i!==a&&(c&&a&&(A.isPlainObject(a)||(r=Array.isArray(a)))?(t=i[n],o=r&&!Array.isArray(t)?[]:r||A.isPlainObject(t)?t:{},r=!1,i[n]=A.extend(c,o,a)):void 0!==a&&(i[n]=a));return i},A.extend({expando:"jQuery"+(_+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var n,t;return!(!e||"[object Object]"!==p.call(e)||(n=i(e))&&("function"!=typeof(t=v.call(n,"constructor")&&n.constructor)||f.call(t)!==h))},isEmptyObject:function(e){var n;for(n in e)return!1;return!0},globalEval:function(e,n,t){k(e,{nonce:n&&n.nonce},t)},each:function(e,n){var t,a=0;if(S(e))for(t=e.length;a<t&&!1!==n.call(e[a],a,e[a]);a++);else for(a in e)if(!1===n.call(e[a],a,e[a]))break;return e},text:function(e){var n,t="",a=0,r=e.nodeType;if(!r)for(;n=e[a++];)t+=A.text(n);return 1===r||11===r?e.textContent:9===r?e.documentElement.textContent:3===r||4===r?e.nodeValue:t},makeArray:function(e,n){var t=n||[];return null!=e&&(S(Object(e))?A.merge(t,"string"==typeof e?[e]:e):c.call(t,e)),t},inArray:function(e,n,t){return null==n?-1:d.call(n,e,t)},isXMLDoc:function(e){var n=e&&e.namespaceURI,t=e&&(e.ownerDocument||e).documentElement;return!C.test(n||t&&t.nodeName||"HTML")},merge:function(e,n){for(var t=+n.length,a=0,r=e.length;a<t;a++)e[r++]=n[a];return e.length=r,e},grep:function(e,n,t){for(var a=[],r=0,o=e.length,i=!t;r<o;r++)!n(e[r],r)!==i&&a.push(e[r]);return a},map:function(e,n,t){var a,r,o=0,i=[];if(S(e))for(a=e.length;o<a;o++)null!=(r=n(e[o],o,t))&&i.push(r);else for(o in e)null!=(r=n(e[o],o,t))&&i.push(r);return l(i)},guid:1,support:m}),"function"==typeof Symbol&&(A.fn[Symbol.iterator]=o[Symbol.iterator]),A.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,n){u["[object "+n+"]"]=n.toLowerCase()});var E=o.pop,T=o.sort,I=o.splice,R="[\\x20\\t\\r\\n\\f]",M=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g");A.contains=function(e,n){var t=n&&n.parentNode;return e===t||!(!t||1!==t.nodeType||!(e.contains?e.contains(t):e.compareDocumentPosition&&16&e.compareDocumentPosition(t)))};var P=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function D(e,n){return n?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}A.escapeSelector=function(e){return(e+"").replace(P,D)};var z=y,N=c;!function(){var e,n,t,r,i,l,c,u,p,f,h=N,g=A.expando,b=0,y=0,x=ee(),k=ee(),w=ee(),_=ee(),C=function(e,n){return e===n&&(i=!0),0},S="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="(?:\\\\[\\da-fA-F]{1,6}"+R+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",D="\\["+R+"*("+P+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+P+"))|)"+R+"*\\]",$=":("+P+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+D+")*)|.*)\\)|)",O=new RegExp(R+"+","g"),F=new RegExp("^"+R+"*,"+R+"*"),j=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),B=new RegExp(R+"|>"),X=new RegExp($),U=new RegExp("^"+P+"$"),W={ID:new RegExp("^#("+P+")"),CLASS:new RegExp("^\\.("+P+")"),TAG:new RegExp("^("+P+"|[*])"),ATTR:new RegExp("^"+D),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+S+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,H=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,V=/[+~]/,Q=new RegExp("\\\\[\\da-fA-F]{1,6}"+R+"?|\\\\([^\\r\\n\\f])","g"),K=function(e,n){var t="0x"+e.slice(1)-65536;return n||(t<0?String.fromCharCode(t+65536):String.fromCharCode(t>>10|55296,1023&t|56320))},Y=function(){le()},J=pe(function(e){return!0===e.disabled&&L(e,"fieldset")},{dir:"parentNode",next:"legend"});try{h.apply(o=s.call(z.childNodes),z.childNodes),o[z.childNodes.length].nodeType}catch(e){h={apply:function(e,n){N.apply(e,s.call(n))},call:function(e){N.apply(e,s.call(arguments,1))}}}function Z(e,n,t,a){var r,o,i,s,c,d,v,f=n&&n.ownerDocument,b=n?n.nodeType:9;if(t=t||[],"string"!=typeof e||!e||1!==b&&9!==b&&11!==b)return t;if(!a&&(le(n),n=n||l,u)){if(11!==b&&(c=H.exec(e)))if(r=c[1]){if(9===b){if(!(i=n.getElementById(r)))return t;if(i.id===r)return h.call(t,i),t}else if(f&&(i=f.getElementById(r))&&Z.contains(n,i)&&i.id===r)return h.call(t,i),t}else{if(c[2])return h.apply(t,n.getElementsByTagName(e)),t;if((r=c[3])&&n.getElementsByClassName)return h.apply(t,n.getElementsByClassName(r)),t}if(!(_[e+" "]||p&&p.test(e))){if(v=e,f=n,1===b&&(B.test(e)||j.test(e))){for((f=V.test(e)&&se(n.parentNode)||n)==n&&m.scope||((s=n.getAttribute("id"))?s=A.escapeSelector(s):n.setAttribute("id",s=g)),o=(d=de(e)).length;o--;)d[o]=(s?"#"+s:":scope")+" "+ue(d[o]);v=d.join(",")}try{return h.apply(t,f.querySelectorAll(v)),t}catch(n){_(e,!0)}finally{s===g&&n.removeAttribute("id")}}}return be(e.replace(M,"$1"),n,t,a)}function ee(){var e=[];return function t(a,r){return e.push(a+" ")>n.cacheLength&&delete t[e.shift()],t[a+" "]=r}}function ne(e){return e[g]=!0,e}function te(e){var n=l.createElement("fieldset");try{return!!e(n)}catch(e){return!1}finally{n.parentNode&&n.parentNode.removeChild(n),n=null}}function ae(e){return function(n){return L(n,"input")&&n.type===e}}function re(e){return function(n){return(L(n,"input")||L(n,"button"))&&n.type===e}}function oe(e){return function(n){return"form"in n?n.parentNode&&!1===n.disabled?"label"in n?"label"in n.parentNode?n.parentNode.disabled===e:n.disabled===e:n.isDisabled===e||n.isDisabled!==!e&&J(n)===e:n.disabled===e:"label"in n&&n.disabled===e}}function ie(e){return ne(function(n){return n=+n,ne(function(t,a){for(var r,o=e([],t.length,n),i=o.length;i--;)t[r=o[i]]&&(t[r]=!(a[r]=t[r]))})})}function se(e){return e&&void 0!==e.getElementsByTagName&&e}function le(e){var t,a=e?e.ownerDocument||e:z;return a!=l&&9===a.nodeType&&a.documentElement?(c=(l=a).documentElement,u=!A.isXMLDoc(l),f=c.matches||c.webkitMatchesSelector||c.msMatchesSelector,c.msMatchesSelector&&z!=l&&(t=l.defaultView)&&t.top!==t&&t.addEventListener("unload",Y),m.getById=te(function(e){return c.appendChild(e).id=A.expando,!l.getElementsByName||!l.getElementsByName(A.expando).length}),m.disconnectedMatch=te(function(e){return f.call(e,"*")}),m.scope=te(function(){return l.querySelectorAll(":scope")}),m.cssHas=te(function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),m.getById?(n.filter.ID=function(e){var n=e.replace(Q,K);return function(e){return e.getAttribute("id")===n}},n.find.ID=function(e,n){if(void 0!==n.getElementById&&u){var t=n.getElementById(e);return t?[t]:[]}}):(n.filter.ID=function(e){var n=e.replace(Q,K);return function(e){var t=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},n.find.ID=function(e,n){if(void 0!==n.getElementById&&u){var t,a,r,o=n.getElementById(e);if(o){if((t=o.getAttributeNode("id"))&&t.value===e)return[o];for(r=n.getElementsByName(e),a=0;o=r[a++];)if((t=o.getAttributeNode("id"))&&t.value===e)return[o]}return[]}}),n.find.TAG=function(e,n){return void 0!==n.getElementsByTagName?n.getElementsByTagName(e):n.querySelectorAll(e)},n.find.CLASS=function(e,n){if(void 0!==n.getElementsByClassName&&u)return n.getElementsByClassName(e)},p=[],te(function(e){var n;c.appendChild(e).innerHTML="<a id='"+g+"' href='' disabled='disabled'></a><select id='"+g+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||p.push("\\["+R+"*(?:value|"+S+")"),e.querySelectorAll("[id~="+g+"-]").length||p.push("~="),e.querySelectorAll("a#"+g+"+*").length||p.push(".#.+[+~]"),e.querySelectorAll(":checked").length||p.push(":checked"),(n=l.createElement("input")).setAttribute("type","hidden"),e.appendChild(n).setAttribute("name","D"),c.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&p.push(":enabled",":disabled"),(n=l.createElement("input")).setAttribute("name",""),e.appendChild(n),e.querySelectorAll("[name='']").length||p.push("\\["+R+"*name"+R+"*="+R+"*(?:''|\"\")")}),m.cssHas||p.push(":has"),p=p.length&&new RegExp(p.join("|")),C=function(e,n){if(e===n)return i=!0,0;var t=!e.compareDocumentPosition-!n.compareDocumentPosition;return t||(1&(t=(e.ownerDocument||e)==(n.ownerDocument||n)?e.compareDocumentPosition(n):1)||!m.sortDetached&&n.compareDocumentPosition(e)===t?e===l||e.ownerDocument==z&&Z.contains(z,e)?-1:n===l||n.ownerDocument==z&&Z.contains(z,n)?1:r?d.call(r,e)-d.call(r,n):0:4&t?-1:1)},l):l}for(e in Z.matches=function(e,n){return Z(e,null,null,n)},Z.matchesSelector=function(e,n){if(le(e),u&&!_[n+" "]&&(!p||!p.test(n)))try{var t=f.call(e,n);if(t||m.disconnectedMatch||e.document&&11!==e.document.nodeType)return t}catch(e){_(n,!0)}return Z(n,l,null,[e]).length>0},Z.contains=function(e,n){return(e.ownerDocument||e)!=l&&le(e),A.contains(e,n)},Z.attr=function(e,t){(e.ownerDocument||e)!=l&&le(e);var a=n.attrHandle[t.toLowerCase()],r=a&&v.call(n.attrHandle,t.toLowerCase())?a(e,t,!u):void 0;return void 0!==r?r:e.getAttribute(t)},Z.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},A.uniqueSort=function(e){var n,t=[],a=0,o=0;if(i=!m.sortStable,r=!m.sortStable&&s.call(e,0),T.call(e,C),i){for(;n=e[o++];)n===e[o]&&(a=t.push(o));for(;a--;)I.call(e,t[a],1)}return r=null,e},A.fn.uniqueSort=function(){return this.pushStack(A.uniqueSort(s.apply(this)))},n=A.expr={cacheLength:50,createPseudo:ne,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Q,K),e[3]=(e[3]||e[4]||e[5]||"").replace(Q,K),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||Z.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&Z.error(e[0]),e},PSEUDO:function(e){var n,t=!e[6]&&e[2];return W.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":t&&X.test(t)&&(n=de(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(e[0]=e[0].slice(0,n),e[2]=t.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var n=e.replace(Q,K).toLowerCase();return"*"===e?function(){return!0}:function(e){return L(e,n)}},CLASS:function(e){var n=x[e+" "];return n||(n=new RegExp("(^|"+R+")"+e+"("+R+"|$)"))&&x(e,function(e){return n.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,t){return function(a){var r=Z.attr(a,e);return null==r?"!="===n:!n||(r+="","="===n?r===t:"!="===n?r!==t:"^="===n?t&&0===r.indexOf(t):"*="===n?t&&r.indexOf(t)>-1:"$="===n?t&&r.slice(-t.length)===t:"~="===n?(" "+r.replace(O," ")+" ").indexOf(t)>-1:"|="===n&&(r===t||r.slice(0,t.length+1)===t+"-"))}},CHILD:function(e,n,t,a,r){var o="nth"!==e.slice(0,3),i="last"!==e.slice(-4),s="of-type"===n;return 1===a&&0===r?function(e){return!!e.parentNode}:function(n,t,l){var c,d,u,p,v,f=o!==i?"nextSibling":"previousSibling",h=n.parentNode,m=s&&n.nodeName.toLowerCase(),y=!l&&!s,x=!1;if(h){if(o){for(;f;){for(u=n;u=u[f];)if(s?L(u,m):1===u.nodeType)return!1;v=f="only"===e&&!v&&"nextSibling"}return!0}if(v=[i?h.firstChild:h.lastChild],i&&y){for(x=(p=(c=(d=h[g]||(h[g]={}))[e]||[])[0]===b&&c[1])&&c[2],u=p&&h.childNodes[p];u=++p&&u&&u[f]||(x=p=0)||v.pop();)if(1===u.nodeType&&++x&&u===n){d[e]=[b,p,x];break}}else if(y&&(x=p=(c=(d=n[g]||(n[g]={}))[e]||[])[0]===b&&c[1]),!1===x)for(;(u=++p&&u&&u[f]||(x=p=0)||v.pop())&&(!(s?L(u,m):1===u.nodeType)||!++x||(y&&((d=u[g]||(u[g]={}))[e]=[b,x]),u!==n)););return(x-=r)===a||x%a===0&&x/a>=0}}},PSEUDO:function(e,t){var a,r=n.pseudos[e]||n.setFilters[e.toLowerCase()]||Z.error("unsupported pseudo: "+e);return r[g]?r(t):r.length>1?(a=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?ne(function(e,n){for(var a,o=r(e,t),i=o.length;i--;)e[a=d.call(e,o[i])]=!(n[a]=o[i])}):function(e){return r(e,0,a)}):r}},pseudos:{not:ne(function(e){var n=[],t=[],a=ge(e.replace(M,"$1"));return a[g]?ne(function(e,n,t,r){for(var o,i=a(e,null,r,[]),s=e.length;s--;)(o=i[s])&&(e[s]=!(n[s]=o))}):function(e,r,o){return n[0]=e,a(n,null,o,t),n[0]=null,!t.pop()}}),has:ne(function(e){return function(n){return Z(e,n).length>0}}),contains:ne(function(e){return e=e.replace(Q,K),function(n){return(n.textContent||A.text(n)).indexOf(e)>-1}}),lang:ne(function(e){return U.test(e||"")||Z.error("unsupported lang: "+e),e=e.replace(Q,K).toLowerCase(),function(n){var t;do{if(t=u?n.lang:n.getAttribute("xml:lang")||n.getAttribute("lang"))return(t=t.toLowerCase())===e||0===t.indexOf(e+"-")}while((n=n.parentNode)&&1===n.nodeType);return!1}}),target:function(e){var n=a.location&&a.location.hash;return n&&n.slice(1)===e.id},root:function(e){return e===c},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:oe(!1),disabled:oe(!0),checked:function(e){return L(e,"input")&&!!e.checked||L(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return q.test(e.nodeName)},button:function(e){return L(e,"input")&&"button"===e.type||L(e,"button")},text:function(e){var n;return L(e,"input")&&"text"===e.type&&(null==(n=e.getAttribute("type"))||"text"===n.toLowerCase())},first:ie(function(){return[0]}),last:ie(function(e,n){return[n-1]}),eq:ie(function(e,n,t){return[t<0?t+n:t]}),even:ie(function(e,n){for(var t=0;t<n;t+=2)e.push(t);return e}),odd:ie(function(e,n){for(var t=1;t<n;t+=2)e.push(t);return e}),lt:ie(function(e,n,t){var a;for(a=t<0?t+n:t>n?n:t;--a>=0;)e.push(a);return e}),gt:ie(function(e,n,t){for(var a=t<0?t+n:t;++a<n;)e.push(a);return e})}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[e]=ae(e);for(e in{submit:!0,reset:!0})n.pseudos[e]=re(e);function ce(){}function de(e,t){var a,r,o,i,s,l,c,d=k[e+" "];if(d)return t?0:d.slice(0);for(s=e,l=[],c=n.preFilter;s;){for(i in a&&!(r=F.exec(s))||(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),a=!1,(r=j.exec(s))&&(a=r.shift(),o.push({value:a,type:r[0].replace(M," ")}),s=s.slice(a.length)),n.filter)!(r=W[i].exec(s))||c[i]&&!(r=c[i](r))||(a=r.shift(),o.push({value:a,type:i,matches:r}),s=s.slice(a.length));if(!a)break}return t?s.length:s?Z.error(e):k(e,l).slice(0)}function ue(e){for(var n=0,t=e.length,a="";n<t;n++)a+=e[n].value;return a}function pe(e,n,t){var a=n.dir,r=n.next,o=r||a,i=t&&"parentNode"===o,s=y++;return n.first?function(n,t,r){for(;n=n[a];)if(1===n.nodeType||i)return e(n,t,r);return!1}:function(n,t,l){var c,d,u=[b,s];if(l){for(;n=n[a];)if((1===n.nodeType||i)&&e(n,t,l))return!0}else for(;n=n[a];)if(1===n.nodeType||i)if(d=n[g]||(n[g]={}),r&&L(n,r))n=n[a]||n;else{if((c=d[o])&&c[0]===b&&c[1]===s)return u[2]=c[2];if(d[o]=u,u[2]=e(n,t,l))return!0}return!1}}function ve(e){return e.length>1?function(n,t,a){for(var r=e.length;r--;)if(!e[r](n,t,a))return!1;return!0}:e[0]}function fe(e,n,t,a,r){for(var o,i=[],s=0,l=e.length,c=null!=n;s<l;s++)(o=e[s])&&(t&&!t(o,a,r)||(i.push(o),c&&n.push(s)));return i}function he(e,n,t,a,r,o){return a&&!a[g]&&(a=he(a)),r&&!r[g]&&(r=he(r,o)),ne(function(o,i,s,l){var c,u,p,v,f=[],m=[],g=i.length,b=o||function(e,n,t){for(var a=0,r=n.length;a<r;a++)Z(e,n[a],t);return t}(n||"*",s.nodeType?[s]:s,[]),y=!e||!o&&n?b:fe(b,f,e,s,l);if(t?t(y,v=r||(o?e:g||a)?[]:i,s,l):v=y,a)for(c=fe(v,m),a(c,[],s,l),u=c.length;u--;)(p=c[u])&&(v[m[u]]=!(y[m[u]]=p));if(o){if(r||e){if(r){for(c=[],u=v.length;u--;)(p=v[u])&&c.push(y[u]=p);r(null,v=[],c,l)}for(u=v.length;u--;)(p=v[u])&&(c=r?d.call(o,p):f[u])>-1&&(o[c]=!(i[c]=p))}}else v=fe(v===i?v.splice(g,v.length):v),r?r(null,i,v,l):h.apply(i,v)})}function me(e){for(var a,r,o,i=e.length,s=n.relative[e[0].type],l=s||n.relative[" "],c=s?1:0,u=pe(function(e){return e===a},l,!0),p=pe(function(e){return d.call(a,e)>-1},l,!0),v=[function(e,n,r){var o=!s&&(r||n!=t)||((a=n).nodeType?u(e,n,r):p(e,n,r));return a=null,o}];c<i;c++)if(r=n.relative[e[c].type])v=[pe(ve(v),r)];else{if((r=n.filter[e[c].type].apply(null,e[c].matches))[g]){for(o=++c;o<i&&!n.relative[e[o].type];o++);return he(c>1&&ve(v),c>1&&ue(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(M,"$1"),r,c<o&&me(e.slice(c,o)),o<i&&me(e=e.slice(o)),o<i&&ue(e))}v.push(r)}return ve(v)}function ge(e,a){var r,o=[],i=[],s=w[e+" "];if(!s){for(a||(a=de(e)),r=a.length;r--;)(s=me(a[r]))[g]?o.push(s):i.push(s);s=w(e,function(e,a){var r=a.length>0,o=e.length>0,i=function(i,s,c,d,p){var v,f,m,g=0,y="0",x=i&&[],k=[],w=t,_=i||o&&n.find.TAG("*",p),C=b+=null==w?1:Math.random()||.1,S=_.length;for(p&&(t=s==l||s||p);y!==S&&null!=(v=_[y]);y++){if(o&&v){for(f=0,s||v.ownerDocument==l||(le(v),c=!u);m=e[f++];)if(m(v,s||l,c)){h.call(d,v);break}p&&(b=C)}r&&((v=!m&&v)&&g--,i&&x.push(v))}if(g+=y,r&&y!==g){for(f=0;m=a[f++];)m(x,k,s,c);if(i){if(g>0)for(;y--;)x[y]||k[y]||(k[y]=E.call(d));k=fe(k)}h.apply(d,k),p&&!i&&k.length>0&&g+a.length>1&&A.uniqueSort(d)}return p&&(b=C,t=w),x};return r?ne(i):i}(i,o)),s.selector=e}return s}function be(e,t,a,r){var o,i,s,l,c,d="function"==typeof e&&e,p=!r&&de(e=d.selector||e);if(a=a||[],1===p.length){if((i=p[0]=p[0].slice(0)).length>2&&"ID"===(s=i[0]).type&&9===t.nodeType&&u&&n.relative[i[1].type]){if(!(t=(n.find.ID(s.matches[0].replace(Q,K),t)||[])[0]))return a;d&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=W.needsContext.test(e)?0:i.length;o--&&(s=i[o],!n.relative[l=s.type]);)if((c=n.find[l])&&(r=c(s.matches[0].replace(Q,K),V.test(i[0].type)&&se(t.parentNode)||t))){if(i.splice(o,1),!(e=r.length&&ue(i)))return h.apply(a,r),a;break}}return(d||ge(e,p))(r,t,!u,a,!t||V.test(e)&&se(t.parentNode)||t),a}ce.prototype=n.filters=n.pseudos,n.setFilters=new ce,m.sortStable=g.split("").sort(C).join("")===g,le(),m.sortDetached=te(function(e){return 1&e.compareDocumentPosition(l.createElement("fieldset"))}),A.find=Z,A.expr[":"]=A.expr.pseudos,A.unique=A.uniqueSort,Z.compile=ge,Z.select=be,Z.setDocument=le,Z.tokenize=de,Z.escape=A.escapeSelector,Z.getText=A.text,Z.isXML=A.isXMLDoc,Z.selectors=A.expr,Z.support=A.support,Z.uniqueSort=A.uniqueSort}();var $=function(e,n,t){for(var a=[],r=void 0!==t;(e=e[n])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&A(e).is(t))break;a.push(e)}return a},O=function(e,n){for(var t=[];e;e=e.nextSibling)1===e.nodeType&&e!==n&&t.push(e);return t},F=A.expr.match.needsContext,j=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function B(e,n,t){return g(n)?A.grep(e,function(e,a){return!!n.call(e,a,e)!==t}):n.nodeType?A.grep(e,function(e){return e===n!==t}):"string"!=typeof n?A.grep(e,function(e){return d.call(n,e)>-1!==t}):A.filter(n,e,t)}A.filter=function(e,n,t){var a=n[0];return t&&(e=":not("+e+")"),1===n.length&&1===a.nodeType?A.find.matchesSelector(a,e)?[a]:[]:A.find.matches(e,A.grep(n,function(e){return 1===e.nodeType}))},A.fn.extend({find:function(e){var n,t,a=this.length,r=this;if("string"!=typeof e)return this.pushStack(A(e).filter(function(){for(n=0;n<a;n++)if(A.contains(r[n],this))return!0}));for(t=this.pushStack([]),n=0;n<a;n++)A.find(e,r[n],t);return a>1?A.uniqueSort(t):t},filter:function(e){return this.pushStack(B(this,e||[],!1))},not:function(e){return this.pushStack(B(this,e||[],!0))},is:function(e){return!!B(this,"string"==typeof e&&F.test(e)?A(e):e||[],!1).length}});var X,U=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(A.fn.init=function(e,n,t){var a,r;if(!e)return this;if(t=t||X,"string"==typeof e){if(!(a="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:U.exec(e))||!a[1]&&n)return!n||n.jquery?(n||t).find(e):this.constructor(n).find(e);if(a[1]){if(n=n instanceof A?n[0]:n,A.merge(this,A.parseHTML(a[1],n&&n.nodeType?n.ownerDocument||n:y,!0)),j.test(a[1])&&A.isPlainObject(n))for(a in n)g(this[a])?this[a](n[a]):this.attr(a,n[a]);return this}return(r=y.getElementById(a[2]))&&(this[0]=r,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==t.ready?t.ready(e):e(A):A.makeArray(e,this)}).prototype=A.fn,X=A(y);var W=/^(?:parents|prev(?:Until|All))/,q={children:!0,contents:!0,next:!0,prev:!0};function G(e,n){for(;(e=e[n])&&1!==e.nodeType;);return e}A.fn.extend({has:function(e){var n=A(e,this),t=n.length;return this.filter(function(){for(var e=0;e<t;e++)if(A.contains(this,n[e]))return!0})},closest:function(e,n){var t,a=0,r=this.length,o=[],i="string"!=typeof e&&A(e);if(!F.test(e))for(;a<r;a++)for(t=this[a];t&&t!==n;t=t.parentNode)if(t.nodeType<11&&(i?i.index(t)>-1:1===t.nodeType&&A.find.matchesSelector(t,e))){o.push(t);break}return this.pushStack(o.length>1?A.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?d.call(A(e),this[0]):d.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,n){return this.pushStack(A.uniqueSort(A.merge(this.get(),A(e,n))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),A.each({parent:function(e){var n=e.parentNode;return n&&11!==n.nodeType?n:null},parents:function(e){return $(e,"parentNode")},parentsUntil:function(e,n,t){return $(e,"parentNode",t)},next:function(e){return G(e,"nextSibling")},prev:function(e){return G(e,"previousSibling")},nextAll:function(e){return $(e,"nextSibling")},prevAll:function(e){return $(e,"previousSibling")},nextUntil:function(e,n,t){return $(e,"nextSibling",t)},prevUntil:function(e,n,t){return $(e,"previousSibling",t)},siblings:function(e){return O((e.parentNode||{}).firstChild,e)},children:function(e){return O(e.firstChild)},contents:function(e){return null!=e.contentDocument&&i(e.contentDocument)?e.contentDocument:(L(e,"template")&&(e=e.content||e),A.merge([],e.childNodes))}},function(e,n){A.fn[e]=function(t,a){var r=A.map(this,n,t);return"Until"!==e.slice(-5)&&(a=t),a&&"string"==typeof a&&(r=A.filter(a,r)),this.length>1&&(q[e]||A.uniqueSort(r),W.test(e)&&r.reverse()),this.pushStack(r)}});var H=/[^\x20\t\r\n\f]+/g;function V(e){return e}function Q(e){throw e}function K(e,n,t,a){var r;try{e&&g(r=e.promise)?r.call(e).done(n).fail(t):e&&g(r=e.then)?r.call(e,n,t):n.apply(void 0,[e].slice(a))}catch(e){t.apply(void 0,[e])}}A.Callbacks=function(e){e="string"==typeof e?function(e){var n={};return A.each(e.match(H)||[],function(e,t){n[t]=!0}),n}(e):A.extend({},e);var n,t,a,r,o=[],i=[],s=-1,l=function(){for(r=r||e.once,a=n=!0;i.length;s=-1)for(t=i.shift();++s<o.length;)!1===o[s].apply(t[0],t[1])&&e.stopOnFalse&&(s=o.length,t=!1);e.memory||(t=!1),n=!1,r&&(o=t?[]:"")},c={add:function(){return o&&(t&&!n&&(s=o.length-1,i.push(t)),function n(t){A.each(t,function(t,a){g(a)?e.unique&&c.has(a)||o.push(a):a&&a.length&&"string"!==w(a)&&n(a)})}(arguments),t&&!n&&l()),this},remove:function(){return A.each(arguments,function(e,n){for(var t;(t=A.inArray(n,o,t))>-1;)o.splice(t,1),t<=s&&s--}),this},has:function(e){return e?A.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return r=i=[],o=t="",this},disabled:function(){return!o},lock:function(){return r=i=[],t||n||(o=t=""),this},locked:function(){return!!r},fireWith:function(e,t){return r||(t=[e,(t=t||[]).slice?t.slice():t],i.push(t),n||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!a}};return c},A.extend({Deferred:function(e){var n=[["notify","progress",A.Callbacks("memory"),A.Callbacks("memory"),2],["resolve","done",A.Callbacks("once memory"),A.Callbacks("once memory"),0,"resolved"],["reject","fail",A.Callbacks("once memory"),A.Callbacks("once memory"),1,"rejected"]],t="pending",r={state:function(){return t},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return A.Deferred(function(t){A.each(n,function(n,a){var r=g(e[a[4]])&&e[a[4]];o[a[1]](function(){var e=r&&r.apply(this,arguments);e&&g(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[a[0]+"With"](this,r?[e]:arguments)})}),e=null}).promise()},then:function(e,t,r){var o=0;function i(e,n,t,r){return function(){var s=this,l=arguments,c=function(){var a,c;if(!(e<o)){if((a=t.apply(s,l))===n.promise())throw new TypeError("Thenable self-resolution");c=a&&("object"==typeof a||"function"==typeof a)&&a.then,g(c)?r?c.call(a,i(o,n,V,r),i(o,n,Q,r)):(o++,c.call(a,i(o,n,V,r),i(o,n,Q,r),i(o,n,V,n.notifyWith))):(t!==V&&(s=void 0,l=[a]),(r||n.resolveWith)(s,l))}},d=r?c:function(){try{c()}catch(a){A.Deferred.exceptionHook&&A.Deferred.exceptionHook(a,d.error),e+1>=o&&(t!==Q&&(s=void 0,l=[a]),n.rejectWith(s,l))}};e?d():(A.Deferred.getErrorHook?d.error=A.Deferred.getErrorHook():A.Deferred.getStackHook&&(d.error=A.Deferred.getStackHook()),a.setTimeout(d))}}return A.Deferred(function(a){n[0][3].add(i(0,a,g(r)?r:V,a.notifyWith)),n[1][3].add(i(0,a,g(e)?e:V)),n[2][3].add(i(0,a,g(t)?t:Q))}).promise()},promise:function(e){return null!=e?A.extend(e,r):r}},o={};return A.each(n,function(e,a){var i=a[2],s=a[5];r[a[1]]=i.add,s&&i.add(function(){t=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),i.add(a[3].fire),o[a[0]]=function(){return o[a[0]+"With"](this===o?void 0:this,arguments),this},o[a[0]+"With"]=i.fireWith}),r.promise(o),e&&e.call(o,o),o},when:function(e){var n=arguments.length,t=n,a=Array(t),r=s.call(arguments),o=A.Deferred(),i=function(e){return function(t){a[e]=this,r[e]=arguments.length>1?s.call(arguments):t,--n||o.resolveWith(a,r)}};if(n<=1&&(K(e,o.done(i(t)).resolve,o.reject,!n),"pending"===o.state()||g(r[t]&&r[t].then)))return o.then();for(;t--;)K(r[t],i(t),o.reject);return o.promise()}});var Y=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;A.Deferred.exceptionHook=function(e,n){a.console&&a.console.warn&&e&&Y.test(e.name)&&a.console.warn("jQuery.Deferred exception: "+e.message,e.stack,n)},A.readyException=function(e){a.setTimeout(function(){throw e})};var J=A.Deferred();function Z(){y.removeEventListener("DOMContentLoaded",Z),a.removeEventListener("load",Z),A.ready()}A.fn.ready=function(e){return J.then(e).catch(function(e){A.readyException(e)}),this},A.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--A.readyWait:A.isReady)||(A.isReady=!0,!0!==e&&--A.readyWait>0||J.resolveWith(y,[A]))}}),A.ready.then=J.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?a.setTimeout(A.ready):(y.addEventListener("DOMContentLoaded",Z),a.addEventListener("load",Z));var ee=function(e,n,t,a,r,o,i){var s=0,l=e.length,c=null==t;if("object"===w(t))for(s in r=!0,t)ee(e,n,s,t[s],!0,o,i);else if(void 0!==a&&(r=!0,g(a)||(i=!0),c&&(i?(n.call(e,a),n=null):(c=n,n=function(e,n,t){return c.call(A(e),t)})),n))for(;s<l;s++)n(e[s],t,i?a:a.call(e[s],s,n(e[s],t)));return r?e:c?n.call(e):l?n(e[0],t):o},ne=/^-ms-/,te=/-([a-z])/g;function ae(e,n){return n.toUpperCase()}function re(e){return e.replace(ne,"ms-").replace(te,ae)}var oe=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function ie(){this.expando=A.expando+ie.uid++}ie.uid=1,ie.prototype={cache:function(e){var n=e[this.expando];return n||(n={},oe(e)&&(e.nodeType?e[this.expando]=n:Object.defineProperty(e,this.expando,{value:n,configurable:!0}))),n},set:function(e,n,t){var a,r=this.cache(e);if("string"==typeof n)r[re(n)]=t;else for(a in n)r[re(a)]=n[a];return r},get:function(e,n){return void 0===n?this.cache(e):e[this.expando]&&e[this.expando][re(n)]},access:function(e,n,t){return void 0===n||n&&"string"==typeof n&&void 0===t?this.get(e,n):(this.set(e,n,t),void 0!==t?t:n)},remove:function(e,n){var t,a=e[this.expando];if(void 0!==a){if(void 0!==n){t=(n=Array.isArray(n)?n.map(re):(n=re(n))in a?[n]:n.match(H)||[]).length;for(;t--;)delete a[n[t]]}(void 0===n||A.isEmptyObject(a))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var n=e[this.expando];return void 0!==n&&!A.isEmptyObject(n)}};var se=new ie,le=new ie,ce=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,de=/[A-Z]/g;function ue(e,n,t){var a;if(void 0===t&&1===e.nodeType)if(a="data-"+n.replace(de,"-$&").toLowerCase(),"string"==typeof(t=e.getAttribute(a))){try{t=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ce.test(e)?JSON.parse(e):e)}(t)}catch(e){}le.set(e,n,t)}else t=void 0;return t}A.extend({hasData:function(e){return le.hasData(e)||se.hasData(e)},data:function(e,n,t){return le.access(e,n,t)},removeData:function(e,n){le.remove(e,n)},_data:function(e,n,t){return se.access(e,n,t)},_removeData:function(e,n){se.remove(e,n)}}),A.fn.extend({data:function(e,n){var t,a,r,o=this[0],i=o&&o.attributes;if(void 0===e){if(this.length&&(r=le.get(o),1===o.nodeType&&!se.get(o,"hasDataAttrs"))){for(t=i.length;t--;)i[t]&&0===(a=i[t].name).indexOf("data-")&&(a=re(a.slice(5)),ue(o,a,r[a]));se.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){le.set(this,e)}):ee(this,function(n){var t;if(o&&void 0===n)return void 0!==(t=le.get(o,e))||void 0!==(t=ue(o,e))?t:void 0;this.each(function(){le.set(this,e,n)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){le.remove(this,e)})}}),A.extend({queue:function(e,n,t){var a;if(e)return n=(n||"fx")+"queue",a=se.get(e,n),t&&(!a||Array.isArray(t)?a=se.access(e,n,A.makeArray(t)):a.push(t)),a||[]},dequeue:function(e,n){n=n||"fx";var t=A.queue(e,n),a=t.length,r=t.shift(),o=A._queueHooks(e,n);"inprogress"===r&&(r=t.shift(),a--),r&&("fx"===n&&t.unshift("inprogress"),delete o.stop,r.call(e,function(){A.dequeue(e,n)},o)),!a&&o&&o.empty.fire()},_queueHooks:function(e,n){var t=n+"queueHooks";return se.get(e,t)||se.access(e,t,{empty:A.Callbacks("once memory").add(function(){se.remove(e,[n+"queue",t])})})}}),A.fn.extend({queue:function(e,n){var t=2;return"string"!=typeof e&&(n=e,e="fx",t--),arguments.length<t?A.queue(this[0],e):void 0===n?this:this.each(function(){var t=A.queue(this,e,n);A._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&A.dequeue(this,e)})},dequeue:function(e){return this.each(function(){A.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var t,a=1,r=A.Deferred(),o=this,i=this.length,s=function(){--a||r.resolveWith(o,[o])};for("string"!=typeof e&&(n=e,e=void 0),e=e||"fx";i--;)(t=se.get(o[i],e+"queueHooks"))&&t.empty&&(a++,t.empty.add(s));return s(),r.promise(n)}});var pe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ve=new RegExp("^(?:([+-])=|)("+pe+")([a-z%]*)$","i"),fe=["Top","Right","Bottom","Left"],he=y.documentElement,me=function(e){return A.contains(e.ownerDocument,e)},ge={composed:!0};he.getRootNode&&(me=function(e){return A.contains(e.ownerDocument,e)||e.getRootNode(ge)===e.ownerDocument});var be=function(e,n){return"none"===(e=n||e).style.display||""===e.style.display&&me(e)&&"none"===A.css(e,"display")};function ye(e,n,t,a){var r,o,i=20,s=a?function(){return a.cur()}:function(){return A.css(e,n,"")},l=s(),c=t&&t[3]||(A.cssNumber[n]?"":"px"),d=e.nodeType&&(A.cssNumber[n]||"px"!==c&&+l)&&ve.exec(A.css(e,n));if(d&&d[3]!==c){for(l/=2,c=c||d[3],d=+l||1;i--;)A.style(e,n,d+c),(1-o)*(1-(o=s()/l||.5))<=0&&(i=0),d/=o;d*=2,A.style(e,n,d+c),t=t||[]}return t&&(d=+d||+l||0,r=t[1]?d+(t[1]+1)*t[2]:+t[2],a&&(a.unit=c,a.start=d,a.end=r)),r}var xe={};function ke(e){var n,t=e.ownerDocument,a=e.nodeName,r=xe[a];return r||(n=t.body.appendChild(t.createElement(a)),r=A.css(n,"display"),n.parentNode.removeChild(n),"none"===r&&(r="block"),xe[a]=r,r)}function we(e,n){for(var t,a,r=[],o=0,i=e.length;o<i;o++)(a=e[o]).style&&(t=a.style.display,n?("none"===t&&(r[o]=se.get(a,"display")||null,r[o]||(a.style.display="")),""===a.style.display&&be(a)&&(r[o]=ke(a))):"none"!==t&&(r[o]="none",se.set(a,"display",t)));for(o=0;o<i;o++)null!=r[o]&&(e[o].style.display=r[o]);return e}A.fn.extend({show:function(){return we(this,!0)},hide:function(){return we(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){be(this)?A(this).show():A(this).hide()})}});var _e,Ce,Ae=/^(?:checkbox|radio)$/i,Se=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Le=/^$|^module$|\/(?:java|ecma)script/i;_e=y.createDocumentFragment().appendChild(y.createElement("div")),(Ce=y.createElement("input")).setAttribute("type","radio"),Ce.setAttribute("checked","checked"),Ce.setAttribute("name","t"),_e.appendChild(Ce),m.checkClone=_e.cloneNode(!0).cloneNode(!0).lastChild.checked,_e.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!_e.cloneNode(!0).lastChild.defaultValue,_e.innerHTML="<option></option>",m.option=!!_e.lastChild;var Ee={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Te(e,n){var t;return t=void 0!==e.getElementsByTagName?e.getElementsByTagName(n||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(n||"*"):[],void 0===n||n&&L(e,n)?A.merge([e],t):t}function Ie(e,n){for(var t=0,a=e.length;t<a;t++)se.set(e[t],"globalEval",!n||se.get(n[t],"globalEval"))}Ee.tbody=Ee.tfoot=Ee.colgroup=Ee.caption=Ee.thead,Ee.th=Ee.td,m.option||(Ee.optgroup=Ee.option=[1,"<select multiple='multiple'>","</select>"]);var Re=/<|&#?\w+;/;function Me(e,n,t,a,r){for(var o,i,s,l,c,d,u=n.createDocumentFragment(),p=[],v=0,f=e.length;v<f;v++)if((o=e[v])||0===o)if("object"===w(o))A.merge(p,o.nodeType?[o]:o);else if(Re.test(o)){for(i=i||u.appendChild(n.createElement("div")),s=(Se.exec(o)||["",""])[1].toLowerCase(),l=Ee[s]||Ee._default,i.innerHTML=l[1]+A.htmlPrefilter(o)+l[2],d=l[0];d--;)i=i.lastChild;A.merge(p,i.childNodes),(i=u.firstChild).textContent=""}else p.push(n.createTextNode(o));for(u.textContent="",v=0;o=p[v++];)if(a&&A.inArray(o,a)>-1)r&&r.push(o);else if(c=me(o),i=Te(u.appendChild(o),"script"),c&&Ie(i),t)for(d=0;o=i[d++];)Le.test(o.type||"")&&t.push(o);return u}var Pe=/^([^.]*)(?:\.(.+)|)/;function De(){return!0}function ze(){return!1}function Ne(e,n,t,a,r,o){var i,s;if("object"==typeof n){for(s in"string"!=typeof t&&(a=a||t,t=void 0),n)Ne(e,s,t,a,n[s],o);return e}if(null==a&&null==r?(r=t,a=t=void 0):null==r&&("string"==typeof t?(r=a,a=void 0):(r=a,a=t,t=void 0)),!1===r)r=ze;else if(!r)return e;return 1===o&&(i=r,r=function(e){return A().off(e),i.apply(this,arguments)},r.guid=i.guid||(i.guid=A.guid++)),e.each(function(){A.event.add(this,n,r,a,t)})}function $e(e,n,t){t?(se.set(e,n,!1),A.event.add(e,n,{namespace:!1,handler:function(e){var t,a=se.get(this,n);if(1&e.isTrigger&&this[n]){if(a)(A.event.special[n]||{}).delegateType&&e.stopPropagation();else if(a=s.call(arguments),se.set(this,n,a),this[n](),t=se.get(this,n),se.set(this,n,!1),a!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else a&&(se.set(this,n,A.event.trigger(a[0],a.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=De)}})):void 0===se.get(e,n)&&A.event.add(e,n,De)}A.event={global:{},add:function(e,n,t,a,r){var o,i,s,l,c,d,u,p,v,f,h,m=se.get(e);if(oe(e))for(t.handler&&(t=(o=t).handler,r=o.selector),r&&A.find.matchesSelector(he,r),t.guid||(t.guid=A.guid++),(l=m.events)||(l=m.events=Object.create(null)),(i=m.handle)||(i=m.handle=function(n){return void 0!==A&&A.event.triggered!==n.type?A.event.dispatch.apply(e,arguments):void 0}),c=(n=(n||"").match(H)||[""]).length;c--;)v=h=(s=Pe.exec(n[c])||[])[1],f=(s[2]||"").split(".").sort(),v&&(u=A.event.special[v]||{},v=(r?u.delegateType:u.bindType)||v,u=A.event.special[v]||{},d=A.extend({type:v,origType:h,data:a,handler:t,guid:t.guid,selector:r,needsContext:r&&A.expr.match.needsContext.test(r),namespace:f.join(".")},o),(p=l[v])||((p=l[v]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,a,f,i)||e.addEventListener&&e.addEventListener(v,i)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=t.guid)),r?p.splice(p.delegateCount++,0,d):p.push(d),A.event.global[v]=!0)},remove:function(e,n,t,a,r){var o,i,s,l,c,d,u,p,v,f,h,m=se.hasData(e)&&se.get(e);if(m&&(l=m.events)){for(c=(n=(n||"").match(H)||[""]).length;c--;)if(v=h=(s=Pe.exec(n[c])||[])[1],f=(s[2]||"").split(".").sort(),v){for(u=A.event.special[v]||{},p=l[v=(a?u.delegateType:u.bindType)||v]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=o=p.length;o--;)d=p[o],!r&&h!==d.origType||t&&t.guid!==d.guid||s&&!s.test(d.namespace)||a&&a!==d.selector&&("**"!==a||!d.selector)||(p.splice(o,1),d.selector&&p.delegateCount--,u.remove&&u.remove.call(e,d));i&&!p.length&&(u.teardown&&!1!==u.teardown.call(e,f,m.handle)||A.removeEvent(e,v,m.handle),delete l[v])}else for(v in l)A.event.remove(e,v+n[c],t,a,!0);A.isEmptyObject(l)&&se.remove(e,"handle events")}},dispatch:function(e){var n,t,a,r,o,i,s=new Array(arguments.length),l=A.event.fix(e),c=(se.get(this,"events")||Object.create(null))[l.type]||[],d=A.event.special[l.type]||{};for(s[0]=l,n=1;n<arguments.length;n++)s[n]=arguments[n];if(l.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,l)){for(i=A.event.handlers.call(this,l,c),n=0;(r=i[n++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,t=0;(o=r.handlers[t++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==o.namespace&&!l.rnamespace.test(o.namespace)||(l.handleObj=o,l.data=o.data,void 0!==(a=((A.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,s))&&!1===(l.result=a)&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(e,n){var t,a,r,o,i,s=[],l=n.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],i={},t=0;t<l;t++)void 0===i[r=(a=n[t]).selector+" "]&&(i[r]=a.needsContext?A(r,this).index(c)>-1:A.find(r,this,null,[c]).length),i[r]&&o.push(a);o.length&&s.push({elem:c,handlers:o})}return c=this,l<n.length&&s.push({elem:c,handlers:n.slice(l)}),s},addProp:function(e,n){Object.defineProperty(A.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(n)?function(){if(this.originalEvent)return n(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(n){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:n})}})},fix:function(e){return e[A.expando]?e:new A.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var n=this||e;return Ae.test(n.type)&&n.click&&L(n,"input")&&$e(n,"click",!0),!1},trigger:function(e){var n=this||e;return Ae.test(n.type)&&n.click&&L(n,"input")&&$e(n,"click"),!0},_default:function(e){var n=e.target;return Ae.test(n.type)&&n.click&&L(n,"input")&&se.get(n,"click")||L(n,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},A.removeEvent=function(e,n,t){e.removeEventListener&&e.removeEventListener(n,t)},A.Event=function(e,n){if(!(this instanceof A.Event))return new A.Event(e,n);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?De:ze,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,n&&A.extend(this,n),this.timeStamp=e&&e.timeStamp||Date.now(),this[A.expando]=!0},A.Event.prototype={constructor:A.Event,isDefaultPrevented:ze,isPropagationStopped:ze,isImmediatePropagationStopped:ze,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=De,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=De,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=De,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},A.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},A.event.addProp),A.each({focus:"focusin",blur:"focusout"},function(e,n){function t(e){if(y.documentMode){var t=se.get(this,"handle"),a=A.event.fix(e);a.type="focusin"===e.type?"focus":"blur",a.isSimulated=!0,t(e),a.target===a.currentTarget&&t(a)}else A.event.simulate(n,e.target,A.event.fix(e))}A.event.special[e]={setup:function(){var a;if($e(this,e,!0),!y.documentMode)return!1;(a=se.get(this,n))||this.addEventListener(n,t),se.set(this,n,(a||0)+1)},trigger:function(){return $e(this,e),!0},teardown:function(){var e;if(!y.documentMode)return!1;(e=se.get(this,n)-1)?se.set(this,n,e):(this.removeEventListener(n,t),se.remove(this,n))},_default:function(n){return se.get(n.target,e)},delegateType:n},A.event.special[n]={setup:function(){var a=this.ownerDocument||this.document||this,r=y.documentMode?this:a,o=se.get(r,n);o||(y.documentMode?this.addEventListener(n,t):a.addEventListener(e,t,!0)),se.set(r,n,(o||0)+1)},teardown:function(){var a=this.ownerDocument||this.document||this,r=y.documentMode?this:a,o=se.get(r,n)-1;o?se.set(r,n,o):(y.documentMode?this.removeEventListener(n,t):a.removeEventListener(e,t,!0),se.remove(r,n))}}}),A.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,n){A.event.special[e]={delegateType:n,bindType:n,handle:function(e){var t,a=e.relatedTarget,r=e.handleObj;return a&&(a===this||A.contains(this,a))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=n),t}}}),A.fn.extend({on:function(e,n,t,a){return Ne(this,e,n,t,a)},one:function(e,n,t,a){return Ne(this,e,n,t,a,1)},off:function(e,n,t){var a,r;if(e&&e.preventDefault&&e.handleObj)return a=e.handleObj,A(e.delegateTarget).off(a.namespace?a.origType+"."+a.namespace:a.origType,a.selector,a.handler),this;if("object"==typeof e){for(r in e)this.off(r,n,e[r]);return this}return!1!==n&&"function"!=typeof n||(t=n,n=void 0),!1===t&&(t=ze),this.each(function(){A.event.remove(this,e,t,n)})}});var Oe=/<script|<style|<link/i,Fe=/checked\s*(?:[^=]|=\s*.checked.)/i,je=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Be(e,n){return L(e,"table")&&L(11!==n.nodeType?n:n.firstChild,"tr")&&A(e).children("tbody")[0]||e}function Xe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ue(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function We(e,n){var t,a,r,o,i,s;if(1===n.nodeType){if(se.hasData(e)&&(s=se.get(e).events))for(r in se.remove(n,"handle events"),s)for(t=0,a=s[r].length;t<a;t++)A.event.add(n,r,s[r][t]);le.hasData(e)&&(o=le.access(e),i=A.extend({},o),le.set(n,i))}}function qe(e,n){var t=n.nodeName.toLowerCase();"input"===t&&Ae.test(e.type)?n.checked=e.checked:"input"!==t&&"textarea"!==t||(n.defaultValue=e.defaultValue)}function Ge(e,n,t,a){n=l(n);var r,o,i,s,c,d,u=0,p=e.length,v=p-1,f=n[0],h=g(f);if(h||p>1&&"string"==typeof f&&!m.checkClone&&Fe.test(f))return e.each(function(r){var o=e.eq(r);h&&(n[0]=f.call(this,r,o.html())),Ge(o,n,t,a)});if(p&&(o=(r=Me(n,e[0].ownerDocument,!1,e,a)).firstChild,1===r.childNodes.length&&(r=o),o||a)){for(s=(i=A.map(Te(r,"script"),Xe)).length;u<p;u++)c=r,u!==v&&(c=A.clone(c,!0,!0),s&&A.merge(i,Te(c,"script"))),t.call(e[u],c,u);if(s)for(d=i[i.length-1].ownerDocument,A.map(i,Ue),u=0;u<s;u++)c=i[u],Le.test(c.type||"")&&!se.access(c,"globalEval")&&A.contains(d,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?A._evalUrl&&!c.noModule&&A._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},d):k(c.textContent.replace(je,""),c,d))}return e}function He(e,n,t){for(var a,r=n?A.filter(n,e):e,o=0;null!=(a=r[o]);o++)t||1!==a.nodeType||A.cleanData(Te(a)),a.parentNode&&(t&&me(a)&&Ie(Te(a,"script")),a.parentNode.removeChild(a));return e}A.extend({htmlPrefilter:function(e){return e},clone:function(e,n,t){var a,r,o,i,s=e.cloneNode(!0),l=me(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||A.isXMLDoc(e)))for(i=Te(s),a=0,r=(o=Te(e)).length;a<r;a++)qe(o[a],i[a]);if(n)if(t)for(o=o||Te(e),i=i||Te(s),a=0,r=o.length;a<r;a++)We(o[a],i[a]);else We(e,s);return(i=Te(s,"script")).length>0&&Ie(i,!l&&Te(e,"script")),s},cleanData:function(e){for(var n,t,a,r=A.event.special,o=0;void 0!==(t=e[o]);o++)if(oe(t)){if(n=t[se.expando]){if(n.events)for(a in n.events)r[a]?A.event.remove(t,a):A.removeEvent(t,a,n.handle);t[se.expando]=void 0}t[le.expando]&&(t[le.expando]=void 0)}}}),A.fn.extend({detach:function(e){return He(this,e,!0)},remove:function(e){return He(this,e)},text:function(e){return ee(this,function(e){return void 0===e?A.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Ge(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Be(this,e).appendChild(e)})},prepend:function(){return Ge(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var n=Be(this,e);n.insertBefore(e,n.firstChild)}})},before:function(){return Ge(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Ge(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,n=0;null!=(e=this[n]);n++)1===e.nodeType&&(A.cleanData(Te(e,!1)),e.textContent="");return this},clone:function(e,n){return e=null!=e&&e,n=null==n?e:n,this.map(function(){return A.clone(this,e,n)})},html:function(e){return ee(this,function(e){var n=this[0]||{},t=0,a=this.length;if(void 0===e&&1===n.nodeType)return n.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!Ee[(Se.exec(e)||["",""])[1].toLowerCase()]){e=A.htmlPrefilter(e);try{for(;t<a;t++)1===(n=this[t]||{}).nodeType&&(A.cleanData(Te(n,!1)),n.innerHTML=e);n=0}catch(e){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Ge(this,arguments,function(n){var t=this.parentNode;A.inArray(this,e)<0&&(A.cleanData(Te(this)),t&&t.replaceChild(n,this))},e)}}),A.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,n){A.fn[e]=function(e){for(var t,a=[],r=A(e),o=r.length-1,i=0;i<=o;i++)t=i===o?this:this.clone(!0),A(r[i])[n](t),c.apply(a,t.get());return this.pushStack(a)}});var Ve=new RegExp("^("+pe+")(?!px)[a-z%]+$","i"),Qe=/^--/,Ke=function(e){var n=e.ownerDocument.defaultView;return n&&n.opener||(n=a),n.getComputedStyle(e)},Ye=function(e,n,t){var a,r,o={};for(r in n)o[r]=e.style[r],e.style[r]=n[r];for(r in a=t.call(e),n)e.style[r]=o[r];return a},Je=new RegExp(fe.join("|"),"i");function Ze(e,n,t){var a,r,o,i,s=Qe.test(n),l=e.style;return(t=t||Ke(e))&&(i=t.getPropertyValue(n)||t[n],s&&i&&(i=i.replace(M,"$1")||void 0),""!==i||me(e)||(i=A.style(e,n)),!m.pixelBoxStyles()&&Ve.test(i)&&Je.test(n)&&(a=l.width,r=l.minWidth,o=l.maxWidth,l.minWidth=l.maxWidth=l.width=i,i=t.width,l.width=a,l.minWidth=r,l.maxWidth=o)),void 0!==i?i+"":i}function en(e,n){return{get:function(){if(!e())return(this.get=n).apply(this,arguments);delete this.get}}}!function(){function e(){if(d){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",he.appendChild(c).appendChild(d);var e=a.getComputedStyle(d);t="1%"!==e.top,l=12===n(e.marginLeft),d.style.right="60%",i=36===n(e.right),r=36===n(e.width),d.style.position="absolute",o=12===n(d.offsetWidth/3),he.removeChild(c),d=null}}function n(e){return Math.round(parseFloat(e))}var t,r,o,i,s,l,c=y.createElement("div"),d=y.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,A.extend(m,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),i},pixelPosition:function(){return e(),t},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),o},reliableTrDimensions:function(){var e,n,t,r;return null==s&&(e=y.createElement("table"),n=y.createElement("tr"),t=y.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",n.style.cssText="box-sizing:content-box;border:1px solid",n.style.height="1px",t.style.height="9px",t.style.display="block",he.appendChild(e).appendChild(n).appendChild(t),r=a.getComputedStyle(n),s=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===n.offsetHeight,he.removeChild(e)),s}}))}();var nn=["Webkit","Moz","ms"],tn=y.createElement("div").style,an={};function rn(e){return A.cssProps[e]||an[e]||(e in tn?e:an[e]=function(e){for(var n=e[0].toUpperCase()+e.slice(1),t=nn.length;t--;)if((e=nn[t]+n)in tn)return e}(e)||e)}var on=/^(none|table(?!-c[ea]).+)/,sn={position:"absolute",visibility:"hidden",display:"block"},ln={letterSpacing:"0",fontWeight:"400"};function cn(e,n,t){var a=ve.exec(n);return a?Math.max(0,a[2]-(t||0))+(a[3]||"px"):n}function dn(e,n,t,a,r,o){var i="width"===n?1:0,s=0,l=0,c=0;if(t===(a?"border":"content"))return 0;for(;i<4;i+=2)"margin"===t&&(c+=A.css(e,t+fe[i],!0,r)),a?("content"===t&&(l-=A.css(e,"padding"+fe[i],!0,r)),"margin"!==t&&(l-=A.css(e,"border"+fe[i]+"Width",!0,r))):(l+=A.css(e,"padding"+fe[i],!0,r),"padding"!==t?l+=A.css(e,"border"+fe[i]+"Width",!0,r):s+=A.css(e,"border"+fe[i]+"Width",!0,r));return!a&&o>=0&&(l+=Math.max(0,Math.ceil(e["offset"+n[0].toUpperCase()+n.slice(1)]-o-l-s-.5))||0),l+c}function un(e,n,t){var a=Ke(e),r=(!m.boxSizingReliable()||t)&&"border-box"===A.css(e,"boxSizing",!1,a),o=r,i=Ze(e,n,a),s="offset"+n[0].toUpperCase()+n.slice(1);if(Ve.test(i)){if(!t)return i;i="auto"}return(!m.boxSizingReliable()&&r||!m.reliableTrDimensions()&&L(e,"tr")||"auto"===i||!parseFloat(i)&&"inline"===A.css(e,"display",!1,a))&&e.getClientRects().length&&(r="border-box"===A.css(e,"boxSizing",!1,a),(o=s in e)&&(i=e[s])),(i=parseFloat(i)||0)+dn(e,n,t||(r?"border":"content"),o,a,i)+"px"}function pn(e,n,t,a,r){return new pn.prototype.init(e,n,t,a,r)}A.extend({cssHooks:{opacity:{get:function(e,n){if(n){var t=Ze(e,"opacity");return""===t?"1":t}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,n,t,a){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,i,s=re(n),l=Qe.test(n),c=e.style;if(l||(n=rn(s)),i=A.cssHooks[n]||A.cssHooks[s],void 0===t)return i&&"get"in i&&void 0!==(r=i.get(e,!1,a))?r:c[n];"string"==(o=typeof t)&&(r=ve.exec(t))&&r[1]&&(t=ye(e,n,r),o="number"),null!=t&&t==t&&("number"!==o||l||(t+=r&&r[3]||(A.cssNumber[s]?"":"px")),m.clearCloneStyle||""!==t||0!==n.indexOf("background")||(c[n]="inherit"),i&&"set"in i&&void 0===(t=i.set(e,t,a))||(l?c.setProperty(n,t):c[n]=t))}},css:function(e,n,t,a){var r,o,i,s=re(n);return Qe.test(n)||(n=rn(s)),(i=A.cssHooks[n]||A.cssHooks[s])&&"get"in i&&(r=i.get(e,!0,t)),void 0===r&&(r=Ze(e,n,a)),"normal"===r&&n in ln&&(r=ln[n]),""===t||t?(o=parseFloat(r),!0===t||isFinite(o)?o||0:r):r}}),A.each(["height","width"],function(e,n){A.cssHooks[n]={get:function(e,t,a){if(t)return!on.test(A.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?un(e,n,a):Ye(e,sn,function(){return un(e,n,a)})},set:function(e,t,a){var r,o=Ke(e),i=!m.scrollboxSize()&&"absolute"===o.position,s=(i||a)&&"border-box"===A.css(e,"boxSizing",!1,o),l=a?dn(e,n,a,s,o):0;return s&&i&&(l-=Math.ceil(e["offset"+n[0].toUpperCase()+n.slice(1)]-parseFloat(o[n])-dn(e,n,"border",!1,o)-.5)),l&&(r=ve.exec(t))&&"px"!==(r[3]||"px")&&(e.style[n]=t,t=A.css(e,n)),cn(0,t,l)}}}),A.cssHooks.marginLeft=en(m.reliableMarginLeft,function(e,n){if(n)return(parseFloat(Ze(e,"marginLeft"))||e.getBoundingClientRect().left-Ye(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),A.each({margin:"",padding:"",border:"Width"},function(e,n){A.cssHooks[e+n]={expand:function(t){for(var a=0,r={},o="string"==typeof t?t.split(" "):[t];a<4;a++)r[e+fe[a]+n]=o[a]||o[a-2]||o[0];return r}},"margin"!==e&&(A.cssHooks[e+n].set=cn)}),A.fn.extend({css:function(e,n){return ee(this,function(e,n,t){var a,r,o={},i=0;if(Array.isArray(n)){for(a=Ke(e),r=n.length;i<r;i++)o[n[i]]=A.css(e,n[i],!1,a);return o}return void 0!==t?A.style(e,n,t):A.css(e,n)},e,n,arguments.length>1)}}),A.Tween=pn,pn.prototype={constructor:pn,init:function(e,n,t,a,r,o){this.elem=e,this.prop=t,this.easing=r||A.easing._default,this.options=n,this.start=this.now=this.cur(),this.end=a,this.unit=o||(A.cssNumber[t]?"":"px")},cur:function(){var e=pn.propHooks[this.prop];return e&&e.get?e.get(this):pn.propHooks._default.get(this)},run:function(e){var n,t=pn.propHooks[this.prop];return this.options.duration?this.pos=n=A.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=n=e,this.now=(this.end-this.start)*n+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),t&&t.set?t.set(this):pn.propHooks._default.set(this),this}},pn.prototype.init.prototype=pn.prototype,pn.propHooks={_default:{get:function(e){var n;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(n=A.css(e.elem,e.prop,""))&&"auto"!==n?n:0},set:function(e){A.fx.step[e.prop]?A.fx.step[e.prop](e):1!==e.elem.nodeType||!A.cssHooks[e.prop]&&null==e.elem.style[rn(e.prop)]?e.elem[e.prop]=e.now:A.style(e.elem,e.prop,e.now+e.unit)}}},pn.propHooks.scrollTop=pn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},A.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},A.fx=pn.prototype.init,A.fx.step={};var vn,fn,hn=/^(?:toggle|show|hide)$/,mn=/queueHooks$/;function gn(){fn&&(!1===y.hidden&&a.requestAnimationFrame?a.requestAnimationFrame(gn):a.setTimeout(gn,A.fx.interval),A.fx.tick())}function bn(){return a.setTimeout(function(){vn=void 0}),vn=Date.now()}function yn(e,n){var t,a=0,r={height:e};for(n=n?1:0;a<4;a+=2-n)r["margin"+(t=fe[a])]=r["padding"+t]=e;return n&&(r.opacity=r.width=e),r}function xn(e,n,t){for(var a,r=(kn.tweeners[n]||[]).concat(kn.tweeners["*"]),o=0,i=r.length;o<i;o++)if(a=r[o].call(t,n,e))return a}function kn(e,n,t){var a,r,o=0,i=kn.prefilters.length,s=A.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var n=vn||bn(),t=Math.max(0,c.startTime+c.duration-n),a=1-(t/c.duration||0),o=0,i=c.tweens.length;o<i;o++)c.tweens[o].run(a);return s.notifyWith(e,[c,a,t]),a<1&&i?t:(i||s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:A.extend({},n),opts:A.extend(!0,{specialEasing:{},easing:A.easing._default},t),originalProperties:n,originalOptions:t,startTime:vn||bn(),duration:t.duration,tweens:[],createTween:function(n,t){var a=A.Tween(e,c.opts,n,t,c.opts.specialEasing[n]||c.opts.easing);return c.tweens.push(a),a},stop:function(n){var t=0,a=n?c.tweens.length:0;if(r)return this;for(r=!0;t<a;t++)c.tweens[t].run(1);return n?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,n])):s.rejectWith(e,[c,n]),this}}),d=c.props;for(function(e,n){var t,a,r,o,i;for(t in e)if(r=n[a=re(t)],o=e[t],Array.isArray(o)&&(r=o[1],o=e[t]=o[0]),t!==a&&(e[a]=o,delete e[t]),(i=A.cssHooks[a])&&"expand"in i)for(t in o=i.expand(o),delete e[a],o)t in e||(e[t]=o[t],n[t]=r);else n[a]=r}(d,c.opts.specialEasing);o<i;o++)if(a=kn.prefilters[o].call(c,e,d,c.opts))return g(a.stop)&&(A._queueHooks(c.elem,c.opts.queue).stop=a.stop.bind(a)),a;return A.map(d,xn,c),g(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),A.fx.timer(A.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}A.Animation=A.extend(kn,{tweeners:{"*":[function(e,n){var t=this.createTween(e,n);return ye(t.elem,e,ve.exec(n),t),t}]},tweener:function(e,n){g(e)?(n=e,e=["*"]):e=e.match(H);for(var t,a=0,r=e.length;a<r;a++)t=e[a],kn.tweeners[t]=kn.tweeners[t]||[],kn.tweeners[t].unshift(n)},prefilters:[function(e,n,t){var a,r,o,i,s,l,c,d,u="width"in n||"height"in n,p=this,v={},f=e.style,h=e.nodeType&&be(e),m=se.get(e,"fxshow");for(a in t.queue||(null==(i=A._queueHooks(e,"fx")).unqueued&&(i.unqueued=0,s=i.empty.fire,i.empty.fire=function(){i.unqueued||s()}),i.unqueued++,p.always(function(){p.always(function(){i.unqueued--,A.queue(e,"fx").length||i.empty.fire()})})),n)if(r=n[a],hn.test(r)){if(delete n[a],o=o||"toggle"===r,r===(h?"hide":"show")){if("show"!==r||!m||void 0===m[a])continue;h=!0}v[a]=m&&m[a]||A.style(e,a)}if((l=!A.isEmptyObject(n))||!A.isEmptyObject(v))for(a in u&&1===e.nodeType&&(t.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=m&&m.display)&&(c=se.get(e,"display")),"none"===(d=A.css(e,"display"))&&(c?d=c:(we([e],!0),c=e.style.display||c,d=A.css(e,"display"),we([e]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===A.css(e,"float")&&(l||(p.done(function(){f.display=c}),null==c&&(d=f.display,c="none"===d?"":d)),f.display="inline-block")),t.overflow&&(f.overflow="hidden",p.always(function(){f.overflow=t.overflow[0],f.overflowX=t.overflow[1],f.overflowY=t.overflow[2]})),l=!1,v)l||(m?"hidden"in m&&(h=m.hidden):m=se.access(e,"fxshow",{display:c}),o&&(m.hidden=!h),h&&we([e],!0),p.done(function(){for(a in h||we([e]),se.remove(e,"fxshow"),v)A.style(e,a,v[a])})),l=xn(h?m[a]:0,a,p),a in m||(m[a]=l.start,h&&(l.end=l.start,l.start=0))}],prefilter:function(e,n){n?kn.prefilters.unshift(e):kn.prefilters.push(e)}}),A.speed=function(e,n,t){var a=e&&"object"==typeof e?A.extend({},e):{complete:t||!t&&n||g(e)&&e,duration:e,easing:t&&n||n&&!g(n)&&n};return A.fx.off?a.duration=0:"number"!=typeof a.duration&&(a.duration in A.fx.speeds?a.duration=A.fx.speeds[a.duration]:a.duration=A.fx.speeds._default),null!=a.queue&&!0!==a.queue||(a.queue="fx"),a.old=a.complete,a.complete=function(){g(a.old)&&a.old.call(this),a.queue&&A.dequeue(this,a.queue)},a},A.fn.extend({fadeTo:function(e,n,t,a){return this.filter(be).css("opacity",0).show().end().animate({opacity:n},e,t,a)},animate:function(e,n,t,a){var r=A.isEmptyObject(e),o=A.speed(n,t,a),i=function(){var n=kn(this,A.extend({},e),o);(r||se.get(this,"finish"))&&n.stop(!0)};return i.finish=i,r||!1===o.queue?this.each(i):this.queue(o.queue,i)},stop:function(e,n,t){var a=function(e){var n=e.stop;delete e.stop,n(t)};return"string"!=typeof e&&(t=n,n=e,e=void 0),n&&this.queue(e||"fx",[]),this.each(function(){var n=!0,r=null!=e&&e+"queueHooks",o=A.timers,i=se.get(this);if(r)i[r]&&i[r].stop&&a(i[r]);else for(r in i)i[r]&&i[r].stop&&mn.test(r)&&a(i[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(t),n=!1,o.splice(r,1));!n&&t||A.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var n,t=se.get(this),a=t[e+"queue"],r=t[e+"queueHooks"],o=A.timers,i=a?a.length:0;for(t.finish=!0,A.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),n=o.length;n--;)o[n].elem===this&&o[n].queue===e&&(o[n].anim.stop(!0),o.splice(n,1));for(n=0;n<i;n++)a[n]&&a[n].finish&&a[n].finish.call(this);delete t.finish})}}),A.each(["toggle","show","hide"],function(e,n){var t=A.fn[n];A.fn[n]=function(e,a,r){return null==e||"boolean"==typeof e?t.apply(this,arguments):this.animate(yn(n,!0),e,a,r)}}),A.each({slideDown:yn("show"),slideUp:yn("hide"),slideToggle:yn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,n){A.fn[e]=function(e,t,a){return this.animate(n,e,t,a)}}),A.timers=[],A.fx.tick=function(){var e,n=0,t=A.timers;for(vn=Date.now();n<t.length;n++)(e=t[n])()||t[n]!==e||t.splice(n--,1);t.length||A.fx.stop(),vn=void 0},A.fx.timer=function(e){A.timers.push(e),A.fx.start()},A.fx.interval=13,A.fx.start=function(){fn||(fn=!0,gn())},A.fx.stop=function(){fn=null},A.fx.speeds={slow:600,fast:200,_default:400},A.fn.delay=function(e,n){return e=A.fx&&A.fx.speeds[e]||e,n=n||"fx",this.queue(n,function(n,t){var r=a.setTimeout(n,e);t.stop=function(){a.clearTimeout(r)}})},function(){var e=y.createElement("input"),n=y.createElement("select").appendChild(y.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=n.selected,(e=y.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var wn,_n=A.expr.attrHandle;A.fn.extend({attr:function(e,n){return ee(this,A.attr,e,n,arguments.length>1)},removeAttr:function(e){return this.each(function(){A.removeAttr(this,e)})}}),A.extend({attr:function(e,n,t){var a,r,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?A.prop(e,n,t):(1===o&&A.isXMLDoc(e)||(r=A.attrHooks[n.toLowerCase()]||(A.expr.match.bool.test(n)?wn:void 0)),void 0!==t?null===t?void A.removeAttr(e,n):r&&"set"in r&&void 0!==(a=r.set(e,t,n))?a:(e.setAttribute(n,t+""),t):r&&"get"in r&&null!==(a=r.get(e,n))?a:null==(a=A.find.attr(e,n))?void 0:a)},attrHooks:{type:{set:function(e,n){if(!m.radioValue&&"radio"===n&&L(e,"input")){var t=e.value;return e.setAttribute("type",n),t&&(e.value=t),n}}}},removeAttr:function(e,n){var t,a=0,r=n&&n.match(H);if(r&&1===e.nodeType)for(;t=r[a++];)e.removeAttribute(t)}}),wn={set:function(e,n,t){return!1===n?A.removeAttr(e,t):e.setAttribute(t,t),t}},A.each(A.expr.match.bool.source.match(/\w+/g),function(e,n){var t=_n[n]||A.find.attr;_n[n]=function(e,n,a){var r,o,i=n.toLowerCase();return a||(o=_n[i],_n[i]=r,r=null!=t(e,n,a)?i:null,_n[i]=o),r}});var Cn=/^(?:input|select|textarea|button)$/i,An=/^(?:a|area)$/i;function Sn(e){return(e.match(H)||[]).join(" ")}function Ln(e){return e.getAttribute&&e.getAttribute("class")||""}function En(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(H)||[]}A.fn.extend({prop:function(e,n){return ee(this,A.prop,e,n,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[A.propFix[e]||e]})}}),A.extend({prop:function(e,n,t){var a,r,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&A.isXMLDoc(e)||(n=A.propFix[n]||n,r=A.propHooks[n]),void 0!==t?r&&"set"in r&&void 0!==(a=r.set(e,t,n))?a:e[n]=t:r&&"get"in r&&null!==(a=r.get(e,n))?a:e[n]},propHooks:{tabIndex:{get:function(e){var n=A.find.attr(e,"tabindex");return n?parseInt(n,10):Cn.test(e.nodeName)||An.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(A.propHooks.selected={get:function(e){var n=e.parentNode;return n&&n.parentNode&&n.parentNode.selectedIndex,null},set:function(e){var n=e.parentNode;n&&(n.selectedIndex,n.parentNode&&n.parentNode.selectedIndex)}}),A.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){A.propFix[this.toLowerCase()]=this}),A.fn.extend({addClass:function(e){var n,t,a,r,o,i;return g(e)?this.each(function(n){A(this).addClass(e.call(this,n,Ln(this)))}):(n=En(e)).length?this.each(function(){if(a=Ln(this),t=1===this.nodeType&&" "+Sn(a)+" "){for(o=0;o<n.length;o++)r=n[o],t.indexOf(" "+r+" ")<0&&(t+=r+" ");i=Sn(t),a!==i&&this.setAttribute("class",i)}}):this},removeClass:function(e){var n,t,a,r,o,i;return g(e)?this.each(function(n){A(this).removeClass(e.call(this,n,Ln(this)))}):arguments.length?(n=En(e)).length?this.each(function(){if(a=Ln(this),t=1===this.nodeType&&" "+Sn(a)+" "){for(o=0;o<n.length;o++)for(r=n[o];t.indexOf(" "+r+" ")>-1;)t=t.replace(" "+r+" "," ");i=Sn(t),a!==i&&this.setAttribute("class",i)}}):this:this.attr("class","")},toggleClass:function(e,n){var t,a,r,o,i=typeof e,s="string"===i||Array.isArray(e);return g(e)?this.each(function(t){A(this).toggleClass(e.call(this,t,Ln(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(e):this.removeClass(e):(t=En(e),this.each(function(){if(s)for(o=A(this),r=0;r<t.length;r++)a=t[r],o.hasClass(a)?o.removeClass(a):o.addClass(a);else void 0!==e&&"boolean"!==i||((a=Ln(this))&&se.set(this,"__className__",a),this.setAttribute&&this.setAttribute("class",a||!1===e?"":se.get(this,"__className__")||""))}))},hasClass:function(e){var n,t,a=0;for(n=" "+e+" ";t=this[a++];)if(1===t.nodeType&&(" "+Sn(Ln(t))+" ").indexOf(n)>-1)return!0;return!1}});var Tn=/\r/g;A.fn.extend({val:function(e){var n,t,a,r=this[0];return arguments.length?(a=g(e),this.each(function(t){var r;1===this.nodeType&&(null==(r=a?e.call(this,t,A(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=A.map(r,function(e){return null==e?"":e+""})),(n=A.valHooks[this.type]||A.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,r,"value")||(this.value=r))})):r?(n=A.valHooks[r.type]||A.valHooks[r.nodeName.toLowerCase()])&&"get"in n&&void 0!==(t=n.get(r,"value"))?t:"string"==typeof(t=r.value)?t.replace(Tn,""):null==t?"":t:void 0}}),A.extend({valHooks:{option:{get:function(e){var n=A.find.attr(e,"value");return null!=n?n:Sn(A.text(e))}},select:{get:function(e){var n,t,a,r=e.options,o=e.selectedIndex,i="select-one"===e.type,s=i?null:[],l=i?o+1:r.length;for(a=o<0?l:i?o:0;a<l;a++)if(((t=r[a]).selected||a===o)&&!t.disabled&&(!t.parentNode.disabled||!L(t.parentNode,"optgroup"))){if(n=A(t).val(),i)return n;s.push(n)}return s},set:function(e,n){for(var t,a,r=e.options,o=A.makeArray(n),i=r.length;i--;)((a=r[i]).selected=A.inArray(A.valHooks.option.get(a),o)>-1)&&(t=!0);return t||(e.selectedIndex=-1),o}}}}),A.each(["radio","checkbox"],function(){A.valHooks[this]={set:function(e,n){if(Array.isArray(n))return e.checked=A.inArray(A(e).val(),n)>-1}},m.checkOn||(A.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var In=a.location,Rn={guid:Date.now()},Mn=/\?/;A.parseXML=function(e){var n,t;if(!e||"string"!=typeof e)return null;try{n=(new a.DOMParser).parseFromString(e,"text/xml")}catch(e){}return t=n&&n.getElementsByTagName("parsererror")[0],n&&!t||A.error("Invalid XML: "+(t?A.map(t.childNodes,function(e){return e.textContent}).join("\n"):e)),n};var Pn=/^(?:focusinfocus|focusoutblur)$/,Dn=function(e){e.stopPropagation()};A.extend(A.event,{trigger:function(e,n,t,r){var o,i,s,l,c,d,u,p,f=[t||y],h=v.call(e,"type")?e.type:e,m=v.call(e,"namespace")?e.namespace.split("."):[];if(i=p=s=t=t||y,3!==t.nodeType&&8!==t.nodeType&&!Pn.test(h+A.event.triggered)&&(h.indexOf(".")>-1&&(m=h.split("."),h=m.shift(),m.sort()),c=h.indexOf(":")<0&&"on"+h,(e=e[A.expando]?e:new A.Event(h,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=t),n=null==n?[e]:A.makeArray(n,[e]),u=A.event.special[h]||{},r||!u.trigger||!1!==u.trigger.apply(t,n))){if(!r&&!u.noBubble&&!b(t)){for(l=u.delegateType||h,Pn.test(l+h)||(i=i.parentNode);i;i=i.parentNode)f.push(i),s=i;s===(t.ownerDocument||y)&&f.push(s.defaultView||s.parentWindow||a)}for(o=0;(i=f[o++])&&!e.isPropagationStopped();)p=i,e.type=o>1?l:u.bindType||h,(d=(se.get(i,"events")||Object.create(null))[e.type]&&se.get(i,"handle"))&&d.apply(i,n),(d=c&&i[c])&&d.apply&&oe(i)&&(e.result=d.apply(i,n),!1===e.result&&e.preventDefault());return e.type=h,r||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(f.pop(),n)||!oe(t)||c&&g(t[h])&&!b(t)&&((s=t[c])&&(t[c]=null),A.event.triggered=h,e.isPropagationStopped()&&p.addEventListener(h,Dn),t[h](),e.isPropagationStopped()&&p.removeEventListener(h,Dn),A.event.triggered=void 0,s&&(t[c]=s)),e.result}},simulate:function(e,n,t){var a=A.extend(new A.Event,t,{type:e,isSimulated:!0});A.event.trigger(a,null,n)}}),A.fn.extend({trigger:function(e,n){return this.each(function(){A.event.trigger(e,n,this)})},triggerHandler:function(e,n){var t=this[0];if(t)return A.event.trigger(e,n,t,!0)}});var zn=/\[\]$/,Nn=/\r?\n/g,$n=/^(?:submit|button|image|reset|file)$/i,On=/^(?:input|select|textarea|keygen)/i;function Fn(e,n,t,a){var r;if(Array.isArray(n))A.each(n,function(n,r){t||zn.test(e)?a(e,r):Fn(e+"["+("object"==typeof r&&null!=r?n:"")+"]",r,t,a)});else if(t||"object"!==w(n))a(e,n);else for(r in n)Fn(e+"["+r+"]",n[r],t,a)}A.param=function(e,n){var t,a=[],r=function(e,n){var t=g(n)?n():n;a[a.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!A.isPlainObject(e))A.each(e,function(){r(this.name,this.value)});else for(t in e)Fn(t,e[t],n,r);return a.join("&")},A.fn.extend({serialize:function(){return A.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=A.prop(this,"elements");return e?A.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!A(this).is(":disabled")&&On.test(this.nodeName)&&!$n.test(e)&&(this.checked||!Ae.test(e))}).map(function(e,n){var t=A(this).val();return null==t?null:Array.isArray(t)?A.map(t,function(e){return{name:n.name,value:e.replace(Nn,"\r\n")}}):{name:n.name,value:t.replace(Nn,"\r\n")}}).get()}});var jn=/%20/g,Bn=/#.*$/,Xn=/([?&])_=[^&]*/,Un=/^(.*?):[ \t]*([^\r\n]*)$/gm,Wn=/^(?:GET|HEAD)$/,qn=/^\/\//,Gn={},Hn={},Vn="*/".concat("*"),Qn=y.createElement("a");function Kn(e){return function(n,t){"string"!=typeof n&&(t=n,n="*");var a,r=0,o=n.toLowerCase().match(H)||[];if(g(t))for(;a=o[r++];)"+"===a[0]?(a=a.slice(1)||"*",(e[a]=e[a]||[]).unshift(t)):(e[a]=e[a]||[]).push(t)}}function Yn(e,n,t,a){var r={},o=e===Hn;function i(s){var l;return r[s]=!0,A.each(e[s]||[],function(e,s){var c=s(n,t,a);return"string"!=typeof c||o||r[c]?o?!(l=c):void 0:(n.dataTypes.unshift(c),i(c),!1)}),l}return i(n.dataTypes[0])||!r["*"]&&i("*")}function Jn(e,n){var t,a,r=A.ajaxSettings.flatOptions||{};for(t in n)void 0!==n[t]&&((r[t]?e:a||(a={}))[t]=n[t]);return a&&A.extend(!0,e,a),e}Qn.href=In.href,A.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:In.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(In.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Vn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":A.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,n){return n?Jn(Jn(e,A.ajaxSettings),n):Jn(A.ajaxSettings,e)},ajaxPrefilter:Kn(Gn),ajaxTransport:Kn(Hn),ajax:function(e,n){"object"==typeof e&&(n=e,e=void 0),n=n||{};var t,r,o,i,s,l,c,d,u,p,v=A.ajaxSetup({},n),f=v.context||v,h=v.context&&(f.nodeType||f.jquery)?A(f):A.event,m=A.Deferred(),g=A.Callbacks("once memory"),b=v.statusCode||{},x={},k={},w="canceled",_={readyState:0,getResponseHeader:function(e){var n;if(c){if(!i)for(i={};n=Un.exec(o);)i[n[1].toLowerCase()+" "]=(i[n[1].toLowerCase()+" "]||[]).concat(n[2]);n=i[e.toLowerCase()+" "]}return null==n?null:n.join(", ")},getAllResponseHeaders:function(){return c?o:null},setRequestHeader:function(e,n){return null==c&&(e=k[e.toLowerCase()]=k[e.toLowerCase()]||e,x[e]=n),this},overrideMimeType:function(e){return null==c&&(v.mimeType=e),this},statusCode:function(e){var n;if(e)if(c)_.always(e[_.status]);else for(n in e)b[n]=[b[n],e[n]];return this},abort:function(e){var n=e||w;return t&&t.abort(n),C(0,n),this}};if(m.promise(_),v.url=((e||v.url||In.href)+"").replace(qn,In.protocol+"//"),v.type=n.method||n.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(H)||[""],null==v.crossDomain){l=y.createElement("a");try{l.href=v.url,l.href=l.href,v.crossDomain=Qn.protocol+"//"+Qn.host!=l.protocol+"//"+l.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=A.param(v.data,v.traditional)),Yn(Gn,v,n,_),c)return _;for(u in(d=A.event&&v.global)&&0===A.active++&&A.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Wn.test(v.type),r=v.url.replace(Bn,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(jn,"+")):(p=v.url.slice(r.length),v.data&&(v.processData||"string"==typeof v.data)&&(r+=(Mn.test(r)?"&":"?")+v.data,delete v.data),!1===v.cache&&(r=r.replace(Xn,"$1"),p=(Mn.test(r)?"&":"?")+"_="+Rn.guid+++p),v.url=r+p),v.ifModified&&(A.lastModified[r]&&_.setRequestHeader("If-Modified-Since",A.lastModified[r]),A.etag[r]&&_.setRequestHeader("If-None-Match",A.etag[r])),(v.data&&v.hasContent&&!1!==v.contentType||n.contentType)&&_.setRequestHeader("Content-Type",v.contentType),_.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Vn+"; q=0.01":""):v.accepts["*"]),v.headers)_.setRequestHeader(u,v.headers[u]);if(v.beforeSend&&(!1===v.beforeSend.call(f,_,v)||c))return _.abort();if(w="abort",g.add(v.complete),_.done(v.success),_.fail(v.error),t=Yn(Hn,v,n,_)){if(_.readyState=1,d&&h.trigger("ajaxSend",[_,v]),c)return _;v.async&&v.timeout>0&&(s=a.setTimeout(function(){_.abort("timeout")},v.timeout));try{c=!1,t.send(x,C)}catch(e){if(c)throw e;C(-1,e)}}else C(-1,"No Transport");function C(e,n,i,l){var u,p,y,x,k,w=n;c||(c=!0,s&&a.clearTimeout(s),t=void 0,o=l||"",_.readyState=e>0?4:0,u=e>=200&&e<300||304===e,i&&(x=function(e,n,t){for(var a,r,o,i,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===a&&(a=e.mimeType||n.getResponseHeader("Content-Type"));if(a)for(r in s)if(s[r]&&s[r].test(a)){l.unshift(r);break}if(l[0]in t)o=l[0];else{for(r in t){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}i||(i=r)}o=o||i}if(o)return o!==l[0]&&l.unshift(o),t[o]}(v,_,i)),!u&&A.inArray("script",v.dataTypes)>-1&&A.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),x=function(e,n,t,a){var r,o,i,s,l,c={},d=e.dataTypes.slice();if(d[1])for(i in e.converters)c[i.toLowerCase()]=e.converters[i];for(o=d.shift();o;)if(e.responseFields[o]&&(t[e.responseFields[o]]=n),!l&&a&&e.dataFilter&&(n=e.dataFilter(n,e.dataType)),l=o,o=d.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(i=c[l+" "+o]||c["* "+o]))for(r in c)if((s=r.split(" "))[1]===o&&(i=c[l+" "+s[0]]||c["* "+s[0]])){!0===i?i=c[r]:!0!==c[r]&&(o=s[0],d.unshift(s[1]));break}if(!0!==i)if(i&&e.throws)n=i(n);else try{n=i(n)}catch(e){return{state:"parsererror",error:i?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:n}}(v,x,_,u),u?(v.ifModified&&((k=_.getResponseHeader("Last-Modified"))&&(A.lastModified[r]=k),(k=_.getResponseHeader("etag"))&&(A.etag[r]=k)),204===e||"HEAD"===v.type?w="nocontent":304===e?w="notmodified":(w=x.state,p=x.data,u=!(y=x.error))):(y=w,!e&&w||(w="error",e<0&&(e=0))),_.status=e,_.statusText=(n||w)+"",u?m.resolveWith(f,[p,w,_]):m.rejectWith(f,[_,w,y]),_.statusCode(b),b=void 0,d&&h.trigger(u?"ajaxSuccess":"ajaxError",[_,v,u?p:y]),g.fireWith(f,[_,w]),d&&(h.trigger("ajaxComplete",[_,v]),--A.active||A.event.trigger("ajaxStop")))}return _},getJSON:function(e,n,t){return A.get(e,n,t,"json")},getScript:function(e,n){return A.get(e,void 0,n,"script")}}),A.each(["get","post"],function(e,n){A[n]=function(e,t,a,r){return g(t)&&(r=r||a,a=t,t=void 0),A.ajax(A.extend({url:e,type:n,dataType:r,data:t,success:a},A.isPlainObject(e)&&e))}}),A.ajaxPrefilter(function(e){var n;for(n in e.headers)"content-type"===n.toLowerCase()&&(e.contentType=e.headers[n]||"")}),A._evalUrl=function(e,n,t){return A.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){A.globalEval(e,n,t)}})},A.fn.extend({wrapAll:function(e){var n;return this[0]&&(g(e)&&(e=e.call(this[0])),n=A(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&n.insertBefore(this[0]),n.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return g(e)?this.each(function(n){A(this).wrapInner(e.call(this,n))}):this.each(function(){var n=A(this),t=n.contents();t.length?t.wrapAll(e):n.append(e)})},wrap:function(e){var n=g(e);return this.each(function(t){A(this).wrapAll(n?e.call(this,t):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){A(this).replaceWith(this.childNodes)}),this}}),A.expr.pseudos.hidden=function(e){return!A.expr.pseudos.visible(e)},A.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},A.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(e){}};var Zn={0:200,1223:204},et=A.ajaxSettings.xhr();m.cors=!!et&&"withCredentials"in et,m.ajax=et=!!et,A.ajaxTransport(function(e){var n,t;if(m.cors||et&&!e.crossDomain)return{send:function(r,o){var i,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];for(i in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)s.setRequestHeader(i,r[i]);n=function(e){return function(){n&&(n=t=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Zn[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),t=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=t:s.onreadystatechange=function(){4===s.readyState&&a.setTimeout(function(){n&&t()})},n=n("abort");try{s.send(e.hasContent&&e.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),A.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),A.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return A.globalEval(e),e}}}),A.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),A.ajaxTransport("script",function(e){var n,t;if(e.crossDomain||e.scriptAttrs)return{send:function(a,r){n=A("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",t=function(e){n.remove(),t=null,e&&r("error"===e.type?404:200,e.type)}),y.head.appendChild(n[0])},abort:function(){t&&t()}}});var nt,tt=[],at=/(=)\?(?=&|$)|\?\?/;A.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tt.pop()||A.expando+"_"+Rn.guid++;return this[e]=!0,e}}),A.ajaxPrefilter("json jsonp",function(e,n,t){var r,o,i,s=!1!==e.jsonp&&(at.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&at.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=g(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(at,"$1"+r):!1!==e.jsonp&&(e.url+=(Mn.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return i||A.error(r+" was not called"),i[0]},e.dataTypes[0]="json",o=a[r],a[r]=function(){i=arguments},t.always(function(){void 0===o?A(a).removeProp(r):a[r]=o,e[r]&&(e.jsonpCallback=n.jsonpCallback,tt.push(r)),i&&g(o)&&o(i[0]),i=o=void 0}),"script"}),m.createHTMLDocument=((nt=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===nt.childNodes.length),A.parseHTML=function(e,n,t){return"string"!=typeof e?[]:("boolean"==typeof n&&(t=n,n=!1),n||(m.createHTMLDocument?((a=(n=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,n.head.appendChild(a)):n=y),o=!t&&[],(r=j.exec(e))?[n.createElement(r[1])]:(r=Me([e],n,o),o&&o.length&&A(o).remove(),A.merge([],r.childNodes)));var a,r,o},A.fn.load=function(e,n,t){var a,r,o,i=this,s=e.indexOf(" ");return s>-1&&(a=Sn(e.slice(s)),e=e.slice(0,s)),g(n)?(t=n,n=void 0):n&&"object"==typeof n&&(r="POST"),i.length>0&&A.ajax({url:e,type:r||"GET",dataType:"html",data:n}).done(function(e){o=arguments,i.html(a?A("<div>").append(A.parseHTML(e)).find(a):e)}).always(t&&function(e,n){i.each(function(){t.apply(this,o||[e.responseText,n,e])})}),this},A.expr.pseudos.animated=function(e){return A.grep(A.timers,function(n){return e===n.elem}).length},A.offset={setOffset:function(e,n,t){var a,r,o,i,s,l,c=A.css(e,"position"),d=A(e),u={};"static"===c&&(e.style.position="relative"),s=d.offset(),o=A.css(e,"top"),l=A.css(e,"left"),("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1?(i=(a=d.position()).top,r=a.left):(i=parseFloat(o)||0,r=parseFloat(l)||0),g(n)&&(n=n.call(e,t,A.extend({},s))),null!=n.top&&(u.top=n.top-s.top+i),null!=n.left&&(u.left=n.left-s.left+r),"using"in n?n.using.call(e,u):d.css(u)}},A.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(n){A.offset.setOffset(this,e,n)});var n,t,a=this[0];return a?a.getClientRects().length?(n=a.getBoundingClientRect(),t=a.ownerDocument.defaultView,{top:n.top+t.pageYOffset,left:n.left+t.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,n,t,a=this[0],r={top:0,left:0};if("fixed"===A.css(a,"position"))n=a.getBoundingClientRect();else{for(n=this.offset(),t=a.ownerDocument,e=a.offsetParent||t.documentElement;e&&(e===t.body||e===t.documentElement)&&"static"===A.css(e,"position");)e=e.parentNode;e&&e!==a&&1===e.nodeType&&((r=A(e).offset()).top+=A.css(e,"borderTopWidth",!0),r.left+=A.css(e,"borderLeftWidth",!0))}return{top:n.top-r.top-A.css(a,"marginTop",!0),left:n.left-r.left-A.css(a,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===A.css(e,"position");)e=e.offsetParent;return e||he})}}),A.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var t="pageYOffset"===n;A.fn[e]=function(a){return ee(this,function(e,a,r){var o;if(b(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===r)return o?o[n]:e[a];o?o.scrollTo(t?o.pageXOffset:r,t?r:o.pageYOffset):e[a]=r},e,a,arguments.length)}}),A.each(["top","left"],function(e,n){A.cssHooks[n]=en(m.pixelPosition,function(e,t){if(t)return t=Ze(e,n),Ve.test(t)?A(e).position()[n]+"px":t})}),A.each({Height:"height",Width:"width"},function(e,n){A.each({padding:"inner"+e,content:n,"":"outer"+e},function(t,a){A.fn[a]=function(r,o){var i=arguments.length&&(t||"boolean"!=typeof r),s=t||(!0===r||!0===o?"margin":"border");return ee(this,function(n,t,r){var o;return b(n)?0===a.indexOf("outer")?n["inner"+e]:n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):void 0===r?A.css(n,t,s):A.style(n,t,r,s)},n,i?r:void 0,i)}})}),A.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,n){A.fn[n]=function(e){return this.on(n,e)}}),A.fn.extend({bind:function(e,n,t){return this.on(e,null,n,t)},unbind:function(e,n){return this.off(e,null,n)},delegate:function(e,n,t,a){return this.on(n,e,t,a)},undelegate:function(e,n,t){return 1===arguments.length?this.off(e,"**"):this.off(n,e||"**",t)},hover:function(e,n){return this.on("mouseenter",e).on("mouseleave",n||e)}}),A.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){A.fn[n]=function(e,t){return arguments.length>0?this.on(n,null,e,t):this.trigger(n)}});var rt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;A.proxy=function(e,n){var t,a,r;if("string"==typeof n&&(t=e[n],n=e,e=t),g(e))return a=s.call(arguments,2),r=function(){return e.apply(n||this,a.concat(s.call(arguments)))},r.guid=e.guid=e.guid||A.guid++,r},A.holdReady=function(e){e?A.readyWait++:A.ready(!0)},A.isArray=Array.isArray,A.parseJSON=JSON.parse,A.nodeName=L,A.isFunction=g,A.isWindow=b,A.camelCase=re,A.type=w,A.now=Date.now,A.isNumeric=function(e){var n=A.type(e);return("number"===n||"string"===n)&&!isNaN(e-parseFloat(e))},A.trim=function(e){return null==e?"":(e+"").replace(rt,"$1")},void 0===(t=function(){return A}.apply(n,[]))||(e.exports=t);var ot=a.jQuery,it=a.$;return A.noConflict=function(e){return a.$===A&&(a.$=it),e&&a.jQuery===A&&(a.jQuery=ot),A},void 0===r&&(a.jQuery=a.$=A),A})},4717:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},4728:(e,n,t)=>{"use strict";t.d(n,{A:()=>f});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o),s=t(4417),l=t.n(s),c=new URL(t(660),t.b),d=new URL(t(1530),t.b),u=i()(r()),p=l()(c),v=l()(d);u.push([e.id,`\n.settings-panel[data-v-076944a6] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  padding: 1rem;\n  gap: 1rem;\n  position: relative;\n}\n\n/* 头部 */\n.panel-header[data-v-076944a6] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: var(--color-surface);\n  border-radius: 0.75rem;\n  border: 1px solid var(--color-border);\n  flex-shrink: 0;\n  flex-wrap: wrap;\n  gap: 0.75rem;\n}\n.header-left[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  min-width: 0;\n}\n.header-icon[data-v-076944a6] {\n  font-size: 1.5rem;\n}\n.header-info[data-v-076944a6] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.panel-title[data-v-076944a6] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.settings-subtitle[data-v-076944a6] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.header-actions[data-v-076944a6] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  flex-shrink: 0;\n}\n.action-btn[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n  white-space: nowrap;\n}\n\n/* 修复按钮文字被全局样式覆盖的问题 */\n.action-btn .btn-text[data-v-076944a6] {\n  display: inline;\n  width: auto;\n  text-align: left;\n  font-size: inherit;\n  color: inherit;\n  flex: 0 0 auto;\n}\n.action-btn[data-v-076944a6]:hover {\n  background: #f1f5f9;\n  border-color: #94a3b8;\n}\n.action-btn.primary[data-v-076944a6] {\n  background: #3b82f6;\n  border-color: #3b82f6;\n  color: white;\n}\n.action-btn.primary[data-v-076944a6]:hover {\n  background: #2563eb;\n  border-color: #2563eb;\n}\n\n/* 设置容器 */\n.settings-container[data-v-076944a6] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 0.5rem 3rem 0.5rem;\n\n  /* 滚动条样式 */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.settings-container[data-v-076944a6]::-webkit-scrollbar {\n  width: 8px;\n}\n.settings-container[data-v-076944a6]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-container[data-v-076944a6]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n  transition: background 0.2s ease;\n}\n.settings-container[data-v-076944a6]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n\n/* 设置区块 */\n.settings-section[data-v-076944a6] {\n  margin-bottom: 1.5rem;\n  background: var(--color-surface);\n  border-radius: 0.75rem;\n  border: 1px solid var(--color-border);\n  overflow: hidden;\n}\n.section-header[data-v-076944a6] {\n  padding: 1rem 1.25rem;\n  background: var(--color-surface-light);\n  border-bottom: 1px solid var(--color-border);\n}\n.section-title[data-v-076944a6] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.settings-list[data-v-076944a6] {\n  padding: 0.5rem;\n}\n\n/* 设置项 */\n.setting-item[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-radius: 0.5rem;\n  transition: background 0.2s ease;\n}\n.setting-item[data-v-076944a6]:hover {\n  background: var(--color-surface-light);\n}\n.setting-info[data-v-076944a6] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.setting-name[data-v-076944a6] {\n  font-weight: 500;\n  color: var(--color-text);\n  cursor: pointer;\n}\n.setting-desc[data-v-076944a6] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.setting-control[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n}\n.model-control[data-v-076944a6] {\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.5rem;\n}\n.model-select-row[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.model-search[data-v-076944a6] {\n  width: 100%;\n}\n\n/* 控件样式 */\n.setting-select[data-v-076944a6] {\n  padding: 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  background: white;\n  color: #374151;\n  font-size: 0.875rem;\n  min-width: 80px;\n}\n.setting-select[data-v-076944a6]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.range-container[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.setting-range[data-v-076944a6] {\n  width: 100px;\n}\n.range-value[data-v-076944a6] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n  min-width: 40px;\n}\n\n/* 下拉选择框样式 */\n.setting-select[data-v-076944a6] {\n  padding: 0.5rem 2rem 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background-color: white;\n  background-image: url(${p});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 12px;\n  color: #374151;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: border-color 0.2s ease;\n  appearance: none;\n  min-width: 120px;\n}\n.setting-select[data-v-076944a6]:hover {\n  border-color: #94a3b8;\n}\n.setting-select[data-v-076944a6]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n[data-theme='dark'] .setting-select[data-v-076944a6] {\n  background-color: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n  background-image: url(${v});\n}\n[data-theme='dark'] .setting-select[data-v-076944a6]:hover {\n  border-color: #6b7280;\n}\n\n/* 开关样式 */\n.setting-switch[data-v-076944a6] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n}\n.setting-switch input[data-v-076944a6] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.switch-slider[data-v-076944a6] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.switch-slider[data-v-076944a6]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .switch-slider[data-v-076944a6] {\n  background-color: #3b82f6;\n}\ninput:checked + .switch-slider[data-v-076944a6]:before {\n  transform: translateX(20px);\n}\n\n/* 全宽设置项 */\n.setting-item-full[data-v-076944a6] {\n  flex-direction: column;\n  align-items: flex-start;\n}\n.setting-control-full[data-v-076944a6] {\n  width: 100%;\n  margin-top: 0.5rem;\n}\n.setting-textarea[data-v-076944a6] {\n  width: 100%;\n  padding: 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  background: white;\n  color: #374151;\n  font-size: 0.875rem;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 60px;\n}\n.setting-textarea[data-v-076944a6]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n.setting-textarea[data-v-076944a6]::placeholder {\n  color: #9ca3af;\n}\n[data-theme='dark'] .setting-textarea[data-v-076944a6] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .setting-textarea[data-v-076944a6]::placeholder {\n  color: #6b7280;\n}\n\n/* 工具按钮 */\n.utility-btn[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  background: white;\n  color: #374151;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n.utility-btn[data-v-076944a6]:hover {\n  background: #f9fafb;\n  border-color: #9ca3af;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.setting-item[data-v-076944a6] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.75rem;\n}\n.setting-control[data-v-076944a6] {\n    width: 100%;\n    justify-content: flex-end;\n}\n.model-control[data-v-076944a6] {\n    justify-content: flex-start;\n}\n.model-select-row[data-v-076944a6] {\n    width: 100%;\n    flex-direction: column;\n    align-items: stretch;\n}\n.model-select-row .setting-select[data-v-076944a6],\n  .model-select-row .utility-btn[data-v-076944a6] {\n    width: 100%;\n    justify-content: center;\n}\n.range-container[data-v-076944a6] {\n    width: 100%;\n    justify-content: space-between;\n}\n.header-actions[data-v-076944a6] {\n    flex-wrap: wrap;\n}\n.header-actions .action-btn[data-v-076944a6] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.75rem;\n}\n.header-actions .btn-text[data-v-076944a6] {\n    display: inline;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .settings-panel[data-v-076944a6] {\n  background: var(--color-background);\n}\n[data-theme='dark'] .panel-header[data-v-076944a6],\n[data-theme='dark'] .settings-section[data-v-076944a6] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme='dark'] .section-header[data-v-076944a6] {\n  background: #334155;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .panel-title[data-v-076944a6],\n[data-theme='dark'] .section-title[data-v-076944a6],\n[data-theme='dark'] .setting-name[data-v-076944a6] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .settings-subtitle[data-v-076944a6],\n[data-theme='dark'] .setting-desc[data-v-076944a6] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .setting-item[data-v-076944a6]:hover {\n  background: #334155;\n}\n[data-theme='dark'] .action-btn[data-v-076944a6],\n[data-theme='dark'] .setting-select[data-v-076944a6],\n[data-theme='dark'] .utility-btn[data-v-076944a6] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .action-btn[data-v-076944a6]:hover,\n[data-theme='dark'] .utility-btn[data-v-076944a6]:hover {\n  background: #4b5563;\n  border-color: #6b7280;\n}\n[data-theme='dark'] .switch-slider[data-v-076944a6] {\n  background-color: #4b5563;\n}\n\n/* 授权验证相关样式 */\n.form-input-inline[data-v-076944a6] {\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  min-width: 200px;\n  transition: all 0.2s ease;\n}\n.form-input-inline[data-v-076944a6]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n}\n.auth-status[data-v-076944a6] {\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n}\n.auth-status.verified[data-v-076944a6] {\n  background: #d1fae5;\n  color: #059669;\n  border: 1px solid #a7f3d0;\n}\n.auth-status.unverified[data-v-076944a6] {\n  background: #fee2e2;\n  color: #dc2626;\n  border: 1px solid #fecaca;\n}\n.utility-btn.primary[data-v-076944a6] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.utility-btn.primary[data-v-076944a6]:hover {\n  background: var(--color-primary-dark, #2563eb);\n  border-color: var(--color-primary-dark, #2563eb);\n}\n[data-theme='dark'] .form-input-inline[data-v-076944a6] {\n  background: #334155;\n  border-color: #475569;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .auth-status.verified[data-v-076944a6] {\n  background: rgba(5, 150, 105, 0.2);\n  color: #6ee7b7;\n  border-color: rgba(5, 150, 105, 0.3);\n}\n[data-theme='dark'] .auth-status.unverified[data-v-076944a6] {\n  background: rgba(220, 38, 38, 0.2);\n  color: #fca5a5;\n  border-color: rgba(220, 38, 38, 0.3);\n}\n\n/* 加载脉冲动画 */\n.loading-pulse[data-v-076944a6] {\n  animation: pulse-076944a6 1.5s ease-in-out infinite;\n}\n@keyframes pulse-076944a6 {\n0%,\n  100% {\n    opacity: 1;\n}\n50% {\n    opacity: 0.4;\n}\n}\n\n/* 提示词管理弹窗 */\n.prompt-modal-overlay[data-v-076944a6] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n  padding: 20px;\n}\n.prompt-modal-content[data-v-076944a6] {\n  background: var(--color-surface, #ffffff);\n  border-radius: 14px;\n  width: min(900px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);\n  border: 1px solid var(--color-border);\n  animation: modalIn-076944a6 0.2s ease;\n}\n.prompt-modal-header[data-v-076944a6] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.prompt-modal-header h3[data-v-076944a6] {\n  margin: 0;\n  font-size: 1.15rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.prompt-modal-body[data-v-076944a6] {\n  flex: 1;\n  overflow: auto;\n  padding: 0;\n}\n@keyframes modalIn-076944a6 {\nfrom {\n    opacity: 0;\n    transform: scale(0.95);\n}\nto {\n    opacity: 1;\n    transform: scale(1);\n}\n}\n\n`,""]);const f=u},4765:e=>{"use strict";var n=String.prototype.replace,t=/%20/g,a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return n.call(e,t,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:a}},4803:(e,n,t)=>{"use strict";var a=t(8859),r=t(9675),o=function(e,n,t){for(var a,r=e;null!=(a=r.next);r=a)if(a.key===n)return r.next=a.next,t||(a.next=e.next,e.next=a),a};e.exports=function(){var e,n={assert:function(e){if(!n.has(e))throw new r("Side channel does not contain "+a(e))},delete:function(n){var t=e&&e.next,a=function(e,n){if(e)return o(e,n,!0)}(e,n);return a&&t&&t===a&&(e=void 0),!!a},get:function(n){return function(e,n){if(e){var t=o(e,n);return t&&t.value}}(e,n)},has:function(n){return function(e,n){return!!e&&!!o(e,n)}(e,n)},set:function(n,t){e||(e={next:void 0}),function(e,n,t){var a=o(e,n);a?a.value=t:e.next={key:n,next:e.next,value:t}}(e,n,t)}};return n}},4804:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},4820:(e,n,t)=>{"use strict";t.d(n,{cleanCommands:()=>s,validateCommands:()=>o});const a=["社交.记忆","角色.装备","角色.技能.掌握技能"],r=["角色","社交","元数据","世界","系统","角色.身份","角色.属性","角色.身份.觉醒阶段","角色.属性.生命值","角色.属性.精神力","角色.属性.理智值","角色.属性.体力","角色.属性.寿命","角色.背包","角色.背包.物品","角色.背包.货币","角色.效果","角色.位置","角色.技能","社交.关系","社交.关系矩阵","社交.关系矩阵.edges","社交.事件","社交.事件.事件记录","元数据.时间","元数据.游戏设置","世界.地图","世界.势力"];function o(e){const n=[],t=[],o=[];try{return Array.isArray(e)?(e.forEach((e,i)=>{try{const s=function(e,n){const t=[],o=[];try{if(!e||"object"!=typeof e)return t.push(`指令${n}: 不是有效的对象`),{valid:!1,errors:t,warnings:o};const i=e;i.action||t.push(`指令${n}: 缺少action字段`),i.key||t.push(`指令${n}: 缺少key字段`);const s=["set","add","push","delete","pull"];if(i.action&&!s.includes(i.action)&&t.push(`指令${n}: action值"${i.action}"无效，必须是: ${s.join(", ")}`),i.key&&"string"!=typeof i.key&&t.push(`指令${n}: key必须是字符串类型`),i.key&&i.action){const e=function(e,n){for(const n of a)if(e===n||e.startsWith(`${n}.`))return`路径 "${e}" 禁止AI操作（系统保护字段）`;if("delete"===n)for(const t of r)if(e===t)return`禁止对核心路径 "${e}" 执行 ${n} 操作（会导致数据丢失）`;return null}(i.key,i.action);e&&t.push(`指令${n}: ${e}`)}"delete"!==i.action&&void 0===i.value&&t.push(`指令${n}: ${i.action}操作必须提供value字段`);const l=["action","key","value"],c=Object.keys(i).filter(e=>!l.includes(e));if(c.length>0&&o.push(`指令${n}: 包含多余字段: ${c.join(", ")}（这些字段会被自动移除）`),i.key&&void 0!==i.value)try{const e=function(e,n,t){const a=[];try{const r=["元数据","角色","社交","世界","系统"];if(!r.some(n=>e===n||e.startsWith(`${n}.`)))return a.push(`key必须以 ${r.join(" / ")} 开头（V3短路径），当前: ${e}`),a;"add"===t&&e.includes("角色.背包.装备")&&a.push(`${e} 禁止使用 add 操作添加物品/装备。请使用 set 操作写入完整对象。`);const o=["力量","体质","敏捷","意志","魅力","幸运"];if("add"===t&&(["元数据.时间.年","元数据.时间.月","元数据.时间.日","元数据.时间.小时","元数据.时间.分钟","角色.属性.声望","角色.位置.辐射强度","角色.属性.生命.当前","角色.属性.生命.上限","角色.属性.能量.当前","角色.属性.能量.上限","角色.属性.精神.当前","角色.属性.精神.上限","角色.属性.寿命.当前","角色.属性.寿命.上限"].includes(e)&&"number"!=typeof n&&a.push(`${e} 使用 add 时 value 必须是数字，当前类型: ${typeof n}`),e.startsWith("角色.背包.货币.")&&e.endsWith(".数量")&&"number"!=typeof n&&a.push(`${e} 使用 add 时 value 必须是数字，当前类型: ${typeof n}`),e.startsWith("角色.身份.后天属性.")&&o.some(n=>e.endsWith(`.${n}`))&&"number"!=typeof n&&a.push(`${e} 使用 add 时 value 必须是数字，当前类型: ${typeof n}`)),"角色.身份.觉醒阶段"===e&&"set"===t&&("string"!=typeof n?a.push("角色.身份.觉醒阶段 必须是字符串类型"):String(n).trim()||a.push("角色.身份.觉醒阶段 不能为空字符串")),"角色.位置"===e&&"set"===t)if("object"!=typeof n||null===n)a.push("角色.位置 必须是对象类型");else{const e=n;void 0!==e.描述&&"string"!=typeof e.描述&&a.push("位置.描述必须是字符串类型"),void 0!==e.x&&"number"!=typeof e.x&&a.push("位置.x必须是数字类型"),void 0!==e.y&&"number"!=typeof e.y&&a.push("位置.y必须是数字类型"),void 0!==e.地图ID&&"string"!=typeof e.地图ID&&a.push("位置.地图ID必须是字符串类型")}if("角色.效果"===e&&"push"===t)if("object"!=typeof n||null===n)a.push("角色.效果 push 的 value 必须是对象类型");else{const e=n;void 0===e.类型||["buff","debuff"].includes(e.类型)||a.push(`状态效果类型必须是"buff"或"debuff"，当前值: ${e.类型}`),void 0!==e.持续时间分钟&&"number"!=typeof e.持续时间分钟&&a.push("状态效果.持续时间分钟必须是数字类型")}if("角色.背包.物品"===e&&"push"===t&&("object"==typeof n&&null!==n||a.push("推送到 角色.背包.物品 的物品必须是对象类型")),e.startsWith("角色.背包.物品.")&&"set"===t&&(3!==(e.match(/\./g)||[]).length||"object"==typeof n&&null!==n||a.push("物品必须是对象类型")),e.startsWith("社交.关系.")&&2===(e.match(/\./g)||[]).length&&"set"===t&&"object"==typeof n&&null!==n){const e=n;!e.觉醒阶段||"string"==typeof e.觉醒阶段||"object"==typeof e.觉醒阶段&&null!==e.觉醒阶段||a.push("NPC觉醒阶段必须是字符串或对象类型"),void 0===e.天赋||Array.isArray(e.天赋)||a.push("NPC天赋必须是数组类型")}return e.startsWith("社交.关系.")&&e.endsWith(".觉醒阶段")&&"set"===t&&("string"==typeof n&&String(n).trim()||a.push("NPC觉醒阶段必须是非空字符串")),a}catch(e){return console.error("[指令验证] validateValueType发生异常:",e),a.push(`验证过程发生异常: ${e instanceof Error?e.message:String(e)}`),a}}(i.key,i.value,i.action);t.push(...e.map(e=>`指令${n}: ${e}`))}catch(e){console.error("[指令验证] 值类型检查异常:",e),o.push(`指令${n}: 值类型检查时发生异常，已跳过`)}return{valid:0===t.length,errors:t,warnings:o}}catch(e){return console.error("[指令验证] validateCommand发生严重异常:",e),t.push(`指令${n}: 验证过程发生严重异常`),{valid:!1,errors:t,warnings:o}}}(e,i);n.push(...s.errors),t.push(...s.warnings),s.errors.length>0&&o.push({command:e,errors:s.errors})}catch(e){console.error(`[指令验证] 验证指令${i}时发生异常:`,e),n.push(`指令${i}: 验证时发生异常`),t.push(`指令${i}: 已跳过异常指令`)}}),{valid:0===n.length,errors:n,warnings:t,invalidCommands:o}):{valid:!1,errors:["tavern_commands必须是数组类型"],warnings:[],invalidCommands:[]}}catch(e){return console.error("[指令验证] validateCommands发生严重异常:",e),{valid:!1,errors:["指令数组验证过程发生严重异常"],warnings:[],invalidCommands:[]}}}function i(e){const{action:n,key:t,value:a}=e,r={action:n,key:t,value:a};return"delete"===n&&delete r.value,r}function s(e){return e.map(i)}},4899:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-system-panel[data-v-13a1052a] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  gap: 8px;\n  background: var(--color-background);\n}\n.sect-header[data-v-13a1052a] {\n  border: 1px solid var(--color-border);\n  border-radius: 14px;\n  background:\n    radial-gradient(900px 220px at 8% 0%, rgba(var(--color-primary-rgb), 0.09), transparent 55%),\n    radial-gradient(700px 200px at 92% 0%, rgba(var(--color-primary-rgb), 0.06), transparent 60%),\n    var(--color-surface);\n  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);\n  overflow: hidden;\n}\n.sect-headline[data-v-13a1052a] {\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 12px 12px 10px 12px;\n  border-bottom: 1px solid var(--color-border);\n}\n.sect-title[data-v-13a1052a] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  min-width: 0;\n}\n.sect-mark[data-v-13a1052a] {\n  width: 34px;\n  height: 34px;\n  border-radius: 10px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.10);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.18);\n  flex: 0 0 auto;\n}\n.sect-title-text[data-v-13a1052a] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  min-width: 0;\n}\n.sect-name[data-v-13a1052a] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-family: var(--font-family-serif);\n  font-weight: 800;\n  letter-spacing: 0.02em;\n  color: var(--color-text);\n  font-size: 1.02rem;\n  line-height: 1.2;\n  min-width: 0;\n}\n.sect-name > span[data-v-13a1052a]:first-child {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.role-pill[data-v-13a1052a] {\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 8px;\n  border-radius: 999px;\n  font-size: 0.72rem;\n  font-weight: 800;\n  letter-spacing: 0.02em;\n  border: 1px solid var(--color-border);\n  background: rgba(var(--color-border-rgb), 0.18);\n  color: var(--color-text-secondary);\n  flex: 0 0 auto;\n}\n.role-pill.master[data-v-13a1052a] {\n  border-color: rgba(234, 179, 8, 0.35);\n  background: rgba(234, 179, 8, 0.12);\n  color: #a16207;\n}\n.role-pill.leader[data-v-13a1052a] {\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n  background: rgba(var(--color-primary-rgb), 0.10);\n  color: var(--color-primary);\n}\n.role-pill.member[data-v-13a1052a] {\n  border-color: rgba(34, 197, 94, 0.30);\n  background: rgba(34, 197, 94, 0.10);\n  color: #166534;\n}\n.role-pill.none[data-v-13a1052a] {\n  border-color: rgba(var(--color-border-rgb), 0.5);\n  background: rgba(var(--color-border-rgb), 0.14);\n  color: var(--color-text-secondary);\n}\n.sect-subtitle[data-v-13a1052a] {\n  color: var(--color-text-secondary);\n  font-size: 0.84rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.sect-subtitle .sub-strong[data-v-13a1052a] {\n  color: var(--color-text);\n  font-weight: 700;\n}\n.sect-metrics[data-v-13a1052a] {\n  display: flex;\n  gap: 8px;\n  flex: 0 0 auto;\n}\n.metric[data-v-13a1052a] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  padding: 8px 10px;\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  background: rgba(var(--color-surface-rgb), 0.6);\n  backdrop-filter: blur(8px);\n  min-width: 78px;\n}\n.metric .k[data-v-13a1052a] {\n  font-size: 0.72rem;\n  color: var(--color-text-muted);\n}\n.metric .v[data-v-13a1052a] {\n  font-weight: 800;\n  color: var(--color-text);\n  font-variant-numeric: tabular-nums;\n}\n.sect-tabs[data-v-13a1052a] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 10px;\n  background: rgba(var(--color-surface-rgb), 0.7);\n  overflow-x: auto;\n  overflow-y: hidden;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(var(--color-border-rgb), 0.35) transparent;\n}\n.sect-tabs[data-v-13a1052a]::-webkit-scrollbar {\n  height: 6px;\n}\n.sect-tabs[data-v-13a1052a]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.sect-tabs[data-v-13a1052a]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-border-rgb), 0.35);\n  border-radius: 999px;\n}\n.tab-group-label[data-v-13a1052a] {\n  padding: 4px 8px;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: rgba(var(--color-border-rgb), 0.08);\n  color: var(--color-text-secondary);\n  font-size: 0.72rem;\n  font-weight: 800;\n  letter-spacing: 0.02em;\n  white-space: nowrap;\n  flex: 0 0 auto;\n}\n.tab-group-divider[data-v-13a1052a] {\n  width: 1px;\n  height: 18px;\n  background: rgba(var(--color-border-rgb), 0.22);\n  flex: 0 0 auto;\n}\n.sect-tab[data-v-13a1052a] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  background: rgba(var(--color-background-rgb), 0.6);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n  flex: 0 0 auto;\n}\n.sect-tab[data-v-13a1052a]:hover {\n  color: var(--color-text);\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n  background: rgba(var(--color-surface-rgb), 0.72);\n}\n.sect-tab.active[data-v-13a1052a] {\n  color: var(--color-primary);\n  border-color: rgba(var(--color-primary-rgb), 0.5);\n  background: rgba(var(--color-primary-rgb), 0.08);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.15);\n}\n.sect-system-content[data-v-13a1052a] {\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.sect-system-content[data-v-13a1052a] > * {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n}\n@media (max-width: 768px) {\n.sect-headline[data-v-13a1052a] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.sect-metrics[data-v-13a1052a] {\n    justify-content: flex-start;\n    flex-wrap: wrap;\n}\n.sect-tab[data-v-13a1052a] {\n    font-size: 0.75rem;\n    padding: 5px 8px;\n}\n}\n",""]);const s=i},4950:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.crafting-panel[data-v-72e52e5b] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  min-height: 0;\n  background: var(--color-background);\n}\n.toolbar[data-v-72e52e5b] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 16px;\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n  background: var(--color-surface);\n}\n.title[data-v-72e52e5b] {\n  display: flex;\n  align-items: baseline;\n  gap: 8px;\n}\n.title-text[data-v-72e52e5b] {\n  font-weight: 600;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.meta[data-v-72e52e5b] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 600;\n}\n.toolbar-actions[data-v-72e52e5b] {\n  display: flex;\n  gap: 10px;\n  align-items: center;\n}\n.mode-btn[data-v-72e52e5b] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 16px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-weight: 500;\n  font-size: 0.9rem;\n}\n.mode-btn[data-v-72e52e5b]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n}\n.mode-btn.active[data-v-72e52e5b] {\n  border-color: var(--color-primary);\n  background: var(--color-primary);\n  color: white;\n}\n.simulation-toggle[data-v-72e52e5b] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 8px 16px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n}\n.toggle-text[data-v-72e52e5b] {\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text);\n  white-space: nowrap;\n}\n.toggle-switch[data-v-72e52e5b] {\n  position: relative;\n  display: inline-block;\n  width: 48px;\n  height: 26px;\n  flex-shrink: 0;\n}\n.toggle-switch input[data-v-72e52e5b] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.toggle-slider[data-v-72e52e5b] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: var(--color-border);\n  transition: all 0.2s ease;\n  border-radius: 26px;\n}\n.toggle-slider[data-v-72e52e5b]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 4px;\n  bottom: 4px;\n  background: white;\n  transition: all 0.2s ease;\n  border-radius: 50%;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\n}\n.toggle-switch input:checked + .toggle-slider[data-v-72e52e5b] {\n  background: var(--color-primary);\n}\n.toggle-switch input:checked + .toggle-slider[data-v-72e52e5b]:before {\n  transform: translateX(22px);\n}\n.content[data-v-72e52e5b] {\n  flex: 1;\n  min-height: 0;\n  display: grid;\n  grid-template-columns: 1fr 320px;\n  gap: 20px;\n  padding: 20px;\n}\n.crafting-area[data-v-72e52e5b],\n.materials-area[data-v-72e52e5b] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.crafting-area[data-v-72e52e5b] {\n  padding: 0;\n  gap: 0;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.craft-grid[data-v-72e52e5b] {\n  display: grid;\n  grid-template-columns: repeat(3, minmax(0, 1fr));\n  grid-auto-rows: minmax(100px, auto);\n  gap: 12px;\n  padding: 20px;\n  background: var(--color-surface-light);\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.slot[data-v-72e52e5b] {\n  position: relative;\n  width: 100%;\n  min-height: 100px;\n  border: 2px dashed var(--color-border);\n  background: var(--color-surface);\n  border-radius: 12px;\n  padding: 12px;\n  cursor: pointer;\n  text-align: left;\n  transition: all 0.2s ease;\n}\n.slot[data-v-72e52e5b]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n.slot.active[data-v-72e52e5b] {\n  border-style: solid;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.slot.filled[data-v-72e52e5b] {\n  border-style: solid;\n  border-color: var(--color-border);\n  background: var(--color-surface-light);\n}\n.slot-empty[data-v-72e52e5b] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  align-items: flex-start;\n}\n.slot-index[data-v-72e52e5b] {\n  font-weight: 800;\n  color: var(--color-text);\n}\n.slot-hint[data-v-72e52e5b] {\n  font-size: 0.78rem;\n  color: var(--color-text-secondary);\n}\n.slot-item-name[data-v-72e52e5b] {\n  font-weight: 700;\n  color: var(--color-text);\n  font-size: 0.82rem;\n  line-height: 1.25;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n.slot-item-meta[data-v-72e52e5b] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-top: 6px;\n}\n.slot-remove[data-v-72e52e5b] {\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  width: 26px;\n  height: 26px;\n  border: none;\n  border-radius: 8px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.slot-remove[data-v-72e52e5b]:hover {\n  background: rgba(239, 68, 68, 0.08);\n  color: var(--color-error);\n}\n.furnace-cell[data-v-72e52e5b] {\n  border: 2px solid var(--color-primary);\n  background: var(--color-surface);\n  border-radius: 12px;\n  padding: 14px 18px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  min-height: 100px;\n}\n.furnace-cell .furnace-icon[data-v-72e52e5b] {\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-primary);\n  color: white;\n  flex-shrink: 0;\n}\n.furnace-cell .furnace-title[data-v-72e52e5b] {\n  font-weight: 600;\n  font-size: 1.1rem;\n  color: var(--color-text);\n}\n.options[data-v-72e52e5b] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding: 20px;\n  background: var(--color-surface);\n  flex: 1;\n  min-height: 0;\n  overflow-y: auto;\n}\n.option[data-v-72e52e5b] {\n  padding: 14px;\n  background: var(--color-surface-light);\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n}\n.option-title[data-v-72e52e5b] {\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 8px;\n  font-size: 0.9rem;\n}\n.option-buttons[data-v-72e52e5b] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.range-row[data-v-72e52e5b] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.range[data-v-72e52e5b] {\n  width: 100%;\n  accent-color: var(--color-primary);\n  height: 5px;\n}\n.range-meta[data-v-72e52e5b] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 8px;\n}\n.range-val[data-v-72e52e5b] {\n  font-weight: 900;\n  color: var(--color-primary);\n  font-size: 0.9rem;\n}\n.range-hint[data-v-72e52e5b] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.select[data-v-72e52e5b] {\n  width: 100%;\n  padding: 7px 10px;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  outline: none;\n  font-size: 0.88rem;\n}\n.select-hint[data-v-72e52e5b] {\n  margin-top: 4px;\n  color: var(--color-text-secondary);\n  font-size: 0.75rem;\n  line-height: 1.35;\n}\n.select-desc[data-v-72e52e5b] {\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n.pill-btn[data-v-72e52e5b] {\n  padding: 6px 10px;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.85rem;\n}\n.pill-btn[data-v-72e52e5b]:hover {\n  background: var(--color-surface-hover);\n  transform: translateY(-1px);\n}\n.pill-btn.active[data-v-72e52e5b] {\n  border-color: rgba(var(--color-primary-rgb), 0.55);\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n}\n.rate-header[data-v-72e52e5b] {\n  display: flex;\n  align-items: baseline;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n.rate-label[data-v-72e52e5b] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.rate-value[data-v-72e52e5b] {\n  font-weight: 900;\n}\n.rate-value.low[data-v-72e52e5b] {\n  color: var(--color-error);\n}\n.rate-value.mid[data-v-72e52e5b] {\n  color: var(--color-warning);\n}\n.rate-value.high[data-v-72e52e5b] {\n  color: var(--color-success);\n}\n.rate-bar[data-v-72e52e5b] {\n  height: 8px;\n  border-radius: 999px;\n  background: rgba(var(--color-primary-rgb), 0.08);\n  overflow: hidden;\n}\n.rate-fill[data-v-72e52e5b] {\n  height: 100%;\n  background: linear-gradient(90deg, rgba(var(--color-primary-rgb), 0.35), rgba(var(--color-primary-rgb), 0.95));\n}\n.rate-hint[data-v-72e52e5b] {\n  margin-top: 8px;\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n  white-space: pre-wrap;\n  overflow-wrap: anywhere;\n}\n.actions[data-v-72e52e5b] {\n  display: flex;\n  gap: 12px;\n  padding: 20px;\n  background: var(--color-surface);\n  border-top: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.primary-btn[data-v-72e52e5b],\n.secondary-btn[data-v-72e52e5b] {\n  flex: 1;\n  padding: 12px 16px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-weight: 500;\n  font-size: 0.95rem;\n}\n.primary-btn[data-v-72e52e5b] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.primary-btn[data-v-72e52e5b]:hover:not(:disabled) {\n  opacity: 0.9;\n}\n.secondary-btn[data-v-72e52e5b] {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n.secondary-btn[data-v-72e52e5b]:hover:not(:disabled) {\n  background: var(--color-surface-hover);\n}\n.primary-btn[data-v-72e52e5b]:disabled,\n.secondary-btn[data-v-72e52e5b]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.materials-header[data-v-72e52e5b] {\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 16px;\n  flex-shrink: 0;\n  background: var(--color-surface);\n}\n.materials-title[data-v-72e52e5b] {\n  font-weight: 600;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.materials-tools[data-v-72e52e5b] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface);\n  flex: 1;\n  max-width: 240px;\n}\n.materials-tools[data-v-72e52e5b]:focus-within {\n  border-color: var(--color-primary);\n}\n.search-icon[data-v-72e52e5b] {\n  color: var(--color-text-secondary);\n  flex-shrink: 0;\n}\n.search[data-v-72e52e5b] {\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  width: 100%;\n}\n.materials-empty[data-v-72e52e5b] {\n  flex: 1;\n  min-height: 0;\n  padding: 16px 12px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  gap: 6px;\n  color: var(--color-text-secondary);\n}\n.empty-title[data-v-72e52e5b] {\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 6px;\n}\n.materials-list[data-v-72e52e5b] {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  background: var(--color-surface);\n}\n.material[data-v-72e52e5b] {\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface);\n  padding: 12px 14px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-height: 72px;\n}\n.material[data-v-72e52e5b]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n.material-name[data-v-72e52e5b] {\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 4px;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n.material-meta[data-v-72e52e5b] {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n.material-right[data-v-72e52e5b] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  color: var(--color-text-secondary);\n}\n.count[data-v-72e52e5b] {\n  font-weight: 700;\n}\n.add-icon[data-v-72e52e5b] {\n  color: var(--color-primary);\n}\n.meta-pill[data-v-72e52e5b] {\n  padding: 3px 8px;\n  border-radius: 4px;\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n\n/* 分页控件样式 */\n.pagination[data-v-72e52e5b] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 12px;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  flex-shrink: 0;\n}\n.page-btn[data-v-72e52e5b] {\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.2rem;\n  font-weight: 700;\n}\n.page-btn[data-v-72e52e5b]:hover:not(:disabled) {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n  transform: translateY(-1px);\n}\n.page-btn[data-v-72e52e5b]:disabled {\n  opacity: 0.3;\n  cursor: not-allowed;\n}\n.page-info[data-v-72e52e5b] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding: 0 8px;\n  white-space: nowrap;\n}\n.total-count[data-v-72e52e5b] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin-left: 4px;\n}\n\n/* 品质色（轻量） */\n.q-凡[data-v-72e52e5b] {\n  border-color: rgba(128, 128, 128, 0.35);\n}\n.q-黄[data-v-72e52e5b] {\n  border-color: rgba(218, 165, 32, 0.45);\n}\n.q-玄[data-v-72e52e5b] {\n  border-color: rgba(147, 112, 219, 0.5);\n}\n.q-地[data-v-72e52e5b] {\n  border-color: rgba(0, 206, 209, 0.5);\n}\n.q-天[data-v-72e52e5b] {\n  border-color: rgba(255, 105, 180, 0.5);\n}\n.q-仙[data-v-72e52e5b] {\n  border-color: rgba(255, 215, 0, 0.6);\n}\n.q-神[data-v-72e52e5b] {\n  border-color: rgba(153, 50, 204, 0.6);\n}\n.modal-overlay[data-v-72e52e5b] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n  padding: 16px;\n  animation: fadeIn-72e52e5b 0.3s ease;\n}\n@keyframes fadeIn-72e52e5b {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n.modal[data-v-72e52e5b] {\n  width: 100%;\n  max-width: 720px;\n  max-height: 80vh;\n  overflow: hidden;\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 20px;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: slideUp-72e52e5b 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n@keyframes slideUp-72e52e5b {\nfrom {\n    opacity: 0;\n    transform: translateY(20px) scale(0.95);\n}\nto {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n}\n.modal-header[data-v-72e52e5b] {\n  padding: 16px 20px;\n  border-bottom: 2px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  background: linear-gradient(135deg, var(--color-surface), var(--color-surface-light));\n}\n.modal-title[data-v-72e52e5b] {\n  font-weight: 900;\n  font-size: 1.15rem;\n  color: var(--color-text);\n  background: linear-gradient(135deg, var(--color-primary), rgba(var(--color-primary-rgb), 0.7));\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n.icon-btn[data-v-72e52e5b] {\n  border: none;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  border-radius: 10px;\n  padding: 8px;\n  transition: all 0.3s ease;\n}\n.icon-btn[data-v-72e52e5b]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  transform: scale(1.1);\n}\n.modal-body[data-v-72e52e5b] {\n  padding: 20px;\n  overflow: auto;\n  min-height: 0;\n}\n.result-summary[data-v-72e52e5b] {\n  display: grid;\n  gap: 10px;\n  padding: 16px 18px;\n  border: 2px solid var(--color-border);\n  border-radius: 16px;\n  background: linear-gradient(135deg, var(--color-surface-light), var(--color-surface));\n  margin-bottom: 16px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n}\n.summary-row[data-v-72e52e5b] {\n  display: grid;\n  grid-template-columns: 100px 1fr;\n  gap: 12px;\n  align-items: baseline;\n}\n.summary-row .k[data-v-72e52e5b] {\n  color: var(--color-text-secondary);\n  font-weight: 800;\n  font-size: 0.9rem;\n}\n.summary-row .v[data-v-72e52e5b] {\n  color: var(--color-text);\n  font-weight: 700;\n}\n.summary-desc[data-v-72e52e5b] {\n  white-space: pre-wrap;\n  line-height: 1.6;\n  font-weight: 600;\n}\n.narrative[data-v-72e52e5b] {\n  padding: 16px;\n  border-radius: 14px;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.05), rgba(var(--color-primary-rgb), 0.02));\n  border: 1px solid rgba(var(--color-primary-rgb), 0.15);\n}\n.narrative-title[data-v-72e52e5b] {\n  font-weight: 900;\n  font-size: 1.05rem;\n  color: var(--color-text);\n  margin-bottom: 10px;\n}\n.narrative-text[data-v-72e52e5b] {\n  white-space: pre-wrap;\n  line-height: 1.7;\n  color: var(--color-text);\n  font-size: 0.95rem;\n}\n.modal-footer[data-v-72e52e5b] {\n  padding: 16px 20px;\n  border-top: 2px solid var(--color-border);\n  display: flex;\n  justify-content: flex-end;\n  background: linear-gradient(135deg, var(--color-surface-light), var(--color-surface));\n}\n.modal-footer.modal-footer-split[data-v-72e52e5b] {\n  justify-content: space-between;\n  gap: 12px;\n}\n@media (max-width: 980px) {\n.content[data-v-72e52e5b] {\n    grid-template-columns: 1fr;\n    overflow-y: auto;\n}\n.crafting-area[data-v-72e52e5b] {\n    max-height: none;\n}\n.craft-grid[data-v-72e52e5b] {\n    gap: 10px;\n    padding: 10px;\n}\n.materials-header[data-v-72e52e5b] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.materials-tools[data-v-72e52e5b] {\n    max-width: 100%;\n}\n}\n@media (max-width: 520px) {\n.toolbar[data-v-72e52e5b] {\n    flex-wrap: wrap;\n    padding: 10px 12px;\n}\n.toolbar-actions[data-v-72e52e5b] {\n    flex-wrap: wrap;\n    width: 100%;\n}\n.toolbar-actions span[data-v-72e52e5b] {\n    display: none;\n}\n.simulation-toggle[data-v-72e52e5b] {\n    flex: 1;\n    min-width: 0;\n}\n.content[data-v-72e52e5b] {\n    padding: 10px;\n    gap: 12px;\n}\n.crafting-area[data-v-72e52e5b] {\n    flex-shrink: 0;\n}\n.craft-grid[data-v-72e52e5b] {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    grid-auto-rows: minmax(60px, auto);\n    gap: 8px;\n    padding: 10px;\n}\n.slot[data-v-72e52e5b] {\n    min-height: 60px;\n    padding: 8px;\n}\n.slot-index[data-v-72e52e5b] {\n    font-size: 0.9rem;\n}\n.slot-hint[data-v-72e52e5b] {\n    font-size: 0.7rem;\n}\n.slot-item-name[data-v-72e52e5b] {\n    font-size: 0.75rem;\n}\n.slot-item-meta[data-v-72e52e5b] {\n    margin-top: 4px;\n    gap: 4px;\n}\n.slot-item-meta .meta-pill[data-v-72e52e5b] {\n    font-size: 0.65rem;\n    padding: 2px 4px;\n}\n.furnace-cell[data-v-72e52e5b] {\n    min-height: 60px;\n    padding: 8px;\n}\n.furnace-cell .furnace-icon[data-v-72e52e5b] {\n    width: 36px;\n    height: 36px;\n}\n.options[data-v-72e52e5b] {\n    padding: 12px;\n    gap: 10px;\n}\n.option[data-v-72e52e5b] {\n    padding: 10px;\n}\n.option-title[data-v-72e52e5b] {\n    font-size: 0.85rem;\n    margin-bottom: 6px;\n}\n.range-row[data-v-72e52e5b] {\n    gap: 4px;\n}\n.range-meta[data-v-72e52e5b] {\n    align-items: flex-start;\n    min-width: 0;\n}\n.range-hint[data-v-72e52e5b] {\n    white-space: normal;\n    font-size: 0.7rem;\n}\n.actions[data-v-72e52e5b] {\n    padding: 12px;\n    gap: 8px;\n}\n.primary-btn[data-v-72e52e5b],\n  .secondary-btn[data-v-72e52e5b] {\n    padding: 10px 12px;\n    font-size: 0.85rem;\n}\n.summary-row[data-v-72e52e5b] {\n    grid-template-columns: 80px 1fr;\n}\n.materials-header[data-v-72e52e5b] {\n    padding: 8px;\n}\n.materials-title[data-v-72e52e5b] {\n    font-size: 0.9rem;\n}\n.materials-list[data-v-72e52e5b] {\n    padding: 10px;\n    gap: 8px;\n}\n.material[data-v-72e52e5b] {\n    padding: 8px 10px;\n    min-height: 56px;\n}\n.material-right[data-v-72e52e5b] {\n    gap: 8px;\n}\n.page-info[data-v-72e52e5b] {\n    font-size: 0.75rem;\n}\n.total-count[data-v-72e52e5b] {\n    display: none;\n}\n}\n",""]);const s=i},4961:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.game-view[data-v-5bc506f3] {\n  width: 100%;\n  height: 100%;\n  background: var(--color-background);\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n  font-size: 14px;\n  display: grid;\n  grid-template-rows: auto 1fr;\n  overflow: hidden;\n}\n.game-content[data-v-5bc506f3] {\n  flex: 1;\n  display: flex;\n  align-items: stretch;\n  gap: 0;\n  padding: 0;\n  position: relative;\n  min-height: 0;\n  background: var(--color-background);\n}\n.left-sidebar[data-v-5bc506f3] {\n  width: 240px;\n  min-width: 240px;\n  background: var(--color-surface);\n  transition: all 0.3s ease;\n  z-index: 10;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.left-sidebar.collapsed[data-v-5bc506f3] {\n  width: 0;\n  min-width: 0;\n  overflow: hidden;\n}\n.right-panel-area[data-v-5bc506f3] {\n  width: 260px;\n  background: var(--color-surface);\n  transition: all 0.3s ease;\n  border-left: 1px solid var(--color-border);\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: column;\n}\n.right-panel-area.collapsed[data-v-5bc506f3] {\n  width: 0;\n  overflow: hidden;\n}\n.sidebar-wrapper[data-v-5bc506f3] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow-x: visible; /* 防止边框被截断 */\n}\n.main-content[data-v-5bc506f3] {\n  flex: 1;\n  background: var(--color-background);\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  position: relative;\n}\n\n/* 收缩按钮样式 */\n.collapse-btn[data-v-5bc506f3] {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 20px;\n  height: 40px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  transition: all 0.3s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 20;\n  color: var(--color-text-secondary);\n  padding: 0;\n}\n.collapse-btn[data-v-5bc506f3]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n\n/* 左侧收缩按钮 */\n.collapse-btn.left[data-v-5bc506f3] {\n  left: 240px;\n  border-radius: 0 6px 6px 0;\n  border-left: none;\n  transition: left 0.3s ease, background 0.2s ease;\n}\n\n/* 左侧栏收缩时，按钮移动到最左侧 */\n.collapse-btn.left.collapsed[data-v-5bc506f3] {\n  left: 0;\n  border-left: 1px solid var(--color-border);\n}\n\n/* 右侧收缩按钮 */\n.collapse-btn.right[data-v-5bc506f3] {\n  right: 260px;\n  border-radius: 6px 0 0 6px;\n  border-right: none;\n  transition: right 0.3s ease, background 0.2s ease;\n}\n\n/* 右侧栏收缩时，按钮移动到最右侧 */\n.right-panel-area.collapsed ~ .collapse-btn.right[data-v-5bc506f3],\n.collapse-btn.right.collapsed[data-v-5bc506f3] {\n  right: 0;\n  border-right: 1px solid var(--color-border);\n}\n\n/* 面板覆盖模式样式 - 只隐藏右侧栏，保留左侧栏 */\n.game-content.panel-mode .right-panel-area[data-v-5bc506f3] {\n  display: none;\n}\n.game-content.panel-mode .collapse-btn.right[data-v-5bc506f3] {\n  display: none;\n}\n.panel-overlay[data-v-5bc506f3] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  z-index: 100;\n}\n.panel-header[data-v-5bc506f3] { position: relative; display: flex; align-items: center; gap: 8px; padding: 6px 12px; min-height: 30px; height: auto; background: transparent; border-bottom: none; flex-shrink: 0;\n}\n.panel-header[data-v-5bc506f3]::after { content: \'\'; position: absolute; left: 8px; right: 8px; bottom: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(var(--color-primary-rgb,46,92,184), .35), transparent);\n}\n.panel-header.compact[data-v-5bc506f3]::after {\n  content: \'\';\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 2px;\n  background: linear-gradient(90deg, transparent, var(--color-primary), transparent);\n  opacity: 0.25;\n}\n.panel-title-icon[data-v-5bc506f3] { color: var(--color-primary); flex-shrink: 0;\n}\n.panel-title-compact[data-v-5bc506f3] { display: flex; align-items: center; gap: 8px; min-width: 0; flex: 1; justify-content: center;\n}\n.panel-title-compact .title-text[data-v-5bc506f3] { font-size: 0.92rem; font-weight: 600; color: var(--color-text); letter-spacing: 0.2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\n}\n.back-btn[data-v-5bc506f3] { background: transparent; border: none; padding: 2px 6px; border-radius: 4px; color: var(--color-text-secondary); cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center;\n}\n.back-btn[data-v-5bc506f3]:hover { background: var(--color-surface-hover); color: var(--color-text);\n}\n.panel-actions[data-v-5bc506f3] { margin-left: auto; display: flex; align-items: center; gap: 4px;\n}\n.action-btn-compact[data-v-5bc506f3] { background: transparent; border: none; width: 26px; height: 26px; border-radius: 4px; color: var(--color-text-secondary); display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition-fast);\n}\n.action-btn-compact[data-v-5bc506f3]:hover { background: var(--color-surface-hover); color: var(--color-text);\n}\n.panel-content[data-v-5bc506f3] {\n  flex: 1;\n  min-height: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  display: flex;\n  flex-direction: column;\n  padding: 12px;\n  background: transparent;\n  -webkit-overflow-scrolling: touch;\n}\n.panel-shell[data-v-5bc506f3] {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.98), rgba(var(--color-surface-rgb), 0.92));\n  border: 1px solid rgba(var(--color-border-rgb), 0.55);\n  border-radius: 18px;\n  box-shadow: 0 16px 36px rgba(0, 0, 0, 0.08);\n  overflow: hidden;\n}\n.panel-header.compact[data-v-5bc506f3] { padding: 6px 10px; position: sticky; top: 0; z-index: 2; background: var(--color-background);\n}\n.panel-content.compact[data-v-5bc506f3] { padding: 8px 10px 10px 10px;\n}\n\n/* 数据加载提示样式 */\n.data-loading[data-v-5bc506f3] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, var(--color-background) 0%, var(--color-surface) 100%);\n  position: relative;\n  overflow: hidden;\n}\n.data-loading[data-v-5bc506f3]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: radial-gradient(circle at 50% 50%, rgba(var(--color-primary-rgb, 46, 92, 184), 0.05) 0%, transparent 70%);\n  animation: pulse-5bc506f3 3s ease-in-out infinite;\n}\n.loading-content[data-v-5bc506f3] {\n  text-align: center;\n  padding: 60px 40px;\n  max-width: 500px;\n  position: relative;\n  z-index: 1;\n}\n.loading-spinner-wrapper[data-v-5bc506f3] {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  margin: 0 auto 32px;\n}\n.loading-spinner[data-v-5bc506f3] {\n  width: 80px;\n  height: 80px;\n  border: 3px solid transparent;\n  border-top: 3px solid var(--color-primary);\n  border-right: 3px solid var(--color-primary);\n  border-radius: 50%;\n  animation: spin-5bc506f3 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;\n  position: relative;\n}\n.spinner-glow[data-v-5bc506f3] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(var(--color-primary-rgb, 46, 92, 184), 0.3) 0%, transparent 70%);\n  animation: glow-5bc506f3 2s ease-in-out infinite;\n}\n@keyframes spin-5bc506f3 {\n0% { transform: rotate(0deg);\n}\n100% { transform: rotate(360deg);\n}\n}\n@keyframes glow-5bc506f3 {\n0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.9);\n}\n50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1);\n}\n}\n@keyframes pulse-5bc506f3 {\n0%, 100% { opacity: 0.5;\n}\n50% { opacity: 1;\n}\n}\n.loading-title[data-v-5bc506f3] {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin: 0 0 12px 0;\n  letter-spacing: 2px;\n  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n.loading-message[data-v-5bc506f3] {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 32px 0;\n  font-weight: 500;\n}\n.loading-steps[data-v-5bc506f3] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  margin-bottom: 32px;\n  text-align: left;\n}\n.loading-step[data-v-5bc506f3] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 10px 16px;\n  background: var(--color-background);\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  transition: all 0.3s ease;\n}\n.loading-step.active[data-v-5bc506f3] {\n  background: rgba(var(--color-primary-rgb, 46, 92, 184), 0.1);\n  border-color: var(--color-primary);\n}\n.step-icon[data-v-5bc506f3] {\n  font-size: 1.2rem;\n  font-weight: bold;\n  color: var(--color-success);\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n.loading-step.active .step-icon[data-v-5bc506f3] {\n  color: var(--color-primary);\n  animation: bounce-5bc506f3 1s ease-in-out infinite;\n}\n@keyframes bounce-5bc506f3 {\n0%, 100% { transform: translateY(0);\n}\n50% { transform: translateY(-4px);\n}\n}\n.step-text[data-v-5bc506f3] {\n  font-size: 0.95rem;\n  color: var(--color-text);\n  font-weight: 500;\n}\n.loading-hint[data-v-5bc506f3] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  margin: 0;\n  padding: 12px 20px;\n  background: var(--color-background);\n  border-radius: 8px;\n  border-left: 3px solid var(--color-primary);\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.game-view[data-v-5bc506f3] {\n    font-size: 13px;\n}\n\n  /* 移动端侧边栏浮动显示，不占用主内容空间 */\n.left-sidebar[data-v-5bc506f3] {\n    position: fixed;\n    top: 0; /* 从顶部开始 */\n    left: 0;\n    bottom: 0;\n    height: 100%;\n    width: 280px;\n    z-index: 1000;\n    transform: translateX(-100%);\n    transition: transform 0.3s ease;\n    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);\n    overflow: hidden;\n    background: var(--color-surface); /* 和右侧栏一样的背景色 */\n}\n.left-sidebar[data-v-5bc506f3]:not(.collapsed) {\n    transform: translateX(0);\n}\n.left-sidebar .sidebar-wrapper[data-v-5bc506f3] {\n    overflow-y: auto;\n    overflow-x: visible;\n    height: 100%;\n    -webkit-overflow-scrolling: touch;\n    box-sizing: border-box;\n    padding-right: 2px; /* 防止边框被截断 */\n}\n.right-panel-area[data-v-5bc506f3] {\n    position: fixed;\n    top: 0; /* 从顶部开始 */\n    right: 0;\n    bottom: 0;\n    height: 100%;\n    width: 260px;\n    z-index: 1000;\n    transform: translateX(100%);\n    transition: transform 0.3s ease;\n    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);\n    overflow: hidden;\n    background: var(--color-surface); /* 和左侧栏一样的背景色 */\n}\n.right-panel-area[data-v-5bc506f3]:not(.collapsed) {\n    transform: translateX(0);\n}\n.right-panel-area .sidebar-wrapper[data-v-5bc506f3] {\n    overflow-y: auto;\n    overflow-x: hidden;\n    height: 100%;\n    -webkit-overflow-scrolling: touch;\n    box-sizing: border-box;\n}\n\n  /* 移动端背景遮罩层 */\n.mobile-sidebar-overlay[data-v-5bc506f3] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 999; /* Below sidebars (1000) but above everything else */\n}\n\n  /* 移动端收缩按钮样式 - 参考电脑版样式 */\n.collapse-btn[data-v-5bc506f3] {\n    position: fixed;\n    z-index: 1001;\n    width: 20px;\n    height: 44px;\n    background: var(--color-surface);\n    border: 1px solid var(--color-border);\n    color: var(--color-text-secondary);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    touch-action: manipulation;\n    top: 50%;\n    transform: translateY(-50%);\n    transition: all 0.3s ease;\n}\n.collapse-btn svg[data-v-5bc506f3] {\n    width: 14px;\n    height: 14px;\n}\n.collapse-btn[data-v-5bc506f3]:active {\n    background: var(--color-surface-light);\n    color: var(--color-text);\n}\n\n  /* 左侧按钮：默认在左边缘，跟随侧边栏一起移动 */\n.collapse-btn.left[data-v-5bc506f3] {\n    left: 0;\n    border-radius: 0 8px 8px 0;\n    border-left: none;\n    transform: translateX(0) translateY(-50%);\n    transition: transform 0.3s ease, background 0.2s ease;\n}\n\n  /* 左侧栏展开时，按钮跟随移动 260px */\n.left-sidebar:not(.collapsed) ~ .collapse-btn.left[data-v-5bc506f3] {\n    transform: translateX(260px) translateY(-50%);\n}\n\n  /* 右侧按钮：默认在右边缘，跟随侧边栏一起移动 */\n.collapse-btn.right[data-v-5bc506f3] {\n    right: 0;\n    border-radius: 8px 0 0 8px;\n    border-right: none;\n    transform: translateX(0) translateY(-50%);\n    transition: transform 0.3s ease, background 0.2s ease;\n}\n\n  /* 右侧栏展开时（按钮没有 collapsed 类），按钮跟随移动 -260px */\n.collapse-btn.right[data-v-5bc506f3]:not(.collapsed) {\n    transform: translateX(-260px) translateY(-50%);\n}\n\n  /* 主内容区域占满屏幕 */\n.main-content[data-v-5bc506f3] {\n    width: 100%;\n    max-width: 100vw;\n    margin: 0;\n    padding: 0;\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    box-sizing: border-box;\n}\n.game-content[data-v-5bc506f3] {\n    gap: 0;\n    margin-top: 0;\n    max-width: 100vw;\n    overflow-x: hidden;\n    box-sizing: border-box;\n}\n.game-view[data-v-5bc506f3] {\n    max-width: 100vw;\n    overflow-x: hidden;\n}\n\n  /* 移动端面板全屏优化 */\n.panel-overlay[data-v-5bc506f3] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 999;\n    overflow: hidden;\n}\n\n  /* 面板头部移动端优化 */\n.panel-header[data-v-5bc506f3] {\n    padding: 4px 8px;\n    min-height: 36px;\n    flex-wrap: nowrap;\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n.panel-header.compact[data-v-5bc506f3] {\n    padding: 4px 8px;\n}\n.panel-title-compact .title-text[data-v-5bc506f3] {\n    font-size: 0.85rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n  /* 头部按钮触摸优化 */\n.back-btn[data-v-5bc506f3],\n  .action-btn-compact[data-v-5bc506f3] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    min-width: 32px;\n    min-height: 32px;\n}\n\n  /* 面板内容移动端优化 - 确保文本区域能够收缩 */\n.panel-content[data-v-5bc506f3] {\n    padding: 8px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n}\n.panel-content.compact[data-v-5bc506f3] {\n    padding: 6px 8px 8px 8px;\n}\n.panel-shell[data-v-5bc506f3] {\n    border-radius: 14px;\n    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);\n    overflow: auto;\n}\n\n  /* 确保面板内所有文本元素自动换行 */\n.panel-content[data-v-5bc506f3] *,\n  .panel-overlay[data-v-5bc506f3] * {\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    max-width: 100%;\n}\n\n  /* 数据加载提示移动端优化 */\n.data-loading[data-v-5bc506f3] {\n    padding: 8px;\n}\n.loading-content[data-v-5bc506f3] {\n    padding: 40px 20px;\n    max-width: 100%;\n}\n.loading-title[data-v-5bc506f3] {\n    font-size: 1.2rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n.loading-message[data-v-5bc506f3] {\n    font-size: 0.9rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n.loading-steps[data-v-5bc506f3] {\n    gap: 8px;\n}\n.loading-step[data-v-5bc506f3] {\n    padding: 8px 12px;\n}\n.step-text[data-v-5bc506f3] {\n    font-size: 0.85rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n.loading-hint[data-v-5bc506f3] {\n    font-size: 0.8rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n}\n\n/* ========== 深色玻璃拟态风格适配 ========== */\n[data-theme="dark"] .game-view[data-v-5bc506f3] {\n  background: rgb(30, 41, 59);\n}\n[data-theme="dark"] .game-content[data-v-5bc506f3] {\n  background: rgb(30, 41, 59);\n}\n[data-theme="dark"] .left-sidebar[data-v-5bc506f3],\n[data-theme="dark"] .right-panel-area[data-v-5bc506f3] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n}\n[data-theme="dark"] .main-content[data-v-5bc506f3] {\n  background: rgb(30, 41, 59);\n}\n[data-theme="dark"] .collapse-btn[data-v-5bc506f3] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme="dark"] .collapse-btn[data-v-5bc506f3]:hover {\n  background: rgba(51, 65, 85, 0.95);\n  color: #f1f5f9;\n  border-color: rgba(147, 197, 253, 0.3);\n}\n[data-theme="dark"] .panel-overlay[data-v-5bc506f3] {\n  background: var(--color-background);\n  backdrop-filter: blur(20px);\n}\n[data-theme="dark"] .panel-header[data-v-5bc506f3] {\n  background: rgba(30, 41, 59, 0.8);\n}\n[data-theme="dark"] .panel-header[data-v-5bc506f3]::after {\n  background: linear-gradient(90deg, transparent, rgba(147, 197, 253, 0.4), transparent);\n}\n[data-theme="dark"] .back-btn[data-v-5bc506f3] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .back-btn[data-v-5bc506f3]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n}\n[data-theme="dark"] .panel-title-compact .title-text[data-v-5bc506f3] {\n  color: #f1f5f9;\n}\n[data-theme="dark"] .panel-title-icon[data-v-5bc506f3] {\n  color: #93c5fd;\n}\n[data-theme="dark"] .action-btn-compact[data-v-5bc506f3] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .action-btn-compact[data-v-5bc506f3]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n}\n[data-theme="dark"] .data-loading[data-v-5bc506f3] {\n  background: rgba(30, 41, 59, 0.95);\n}\n[data-theme="dark"] .data-loading[data-v-5bc506f3]::before {\n  background: radial-gradient(circle at 50% 50%, rgba(147, 197, 253, 0.08) 0%, transparent 70%);\n}\n[data-theme="dark"] .loading-title[data-v-5bc506f3] {\n  background: linear-gradient(135deg, #93c5fd 0%, #c0caf5 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .loading-message[data-v-5bc506f3] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .loading-step[data-v-5bc506f3] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme="dark"] .loading-step.active[data-v-5bc506f3] {\n  background: rgba(59, 130, 246, 0.15);\n  border-color: rgba(147, 197, 253, 0.4);\n}\n[data-theme="dark"] .step-icon[data-v-5bc506f3] {\n  color: #9ece6a;\n}\n[data-theme="dark"] .loading-step.active .step-icon[data-v-5bc506f3] {\n  color: #93c5fd;\n}\n[data-theme="dark"] .step-text[data-v-5bc506f3] {\n  color: #e2e8f0;\n}\n[data-theme="dark"] .loading-hint[data-v-5bc506f3] {\n  background: rgba(30, 41, 59, 0.6);\n  border-left-color: #93c5fd;\n  color: #94a3b8;\n}\n[data-theme="dark"] .spinner-glow[data-v-5bc506f3] {\n  background: radial-gradient(circle, rgba(147, 197, 253, 0.4) 0%, transparent 70%);\n}\n[data-theme="dark"] .loading-spinner[data-v-5bc506f3] {\n  border-top-color: #93c5fd;\n  border-right-color: #93c5fd;\n}\n\n/* 超小屏幕适配 */\n@media (max-width: 480px) {\n.game-view[data-v-5bc506f3] {\n    font-size: 12px;\n}\n.left-sidebar[data-v-5bc506f3] {\n    width: 260px;\n}\n\n  /* 左侧栏展开时，按钮跟随移动 260px（匹配侧边栏宽度） */\n.left-sidebar:not(.collapsed) ~ .collapse-btn.left[data-v-5bc506f3] {\n    transform: translateX(260px) translateY(-50%);\n}\n.right-panel-area[data-v-5bc506f3] {\n    width: 220px;\n}\n\n  /* 右侧栏展开时，按钮跟随移动 -220px（匹配侧边栏宽度） */\n.collapse-btn.right[data-v-5bc506f3]:not(.collapsed) {\n    transform: translateX(-220px) translateY(-50%);\n}\n\n  /* 小屏幕上面板全屏显示 */\n.panel-overlay[data-v-5bc506f3] {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 999;\n}\n.panel-header[data-v-5bc506f3] {\n    padding: 3px 6px;\n    min-height: 32px;\n}\n.panel-title-compact .title-text[data-v-5bc506f3] {\n    font-size: 0.8rem;\n}\n.panel-content[data-v-5bc506f3] {\n    padding: 6px;\n    font-size: 0.9em;\n}\n.panel-shell[data-v-5bc506f3] {\n    border-radius: 12px;\n    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.08);\n}\n.loading-title[data-v-5bc506f3] {\n    font-size: 1rem;\n}\n.loading-message[data-v-5bc506f3] {\n    font-size: 0.85rem;\n}\n.step-text[data-v-5bc506f3] {\n    font-size: 0.8rem;\n}\n.loading-hint[data-v-5bc506f3] {\n    font-size: 0.75rem;\n}\n}\n',""]);const s=i},4965:(e,n,t)=>{"use strict";t.d(n,{sC:()=>ce,aE:()=>ze,lq:()=>$e,rd:()=>Ne});const a="undefined"!=typeof document;function r(e){return"object"==typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}const o=Object.assign;function i(e,n){const t={};for(const a in n){const r=n[a];t[a]=l(r)?r.map(e):e(r)}return t}const s=()=>{},l=Array.isArray;function c(e,n){const t={};for(const a in e)t[a]=a in n?n[a]:e[a];return t}const d=/#/g,u=/&/g,p=/\//g,v=/=/g,f=/\?/g,h=/\+/g,m=/%5B/g,g=/%5D/g,b=/%5E/g,y=/%60/g,x=/%7B/g,k=/%7C/g,w=/%7D/g,_=/%20/g;function C(e){return null==e?"":encodeURI(""+e).replace(k,"|").replace(m,"[").replace(g,"]")}function A(e){return C(e).replace(h,"%2B").replace(_,"+").replace(d,"%23").replace(u,"%26").replace(y,"`").replace(x,"{").replace(w,"}").replace(b,"^")}function S(e){return A(e).replace(v,"%3D")}function L(e){return function(e){return C(e).replace(d,"%23").replace(f,"%3F")}(e).replace(p,"%2F")}function E(e){if(null==e)return null;try{return decodeURIComponent(""+e)}catch(e){}return""+e}const T=/\/$/,I=e=>e.replace(T,"");function R(e,n,t="/"){let a,r={},o="",i="";const s=n.indexOf("#");let l=n.indexOf("?");return l=s>=0&&l>s?-1:l,l>=0&&(a=n.slice(0,l),o=n.slice(l,s>0?s:n.length),r=e(o.slice(1))),s>=0&&(a=a||n.slice(0,s),i=n.slice(s,n.length)),a=function(e,n){if(e.startsWith("/"))return e;if(!e)return n;const t=n.split("/"),a=e.split("/"),r=a[a.length-1];".."!==r&&"."!==r||a.push("");let o,i,s=t.length-1;for(o=0;o<a.length;o++)if(i=a[o],"."!==i){if(".."!==i)break;s>1&&s--}return t.slice(0,s).join("/")+"/"+a.slice(o).join("/")}(null!=a?a:n,t),{fullPath:a+o+i,path:a,query:r,hash:E(i)}}function M(e,n){return(e.aliasOf||e)===(n.aliasOf||n)}function P(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var t in e)if(!D(e[t],n[t]))return!1;return!0}function D(e,n){return l(e)?z(e,n):l(n)?z(n,e):e?.valueOf()===n?.valueOf()}function z(e,n){return l(n)?e.length===n.length&&e.every((e,t)=>e===n[t]):1===e.length&&e[0]===n}const N={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let $=function(e){return e.pop="pop",e.push="push",e}({}),O=function(e){return e.back="back",e.forward="forward",e.unknown="",e}({});const F="",j=/^[^#]+#/;function B(e,n){return e.replace(j,"#")+n}const X=()=>({left:window.scrollX,top:window.scrollY});function U(e,n){return(history.state?history.state.position-n:-1)+e}const W=new Map;function q(e){return"string"==typeof e||"symbol"==typeof e}let G=function(e){return e[e.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",e[e.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",e[e.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",e[e.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",e[e.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",e}({});const H=Symbol("");function V(e,n){return o(new Error,{type:e,[H]:!0},n)}function Q(e,n){return e instanceof Error&&H in e&&(null==n||!!(e.type&n))}G.MATCHER_NOT_FOUND,G.NAVIGATION_GUARD_REDIRECT,G.NAVIGATION_ABORTED,G.NAVIGATION_CANCELLED,G.NAVIGATION_DUPLICATED;function K(e){const n={};if(""===e||"?"===e)return n;const t=("?"===e[0]?e.slice(1):e).split("&");for(let e=0;e<t.length;++e){const a=t[e].replace(h," "),r=a.indexOf("="),o=E(r<0?a:a.slice(0,r)),i=r<0?null:E(a.slice(r+1));if(o in n){let e=n[o];l(e)||(e=n[o]=[e]),e.push(i)}else n[o]=i}return n}function Y(e){let n="";for(let t in e){const a=e[t];t=S(t),null!=a?(l(a)?a.map(e=>e&&A(e)):[a&&A(a)]).forEach(e=>{void 0!==e&&(n+=(n.length?"&":"")+t,null!=e&&(n+="="+e))}):void 0!==a&&(n+=(n.length?"&":"")+t)}return n}function J(e){const n={};for(const t in e){const a=e[t];void 0!==a&&(n[t]=l(a)?a.map(e=>null==e?null:""+e):null==a?a:""+a)}return n}const Z=Symbol(""),ee=Symbol(""),ne=Symbol(""),te=Symbol(""),ae=Symbol("");function re(){let e=[];return{add:function(n){return e.push(n),()=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)}},list:()=>e.slice(),reset:function(){e=[]}}}function oe(e,n,t,a,r,o=e=>e()){const i=a&&(a.enterCallbacks[r]=a.enterCallbacks[r]||[]);return()=>new Promise((s,l)=>{const c=e=>{var o;!1===e?l(V(G.NAVIGATION_ABORTED,{from:t,to:n})):e instanceof Error?l(e):"string"==typeof(o=e)||o&&"object"==typeof o?l(V(G.NAVIGATION_GUARD_REDIRECT,{from:n,to:e})):(i&&a.enterCallbacks[r]===i&&"function"==typeof e&&i.push(e),s())},d=o(()=>e.call(a&&a.instances[r],n,t,c));let u=Promise.resolve(d);e.length<3&&(u=u.then(c)),u.catch(e=>l(e))})}function ie(e,n,t,a,o=e=>e()){const i=[];for(const s of e)for(const e in s.components){let l=s.components[e];if("beforeRouteEnter"===n||s.instances[e])if(r(l)){const r=(l.__vccOpts||l)[n];r&&i.push(oe(r,t,a,s,e,o))}else{let c=l();i.push(()=>c.then(i=>{if(!i)throw new Error(`Couldn't resolve component "${e}" at "${s.path}"`);const l=(c=i).__esModule||"Module"===c[Symbol.toStringTag]||c.default&&r(c.default)?i.default:i;var c;s.mods[e]=i,s.components[e]=l;const d=(l.__vccOpts||l)[n];return d&&oe(d,t,a,s,e,o)()}))}}return i}var se=t(641),le=t(953);function ce(e=""){let n=[],t=[[F,{}]],r=0;function o(e,n={}){r++,r!==t.length&&t.splice(r),t.push([e,n])}e=function(e){if(!e)if(a){const n=document.querySelector("base");e=(e=n&&n.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),I(e)}(e);const i={location:F,state:{},base:e,createHref:B.bind(null,e),replace(e,n){t.splice(r--,1),o(e,n)},push(e,n){o(e,n)},listen:e=>(n.push(e),()=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)}),destroy(){n=[],t=[[F,{}]],r=0},go(e,a=!0){const o=this.location,i=e<0?O.back:O.forward;r=Math.max(0,Math.min(r+e,t.length-1)),a&&function(e,t,{direction:a,delta:r}){const o={direction:a,delta:r,type:$.pop};for(const a of n)a(e,t,o)}(this.location,o,{direction:i,delta:e})}};return Object.defineProperty(i,"location",{enumerable:!0,get:()=>t[r][0]}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>t[r][1]}),i}let de=function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.Group=2]="Group",e}({});var ue=function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.ParamRegExp=2]="ParamRegExp",e[e.ParamRegExpEnd=3]="ParamRegExpEnd",e[e.EscapeNext=4]="EscapeNext",e}(ue||{});const pe={type:de.Static,value:""},ve=/[a-zA-Z0-9_]/,fe="[^/]+?",he={sensitive:!1,strict:!1,start:!0,end:!0};var me=function(e){return e[e._multiplier=10]="_multiplier",e[e.Root=90]="Root",e[e.Segment=40]="Segment",e[e.SubSegment=30]="SubSegment",e[e.Static=40]="Static",e[e.Dynamic=20]="Dynamic",e[e.BonusCustomRegExp=10]="BonusCustomRegExp",e[e.BonusWildcard=-50]="BonusWildcard",e[e.BonusRepeatable=-20]="BonusRepeatable",e[e.BonusOptional=-8]="BonusOptional",e[e.BonusStrict=.7000000000000001]="BonusStrict",e[e.BonusCaseSensitive=.25]="BonusCaseSensitive",e}(me||{});const ge=/[.+*?^${}()[\]/\\]/g;function be(e,n){let t=0;for(;t<e.length&&t<n.length;){const a=n[t]-e[t];if(a)return a;t++}return e.length<n.length?1===e.length&&e[0]===me.Static+me.Segment?-1:1:e.length>n.length?1===n.length&&n[0]===me.Static+me.Segment?1:-1:0}function ye(e,n){let t=0;const a=e.score,r=n.score;for(;t<a.length&&t<r.length;){const e=be(a[t],r[t]);if(e)return e;t++}if(1===Math.abs(r.length-a.length)){if(xe(a))return 1;if(xe(r))return-1}return r.length-a.length}function xe(e){const n=e[e.length-1];return e.length>0&&n[n.length-1]<0}const ke={strict:!1,end:!0,sensitive:!1};function we(e,n,t){const a=function(e,n){const t=o({},he,n),a=[];let r=t.start?"^":"";const i=[];for(const n of e){const e=n.length?[]:[me.Root];t.strict&&!n.length&&(r+="/");for(let a=0;a<n.length;a++){const o=n[a];let s=me.Segment+(t.sensitive?me.BonusCaseSensitive:0);if(o.type===de.Static)a||(r+="/"),r+=o.value.replace(ge,"\\$&"),s+=me.Static;else if(o.type===de.Param){const{value:e,repeatable:t,optional:l,regexp:c}=o;i.push({name:e,repeatable:t,optional:l});const d=c||fe;d!==fe&&(s+=me.BonusCustomRegExp);let u=t?`((?:${d})(?:/(?:${d}))*)`:`(${d})`;a||(u=l&&n.length<2?`(?:/${u})`:"/"+u),l&&(u+="?"),r+=u,s+=me.Dynamic,l&&(s+=me.BonusOptional),t&&(s+=me.BonusRepeatable),".*"===d&&(s+=me.BonusWildcard)}e.push(s)}a.push(e)}if(t.strict&&t.end){const e=a.length-1;a[e][a[e].length-1]+=me.BonusStrict}t.strict||(r+="/?"),t.end?r+="$":t.strict&&!r.endsWith("/")&&(r+="(?:/|$)");const s=new RegExp(r,t.sensitive?"":"i");return{re:s,score:a,keys:i,parse:function(e){const n=e.match(s),t={};if(!n)return null;for(let e=1;e<n.length;e++){const a=n[e]||"",r=i[e-1];t[r.name]=a&&r.repeatable?a.split("/"):a}return t},stringify:function(n){let t="",a=!1;for(const r of e){a&&t.endsWith("/")||(t+="/"),a=!1;for(const e of r)if(e.type===de.Static)t+=e.value;else if(e.type===de.Param){const{value:o,repeatable:i,optional:s}=e,c=o in n?n[o]:"";if(l(c)&&!i)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const d=l(c)?c.join("/"):c;if(!d){if(!s)throw new Error(`Missing required param "${o}"`);r.length<2&&(t.endsWith("/")?t=t.slice(0,-1):a=!0)}t+=d}}return t||"/"}}}(function(e){if(!e)return[[]];if("/"===e)return[[pe]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function n(e){throw new Error(`ERR (${t})/"${c}": ${e}`)}let t=ue.Static,a=t;const r=[];let o;function i(){o&&r.push(o),o=[]}let s,l=0,c="",d="";function u(){c&&(t===ue.Static?o.push({type:de.Static,value:c}):t===ue.Param||t===ue.ParamRegExp||t===ue.ParamRegExpEnd?(o.length>1&&("*"===s||"+"===s)&&n(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),o.push({type:de.Param,value:c,regexp:d,repeatable:"*"===s||"+"===s,optional:"*"===s||"?"===s})):n("Invalid state to consume buffer"),c="")}function p(){c+=s}for(;l<e.length;)if(s=e[l++],"\\"!==s||t===ue.ParamRegExp)switch(t){case ue.Static:"/"===s?(c&&u(),i()):":"===s?(u(),t=ue.Param):p();break;case ue.EscapeNext:p(),t=a;break;case ue.Param:"("===s?t=ue.ParamRegExp:ve.test(s)?p():(u(),t=ue.Static,"*"!==s&&"?"!==s&&"+"!==s&&l--);break;case ue.ParamRegExp:")"===s?"\\"==d[d.length-1]?d=d.slice(0,-1)+s:t=ue.ParamRegExpEnd:d+=s;break;case ue.ParamRegExpEnd:u(),t=ue.Static,"*"!==s&&"?"!==s&&"+"!==s&&l--,d="";break;default:n("Unknown state")}else a=t,t=ue.EscapeNext;return t===ue.ParamRegExp&&n(`Unfinished custom RegExp for param "${c}"`),u(),i(),r}(e.path),t),r=o(a,{record:e,parent:n,children:[],alias:[]});return n&&!r.record.aliasOf==!n.record.aliasOf&&n.children.push(r),r}function _e(e,n){const t={};for(const a of n)a in e&&(t[a]=e[a]);return t}function Ce(e){const n={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:Ae(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(n,"mods",{value:{}}),n}function Ae(e){const n={},t=e.props||!1;if("component"in e)n.default=t;else for(const a in e.components)n[a]="object"==typeof t?t[a]:t;return n}function Se(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Le(e){return e.reduce((e,n)=>o(e,n.meta),{})}function Ee({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Te(e){const n=(0,se.WQ)(ne),t=(0,se.WQ)(te),a=(0,se.EW)(()=>{const t=(0,le.R1)(e.to);return n.resolve(t)}),r=(0,se.EW)(()=>{const{matched:e}=a.value,{length:n}=e,r=e[n-1],o=t.matched;if(!r||!o.length)return-1;const i=o.findIndex(M.bind(null,r));if(i>-1)return i;const s=Re(e[n-2]);return n>1&&Re(r)===s&&o[o.length-1].path!==s?o.findIndex(M.bind(null,e[n-2])):i}),o=(0,se.EW)(()=>r.value>-1&&function(e,n){for(const t in n){const a=n[t],r=e[t];if("string"==typeof a){if(a!==r)return!1}else if(!l(r)||r.length!==a.length||a.some((e,n)=>e.valueOf()!==r[n].valueOf()))return!1}return!0}(t.params,a.value.params)),i=(0,se.EW)(()=>r.value>-1&&r.value===t.matched.length-1&&P(t.params,a.value.params));return{route:a,href:(0,se.EW)(()=>a.value.href),isActive:o,isExactActive:i,navigate:function(t={}){if(function(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||e.defaultPrevented||void 0!==e.button&&0!==e.button)){if(e.currentTarget&&e.currentTarget.getAttribute){const n=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(n))return}return e.preventDefault&&e.preventDefault(),!0}}(t)){const t=n[(0,le.R1)(e.replace)?"replace":"push"]((0,le.R1)(e.to)).catch(s);return e.viewTransition&&"undefined"!=typeof document&&"startViewTransition"in document&&document.startViewTransition(()=>t),t}return Promise.resolve()}}}const Ie=(0,se.pM)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Te,setup(e,{slots:n}){const t=(0,le.Kh)(Te(e)),{options:a}=(0,se.WQ)(ne),r=(0,se.EW)(()=>({[Me(e.activeClass,a.linkActiveClass,"router-link-active")]:t.isActive,[Me(e.exactActiveClass,a.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const a=n.default&&(1===(o=n.default(t)).length?o[0]:o);var o;return e.custom?a:(0,se.h)("a",{"aria-current":t.isExactActive?e.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:r.value},a)}}});function Re(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Me=(e,n,t)=>null!=e?e:null!=n?n:t;function Pe(e,n){if(!e)return null;const t=e(n);return 1===t.length?t[0]:t}const De=(0,se.pM)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:n,slots:t}){const a=(0,se.WQ)(ae),r=(0,se.EW)(()=>e.route||a.value),i=(0,se.WQ)(ee,0),s=(0,se.EW)(()=>{let e=(0,le.R1)(i);const{matched:n}=r.value;let t;for(;(t=n[e])&&!t.components;)e++;return e}),l=(0,se.EW)(()=>r.value.matched[s.value]);(0,se.Gt)(ee,(0,se.EW)(()=>s.value+1)),(0,se.Gt)(Z,l),(0,se.Gt)(ae,r);const c=(0,le.KR)();return(0,se.wB)(()=>[c.value,l.value,e.name],([e,n,t],[a,r,o])=>{n&&(n.instances[t]=e,r&&r!==n&&e&&e===a&&(n.leaveGuards.size||(n.leaveGuards=r.leaveGuards),n.updateGuards.size||(n.updateGuards=r.updateGuards))),!e||!n||r&&M(n,r)&&a||(n.enterCallbacks[t]||[]).forEach(n=>n(e))},{flush:"post"}),()=>{const a=r.value,i=e.name,s=l.value,d=s&&s.components[i];if(!d)return Pe(t.default,{Component:d,route:a});const u=s.props[i],p=u?!0===u?a.params:"function"==typeof u?u(a):u:null,v=(0,se.h)(d,o({},p,n,{onVnodeUnmounted:e=>{e.component.isUnmounted&&(s.instances[i]=null)},ref:c}));return Pe(t.default,{Component:v,route:a})||v}}});function ze(e){const n=function(e,n){const t=[],a=new Map;function r(e,t,a){const d=!a,u=Ce(e);u.aliasOf=a&&a.record;const p=c(n,e),v=[u];if("alias"in e){const n="string"==typeof e.alias?[e.alias]:e.alias;for(const e of n)v.push(Ce(o({},u,{components:a?a.record.components:u.components,path:e,aliasOf:a?a.record:u})))}let f,h;for(const n of v){const{path:o}=n;if(t&&"/"!==o[0]){const e=t.record.path,a="/"===e[e.length-1]?"":"/";n.path=t.record.path+(o&&a+o)}if(f=we(n,t,p),a?a.alias.push(f):(h=h||f,h!==f&&h.alias.push(f),d&&e.name&&!Se(f)&&i(e.name)),Ee(f)&&l(f),u.children){const e=u.children;for(let n=0;n<e.length;n++)r(e[n],f,a&&a.children[n])}a=a||f}return h?()=>{i(h)}:s}function i(e){if(q(e)){const n=a.get(e);n&&(a.delete(e),t.splice(t.indexOf(n),1),n.children.forEach(i),n.alias.forEach(i))}else{const n=t.indexOf(e);n>-1&&(t.splice(n,1),e.record.name&&a.delete(e.record.name),e.children.forEach(i),e.alias.forEach(i))}}function l(e){const n=function(e,n){let t=0,a=n.length;for(;t!==a;){const r=t+a>>1;ye(e,n[r])<0?a=r:t=r+1}const r=function(e){let n=e;for(;n=n.parent;)if(Ee(n)&&0===ye(e,n))return n}(e);return r&&(a=n.lastIndexOf(r,a-1)),a}(e,t);t.splice(n,0,e),e.record.name&&!Se(e)&&a.set(e.record.name,e)}return n=c(ke,n),e.forEach(e=>r(e)),{addRoute:r,resolve:function(e,n){let r,i,s,l={};if("name"in e&&e.name){if(r=a.get(e.name),!r)throw V(G.MATCHER_NOT_FOUND,{location:e});s=r.record.name,l=o(_e(n.params,r.keys.filter(e=>!e.optional).concat(r.parent?r.parent.keys.filter(e=>e.optional):[]).map(e=>e.name)),e.params&&_e(e.params,r.keys.map(e=>e.name))),i=r.stringify(l)}else if(null!=e.path)i=e.path,r=t.find(e=>e.re.test(i)),r&&(l=r.parse(i),s=r.record.name);else{if(r=n.name?a.get(n.name):t.find(e=>e.re.test(n.path)),!r)throw V(G.MATCHER_NOT_FOUND,{location:e,currentLocation:n});s=r.record.name,l=o({},n.params,e.params),i=r.stringify(l)}const c=[];let d=r;for(;d;)c.unshift(d.record),d=d.parent;return{name:s,path:i,params:l,matched:c,meta:Le(c)}},removeRoute:i,clearRoutes:function(){t.length=0,a.clear()},getRoutes:function(){return t},getRecordMatcher:function(e){return a.get(e)}}}(e.routes,e),t=e.parseQuery||K,r=e.stringifyQuery||Y,d=e.history,u=re(),p=re(),v=re(),f=(0,le.IJ)(N);let h=N;a&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const m=i.bind(null,e=>""+e),g=i.bind(null,L),y=i.bind(null,E);function k(e,a){if(a=o({},a||f.value),"string"==typeof e){const r=R(t,e,a.path),i=n.resolve({path:r.path},a),s=d.createHref(r.fullPath);return o(r,i,{params:y(i.params),hash:E(r.hash),redirectedFrom:void 0,href:s})}let i;if(null!=e.path)i=o({},e,{path:R(t,e.path,a.path).path});else{const n=o({},e.params);for(const e in n)null==n[e]&&delete n[e];i=o({},e,{params:g(n)}),a.params=g(a.params)}const s=n.resolve(i,a),l=e.hash||"";s.params=m(y(s.params));const c=function(e,n){const t=n.query?e(n.query):"";return n.path+(t&&"?")+t+(n.hash||"")}(r,o({},e,{hash:(p=l,C(p).replace(x,"{").replace(w,"}").replace(b,"^")),path:s.path})),u=d.createHref(c);var p;return o({fullPath:c,hash:l,query:r===Y?J(e.query):e.query||{}},s,{redirectedFrom:void 0,href:u})}function _(e){return"string"==typeof e?R(t,e,f.value.path):o({},e)}function A(e,n){if(h!==e)return V(G.NAVIGATION_CANCELLED,{from:n,to:e})}function S(e){return I(e)}function T(e,n){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:a}=t;let r="function"==typeof a?a(e,n):a;return"string"==typeof r&&(r=r.includes("?")||r.includes("#")?r=_(r):{path:r},r.params={}),o({query:e.query,hash:e.hash,params:null!=r.path?{}:e.params},r)}}function I(e,n){const t=h=k(e),a=f.value,i=e.state,s=e.force,l=!0===e.replace,c=T(t,a);if(c)return I(o(_(c),{state:"object"==typeof c?o({},i,c.state):i,force:s,replace:l}),n||t);const d=t;let u;return d.redirectedFrom=n,!s&&function(e,n,t){const a=n.matched.length-1,r=t.matched.length-1;return a>-1&&a===r&&M(n.matched[a],t.matched[r])&&P(n.params,t.params)&&e(n.query)===e(t.query)&&n.hash===t.hash}(r,a,t)&&(u=V(G.NAVIGATION_DUPLICATED,{to:d,from:a}),ue(a,a,!0,!1)),(u?Promise.resolve(u):O(d,a)).catch(e=>Q(e)?Q(e,G.NAVIGATION_GUARD_REDIRECT)?e:de(e):ce(e,d,a)).then(e=>{if(e){if(Q(e,G.NAVIGATION_GUARD_REDIRECT))return I(o({replace:l},_(e.to),{state:"object"==typeof e.to?o({},i,e.to.state):i,force:s}),n||d)}else e=j(d,a,!0,l,i);return F(d,a,e),e})}function D(e,n){const t=A(e,n);return t?Promise.reject(t):Promise.resolve()}function z(e){const n=fe.values().next().value;return n&&"function"==typeof n.runWithContext?n.runWithContext(e):e()}function O(e,n){let t;const[a,r,o]=function(e,n){const t=[],a=[],r=[],o=Math.max(n.matched.length,e.matched.length);for(let i=0;i<o;i++){const o=n.matched[i];o&&(e.matched.find(e=>M(e,o))?a.push(o):t.push(o));const s=e.matched[i];s&&(n.matched.find(e=>M(e,s))||r.push(s))}return[t,a,r]}(e,n);t=ie(a.reverse(),"beforeRouteLeave",e,n);for(const r of a)r.leaveGuards.forEach(a=>{t.push(oe(a,e,n))});const i=D.bind(null,e,n);return t.push(i),me(t).then(()=>{t=[];for(const a of u.list())t.push(oe(a,e,n));return t.push(i),me(t)}).then(()=>{t=ie(r,"beforeRouteUpdate",e,n);for(const a of r)a.updateGuards.forEach(a=>{t.push(oe(a,e,n))});return t.push(i),me(t)}).then(()=>{t=[];for(const a of o)if(a.beforeEnter)if(l(a.beforeEnter))for(const r of a.beforeEnter)t.push(oe(r,e,n));else t.push(oe(a.beforeEnter,e,n));return t.push(i),me(t)}).then(()=>(e.matched.forEach(e=>e.enterCallbacks={}),t=ie(o,"beforeRouteEnter",e,n,z),t.push(i),me(t))).then(()=>{t=[];for(const a of p.list())t.push(oe(a,e,n));return t.push(i),me(t)}).catch(e=>Q(e,G.NAVIGATION_CANCELLED)?e:Promise.reject(e))}function F(e,n,t){v.list().forEach(a=>z(()=>a(e,n,t)))}function j(e,n,t,r,i){const s=A(e,n);if(s)return s;const l=n===N,c=a?history.state:{};t&&(r||l?d.replace(e.fullPath,o({scroll:l&&c&&c.scroll},i)):d.push(e.fullPath,i)),f.value=e,ue(e,n,t,l),de()}let B;let H,Z=re(),ee=re();function ce(e,n,t){de(e);const a=ee.list();return a.length?a.forEach(a=>a(e,n,t)):console.error(e),Promise.reject(e)}function de(e){return H||(H=!e,B||(B=d.listen((e,n,t)=>{if(!he.listening)return;const r=k(e),i=T(r,he.currentRoute.value);if(i)return void I(o(i,{replace:!0,force:!0}),r).catch(s);h=r;const l=f.value;var c,u;a&&(c=U(l.fullPath,t.delta),u=X(),W.set(c,u)),O(r,l).catch(e=>Q(e,G.NAVIGATION_ABORTED|G.NAVIGATION_CANCELLED)?e:Q(e,G.NAVIGATION_GUARD_REDIRECT)?(I(o(_(e.to),{force:!0}),r).then(e=>{Q(e,G.NAVIGATION_ABORTED|G.NAVIGATION_DUPLICATED)&&!t.delta&&t.type===$.pop&&d.go(-1,!1)}).catch(s),Promise.reject()):(t.delta&&d.go(-t.delta,!1),ce(e,r,l))).then(e=>{(e=e||j(r,l,!1))&&(t.delta&&!Q(e,G.NAVIGATION_CANCELLED)?d.go(-t.delta,!1):t.type===$.pop&&Q(e,G.NAVIGATION_ABORTED|G.NAVIGATION_DUPLICATED)&&d.go(-1,!1)),F(r,l,e)}).catch(s)})),Z.list().forEach(([n,t])=>e?t(e):n()),Z.reset()),e}function ue(n,t,r,o){const{scrollBehavior:i}=e;if(!a||!i)return Promise.resolve();const s=!r&&function(e){const n=W.get(e);return W.delete(e),n}(U(n.fullPath,0))||(o||!r)&&history.state&&history.state.scroll||null;return(0,se.dY)().then(()=>i(n,t,s)).then(e=>e&&function(e){let n;if("el"in e){const t=e.el,a="string"==typeof t&&t.startsWith("#"),r="string"==typeof t?a?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!r)return;n=function(e,n){const t=document.documentElement.getBoundingClientRect(),a=e.getBoundingClientRect();return{behavior:n.behavior,left:a.left-t.left-(n.left||0),top:a.top-t.top-(n.top||0)}}(r,e)}else n=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(n):window.scrollTo(null!=n.left?n.left:window.scrollX,null!=n.top?n.top:window.scrollY)}(e)).catch(e=>ce(e,n,t))}const pe=e=>d.go(e);let ve;const fe=new Set,he={currentRoute:f,listening:!0,addRoute:function(e,t){let a,r;return q(e)?(a=n.getRecordMatcher(e),r=t):r=e,n.addRoute(r,a)},removeRoute:function(e){const t=n.getRecordMatcher(e);t&&n.removeRoute(t)},clearRoutes:n.clearRoutes,hasRoute:function(e){return!!n.getRecordMatcher(e)},getRoutes:function(){return n.getRoutes().map(e=>e.record)},resolve:k,options:e,push:S,replace:function(e){return S(o(_(e),{replace:!0}))},go:pe,back:()=>pe(-1),forward:()=>pe(1),beforeEach:u.add,beforeResolve:p.add,afterEach:v.add,onError:ee.add,isReady:function(){return H&&f.value!==N?Promise.resolve():new Promise((e,n)=>{Z.add([e,n])})},install(e){e.component("RouterLink",Ie),e.component("RouterView",De),e.config.globalProperties.$router=he,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,le.R1)(f)}),a&&!ve&&f.value===N&&(ve=!0,S(d.location).catch(e=>{}));const n={};for(const e in N)Object.defineProperty(n,e,{get:()=>f.value[e],enumerable:!0});e.provide(ne,he),e.provide(te,(0,le.Gc)(n)),e.provide(ae,f);const t=e.unmount;fe.add(e),e.unmount=function(){fe.delete(e),fe.size<1&&(h=N,B&&B(),B=null,f.value=N,ve=!1,H=!1),t()}}};function me(e){return e.reduce((e,n)=>e.then(()=>z(n)),Promise.resolve())}return he}function Ne(){return(0,se.WQ)(ne)}function $e(e){return(0,se.WQ)(te)}},5039:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.raw-data-container[data-v-146b0908] {\n  background-color: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  padding: 1rem;\n  max-height: 600px;\n  overflow-y: auto;\n  font-size: 0.8rem;\n}\n.raw-data-container pre[data-v-146b0908] {\n  white-space: pre-wrap;\n  word-break: break-all;\n  margin: 0;\n}\n.spirit-stones-grid[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 0.75rem;\n}\n.spirit-stone-item[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  font-size: 0.85rem;\n}\n.spirit-stone-item span[data-v-146b0908]:first-child {\n  color: var(--color-text-secondary);\n}\n.spirit-stone-item span[data-v-146b0908]:last-child {\n  font-weight: 600;\n  color: var(--color-primary);\n}\n.relationship-network-panel[data-v-146b0908] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n}\n.panel-content[data-v-146b0908] {\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n}\n.view-mode-tabs[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface);\n}\n.view-tab[data-v-146b0908] {\n  padding: 8px 16px;\n  font-size: 0.9rem;\n  font-weight: 600;\n  border-radius: 10px;\n  border: 2px solid transparent;\n  background: var(--color-background);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.view-tab[data-v-146b0908]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n.view-tab[data-v-146b0908]:hover {\n  color: var(--color-text);\n  border-color: rgba(59, 130, 246, 0.3);\n  background: var(--color-surface);\n  transform: translateY(-1px);\n}\n.view-tab[data-v-146b0908]:hover::before {\n  opacity: 1;\n}\n.view-tab.active[data-v-146b0908] {\n  color: white;\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n  transform: translateY(-1px);\n}\n.view-tab.active[data-v-146b0908]::before {\n  opacity: 0;\n}\n.view-hint[data-v-146b0908] {\n  margin-left: auto;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.inferred-badge[data-v-146b0908] {\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 8px;\n  border-radius: 999px;\n  font-size: 0.75rem;\n  font-weight: 700;\n  margin-left: 8px;\n  color: rgba(234, 88, 12, 0.95);\n  background: rgba(234, 88, 12, 0.12);\n  border: 1px solid rgba(234, 88, 12, 0.25);\n}\n.graph-edge-count[data-v-146b0908] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  padding: 4px 10px;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  white-space: nowrap;\n}\n.relationships-container[data-v-146b0908] {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  background: var(--color-surface);\n  overflow: hidden;\n}\n.relationship-graph[data-v-146b0908] {\n  flex: 1;\n  min-height: 0;\n  background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.03) 0%, var(--color-surface) 100%);\n  border-top: 1px solid var(--color-border);\n  position: relative;\n}\n.graph-svg[data-v-146b0908] {\n  width: 100%;\n  height: 100%;\n  touch-action: none;\n  background: linear-gradient(135deg,\n    rgba(59, 130, 246, 0.02) 0%,\n    rgba(147, 51, 234, 0.02) 50%,\n    rgba(236, 72, 153, 0.02) 100%);\n}\n.graph-edge[data-v-146b0908] {\n  stroke-linecap: round;\n  stroke-linejoin: round;\n  transition: all 0.3s ease;\n  filter: drop-shadow(0 0 2px rgba(59, 130, 246, 0.2));\n}\n.graph-edge[data-v-146b0908]:hover {\n  stroke-width: 3 !important;\n  filter: drop-shadow(0 0 4px rgba(59, 130, 246, 0.4));\n}\n.graph-node[data-v-146b0908] {\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n.graph-node:hover .graph-node-dot[data-v-146b0908] {\n  transform: scale(1.15);\n  filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6));\n}\n.graph-node-dot[data-v-146b0908] {\n  fill: rgba(59, 130, 246, 0.15);\n  stroke: rgba(59, 130, 246, 0.8);\n  stroke-width: 2.5;\n  transition: all 0.3s ease;\n  filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.3));\n}\n.graph-node-dot.player[data-v-146b0908] {\n  fill: rgba(147, 51, 234, 0.25);\n  stroke: rgba(147, 51, 234, 1);\n  stroke-width: 3.5;\n  filter: drop-shadow(0 0 12px rgba(147, 51, 234, 0.6));\n  animation: pulse-player-146b0908 2s ease-in-out infinite;\n}\n@keyframes pulse-player-146b0908 {\n0%, 100% {\n    filter: drop-shadow(0 0 12px rgba(147, 51, 234, 0.6));\n}\n50% {\n    filter: drop-shadow(0 0 20px rgba(147, 51, 234, 0.8));\n}\n}\n.graph-node-dot.selected[data-v-146b0908] {\n  fill: rgba(34, 197, 94, 0.25);\n  stroke: rgba(34, 197, 94, 1);\n  stroke-width: 3;\n  filter: drop-shadow(0 0 10px rgba(34, 197, 94, 0.6));\n  animation: pulse-selected-146b0908 1.5s ease-in-out infinite;\n}\n@keyframes pulse-selected-146b0908 {\n0%, 100% {\n    transform: scale(1);\n}\n50% {\n    transform: scale(1.08);\n}\n}\n.graph-node-label[data-v-146b0908] {\n  font-size: 12px;\n  font-weight: 600;\n  fill: var(--color-text);\n  paint-order: stroke;\n  stroke: var(--color-background);\n  stroke-width: 5px;\n  stroke-linejoin: round;\n  transition: all 0.3s ease;\n  letter-spacing: 0.5px;\n  dominant-baseline: hanging;\n}\n.graph-node:hover .graph-node-label[data-v-146b0908] {\n  font-size: 13px;\n  fill: var(--color-primary);\n  stroke-width: 6px;\n}\n.relationship-list[data-v-146b0908] {\n  width: 300px;\n  border-right: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n  background: linear-gradient(180deg, rgba(59, 130, 246, 0.02) 0%, transparent 100%);\n}\n.list-header[data-v-146b0908] {\n  padding: 1.25rem;\n  border-bottom: 2px solid var(--color-border);\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n}\n.panel-title[data-v-146b0908] {\n  margin: 0 0 1rem 0;\n  font-size: 1.35rem;\n  font-weight: 800;\n  background: linear-gradient(135deg, #3b82f6, #9333ea);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-align: center;\n  letter-spacing: 0.5px;\n}\n.search-bar[data-v-146b0908] {\n  position: relative;\n  display: flex;\n  align-items: center;\n  background: var(--color-background);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  padding: 0.65rem 0.85rem;\n  transition: all 0.3s ease;\n}\n.search-bar[data-v-146b0908]:focus-within {\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n  background: var(--color-surface);\n}\n.search-bar svg[data-v-146b0908] {\n  color: var(--color-text-secondary);\n  margin-right: 0.65rem;\n  transition: color 0.3s ease;\n}\n.search-bar:focus-within svg[data-v-146b0908] {\n  color: var(--color-primary);\n}\n.search-input[data-v-146b0908] {\n  flex: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 0.9rem;\n  font-weight: 500;\n}\n.search-input[data-v-146b0908]::placeholder {\n  color: var(--color-text-secondary);\n  opacity: 0.6;\n}\n.list-content[data-v-146b0908] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n.loading-state[data-v-146b0908],\n.empty-state[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-146b0908] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.empty-text[data-v-146b0908] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.empty-hint[data-v-146b0908] {\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.person-list[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.person-card[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  padding: 0.85rem;\n  background: linear-gradient(135deg, var(--color-background) 0%, rgba(59, 130, 246, 0.02) 100%);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.person-card[data-v-146b0908]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  pointer-events: none;\n}\n.person-card[data-v-146b0908]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15), 0 2px 8px rgba(59, 130, 246, 0.1);\n  transform: translateY(-2px);\n}\n.person-card[data-v-146b0908]:hover::before {\n  opacity: 1;\n}\n.person-card.selected[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(147, 51, 234, 0.12));\n  border-color: var(--color-primary);\n  box-shadow: 0 4px 20px rgba(59, 130, 246, 0.25), 0 0 0 3px rgba(59, 130, 246, 0.1);\n  transform: translateY(-2px);\n}\n.person-card.selected[data-v-146b0908]::before {\n  opacity: 1;\n}\n.person-avatar[data-v-146b0908] {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 700;\n  color: white;\n  margin-right: 0.85rem;\n  flex-shrink: 0;\n  background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n  transition: all 0.3s ease;\n  position: relative;\n  z-index: 1;\n}\n.person-card:hover .person-avatar[data-v-146b0908] {\n  transform: scale(1.08);\n  box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);\n}\n.person-card.selected .person-avatar[data-v-146b0908] {\n  background: linear-gradient(135deg, #22c55e, #10b981);\n  box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);\n  animation: avatar-pulse-146b0908 2s ease-in-out infinite;\n}\n@keyframes avatar-pulse-146b0908 {\n0%, 100% {\n    box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);\n}\n50% {\n    box-shadow: 0 8px 24px rgba(34, 197, 94, 0.6);\n}\n}\n.avatar-text[data-v-146b0908] {\n  font-size: 1.2rem;\n  font-weight: 700;\n}\n.person-info[data-v-146b0908] {\n  flex: 1;\n  min-width: 0;\n  position: relative;\n  z-index: 1;\n}\n.person-name[data-v-146b0908] {\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 0.5rem;\n  font-size: 1.05rem;\n  letter-spacing: 0.3px;\n  transition: color 0.3s ease;\n}\n.person-card:hover .person-name[data-v-146b0908] {\n  color: var(--color-primary);\n}\n.person-meta[data-v-146b0908] {\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n.relationship-type[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(147, 51, 234, 0.12));\n  color: var(--color-primary);\n  padding: 3px 10px;\n  border-radius: 14px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  transition: all 0.3s ease;\n}\n.person-card:hover .relationship-type[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.18), rgba(147, 51, 234, 0.18));\n  border-color: rgba(59, 130, 246, 0.3);\n}\n.attention-toggle[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: rgba(156, 163, 175, 0.1);\n  border: 1px solid rgba(156, 163, 175, 0.2);\n  padding: 0;\n  outline: none;\n  position: relative;\n  z-index: 100;\n  pointer-events: auto;\n}\n.attention-toggle[data-v-146b0908]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n  transform: scale(1.1);\n}\n.attention-icon[data-v-146b0908] {\n  transition: all 0.2s ease;\n}\n.attention-icon.active[data-v-146b0908] {\n  color: #22c55e;\n}\n.attention-icon.inactive[data-v-146b0908] {\n  color: #9ca3af;\n}\n.attention-toggle:hover .attention-icon.inactive[data-v-146b0908] {\n  color: #3b82f6;\n}\n.attention-toggle:hover .attention-icon.active[data-v-146b0908] {\n  color: #16a34a;\n}\n.person-realm[data-v-146b0908] {\n  margin-bottom: 0.5rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.person-realm .realm-label[data-v-146b0908] {\n  margin-right: 0.25rem;\n}\n.person-realm .realm-value[data-v-146b0908] {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.intimacy-info[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.65rem;\n}\n.intimacy-bar[data-v-146b0908] {\n  flex: 1;\n  height: 6px;\n  background: rgba(59, 130, 246, 0.12);\n  border-radius: 3px;\n  overflow: hidden;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.intimacy-fill[data-v-146b0908] {\n  height: 100%;\n  border-radius: 3px;\n  transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 0 8px currentColor;\n}\n.intimacy-high[data-v-146b0908] {\n  background: linear-gradient(90deg, #22c55e, #16a34a);\n  box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);\n}\n.intimacy-good[data-v-146b0908] {\n  background: linear-gradient(90deg, #3b82f6, #1d4ed8);\n  box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);\n}\n.intimacy-medium[data-v-146b0908] {\n  background: linear-gradient(90deg, #8b5cf6, #7c3aed);\n  box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);\n}\n.intimacy-low[data-v-146b0908] {\n  background: linear-gradient(90deg, #f59e0b, #d97706);\n  box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);\n}\n.intimacy-neutral[data-v-146b0908] {\n  background: linear-gradient(90deg, #6b7280, #4b5563);\n  box-shadow: 0 0 8px rgba(107, 114, 128, 0.4);\n}\n.intimacy-dislike[data-v-146b0908] {\n  background: linear-gradient(90deg, #f97316, #ea580c);\n  box-shadow: 0 0 10px rgba(249, 115, 22, 0.5);\n}\n.intimacy-hostile[data-v-146b0908] {\n  background: linear-gradient(90deg, #dc2626, #b91c1c);\n  box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);\n}\n.intimacy-enemy[data-v-146b0908] {\n  background: linear-gradient(90deg, #ef4444, #dc2626);\n  box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);\n}\n.intimacy-value[data-v-146b0908] {\n  font-size: 0.8rem;\n  font-weight: 700;\n  color: var(--color-text);\n  min-width: 35px;\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n.npc-core-stats[data-v-146b0908] {\n  margin-top: 0.5rem;\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 0.35rem 0.5rem;\n  font-size: 0.72rem;\n  color: var(--color-text-secondary);\n}\n.npc-core-stat[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 2px 6px;\n  border-radius: 6px;\n  background: rgba(59, 130, 246, 0.06);\n  border: 1px solid rgba(59, 130, 246, 0.08);\n}\n.npc-core-label[data-v-146b0908] {\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.npc-core-value[data-v-146b0908] {\n  color: var(--color-text);\n  font-variant-numeric: tabular-nums;\n}\n.arrow-icon[data-v-146b0908] {\n  color: var(--color-border-hover);\n  transition: transform 0.2s;\n}\n.person-card.selected .arrow-icon[data-v-146b0908] {\n  transform: rotate(90deg);\n  color: var(--color-primary);\n}\n.relationship-detail[data-v-146b0908] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-width: 0; /* 关键修复：允许flex项收缩，防止内容溢出 */\n  overflow: hidden; /* 隐藏所有溢出，滚动由子元素处理 */\n}\n.detail-header[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.detail-avatar[data-v-146b0908] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  font-size: 1.5rem;\n  background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n  flex-shrink: 0;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);\n}\n.detail-info[data-v-146b0908] {\n  flex: 1;\n  min-width: 0; /* 允许flex项收缩，防止长名称撑开容器 */\n}\n.detail-name[data-v-146b0908] {\n  margin: 0 0 0.5rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-text);\n  word-break: break-all; /* 强制长名称换行 */\n}\n.detail-badges[data-v-146b0908] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.relationship-badge[data-v-146b0908],\n.intimacy-badge[data-v-146b0908],\n.race-badge[data-v-146b0908],\n.faction-badge[data-v-146b0908] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.relationship-badge[data-v-146b0908] {\n  background: rgba(59, 130, 246, 0.1);\n  color: var(--color-primary);\n}\n.race-badge[data-v-146b0908] {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n  border: 1px solid rgba(34, 197, 94, 0.3);\n}\n.faction-badge[data-v-146b0908] {\n  background: rgba(168, 85, 247, 0.1);\n  color: #a855f7;\n  border: 1px solid rgba(168, 85, 247, 0.3);\n}\n.detail-body[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  flex: 1; /* 占据剩余空间 */\n  min-height: 0; /* 允许收缩 */\n  overflow-y: auto; /* 内容溢出时滚动 */\n  padding: 1rem;\n}\n.tab-content[data-v-146b0908] {\n  animation: fadeIn-146b0908 0.3s ease;\n}\n@keyframes fadeIn-146b0908 {\nfrom {\n    opacity: 0;\n    transform: translateY(10px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.empty-state-small[data-v-146b0908] {\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-style: italic;\n}\n.detail-section[data-v-146b0908] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.section-title[data-v-146b0908] {\n  margin: 0 0 1rem 0;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.info-grid[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 1rem;\n}\n\n/* NPC核心数值进度条样式 */\n.npc-vitals-container[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.8rem;\n}\n.npc-vital-row[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.npc-vital-meta[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.85rem;\n}\n.npc-vital-name[data-v-146b0908] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.npc-vital-nums[data-v-146b0908] {\n  color: var(--color-text-secondary);\n}\n.npc-vital-track[data-v-146b0908] {\n  height: 10px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 5px;\n  overflow: hidden;\n}\n.npc-vital-bar[data-v-146b0908] {\n  height: 100%;\n  border-radius: 5px;\n  transition: width 0.3s ease;\n}\n.npc-vital-bar.red-bar[data-v-146b0908] {\n  background: linear-gradient(90deg, #ef4444, #f87171);\n  box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);\n}\n.npc-vital-bar.blue-bar[data-v-146b0908] {\n  background: linear-gradient(90deg, #3b82f6, #60a5fa);\n  box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);\n}\n.npc-vital-bar.gold-bar[data-v-146b0908] {\n  background: linear-gradient(90deg, #f59e0b, #fbbf24);\n  box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);\n}\n.npc-vital-bar.purple-bar[data-v-146b0908] {\n  background: linear-gradient(90deg, #a855f7, #c084fc);\n  box-shadow: 0 0 8px rgba(168, 85, 247, 0.4);\n}\n.npc-vital-bar.green-bar[data-v-146b0908] {\n  background: linear-gradient(90deg, #10b981, #34d399);\n  box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);\n}\n.ability-card[data-v-146b0908] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-top: 0.5rem;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n}\n.ability-header[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.75rem;\n  border-bottom: 1px dashed var(--color-border);\n  padding-bottom: 0.5rem;\n}\n.ability-name[data-v-146b0908] {\n  font-weight: 700;\n  font-size: 1.1rem;\n  color: var(--color-primary);\n}\n.ability-type[data-v-146b0908] {\n  font-size: 0.75rem;\n  padding: 2px 8px;\n  background: rgba(59, 130, 246, 0.1);\n  color: var(--color-primary);\n  border-radius: 12px;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.ability-content[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.ability-desc[data-v-146b0908] {\n  font-size: 0.9rem;\n  line-height: 1.6;\n  color: var(--color-text-secondary);\n  background: rgba(0,0,0,0.02);\n  padding: 0.5rem;\n  border-radius: 4px;\n}\n.ability-cost[data-v-146b0908] {\n  font-size: 0.85rem;\n  color: var(--color-text-tertiary);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.cost-label[data-v-146b0908] {\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.cost-value[data-v-146b0908] {\n  color: #ef4444;\n}\n.info-grid-2col[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.info-item[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.info-label[data-v-146b0908] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-146b0908] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.memory-list[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  margin-top: 1rem;\n}\n.memory-header[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n}\n.summary-mode-hint[data-v-146b0908] {\n  margin-top: 0.75rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(59, 130, 246, 0.08);\n  border-left: 3px solid #3b82f6;\n  border-radius: 4px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.summary-mode-hint strong[data-v-146b0908] {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.memory-actions-header[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.memory-count[data-v-146b0908] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: rgba(59, 130, 246, 0.1);\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-weight: 500;\n}\n.memory-controls-group[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.download-memory-btn[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.download-memory-btn[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.summarize-controls[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.summarize-input[data-v-146b0908] {\n  width: 60px;\n  padding: 0.375rem 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.75rem;\n  text-align: center;\n  transition: all 0.2s ease;\n}\n.summarize-input[data-v-146b0908]:focus {\n  outline: none;\n  border-color: #8b5cf6;\n  box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);\n}\n.summarize-btn[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.summarize-btn[data-v-146b0908]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #7c3aed, #6d28d9);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);\n}\n.summarize-btn[data-v-146b0908]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n.memory-summary-list[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-bottom: 1rem;\n}\n.memory-summary-item[data-v-146b0908] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(124, 58, 237, 0.05));\n  border-radius: 8px;\n  border-left: 3px solid #8b5cf6;\n}\n.summary-icon[data-v-146b0908] {\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n.summary-text[data-v-146b0908] {\n  flex: 1;\n  font-size: 0.85rem;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n.memory-pagination[data-v-146b0908] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 1rem;\n  padding-top: 0.75rem;\n  border-top: 1px solid var(--color-border);\n  margin-top: 1rem;\n}\n.pagination-btn[data-v-146b0908] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.5rem 1rem;\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.8rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.pagination-btn[data-v-146b0908]:hover:not(:disabled) {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.pagination-btn[data-v-146b0908]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.pagination-controls[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.5rem;\n}\n.pagination-info[data-v-146b0908] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  text-align: center;\n}\n.jump-to-page[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.page-input[data-v-146b0908] {\n  width: 60px;\n  padding: 0.375rem 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.75rem;\n  text-align: center;\n  transition: all 0.2s ease;\n}\n.page-input[data-v-146b0908]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.jump-btn[data-v-146b0908] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.jump-btn[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.memory-summary-section[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(124, 58, 237, 0.08));\n  border-left: 4px solid #8b5cf6;\n}\n.memory-item[data-v-146b0908] {\n  display: flex;\n  align-items: flex-start;\n  gap: 8px;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border-left: 3px solid var(--color-primary);\n  font-size: 0.85rem;\n  line-height: 1.4;\n  color: var(--color-text-secondary);\n}\n.memory-content[data-v-146b0908] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.memory-time[data-v-146b0908] {\n  font-size: 0.75rem;\n  color: var(--color-primary);\n  font-weight: 600;\n  opacity: 0.8;\n}\n.memory-event[data-v-146b0908] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  line-height: 1.5;\n}\n.memory-actions[data-v-146b0908] {\n  display: flex;\n  gap: 6px;\n}\n.memory-btn[data-v-146b0908] {\n  padding: 4px 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  font-size: 12px;\n  cursor: pointer;\n  background: var(--color-background);\n}\n.memory-btn.edit[data-v-146b0908] {\n  color: #2563eb;\n  border-color: #bfdbfe;\n}\n.memory-btn.delete[data-v-146b0908] {\n  color: #dc2626;\n  border-color: #fecaca;\n}\n\n/* 简化：外貌描述样式 */\n.appearance-description[data-v-146b0908] {\n  padding: 1rem;\n  background: rgba(147, 51, 234, 0.05);\n  border-radius: 8px;\n  border-left: 3px solid #9333ea;\n}\n.description-text[data-v-146b0908] {\n  font-size: 0.875rem;\n  line-height: 1.6;\n  color: var(--color-text);\n  margin: 0;\n  font-style: italic;\n}\n.subsection-title[data-v-146b0908] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.talents-grid[data-v-146b0908] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.talent-tag[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));\n  color: #3b82f6;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.attributes-grid[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\n  gap: 0.75rem;\n}\n.attribute-item[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.attr-label[data-v-146b0908] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.25rem;\n  font-weight: 500;\n}\n.attr-value[data-v-146b0908] {\n  font-size: 1rem;\n  font-weight: 700;\n  color: var(--color-primary);\n}\n\n/* NPC物品样式 */\n.npc-inventory[data-v-146b0908] {\n  margin-top: 0.75rem;\n}\n.npc-items-grid[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  gap: 0.75rem;\n}\n.npc-item-card[data-v-146b0908] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 0.75rem;\n  transition: all 0.2s ease;\n}\n.npc-item-card[data-v-146b0908]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n.npc-item-card.quality-凡[data-v-146b0908] {\n  border-left: 3px solid #6b7280;\n}\n.npc-item-card.quality-黄[data-v-146b0908] {\n  border-left: 3px solid #f59e0b;\n}\n.npc-item-card.quality-玄[data-v-146b0908] {\n  border-left: 3px solid #8b5cf6;\n}\n.npc-item-card.quality-地[data-v-146b0908] {\n  border-left: 3px solid #06b6d4;\n}\n.npc-item-card.quality-天[data-v-146b0908] {\n  border-left: 3px solid #ec4899;\n}\n.npc-item-card.quality-仙[data-v-146b0908] {\n  border-left: 3px solid #f59e0b;\n  box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);\n}\n.npc-item-card.quality-神[data-v-146b0908] {\n  border-left: 3px solid #9333ea;\n  box-shadow: 0 0 15px rgba(147, 51, 234, 0.4);\n}\n.item-header[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 0.5rem;\n}\n.item-name[data-v-146b0908] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.item-type[data-v-146b0908] {\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  padding: 0.125rem 0.375rem;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 500;\n}\n.item-quality[data-v-146b0908] {\n  margin-bottom: 0.5rem;\n}\n.quality-text[data-v-146b0908] {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.item-quantity[data-v-146b0908] {\n  text-align: right;\n  margin-bottom: 0.5rem;\n  font-size: 0.8rem;\n  /* 使用主题主色，增强与卡片背景的对比度 */\n  color: var(--color-primary);\n  font-weight: 700;\n}\n.item-description[data-v-146b0908] {\n  margin-bottom: 0.75rem;\n}\n.item-description p[data-v-146b0908] {\n  margin: 0;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  line-height: 1.4;\n}\n.item-actions[data-v-146b0908] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.trade-btn[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #059669, #047857);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.trade-btn[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, #047857, #065f46);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);\n}\n.trade-btn[data-v-146b0908]:active {\n  transform: translateY(0);\n}\n.request-btn[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.request-btn[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.request-btn[data-v-146b0908]:active {\n  transform: translateY(0);\n}\n.steal-btn[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #dc2626, #b91c1c);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.steal-btn[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, #b91c1c, #991b1b);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);\n}\n.steal-btn[data-v-146b0908]:active {\n  transform: translateY(0);\n}\n.empty-inventory[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-inventory .empty-icon[data-v-146b0908] {\n  margin-bottom: 0.75rem;\n  opacity: 0.5;\n}\n.no-selection[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.placeholder-icon[data-v-146b0908] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.placeholder-text[data-v-146b0908] {\n  font-size: 1rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.placeholder-hint[data-v-146b0908] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n.animate-spin[data-v-146b0908] {\n  animation: spin-146b0908 1s linear infinite;\n}\n@keyframes spin-146b0908 {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* === NSFW 私密信息样式 === */\n.nsfw-section[data-v-146b0908] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.06),\n    rgba(var(--color-accent-rgb), 0.06)\n  );\n  border: 1px solid rgba(var(--color-primary-rgb), 0.35);\n}\n.nsfw-subsection[data-v-146b0908] {\n  margin-bottom: 1rem;\n}\n.nsfw-subsection[data-v-146b0908]:last-child {\n  margin-bottom: 0;\n}\n.development-bars[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.dev-bar-item[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.dev-bar-header[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.8rem;\n}\n.dev-label[data-v-146b0908] {\n  color: var(--color-text);\n  font-weight: 500;\n}\n.dev-value[data-v-146b0908] {\n  color: var(--color-primary);\n  font-weight: 700;\n  font-size: 0.75rem;\n}\n.dev-bar-track[data-v-146b0908] {\n  height: 8px;\n  background: rgba(var(--color-primary-rgb), 0.12);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.dev-bar-fill[data-v-146b0908] {\n  height: 100%;\n  background: linear-gradient(90deg, var(--color-primary), var(--color-primary-hover));\n  border-radius: 4px;\n  transition: width 0.3s ease;\n}\n.status-badge[data-v-146b0908] {\n  display: inline-block;\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.status-正常[data-v-146b0908] {\n  background: rgba(107, 114, 128, 0.2);\n  color: #6b7280;\n}\n.status-微湿[data-v-146b0908] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #3b82f6;\n}\n.status-发情[data-v-146b0908] {\n  background: rgba(236, 72, 153, 0.2);\n  color: #ec4899;\n}\n.status-高潮[data-v-146b0908] {\n  background: rgba(220, 38, 38, 0.2);\n  color: #dc2626;\n}\n.status-贤者时间[data-v-146b0908] {\n  background: rgba(139, 92, 246, 0.2);\n  color: #8b5cf6;\n}\n.fetish-tag[data-v-146b0908] {\n  background: rgba(var(--color-accent-rgb), 0.14);\n  color: var(--color-accent);\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(var(--color-accent-rgb), 0.3);\n}\n.preference-tag[data-v-146b0908] {\n  background: rgba(var(--color-primary-rgb), 0.12);\n  color: var(--color-primary);\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.28);\n}\n.taboo-tag[data-v-146b0908] {\n  background: rgba(var(--color-error-rgb), 0.12);\n  color: var(--color-error);\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(var(--color-error-rgb), 0.28);\n}\n.partner-tag[data-v-146b0908] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n  padding: 0.3rem 0.6rem;\n  border-radius: 6px;\n  font-size: 0.8rem;\n  font-weight: 500;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.25);\n}\n.partner-list[data-v-146b0908] {\n  margin-top: 0.75rem;\n}\n.toggle-more-btn[data-v-146b0908] {\n  margin-top: 0.75rem;\n  background: rgba(var(--color-primary-rgb), 0.08);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.25);\n  color: var(--color-primary);\n  padding: 0.35rem 0.6rem;\n  border-radius: 6px;\n  font-size: 0.8rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.toggle-more-btn[data-v-146b0908]:hover {\n  background: rgba(var(--color-primary-rgb), 0.12);\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n}\n.pregnancy-info[data-v-146b0908] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.pregnancy-active[data-v-146b0908] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n}\n.pregnancy-icon[data-v-146b0908] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n}\n.pregnancy-details[data-v-146b0908] {\n  flex: 1;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  line-height: 1.6;\n}\n.pregnancy-inactive[data-v-146b0908] {\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n}\n.first-time-info[data-v-146b0908] {\n  padding: 0.75rem;\n  background: rgba(var(--color-accent-rgb), 0.06);\n  border-radius: 6px;\n  border-left: 3px solid var(--color-accent);\n  font-size: 0.85rem;\n  color: var(--color-text);\n}\n\n/* 实时状态高亮区域（通用）*/\n.highlight-section[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n  border-radius: 8px;\n  padding: 1rem;\n  border: 1px solid rgba(59, 130, 246, 0.15);\n}\n.realtime-status[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.status-item[data-v-146b0908] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.status-icon[data-v-146b0908] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n  line-height: 1;\n}\n.status-content[data-v-146b0908] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.status-label[data-v-146b0908] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.status-text[data-v-146b0908] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  line-height: 1.5;\n  font-style: italic;\n}\n.desire-fill[data-v-146b0908] {\n  background: linear-gradient(90deg, #f59e0b, #dc2626);\n}\n.mini-label[data-v-146b0908] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n\n/* 性经验统计 */\n.experience-grid[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.exp-item[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.exp-icon[data-v-146b0908] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n}\n.exp-content[data-v-146b0908] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.exp-label[data-v-146b0908] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.exp-value[data-v-146b0908] {\n  font-size: 0.95rem;\n  color: #ec4899;\n  font-weight: 700;\n}\n.last-time-info[data-v-146b0908] {\n  padding: 0.5rem 0.75rem;\n  background: rgba(236, 72, 153, 0.05);\n  border-radius: 4px;\n  font-size: 0.8rem;\n  text-align: center;\n}\n.last-time-label[data-v-146b0908] {\n  color: var(--color-text-secondary);\n  margin-right: 0.5rem;\n}\n.last-time-value[data-v-146b0908] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 身体部位列表 */\n.body-parts-list[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.body-part-item[data-v-146b0908] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.part-header[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.part-name[data-v-146b0908] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.part-mark[data-v-146b0908] {\n  font-size: 0.7rem;\n  padding: 0.125rem 0.375rem;\n  background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(219, 39, 119, 0.2));\n  color: #ec4899;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.part-description[data-v-146b0908] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-style: italic;\n  margin-bottom: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(236, 72, 153, 0.05);\n  border-radius: 4px;\n  line-height: 1.4;\n}\n.part-stats[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.part-stat[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.stat-label[data-v-146b0908] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  min-width: 50px;\n}\n.stat-bar-mini[data-v-146b0908] {\n  flex: 1;\n  height: 6px;\n  background: rgba(236, 72, 153, 0.1);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.stat-bar-fill[data-v-146b0908] {\n  height: 100%;\n  border-radius: 3px;\n  transition: width 0.3s ease;\n}\n.stat-bar-fill.sensitivity[data-v-146b0908] {\n  background: linear-gradient(90deg, #f59e0b, #ec4899);\n}\n.stat-bar-fill.development[data-v-146b0908] {\n  background: linear-gradient(90deg, #8b5cf6, #ec4899);\n}\n.stat-value[data-v-146b0908] {\n  font-size: 0.7rem;\n  color: #ec4899;\n  font-weight: 700;\n  min-width: 35px;\n  text-align: right;\n}\n\n/* 体液状态 */\n.fluid-status[data-v-146b0908] {\n  padding: 0.75rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(236, 72, 153, 0.08));\n  border-radius: 6px;\n  border-left: 3px solid #3b82f6;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  font-style: italic;\n}\n\n/* 特殊体质标签 */\n.special-trait-tag[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(236, 72, 153, 0.15));\n  color: #a855f7;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(168, 85, 247, 0.3);\n}\n\n/* ========== 人格底线样式 ========== */\n.personality-section[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(249, 115, 22, 0.08));\n  border-left: 4px solid #ef4444;\n}\n.personality-bottomlines[data-v-146b0908] {\n  margin-bottom: 0.75rem;\n}\n.bottomline-tags[data-v-146b0908] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.bottomline-tag[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(249, 115, 22, 0.15));\n  color: #ef4444;\n  padding: 0.4rem 0.75rem;\n  border-radius: 8px;\n  font-size: 0.85rem;\n  font-weight: 600;\n  border: 1.5px solid rgba(239, 68, 68, 0.4);\n  display: inline-flex;\n  align-items: center;\n  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);\n  transition: all 0.2s ease;\n}\n.bottomline-tag[data-v-146b0908]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);\n  border-color: rgba(239, 68, 68, 0.6);\n}\n.bottomline-empty[data-v-146b0908] {\n  color: var(--text-secondary);\n  font-style: italic;\n  font-size: 0.875rem;\n  padding: 0.5rem 0;\n}\n.bottomline-warning[data-v-146b0908] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.5rem;\n  background: rgba(239, 68, 68, 0.1);\n  padding: 0.75rem;\n  border-radius: 8px;\n  border: 1px solid rgba(239, 68, 68, 0.3);\n}\n.warning-icon[data-v-146b0908] {\n  font-size: 1.1rem;\n  color: #f59e0b;\n  flex-shrink: 0;\n  animation: pulse-146b0908 2s infinite;\n}\n@keyframes pulse-146b0908 {\n0%,\n  100% {\n    opacity: 1;\n    transform: scale(1);\n}\n50% {\n    opacity: 0.6;\n    transform: scale(1.1);\n}\n}\n.warning-text[data-v-146b0908] {\n  color: #dc2626;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  font-weight: 500;\n}\n\n/* ========== Tab导航样式 ========== */\n.detail-tabs[data-v-146b0908] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0 0 1rem 0;\n  border-bottom: 2px solid var(--color-border);\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n}\n.tab-btn[data-v-146b0908] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px 8px 0 0;\n  padding: 0.5rem 1rem;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  position: relative;\n  outline: none;\n}\n.tab-btn[data-v-146b0908]:hover {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-text);\n  transform: translateY(-2px);\n}\n.tab-btn.active[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  font-weight: 600;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);\n}\n.tab-btn.active[data-v-146b0908]::after {\n  content: '';\n  position: absolute;\n  bottom: -2px;\n  left: 0;\n  right: 0;\n  height: 2px;\n  background: var(--color-primary);\n}\n.tab-panel[data-v-146b0908] {\n  animation: fadeIn-146b0908 0.3s ease;\n}\n\n/* ========== 响应式2列布局样式 ========== */\n.info-grid-responsive[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n}\n\n/* 小屏幕时切换为单列 */\n@media (max-width: 500px) {\n.info-grid-responsive[data-v-146b0908] {\n    grid-template-columns: 1fr;\n}\n}\n.info-item-row[data-v-146b0908] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 6px 10px;\n  background: transparent;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n  transition: background 0.2s ease;\n}\n.info-item-row[data-v-146b0908]:hover {\n  background: rgba(59, 130, 246, 0.03);\n}\n.info-item-row .info-label[data-v-146b0908] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  min-width: 50px;\n}\n.info-item-row .info-value[data-v-146b0908] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n  text-align: right;\n  flex: 1;\n  word-break: break-word;\n}\n\n/* ========== NPC记忆列表样式 ========== */\n.npc-memories-list[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.npc-memory-item[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(234, 179, 8, 0.05), rgba(249, 115, 22, 0.05));\n  border-left: 3px solid #eab308;\n  border-radius: 4px;\n  padding: 10px 12px;\n  transition: all 0.2s ease;\n}\n.npc-memory-item[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, rgba(234, 179, 8, 0.1), rgba(249, 115, 22, 0.1));\n  transform: translateX(4px);\n  box-shadow: 0 2px 6px rgba(234, 179, 8, 0.15);\n}\n.npc-memory-content[data-v-146b0908] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  line-height: 1.5;\n}\n\n/* ========== NPC属性属性样式 ========== */\n.npc-attributes-container[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.npc-attr-group[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  border-radius: 8px;\n  padding: 10px;\n}\n.npc-attr-group-title[data-v-146b0908] {\n  font-size: 0.8rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  margin-bottom: 8px;\n  padding-left: 4px;\n}\n.npc-attr-grid[data-v-146b0908] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 6px;\n}\n.npc-attr-item[data-v-146b0908] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 6px 4px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 6px;\n  border: 1px solid transparent;\n  transition: all 0.2s ease;\n}\n.npc-attr-item[data-v-146b0908]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n  transform: translateY(-2px);\n}\n.npc-attr-item.final[data-v-146b0908] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(147, 51, 234, 0.12));\n}\n.npc-attr-item.final[data-v-146b0908]:hover {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 51, 234, 0.2));\n}\n.npc-attr-label[data-v-146b0908] {\n  font-size: 0.7rem;\n  color: var(--text-secondary);\n  margin-bottom: 2px;\n  font-weight: 500;\n}\n.npc-attr-value[data-v-146b0908] {\n  font-size: 0.95rem;\n  font-weight: 700;\n  color: var(--color-primary);\n}\n.name-and-actions[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n.delete-npc-btn[data-v-146b0908] {\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  color: #ef4444;\n  border-radius: 50%;\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.delete-npc-btn[data-v-146b0908]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  border-color: #ef4444;\n  color: #ef4444;\n  transform: scale(1.1);\n}\n.action-buttons[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.action-btn[data-v-146b0908] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  border-radius: 50%;\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.action-btn.download-btn[data-v-146b0908] {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #3b82f6;\n}\n.action-btn.download-btn[data-v-146b0908]:hover {\n  background: rgba(59, 130, 246, 0.2);\n  border-color: #3b82f6;\n  color: #3b82f6;\n  transform: scale(1.1);\n}\n.action-btn.export-btn[data-v-146b0908] {\n  background: rgba(16, 185, 129, 0.1);\n  border-color: rgba(16, 185, 129, 0.3);\n  color: #10b981;\n}\n.action-btn.export-btn[data-v-146b0908]:hover {\n  background: rgba(16, 185, 129, 0.2);\n  border-color: #10b981;\n  color: #10b981;\n  transform: scale(1.1);\n}\n.card-actions[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  position: relative;\n  z-index: 10;\n  pointer-events: auto;\n}\n.delete-btn-card[data-v-146b0908] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: rgba(156, 163, 175, 0.1);\n  border: 1px solid rgba(156, 163, 175, 0.2);\n  color: #9ca3af;\n  padding: 0;\n  outline: none;\n  position: relative;\n  z-index: 100;\n  pointer-events: auto;\n}\n.delete-btn-card[data-v-146b0908]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: #ef4444;\n  color: #ef4444;\n  transform: scale(1.1);\n}\n.back-to-list-btn[data-v-146b0908] {\n  display: none; /* 默认隐藏 */\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  border-radius: 50%;\n  width: 32px;\n  height: 32px;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n  margin-right: 0.5rem;\n}\n.back-to-list-btn[data-v-146b0908]:hover {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n@media (max-width: 768px) {\n.relationships-container[data-v-146b0908] {\n    position: relative;\n    overflow: hidden;\n}\n.relationship-list[data-v-146b0908],\n  .relationship-detail[data-v-146b0908] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    transition: transform 0.3s ease-in-out;\n    backface-visibility: hidden;\n}\n.relationship-list[data-v-146b0908] {\n    transform: translateX(0);\n    z-index: 10;\n}\n.relationship-detail[data-v-146b0908] {\n    transform: translateX(100%);\n    z-index: 20;\n    border-left: none; /* 移除左边框 */\n}\n.relationships-container.details-active .relationship-list[data-v-146b0908] {\n    transform: translateX(-100%);\n}\n.relationships-container.details-active .relationship-detail[data-v-146b0908] {\n    transform: translateX(0);\n}\n.back-to-list-btn[data-v-146b0908] {\n    display: flex; /* 在移动端显示 */\n}\n.detail-header[data-v-146b0908] {\n    padding: 0.75rem 1rem;\n}\n}\n",""]);const s=i},5056:(e,n,t)=>{"use strict";e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},5072:e=>{"use strict";var n=[];function t(e){for(var t=-1,a=0;a<n.length;a++)if(n[a].identifier===e){t=a;break}return t}function a(e,a){for(var o={},i=[],s=0;s<e.length;s++){var l=e[s],c=a.base?l[0]+a.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var p=t(u),v={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)n[p].references++,n[p].updater(v);else{var f=r(v,a);a.byIndex=s,n.splice(s,0,{identifier:u,updater:f,references:1})}i.push(u)}return i}function r(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,r){var o=a(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var s=t(o[i]);n[s].references--}for(var l=a(e,r),c=0;c<o.length;c++){var d=t(o[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}o=l}}},5099:(e,n,t)=>{"use strict";t.d(n,{$v:()=>p,Jx:()=>x,Wj:()=>k,YK:()=>g,c5:()=>m,loadFromIndexedDB:()=>w,loadSaveData:()=>y,saveData:()=>v,saveSaveData:()=>b});const a="DAD_SAVES_DB",r=1,o="saves",i="root_data",s="characters",l="active_save",c="savedata_";let d=null;function u(){return new Promise((e,n)=>{if(d)return void e(d);const t=indexedDB.open(a,r);t.onerror=()=>{console.error("【乾坤宝库-IDB】数据库打开失败:",t.error),n(t.error)},t.onsuccess=()=>{d=t.result,console.log("【乾坤宝库-IDB】数据库已打开"),e(t.result)},t.onupgradeneeded=e=>{const n=e.target.result;n.objectStoreNames.contains(o)||(n.createObjectStore(o,{keyPath:"id"}),console.log("【乾坤宝库-IDB】对象存储已创建:",o))}})}async function p(){try{const e=(await u()).transaction([o],"readonly").objectStore(o),n=e.get(s),t=e.get(l);return new Promise((e,a)=>{let r=null,o=null,i=0;const s=()=>{2===i&&(console.log("【乾坤宝库-IDB】分片数据加载完成"),e({角色列表:r||{},当前激活存档:o||null}))};n.onsuccess=()=>{r=n.result?.data||{},i++,s()},n.onerror=()=>a(n.error),t.onsuccess=()=>{o=t.result?.data||null,i++,s()},t.onerror=()=>a(t.error)})}catch(e){return console.error("【乾坤宝库-IDB】加载根数据时出错:",e),{当前激活存档:null,角色列表:{}}}}async function v(e,n){const t=await u();return new Promise((a,r)=>{const i=t.transaction([o],"readwrite").objectStore(o).put({id:e,data:JSON.parse(JSON.stringify(n)),timestamp:(new Date).toISOString()});i.onsuccess=()=>a(),i.onerror=()=>r(i.error)})}async function f(e){try{console.log("[IndexedDB-保存角色] 准备保存角色列表, 角色数:",Object.keys(e).length),await v(s,e),console.log("[IndexedDB-保存角色] ✅ 角色列表已保存到 IndexedDB")}catch(e){throw console.error("[IndexedDB-保存角色] ❌ 保存角色列表失败:",e),e}}async function h(e){try{await v(l,e),console.log("【乾坤宝库-IDB】当前激活存档已保存")}catch(e){throw console.error("【乾坤宝库-IDB】保存当前激活存档失败:",e),e}}async function m(e){try{console.log("[IndexedDB-保存] 开始保存根数据"),console.log("[IndexedDB-保存] 角色列表键名:",Object.keys(e.角色列表)),console.log("[IndexedDB-保存] 当前激活存档:",e.当前激活存档),await Promise.all([f(e.角色列表),h(e.当前激活存档)]),console.log("[IndexedDB-保存] ✅ 根数据（分片）保存成功")}catch(e){throw console.error("[IndexedDB-保存] ❌ 保存根数据时出错:",e),e}}async function g(){try{const e="DAD_SAVES_V3",n=localStorage.getItem(e);if(n){console.log("【乾坤宝库-IDB】检测到localStorage数据，开始迁移...");const t=JSON.parse(n);return await m(t),localStorage.setItem("DAD_SAVES_V3_BACKUP",n),localStorage.removeItem(e),console.log("【乾坤宝库-IDB】✅ localStorage 数据迁移完成！"),!0}const t=(await u()).transaction([o],"readwrite").objectStore(o),a=t.get(i);return new Promise((e,n)=>{a.onsuccess=async()=>{const r=a.result;if(r&&r.data&&(r.data.角色列表||r.data.当前激活存档)){console.log("【乾坤宝库-IDB】检测到旧的单体DB记录，开始分片迁移...");try{const a=r.data;await f(a.角色列表||{}),await h(a.当前激活存档||null);const o=t.delete(i);o.onsuccess=()=>{console.log("【乾坤宝库-IDB】✅ 旧的单体DB记录已成功迁移并删除"),e(!0)},o.onerror=()=>{console.error("【乾坤宝库-IDB】❌ 删除旧的单体DB记录失败:",o.error),n(o.error)}}catch(e){console.error("【乾坤宝库-IDB】❌ 分片迁移失败:",e),n(e)}}else console.log("【乾坤宝库-IDB】无需数据迁移"),e(!1)},a.onerror=()=>{console.error("【乾坤宝库-IDB】❌ 检查旧数据失败:",a.error),n(a.error)}})}catch(e){return console.error("【乾坤宝库-IDB】❌ 数据迁移过程出错:",e),!1}}async function b(e,n,t){try{const a=`${c}${e}_${n}`;await v(a,t),console.log(`【乾坤宝库-IDB】SaveData 已保存 (${e}/${n})`)}catch(e){throw console.error("【乾坤宝库-IDB】保存 SaveData 失败:",e),e}}async function y(e,n){try{const t=`${c}${e}_${n}`,a=await u();return new Promise((r,i)=>{const s=a.transaction([o],"readonly").objectStore(o),l=s.get(t);l.onsuccess=()=>{const t=l.result;if(t&&t.data)console.log(`【乾坤宝库-IDB】SaveData 已加载 (${e}/${n})`),r(t.data);else{const t="云端修行"===n?"存档":"存档"===n?"云端修行":null;if(!t)return console.warn(`【乾坤宝库-IDB】SaveData 不存在 (${e}/${n})`),void r(null);const a=`${c}${e}_${t}`,o=s.get(a);o.onsuccess=()=>{const a=o.result;a&&a.data?(console.warn(`【乾坤宝库-IDB】SaveData 未命中(${n})，回退命中(${t}) (${e}/${n})`),r(a.data)):(console.warn(`【乾坤宝库-IDB】SaveData 不存在 (${e}/${n})`),r(null))},o.onerror=()=>{console.error("【乾坤宝库-IDB】加载 SaveData 失败(别名):",o.error),i(o.error)}}},l.onerror=()=>{console.error("【乾坤宝库-IDB】加载 SaveData 失败:",l.error),i(l.error)}})}catch(e){return console.error("【乾坤宝库-IDB】加载 SaveData 时出错:",e),null}}async function x(e,n){try{const t=`${c}${e}_${n}`,a=await u();return new Promise((r,i)=>{const s=a.transaction([o],"readwrite").objectStore(o).delete(t);s.onsuccess=()=>{console.log(`【乾坤宝库-IDB】SaveData 已删除 (${e}/${n})`),r()},s.onerror=()=>{console.error("【乾坤宝库-IDB】删除 SaveData 失败:",s.error),i(s.error)}})}catch(e){throw console.error("【乾坤宝库-IDB】删除 SaveData 时出错:",e),e}}async function k(e){try{const n=await u(),t=`${c}${e}_`;return console.log(`【乾坤宝库-IDB】开始清理角色 ${e} 的所有存档...`),new Promise((e,a)=>{const r=n.transaction([o],"readwrite").objectStore(o),i=r.getAllKeys();i.onsuccess=()=>{const n=i.result.filter(e=>"string"==typeof e&&e.startsWith(t));if(console.log(`【乾坤宝库-IDB】找到 ${n.length} 个存档记录待删除:`,n),0===n.length)return console.log("【乾坤宝库-IDB】没有找到需要删除的存档"),void e(0);let a=0,o=0;n.forEach(t=>{const i=r.delete(t);i.onsuccess=()=>{a++,console.log(`【乾坤宝库-IDB】✅ 已删除: ${t}`),a+o===n.length&&(console.log(`【乾坤宝库-IDB】批量删除完成，成功 ${a} 个，失败 ${o} 个`),e(a))},i.onerror=()=>{o++,console.error(`【乾坤宝库-IDB】❌ 删除失败: ${t}`,i.error),a+o===n.length&&(console.log(`【乾坤宝库-IDB】批量删除完成，成功 ${a} 个，失败 ${o} 个`),e(a))}})},i.onerror=()=>{console.error("【乾坤宝库-IDB】获取所有键失败:",i.error),a(i.error)}})}catch(e){throw console.error("【乾坤宝库-IDB】批量删除存档数据时出错:",e),e}}async function w(e){try{const n=await u();return new Promise((t,a)=>{const r=n.transaction([o],"readonly").objectStore(o).get(e);r.onsuccess=()=>{const e=r.result;e&&e.data?t(e.data):t(null)},r.onerror=()=>{a(r.error)}})}catch(n){return console.error(`【乾坤宝库-IDB】从 IndexedDB 加载数据失败 (key: ${e}):`,n),null}}},5184:(e,n,t)=>{"use strict";t.d(n,{vectorMemoryService:()=>m});var a=t(602),r=t(1083);function o(e){return(e||"").toString().trim().replace(/\/v1\/?$/,"").replace(/\/+$/,"")}function i(e){const n=Math.sqrt(e.reduce((e,n)=>e+n*n,0));return n?e.map(e=>e/n):e}async function s(e,n){const t=e.provider,a=o(e.url),i=(e.apiKey||"").trim(),s=(e.model||"").trim();if(!a)throw new Error("Embedding API 地址未配置");if(!i)throw new Error("Embedding API Key 未配置");if(!s)throw new Error("Embedding 模型未配置");if(function(e){try{const n=new URL(e);return"dashscope.aliyuncs.com"===n.hostname||"dashscope-intl.aliyuncs.com"===n.hostname}catch{const n=(e||"").toString().toLowerCase();return n.includes("dashscope.aliyuncs.com")||n.includes("dashscope-intl.aliyuncs.com")}}(a)){const e=function(e){const n=(e||"").trim().replace(/\/+$/,""),t="/api/v1/services/embeddings/text-embedding/text-embedding";if(n.includes(t))return n;try{const e=new URL(n);return(e.pathname||"").replace(/\/+$/,""),`${e.origin}${t}`}catch{return n.endsWith("/api")?`${n}/v1/services/embeddings/text-embedding/text-embedding`:`${n}${t}`}}(a),t=await r.A.post(e,{model:s,input:{texts:n}},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),o=t.data?.output?.embeddings;if(!Array.isArray(o)||o.length!==n.length)throw new Error("Embedding 响应格式异常（DashScope）");return o.map(e=>({index:Number(e?.text_index),embedding:e?.embedding})).sort((e,n)=>e.index-n.index).map(e=>{if(!Array.isArray(e?.embedding))throw new Error("Embedding 响应缺少 embedding（DashScope）");return e.embedding})}if(function(e){try{const n=new URL(e);return"api.siliconflow.cn"===n.hostname||n.hostname.endsWith(".siliconflow.cn")}catch{return(e||"").toString().toLowerCase().includes("siliconflow.cn")}}(a)||"siliconflow-embedding"===t){const e=await r.A.post(`${a}/v1/embeddings`,{model:s,input:n,encoding_format:"float"},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),t=e.data?.data;if(!Array.isArray(t)||t.length!==n.length)throw new Error("Embedding 响应格式异常（SiliconFlow）");return[...t].sort((e,n)=>(e.index??0)-(n.index??0)).map(e=>{const n=e?.embedding;if(!Array.isArray(n))throw new Error("Embedding 响应缺少 embedding（SiliconFlow）");return n})}if("openai"===t||"deepseek"===t||"custom"===t){const e=await r.A.post(`${a}/v1/embeddings`,{model:s,input:n,encoding_format:"float"},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),t=e.data?.data;if(!Array.isArray(t)||t.length!==n.length)throw new Error("Embedding 响应格式异常");return t.map(e=>{const n=e?.embedding;if(!Array.isArray(n))throw new Error("Embedding 响应缺少 embedding");return n})}throw new Error(`当前 provider 不支持 Embedding：${t}`)}const l={enabled:!1,maxRetrieveCount:10,minSimilarity:.3,tagWeight:.4,vectorWeight:.6,embeddingApiId:void 0},c=new Set(["凡人","炼气","筑基","金丹","元婴","化神","炼虚","合体","渡劫","飞升","初期","中期","后期","圆满","极境","突破","瓶颈","修炼","闭关","悟道","感悟","丹田","经脉","灵气","真气","法力","神识","战斗","交手","斩杀","击败","重伤","轻伤","濒死","陨落","药剂","法宝","突变结晶","功法","秘籍","材料","灵草","师父","徒弟","道友","敌人","仇人","盟友","宗门","门派","洞府","山门","秘境","禁地","坊市","城池","拜师","入门","出关","历练","任务","机缘","劫难"]),d=new Set(["的","了","是","在","有","和","与","或","也","都","就","着","被","让","把","给","从","到","向","往","对","于","为","而","但","却","因","所","这","那","它","他","她","我","你","们","自","其","此","彼","一","个","些","很","更","最","非","不","无","没","未"]);function u(e){const n=[];for(const t of c)e.includes(t)&&n.push(t);const t=/[\u4e00-\u9fa5]{2,4}/g;let a;for(;null!==(a=t.exec(e));){const e=a[0];d.has(e)||c.has(e)||n.push(e)}return[...new Set(n)]}function p(e){const n=[],t=u(e);for(const e of t)c.has(e)&&n.push(e);const a=/[\u4e00-\u9fa5]{2,3}/g;let r;for(;null!==(r=a.exec(e));){const e=r[0];d.has(e)||c.has(e)||n.length<15&&n.push(e)}return[...new Set(n)].slice(0,20)}function v(e,n){const t=t=>t.some(t=>e.includes(t)||n.includes(t));return t(["战斗","交手","斩杀","击败","重伤","攻击","防御"])?"combat":t(["师父","徒弟","道友","拜师","结交","好感","关系"])?"social":t(["修炼","闭关","突破","感悟","觉醒阶段","功法"])?"cultivation":t(["探索","发现","秘境","历练","寻找"])?"exploration":t(["机缘","劫难","事件","任务","完成"])?"event":"other"}class f{vocabulary;wordToIndex;constructor(){this.vocabulary=Array.from(c),this.wordToIndex=new Map,this.vocabulary.forEach((e,n)=>{this.wordToIndex.set(e,n)})}vectorize(e){const n=u(e),t=new Array(this.vocabulary.length).fill(0),a=new Map;for(const e of n)a.set(e,(a.get(e)||0)+1);for(const[e,n]of a){const a=this.wordToIndex.get(e);void 0!==a&&(t[a]=n)}const r=Math.sqrt(t.reduce((e,n)=>e+n*n,0));if(r>0)for(let e=0;e<t.length;e++)t[e]/=r;return t}cosineSimilarity(e,n){if(e.length!==n.length)return 0;let t=0;for(let a=0;a<e.length;a++)t+=e[a]*n[a];return t}}function h(e){return`mem_${function(e){let n=2166136261;for(let t=0;t<e.length;t++)n^=e.charCodeAt(t),n=Math.imul(n,16777619);return(n>>>0).toString(16).padStart(8,"0")}((e||"").trim().replace(/\s+/g," "))}`}const m=new class{db=null;vectorizer;config;saveSlot="";constructor(){this.vectorizer=new f,this.config={...l},this.loadConfig()}async init(e){this.saveSlot=e;const n=`vector-memory-${e}`;this.db=await(0,a.P2)(n,1,{upgrade(e){if(!e.objectStoreNames.contains("memories")){const n=e.createObjectStore("memories",{keyPath:"id"});n.createIndex("tags","tags",{multiEntry:!0}),n.createIndex("category","category"),n.createIndex("timestamp","timestamp")}}}),console.log(`[向量记忆] 初始化完成: ${n}`)}loadConfig(){try{const e=localStorage.getItem("vectorMemoryConfig");e&&(this.config={...l,...JSON.parse(e)})}catch(e){console.warn("[向量记忆] 加载配置失败，使用默认配置")}}saveConfig(e){this.config={...this.config,...e},localStorage.setItem("vectorMemoryConfig",JSON.stringify(this.config))}getConfig(){return{...this.config}}isEnabled(){return this.config.enabled}canAutoIndex(){return!!this.db&&(this.config.enabled||!!this.getEmbeddingRequestConfig())}getEmbeddingRequestConfig(){try{const{useAPIManagementStore:e}=t(100),n=e();if(!n.isFunctionEnabled("embedding"))return null;let a;if(a=this.config.embeddingApiId?n.apiConfigs.find(e=>e.id===this.config.embeddingApiId&&e.enabled):n.getAPIForType("embedding"),!a||!1===a.enabled)return null;if("default"===a.id)return null;const r=o(a.url),i=(a.apiKey||"").trim(),s=(a.model||"").trim();return r&&i&&s?{provider:a.provider,url:r,apiKey:i,model:s}:null}catch{return null}}getEmbeddingStatus(){const e=this.getEmbeddingRequestConfig();return e?{available:!0,provider:e.provider,model:e.model}:{available:!1,reason:"请在 API管理 中为 Embedding 配置 API 地址/Key/模型；硅基流动推荐使用 BAAI/bge-m3 模型；阿里百炼请用 DashScope 原生域名"}}async embedText(e){const n=this.getEmbeddingRequestConfig();if(!n)return null;try{const[t]=await s(n,[e]);return{vector:i(t),model:n.model}}catch(e){return console.warn("[向量记忆] Embedding 生成失败，回退到本地向量:",e),null}}async embedBatch(e){const n=this.getEmbeddingRequestConfig();if(!n)return null;try{return{vectors:(await s(n,e)).map(e=>i(e)),model:n.model}}catch(e){return console.warn("[向量记忆] Embedding 批量生成失败，回退到本地向量:",e),null}}async addMemory(e,n=5){if(!this.db)return console.warn("[向量记忆] 数据库未初始化"),null;const t=(e||"").trim();if(!t)return null;const a=p(e),r=v(e,a),o=await this.embedText(t),i=o?o.vector:this.vectorizer.vectorize(t),s={id:h(t),content:t,tags:a,vector:i,vectorType:o?"embedding":"tfidf",embeddingModel:o?.model,timestamp:Date.now(),importance:n,category:r,metadata:{npcs:a.filter(e=>!c.has(e)).slice(0,5)}};return await this.db.put("memories",s),console.log(`[向量记忆] 添加记忆: ${e.substring(0,50)}... 标签: ${a.join(", ")}`),s}async rebuildFromLongTermMemories(e,n){if(!this.db)throw new Error("向量库未初始化");const t=(e||[]).map(e=>(e||"").trim()).filter(Boolean),a=t.length,r=n?.importance??7,o=Math.max(1,Math.min(64,n?.batchSize??24));await this.clear();let i,s=0,l="tfidf";for(let e=0;e<t.length;e+=o){const d=t.slice(e,e+o),u=await this.embedBatch(d);if(u&&u.vectors.length===d.length){l="embedding",i=u.model;for(let e=0;e<d.length;e++){const n=d[e],t=p(n),a=v(n,t),o={id:h(n),content:n,tags:t,vector:u.vectors[e],vectorType:"embedding",embeddingModel:u.model,timestamp:Date.now(),importance:r,category:a,metadata:{npcs:t.filter(e=>!c.has(e)).slice(0,5)}};await this.db.put("memories",o),s++}}else for(const e of d){const n=p(e),t=v(e,n),a={id:h(e),content:e,tags:n,vector:this.vectorizer.vectorize(e),vectorType:"tfidf",timestamp:Date.now(),importance:r,category:t,metadata:{npcs:n.filter(e=>!c.has(e)).slice(0,5)}};await this.db.put("memories",a),s++}n?.onProgress?.(Math.min(e+d.length,a),a)}return console.log(`[向量记忆] 重建完成：${s}/${a} 条，模式=${l}${i?`(${i})`:""}`),{imported:s,vectorType:l,embeddingModel:i}}async importLongTermMemories(e){let n=0;for(const t of e)t&&t.trim()&&(await this.addMemory(t,7),n++);return console.log(`[向量记忆] 导入 ${n} 条长期记忆`),n}async searchMemories(e,n){if(!this.db||!this.config.enabled)return[];const t=p(e);n?.involvedNpcs&&t.push(...n.involvedNpcs),n?.currentLocation&&t.push(n.currentLocation);const a=await this.db.getAll("memories"),r=[],o=[e,n?.currentLocation?`地点: ${n.currentLocation}`:"",...(n?.recentEvents||[]).slice(0,3).map(e=>`事件: ${e}`)].filter(Boolean).join("\n"),i=await this.embedText(o),s=i?.model,l=i?.vector,c=l&&a.some(e=>"embedding"===(e.vectorType||"tfidf")&&(!s||e.embeddingModel===s)&&Array.isArray(e.vector)&&e.vector.length===l.length)?"embedding":"tfidf",d="embedding"===c&&l?l:this.vectorizer.vectorize(e),u=[];for(const e of a){const n=e.vectorType||"tfidf";if(n!==c)continue;if("embedding"===n){if(s&&e.embeddingModel&&e.embeddingModel!==s)continue;if(e.vector.length!==d.length)continue}const a=e.tags.filter(e=>t.includes(e)),r=a.length/Math.max(t.length,1),o="tfidf"===n?this.vectorizer.cosineSimilarity(d,e.vector):(()=>{let n=0;for(let t=0;t<d.length;t++)n+=d[t]*e.vector[t];return n})(),i=r*this.config.tagWeight+o*this.config.vectorWeight;u.push({entry:e,score:i,matchedTags:a})}u.sort((e,n)=>n.score-e.score);const v=u.filter(e=>e.score>=this.config.minSimilarity),f=(v.length>0?v:u).slice(0,this.config.maxRetrieveCount);return r.push(...f),r}async getAllMemories(){return this.db?await this.db.getAll("memories"):[]}async getStats(){if(!this.db)return{total:0,byCategory:{},topTags:[],byVectorType:{},byEmbeddingModel:{}};const e=await this.db.getAll("memories"),n={},t={},a={},r={};for(const o of e){n[o.category]=(n[o.category]||0)+1;const e=o.vectorType||"tfidf";a[e]=(a[e]||0)+1,"embedding"===e&&o.embeddingModel&&(r[o.embeddingModel]=(r[o.embeddingModel]||0)+1);for(const e of o.tags)t[e]=(t[e]||0)+1}const o=Object.entries(t).map(([e,n])=>({tag:e,count:n})).sort((e,n)=>n.count-e.count).slice(0,20);return{total:e.length,byCategory:n,topTags:o,byVectorType:a,byEmbeddingModel:r}}async clear(){this.db&&(await this.db.clear("memories"),console.log("[向量记忆] 已清空向量库"))}formatForAI(e){if(0===e.length)return"";const n=["【相关长期记忆】"];for(const{entry:t,matchedTags:a}of e){const e=a.length>0?`[${a.join(",")}]`:"";n.push(`- ${e} ${t.content}`)}return n.join("\n")}}},5192:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-210f912a] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n}\n.modal-container[data-v-210f912a] {\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.06), rgba(15, 23, 42, 0.02)) , var(--color-surface);\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 16px 40px rgba(0,0,0,0.35);\n  width: 90%;\n  max-width: 500px;\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.modal-container.modal-wide[data-v-210f912a] {\n  width: min(96vw, 960px);\n  max-width: 960px;\n  max-height: 88svh;\n}\n.modal-header[data-v-210f912a] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n  background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(59, 130, 246, 0.02));\n}\n.modal-title[data-v-210f912a] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.modal-close-button[data-v-210f912a] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: rgba(15, 23, 42, 0.06);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.modal-close-button[data-v-210f912a]:hover {\n  color: var(--color-text);\n  border-color: var(--color-primary);\n  background: var(--color-surface-hover);\n}\n.modal-content[data-v-210f912a] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  line-height: 1.6;\n  color: var(--color-text);\n  white-space: pre-wrap; /* Allows line breaks in the content */\n}\n.modal-fade-enter-active[data-v-210f912a],\n.modal-fade-leave-active[data-v-210f912a] {\n  transition: opacity 0.3s ease;\n}\n.modal-fade-enter-from[data-v-210f912a],\n.modal-fade-leave-to[data-v-210f912a] {\n  opacity: 0;\n}\n",""]);const s=i},5218:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.retry-dialog-overlay[data-v-67dbe82b] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  z-index: 99999;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.retry-dialog[data-v-67dbe82b] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 480px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n  animation: dialog-appear-67dbe82b 0.3s ease-out;\n  overflow: hidden;\n  /* 确保背景完全贴合 */\n  display: flex;\n  flex-direction: column;\n}\n@keyframes dialog-appear-67dbe82b {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n.dialog-header[data-v-67dbe82b] {\n  padding: 24px 24px 16px;\n  text-align: center;\n  background: var(--color-surface);\n  /* 去除可能的间隙 */\n  margin: 0;\n  flex-shrink: 0;\n}\n.dialog-header h3[data-v-67dbe82b] {\n  margin: 0;\n  padding: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n  line-height: 1.4;\n}\n.dialog-content[data-v-67dbe82b] {\n  padding: 20px 24px;\n  text-align: center;\n  background: var(--color-surface);\n  /* 确保内容区域可滚动但不超出 */\n  max-height: 50vh;\n  overflow-y: auto;\n  overflow-x: hidden;\n  /* 去除可能的间隙 */\n  margin: 0;\n  flex: 1;\n}\n\n/* 滚动条样式优化 */\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar {\n  width: 6px;\n}\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 3px;\n}\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.4);\n}\n.error-icon[data-v-67dbe82b] {\n  color: var(--color-warning);\n  margin: 0 0 16px 0;\n  padding: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.message[data-v-67dbe82b] {\n  color: var(--color-text);\n  line-height: 1.6;\n  margin: 0;\n  padding: 0;\n  white-space: pre-line;\n  text-align: left;\n  word-break: break-word;\n}\n.dialog-actions[data-v-67dbe82b] {\n  display: flex;\n  gap: 12px;\n  padding: 16px 24px 24px;\n  background: var(--color-surface);\n  /* 去除可能的间隙 */\n  margin: 0;\n  flex-shrink: 0;\n}\n.btn-primary[data-v-67dbe82b],\n.btn-secondary[data-v-67dbe82b] {\n  flex: 1;\n  padding: 12px 20px;\n  margin: 0;\n  border-radius: 8px;\n  border: 1px solid;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 14px;\n  line-height: 1.5;\n}\n.btn-primary[data-v-67dbe82b] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n.btn-primary[data-v-67dbe82b]:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n.btn-secondary[data-v-67dbe82b] {\n  background: transparent;\n  border-color: var(--color-border);\n  color: var(--color-text-secondary);\n}\n.btn-secondary[data-v-67dbe82b]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-text-secondary);\n  color: var(--color-text);\n  transform: translateY(-1px);\n}\n.btn-primary[data-v-67dbe82b]:active,\n.btn-secondary[data-v-67dbe82b]:active {\n  transform: translateY(0) scale(0.98);\n}\n@media (max-width: 480px) {\n.retry-dialog-overlay[data-v-67dbe82b] {\n    padding: 16px;\n}\n.retry-dialog[data-v-67dbe82b] {\n    max-width: none;\n    border-radius: 12px;\n}\n.dialog-header[data-v-67dbe82b] {\n    padding: 20px 20px 12px;\n}\n.dialog-header h3[data-v-67dbe82b] {\n    font-size: 1.1rem;\n}\n.dialog-content[data-v-67dbe82b] {\n    padding: 16px 20px;\n    max-height: 60vh;\n}\n.dialog-actions[data-v-67dbe82b] {\n    flex-direction: column-reverse;\n    gap: 10px;\n    padding: 12px 20px 20px;\n}\n.btn-primary[data-v-67dbe82b],\n  .btn-secondary[data-v-67dbe82b] {\n    flex: none;\n    width: 100%;\n}\n}\n",""]);const s=i},5224:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg width=%2760%27 height=%2760%27 viewBox=%270 0 60 60%27 xmlns=%27http://www.w3.org/2000/svg%27%3E%3Cg fill=%27none%27 fill-rule=%27evenodd%27%3E%3Cg fill=%27%23ffffff%27 fill-opacity=%270.08%27%3E%3Cpath d=%27M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z%27/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"},5269:(e,n,t)=>{"use strict";function a(e){if(Array.isArray(e))return e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean);if("string"==typeof e){const n=e.trim();return n?n.split(/[、,，;；\n]/).map(e=>e.trim()).filter(Boolean):[]}return null}function r(e){const{action:n,key:t,value:r}=e,s=[];if("string"!=typeof t||!t)return{valid:!1,errors:["指令缺少key字段"]};if("string"!=typeof n||!n)return{valid:!1,errors:["指令缺少action字段"]};try{if("角色.身份.觉醒阶段"===t&&"set"===n){const e=o(r,"玩家");s.push(...e.errors)}if("角色.位置"===t&&"set"===n){const e=function(e){const n=[];return"object"!=typeof e||null===e?(n.push("位置必须是对象类型"),{valid:!1,errors:n}):(e.描述||n.push('位置缺少"描述"字段'),void 0!==e.x&&"number"!=typeof e.x&&n.push("位置.x类型错误，应为数字"),void 0!==e.y&&"number"!=typeof e.y&&n.push("位置.y类型错误，应为数字"),void 0!==e.地图ID&&"string"!=typeof e.地图ID&&n.push("位置.地图ID类型错误，应为字符串"),{valid:0===n.length,errors:n})}(r);s.push(...e.errors)}if("角色.效果"===t&&"push"===n){const e=function(e){const n=[];return"object"!=typeof e||null===e?(n.push("状态效果必须是对象类型"),{valid:!1,errors:n}):(e.状态名称||n.push('状态效果缺少"状态名称"字段'),e.类型&&["buff","debuff"].includes(e.类型)||n.push('状态效果缺少"类型"字段或值无效'),void 0===e.状态描述&&n.push('状态效果缺少"状态描述"字段'),"number"!=typeof e.持续时间分钟&&n.push('状态效果缺少"持续时间分钟"字段或类型错误'),e.生成时间&&"object"==typeof e.生成时间||n.push('状态效果缺少"生成时间"对象字段'),{valid:0===n.length,errors:n})}(r);s.push(...e.errors)}if("角色.背包.物品"===t&&"push"===n){const e=i(r);s.push(...e.errors)}if(t.startsWith("角色.背包.物品.")&&"set"===n&&3===(t.match(/\./g)||[]).length){const e=i(r);s.push(...e.errors)}if(t.startsWith("社交.关系.")&&2===(t.match(/\./g)||[]).length&&"set"===n&&r&&"object"==typeof r&&r.名字&&r.性别&&r.出生日期&&(r.外貌描述||r.性格特征||r.觉醒阶段)){const e=function(e){const n=[];if("object"!=typeof e||null===e)return n.push("NPC必须是对象类型"),{valid:!1,errors:n};e.名字||n.push('NPC缺少"名字"字段'),e.性别||n.push('NPC缺少"性别"字段'),e.出生日期||n.push('NPC缺少"出生日期"字段');let t=e.觉醒阶段;if(void 0===t){if("string"==typeof e.觉醒阶段&&e.觉醒阶段.trim())t=e.觉醒阶段.trim();else if(e.觉醒阶段&&"object"==typeof e.觉醒阶段){const n=e.觉醒阶段.名称??e.觉醒阶段.name;t="string"==typeof n&&n.trim()?n.trim():"凡人"}else t="凡人";e.觉醒阶段=t}{const t=o(e.觉醒阶段,"NPC");n.push(...t.errors)}if(e.出生||n.push('NPC缺少"出生"字段'),void 0!==e.性格特征){const n=a(e.性格特征);n&&(e.性格特征=n)}if(e.性格特征||n.push('NPC缺少"性格特征"字段'),e.外貌描述||n.push('NPC缺少"外貌描述"字段'),e.与玩家关系||n.push('NPC缺少"与玩家关系"字段'),void 0!==e.好感度){const n=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const n=e.trim();if(!n)return null;const t=Number(n);return Number.isFinite(t)?t:null}return null}(e.好感度);null!==n&&(e.好感度=n)}if("number"!=typeof e.好感度&&n.push('NPC缺少"好感度"字段或类型错误'),void 0===e.天赋||Array.isArray(e.天赋)||n.push("NPC天赋必须是数组类型"),e.私密信息&&"object"==typeof e.私密信息){const t=e.私密信息,r=["性癖好","性伴侣名单","特殊体质","亲密偏好","禁忌清单"];for(const e of r)if(void 0!==t[e]){const n=a(t[e]);n&&(t[e]=n)}if(void 0!==t.生育状态){const e=t.生育状态;"string"==typeof e?t.生育状态={当前状态:e}:"object"==typeof e&&null!==e||n.push("NPC私密信息.生育状态必须是对象或字符串")}if(void 0!==e.私密信息.身体部位){const t=e.私密信息.身体部位;Array.isArray(t)||t&&"object"==typeof t||n.push("NPC私密信息.身体部位必须是数组或对象类型")}}if(void 0!==e.记忆&&!Array.isArray(e.记忆)){const n=a(e.记忆);n&&(e.记忆=n)}return{valid:0===n.length,errors:n}}(r);s.push(...e.errors)}if(t.includes("社交.关系.")&&t.endsWith(".觉醒阶段")&&"set"===n){const e=o(r,"NPC");s.push(...e.errors)}return{valid:0===s.length,errors:s}}catch(e){return console.error("[指令值验证] 验证过程发生异常:",e),{valid:!1,errors:[`验证过程异常: ${e instanceof Error?e.message:String(e)}`]}}}function o(e,n="玩家"){const t=[];return"string"!=typeof e?(t.push("觉醒阶段必须是字符串类型"),{valid:!1,errors:t}):(e.trim()||t.push("觉醒阶段不能为空字符串"),{valid:0===t.length,errors:t})}function i(e){const n=[];return"object"!=typeof e||null===e?(n.push("物品必须是对象类型"),{valid:!1,errors:n}):(e.物品ID||n.push('物品缺少"物品ID"字段'),e.名称||n.push('物品缺少"名称"字段'),e.类型||n.push('物品缺少"类型"字段'),e.品质?"object"==typeof e.品质?(e.品质.quality||n.push('物品品质缺少"quality"字段'),"number"!=typeof e.品质.grade&&n.push('物品品质缺少"grade"字段或类型错误')):n.push("物品品质必须是对象类型"):n.push('物品缺少"品质"字段'),"number"!=typeof e.数量&&n.push('物品缺少"数量"字段或类型错误'),void 0===e.描述&&n.push('物品缺少"描述"字段'),{valid:0===n.length,errors:n})}t.d(n,{validateAndRepairCommandValue:()=>r})},5294:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n.attribute-allocation-container[data-v-22da9d4e] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  color: var(--color-text);\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n}\n.header[data-v-22da9d4e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid rgba(147, 197, 253, 0.2);\n}\n.points-display .negative[data-v-22da9d4e] {\n  color: #f87171 !important;\n}\nh2[data-v-22da9d4e] {\n  margin: 0;\n  color: #93c5fd;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.points-display[data-v-22da9d4e] {\n  font-size: 1.2rem;\n  color: #94a3b8;\n}\n.points-display span[data-v-22da9d4e] {\n  font-weight: 600;\n  color: #fbbf24;\n  font-size: 1.5rem;\n}\n.attributes-list[data-v-22da9d4e] {\n  overflow-y: auto;\n  flex-grow: 1;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.attributes-list[data-v-22da9d4e]::-webkit-scrollbar { width: 6px;\n}\n.attributes-list[data-v-22da9d4e]::-webkit-scrollbar-track { background: transparent;\n}\n.attributes-list[data-v-22da9d4e]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.attribute-item[data-v-22da9d4e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 0.5rem;\n  margin-bottom: 0.5rem;\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.4);\n  border: 1px solid transparent;\n  transition: all 0.25s ease;\n}\n.attribute-item[data-v-22da9d4e]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.attribute-item[data-v-22da9d4e]:last-child {\n  margin-bottom: 0;\n}\n.attribute-info[data-v-22da9d4e] {\n  flex-basis: 70%;\n}\n.attribute-name[data-v-22da9d4e] {\n  font-size: 1.1rem;\n  font-weight: 500;\n  color: #93c5fd;\n}\n.attribute-desc[data-v-22da9d4e] {\n  font-size: 0.85rem;\n  color: #94a3b8;\n  margin: 0.3rem 0 0 0;\n  line-height: 1.4;\n}\n.attribute-controls[data-v-22da9d4e] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.attribute-controls button[data-v-22da9d4e] {\n  width: 35px;\n  height: 35px;\n  border-radius: 50%;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  color: #93c5fd;\n  font-size: 1.5rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.attribute-controls button[data-v-22da9d4e]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.3);\n  border-color: #93c5fd;\n  color: #bfdbfe;\n}\n.attribute-controls button[data-v-22da9d4e]:disabled,\n.attribute-controls button.disabled[data-v-22da9d4e] {\n  opacity: 0.4;\n  cursor: not-allowed;\n  background: rgba(30, 41, 59, 0.3);\n  border-color: rgba(255, 255, 255, 0.06);\n  color: #64748b;\n}\n.attribute-value[data-v-22da9d4e] {\n  font-size: 1.4rem;\n  font-weight: 600;\n  min-width: 30px;\n  text-align: center;\n  color: #f1f5f9;\n}\n.actions[data-v-22da9d4e] {\n  padding-top: 1rem;\n  display: flex;\n  justify-content: center;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.actions button[data-v-22da9d4e] {\n  padding: 0.5rem 1.5rem;\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  background: rgba(30, 41, 59, 0.6);\n  color: #f1f5f9;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n}\n.actions button[data-v-22da9d4e]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.5);\n}\n.actions .btn-secondary[data-v-22da9d4e] {\n  border-color: rgba(148, 163, 184, 0.4);\n  color: #94a3b8;\n}\n.actions .btn-secondary[data-v-22da9d4e]:hover {\n  background: rgba(148, 163, 184, 0.2);\n  border-color: #94a3b8;\n  color: #f1f5f9;\n}\n.actions .btn-warning[data-v-22da9d4e] {\n  border-color: rgba(251, 191, 36, 0.4);\n  color: #fbbf24;\n}\n.actions .btn-warning[data-v-22da9d4e]:hover {\n  background: rgba(251, 191, 36, 0.2);\n  border-color: #fbbf24;\n  color: #fef3c7;\n}\n.actions .btn-success[data-v-22da9d4e] {\n  border-color: rgba(52, 211, 153, 0.4);\n  color: #34d399;\n}\n.actions .btn-success[data-v-22da9d4e]:hover {\n  background: rgba(52, 211, 153, 0.2);\n  border-color: #34d399;\n  color: #a7f3d0;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n.attribute-allocation-container[data-v-22da9d4e] {\n    padding-bottom: 1rem;\n}\n.header[data-v-22da9d4e] {\n    flex-direction: column;\n    gap: 0.5rem;\n    text-align: center;\n    padding-bottom: 0.75rem;\n    margin-bottom: 1rem;\n}\n.header h2[data-v-22da9d4e] {\n    font-size: 1.3rem;\n}\n.points-display[data-v-22da9d4e] {\n    font-size: 1rem;\n}\n.points-display span[data-v-22da9d4e] {\n    font-size: 1.2rem;\n}\n.attributes-list[data-v-22da9d4e] {\n    margin-bottom: 0.5rem;\n}\n.attribute-item[data-v-22da9d4e] {\n    flex-direction: row;\n    gap: 0.75rem;\n    padding: 0.75rem 0.5rem;\n}\n.attribute-info[data-v-22da9d4e] {\n    flex: 1;\n    min-width: 0;\n}\n.attribute-name[data-v-22da9d4e] {\n    font-size: 0.95rem;\n}\n.attribute-desc[data-v-22da9d4e] {\n    font-size: 0.75rem;\n    line-height: 1.3;\n}\n.attribute-controls[data-v-22da9d4e] {\n    justify-content: flex-end;\n    gap: 0.5rem;\n    flex-shrink: 0;\n}\n.attribute-controls button[data-v-22da9d4e] {\n    width: 32px;\n    height: 32px;\n    font-size: 1.4rem;\n}\n.attribute-value[data-v-22da9d4e] {\n    font-size: 1.2rem;\n    min-width: 28px;\n}\n.actions[data-v-22da9d4e] {\n    gap: 0.5rem;\n    padding: 0.75rem 0;\n}\n.actions button[data-v-22da9d4e] {\n    padding: 0.5rem 1rem;\n    font-size: 0.85rem;\n    flex: 1;\n    min-width: 70px;\n}\n}\n@media (max-width: 640px) {\n.header[data-v-22da9d4e] {\n    gap: 0.5rem;\n}\n.header h2[data-v-22da9d4e] {\n    font-size: 1.2rem;\n}\n.attribute-item[data-v-22da9d4e] {\n    flex-direction: column;\n    gap: 0.75rem;\n    padding: 1rem 0.5rem;\n    align-items: center;\n}\n.attribute-info[data-v-22da9d4e] {\n    flex-basis: auto;\n    text-align: center;\n    width: 100%;\n}\n.attribute-name[data-v-22da9d4e] {\n    font-size: 1rem;\n    display: block;\n    margin-bottom: 0.25rem;\n}\n.attribute-controls[data-v-22da9d4e] {\n    justify-content: center;\n    gap: 1rem;\n}\n.attribute-controls button[data-v-22da9d4e] {\n    width: 38px;\n    height: 38px;\n    font-size: 1.6rem;\n}\n.attribute-value[data-v-22da9d4e] {\n    font-size: 1.4rem;\n    min-width: 35px;\n}\n.actions[data-v-22da9d4e] {\n    gap: 0.5rem;\n    padding: 1rem 0 0.5rem;\n}\n.actions button[data-v-22da9d4e] {\n    padding: 0.6rem 1.2rem;\n    font-size: 0.9rem;\n}\n}\n@media (max-width: 480px) {\n.header h2[data-v-22da9d4e] {\n    font-size: 1.1rem;\n}\n.points-display[data-v-22da9d4e] {\n    font-size: 0.9rem;\n}\n.points-display span[data-v-22da9d4e] {\n    font-size: 1.1rem;\n}\n.attribute-name[data-v-22da9d4e] {\n    font-size: 0.95rem;\n}\n.attribute-desc[data-v-22da9d4e] {\n    font-size: 0.7rem;\n}\n.attribute-controls button[data-v-22da9d4e] {\n    width: 36px;\n    height: 36px;\n    font-size: 1.5rem;\n}\n.attribute-value[data-v-22da9d4e] {\n    font-size: 1.3rem;\n    min-width: 32px;\n}\n.actions[data-v-22da9d4e] {\n    flex-wrap: wrap;\n    padding: 0.75rem 0;\n}\n.actions button[data-v-22da9d4e] {\n    flex: 1 1 calc(33.333% - 0.5rem);\n    min-width: 80px;\n    padding: 0.6rem 0.75rem;\n    font-size: 0.85rem;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .attribute-allocation-container[data-v-22da9d4e] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .header[data-v-22da9d4e] {\n  border-bottom-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] h2[data-v-22da9d4e] {\n  color: #2563eb;\n}\n[data-theme="light"] .points-display[data-v-22da9d4e] {\n  color: #475569;\n}\n[data-theme="light"] .points-display span[data-v-22da9d4e] {\n  color: #d97706;\n}\n[data-theme="light"] .attribute-item[data-v-22da9d4e] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .attribute-item[data-v-22da9d4e]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .attribute-name[data-v-22da9d4e] {\n  color: #2563eb;\n}\n[data-theme="light"] .attribute-desc[data-v-22da9d4e] {\n  color: #475569;\n}\n[data-theme="light"] .attribute-value[data-v-22da9d4e] {\n  color: #1e293b;\n}\n[data-theme="light"] .attribute-controls button[data-v-22da9d4e] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .attribute-controls button[data-v-22da9d4e]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n}\n[data-theme="light"] .actions button[data-v-22da9d4e] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #1e293b;\n}\n[data-theme="light"] .actions button[data-v-22da9d4e]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.5);\n}\n',""]);const s=i},5327:(e,n,t)=>{"use strict";t.d(n,{A:()=>Tt});var a=t(641),r=t(33),o=t(953),i=t(3751),s=t(5517),l=t(7677),c=t(9992),d=t(5365),u=t(1783),p=t(3528),v=t(4270),f=t(3302),h=t(876);const m={class:"body"},g={class:"left"},b={class:"rule-list"},y=["onClick"],x={class:"rule-row"},k={class:"rule-mode"},w={class:"rule-pattern"},_={class:"rule-repl"},C={class:"right"},A={key:0,class:"editor"},S={class:"editor-row"},L={class:"editor-row"},E={class:"editor-row editor-row-vertical"},T={class:"editor-row editor-row-vertical"},I={key:0,class:"hint"},R={class:"options"},M={class:"opt"},P={class:"opt"},D=["disabled"],z=["disabled"],N={key:0,class:"error"},$={class:"editor-actions"},O=["disabled"],F=["disabled"],j=["disabled"],B={key:1,class:"empty"},X=(0,a.pM)({__name:"TextReplaceRulesModal",props:{open:{type:Boolean},rules:{}},emits:["close","save"],setup(e,{emit:n}){const t=e,s=n,l=(0,o.KR)([]),c=(0,o.KR)(0);(0,a.wB)(()=>t.open,e=>{if(!e)return;const n=Array.isArray(t.rules)?t.rules:[];l.value=JSON.parse(JSON.stringify(n)),0===l.value.length?c.value=0:c.value=Math.min(c.value,l.value.length-1)},{immediate:!0});const d=(0,a.EW)(()=>l.value[c.value]??null),u=()=>{l.value.push({id:`rule_${Date.now()}_${Math.random().toString(16).slice(2)}`,enabled:!0,mode:"regex",pattern:"",replacement:"",global:!0,ignoreCase:!1,multiline:!1,dotAll:!1}),c.value=l.value.length-1},p=()=>{0!==l.value.length&&(l.value.splice(c.value,1),c.value=Math.max(0,Math.min(c.value,l.value.length-1)))},v=()=>{if(c.value<=0)return;const e=c.value,[n]=l.value.splice(e,1);l.value.splice(e-1,0,n),c.value=e-1},f=()=>{if(c.value>=l.value.length-1)return;const e=c.value,[n]=l.value.splice(e,1);l.value.splice(e+1,0,n),c.value=e+1},h=(0,a.EW)(()=>{const e=d.value;if(!e)return null;if(!e.pattern?.trim())return null;if("regex"!==e.mode)return null;const n=(!1===e.global?"":"g")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.dotAll?"s":"");try{return new RegExp(e.pattern,n),null}catch(e){return`正则无效：${e instanceof Error?e.message:String(e)}`}}),X=()=>s("close"),U=()=>{s("save",l.value),s("close")};return(e,n)=>e.open?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"overlay",onClick:(0,i.D$)(X,["self"])},[(0,a.Lk)("div",{class:"modal",onClick:n[8]||(n[8]=(0,i.D$)(()=>{},["stop"]))},[(0,a.Lk)("div",{class:"header"},[n[9]||(n[9]=(0,a.Lk)("div",{class:"title"},[(0,a.Lk)("h3",null,"正则替换规则"),(0,a.Lk)("p",{class:"subtitle"},"用于对 AI 输出进行替换处理（可用正则或纯文本）")],-1)),(0,a.Lk)("button",{class:"icon-btn",onClick:X,"aria-label":"关闭"},"×")]),(0,a.Lk)("div",m,[(0,a.Lk)("div",g,[(0,a.Lk)("div",{class:"left-actions"},[(0,a.Lk)("button",{class:"btn",onClick:u},"新增规则")]),(0,a.Lk)("div",b,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.value,(e,n)=>((0,a.uX)(),(0,a.CE)("button",{key:e.id,class:(0,r.C4)(["rule-item",{active:n===c.value}]),onClick:e=>c.value=n},[(0,a.Lk)("div",x,[(0,a.Lk)("span",{class:(0,r.C4)(["rule-badge",{off:!e.enabled}])},(0,r.v_)(e.enabled?"启用":"停用"),3),(0,a.Lk)("span",k,(0,r.v_)("regex"===e.mode?"正则":"文本"),1)]),(0,a.Lk)("div",w,(0,r.v_)(e.pattern||"（未填写匹配）"),1),(0,a.Lk)("div",_,(0,r.v_)(e.replacement||"（替换为空）"),1)],10,y))),128))])]),(0,a.Lk)("div",C,[d.value?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",S,[n[10]||(n[10]=(0,a.Lk)("label",{class:"label"},"启用",-1)),(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[0]||(n[0]=e=>d.value.enabled=e)},null,512),[[i.lH,d.value.enabled]])]),(0,a.Lk)("div",L,[n[12]||(n[12]=(0,a.Lk)("label",{class:"label"},"匹配模式",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":n[1]||(n[1]=e=>d.value.mode=e),class:"select"},n[11]||(n[11]=[(0,a.Lk)("option",{value:"regex"},"正则",-1),(0,a.Lk)("option",{value:"text"},"纯文本",-1)]),512),[[i.u1,d.value.mode]])]),(0,a.Lk)("div",E,[n[13]||(n[13]=(0,a.Lk)("label",{class:"label"},"匹配内容",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>d.value.pattern=e),class:"textarea",rows:"3",placeholder:"pattern 或 纯文本"},null,512),[[i.Jo,d.value.pattern]])]),(0,a.Lk)("div",T,[n[15]||(n[15]=(0,a.Lk)("label",{class:"label"},"替换为",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":n[3]||(n[3]=e=>d.value.replacement=e),class:"textarea",rows:"3",placeholder:"可为空（表示删除）"},null,512),[[i.Jo,d.value.replacement]]),"regex"===d.value.mode?((0,a.uX)(),(0,a.CE)("div",I,n[14]||(n[14]=[(0,a.eW)(" 支持捕获组：例如用 ",-1),(0,a.Lk)("code",null,"$1",-1),(0,a.eW)(" 引用分组 ",-1)]))):(0,a.Q3)("v-if",!0)]),(0,a.Lk)("div",R,[(0,a.Lk)("label",M,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=e=>d.value.global=e)},null,512),[[i.lH,d.value.global]]),n[16]||(n[16]=(0,a.eW)(" 全局（g） ",-1))]),(0,a.Lk)("label",P,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=e=>d.value.ignoreCase=e)},null,512),[[i.lH,d.value.ignoreCase]]),n[17]||(n[17]=(0,a.eW)(" 忽略大小写（i） ",-1))]),(0,a.Lk)("label",{class:(0,r.C4)(["opt",{disabled:"regex"!==d.value.mode}])},[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[6]||(n[6]=e=>d.value.multiline=e),disabled:"regex"!==d.value.mode},null,8,D),[[i.lH,d.value.multiline]]),n[18]||(n[18]=(0,a.eW)(" 多行（m） ",-1))],2),(0,a.Lk)("label",{class:(0,r.C4)(["opt",{disabled:"regex"!==d.value.mode}])},[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[7]||(n[7]=e=>d.value.dotAll=e),disabled:"regex"!==d.value.mode},null,8,z),[[i.lH,d.value.dotAll]]),n[19]||(n[19]=(0,a.eW)(" 点号匹配换行（s） ",-1))],2)]),h.value?((0,a.uX)(),(0,a.CE)("div",N,(0,r.v_)(h.value),1)):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",$,[(0,a.Lk)("button",{class:"btn btn-secondary",disabled:c.value<=0,onClick:v},"上移",8,O),(0,a.Lk)("button",{class:"btn btn-secondary",disabled:c.value>=l.value.length-1,onClick:f},"下移",8,F),(0,a.Lk)("button",{class:"btn btn-danger",disabled:0===l.value.length,onClick:p},"删除",8,j)])])):((0,a.uX)(),(0,a.CE)("div",B," 暂无规则，点击“新增规则”开始配置 "))])]),(0,a.Lk)("div",{class:"footer"},[(0,a.Lk)("button",{class:"btn btn-secondary",onClick:X},"取消"),(0,a.Lk)("button",{class:"btn",onClick:U},"保存")])])])):(0,a.Q3)("v-if",!0)}});var U=t(5072),W=t.n(U),q=t(7825),G=t.n(q),H=t(7659),V=t.n(H),Q=t(5056),K=t.n(Q),Y=t(540),J=t.n(Y),Z=t(1113),ee=t.n(Z),ne=t(1153),te={};te.styleTagTransform=ee(),te.setAttributes=K(),te.insert=V().bind(null,"head"),te.domAPI=G(),te.insertStyleElement=J(),W()(ne.A,te),ne.A&&ne.A.locals&&ne.A.locals;var ae=t(6262);const re=(0,ae.A)(X,[["__scopeId","data-v-a2196f8c"]]);var oe=t(9313),ie=t(8220),se=t(1184),le=t(9173),ce=t(7760),de=t(4965);const ue={class:"settings-panel"},pe={class:"panel-header"},ve={class:"header-left"},fe={class:"header-info"},he={class:"panel-title"},me={class:"settings-subtitle"},ge={class:"header-actions"},be={class:"btn-text"},ye={class:"btn-text"},xe={class:"settings-container"},ke={class:"settings-section"},we={class:"section-header"},_e={class:"section-title"},Ce={class:"settings-list"},Ae={class:"setting-item"},Se={class:"setting-info"},Le={class:"setting-name"},Ee={class:"setting-desc"},Te={class:"setting-control"},Ie={class:"setting-item"},Re={class:"setting-info"},Me={class:"setting-name"},Pe={class:"setting-desc"},De={class:"setting-control"},ze={value:"light"},Ne={value:"dark"},$e={value:"xiantu"},Oe={value:"auto"},Fe={class:"setting-item"},je={class:"setting-info"},Be={class:"setting-name"},Xe={class:"setting-desc"},Ue={class:"setting-control"},We={class:"range-container"},qe={class:"range-value"},Ge={class:"setting-item"},He={class:"setting-info"},Ve={class:"setting-name"},Qe={class:"setting-desc"},Ke={class:"setting-control"},Ye={class:"range-container"},Je={class:"range-value"},Ze={class:"setting-item"},en={class:"setting-info"},nn={class:"setting-name"},tn={class:"setting-desc"},an={class:"setting-control"},rn={class:"setting-switch"},on={class:"settings-section"},sn={class:"section-header"},ln={class:"section-title"},cn={class:"settings-list"},dn={key:0,class:"setting-item setting-item-full"},un={class:"setting-info"},pn={class:"setting-name"},vn={class:"setting-desc"},fn={class:"setting-control-full",style:{display:"flex",gap:"0.5rem"}},hn=["placeholder"],mn=["disabled"],gn={class:"setting-item"},bn={class:"setting-info"},yn={class:"setting-name"},xn={class:"setting-desc"},kn={class:"setting-control"},wn={class:"setting-switch"},_n={class:"setting-item setting-item-full"},Cn={class:"setting-info"},An={class:"setting-name"},Sn={class:"setting-desc"},Ln={class:"setting-control-full"},En=["placeholder"],Tn={class:"settings-section"},In={class:"section-header"},Rn={class:"section-title"},Mn={class:"settings-list"},Pn={class:"setting-item"},Dn={class:"setting-info"},zn={class:"setting-name"},Nn={class:"setting-desc"},$n={class:"setting-control"},On={class:"setting-item"},Fn={class:"setting-info"},jn={class:"setting-name"},Bn={class:"setting-desc"},Xn={class:"setting-control"},Un={class:"setting-switch"},Wn={key:0,class:"setting-item"},qn={class:"setting-info"},Gn={class:"setting-name"},Hn={class:"setting-desc"},Vn={class:"setting-control"},Qn={class:"setting-switch"},Kn={key:1,class:"setting-item"},Yn={class:"setting-info"},Jn={class:"setting-name"},Zn={class:"setting-desc"},et={class:"setting-control"},nt={class:"setting-switch"},tt={class:"setting-item"},at={class:"setting-info"},rt={class:"setting-name"},ot={class:"setting-desc"},it={class:"setting-control"},st={key:0},lt={class:"prompt-modal-content"},ct={class:"prompt-modal-header"},dt={class:"prompt-modal-body"},ut={class:"setting-item"},pt={class:"setting-info"},vt={class:"setting-name"},ft={class:"setting-desc"},ht={class:"setting-control"},mt={class:"setting-item"},gt={class:"setting-info"},bt={class:"setting-name"},yt={class:"setting-desc"},xt={class:"setting-control"},kt={class:"setting-item"},wt={class:"setting-info"},_t={class:"setting-name"},Ct={class:"setting-desc"},At={class:"setting-control"},St=(0,a.pM)({__name:"SettingsPanel",setup(e){const{t:n,setLanguage:t,currentLanguage:m}=(0,h.s)(),g=(0,ie.useCharacterStore)(),b=(0,se.useGameStateStore)(),y=(0,le.useUIStore)(),x=()=>{t(m.value),v.o.success("语言设置已更新")},k=(0,o.KR)(""),w=(0,a.EW)(()=>b.character?.名字||""),_=async()=>{if(k.value&&k.value!==w.value)try{b.character&&(b.character.名字=k.value);const e=g.rootState.当前激活存档?.存档槽位;e&&await g.saveToSlot(e),v.o.success(`道号已修改为「${k.value}」`),k.value=""}catch(e){console.error("修改道号失败:",e),v.o.error("修改道号失败，请重试")}},C=(0,o.Kh)({theme:"auto",uiScale:100,fontSize:16,fastAnimations:!1,splitResponseGeneration:!1,enableNsfwMode:!0,nsfwGenderFilter:"female",debugMode:!1,consoleDebug:!1,performanceMonitor:!1,replaceRules:[]}),A=(0,o.KR)(!1),S=(0,o.KR)(!1),L=(0,o.KR)(!1),E=(0,o.KR)(!1),T=(0,a.EW)(()=>{const e=C.replaceRules;return Array.isArray(e)?e.filter(e=>e&&e.enabled).length:0}),I=e=>Array.isArray(e)?e.slice(0,50).map((e,n)=>({id:"string"==typeof e?.id?e.id.slice(0,80):`rule_${n}`,enabled:!1!==e?.enabled,mode:"text"===e?.mode?"text":"regex",pattern:"string"==typeof e?.pattern?e.pattern.slice(0,500):"",replacement:"string"==typeof e?.replacement?e.replacement.slice(0,1500):"",ignoreCase:!!e?.ignoreCase,global:!1!==e?.global,multiline:!!e?.multiline,dotAll:!!e?.dotAll})):[],R=e=>{const n=I(e);C.replaceRules=n,(e=>{try{const n=localStorage.getItem("dad_game_settings"),t=n?JSON.parse(n):{},a={...t&&"object"==typeof t&&!Array.isArray(t)?t:{},replaceRules:e};localStorage.setItem("dad_game_settings",JSON.stringify(a))}catch{}})(n),M()};(0,a.wB)(C,()=>{S.value=!0},{deep:!0}),(0,a.wB)(()=>C.debugMode,e=>{f.Yz.setMode(e),f.Yz.log("设置面板","调试模式"+(e?"已启用":"已禁用"))});const M=()=>{S.value=!0},P=async()=>{if(!A.value){A.value=!0,f.Yz.timeStart("保存设置");try{D(),localStorage.setItem("dad_game_settings",JSON.stringify(C)),f.Yz.log("设置面板","设置已保存到localStorage",C),await z(),S.value=!1,v.o.success("设置已保存并应用")}catch(e){f.Yz.error("设置面板","保存设置失败",e),v.o.error(`保存设置失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{A.value=!1,f.Yz.timeEnd("保存设置")}}},D=()=>{f.Yz.group("设置验证");try{(C.uiScale<50||C.uiScale>200)&&(C.uiScale=Math.max(50,Math.min(200,C.uiScale)),f.Yz.warn("设置面板",`UI缩放值已修正为: ${C.uiScale}%`)),"boolean"!=typeof C.splitResponseGeneration&&(C.splitResponseGeneration=!1);const e=C.replaceRules;C.replaceRules=I(e),f.Yz.log("设置面板","设置验证完成")}catch(e){throw f.Yz.error("设置面板","设置验证失败",e),new Error("设置验证失败")}finally{f.Yz.groupEnd()}},z=async()=>{f.Yz.group("应用设置");try{N(),$(),O(),F(),f.Yz.setMode(C.debugMode),f.Yz.log("设置面板","所有设置已应用")}catch(e){throw f.Yz.error("设置面板","应用设置时出错",e),e}finally{f.Yz.groupEnd()}},N=()=>{let e=C.theme;"auto"===C.theme&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme",e),f.Yz.log("设置面板",`主题已应用: ${e}`)},$=()=>{const e=C.uiScale/100;document.documentElement.style.setProperty("--ui-scale",e.toString()),f.Yz.log("设置面板",`UI缩放已应用: ${C.uiScale}%`)},O=()=>{const e=`${C.fontSize}px`;document.documentElement.style.setProperty("--base-font-size",e),f.Yz.log("设置面板",`字体大小已应用: ${e}`)},F=()=>{const e=C.fastAnimations?.12:.2;document.documentElement.style.setProperty("--transition-fast",`all ${e}s ease-in-out`),f.Yz.log("设置面板",`动画速度已应用: ${e}s`)},j=()=>{y.showRetryDialog({title:"重置设置",message:"确定要重置所有设置为默认值吗？这将清除所有自定义配置。",confirmText:"确认重置",cancelText:"取消",onConfirm:()=>{f.Yz.log("设置面板","开始重置设置"),Object.assign(C,{theme:"auto",uiScale:100,fontSize:16,fastAnimations:!1,splitResponseGeneration:!1,debugMode:!1,consoleDebug:!1,performanceMonitor:!1}),P(),v.o.info("设置已重置为默认值")},onCancel:()=>{}})},B=async()=>{y.showRetryDialog({title:"清理缓存",message:"确定要清理缓存吗？这将删除临时数据但不会影响存档。",confirmText:"确认清理",cancelText:"取消",onConfirm:async()=>{f.Yz.log("设置面板","开始清理缓存");try{const e=[];for(let n=0;n<localStorage.length;n++){const t=localStorage.key(n);t&&(t.startsWith("dad_cache_")||t.startsWith("temp_")||t.startsWith("debug_")||t.includes("_temp"))&&e.push(t)}e.forEach(e=>localStorage.removeItem(e)),sessionStorage.clear(),f.Yz.log("设置面板",`缓存清理完成，共清理 ${e.length} 项数据`),v.o.success(`已清理 ${e.length} 项缓存数据`)}catch(e){f.Yz.error("设置面板","清理缓存失败",e),v.o.error("清理缓存失败")}},onCancel:()=>{}})},X=()=>{f.Yz.log("设置面板","开始导出设置");try{const e={settings:C,exportInfo:{timestamp:(new Date).toISOString(),version:"3.7.4",userAgent:navigator.userAgent,gameVersion:"仙途 v3.7.4"}},n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(t);const r=(new Date).toISOString().split("T")[0];a.download=`仙途-设置备份-${r}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href),f.Yz.log("设置面板","设置导出成功"),v.o.success("设置已导出")}catch(e){f.Yz.error("设置面板","导出设置失败",e),v.o.error("导出设置失败")}},U=()=>{f.Yz.log("设置面板","开始导入设置");const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.text(),t=JSON.parse(e),a=(0,ce.ZT)(t);let r=null;if("settings"===a.type?r=a.payload:t.settings?r=t.settings:null===a.type&&"object"==typeof a.payload&&(r=a.payload),!r||"object"!=typeof r)throw new Error("无效的设置文件格式");const o={...C,...r};Object.assign(C,o),await P(),f.Yz.log("设置面板","设置导入成功",r),v.o.success("设置导入成功并已应用")}catch(e){f.Yz.error("设置面板","导入设置失败",e),v.o.error(`导入设置失败: ${e instanceof Error?e.message:"请检查文件格式"}`)}},e.click()},W=()=>{E.value=!0};return(0,de.rd)(),(0,a.sV)(()=>{f.Yz.log("设置面板","组件已加载"),(async()=>{f.Yz.timeStart("加载设置");try{const e=localStorage.getItem("dad_game_settings");if(e){const n=JSON.parse(e);Object.assign(C,n),f.Yz.log("设置面板","设置加载成功",n)}else f.Yz.log("设置面板","使用默认设置")}catch(e){f.Yz.error("设置面板","加载设置失败",e),v.o.error("加载设置失败，将使用默认设置")}finally{f.Yz.timeEnd("加载设置")}})(),f.Yz.log("设置面板","向量记忆配置加载（功能待实现）")}),(e,t)=>((0,a.uX)(),(0,a.CE)("div",ue,[(0,a.Q3)(" 头部 "),(0,a.Lk)("div",pe,[(0,a.Lk)("div",ve,[t[16]||(t[16]=(0,a.Lk)("div",{class:"header-icon"},"⚙️",-1)),(0,a.Lk)("div",fe,[(0,a.Lk)("h3",he,(0,r.v_)((0,o.R1)(n)("游戏设置")),1),(0,a.Lk)("span",me,(0,r.v_)((0,o.R1)(n)("自定义您的游戏体验")),1)])]),(0,a.Lk)("div",ge,[(0,a.Lk)("button",{class:"action-btn",onClick:j},[(0,a.bF)((0,o.R1)(s.A),{size:16}),(0,a.Lk)("span",be,(0,r.v_)((0,o.R1)(n)("重置")),1)]),(0,a.Lk)("button",{class:"action-btn primary",onClick:P},[(0,a.bF)((0,o.R1)(l.A),{size:16}),(0,a.Lk)("span",ye,(0,r.v_)((0,o.R1)(n)("保存")),1)])])]),(0,a.Q3)(" 设置内容 "),(0,a.Lk)("div",xe,[(0,a.Q3)(" 显示设置 "),(0,a.Lk)("div",ke,[(0,a.Lk)("div",we,[(0,a.Lk)("h4",_e,"🎨 "+(0,r.v_)((0,o.R1)(n)("显示设置")),1)]),(0,a.Lk)("div",Ce,[(0,a.Lk)("div",Ae,[(0,a.Lk)("div",Se,[(0,a.Lk)("label",Le,(0,r.v_)((0,o.R1)(n)("语言设置")),1),(0,a.Lk)("span",Ee,(0,r.v_)((0,o.R1)(n)("选择界面语言")),1)]),(0,a.Lk)("div",Te,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.i9)(m)?m.value=e:null),class:"setting-select",onChange:x},t[17]||(t[17]=[(0,a.Lk)("option",{value:"zh"},"中文",-1),(0,a.Lk)("option",{value:"en"},"English",-1)]),544),[[i.u1,(0,o.R1)(m)]])])]),(0,a.Lk)("div",Ie,[(0,a.Lk)("div",Re,[(0,a.Lk)("label",Me,(0,r.v_)((0,o.R1)(n)("主题模式")),1),(0,a.Lk)("span",Pe,(0,r.v_)((0,o.R1)(n)("选择界面主题风格")),1)]),(0,a.Lk)("div",De,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>C.theme=e),class:"setting-select",onChange:M},[(0,a.Lk)("option",ze,(0,r.v_)((0,o.R1)(n)("明亮")),1),(0,a.Lk)("option",Ne,(0,r.v_)((0,o.R1)(n)("暗黑")),1),(0,a.Lk)("option",$e,(0,r.v_)((0,o.R1)(n)("仙途")),1),(0,a.Lk)("option",Oe,(0,r.v_)((0,o.R1)(n)("跟随系统")),1)],544),[[i.u1,C.theme]])])]),(0,a.Lk)("div",Fe,[(0,a.Lk)("div",je,[(0,a.Lk)("label",Be,(0,r.v_)((0,o.R1)(n)("界面缩放")),1),(0,a.Lk)("span",Xe,(0,r.v_)((0,o.R1)(n)("调整UI界面大小")),1)]),(0,a.Lk)("div",Ue,[(0,a.Lk)("div",We,[(0,a.bo)((0,a.Lk)("input",{type:"range","onUpdate:modelValue":t[2]||(t[2]=e=>C.uiScale=e),min:"80",max:"120",step:"5",class:"setting-range",onInput:$},null,544),[[i.Jo,C.uiScale,void 0,{number:!0}]]),(0,a.Lk)("span",qe,(0,r.v_)(C.uiScale)+"%",1)])])]),(0,a.Lk)("div",Ge,[(0,a.Lk)("div",He,[(0,a.Lk)("label",Ve,(0,r.v_)((0,o.R1)(n)("文字大小")),1),(0,a.Lk)("span",Qe,(0,r.v_)((0,o.R1)(n)("调整游戏文字显示大小（像素）")),1)]),(0,a.Lk)("div",Ke,[(0,a.Lk)("div",Ye,[(0,a.bo)((0,a.Lk)("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=e=>C.fontSize=e),min:"12",max:"24",step:"1",class:"setting-range",onInput:O},null,544),[[i.Jo,C.fontSize,void 0,{number:!0}]]),(0,a.Lk)("span",Je,(0,r.v_)(C.fontSize)+"px",1)])])]),(0,a.Lk)("div",Ze,[(0,a.Lk)("div",en,[(0,a.Lk)("label",nn,(0,r.v_)((0,o.R1)(n)("快速动画")),1),(0,a.Lk)("span",tn,(0,r.v_)((0,o.R1)(n)("加速界面动画和过渡效果")),1)]),(0,a.Lk)("div",an,[(0,a.Lk)("label",rn,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>C.fastAnimations=e),onChange:t[5]||(t[5]=e=>{F(),M()})},null,544),[[i.lH,C.fastAnimations]]),t[18]||(t[18]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])])])]),(0,a.Q3)(" 游戏功能 "),(0,a.Lk)("div",on,[(0,a.Lk)("div",sn,[(0,a.Lk)("h4",ln,"🎮 "+(0,r.v_)((0,o.R1)(n)("游戏功能")),1)]),(0,a.Lk)("div",cn,[(0,a.Q3)(" 道号修改 "),w.value?((0,a.uX)(),(0,a.CE)("div",dn,[(0,a.Lk)("div",un,[(0,a.Lk)("label",pn,(0,r.v_)((0,o.R1)(n)("修改道号")),1),(0,a.Lk)("span",vn,(0,r.v_)((0,o.R1)(n)("修改当前角色的名字")),1)]),(0,a.Lk)("div",fn,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>k.value=e),class:"form-input-inline",placeholder:w.value,style:{flex:"1"}},null,8,hn),[[i.Jo,k.value]]),(0,a.Lk)("button",{class:"utility-btn primary",onClick:_,disabled:!k.value||k.value===w.value},[(0,a.bF)((0,o.R1)(l.A),{size:16}),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("确认")),1)],8,mn)])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",gn,[(0,a.Lk)("div",bn,[(0,a.Lk)("label",yn,(0,r.v_)((0,o.R1)(n)("行动选项")),1),(0,a.Lk)("span",xn,(0,r.v_)((0,o.R1)(n)("AI生成可选的行动建议")),1)]),(0,a.Lk)("div",kn,[(0,a.Lk)("label",wn,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>(0,o.R1)(y).enableActionOptions=e)},null,512),[[i.lH,(0,o.R1)(y).enableActionOptions]]),t[19]||(t[19]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])]),(0,a.Lk)("div",_n,[(0,a.Lk)("div",Cn,[(0,a.Lk)("label",An,(0,r.v_)((0,o.R1)(n)("自定义行动选项提示词")),1),(0,a.Lk)("span",Sn,(0,r.v_)((0,o.R1)(n)("指导AI生成特定风格的行动选项（可选，留空使用默认）")),1)]),(0,a.Lk)("div",Ln,[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>(0,o.R1)(y).actionOptionsPrompt=e),class:"setting-textarea",placeholder:(0,o.R1)(n)("例如：多生成修炼和探索类选项，减少战斗选项..."),rows:"3"},null,8,En),[[i.Jo,(0,o.R1)(y).actionOptionsPrompt]])])])])]),(0,a.Q3)(" 高级设置 "),(0,a.Lk)("div",Tn,[(0,a.Lk)("div",In,[(0,a.Lk)("h4",Rn,(0,r.v_)((0,o.R1)(n)("🔧 高级设置")),1)]),(0,a.Lk)("div",Mn,[(0,a.Lk)("div",Pn,[(0,a.Lk)("div",Dn,[(0,a.Lk)("label",zn,(0,r.v_)((0,o.R1)(n)("提示词管理")),1),(0,a.Lk)("span",Nn,(0,r.v_)((0,o.R1)(n)("跳转到提示词页面修改提示词")),1)]),(0,a.Lk)("div",$n,[(0,a.Lk)("button",{class:"utility-btn",onClick:W},[(0,a.bF)((0,o.R1)(c.A),{size:16}),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("打开")),1)])])]),(0,a.Lk)("div",On,[(0,a.Lk)("div",Fn,[(0,a.Lk)("label",jn,(0,r.v_)((0,o.R1)(n)("调试模式")),1),(0,a.Lk)("span",Bn,(0,r.v_)((0,o.R1)(n)("启用开发者调试信息和详细日志")),1)]),(0,a.Lk)("div",Xn,[(0,a.Lk)("label",Un,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>C.debugMode=e),onChange:M},null,544),[[i.lH,C.debugMode]]),t[20]||(t[20]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])]),C.debugMode?((0,a.uX)(),(0,a.CE)("div",Wn,[(0,a.Lk)("div",qn,[(0,a.Lk)("label",Gn,(0,r.v_)((0,o.R1)(n)("控制台调试")),1),(0,a.Lk)("span",Hn,(0,r.v_)((0,o.R1)(n)("在浏览器控制台显示详细调试信息")),1)]),(0,a.Lk)("div",Vn,[(0,a.Lk)("label",Qn,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>C.consoleDebug=e),onChange:M},null,544),[[i.lH,C.consoleDebug]]),t[21]||(t[21]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])])):(0,a.Q3)("v-if",!0),C.debugMode?((0,a.uX)(),(0,a.CE)("div",Kn,[(0,a.Lk)("div",Yn,[(0,a.Lk)("label",Jn,(0,r.v_)((0,o.R1)(n)("性能监控")),1),(0,a.Lk)("span",Zn,(0,r.v_)((0,o.R1)(n)("监控组件性能和加载时间")),1)]),(0,a.Lk)("div",et,[(0,a.Lk)("label",nt,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>C.performanceMonitor=e),onChange:M},null,544),[[i.lH,C.performanceMonitor]]),t[22]||(t[22]=(0,a.Lk)("span",{class:"switch-slider"},null,-1))])])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",tt,[(0,a.Lk)("div",at,[(0,a.Lk)("label",rt,(0,r.v_)((0,o.R1)(n)("正则替换规则")),1),(0,a.Lk)("span",ot,(0,r.v_)((0,o.R1)(n)("对AI输出进行替换：正则 / 纯文本（用于格式修正、屏蔽词替换等）")),1)]),(0,a.Lk)("div",it,[(0,a.Lk)("button",{class:"utility-btn",onClick:t[12]||(t[12]=e=>L.value=!0)},[(0,a.eW)((0,r.v_)((0,o.R1)(n)("编辑规则"))+" ",1),T.value>0?((0,a.uX)(),(0,a.CE)("span",st,"("+(0,r.v_)(T.value)+")",1)):(0,a.Q3)("v-if",!0)])])]),(0,a.bF)(re,{open:L.value,rules:C.replaceRules,onClose:t[13]||(t[13]=e=>L.value=!1),onSave:R},null,8,["open","rules"]),(0,a.Q3)(" 提示词管理弹窗 "),E.value?((0,a.uX)(),(0,a.CE)("div",{key:2,class:"prompt-modal-overlay",onClick:t[15]||(t[15]=(0,i.D$)(e=>E.value=!1,["self"]))},[(0,a.Lk)("div",lt,[(0,a.Lk)("div",ct,[t[23]||(t[23]=(0,a.Lk)("h3",null,"提示词管理",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[14]||(t[14]=e=>E.value=!1)},"×")]),(0,a.Lk)("div",dt,[(0,a.bF)(oe.A)])])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",ut,[(0,a.Lk)("div",pt,[(0,a.Lk)("label",vt,(0,r.v_)((0,o.R1)(n)("导入设置")),1),(0,a.Lk)("span",ft,(0,r.v_)((0,o.R1)(n)("从文件恢复设置配置")),1)]),(0,a.Lk)("div",ht,[(0,a.Lk)("button",{class:"utility-btn",onClick:U},[(0,a.bF)((0,o.R1)(d.A),{size:16}),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("导入")),1)])])]),(0,a.Lk)("div",mt,[(0,a.Lk)("div",gt,[(0,a.Lk)("label",bt,(0,r.v_)((0,o.R1)(n)("清理缓存")),1),(0,a.Lk)("span",yt,(0,r.v_)((0,o.R1)(n)("清除游戏临时数据和缓存")),1)]),(0,a.Lk)("div",xt,[(0,a.Lk)("button",{class:"utility-btn",onClick:B},[(0,a.bF)((0,o.R1)(u.A),{size:16}),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("清理")),1)])])]),(0,a.Lk)("div",kt,[(0,a.Lk)("div",wt,[(0,a.Lk)("label",_t,(0,r.v_)((0,o.R1)(n)("导出设置")),1),(0,a.Lk)("span",Ct,(0,r.v_)((0,o.R1)(n)("备份当前设置配置")),1)]),(0,a.Lk)("div",At,[(0,a.Lk)("button",{class:"utility-btn",onClick:X},[(0,a.bF)((0,o.R1)(p.A),{size:16}),(0,a.eW)(" "+(0,r.v_)((0,o.R1)(n)("导出")),1)])])])])])])]))}});var Lt=t(4728),Et={};Et.styleTagTransform=ee(),Et.setAttributes=K(),Et.insert=V().bind(null,"head"),Et.domAPI=G(),Et.insertStyleElement=J(),W()(Lt.A,Et),Lt.A&&Lt.A.locals&&Lt.A.locals;const Tt=(0,ae.A)(St,[["__scopeId","data-v-076944a6"]])},5345:e=>{"use strict";e.exports=URIError},5349:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.mutant-panel[data-v-085cad4a] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  color: var(--color-text);\n  padding: 1rem;\n  overflow-y: auto;\n}\n.panel-header[data-v-085cad4a] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.panel-title[data-v-085cad4a] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: var(--color-text-highlight);\n  margin: 0;\n}\n.creature-count[data-v-085cad4a] {\n  margin-left: 1rem;\n  font-size: 0.875rem;\n  color: var(--color-text-muted);\n}\n.creature-grid[data-v-085cad4a] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n  gap: 1rem;\n}\n.creature-card[data-v-085cad4a] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  transition: all 0.2s;\n}\n.creature-card[data-v-085cad4a]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border-color: var(--color-primary);\n}\n\n/* Level Styles */\n.creature-card.S[data-v-085cad4a] { border-color: #ef4444;\n}\n.creature-card.A[data-v-085cad4a] { border-color: #f97316;\n}\n.creature-card.B[data-v-085cad4a] { border-color: #eab308;\n}\n.creature-card.C[data-v-085cad4a] { border-color: #3b82f6;\n}\n.creature-card.D[data-v-085cad4a] { border-color: #22c55e;\n}\n.creature-card.E[data-v-085cad4a] { border-color: #a8a29e;\n}\n.creature-card.F[data-v-085cad4a] { border-color: #78716c;\n}\n.card-header[data-v-085cad4a] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  justify-content: space-between;\n}\n.level-badge[data-v-085cad4a] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  font-weight: bold;\n  background: var(--color-background-soft);\n}\n.S .level-badge[data-v-085cad4a] { background: #fee2e2; color: #ef4444;\n}\n.A .level-badge[data-v-085cad4a] { background: #ffedd5; color: #f97316;\n}\n.B .level-badge[data-v-085cad4a] { background: #fef9c3; color: #eab308;\n}\n.C .level-badge[data-v-085cad4a] { background: #dbeafe; color: #3b82f6;\n}\n.D .level-badge[data-v-085cad4a] { background: #dcfce7; color: #22c55e;\n}\n.creature-name[data-v-085cad4a] {\n  font-size: 1.125rem;\n  font-weight: bold;\n  margin: 0;\n}\n.delete-btn[data-v-085cad4a] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-danger, #ef4444);\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  cursor: pointer;\n}\n.delete-btn[data-v-085cad4a]:hover {\n  border-color: var(--color-danger, #ef4444);\n  background: rgba(239, 68, 68, 0.08);\n}\n.delete-text[data-v-085cad4a] {\n  font-size: 0.75rem;\n}\n.card-body[data-v-085cad4a] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.info-row[data-v-085cad4a] {\n  font-size: 0.875rem;\n  color: var(--color-text-muted);\n  display: flex;\n  gap: 0.5rem;\n}\n.appearance-text[data-v-085cad4a] {\n  font-size: 0.875rem;\n  line-height: 1.4;\n  color: var(--color-text);\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n.stats-grid[data-v-085cad4a] {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 0.5rem;\n  background: var(--color-background-soft);\n  padding: 0.5rem;\n  border-radius: 0.25rem;\n  margin-top: 0.5rem;\n}\n.stat-item[data-v-085cad4a] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.stat-label[data-v-085cad4a] {\n  font-size: 0.75rem;\n  color: var(--color-text-muted);\n}\n.stat-value[data-v-085cad4a] {\n  font-weight: bold;\n  font-size: 0.875rem;\n}\n.mutation-section[data-v-085cad4a] {\n  border-top: 1px dashed var(--color-border);\n  padding-top: 0.5rem;\n  margin-top: 0.5rem;\n}\n.mutation-title[data-v-085cad4a] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  font-size: 0.875rem;\n  font-weight: bold;\n  color: var(--color-primary);\n  margin-bottom: 0.25rem;\n}\n.mutation-desc[data-v-085cad4a] {\n  font-size: 0.75rem;\n  color: var(--color-text-muted);\n}\n.weakness-tags[data-v-085cad4a] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n  margin-top: 0.5rem;\n}\n.tag.weakness[data-v-085cad4a] {\n  background: #fee2e2;\n  color: #ef4444;\n  padding: 0.125rem 0.375rem;\n  border-radius: 9999px;\n  font-size: 0.75rem;\n}\n.empty-state[data-v-085cad4a] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-muted);\n  gap: 1rem;\n}\n",""]);const s=i},5365:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},5373:(e,n,t)=>{"use strict";var a=t(8636),r=t(2642),o=t(4765);e.exports={formats:o,parse:r,stringify:a}},5517:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},5609:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.modal-overlay[data-v-6ec25edf] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n}\n.modal-dialog[data-v-6ec25edf] {\n  width: 90%;\n  max-width: 600px;\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n  border-radius: 12px;\n  padding: 2rem;\n  overflow: hidden;\n}\n.modal-title[data-v-6ec25edf] {\n  margin-top: 0;\n  color: var(--color-primary);\n  text-align: center;\n  margin-bottom: 1.5rem;\n  flex-shrink: 0;\n}\n.form-fields[data-v-6ec25edf] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n  padding-right: 0.5rem;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar {\n  width: 8px;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 4px;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-primary-rgb), 0.3);\n  border-radius: 4px;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar-thumb:hover {\n  background: rgba(var(--color-primary-rgb), 0.5);\n}\n.form-group label[data-v-6ec25edf] {\n  display: block;\n  margin-bottom: 0.5rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.form-group input[data-v-6ec25edf],\n.form-group textarea[data-v-6ec25edf],\n.form-group select[data-v-6ec25edf] {\n  width: 100%;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 1rem;\n  transition: var(--transition-fast);\n}\ninput[type="color"][data-v-6ec25edf] {\n  padding: 0.25rem;\n  height: 2.5rem;\n}\ninput[type="color"][data-v-6ec25edf] {\n  padding: 0.25rem;\n  height: 2.5rem;\n}\n.form-group input[data-v-6ec25edf]:focus,\n.form-group textarea[data-v-6ec25edf]:focus,\n.form-group select[data-v-6ec25edf]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n.error-messages[data-v-6ec25edf] {\n    color: var(--color-danger);\n    margin-bottom: 1rem;\n    font-size: 0.9rem;\n    flex-shrink: 0;\n}\n.modal-actions[data-v-6ec25edf] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  margin-top: 1rem;\n  flex-shrink: 0;\n}\n\n/* Transition styles */\n.modal-fade-enter-active[data-v-6ec25edf], .modal-fade-leave-active[data-v-6ec25edf] {\n  transition: opacity 0.3s ease;\n}\n.modal-fade-enter-from[data-v-6ec25edf], .modal-fade-leave-to[data-v-6ec25edf] {\n  opacity: 0;\n}\n.modal-fade-enter-active .modal-content[data-v-6ec25edf],\n.modal-fade-leave-active .modal-content[data-v-6ec25edf] {\n  transition: transform 0.3s ease;\n}\n.modal-fade-enter-from .modal-content[data-v-6ec25edf],\n.modal-fade-leave-to .modal-content[data-v-6ec25edf] {\n  transform: scale(0.9);\n}\n\n/* 动态列表样式 */\n.dynamic-list-container[data-v-6ec25edf] {\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  padding: 1rem;\n}\n.list-header[data-v-6ec25edf] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.add-btn[data-v-6ec25edf] {\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  padding: 0.5rem 1rem;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s ease;\n}\n.add-btn[data-v-6ec25edf]:hover {\n  background: var(--color-primary-dark);\n}\n.list-items[data-v-6ec25edf] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.list-item[data-v-6ec25edf] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n}\n.item-inputs[data-v-6ec25edf] {\n  display: flex;\n  gap: 0.5rem;\n  flex: 1;\n}\n.item-input[data-v-6ec25edf] {\n  flex: 1;\n  padding: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.item-input[data-v-6ec25edf]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 5px rgba(var(--color-primary-rgb), 0.3);\n}\n.remove-btn[data-v-6ec25edf] {\n  background: var(--color-danger);\n  color: white;\n  border: none;\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  cursor: pointer;\n  font-size: 1.2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.remove-btn[data-v-6ec25edf]:hover {\n  background: #dc2626;\n  transform: scale(1.1);\n}\n.empty-list[data-v-6ec25edf] {\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-style: italic;\n  padding: 2rem;\n}\n@media (max-width: 600px) {\n.modal-dialog[data-v-6ec25edf] {\n    padding: 1.5rem;\n    width: 95%;\n    max-height: 90vh;\n}\n.item-inputs[data-v-6ec25edf] {\n    flex-direction: column;\n}\n.modal-actions[data-v-6ec25edf] {\n    flex-direction: column-reverse;\n    gap: 0.5rem;\n}\n.modal-actions .btn[data-v-6ec25edf] {\n    width: 100%;\n}\n}\n',""]);const s=i},5674:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.error-boundary[data-v-7ca07f60] {\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  padding: 2rem;\n}\n.error-container[data-v-7ca07f60] {\n  max-width: 600px;\n  width: 100%;\n  background: var(--color-surface);\n  border: 2px solid var(--color-error);\n  border-radius: 12px;\n  padding: 2rem;\n  text-align: center;\n}\n.error-icon[data-v-7ca07f60] {\n  font-size: 4rem;\n  margin-bottom: 1rem;\n}\n.error-container h2[data-v-7ca07f60] {\n  color: var(--color-error);\n  margin: 0 0 1rem 0;\n  font-size: 1.8rem;\n}\n.error-message[data-v-7ca07f60] {\n  color: var(--color-text);\n  margin: 0 0 1.5rem 0;\n  font-size: 1rem;\n  line-height: 1.6;\n}\n.error-details[data-v-7ca07f60] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-bottom: 1.5rem;\n  text-align: left;\n  max-height: 300px;\n  overflow-y: auto;\n}\n.error-details pre[data-v-7ca07f60] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n.error-actions[data-v-7ca07f60] {\n  display: flex;\n  gap: 1rem;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n.btn-retry[data-v-7ca07f60],\n.btn-back[data-v-7ca07f60],\n.btn-details[data-v-7ca07f60] {\n  padding: 0.75rem 1.5rem;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n  border: none;\n}\n.btn-retry[data-v-7ca07f60] {\n  background: var(--color-primary);\n  color: white;\n}\n.btn-retry[data-v-7ca07f60]:hover {\n  background: var(--color-primary-dark);\n  transform: translateY(-2px);\n}\n.btn-back[data-v-7ca07f60] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-back[data-v-7ca07f60]:hover {\n  background: var(--color-background);\n}\n.btn-details[data-v-7ca07f60] {\n  background: var(--color-info);\n  color: white;\n}\n.btn-details[data-v-7ca07f60]:hover {\n  background: var(--color-info-dark);\n}\n@media (max-width: 640px) {\n.error-boundary[data-v-7ca07f60] {\n    padding: 1rem;\n}\n.error-container[data-v-7ca07f60] {\n    padding: 1.5rem;\n}\n.error-container h2[data-v-7ca07f60] {\n    font-size: 1.5rem;\n}\n.error-actions[data-v-7ca07f60] {\n    flex-direction: column;\n}\n.btn-retry[data-v-7ca07f60],\n  .btn-back[data-v-7ca07f60],\n  .btn-details[data-v-7ca07f60] {\n    width: 100%;\n}\n}\n",""]);const s=i},5726:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]])},5733:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 4.0 全新视觉系统 - 世界选择 ========== */\n.world-selection-container[data-v-62183c17] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.loading-state[data-v-62183c17], .error-state[data-v-62183c17], .placeholder[data-v-62183c17] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n  letter-spacing: 0.1em;\n}\n.world-layout[data-v-62183c17] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 - 4.0 风格 ========== */\n.left-panel[data-v-62183c17] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(147, 197, 253, 0.12);\n  border-radius: 16px;\n  overflow: hidden;\n  position: relative;\n}\n.left-panel[data-v-62183c17]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 60px;\n  background: linear-gradient(to bottom, rgba(147, 197, 253, 0.05), transparent);\n  pointer-events: none;\n}\n\n/* 顶部功能按钮 */\n.top-actions-container[data-v-62183c17] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-62183c17] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-62183c17]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n.list-container[data-v-62183c17] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.6rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.list-container[data-v-62183c17]::-webkit-scrollbar {\n  width: 6px;\n}\n.list-container[data-v-62183c17]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.list-container[data-v-62183c17]::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.4), rgba(59, 130, 246, 0.3));\n  border-radius: 3px;\n}\n.list-container[data-v-62183c17]::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.6), rgba(59, 130, 246, 0.5));\n}\n\n/* ========== 世界选项卡 - 4.0 风格 ========== */\n.list-item[data-v-62183c17] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.5);\n}\n.list-item[data-v-62183c17]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  border-color: rgba(147, 197, 253, 0.25);\n}\n.list-item.selected[data-v-62183c17] {\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.5) 0%, rgba(30, 41, 59, 0.6) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.item-content[data-v-62183c17] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n.item-name[data-v-62183c17] {\n  flex-grow: 1;\n  font-weight: 500;\n  color: #f1f5f9;\n  letter-spacing: 0.05em;\n  transition: color 0.3s ease;\n}\n.list-item.selected .item-name[data-v-62183c17] {\n  color: #bfdbfe;\n  text-shadow: 0 0 12px rgba(147, 197, 253, 0.4);\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-62183c17] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  opacity: 0;\n  transition: opacity 0.25s ease;\n  margin-left: 0.5rem;\n}\n.list-item:hover .action-buttons[data-v-62183c17] {\n  opacity: 1;\n}\n.edit-btn[data-v-62183c17], .delete-btn[data-v-62183c17] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.4rem;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s ease;\n}\n.edit-btn[data-v-62183c17]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.15);\n  border-color: rgba(147, 197, 253, 0.3);\n}\n.delete-btn[data-v-62183c17]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.15);\n  border-color: rgba(248, 113, 113, 0.3);\n}\n\n/* ========== 右侧详情面板 - 4.0 风格 ========== */\n.details-container[data-v-62183c17] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(147, 197, 253, 0.12);\n  border-radius: 16px;\n  padding: 1.75rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  min-height: 0;\n  position: relative;\n}\n.details-container[data-v-62183c17]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 80px;\n  background: radial-gradient(ellipse at 50% 0%, rgba(147, 197, 253, 0.08) 0%, transparent 70%);\n  pointer-events: none;\n}\n.world-details[data-v-62183c17] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n  position: relative;\n  z-index: 1;\n}\n.details-header[data-v-62183c17] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n  margin-bottom: 0.5rem;\n}\n.details-title[data-v-62183c17] {\n  margin: 0;\n  font-size: 1.6rem;\n  font-weight: 600;\n  color: #93c5fd;\n  letter-spacing: 0.1em;\n}\n.map-settings-btn[data-v-62183c17] {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  padding: 0.55rem 0.9rem;\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 10px;\n  background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(51, 65, 85, 0.5) 100%);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  font-size: 0.85rem;\n}\n.map-settings-btn[data-v-62183c17]:hover {\n  background: linear-gradient(135deg, rgba(51, 65, 85, 0.9) 0%, rgba(71, 85, 105, 0.7) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  color: #f1f5f9;\n  transform: translateY(-1px);\n}\n.world-details h2[data-v-62183c17] {\n  margin-top: 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n}\n.world-details .era[data-v-62183c17] {\n  font-style: italic;\n  color: #fbbf24;\n  margin-bottom: 1.25rem;\n  flex-shrink: 0;\n  font-size: 0.95rem;\n  letter-spacing: 0.05em;\n  text-shadow: 0 0 12px rgba(251, 191, 36, 0.3);\n}\n.description-scroll[data-v-62183c17] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.8;\n  padding-right: 0.5rem;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll[data-v-62183c17]::-webkit-scrollbar {\n  width: 6px;\n}\n.description-scroll[data-v-62183c17]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.description-scroll[data-v-62183c17]::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.4), rgba(59, 130, 246, 0.3));\n  border-radius: 3px;\n}\n.description-scroll p[data-v-62183c17] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n  font-size: 0.95rem;\n}\n\n/* ========== 地图生成选项 - 4.0 风格 ========== */\n.map-options[data-v-62183c17] {\n  margin-top: 1rem;\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 12px;\n  padding: 1.25rem;\n  background: linear-gradient(135deg, rgba(30, 41, 59, 0.5) 0%, rgba(51, 65, 85, 0.3) 100%);\n  flex: 1 1 auto;\n  overflow: auto;\n}\n\n/* 仅生成大陆开关 */\n.continents-only-section[data-v-62183c17] {\n  margin-bottom: 1.25rem;\n  padding: 1rem;\n  background: rgba(147, 197, 253, 0.08);\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 10px;\n}\n\n/* 修仙难度选择样式 */\n.difficulty-section[data-v-62183c17] {\n  margin-bottom: 1.25rem;\n  padding: 1rem;\n  background: rgba(251, 191, 36, 0.08);\n  border: 1px solid rgba(251, 191, 36, 0.2);\n  border-radius: 10px;\n}\n.difficulty-label[data-v-62183c17] {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: #fbbf24;\n  margin-bottom: 0.75rem;\n  letter-spacing: 0.05em;\n}\n.difficulty-options[data-v-62183c17] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.6rem;\n}\n.difficulty-option[data-v-62183c17] {\n  display: flex;\n  flex-direction: column;\n  padding: 0.6rem 0.9rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.5);\n  cursor: pointer;\n  transition: all 0.25s ease;\n}\n.difficulty-option[data-v-62183c17]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  border-color: rgba(251, 191, 36, 0.35);\n}\n.difficulty-option.selected[data-v-62183c17] {\n  background: rgba(251, 191, 36, 0.18);\n  border-color: rgba(251, 191, 36, 0.5);\n  box-shadow: 0 0 16px rgba(251, 191, 36, 0.15);\n}\n.difficulty-radio[data-v-62183c17] {\n  display: none;\n}\n.difficulty-name[data-v-62183c17] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #f1f5f9;\n}\n.difficulty-option.selected .difficulty-name[data-v-62183c17] {\n  color: #fbbf24;\n  text-shadow: 0 0 8px rgba(251, 191, 36, 0.4);\n}\n.difficulty-desc[data-v-62183c17] {\n  font-size: 0.72rem;\n  color: #94a3b8;\n  margin-top: 0.25rem;\n}\n.continents-only-toggle[data-v-62183c17] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  cursor: pointer;\n  user-select: none;\n}\n.toggle-checkbox[data-v-62183c17] {\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  accent-color: #93c5fd;\n}\n.toggle-label[data-v-62183c17] {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: #93c5fd;\n  letter-spacing: 0.03em;\n}\n.toggle-hint[data-v-62183c17] {\n  margin-top: 0.6rem;\n  font-size: 0.78rem;\n  color: #94a3b8;\n  line-height: 1.5;\n  padding-left: 1.7rem;\n}\n.config-warning[data-v-62183c17] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.85rem;\n  padding: 0.9rem;\n  margin-bottom: 1.25rem;\n  background: rgba(251, 191, 36, 0.12);\n  border: 1px solid rgba(251, 191, 36, 0.3);\n  border-radius: 10px;\n}\n.warning-icon[data-v-62183c17] {\n  font-size: 1.3rem;\n  flex-shrink: 0;\n}\n.warning-text[data-v-62183c17] {\n  flex: 1;\n}\n.warning-title[data-v-62183c17] {\n  font-weight: 600;\n  font-size: 0.95rem;\n  margin-bottom: 0.3rem;\n  color: #fbbf24;\n}\n.warning-desc[data-v-62183c17] {\n  font-size: 0.82rem;\n  color: #94a3b8;\n  line-height: 1.5;\n}\n.option-item input.config-risky[data-v-62183c17] {\n  border-color: rgba(251, 191, 36, 0.5);\n  background-color: rgba(251, 191, 36, 0.08);\n}\n.config-hint[data-v-62183c17] {\n  font-size: 0.72rem;\n  color: #64748b;\n  margin-top: 0.25rem;\n}\n.map-options-header[data-v-62183c17] {\n  font-weight: 600;\n  color: #93c5fd;\n  margin-bottom: 1rem;\n  font-size: 1rem;\n  letter-spacing: 0.05em;\n}\n.map-options-grid[data-v-62183c17] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));\n  gap: 0.9rem;\n}\n.option-item[data-v-62183c17] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.35rem;\n}\n.option-label[data-v-62183c17] {\n  font-size: 0.82rem;\n  color: #94a3b8;\n  letter-spacing: 0.03em;\n}\n.option-item input[data-v-62183c17] {\n  width: 100%;\n  padding: 0.55rem 0.7rem;\n  border: 1px solid rgba(147, 197, 253, 0.15);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.7);\n  color: #f1f5f9;\n  font-size: 0.88rem;\n  transition: all 0.25s ease;\n}\n.option-item input[data-v-62183c17]:focus {\n  outline: none;\n  border-color: rgba(147, 197, 253, 0.5);\n  box-shadow: 0 0 12px rgba(147, 197, 253, 0.15);\n}\n.option-item input[data-v-62183c17]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.map-options-actions[data-v-62183c17] {\n  display: flex;\n  gap: 0.6rem;\n  margin-top: 1rem;\n}\n.opt-btn[data-v-62183c17] {\n  padding: 0.55rem 1.1rem;\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 8px;\n  background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(51, 65, 85, 0.5) 100%);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n.opt-btn[data-v-62183c17]:hover {\n  background: linear-gradient(135deg, rgba(51, 65, 85, 0.9) 0%, rgba(71, 85, 105, 0.7) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  color: #f1f5f9;\n  transform: translateY(-1px);\n}\n\n/* ========== 空状态 ========== */\n.no-worlds-message[data-v-62183c17] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n  color: #64748b;\n}\n.no-worlds-icon[data-v-62183c17] {\n  font-size: 3rem;\n  margin-bottom: 1.25rem;\n  opacity: 0.7;\n}\n.no-worlds-text[data-v-62183c17] {\n  font-size: 1.05rem;\n  margin-bottom: 0.6rem;\n  color: #94a3b8;\n  letter-spacing: 0.05em;\n}\n.no-worlds-hint[data-v-62183c17] {\n  font-size: 0.88rem;\n  opacity: 0.7;\n  font-style: italic;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .left-panel[data-v-62183c17],\n[data-theme="light"] .details-container[data-v-62183c17] {\n  background: rgba(248, 250, 252, 0.85);\n  border-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .left-panel[data-v-62183c17]::before,\n[data-theme="light"] .details-container[data-v-62183c17]::before {\n  background: radial-gradient(ellipse at 50% 0%, rgba(59, 130, 246, 0.08) 0%, transparent 70%);\n}\n[data-theme="light"] .top-actions-container[data-v-62183c17] {\n  background: rgba(241, 245, 249, 0.85);\n  border-color: rgba(59, 130, 246, 0.1);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-62183c17] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-62183c17]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n[data-theme="light"] .list-item[data-v-62183c17] {\n  background: rgba(255, 255, 255, 0.7);\n}\n[data-theme="light"] .list-item[data-v-62183c17]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.25);\n}\n[data-theme="light"] .list-item.selected[data-v-62183c17] {\n  background: linear-gradient(135deg, rgba(219, 234, 254, 0.9) 0%, rgba(241, 245, 249, 0.95) 100%);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .list-item[data-v-62183c17]::before {\n  background: linear-gradient(180deg, rgba(59, 130, 246, 0.6), rgba(37, 99, 235, 0.4));\n}\n[data-theme="light"] .item-name[data-v-62183c17] {\n  color: #1e293b;\n}\n[data-theme="light"] .list-item.selected .item-name[data-v-62183c17] {\n  color: #1e40af;\n  text-shadow: none;\n}\n[data-theme="light"] .details-title[data-v-62183c17],\n[data-theme="light"] .world-details h2[data-v-62183c17] {\n  color: #2563eb;\n  text-shadow: none;\n}\n[data-theme="light"] .description-scroll p[data-v-62183c17] {\n  color: #475569;\n}\n[data-theme="light"] .map-options[data-v-62183c17] {\n  background: linear-gradient(135deg, rgba(241, 245, 249, 0.9) 0%, rgba(255, 255, 255, 0.8) 100%);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .option-item input[data-v-62183c17] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.15);\n  color: #1e293b;\n}\n[data-theme="light"] .opt-btn[data-v-62183c17] {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.8) 100%);\n  border-color: rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .opt-btn[data-v-62183c17]:hover {\n  background: linear-gradient(135deg, rgba(241, 245, 249, 1) 0%, rgba(255, 255, 255, 1) 100%);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-62183c17],\n[data-theme="light"] .delete-btn[data-v-62183c17] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-62183c17]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-62183c17]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n.action-name[data-v-62183c17] {\n  font-weight: 500;\n}\n\n/* ========== 响应式适配 ========== */\n@media (max-width: 1024px) {\n.world-layout[data-v-62183c17] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-62183c17] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n    gap: 0.5rem;\n}\n.top-actions-container .action-item[data-v-62183c17] {\n    flex: 1 1 45%;\n    text-align: center;\n    min-width: 120px;\n}\n.continents-only-section[data-v-62183c17] {\n    padding: 0.6rem;\n}\n.toggle-label[data-v-62183c17] {\n    font-size: 0.85rem;\n}\n.toggle-hint[data-v-62183c17] {\n    font-size: 0.72rem;\n    padding-left: 1.5rem;\n}\n.world-layout[data-v-62183c17] {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    height: 100%;\n    overflow: hidden;\n    padding: 0;\n}\n.left-panel[data-v-62183c17] {\n    order: 1;\n    flex-shrink: 0;\n    max-height: 35vh;\n    overflow: hidden;\n}\n.details-container[data-v-62183c17] {\n    order: 2;\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.list-container[data-v-62183c17] {\n    max-height: calc(35vh - 60px);\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n.list-item[data-v-62183c17],\n  .action-item[data-v-62183c17] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n.map-options-grid[data-v-62183c17] { grid-template-columns: 1fr;\n}\n.list-item[data-v-62183c17] {\n    padding: 0.75rem 0.95rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.45rem;\n}\n.action-item[data-v-62183c17] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.details-container[data-v-62183c17] {\n    padding: 1rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-62183c17] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n    gap: 0.45rem;\n}\n.top-actions-container .action-item[data-v-62183c17] {\n    flex: 1 1 100%;\n    text-align: center;\n}\n.world-selection-container[data-v-62183c17] {\n    padding: 0.3rem;\n    height: 100%;\n}\n.world-layout[data-v-62183c17] {\n    gap: 0.5rem;\n}\n.left-panel[data-v-62183c17] {\n    max-height: 32vh;\n}\n.list-container[data-v-62183c17] {\n    max-height: calc(32vh - 100px);\n    padding: 0.4rem;\n}\n.list-item[data-v-62183c17] {\n    padding: 0.65rem 0.85rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.35rem;\n    border-radius: 8px;\n}\n.details-container[data-v-62183c17] {\n    padding: 1rem;\n    border-radius: 12px;\n}\n.details-title[data-v-62183c17] {\n    font-size: 1.3rem;\n    margin-bottom: 0.5rem;\n}\n.world-details .era[data-v-62183c17] {\n    font-size: 0.9rem;\n    margin-bottom: 0.85rem;\n}\n.description-scroll[data-v-62183c17] {\n    font-size: 0.9rem;\n    line-height: 1.6;\n    padding-right: 0.3rem;\n}\n.action-item[data-v-62183c17] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 8px;\n}\n.placeholder[data-v-62183c17] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 100px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n}\n@media (max-width: 360px) {\n.world-selection-container[data-v-62183c17] {\n    padding: 0.25rem;\n}\n.world-layout[data-v-62183c17] {\n    gap: 0.4rem;\n    padding: 0;\n}\n.left-panel[data-v-62183c17] {\n    max-height: 28vh;\n}\n.list-container[data-v-62183c17] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.list-item[data-v-62183c17] {\n    padding: 0.55rem 0.7rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.25rem;\n}\n.details-container[data-v-62183c17] {\n    padding: 0.85rem;\n    min-height: 120px;\n}\n.details-title[data-v-62183c17] {\n    font-size: 1.15rem;\n    margin-bottom: 0.4rem;\n}\n.world-details .era[data-v-62183c17] {\n    font-size: 0.82rem;\n    margin-bottom: 0.65rem;\n}\n.description-scroll[data-v-62183c17] {\n    font-size: 0.85rem;\n    line-height: 1.5;\n}\n.action-item[data-v-62183c17] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-62183c17] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n}\n}\n',""]);const s=i},5735:(e,n,t)=>{"use strict";t.d(n,{BC:()=>l,Ge:()=>d,VW:()=>c,Vd:()=>i,savePreset:()=>s});var a=t(5099),r=t(7760);const o="character_presets";async function i(){try{const e=await(0,a.loadFromIndexedDB)(o);return e&&Array.isArray(e.presets)?e.presets:[]}catch(e){return console.error("[预设管理器] 加载预设失败:",e),[]}}async function s(e){try{const n=`preset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,t={presets:[{id:n,savedAt:(new Date).toISOString(),...e},...await i()]};return await(0,a.saveData)(o,t),n}catch(e){throw console.error("[预设管理器] 保存预设失败:",e),e}}async function l(e){try{const n=await i(),t=n.filter(n=>n.id!==e);if(t.length===n.length)return;const r={presets:t};await(0,a.saveData)(o,r)}catch(e){throw console.error("[预设管理器] 删除预设失败:",e),e}}async function c(e){try{console.log("[预设管理器] 开始导出预设:",e);const n=await i(),t=e&&e.length>0?n.filter(n=>e.includes(n.id)):n;if(0===t.length)throw new Error("没有可导出的预设");const a=(0,r.q3)("presets",{presets:t}),o=JSON.stringify(a,null,2),s=new Blob([o],{type:"application/json"}),l=URL.createObjectURL(s),c=document.createElement("a");c.href=l;const d=`character-presets-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5)}.json`;c.download=d,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l),console.log("[预设管理器] 预设导出成功:",d)}catch(e){throw console.error("[预设管理器] 导出预设失败:",e),e}}async function d(e,n="merge"){try{console.log("[预设管理器] 开始导入预设, 模式:",n);const t=await e.text(),s=JSON.parse(t),l=(0,r.ZT)(s);let c;if("presets"===l.type&&Array.isArray(l.payload?.presets))c=l.payload.presets;else{if(!Array.isArray(s.presets))throw new Error("无效的预设文件格式");c=s.presets}let d=0,u=0;const p="replace"===n?[]:await i(),v=new Set(p.map(e=>e.id)),f=[];for(const e of c)try{if(!e.name||!e.data){console.warn("[预设管理器] 跳过无效预设:",e),u++;continue}let n=e.id;v.has(e.id)&&(n=`preset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,console.log("[预设管理器] ID冲突,生成新ID:",e.id,"->",n));const t={...e,id:n,savedAt:(new Date).toISOString()};f.push(t),v.add(n),d++}catch(n){console.error("[预设管理器] 导入预设失败:",e,n),u++}const h={presets:"replace"===n?f:[...f,...p]};return await(0,a.saveData)(o,h),console.log("[预设管理器] 预设导入完成, 成功:",d,"失败:",u),{success:d,failed:u}}catch(e){throw console.error("[预设管理器] 导入预设失败:",e),e}}},5744:(e,n,t)=>{"use strict";t.d(n,{A:()=>p});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o),s=t(4417),l=t.n(s),c=new URL(t(660),t.b),d=i()(r()),u=l()(c);d.push([e.id,`\n.api-management-panel[data-v-6e14ada2] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  padding: 1rem;\n  gap: 1rem;\n  position: relative;\n}\n\n/* 头部 */\n.panel-header[data-v-6e14ada2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: var(--color-surface);\n  border-radius: 0.75rem;\n  border: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.header-left[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.header-icon[data-v-6e14ada2] {\n  font-size: 1.5rem;\n}\n.header-info[data-v-6e14ada2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.panel-title[data-v-6e14ada2] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.settings-subtitle[data-v-6e14ada2] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.header-actions[data-v-6e14ada2] {\n  display: flex;\n  gap: 0.5rem;\n}\n.action-btn[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n\n/* 修复按钮文字被全局样式覆盖的问题 */\n.action-btn .btn-text[data-v-6e14ada2] {\n  display: inline;\n  width: auto;\n  text-align: left;\n  font-size: inherit;\n  color: inherit;\n}\n.action-btn[data-v-6e14ada2]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.action-btn.primary[data-v-6e14ada2] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: var(--color-white-soft);\n}\n.action-btn.primary[data-v-6e14ada2]:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n}\n\n/* 内容区域 */\n.settings-container[data-v-6e14ada2] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 0.5rem 3rem 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n  -webkit-overflow-scrolling: touch;\n}\n.settings-container[data-v-6e14ada2]::-webkit-scrollbar {\n  width: 8px;\n}\n.settings-container[data-v-6e14ada2]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-container[data-v-6e14ada2]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n}\n\n/* 设置区块 */\n.settings-section[data-v-6e14ada2] {\n  margin-bottom: 1.5rem;\n  background: var(--color-surface);\n  border-radius: 0.75rem;\n  border: 1px solid var(--color-border);\n  overflow: hidden;\n}\n.section-header[data-v-6e14ada2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: var(--color-surface-light);\n  border-bottom: 1px solid var(--color-border);\n}\n.section-title[data-v-6e14ada2] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text, #1e293b);\n}\n\n/* 流水线提示 */\n.pipeline-hint[data-v-6e14ada2] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.875rem 1.25rem;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.08), rgba(var(--color-accent-rgb), 0.08));\n  border-bottom: 1px solid var(--color-border);\n}\n.hint-icon[data-v-6e14ada2] {\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n.hint-content[data-v-6e14ada2] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary, #64748b);\n  line-height: 1.5;\n}\n.hint-content strong[data-v-6e14ada2] {\n  color: var(--color-text, #1e293b);\n}\n.hint-example[data-v-6e14ada2] {\n  display: inline-block;\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-muted, #94a3b8);\n  font-style: italic;\n}\n.section-count[data-v-6e14ada2] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n\n/* 模式标识 */\n.mode-badge[data-v-6e14ada2] {\n  display: inline-flex;\n  align-items: center;\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.mode-badge.tavern[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  color: #92400e;\n  border: 1px solid #f59e0b;\n}\n.mode-badge.web[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n  color: #1e40af;\n  border: 1px solid #3b82f6;\n}\n\n/* 模式说明 */\n.mode-hint[data-v-6e14ada2] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.875rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.mode-hint.tavern[data-v-6e14ada2] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.08));\n}\n.mode-hint.web[data-v-6e14ada2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.08));\n}\n.mode-hint .hint-content em[data-v-6e14ada2] {\n  font-style: normal;\n  font-weight: 600;\n  color: var(--color-error);\n}\n\n/* API卡片列表 */\n.api-list[data-v-6e14ada2] {\n  padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.api-card[data-v-6e14ada2] {\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 1rem;\n  overflow: hidden;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n}\n.api-card[data-v-6e14ada2]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.15);\n  transform: translateY(-2px);\n}\n.api-card.disabled[data-v-6e14ada2] {\n  opacity: 0.5;\n  filter: grayscale(0.3);\n}\n.api-card.disabled[data-v-6e14ada2]:hover {\n  transform: none;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n}\n.api-card.default[data-v-6e14ada2] {\n  border-color: #3b82f6;\n  background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);\n}\n.api-card-header[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem 1.25rem;\n  background: linear-gradient(135deg, var(--color-surface-light) 0%, var(--color-surface) 100%);\n  border-bottom: 1px solid var(--color-border);\n}\n\n/* 卡片开关样式 */\n.card-toggle[data-v-6e14ada2] {\n  position: relative;\n  display: inline-block;\n  width: 48px;\n  height: 28px;\n  flex-shrink: 0;\n  cursor: pointer;\n}\n.card-toggle input[data-v-6e14ada2] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.card-toggle .toggle-slider[data-v-6e14ada2] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  border-radius: 28px;\n  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n.card-toggle .toggle-slider[data-v-6e14ada2]:before {\n  position: absolute;\n  content: '';\n  height: 22px;\n  width: 22px;\n  left: 3px;\n  bottom: 3px;\n  background: var(--color-white-soft);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  border-radius: 50%;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n}\n.card-toggle input:checked + .toggle-slider[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);\n}\n.card-toggle input:checked + .toggle-slider[data-v-6e14ada2]:before {\n  transform: translateX(20px);\n}\n.api-info[data-v-6e14ada2] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.api-name[data-v-6e14ada2] {\n  font-weight: 600;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.api-provider[data-v-6e14ada2] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: var(--color-surface-light);\n  padding: 0.25rem 0.625rem;\n  border-radius: 1rem;\n  font-weight: 500;\n}\n.api-provider.tavern-tag[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  color: #92400e;\n  border: 1px solid #f59e0b;\n  font-weight: 500;\n}\n.api-actions[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.icon-btn[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border: none;\n  border-radius: 0.5rem;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.icon-btn[data-v-6e14ada2]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  transform: scale(1.05);\n}\n.icon-btn.danger[data-v-6e14ada2]:hover {\n  background: rgba(var(--color-error-rgb), 0.15);\n  color: var(--color-error);\n}\n.icon-btn[data-v-6e14ada2]:disabled {\n  opacity: 0.3;\n  cursor: not-allowed;\n}\n.icon-btn[data-v-6e14ada2]:disabled:hover {\n  transform: none;\n}\n.api-card-body[data-v-6e14ada2] {\n  padding: 0.75rem 1rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n}\n\n/* 酒馆模式下默认API的提示样式 */\n.tavern-api-hint[data-v-6e14ada2] {\n  width: 100%;\n  padding: 0.5rem 0;\n}\n.tavern-api-hint .hint-text[data-v-6e14ada2] {\n  font-size: 0.875rem;\n  color: #92400e;\n  font-style: italic;\n}\n.api-detail[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n}\n.detail-label[data-v-6e14ada2] {\n  color: var(--color-text-secondary);\n}\n.detail-value[data-v-6e14ada2] {\n  color: var(--color-text);\n  font-weight: 500;\n}\n.detail-value.url[data-v-6e14ada2] {\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.detail-value.success[data-v-6e14ada2] {\n  color: #059669;\n}\n.detail-value.fail[data-v-6e14ada2] {\n  color: #dc2626;\n}\n.detail-value.unknown[data-v-6e14ada2] {\n  color: var(--color-text-secondary);\n}\n.json-toggle[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: var(--color-text);\n  user-select: none;\n}\n.json-toggle input[data-v-6e14ada2] {\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n  accent-color: #3b82f6;\n}\n.thinking-toggle[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: var(--color-text);\n  user-select: none;\n}\n.thinking-toggle input[data-v-6e14ada2] {\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n  accent-color: #f59e0b;\n}\n.thinking-toggle span[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  padding: 2px 8px;\n  border-radius: 4px;\n  color: #92400e;\n  font-weight: 500;\n}\n.api-card-footer[data-v-6e14ada2] {\n  padding: 0.5rem 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.assigned-label[data-v-6e14ada2] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.assigned-tags[data-v-6e14ada2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n}\n.function-tag[data-v-6e14ada2] {\n  font-size: 0.75rem;\n  background: var(--color-primary);\n  color: var(--color-white-soft);\n  padding: 0.125rem 0.5rem;\n  border-radius: 1rem;\n}\n\n/* 设置列表 */\n.settings-list[data-v-6e14ada2] {\n  padding: 0.5rem;\n}\n\n/* 功能分组头部 */\n.function-group-header[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem 0.5rem;\n  margin-top: 1rem;\n}\n.function-group-header[data-v-6e14ada2]:first-child {\n  margin-top: 0;\n}\n.group-title[data-v-6e14ada2] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.group-desc[data-v-6e14ada2] {\n  font-size: 0.75rem;\n  color: var(--color-text-muted);\n}\n\n/* 自动分步生成提示 */\n.auto-split-hint[data-v-6e14ada2] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.875rem 1rem;\n  margin: 0.75rem 0.5rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(37, 99, 235, 0.05));\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  border-radius: 0.5rem;\n}\n.auto-split-hint .hint-icon[data-v-6e14ada2] {\n  font-size: 1.25rem;\n}\n.auto-split-hint .hint-text[data-v-6e14ada2] {\n  flex: 1;\n  font-size: 0.875rem;\n  color: #1e40af;\n  line-height: 1.5;\n}\n.auto-split-hint .hint-text strong[data-v-6e14ada2] {\n  font-weight: 600;\n  color: #1e3a8a;\n}\n.setting-item[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-radius: 0.5rem;\n  transition: background 0.2s ease;\n}\n.setting-item[data-v-6e14ada2]:hover {\n  background: var(--color-surface-light);\n}\n\n/* 控制行样式 */\n.control-row[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n/* 内联开关样式 */\n.inline-toggle[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-right: 0.5rem;\n}\n.toggle-label[data-v-6e14ada2] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.setting-switch.compact[data-v-6e14ada2] {\n  transform: scale(0.85);\n}\n\n/* 模式指示器 */\n.mode-indicator[data-v-6e14ada2] {\n  display: inline-flex;\n  align-items: center;\n  margin-left: 0.5rem;\n  padding: 0.125rem 0.4rem;\n  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n  color: #1e40af;\n  font-size: 0.65rem;\n  font-weight: 600;\n  border-radius: 0.5rem;\n  border: 1px solid #93c5fd;\n}\n.setting-info[data-v-6e14ada2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.setting-name[data-v-6e14ada2] {\n  font-weight: 500;\n  color: var(--color-text);\n}\n.setting-desc[data-v-6e14ada2] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n\n/* 酒馆模式锁定状态 */\n.setting-item.tavern-locked[data-v-6e14ada2] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.05));\n  border-radius: 0.5rem;\n}\n.locked-badge[data-v-6e14ada2] {\n  display: inline-flex;\n  align-items: center;\n  margin-left: 0.5rem;\n  padding: 0.125rem 0.5rem;\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  color: #92400e;\n  font-size: 0.7rem;\n  font-weight: 500;\n  border-radius: 0.75rem;\n  border: 1px solid #f59e0b;\n}\n.locked-text[data-v-6e14ada2] {\n  display: inline-flex;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface-light);\n  border: 1px dashed var(--color-border);\n  border-radius: 0.5rem;\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n  font-style: italic;\n}\n.setting-control[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n}\n.assignment-control[data-v-6e14ada2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n  align-items: flex-end;\n}\n.function-mode-row[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.mode-label[data-v-6e14ada2] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.setting-select.mode-select[data-v-6e14ada2] {\n  min-width: 120px;\n}\n.setting-select[data-v-6e14ada2] {\n  padding: 0.5rem 2rem 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background-color: var(--color-surface);\n  background-image: url(${u});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 12px;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  cursor: pointer;\n  appearance: none;\n  min-width: 140px;\n}\n.setting-select.disabled-hint[data-v-6e14ada2] {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background-color: #f3f4f6;\n}\n.setting-select[data-v-6e14ada2]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background-color: #f3f4f6;\n}\n\n/* 数字输入框样式 */\n.setting-number-input[data-v-6e14ada2] {\n  width: 80px;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background-color: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  text-align: center;\n  transition: all 0.2s;\n}\n.setting-number-input[data-v-6e14ada2]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.setting-number-input[data-v-6e14ada2]:hover {\n  border-color: var(--color-border-hover);\n}\n.input-hint[data-v-6e14ada2] {\n  margin-left: 0.5rem;\n  color: var(--color-text-muted);\n  font-size: 0.875rem;\n}\n\n/* 开关样式 */\n.setting-switch[data-v-6e14ada2] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n}\n.setting-switch input[data-v-6e14ada2] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.switch-slider[data-v-6e14ada2] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.switch-slider[data-v-6e14ada2]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: var(--color-white-soft);\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .switch-slider[data-v-6e14ada2] {\n  background-color: var(--color-primary);\n}\ninput:checked + .switch-slider[data-v-6e14ada2]:before {\n  transform: translateX(20px);\n}\n\n/* 模态框 */\n.modal-overlay[data-v-6e14ada2] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content[data-v-6e14ada2] {\n  background: var(--color-surface);\n  border-radius: 1rem;\n  width: 90%;\n  max-width: 500px;\n  max-height: 90vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.modal-header[data-v-6e14ada2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-header h3[data-v-6e14ada2] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 0.5rem;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n}\n.close-btn[data-v-6e14ada2]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.modal-body[data-v-6e14ada2] {\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n.form-group[data-v-6e14ada2] {\n  margin-bottom: 1rem;\n}\n.form-group label[data-v-6e14ada2] {\n  display: block;\n  font-weight: 500;\n  color: #374151;\n  margin-bottom: 0.5rem;\n}\n.form-input[data-v-6e14ada2],\n.form-select[data-v-6e14ada2] {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  box-sizing: border-box;\n}\n.form-input[data-v-6e14ada2]:focus,\n.form-select[data-v-6e14ada2]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.1);\n}\n.form-row[data-v-6e14ada2] {\n  display: flex;\n  gap: 1rem;\n}\n.form-group.half[data-v-6e14ada2] {\n  flex: 1;\n}\n.checkbox-label[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-weight: 500;\n  color: #374151;\n}\n.form-checkbox[data-v-6e14ada2] {\n  width: 1.25rem;\n  height: 1.25rem;\n  cursor: pointer;\n  accent-color: #3b82f6;\n}\n.form-hint[data-v-6e14ada2] {\n  margin-top: 0.5rem;\n  padding: 0.75rem;\n  background: #f3f4f6;\n  border-radius: 0.5rem;\n  font-size: 0.8125rem;\n  color: #6b7280;\n  line-height: 1.5;\n}\n.hint-warning[data-v-6e14ada2] {\n  color: #d97706;\n  font-weight: 500;\n}\n.model-input-row[data-v-6e14ada2] {\n  display: flex;\n  gap: 0.5rem;\n}\n.model-input-row .form-input[data-v-6e14ada2] {\n  flex: 1;\n}\n.model-select-wrapper[data-v-6e14ada2] {\n  position: relative;\n}\n.model-dropdown[data-v-6e14ada2] {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  max-height: 200px;\n  overflow-y: auto;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n  margin-top: 4px;\n}\n.model-dropdown-item[data-v-6e14ada2] {\n  padding: 0.5rem 0.75rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: var(--color-text);\n  transition: background 0.15s ease;\n}\n.model-dropdown-item[data-v-6e14ada2]:hover {\n  background: var(--color-surface-light);\n}\n.model-dropdown-item.active[data-v-6e14ada2] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.utility-btn[data-v-6e14ada2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n}\n.utility-btn[data-v-6e14ada2]:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n}\n.utility-btn[data-v-6e14ada2]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.model-list[data-v-6e14ada2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n}\n.model-tag[data-v-6e14ada2] {\n  padding: 0.25rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 1rem;\n  font-size: 0.75rem;\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.model-tag[data-v-6e14ada2]:hover {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.model-tag.active[data-v-6e14ada2] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: var(--color-white-soft);\n}\n.modal-footer[data-v-6e14ada2] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n  padding: 1rem 1.5rem;\n  border-top: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-6e14ada2],\n.btn-confirm[data-v-6e14ada2] {\n  padding: 0.625rem 1.25rem;\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.btn-cancel[data-v-6e14ada2] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n}\n.btn-cancel[data-v-6e14ada2]:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n}\n.btn-confirm[data-v-6e14ada2] {\n  background: var(--color-primary);\n  border: 1px solid var(--color-primary);\n  color: var(--color-white-soft);\n}\n.btn-confirm[data-v-6e14ada2]:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n}\n\n/* 加载动画 */\n.loading-pulse[data-v-6e14ada2] {\n  animation: pulse-6e14ada2 1.5s ease-in-out infinite;\n}\n@keyframes pulse-6e14ada2 {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.4;\n}\n}\n\n/* 响应式 */\n@media (max-width: 640px) {\n.header-actions[data-v-6e14ada2] {\n    flex-wrap: wrap;\n}\n.header-actions .action-btn[data-v-6e14ada2] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.75rem;\n}\n.header-actions .btn-text[data-v-6e14ada2] {\n    display: inline;\n}\n.api-card-body[data-v-6e14ada2] {\n    flex-direction: column;\n    gap: 0.5rem;\n}\n.form-row[data-v-6e14ada2] {\n    flex-direction: column;\n    gap: 1rem;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .api-management-panel[data-v-6e14ada2] {\n  background: var(--color-background);\n}\n[data-theme='dark'] .panel-header[data-v-6e14ada2],\n[data-theme='dark'] .settings-section[data-v-6e14ada2] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme='dark'] .section-header[data-v-6e14ada2] {\n  background: #334155;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .panel-title[data-v-6e14ada2],\n[data-theme='dark'] .section-title[data-v-6e14ada2],\n[data-theme='dark'] .setting-name[data-v-6e14ada2],\n[data-theme='dark'] .api-name[data-v-6e14ada2],\n[data-theme='dark'] .group-title[data-v-6e14ada2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .settings-subtitle[data-v-6e14ada2],\n[data-theme='dark'] .setting-desc[data-v-6e14ada2],\n[data-theme='dark'] .detail-label[data-v-6e14ada2],\n[data-theme='dark'] .group-desc[data-v-6e14ada2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .api-card[data-v-6e14ada2] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme='dark'] .api-card-header[data-v-6e14ada2] {\n  background: #1e293b;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .setting-item[data-v-6e14ada2]:hover,\n[data-theme='dark'] .api-card[data-v-6e14ada2]:hover {\n  background: #334155;\n}\n[data-theme='dark'] .action-btn[data-v-6e14ada2],\n[data-theme='dark'] .setting-select[data-v-6e14ada2],\n[data-theme='dark'] .form-input[data-v-6e14ada2],\n[data-theme='dark'] .form-select[data-v-6e14ada2] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .form-group label[data-v-6e14ada2] {\n  color: #e2e8f0;\n}\n[data-theme='dark'] .modal-content[data-v-6e14ada2] {\n  background: #1e293b;\n}\n[data-theme='dark'] .modal-header[data-v-6e14ada2] {\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .modal-header h3[data-v-6e14ada2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .modal-footer[data-v-6e14ada2] {\n  border-top-color: #475569;\n}\n[data-theme='dark'] .api-provider[data-v-6e14ada2] {\n  background: #475569;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .api-provider.tavern-tag[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);\n  color: #fef3c7;\n  border-color: #b45309;\n}\n[data-theme='dark'] .tavern-api-hint .hint-text[data-v-6e14ada2] {\n  color: #fcd34d;\n}\n[data-theme='dark'] .model-tag[data-v-6e14ada2] {\n  background: #475569;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .model-dropdown[data-v-6e14ada2] {\n  background: #374151;\n  border-color: #4b5563;\n}\n[data-theme='dark'] .model-dropdown-item[data-v-6e14ada2] {\n  color: #e5e7eb;\n}\n[data-theme='dark'] .model-dropdown-item[data-v-6e14ada2]:hover {\n  background: #4b5563;\n}\n[data-theme='dark'] .model-dropdown-item.active[data-v-6e14ada2] {\n  background: #1e40af;\n  color: #93c5fd;\n}\n\n/* 深色主题 - 模式标识 */\n[data-theme='dark'] .mode-badge.tavern[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);\n  color: #fef3c7;\n  border-color: #b45309;\n}\n[data-theme='dark'] .mode-badge.web[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);\n  color: #dbeafe;\n  border-color: #2563eb;\n}\n[data-theme='dark'] .mode-hint.tavern[data-v-6e14ada2] {\n  background: linear-gradient(135deg, rgba(120, 53, 15, 0.3), rgba(146, 64, 14, 0.2));\n}\n[data-theme='dark'] .mode-hint.web[data-v-6e14ada2] {\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(30, 64, 175, 0.2));\n}\n[data-theme='dark'] .mode-hint .hint-content em[data-v-6e14ada2] {\n  color: #fca5a5;\n}\n\n/* 深色主题 - 锁定状态 */\n[data-theme='dark'] .setting-item.tavern-locked[data-v-6e14ada2] {\n  background: linear-gradient(135deg, rgba(120, 53, 15, 0.2), rgba(146, 64, 14, 0.15));\n}\n[data-theme='dark'] .locked-badge[data-v-6e14ada2] {\n  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);\n  color: #fef3c7;\n  border-color: #b45309;\n}\n[data-theme='dark'] .locked-text[data-v-6e14ada2] {\n  background: #334155;\n  border-color: #475569;\n  color: #94a3b8;\n}\n`,""]);const p=d},5777:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n/* Unified style tokens for Character Management */\n.character-management-panel[data-v-579f7e28] {\n  --cm-radius-sm: 6px;\n  --cm-radius-md: 8px;\n  --cm-radius-lg: 12px;\n  --cm-gap-xs: 0.25rem;\n  --cm-gap-sm: 0.5rem;\n  --cm-gap-md: 0.8rem;\n  --cm-gap-lg: 1rem;\n  --cm-border-width: 1px;\n  --cm-border-strong: 2px;\n  --cm-divider-width: 2px;\n  /* Card sizing tokens */\n  --cm-card-min-h: 92px;\n  --cm-card-padding: 0.9rem;\n  --cm-avatar-size: 36px;\n  --cm-header-gap: 0.75rem;\n  --cm-name-font: 1rem;\n  --cm-meta-font: 0.8rem;\n  --cm-save-count-minw: 36px;\n  --cm-save-count-count-font: 1.05rem;\n  --cm-save-count-label-font: 0.7rem;\n}\n/* 基础样式重置 */\n[data-v-579f7e28] {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n/* 自定义对话框样式 */\n.dialog-overlay[data-v-579f7e28] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(10, 20, 30, 0.6);\n  backdrop-filter: blur(8px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  transition: opacity 0.3s ease;\n}\n.dialog-box[data-v-579f7e28] {\n  background: var(--color-surface-transparent);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 2rem;\n  width: 90%;\n  max-width: 450px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n  color: var(--color-text);\n  transform: scale(0.95);\n  opacity: 0;\n  animation: dialog-fade-in-579f7e28 0.3s forwards;\n}\n@keyframes dialog-fade-in-579f7e28 {\nto {\n    transform: scale(1);\n    opacity: 1;\n}\n}\n.dialog-title[data-v-579f7e28] {\n  font-size: 1.5rem;\n  color: var(--color-accent);\n  margin: 0 0 1rem 0;\n  font-weight: 600;\n}\n.dialog-message[data-v-579f7e28] {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 1.5rem 0;\n  line-height: 1.6;\n}\n.dialog-input[data-v-579f7e28] {\n  width: 100%;\n  padding: 0.8rem 1rem;\n  background: var(--color-background-transparent);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text);\n  font-size: 1rem;\n  margin-bottom: 1.5rem;\n  transition:\n    border-color 0.3s,\n    box-shadow 0.3s;\n}\n.dialog-input[data-v-579f7e28]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.2);\n}\n.dialog-actions[data-v-579f7e28] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n}\n.btn-dialog-confirm[data-v-579f7e28],\n.btn-dialog-cancel[data-v-579f7e28] {\n  padding: 0.6rem 1.5rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  font-weight: 600;\n  transition: all 0.3s;\n}\n.btn-dialog-confirm[data-v-579f7e28] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.btn-dialog-confirm[data-v-579f7e28]:hover {\n  background: var(--color-primary-dark);\n  transform: translateY(-2px);\n}\n.btn-dialog-cancel[data-v-579f7e28] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-dialog-cancel[data-v-579f7e28]:hover {\n  background: var(--color-background);\n}\n\n/* 主容器样式 */\n.character-management-panel[data-v-579f7e28] {\n  width: 100%;\n  height: 100%;\n  background: var(--color-background);\n  color: var(--color-text);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  position: relative;\n}\n.character-management-panel.fullscreen[data-v-579f7e28] {\n  background: var(--color-background);\n}\n\n/* 全屏模式头部 */\n.fullscreen-header[data-v-579f7e28] {\n  position: relative;\n  z-index: 10;\n  padding: 2rem;\n  background: var(--color-surface-transparent);\n  backdrop-filter: blur(12px);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.fullscreen-back-btn[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: transparent;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.9rem;\n}\n.fullscreen-back-btn[data-v-579f7e28]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border-color: var(--color-primary);\n}\n.fullscreen-title[data-v-579f7e28] {\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  text-align: center;\n}\n.fullscreen-title h1[data-v-579f7e28] {\n  font-family: var(--font-family-serif);\n  font-size: 2.5rem;\n  font-weight: 500;\n  letter-spacing: 0.3em;\n  color: var(--color-text);\n  text-shadow: 0 0 20px rgba(var(--color-primary-rgb), 0.4);\n  margin: 0 0 0.5rem 0;\n  padding-left: 0.3em;\n}\n.fullscreen-title p[data-v-579f7e28] {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  letter-spacing: 0.1em;\n  opacity: 0.8;\n  margin: 0;\n}\n\n/* 主体内容 */\n.main-content[data-v-579f7e28] {\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.main-content.fullscreen-content[data-v-579f7e28] {\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n}\n\n/* 移动端头部导航 */\n.mobile-header[data-v-579f7e28] {\n  display: none;\n  background: var(--color-surface-transparent);\n  backdrop-filter: blur(12px);\n  border-bottom: 1px solid var(--color-border);\n  padding: 1rem;\n  align-items: center;\n  gap: 1rem;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n.mobile-menu-btn[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  padding: 0.8rem 1rem;\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.8),\n    rgba(var(--color-background-rgb), 0.6)\n  );\n  backdrop-filter: blur(10px);\n  border: 2px solid rgba(var(--color-border-rgb), 0.3);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  font-weight: 600;\n  position: relative;\n  overflow: hidden;\n}\n.mobile-menu-btn[data-v-579f7e28]:hover {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.9),\n    rgba(var(--color-background-rgb), 0.7)\n  );\n  color: var(--color-primary);\n  border-color: var(--color-primary);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.2);\n}\n.mobile-menu-btn.active[data-v-579f7e28] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: white;\n  border-color: var(--color-primary);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n}\n.hamburger[data-v-579f7e28] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  width: 16px;\n  height: 12px;\n}\n.hamburger span[data-v-579f7e28] {\n  display: block;\n  height: 2px;\n  width: 100%;\n  background: currentColor;\n  border-radius: 1px;\n  transition: transform 0.2s ease;\n}\n.mobile-menu-btn.active .hamburger span[data-v-579f7e28]:nth-child(1) {\n  transform: rotate(45deg) translate(3px, 3px);\n}\n.mobile-menu-btn.active .hamburger span[data-v-579f7e28]:nth-child(2) {\n  opacity: 0;\n}\n.mobile-menu-btn.active .hamburger span[data-v-579f7e28]:nth-child(3) {\n  transform: rotate(-45deg) translate(3px, -3px);\n}\n.mobile-title[data-v-579f7e28] {\n  flex: 1;\n  min-width: 0; /* Allow shrinking and text-overflow to work */\n}\n.mobile-title h2[data-v-579f7e28] {\n  margin: 0;\n  font-size: 1.2rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.mobile-title .selected-info[data-v-579f7e28] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.2rem;\n  /* Fix for vertical text issue on small screens */\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.panel-overlay[data-v-579f7e28] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 1100;\n}\n\n/* 空状态 */\n.empty-state[data-v-579f7e28] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: 2rem;\n}\n.empty-icon[data-v-579f7e28] {\n  font-size: 4rem;\n  margin-bottom: 1rem;\n}\n.empty-state h2[data-v-579f7e28] {\n  color: var(--color-accent);\n  margin-bottom: 0.5rem;\n}\n.empty-actions[data-v-579f7e28] {\n  display: flex;\n  gap: 1rem;\n  margin-top: 1rem;\n}\n.btn-create[data-v-579f7e28],\n.btn-import[data-v-579f7e28] {\n  padding: 1rem 2rem;\n  color: white;\n  border-radius: 12px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.btn-create[data-v-579f7e28] {\n  background: linear-gradient(135deg, var(--color-success), var(--color-info));\n  border: 1px solid var(--color-success);\n}\n.btn-create[data-v-579f7e28]:hover {\n  transform: scale(1.05);\n}\n.btn-import[data-v-579f7e28] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  border: 1px solid var(--color-primary);\n}\n.btn-import[data-v-579f7e28]:hover {\n  transform: scale(1.05);\n}\n\n/* 管理布局 - 3行2列网格 */\n.management-layout[data-v-579f7e28] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  height: 100%;\n}\n\n/* 3行2列网格布局 - 简洁版本 */\n.grid-container[data-v-579f7e28] {\n  display: grid;\n  grid-template-columns: 320px 1fr;\n  grid-template-rows: auto 1fr auto;\n  grid-template-areas:\n    'header-left header-right'\n    'content-left content-right'\n    'footer-left footer-right';\n  height: 100%;\n  overflow: hidden;\n  /* 使用单一垂直分割线 */\n  position: relative;\n}\n\n/* 统一的垂直分割线 */\n.grid-container[data-v-579f7e28]::before {\n  content: '';\n  position: absolute;\n  left: 320px;\n  top: 0;\n  bottom: 0;\n  width: 2px;\n  background: var(--color-primary);\n  z-index: 10;\n}\n\n/* 标题栏 - 简化样式 */\n.grid-header-left[data-v-579f7e28],\n.grid-header-right[data-v-579f7e28] {\n  padding: 0.8rem 1rem;\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n}\n.grid-header-left h2[data-v-579f7e28],\n.grid-header-right h2[data-v-579f7e28] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-text);\n  font-weight: 600;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.header-title-group[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 1;\n  min-width: 0;\n}\n.btn-header-action[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.4rem 0.6rem;\n  border: 1px solid;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.8rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n  background: var(--color-surface);\n  flex-shrink: 0;\n}\n\n/* 默认隐藏按钮文字，只显示图标 */\n.btn-header-action span[data-v-579f7e28] {\n  display: none;\n}\n\n/* 大屏幕显示按钮文字 */\n@media (min-width: 1200px) {\n.btn-header-action[data-v-579f7e28] {\n    padding: 0.4rem 0.8rem;\n}\n.btn-header-action span[data-v-579f7e28] {\n    display: inline;\n}\n}\n.btn-header-action.import[data-v-579f7e28] {\n  color: var(--color-info);\n  border-color: rgba(var(--color-info-rgb), 0.4);\n}\n.btn-header-action.import[data-v-579f7e28]:hover {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: var(--color-info);\n}\n.btn-header-action.migrate[data-v-579f7e28] {\n  color: var(--color-warning);\n  border-color: rgba(var(--color-warning-rgb), 0.4);\n}\n.btn-header-action.migrate[data-v-579f7e28]:hover {\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-color: var(--color-warning);\n}\n.character-count[data-v-579f7e28] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 100%;\n}\n\n/* 右侧标题栏布局 */\n.header-left-content[data-v-579f7e28] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n  flex: 1;\n  min-width: 0;\n}\n.selected-char-info[data-v-579f7e28] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.1),\n    rgba(var(--color-accent-rgb), 0.05)\n  );\n  padding: 0.3rem 0.6rem;\n  border-radius: 6px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.3);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: fit-content;\n}\n\n/* 存档操作按钮组 */\n.save-actions-buttons[data-v-579f7e28] {\n  display: flex;\n  gap: 0.6rem;\n  flex-shrink: 0;\n}\n.btn-save-action[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.6rem 1rem;\n  border: 2px solid;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 600;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.8),\n    rgba(var(--color-background-rgb), 0.6)\n  );\n  backdrop-filter: blur(10px);\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n}\n.btn-save-action.export[data-v-579f7e28] {\n  color: var(--color-success);\n  border-color: rgba(var(--color-success-rgb), 0.4);\n}\n.btn-save-action.export[data-v-579f7e28]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-success), rgba(var(--color-success-rgb), 0.8));\n  color: white;\n  border-color: var(--color-success);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-success-rgb), 0.3);\n}\n.btn-save-action.import[data-v-579f7e28] {\n  color: var(--color-info);\n  border-color: rgba(var(--color-info-rgb), 0.4);\n}\n.btn-save-action.import[data-v-579f7e28]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-info), rgba(var(--color-info-rgb), 0.8));\n  color: white;\n  border-color: var(--color-info);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-info-rgb), 0.3);\n}\n.btn-save-action.migrate[data-v-579f7e28] {\n  color: var(--color-warning);\n  border-color: rgba(var(--color-warning-rgb), 0.4);\n}\n.btn-save-action.migrate[data-v-579f7e28]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-warning), rgba(var(--color-warning-rgb), 0.85));\n  color: #1a1a1a;\n  border-color: var(--color-warning);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-warning-rgb), 0.3);\n}\n.btn-save-action[data-v-579f7e28]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  filter: grayscale(0.5);\n}\n.btn-save-action[data-v-579f7e28]:disabled:hover {\n  transform: none;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n}\n\n/* 内容区域 - 简化样式 */\n.grid-content-left[data-v-579f7e28],\n.grid-content-right[data-v-579f7e28] {\n  background: var(--color-background);\n}\n\n/* 底部区域 */\n.grid-footer-left[data-v-579f7e28],\n.grid-footer-right[data-v-579f7e28] {\n  min-height: 0;\n}\n\n/* 角色面板 - 简化 */\n.characters-panel[data-v-579f7e28] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n}\n.characters-grid[data-v-579f7e28] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n\n/* 角色卡片 - 简化紧凑设计 */\n.character-card[data-v-579f7e28] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.6rem;\n  margin-bottom: 0.4rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.character-card[data-v-579f7e28]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 1px 4px rgba(var(--color-primary-rgb), 0.2);\n}\n.character-card.active[data-v-579f7e28] {\n  border-color: var(--color-success);\n  background: rgba(var(--color-success-rgb), 0.05);\n}\n.character-card.single-mode[data-v-579f7e28] {\n  border-left: 3px solid var(--color-success);\n}\n.character-card.online-mode[data-v-579f7e28] {\n  border-left: 3px solid var(--color-primary);\n}\n\n/* 卡片头部 - 简化 */\n.card-header[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.char-avatar[data-v-579f7e28] {\n  position: relative;\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  font-size: 1.2rem;\n  flex-shrink: 0;\n  background: linear-gradient(135deg, #10b981, #3b82f6);\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n  border: 2px solid rgba(255, 255, 255, 0.2);\n}\n.char-avatar.联机[data-v-579f7e28] {\n  background: linear-gradient(135deg, #3b82f6, #0ea5e9);\n}\n.char-info[data-v-579f7e28] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  gap: 4px;\n}\n.name-row[data-v-579f7e28] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.char-name[data-v-579f7e28] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-text);\n  font-weight: 700;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  letter-spacing: 0.5px;\n}\n.mode-badge[data-v-579f7e28] {\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-weight: 600;\n  line-height: 1.2;\n}\n.mode-badge.single[data-v-579f7e28] {\n  background: rgba(16, 185, 129, 0.15);\n  color: #10b981;\n  border: 1px solid rgba(16, 185, 129, 0.3);\n}\n.mode-badge.online[data-v-579f7e28] {\n  background: rgba(59, 130, 246, 0.15);\n  color: #3b82f6;\n  border: 1px solid rgba(59, 130, 246, 0.3);\n}\n.char-meta[data-v-579f7e28] {\n  display: flex;\n  gap: 0.3rem;\n  font-size: 0.65rem;\n  color: var(--color-text-secondary);\n}\n.save-count[data-v-579f7e28] {\n  text-align: center;\n  flex-shrink: 0;\n  min-width: 28px;\n}\n.save-count .count[data-v-579f7e28] {\n  display: block;\n  font-size: 0.9rem;\n  font-weight: bold;\n  color: var(--color-accent);\n  line-height: 1;\n}\n.save-count .label[data-v-579f7e28] {\n  font-size: 0.6rem;\n  color: var(--color-text-secondary);\n  line-height: 1;\n}\n\n/* 卡片操作 - 简化按钮 */\n.card-actions[data-v-579f7e28] {\n  display: flex;\n  gap: 0.3rem;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid var(--color-border);\n}\n.btn-details[data-v-579f7e28],\n.btn-export[data-v-579f7e28],\n.btn-delete[data-v-579f7e28] {\n  flex: 1;\n  padding: 0.3rem 0.5rem;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  font-size: 0.7rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  background: var(--color-background);\n}\n.btn-details[data-v-579f7e28] {\n  color: var(--color-info);\n  border-color: var(--color-info);\n}\n.btn-details[data-v-579f7e28]:hover {\n  background: var(--color-info);\n  color: white;\n}\n.btn-export[data-v-579f7e28] {\n  color: var(--color-success);\n  border-color: var(--color-success);\n}\n.btn-export[data-v-579f7e28]:hover {\n  background: var(--color-success);\n  color: white;\n}\n.btn-delete[data-v-579f7e28] {\n  color: var(--color-error);\n  border-color: var(--color-error);\n}\n.btn-delete[data-v-579f7e28]:hover {\n  background: var(--color-error);\n  color: white;\n}\n\n/* 右侧存档面板 - 简化 */\n.saves-panel[data-v-579f7e28] {\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* 无选择状态 */\n.no-selection[data-v-579f7e28] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n}\n.no-selection-icon[data-v-579f7e28] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n\n/* 新增：加载存档样式 */\n.loading-saves[data-v-579f7e28] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n}\n.loading-spinner[data-v-579f7e28] {\n  width: 40px;\n  height: 40px;\n  border: 4px solid rgba(var(--color-primary-rgb), 0.2);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-579f7e28 1s linear infinite;\n  margin-bottom: 1rem;\n}\n@keyframes spin-579f7e28 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 存档容器 */\n.saves-container[data-v-579f7e28],\n.online-saves-container[data-v-579f7e28] {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 1rem;\n  height: 0;\n  -webkit-overflow-scrolling: touch;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(var(--color-primary-rgb), 0.3) transparent;\n}\n.saves-container[data-v-579f7e28]::-webkit-scrollbar,\n.online-saves-container[data-v-579f7e28]::-webkit-scrollbar {\n  width: 6px;\n}\n.saves-container[data-v-579f7e28]::-webkit-scrollbar-track,\n.online-saves-container[data-v-579f7e28]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.saves-container[data-v-579f7e28]::-webkit-scrollbar-thumb,\n.online-saves-container[data-v-579f7e28]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-primary-rgb), 0.3);\n  border-radius: 3px;\n}\n.saves-container[data-v-579f7e28]::-webkit-scrollbar-thumb:hover,\n.online-saves-container[data-v-579f7e28]::-webkit-scrollbar-thumb:hover {\n  background: rgba(var(--color-primary-rgb), 0.5);\n}\n.saves-section[data-v-579f7e28] {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n}\n\n/* 上次对话存档区域 */\n.auto-saves-section[data-v-579f7e28] {\n  margin-bottom: 1.5rem;\n}\n.auto-saves-section h3[data-v-579f7e28] {\n  margin: 0 0 0.8rem 0;\n  color: var(--color-warning);\n  font-size: 1rem;\n  font-weight: 600;\n}\n.auto-saves-grid[data-v-579f7e28] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1rem;\n}\n\n/* 手动存档区域 */\n.manual-saves-section[data-v-579f7e28] {\n  margin-bottom: 1rem;\n}\n.manual-saves-header[data-v-579f7e28] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.8rem;\n}\n.manual-saves-header h3[data-v-579f7e28] {\n  margin: 0;\n  color: var(--color-warning);\n  font-size: 1rem;\n  font-weight: 600;\n}\n.save-info-text[data-v-579f7e28] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-style: italic;\n}\n.manual-saves-grid[data-v-579f7e28] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n  gap: 1rem;\n  max-height: 400px;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n  -webkit-overflow-scrolling: touch;\n  scroll-behavior: smooth;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(var(--color-primary-rgb), 0.3) transparent;\n}\n.manual-saves-grid[data-v-579f7e28]::-webkit-scrollbar {\n  width: 6px;\n}\n.manual-saves-grid[data-v-579f7e28]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.manual-saves-grid[data-v-579f7e28]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-primary-rgb), 0.3);\n  border-radius: 3px;\n}\n.manual-saves-grid[data-v-579f7e28]::-webkit-scrollbar-thumb:hover {\n  background: rgba(var(--color-primary-rgb), 0.5);\n}\n\n/* 存档卡片 */\n.save-card[data-v-579f7e28],\n.online-save-card[data-v-579f7e28] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.9),\n    rgba(var(--color-background-rgb), 0.7)\n  );\n  backdrop-filter: blur(15px);\n  border: 2px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 8px;\n  padding: 0.9rem;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text);\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  -webkit-tap-highlight-color: transparent;\n  touch-action: manipulation;\n}\n.save-card[data-v-579f7e28]::before,\n.online-save-card[data-v-579f7e28]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.06),\n    rgba(var(--color-accent-rgb), 0.03)\n  );\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  border-radius: 8px;\n}\n.save-card[data-v-579f7e28]:hover::before,\n.online-save-card[data-v-579f7e28]:hover::before {\n  opacity: 1;\n}\n.save-card[data-v-579f7e28]:hover,\n.online-save-card[data-v-579f7e28]:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow:\n    0 4px 15px rgba(var(--color-primary-rgb), 0.15),\n    0 2px 8px rgba(0, 0, 0, 0.08);\n}\n.save-card.has-data[data-v-579f7e28] {\n  border-left: 4px solid var(--color-success);\n  border-color: rgba(var(--color-success-rgb), 0.8);\n  position: relative;\n}\n.save-card.auto-save[data-v-579f7e28] {\n  border-left-color: var(--color-info);\n  border-color: rgba(var(--color-info-rgb), 0.8);\n}\n.save-icon[data-v-579f7e28] {\n  display: inline-block;\n  margin-right: 0.5rem;\n  vertical-align: middle;\n  position: relative;\n  top: -1px;\n}\n.last-save-icon[data-v-579f7e28] {\n  color: var(--color-primary);\n}\n.time-save-icon[data-v-579f7e28] {\n  color: var(--color-warning);\n}\n.save-card.has-data[data-v-579f7e28]::after {\n  content: '';\n  position: absolute;\n  top: 0.7rem;\n  right: 0.7rem;\n  width: 6px;\n  height: 6px;\n  background: var(--color-success);\n  border-radius: 50%;\n  box-shadow: 0 0 8px rgba(var(--color-success-rgb), 0.6);\n}\n\n/* 存档数据 */\n.save-header[data-v-579f7e28] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.8rem;\n}\n.save-name[data-v-579f7e28] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-warning);\n  font-weight: 600;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 140px;\n}\n.save-badges[data-v-579f7e28] {\n  display: flex;\n  gap: 0.4rem;\n  flex-shrink: 0;\n}\n.realm-badge[data-v-579f7e28],\n.age-badge[data-v-579f7e28] {\n  padding: 2px 6px;\n  border-radius: 8px;\n  font-size: 0.7rem;\n  font-weight: 600;\n  white-space: nowrap;\n}\n.realm-badge[data-v-579f7e28] {\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n.age-badge[data-v-579f7e28] {\n  background: rgba(var(--color-accent-rgb), 0.15);\n  color: var(--color-accent);\n}\n\n/* 存档统计 */\n.save-stats[data-v-579f7e28] {\n  margin-bottom: 0.8rem;\n}\n.stat-grid[data-v-579f7e28] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 0.6rem;\n}\n.stat[data-v-579f7e28] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.8rem;\n  align-items: center;\n}\n.stat .label[data-v-579f7e28] {\n  color: var(--color-text-secondary);\n  font-size: 0.75rem;\n}\n.stat .value[data-v-579f7e28] {\n  color: var(--color-text);\n  font-weight: 600;\n  font-size: 0.8rem;\n}\n\n/* 存档底部 */\n.save-footer[data-v-579f7e28] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  padding-top: 0.6rem;\n  border-top: 1px solid rgba(var(--color-border-rgb), 0.2);\n}\n.save-footer .location[data-v-579f7e28] {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 120px;\n}\n.sync-status[data-v-579f7e28] {\n  padding: 1px 4px;\n  border-radius: 3px;\n  font-weight: 600;\n  font-size: 0.7rem;\n}\n.sync-status.synced[data-v-579f7e28] {\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n\n/* 空存档 */\n.save-empty[data-v-579f7e28] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  color: var(--color-text-secondary);\n  min-height: 100px;\n  padding: 1.5rem;\n}\n.save-empty .empty-hint[data-v-579f7e28] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin: 0.5rem 0 1rem 0;\n  opacity: 0.8;\n}\n.loading-saves[data-v-579f7e28] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n  gap: 0.75rem;\n}\n.loading-saves .loading-spinner[data-v-579f7e28] {\n  font-size: 1.5rem;\n  animation: spin-579f7e28 1s linear infinite;\n}\n@keyframes spin-579f7e28 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n.empty-slot-icon[data-v-579f7e28] {\n  font-size: 2rem;\n  margin-bottom: 0.4rem;\n  opacity: 0.6;\n}\n.empty-text[data-v-579f7e28] {\n  margin-bottom: 0.6rem;\n  font-size: 0.9rem;\n}\n.empty-desc[data-v-579f7e28] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n}\n.auto-save-desc[data-v-579f7e28] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  display: block;\n  margin-top: 0.3rem;\n}\n\n/* 存档操作按钮 */\n.save-actions[data-v-579f7e28] {\n  display: flex;\n  gap: 0.4rem;\n}\n.btn-export-save[data-v-579f7e28],\n.btn-edit-save[data-v-579f7e28],\n.btn-delete-save[data-v-579f7e28] {\n  cursor: pointer;\n  padding: 0.3rem 0.5rem;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n  font-size: 0.7rem;\n  font-weight: 600;\n  border: 1px solid;\n  backdrop-filter: blur(5px);\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  min-width: 26px;\n  height: 26px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.btn-export-save[data-v-579f7e28] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n}\n.btn-export-save[data-v-579f7e28]:hover {\n  background: rgba(var(--color-success-rgb), 0.2);\n  border-color: rgba(var(--color-success-rgb), 0.5);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(var(--color-success-rgb), 0.2);\n}\n.btn-edit-save[data-v-579f7e28] {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: rgba(var(--color-info-rgb), 0.3);\n  color: var(--color-info);\n}\n.btn-edit-save[data-v-579f7e28]:hover {\n  background: rgba(var(--color-info-rgb), 0.2);\n  border-color: rgba(var(--color-info-rgb), 0.5);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(var(--color-info-rgb), 0.2);\n}\n.btn-delete-save[data-v-579f7e28] {\n  background: rgba(var(--color-error-rgb), 0.1);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n  color: var(--color-error);\n}\n.btn-delete-save[data-v-579f7e28]:hover:not(.disabled):not(:disabled) {\n  background: rgba(var(--color-error-rgb), 0.2);\n  border-color: rgba(var(--color-error-rgb), 0.5);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(var(--color-error-rgb), 0.2);\n}\n.btn-delete-save.disabled[data-v-579f7e28],\n.btn-delete-save[data-v-579f7e28]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  background: rgba(128, 128, 128, 0.1) !important;\n  border-color: rgba(128, 128, 128, 0.2) !important;\n  color: #888 !important;\n  transform: none !important;\n  box-shadow: none !important;\n}\n\n/* 按钮样式 */\n.btn-start[data-v-579f7e28],\n.btn-play[data-v-579f7e28],\n.btn-sync[data-v-579f7e28] {\n  padding: 0.6rem 1rem;\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: white;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.5);\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.8rem;\n  font-weight: 600;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.25);\n  position: relative;\n  overflow: hidden;\n}\n.btn-start[data-v-579f7e28]:hover,\n.btn-play[data-v-579f7e28]:hover,\n.btn-sync[data-v-579f7e28]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.35);\n}\n.btn-start[data-v-579f7e28]::before,\n.btn-play[data-v-579f7e28]::before,\n.btn-sync[data-v-579f7e28]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);\n  transition: left 0.4s;\n}\n.btn-start[data-v-579f7e28]:hover::before,\n.btn-play[data-v-579f7e28]:hover::before,\n.btn-sync[data-v-579f7e28]:hover::before {\n  left: 100%;\n}\n\n/* 联机模式样式 */\n.online-saves-container[data-v-579f7e28] {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 1rem;\n  height: 0;\n}\n.login-prompt[data-v-579f7e28] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: 2rem;\n}\n.login-icon[data-v-579f7e28] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n.btn-login[data-v-579f7e28] {\n  padding: 0.8rem 1.5rem;\n  background: var(--color-primary);\n  color: white;\n  border: 1px solid var(--color-primary-active);\n  border-radius: 8px;\n  cursor: pointer;\n  margin-top: 1rem;\n}\n.online-save-card[data-v-579f7e28] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.9),\n    rgba(var(--color-background-rgb), 0.7)\n  );\n  backdrop-filter: blur(15px);\n  border: 2px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 8px;\n  padding: 0.9rem;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text);\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n.online-actions[data-v-579f7e28] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n}\n\n/* 详情弹窗 */\n.modal-overlay[data-v-579f7e28] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  backdrop-filter: blur(4px);\n}\n.details-modal[data-v-579f7e28] {\n  background: var(--color-surface-transparent);\n  backdrop-filter: blur(20px);\n  border-radius: 15px;\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  overflow-y: auto;\n  border: 1px solid var(--color-border);\n}\n.modal-header[data-v-579f7e28] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem 2rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-header h3[data-v-579f7e28] {\n  margin: 0;\n  color: var(--color-accent);\n}\n.btn-close[data-v-579f7e28] {\n  background: none;\n  border: 1px solid var(--color-border);\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0.1rem;\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n}\n.modal-content[data-v-579f7e28] {\n  padding: 2rem;\n}\n.details-grid[data-v-579f7e28] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 2rem;\n}\n.detail-section[data-v-579f7e28] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.08),\n    rgba(var(--color-accent-rgb), 0.06)\n  );\n  border: 1px solid rgba(var(--color-primary-rgb), 0.15);\n  border-radius: 10px;\n  padding: 1.5rem;\n  backdrop-filter: blur(8px);\n}\n.detail-section h4[data-v-579f7e28] {\n  margin: 0 0 1rem 0;\n  color: var(--color-warning);\n}\n.detail-items[data-v-579f7e28] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.8rem;\n}\n.detail-item[data-v-579f7e28] {\n  display: flex;\n  justify-content: space-between;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.3);\n}\n.detail-item .label[data-v-579f7e28] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.detail-item .value[data-v-579f7e28] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n.attributes-display[data-v-579f7e28] {\n  display: flex;\n  justify-content: center;\n}\n.talents-list[data-v-579f7e28] {\n  min-height: 100px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.talent-items[data-v-579f7e28] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.talent-tag[data-v-579f7e28] {\n  background: rgba(var(--color-accent-rgb), 0.15);\n  color: var(--color-accent);\n  padding: 4px 8px;\n  border-radius: 6px;\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n.no-talents[data-v-579f7e28] {\n  color: var(--color-text-secondary);\n  font-style: italic;\n  text-align: center;\n}\n\n/* 响应式适配 */\n@media (max-width: 1200px) {\n.grid-container[data-v-579f7e28] {\n    grid-template-columns: 300px 1fr;\n}\n\n  /* 调整分割线位置 */\n.grid-container[data-v-579f7e28]::before {\n    left: 300px;\n}\n.manual-saves-grid[data-v-579f7e28] {\n    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n}\n}\n@media (max-width: 1024px) {\n.grid-container[data-v-579f7e28] {\n    grid-template-columns: 280px 1fr;\n}\n\n  /* 调整分割线位置 */\n.grid-container[data-v-579f7e28]::before {\n    left: 280px;\n}\n.characters-panel[data-v-579f7e28] {\n    max-width: 260px;\n}\n.save-card[data-v-579f7e28],\n  .online-save-card[data-v-579f7e28] {\n    padding: 0.8rem;\n}\n.details-grid[data-v-579f7e28] {\n    grid-template-columns: 1fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 640px) {\n.mobile-header[data-v-579f7e28] {\n    display: flex;\n}\n.character-management-panel[data-v-579f7e28] {\n    height: 100%;\n    overflow: hidden;\n}\n.main-content[data-v-579f7e28] {\n    flex: 1;\n    overflow: hidden;\n    min-height: 0;\n}\n.management-layout[data-v-579f7e28] {\n    flex-direction: column;\n    height: 100%;\n}\n.grid-container[data-v-579f7e28] {\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr auto;\n    grid-template-areas:\n      'header-right'\n      'content-main'\n      'footer-main';\n    order: 1;\n}\n\n  /* 移动端隐藏垂直分割线 */\n.grid-container[data-v-579f7e28]::before {\n    display: none;\n}\n.grid-header-left[data-v-579f7e28] {\n    border-right: none;\n    border-bottom: 1px solid var(--color-border);\n    /* 手机端隐藏左侧标题栏 */\n    display: none;\n}\n.grid-header-right[data-v-579f7e28] {\n    padding: 0.8rem;\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.8rem;\n}\n.header-left-content[data-v-579f7e28] {\n    gap: 0.3rem;\n}\n.save-actions-buttons[data-v-579f7e28] {\n    width: 100%;\n    gap: 0.5rem;\n}\n.btn-save-action[data-v-579f7e28] {\n    flex: 1;\n    padding: 0.7rem 0.8rem;\n    font-size: 0.8rem;\n    justify-content: center;\n}\n.btn-save-action span[data-v-579f7e28] {\n    display: inline;\n}\n.grid-content-left[data-v-579f7e28],\n  .grid-content-right[data-v-579f7e28] {\n    grid-area: content-main;\n    position: relative;\n    overflow: hidden;\n    height: 100%;\n}\n.grid-footer-left[data-v-579f7e28],\n  .grid-footer-right[data-v-579f7e28] {\n    grid-area: footer-main;\n    border-right: none;\n}\n.characters-panel[data-v-579f7e28] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    width: 85%;\n    max-width: 280px;\n    z-index: 1200;\n    transform: translateX(-100%);\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);\n    border: none;\n    background: var(--color-surface);\n    backdrop-filter: blur(20px);\n    margin: 0;\n    padding: 0;\n    border-right: none;\n}\n.characters-panel.is-open[data-v-579f7e28] {\n    transform: translateX(0);\n}\n.saves-panel[data-v-579f7e28] {\n    width: 100%;\n    border-left: none;\n}\n.saves-container[data-v-579f7e28],\n  .online-saves-container[data-v-579f7e28] {\n    padding: 1rem 1.2rem;\n    flex: 1;\n    min-height: 0;\n    max-height: none;\n}\n.auto-saves-grid[data-v-579f7e28] {\n    grid-template-columns: 1fr;\n    gap: 0.8rem;\n}\n.manual-saves-grid[data-v-579f7e28] {\n    grid-template-columns: 1fr;\n    gap: 0.8rem;\n    max-height: 300px;\n}\n.modal-content[data-v-579f7e28] {\n    padding: 1rem;\n}\n.details-modal[data-v-579f7e28] {\n    width: 95%;\n    max-height: 85vh;\n}\n.dialog-box[data-v-579f7e28] {\n    width: 95%;\n    max-width: 400px;\n    padding: 1.5rem;\n}\n.characters-grid[data-v-579f7e28] {\n    padding: 1rem;\n}\n.character-card[data-v-579f7e28] {\n    padding: 1rem;\n    margin-bottom: 0.8rem;\n    transition: all 0.2s ease;\n}\n.character-card[data-v-579f7e28]:active {\n    transform: scale(0.98);\n    background: linear-gradient(\n      135deg,\n      rgba(var(--color-primary-rgb), 0.05),\n      rgba(var(--color-accent-rgb), 0.03)\n    );\n}\n.card-header[data-v-579f7e28] {\n    flex-wrap: wrap;\n    gap: 0.8rem;\n}\n.char-info[data-v-579f7e28] {\n    min-width: 120px;\n}\n.char-meta[data-v-579f7e28] {\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n}\n@media (max-width: 640px) {\n.mobile-header[data-v-579f7e28] {\n    padding: 0.8rem 1rem;\n}\n.mobile-menu-btn[data-v-579f7e28] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.8rem;\n    min-height: 44px;\n    min-width: 44px;\n}\n.mobile-title h2[data-v-579f7e28] {\n    font-size: 1.1rem;\n}\n.mobile-title .selected-info[data-v-579f7e28] {\n    font-size: 0.75rem;\n}\n.characters-panel[data-v-579f7e28] {\n    width: 90%;\n    max-width: 300px;\n}\n.character-card[data-v-579f7e28] {\n    padding: 0.9rem;\n    position: relative;\n    overflow: hidden;\n}\n.character-card[data-v-579f7e28]::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(var(--color-primary-rgb), 0.1);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    transition:\n      width 0.3s ease,\n      height 0.3s ease;\n    pointer-events: none;\n}\n.character-card[data-v-579f7e28]:active::after {\n    width: 200px;\n    height: 200px;\n}\n.save-card[data-v-579f7e28],\n  .online-save-card[data-v-579f7e28] {\n    padding: 1rem;\n    position: relative;\n    overflow: hidden;\n}\n.save-card[data-v-579f7e28]::after,\n  .online-save-card[data-v-579f7e28]::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(var(--color-success-rgb), 0.1);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    transition:\n      width 0.3s ease,\n      height 0.3s ease;\n    pointer-events: none;\n}\n.save-card[data-v-579f7e28]:active::after,\n  .online-save-card[data-v-579f7e28]:active::after {\n    width: 150px;\n    height: 150px;\n}\n.auto-saves-grid[data-v-579f7e28] {\n    gap: 0.6rem;\n}\n.manual-saves-grid[data-v-579f7e28] {\n    gap: 0.6rem;\n}\n}\n@media (max-width: 480px) {\n.empty-actions[data-v-579f7e28] {\n    flex-direction: column;\n}\n.btn-create[data-v-579f7e28],\n  .btn-import[data-v-579f7e28] {\n    width: 100%;\n}\n.mobile-header[data-v-579f7e28] {\n    padding: 0.6rem 0.8rem;\n}\n.mobile-menu-btn[data-v-579f7e28] {\n    padding: 0.4rem 0.5rem;\n    min-height: 44px;\n    min-width: 44px;\n}\n.mobile-title h2[data-v-579f7e28] {\n    font-size: 1rem;\n}\n.hamburger[data-v-579f7e28] {\n    width: 14px;\n    height: 10px;\n}\n.characters-panel[data-v-579f7e28] {\n    width: 95%;\n    max-width: 280px;\n}\n.characters-grid[data-v-579f7e28] {\n    padding: 0.8rem;\n}\n.character-card[data-v-579f7e28] {\n    padding: 0.8rem;\n    margin-bottom: 0.8rem;\n    min-height: 80px;\n}\n.btn-save-action span[data-v-579f7e28] {\n    font-size: 0.75rem;\n}\n.card-header[data-v-579f7e28] {\n    margin-bottom: 0.8rem;\n    gap: 0.6rem;\n}\n.char-avatar[data-v-579f7e28] {\n    width: 40px;\n    height: 40px;\n    font-size: 1.1rem;\n}\n.mode-indicator[data-v-579f7e28] {\n    width: 16px;\n    height: 16px;\n    font-size: 0.6rem;\n}\n.char-name[data-v-579f7e28] {\n    font-size: 1rem;\n}\n.char-meta[data-v-579f7e28] {\n    font-size: 0.8rem;\n}\n.saves-container[data-v-579f7e28],\n  .online-saves-container[data-v-579f7e28] {\n    padding: 0.8rem;\n    flex: 1;\n    min-height: 0;\n    max-height: none;\n}\n.save-card[data-v-579f7e28],\n  .online-save-card[data-v-579f7e28] {\n    padding: 0.9rem;\n    min-height: 120px;\n}\n.stat-grid[data-v-579f7e28] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.save-footer[data-v-579f7e28] {\n    flex-direction: column;\n    gap: 0.3rem;\n    align-items: flex-start;\n}\n.dialog-box[data-v-579f7e28] {\n    width: 95%;\n    padding: 1.2rem;\n    max-height: 90vh;\n    overflow-y: auto;\n}\n.dialog-title[data-v-579f7e28] {\n    font-size: 1.3rem;\n}\n.dialog-actions[data-v-579f7e28] {\n    flex-direction: column-reverse;\n    gap: 0.8rem;\n}\n.btn-dialog-confirm[data-v-579f7e28],\n  .btn-dialog-cancel[data-v-579f7e28] {\n    width: 100%;\n    padding: 0.8rem;\n    min-height: 44px;\n    font-size: 1rem;\n}\n.details-grid[data-v-579f7e28] {\n    grid-template-columns: 1fr;\n    gap: 1rem;\n}\n.detail-section[data-v-579f7e28] {\n    padding: 1rem;\n}\n.btn-details[data-v-579f7e28],\n  .btn-export[data-v-579f7e28],\n  .btn-delete[data-v-579f7e28] {\n    min-height: 36px;\n    font-size: 0.85rem;\n    padding: 0.6rem 0.8rem;\n}\n.btn-start[data-v-579f7e28],\n  .btn-play[data-v-579f7e28],\n  .btn-sync[data-v-579f7e28] {\n    min-height: 40px;\n    padding: 0.7rem 1rem;\n    font-size: 0.85rem;\n}\n}\n@media (max-width: 360px) {\n.mobile-header[data-v-579f7e28] {\n    padding: 0.5rem;\n}\n.mobile-menu-btn[data-v-579f7e28] {\n    padding: 0.3rem 0.4rem;\n    gap: 0.3rem;\n    min-height: 40px;\n    min-width: 40px;\n}\n.mobile-title h2[data-v-579f7e28] {\n    font-size: 0.95rem;\n}\n.mobile-title .selected-info[data-v-579f7e28] {\n    font-size: 0.7rem;\n}\n.characters-panel[data-v-579f7e28] {\n    width: 100%;\n    max-width: 260px;\n    min-width: 240px;\n}\n.character-card[data-v-579f7e28] {\n    padding: 0.6rem;\n    min-height: 70px;\n}\n.save-card[data-v-579f7e28],\n  .online-save-card[data-v-579f7e28] {\n    padding: 0.8rem;\n    min-height: 100px;\n}\n.save-header[data-v-579f7e28] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n}\n.save-badges[data-v-579f7e28] {\n    align-self: stretch;\n    justify-content: flex-start;\n}\n.dialog-box[data-v-579f7e28] {\n    width: 98%;\n    padding: 1rem;\n    margin: 0.5rem;\n    max-height: 95vh;\n}\n.dialog-title[data-v-579f7e28] {\n    font-size: 1.1rem;\n}\n.dialog-message[data-v-579f7e28] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n}\n.dialog-input[data-v-579f7e28] {\n    padding: 0.7rem;\n    font-size: 0.9rem;\n}\n.btn-dialog-confirm[data-v-579f7e28],\n  .btn-dialog-cancel[data-v-579f7e28] {\n    padding: 0.7rem;\n    font-size: 0.9rem;\n    min-height: 40px;\n}\n.character-management-panel[data-v-579f7e28] {\n    height: 100%;\n    overflow: hidden;\n}\n.main-content[data-v-579f7e28] {\n    flex: 1;\n    overflow: hidden;\n    min-height: 0;\n}\n.saves-container[data-v-579f7e28],\n  .online-saves-container[data-v-579f7e28] {\n    flex: 1;\n    min-height: 0;\n    padding: 0.6rem;\n    max-height: none;\n}\n.char-name[data-v-579f7e28] {\n    font-size: 0.9rem;\n}\n.char-meta[data-v-579f7e28] {\n    font-size: 0.75rem;\n}\n.save-count .count[data-v-579f7e28] {\n    font-size: 1rem;\n}\n.save-count .label[data-v-579f7e28] {\n    font-size: 0.65rem;\n}\n}\n\n/* Style unification overrides */\n/* Replace absolute divider with contextual borders */\n.grid-container[data-v-579f7e28]::before {\n  content: none;\n}\n.grid-header-left[data-v-579f7e28],\n.grid-content-left[data-v-579f7e28],\n.grid-footer-left[data-v-579f7e28] {\n  border-right: var(--cm-divider-width) solid var(--color-primary);\n  box-sizing: border-box;\n}\n\n/* Ensure left column fills its grid cell at <=1024px (fix misaligned divider) */\n@media (max-width: 1024px) {\n.grid-content-left.characters-panel[data-v-579f7e28] {\n    max-width: none;\n    width: 100%;\n}\n}\n\n/* Consistent radii across controls */\n.dialog-box[data-v-579f7e28] {\n  border-radius: var(--cm-radius-lg);\n}\n.dialog-input[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-dialog-confirm[data-v-579f7e28],\n.btn-dialog-cancel[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n.fullscreen-back-btn[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n.character-card[data-v-579f7e28] {\n  border-radius: var(--cm-radius-sm);\n}\n.save-card[data-v-579f7e28],\n.online-save-card[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-details[data-v-579f7e28],\n.btn-delete[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-start[data-v-579f7e28],\n.btn-play[data-v-579f7e28],\n.btn-sync[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-login[data-v-579f7e28],\n.btn-close[data-v-579f7e28] {\n  border-radius: var(--cm-radius-md);\n}\n\n/* Desktop card density adjustments: make character list less flat */\n@media (min-width: 769px) {\n.characters-grid[data-v-579f7e28] {\n    padding: 0.8rem;\n}\n.character-card[data-v-579f7e28] {\n    min-height: var(--cm-card-min-h);\n    padding: var(--cm-card-padding);\n}\n.card-header[data-v-579f7e28] {\n    gap: var(--cm-header-gap);\n    margin-bottom: 0.6rem;\n}\n.char-avatar[data-v-579f7e28] {\n    width: var(--cm-avatar-size);\n    height: var(--cm-avatar-size);\n    font-size: 0.95rem;\n}\n.char-name[data-v-579f7e28] {\n    font-size: var(--cm-name-font);\n}\n.char-meta[data-v-579f7e28] {\n    font-size: var(--cm-meta-font);\n}\n.save-count[data-v-579f7e28] {\n    min-width: var(--cm-save-count-minw);\n}\n.save-count .count[data-v-579f7e28] {\n    font-size: var(--cm-save-count-count-font);\n}\n.save-count .label[data-v-579f7e28] {\n    font-size: var(--cm-save-count-label-font);\n}\n}\n\n/* ========== 深色玻璃拟态风格适配 ========== */\n[data-theme='dark'] .character-management-panel[data-v-579f7e28] {\n  background: rgb(30, 41, 59);\n}\n[data-theme='dark'] .fullscreen-header[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.9);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n}\n[data-theme='dark'] .fullscreen-back-btn[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme='dark'] .fullscreen-back-btn[data-v-579f7e28]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n  border-color: rgba(147, 197, 253, 0.3);\n}\n[data-theme='dark'] .fullscreen-title h1[data-v-579f7e28] {\n  color: #f1f5f9;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.4);\n}\n[data-theme='dark'] .fullscreen-title p[data-v-579f7e28] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .mobile-header[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.9);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n}\n[data-theme='dark'] .mobile-menu-btn[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.8);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme='dark'] .mobile-menu-btn[data-v-579f7e28]:hover {\n  background: rgba(51, 65, 85, 0.9);\n  color: #93c5fd;\n  border-color: rgba(147, 197, 253, 0.3);\n}\n[data-theme='dark'] .mobile-menu-btn.active[data-v-579f7e28] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  color: #ffffff;\n  border-color: rgba(147, 197, 253, 0.5);\n}\n[data-theme='dark'] .mobile-title h2[data-v-579f7e28] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .mobile-title .selected-info[data-v-579f7e28] {\n  color: #94a3b8;\n}\n\n/* 网格布局暗色适配 */\n[data-theme='dark'] .grid-header-left[data-v-579f7e28],\n[data-theme='dark'] .grid-header-right[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.8);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .grid-header-left h2[data-v-579f7e28],\n[data-theme='dark'] .grid-header-right h2[data-v-579f7e28] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .character-count[data-v-579f7e28] {\n  background: rgba(15, 23, 42, 0.6);\n  border-color: rgba(255, 255, 255, 0.08);\n  color: #94a3b8;\n}\n[data-theme='dark'] .selected-char-info[data-v-579f7e28] {\n  background: rgba(59, 130, 246, 0.15);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #93c5fd;\n}\n[data-theme='dark'] .grid-content-left[data-v-579f7e28],\n[data-theme='dark'] .grid-content-right[data-v-579f7e28] {\n  background: rgb(30, 41, 59);\n}\n[data-theme='dark'] .grid-content-left.characters-panel[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.95);\n}\n\n/* 分割线暗色适配 */\n[data-theme='dark'] .grid-header-left[data-v-579f7e28],\n[data-theme='dark'] .grid-content-left[data-v-579f7e28],\n[data-theme='dark'] .grid-footer-left[data-v-579f7e28] {\n  border-right-color: rgba(147, 197, 253, 0.3);\n}\n\n/* 角色卡片暗色适配 */\n[data-theme='dark'] .character-card[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .character-card[data-v-579f7e28]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  border-color: rgba(147, 197, 253, 0.3);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n[data-theme='dark'] .character-card.active[data-v-579f7e28] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.5);\n}\n[data-theme='dark'] .character-card.single-mode[data-v-579f7e28] {\n  border-left-color: #9ece6a;\n}\n[data-theme='dark'] .character-card.online-mode[data-v-579f7e28] {\n  border-left-color: #93c5fd;\n}\n[data-theme='dark'] .char-name[data-v-579f7e28] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .char-meta[data-v-579f7e28] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .save-count .count[data-v-579f7e28] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .save-count .label[data-v-579f7e28] {\n  color: #64748b;\n}\n[data-theme='dark'] .card-actions[data-v-579f7e28] {\n  border-top-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .btn-details[data-v-579f7e28],\n[data-theme='dark'] .btn-export[data-v-579f7e28],\n[data-theme='dark'] .btn-delete[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.6);\n}\n[data-theme='dark'] .btn-details[data-v-579f7e28] {\n  color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.4);\n}\n[data-theme='dark'] .btn-details[data-v-579f7e28]:hover {\n  background: #77cdfe;\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-export[data-v-579f7e28] {\n  color: #9ece6a;\n  border-color: rgba(158, 206, 106, 0.4);\n}\n[data-theme='dark'] .btn-export[data-v-579f7e28]:hover {\n  background: #9ece6a;\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-delete[data-v-579f7e28] {\n  color: #f87171;\n  border-color: rgba(248, 113, 113, 0.4);\n}\n[data-theme='dark'] .btn-delete[data-v-579f7e28]:hover {\n  background: #f87171;\n  color: #0f172a;\n}\n\n/* 存档面板暗色适配 */\n[data-theme='dark'] .saves-panel[data-v-579f7e28] {\n  background: rgb(30, 41, 59);\n}\n[data-theme='dark'] .no-selection[data-v-579f7e28] {\n  color: #64748b;\n}\n[data-theme='dark'] .manual-saves-header h3[data-v-579f7e28] {\n  color: #fbbf24;\n}\n[data-theme='dark'] .save-info-text[data-v-579f7e28] {\n  color: #64748b;\n}\n\n/* 存档卡片暗色适配 */\n[data-theme='dark'] .save-card[data-v-579f7e28],\n[data-theme='dark'] .online-save-card[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(15px);\n}\n[data-theme='dark'] .save-card[data-v-579f7e28]::before,\n[data-theme='dark'] .online-save-card[data-v-579f7e28]::before {\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.08), rgba(192, 202, 245, 0.04));\n}\n[data-theme='dark'] .save-card[data-v-579f7e28]:hover,\n[data-theme='dark'] .online-save-card[data-v-579f7e28]:hover {\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n}\n[data-theme='dark'] .save-card.has-data[data-v-579f7e28] {\n  border-left-color: #9ece6a;\n  border-color: rgba(158, 206, 106, 0.5);\n}\n[data-theme='dark'] .save-card.auto-save[data-v-579f7e28] {\n  border-left-color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.5);\n}\n[data-theme='dark'] .save-card.has-data[data-v-579f7e28]::after {\n  background: #9ece6a;\n  box-shadow: 0 0 8px rgba(158, 206, 106, 0.6);\n}\n[data-theme='dark'] .save-name[data-v-579f7e28] {\n  color: #fbbf24;\n}\n[data-theme='dark'] .realm-badge[data-v-579f7e28] {\n  background: rgba(158, 206, 106, 0.2);\n  color: #9ece6a;\n}\n[data-theme='dark'] .age-badge[data-v-579f7e28] {\n  background: rgba(192, 202, 245, 0.2);\n  color: #c0caf5;\n}\n[data-theme='dark'] .stat .label[data-v-579f7e28] {\n  color: #64748b;\n}\n[data-theme='dark'] .stat .value[data-v-579f7e28] {\n  color: #e2e8f0;\n}\n[data-theme='dark'] .save-footer[data-v-579f7e28] {\n  border-top-color: rgba(255, 255, 255, 0.08);\n  color: #64748b;\n}\n[data-theme='dark'] .sync-status.synced[data-v-579f7e28] {\n  background: rgba(158, 206, 106, 0.2);\n  color: #9ece6a;\n}\n[data-theme='dark'] .save-empty[data-v-579f7e28] {\n  color: #64748b;\n}\n\n/* 存档操作按钮暗色适配 */\n[data-theme='dark'] .btn-export-save[data-v-579f7e28] {\n  background: rgba(158, 206, 106, 0.15);\n  border-color: rgba(158, 206, 106, 0.3);\n  color: #9ece6a;\n}\n[data-theme='dark'] .btn-export-save[data-v-579f7e28]:hover {\n  background: rgba(158, 206, 106, 0.25);\n  border-color: rgba(158, 206, 106, 0.5);\n}\n[data-theme='dark'] .btn-edit-save[data-v-579f7e28] {\n  background: rgba(119, 205, 254, 0.15);\n  border-color: rgba(119, 205, 254, 0.3);\n  color: #77cdfe;\n}\n[data-theme='dark'] .btn-edit-save[data-v-579f7e28]:hover {\n  background: rgba(119, 205, 254, 0.25);\n  border-color: rgba(119, 205, 254, 0.5);\n}\n[data-theme='dark'] .btn-delete-save[data-v-579f7e28] {\n  background: rgba(248, 113, 113, 0.15);\n  border-color: rgba(248, 113, 113, 0.3);\n  color: #f87171;\n}\n[data-theme='dark'] .btn-delete-save[data-v-579f7e28]:hover:not(.disabled):not(:disabled) {\n  background: rgba(248, 113, 113, 0.25);\n  border-color: rgba(248, 113, 113, 0.5);\n}\n\n/* 按钮暗色适配 */\n[data-theme='dark'] .btn-start[data-v-579f7e28],\n[data-theme='dark'] .btn-play[data-v-579f7e28],\n[data-theme='dark'] .btn-sync[data-v-579f7e28] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n[data-theme='dark'] .btn-start[data-v-579f7e28]:hover,\n[data-theme='dark'] .btn-play[data-v-579f7e28]:hover,\n[data-theme='dark'] .btn-sync[data-v-579f7e28]:hover {\n  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);\n}\n[data-theme='dark'] .btn-header-action[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.6);\n}\n[data-theme='dark'] .btn-header-action.import[data-v-579f7e28] {\n  color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.4);\n}\n[data-theme='dark'] .btn-header-action.import[data-v-579f7e28]:hover {\n  background: rgba(119, 205, 254, 0.15);\n  border-color: #77cdfe;\n}\n[data-theme='dark'] .btn-header-action.migrate[data-v-579f7e28] {\n  color: #e0af68;\n  border-color: rgba(224, 175, 104, 0.4);\n}\n[data-theme='dark'] .btn-header-action.migrate[data-v-579f7e28]:hover {\n  background: rgba(224, 175, 104, 0.15);\n  border-color: #e0af68;\n}\n[data-theme='dark'] .btn-save-action[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.7);\n  backdrop-filter: blur(10px);\n}\n[data-theme='dark'] .btn-save-action.export[data-v-579f7e28] {\n  color: #9ece6a;\n  border-color: rgba(158, 206, 106, 0.4);\n}\n[data-theme='dark'] .btn-save-action.export[data-v-579f7e28]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #9ece6a, rgba(158, 206, 106, 0.8));\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-save-action.import[data-v-579f7e28] {\n  color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.4);\n}\n[data-theme='dark'] .btn-save-action.import[data-v-579f7e28]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #77cdfe, rgba(119, 205, 254, 0.8));\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-save-action.migrate[data-v-579f7e28] {\n  color: var(--color-warning);\n  border-color: rgba(var(--color-warning-rgb), 0.45);\n}\n[data-theme='dark'] .btn-save-action.migrate[data-v-579f7e28]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-warning), rgba(var(--color-warning-rgb), 0.85));\n  color: #0f172a;\n}\n\n/* 对话框暗色适配 */\n[data-theme='dark'] .dialog-overlay[data-v-579f7e28] {\n  background: rgba(10, 15, 25, 0.7);\n}\n[data-theme='dark'] .dialog-box[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(20px);\n}\n[data-theme='dark'] .dialog-title[data-v-579f7e28] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .dialog-message[data-v-579f7e28] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .dialog-input[data-v-579f7e28] {\n  background: rgba(15, 23, 42, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #f1f5f9;\n}\n[data-theme='dark'] .dialog-input[data-v-579f7e28]:focus {\n  border-color: #93c5fd;\n  box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.2);\n}\n[data-theme='dark'] .btn-dialog-confirm[data-v-579f7e28] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  border-color: rgba(147, 197, 253, 0.4);\n}\n[data-theme='dark'] .btn-dialog-cancel[data-v-579f7e28] {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme='dark'] .btn-dialog-cancel[data-v-579f7e28]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n}\n\n/* 详情弹窗暗色适配 */\n[data-theme='dark'] .modal-overlay[data-v-579f7e28] {\n  background: rgba(10, 15, 25, 0.7);\n}\n[data-theme='dark'] .details-modal[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(20px);\n}\n[data-theme='dark'] .modal-header[data-v-579f7e28] {\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .modal-header h3[data-v-579f7e28] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .btn-close[data-v-579f7e28] {\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #64748b;\n}\n[data-theme='dark'] .btn-close[data-v-579f7e28]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  color: #f1f5f9;\n}\n[data-theme='dark'] .detail-section[data-v-579f7e28] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(147, 197, 253, 0.15);\n}\n[data-theme='dark'] .detail-section h4[data-v-579f7e28] {\n  color: #fbbf24;\n}\n[data-theme='dark'] .detail-item[data-v-579f7e28] {\n  border-bottom-color: rgba(255, 255, 255, 0.06);\n}\n[data-theme='dark'] .detail-item .label[data-v-579f7e28] {\n  color: #64748b;\n}\n[data-theme='dark'] .detail-item .value[data-v-579f7e28] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .talent-tag[data-v-579f7e28] {\n  background: rgba(192, 202, 245, 0.2);\n  color: #c0caf5;\n}\n[data-theme='dark'] .no-talents[data-v-579f7e28] {\n  color: #64748b;\n}\n\n/* 空状态暗色适配 */\n[data-theme='dark'] .empty-state h2[data-v-579f7e28] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .empty-state p[data-v-579f7e28] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .btn-create[data-v-579f7e28] {\n  background: linear-gradient(135deg, #9ece6a, #77cdfe);\n  border-color: rgba(158, 206, 106, 0.5);\n}\n[data-theme='dark'] .btn-import[data-v-579f7e28] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(192, 202, 245, 0.8));\n  border-color: rgba(147, 197, 253, 0.5);\n}\n\n/* 联机模式暗色适配 */\n[data-theme='dark'] .login-prompt h3[data-v-579f7e28] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .login-prompt p[data-v-579f7e28] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .btn-login[data-v-579f7e28] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  border-color: rgba(147, 197, 253, 0.4);\n}\n\n/* 加载状态暗色适配 */\n[data-theme='dark'] .loading-saves p[data-v-579f7e28] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .loading-spinner[data-v-579f7e28] {\n  border-color: rgba(147, 197, 253, 0.2);\n  border-top-color: #93c5fd;\n}\n",""]);const s=i},5795:(e,n,t)=>{"use strict";var a=t(6549);if(a)try{a([],"length")}catch(e){a=null}e.exports=a},5815:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.left-sidebar[data-v-216cae6e] {\n  --sidebar-card-radius: 10px;\n  --sidebar-btn-radius: 8px;\n  --sidebar-pill-radius: 6px;\n  width: 100%;\n  height: 100%;\n  padding: 10px 8px;\n  box-sizing: border-box;\n  font-family: var(--font-family-sans-serif);\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n  border-radius: 0;\n  box-shadow: none;\n  position: relative;\n  isolation: isolate;\n  overflow: visible;\n}\n.left-sidebar[data-v-216cae6e]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background:\n    radial-gradient(ellipse 80% 50% at 10% 0%, rgba(var(--color-primary-rgb), 0.08), transparent),\n    radial-gradient(ellipse 60% 40% at 95% 5%, rgba(var(--color-accent-rgb), 0.06), transparent);\n  pointer-events: none;\n  z-index: 0;\n}\n.sidebar-header[data-v-216cae6e],\n.sidebar-content[data-v-216cae6e],\n.sidebar-footer[data-v-216cae6e] {\n  position: relative;\n  z-index: 1;\n}\n.sidebar-header[data-v-216cae6e] {\n  margin: 0 0 10px 0;\n  padding: 10px 8px;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.3);\n  background: transparent;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  flex-shrink: 0;\n}\n.sidebar-footer[data-v-216cae6e] {\n  margin-top: auto;\n  padding: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 10px;\n  border-top: 1px solid rgba(var(--color-border-rgb), 0.3);\n  background: transparent;\n  flex-shrink: 0;\n}\n.footer-links[data-v-216cae6e] {\n  display: flex;\n  gap: 6px;\n}\n.footer-link[data-v-216cae6e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  border-radius: 50%;\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  transition: all 0.2s ease;\n  cursor: pointer;\n}\n.footer-link[data-v-216cae6e]:hover {\n  transform: scale(1.1);\n}\n.footer-link.github[data-v-216cae6e] {\n  color: var(--color-text-secondary);\n}\n.footer-link.github[data-v-216cae6e]:hover {\n  color: #fff;\n  background: #333;\n  border-color: #333;\n}\n.footer-link.sponsor[data-v-216cae6e] {\n  color: #f472b6;\n}\n.footer-link.sponsor[data-v-216cae6e]:hover {\n  color: #fff;\n  background: #ec4899;\n  border-color: #ec4899;\n}\n.sponsor-modal-overlay[data-v-216cae6e] {\n  position: fixed;\n  inset: 0;\n  width: 100vw;\n  height: 100vh;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  z-index: 2000;\n}\n.sponsor-modal[data-v-216cae6e] {\n  width: min(520px, 100%);\n  background: var(--color-surface, #ffffff);\n  border-radius: 14px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);\n  overflow: hidden;\n}\n.sponsor-modal-header[data-v-216cae6e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.sponsor-modal-header h3[data-v-216cae6e] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 800;\n}\n.sponsor-close[data-v-216cae6e] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  font-size: 1.5rem;\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n}\n.sponsor-close[data-v-216cae6e]:hover {\n  background: var(--color-surface-hover);\n}\n.sponsor-modal-body[data-v-216cae6e] {\n  padding: 1rem 1.25rem 1.5rem;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  justify-items: center;\n}\n.sponsor-qr[data-v-216cae6e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.5rem;\n  width: 100%;\n}\n.sponsor-qr img[data-v-216cae6e] {\n  width: 100%;\n  max-width: 240px;\n  border-radius: 12px;\n  background: #fff;\n  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);\n  display: block;\n}\n.sponsor-qr span[data-v-216cae6e] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n.app-version[data-v-216cae6e] {\n  font-family: monospace;\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #67e8f9;\n  padding: 0.25rem 0.6rem;\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.12) 0%, rgba(56, 189, 248, 0.08) 100%);\n  border: 1px solid rgba(34, 211, 238, 0.35);\n  border-radius: 10px;\n  display: inline-block;\n  letter-spacing: 0.5px;\n  text-shadow: 0 0 8px rgba(34, 211, 238, 0.5);\n  box-shadow: 0 0 12px rgba(34, 211, 238, 0.15);\n  transition: all 0.3s ease;\n}\n.app-version[data-v-216cae6e]:hover {\n  color: #a5f3fc;\n  border-color: rgba(34, 211, 238, 0.5);\n  box-shadow: 0 0 16px rgba(34, 211, 238, 0.25);\n  text-shadow: 0 0 12px rgba(34, 211, 238, 0.7);\n}\n.sidebar-title[data-v-216cae6e] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  text-align: center;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n}\n.real-time[data-v-216cae6e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-family: 'Courier New', monospace;\n  padding: 4px 8px;\n  background: rgba(var(--color-surface-rgb), 0.7);\n  border-radius: var(--sidebar-pill-radius);\n  border: 1px solid rgba(var(--color-border-rgb), 0.5);\n}\n.time-icon[data-v-216cae6e] {\n  color: var(--color-primary);\n}\n.title-icon[data-v-216cae6e] {\n  color: var(--color-primary);\n}\n.sidebar-content[data-v-216cae6e] {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: visible; /* 改为 visible 防止右边框被截断 */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n  padding-bottom: 4px;\n  padding-right: 2px; /* 给右边框留出空间 */\n  min-width: 0;\n}\n.sidebar-content[data-v-216cae6e]::-webkit-scrollbar {\n  width: 4px;\n}\n.sidebar-content[data-v-216cae6e]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.sidebar-content[data-v-216cae6e]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 2px;\n}\n[data-theme=\"dark\"] .sidebar-content[data-v-216cae6e]::-webkit-scrollbar-thumb {\n  background: transparent;\n}\n\n/* 功能分区样式 */\n.function-section[data-v-216cae6e] {\n  margin: 0 5px 8px 5px;\n  padding: 8px;\n  border-radius: var(--sidebar-card-radius);\n  border: 1px solid rgba(var(--color-border-rgb), 0.3);\n  background: rgba(var(--color-surface-rgb), 0.4);\n}\n.section-title[data-v-216cae6e] {\n  font-size: 0.65rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  margin-bottom: 6px;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  display: inline-flex;\n  align-items: center;\n  letter-spacing: 0.3px;\n}\n.function-group[data-v-216cae6e] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  padding-right: 2px; /* 防止按钮右边框被截断 */\n}\n.system-section[data-v-216cae6e] {\n  margin: 0 5px 8px 5px;\n  padding: 8px;\n  border-radius: var(--sidebar-card-radius);\n  border: 1px solid rgba(var(--color-border-rgb), 0.3);\n  background: rgba(var(--color-surface-rgb), 0.4);\n}\n.divider[data-v-216cae6e] {\n  height: 1px;\n  background: linear-gradient(90deg, transparent 10%, rgba(var(--color-border-rgb), 0.4) 50%, transparent 90%);\n  margin: 8px 0;\n}\n\n/* 增强的按钮样式 */\n.function-btn[data-v-216cae6e] {\n  display: flex;\n  align-items: center;\n  padding: 10px 12px;\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border: 1px solid rgba(var(--color-border-rgb), 0.3);\n  border-radius: var(--sidebar-btn-radius);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-family: inherit;\n  text-align: left;\n  width: 100%;\n  position: relative;\n  overflow: hidden;\n}\n.function-btn[data-v-216cae6e]:hover {\n  background: rgba(var(--color-surface-rgb), 0.9);\n  border-color: rgba(var(--color-primary-rgb), 0.4);\n  transform: translateX(2px);\n}\n.function-btn[data-v-216cae6e]:active {\n  transform: translateX(1px) scale(0.99);\n}\n\n/* 按钮图标区域 */\n.function-btn .btn-icon[data-v-216cae6e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border-radius: var(--sidebar-pill-radius);\n  background: var(--color-background);\n  margin-right: 10px;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n\n/* 按钮内容区域 */\n.function-btn .btn-content[data-v-216cae6e] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n.function-btn .btn-text[data-v-216cae6e] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  line-height: 1.3;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* 英文环境下允许文字换行 */\n.lang-en .function-btn .btn-text[data-v-216cae6e] {\n  white-space: normal;\n  word-break: break-word;\n  font-size: 0.8rem;\n}\n.function-btn .btn-desc[data-v-216cae6e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  line-height: 1.2;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* 英文环境下允许描述换行 */\n.lang-en .function-btn .btn-desc[data-v-216cae6e] {\n  white-space: normal;\n  word-break: break-word;\n  font-size: 0.65rem;\n}\n\n/* 按钮箭头 */\n.function-btn .btn-arrow[data-v-216cae6e] {\n  color: var(--color-text-muted);\n  transition: all 0.2s ease;\n  margin-left: 6px;\n  opacity: 0.5;\n}\n.function-btn:hover .btn-arrow[data-v-216cae6e] {\n  color: var(--color-primary);\n  transform: translateX(2px);\n  opacity: 1;\n}\n\n/* 无箭头按钮的右边距补偿 */\n.function-btn.no-arrow .btn-content[data-v-216cae6e] {\n  margin-right: 16px; /* 14px (箭头宽度) + 8px (margin-left) */\n}\n\n/* 分类颜色主题 */\n.function-btn.primary .btn-icon[data-v-216cae6e] {\n  background: rgba(59, 130, 246, 0.08);\n  color: rgb(59, 130, 246);\n}\n.function-btn.primary:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(59, 130, 246, 0.12);\n}\n.function-btn.secondary .btn-icon[data-v-216cae6e] {\n  background: rgba(16, 185, 129, 0.08);\n  color: rgb(16, 185, 129);\n}\n.function-btn.secondary:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(16, 185, 129, 0.12);\n}\n\n/* 修炼系统 - 金色 */\n.function-btn.cultivation .btn-icon[data-v-216cae6e] {\n  background: rgba(245, 158, 11, 0.08);\n  color: rgb(245, 158, 11);\n}\n.function-btn.cultivation:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(245, 158, 11, 0.12);\n}\n\n/* 任务探索 - 紫色 */\n.function-btn.quest .btn-icon[data-v-216cae6e] {\n  background: rgba(139, 92, 246, 0.08);\n  color: rgb(139, 92, 246);\n}\n.function-btn.quest:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(139, 92, 246, 0.12);\n}\n.function-btn.system .btn-icon[data-v-216cae6e] {\n  background: rgba(107, 114, 128, 0.08);\n  color: rgb(107, 114, 128);\n}\n.function-btn.system:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(107, 114, 128, 0.12);\n}\n\n/* 禁用状态样式 */\n.function-btn[data-v-216cae6e]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: var(--color-surface-light);\n}\n.function-btn[data-v-216cae6e]:disabled:hover {\n  background: var(--color-surface-light);\n  transform: none;\n  box-shadow: none;\n  border-color: var(--color-border);\n}\n.function-btn:disabled .btn-icon[data-v-216cae6e] {\n  background: var(--color-background);\n  border-color: var(--color-border);\n}\n.function-btn:disabled .btn-arrow[data-v-216cae6e] {\n  opacity: 0.3;\n  transform: none;\n}\n.function-btn.disabled[data-v-216cae6e] {\n  position: relative;\n  opacity: 0.6;\n}\n.disabled-text[data-v-216cae6e] {\n  font-style: italic;\n  opacity: 0.7;\n}\n\n/* 退出按钮特殊样式 */\n.exit-btn[data-v-216cae6e] {\n  border-color: rgba(239, 68, 68, 0.3);\n  background: rgba(239, 68, 68, 0.04);\n}\n.exit-btn[data-v-216cae6e]:hover {\n  background: rgba(239, 68, 68, 0.08);\n  border-color: rgba(239, 68, 68, 0.4);\n}\n.exit-btn .btn-text[data-v-216cae6e] {\n  color: var(--color-error);\n}\n.exit-btn .btn-desc[data-v-216cae6e] {\n  color: rgba(239, 68, 68, 0.6);\n}\n.exit-btn .btn-icon[data-v-216cae6e] {\n  background: rgba(239, 68, 68, 0.08);\n  color: var(--color-error);\n}\n.exit-btn:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(239, 68, 68, 0.12);\n}\n\n/* 管理员按钮样式 */\n.function-btn.admin .btn-icon[data-v-216cae6e] {\n  background: rgba(245, 158, 11, 0.08);\n  color: rgb(245, 158, 11);\n}\n.function-btn.admin:hover .btn-icon[data-v-216cae6e] {\n  background: rgba(245, 158, 11, 0.12);\n}\n.function-btn.admin .btn-text[data-v-216cae6e] {\n  color: rgb(245, 158, 11);\n}\n.function-btn.admin .btn-desc[data-v-216cae6e] {\n  color: rgba(245, 158, 11, 0.6);\n}\n\n/* 深色主题无需额外适配：已统一使用主题变量 */\n\n/* 响应式适配 */\n@media (max-width: 768px) {\n.left-sidebar[data-v-216cae6e] {\n    padding: 12px;\n}\n.function-section[data-v-216cae6e],\n  .system-section[data-v-216cae6e] {\n    padding: 8px;\n}\n.function-btn[data-v-216cae6e] {\n    padding: 10px 12px;\n}\n.function-btn .btn-icon[data-v-216cae6e] {\n    width: 32px;\n    height: 32px;\n}\n.function-btn .btn-text[data-v-216cae6e] {\n    font-size: 0.8rem;\n}\n.function-btn .btn-desc[data-v-216cae6e] {\n    font-size: 0.65rem;\n}\n}\n\n/* ========== iframe环境（酒馆端）样式 ========== */\n/* 不做特殊放大，使用与网页版相同的样式 */\n",""]);const s=i},5835:(e,n,t)=>{"use strict";t.d(n,{c3:()=>o});const a={觉醒:1,觉醒初期:1,觉醒中期:1,觉醒后期:1,觉醒圆满:1,觉醒极境:1,觉醒期:1,掌控:2,掌控初期:2,掌控中期:2,掌控后期:2,掌控圆满:2,掌控极境:2,掌控期:2,精通:3,精通初期:3,精通中期:3,精通后期:3,精通圆满:3,精通极境:3,精通期:3,质变:4,质变初期:4,质变中期:4,质变后期:4,质变圆满:4,质变极境:4,质变期:4,突破:5,突破初期:5,突破中期:5,突破后期:5,突破圆满:5,突破极境:5,突破期:5,传说:6,传说初期:6,传说中期:6,传说后期:6,传说圆满:6,半神:7,半神初期:7,半神中期:7,半神后期:7,半神圆满:7,神灾:8,神灾初期:8,神灾中期:8,神灾后期:8,练气:1,练气期:1,筑基:2,筑基期:2,金丹:3,金丹期:3,元婴:4,元婴期:4,化神:5,化神期:5,炼虚:6,炼虚期:6,合体:7,合体期:7,渡劫:8,渡劫期:8};function r(e){return e&&"string"==typeof e?a[e]?a[e]:e.includes("觉醒")?1:e.includes("掌控")?2:e.includes("精通")?3:e.includes("质变")?4:e.includes("突破")?5:e.includes("传说")?6:e.includes("半神")?7:e.includes("神灾")?8:e.includes("练气")?1:e.includes("筑基")?2:e.includes("金丹")?3:e.includes("元婴")?4:e.includes("化神")?5:e.includes("炼虚")?6:e.includes("合体")?7:e.includes("渡劫")?8:0:0}const o=e=>{return n=e,Array.isArray(n)?n.map(e=>{const n=function(e){if(!e)return e;e.name&&!e.名称&&(e.名称=e.name),e.type&&!e.类型&&(e.类型=e.type),e.description&&!e.描述&&(e.描述=e.description),e.leadership&&!e.领导层&&(e.领导层=e.leadership,delete e.leadership),void 0!==e.canJoin&&void 0===e.可否加入&&(e.可否加入=e.canJoin),e.joinRequirements&&!e.加入条件&&(e.加入条件=e.joinRequirements),e.benefits&&!e.加入好处&&(e.加入好处=e.benefits);const n=String(e.名称||e.name||"");if((n.includes("狂厄")||n.includes("合欢"))&&(e.领导层?e.领导层.副首领||(e.领导层.副首领="灾厄使者"):e.领导层={首领:"狂厄之主",首领觉醒阶段:e.最强觉醒阶段||"突破期",最强觉醒阶段:e.最强觉醒阶段||"突破期",副首领:"灾厄使者"}),e.memberCount&&!e.成员数量&&(e.成员数量={总数:e.memberCount.total,按阶段:e.memberCount.byStage||e.memberCount.byRealm,按职位:e.memberCount.byPosition},delete e.memberCount),e.成员数量){const n=e.成员数量;void 0!==n.total&&void 0===n.总数&&(n.总数=n.total),n.byStage&&!n.按阶段?n.按阶段=n.byStage:n.byRealm&&!n.按阶段&&(n.按阶段=n.byRealm),n.按觉醒阶段&&!n.按阶段&&(n.按阶段=n.按觉醒阶段,delete n.按觉醒阶段),n.byPosition&&!n.按职位&&(n.按职位=n.byPosition)}const t=e.领导层?.最强觉醒阶段||e.最强觉醒阶段||e.领导层?.最强修为||e.最强修为;e.领导层&&e.领导层.最强修为&&(e.领导层.最强觉醒阶段=e.领导层.最强修为,delete e.领导层.最强修为),e.最强修为&&(e.最强觉醒阶段=e.最强修为,delete e.最强修为);const a=r(t);if(console.log(`[势力验证] ${e.名称}: 最强阶段="${t}" → 等级=${a}`),console.log(`[势力验证] ${e.名称}: 原始阶段分布=`,e.成员数量?.按阶段),e.成员数量?.按阶段){const n=e.成员数量.按阶段;let t=0,a="";if(Object.keys(n).forEach(e=>{if(n[e]>0){const n=r(e);n>t&&(t=n,a=e)}}),t>0&&a){const n=a.includes("期")?a:`${a}圆满`;if(e.领导层){const a=e.领导层.最强觉醒阶段;e.领导层.最强觉醒阶段=n,console.log(`[势力验证] ${e.名称}: 根据阶段分布自动修正最强阶段: "${a}" → "${n}"`),r(e.领导层.首领觉醒阶段||e.领导层.宗主修为||"")<t&&(e.领导层.首领觉醒阶段=n,e.领导层.宗主修为&&delete e.领导层.宗主修为,console.log(`[势力验证] ${e.名称}: 同时更新首领阶段为: "${n}"`))}}console.log(`[势力验证] ${e.名称}: 阶段分布包含:`,Object.keys(n).filter(e=>n[e]>0))}if(console.log(`[势力验证] ${e.名称}: 验证后阶段分布=`,e.成员数量?.按阶段),e.领导层?.核心成员数量&&e.成员数量?.按阶段){const n=e.领导层.核心成员数量,t=e.成员数量.按阶段;let a=0;if(Object.keys(t).forEach(e=>{r(e)>=4&&(a+=t[e]||0)}),a>1.5*n){const e=1.2*n/a;Object.keys(t).forEach(n=>{if(r(n)>=4){const a=t[n];t[n]=Math.max(1,Math.round(a*e))}})}}return e.领导层?.长老数量&&(e.领导层.核心成员数量=e.领导层.长老数量,delete e.领导层.长老数量),e}(e),t=function(e){const n=[];if(!e)return n.push("势力数据为空"),{isValid:!1,errors:n};const t=e.领导层?.最强觉醒阶段||e.最强觉醒阶段,a=r(t);e.成员数量?.按阶段&&Object.keys(e.成员数量.按阶段).forEach(e=>{r(e)>a&&n.push(`阶段分布错误: 存在${e}觉醒者，但最强阶段仅为${t}`)});const o=e.领导层?.核心成员数量;if(o&&e.成员数量?.按阶段){let t=0;Object.keys(e.成员数量.按阶段).forEach(n=>{r(n)>=4&&(t+=e.成员数量.按阶段[n]||0)}),t>2*o&&n.push(`人员配置不合理: 核心成员${o}位，但质变期以上觉醒者${t}人`)}return{isValid:0===n.length,errors:n}}(n);return t.isValid||console.warn(`[势力验证] ${e.名称||"未知势力"}存在问题:`,t.errors),n}):n;var n}},5880:e=>{"use strict";e.exports=Math.pow},5976:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},6119:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.panel-header[data-v-759e00bb] {\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.panel-title[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n  font-size: 1.2rem;\n  color: var(--color-text);\n}\n.header-actions[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.search-bar[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.5rem;\n  min-width: 180px;\n  flex: 1 1 220px;\n}\n.search-input[data-v-759e00bb] {\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  flex: 1;\n}\n.format-guide-btn[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.5rem 1rem;\n  background: var(--color-accent);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.format-guide-btn[data-v-759e00bb]:hover {\n  background: var(--color-accent-hover);\n  transform: translateY(-1px);\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.panel-header[data-v-759e00bb] {\n    flex-direction: column;\n    gap: 0.5rem;\n    align-items: stretch;\n}\n.panel-title[data-v-759e00bb] {\n    font-size: 1.1rem;\n}\n.header-actions[data-v-759e00bb] {\n    justify-content: stretch;\n}\n.search-bar[data-v-759e00bb] {\n    min-width: 100%;\n    flex: 1;\n}\n}\n@media (max-width: 480px) {\n.panel-header[data-v-759e00bb] {\n    padding: 0.75rem;\n}\n.panel-title[data-v-759e00bb] {\n    font-size: 1rem;\n}\n.search-bar[data-v-759e00bb] {\n    padding: 0.4rem;\n}\n.search-input[data-v-759e00bb] {\n    font-size: 0.8rem;\n}\n}\n.header-buttons[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 0 0 auto;\n  white-space: nowrap;\n  min-width: fit-content;\n}\n.refresh-btn[data-v-759e00bb],\n.export-btn[data-v-759e00bb],\n.stats-btn[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.5rem 1rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.refresh-btn[data-v-759e00bb]:hover,\n.export-btn[data-v-759e00bb]:hover,\n.stats-btn[data-v-759e00bb]:hover {\n  background: var(--color-primary-hover);\n  transform: translateY(-1px);\n}\n.animate-spin[data-v-759e00bb] {\n  animation: spin-759e00bb 1s linear infinite;\n}\n@keyframes spin-759e00bb {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n@media (max-width: 560px) {\n.header-buttons .refresh-btn span[data-v-759e00bb],\n  .header-buttons .export-btn span[data-v-759e00bb],\n  .header-buttons .stats-btn span[data-v-759e00bb] {\n    display: none;\n}\n}\n",""]);const s=i},6188:e=>{"use strict";e.exports=Math.max},6193:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-panel[data-v-6986c140] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n}\n.panel-content[data-v-6986c140] {\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.sect-container[data-v-6986c140] {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  background: var(--color-surface);\n  overflow: hidden;\n}\n.sect-list[data-v-6986c140] {\n  width: 280px; /* 窄一点 */\n  border-right: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n}\n.list-header[data-v-6986c140] {\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.panel-title[data-v-6986c140] {\n  margin: 0 0 1rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-primary);\n  text-align: center;\n}\n.search-bar[data-v-6986c140] {\n  position: relative;\n  display: flex;\n  align-items: center;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 0.5rem;\n}\n.search-bar svg[data-v-6986c140] {\n  color: var(--color-text-secondary);\n  margin-right: 0.5rem;\n}\n.search-input[data-v-6986c140] {\n  flex: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.list-content[data-v-6986c140] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n.loading-state[data-v-6986c140], .empty-state[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-6986c140] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.empty-text[data-v-6986c140] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.empty-hint[data-v-6986c140] {\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.empty-actions[data-v-6986c140] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  flex-wrap: wrap;\n  justify-content: center;\n}\n.empty-action-btn[data-v-6986c140] {\n  padding: 0.4rem 0.75rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  font-size: 0.85rem;\n}\n.empty-action-btn[data-v-6986c140]:hover {\n  transform: translateY(-1px);\n  border-color: var(--color-primary);\n}\n.empty-action-btn.primary[data-v-6986c140] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: #fff;\n}\n.empty-action-btn.primary[data-v-6986c140]:hover {\n  filter: brightness(1.05);\n}\n.empty-prompt-hint[data-v-6986c140] {\n  margin-top: 0.75rem;\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.empty-prompt-hint code[data-v-6986c140] {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  padding: 0.1rem 0.35rem;\n  border-radius: 6px;\n  background: rgba(99, 102, 241, 0.12);\n  border: 1px solid rgba(99, 102, 241, 0.2);\n}\n.sect-list-content[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.sect-card[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  padding: 1rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.sect-card[data-v-6986c140]:hover {\n  border-color: #9333ea;\n  box-shadow: 0 2px 8px rgba(147, 51, 234, 0.1);\n  transform: translateY(-1px);\n}\n.sect-card.selected[data-v-6986c140] {\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(168, 85, 247, 0.1));\n  border-color: #9333ea;\n  box-shadow: 0 4px 12px rgba(147, 51, 234, 0.15);\n}\n.sect-card.can-join[data-v-6986c140] {\n  border-left: 3px solid #22c55e;\n}\n.sect-icon[data-v-6986c140] {\n  position: relative;\n  margin-right: 0.75rem;\n  flex-shrink: 0;\n}\n.sect-emoji[data-v-6986c140] {\n  font-size: 2rem;\n  display: block;\n}\n.sect-level[data-v-6986c140] {\n  position: absolute;\n  bottom: -2px;\n  right: -2px;\n  padding: 1px 4px;\n  border-radius: 8px;\n  font-size: 0.6rem;\n  font-weight: 700;\n  color: white;\n}\n.level-一流[data-v-6986c140] { background: #ef4444;\n}\n.level-二流[data-v-6986c140] { background: #f59e0b;\n}\n.level-三流[data-v-6986c140] { background: #3b82f6;\n}\n.level-末流[data-v-6986c140] { background: #6b7280;\n}\n.sect-info[data-v-6986c140] {\n  flex: 1;\n  min-width: 0;\n}\n.sect-name[data-v-6986c140] {\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.25rem;\n  font-size: 1rem;\n}\n.sect-meta[data-v-6986c140] {\n  margin-bottom: 0.5rem;\n}\n.sect-type[data-v-6986c140] {\n  background: rgba(147, 51, 234, 0.1);\n  color: #9333ea;\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.sect-stats[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.member-count[data-v-6986c140] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n  padding: 2px 6px;\n  border-radius: 3px;\n  font-weight: 500;\n}\n\\n/* .power-rating removed */\\n.arrow-icon[data-v-6986c140] {\n  color: var(--color-border-hover);\n  transition: transform 0.2s;\n}\n.sect-card.selected .arrow-icon[data-v-6986c140] {\n  transform: rotate(90deg);\n  color: #9333ea;\n}\n.sect-detail[data-v-6986c140] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n.detail-content[data-v-6986c140] {\n  height: 100%;\n  padding: 1rem;\n  overflow-y: auto;\n}\n.detail-header[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 2rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.detail-icon[data-v-6986c140] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #9333ea, #7c3aed);\n  flex-shrink: 0;\n  box-shadow: 0 4px 16px rgba(147, 51, 234, 0.3);\n}\n.sect-emoji-large[data-v-6986c140] {\n  font-size: 2rem;\n}\n.detail-info[data-v-6986c140] {\n  flex: 1;\n}\n.detail-name[data-v-6986c140] {\n  margin: 0 0 0.5rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.detail-badges[data-v-6986c140] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.detail-actions[data-v-6986c140] {\n  margin-top: 0.75rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.danger-btn[data-v-6986c140] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.45rem 0.6rem;\n  border-radius: 8px;\n  border: 1px solid rgba(239, 68, 68, 0.35);\n  background: rgba(239, 68, 68, 0.06);\n  color: #ef4444;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.danger-btn[data-v-6986c140]:hover {\n  border-color: rgba(239, 68, 68, 0.55);\n  background: rgba(239, 68, 68, 0.1);\n}\n.danger-btn[data-v-6986c140]:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.type-badge[data-v-6986c140], .level-badge[data-v-6986c140] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.type-badge.type-righteous[data-v-6986c140] { background: rgba(59, 130, 246, 0.1); color: #3b82f6;\n}\n.type-badge.type-demonic[data-v-6986c140] { background: rgba(239, 68, 68, 0.1); color: #ef4444;\n}\n.type-badge.type-neutral[data-v-6986c140] { background: rgba(107, 114, 128, 0.1); color: #6b7280;\n}\n.type-badge.type-merchant[data-v-6986c140] { background: rgba(245, 158, 11, 0.1); color: #f59e0b;\n}\n.type-badge.type-family[data-v-6986c140] { background: rgba(34, 197, 94, 0.1); color: #22c55e;\n}\n.type-badge.type-alliance[data-v-6986c140] { background: rgba(168, 85, 247, 0.1); color: #a855f7;\n}\n.level-badge[data-v-6986c140] { background: rgba(168, 85, 247, 0.1); color: #a855f7;\n}\n.detail-body[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.detail-section[data-v-6986c140] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.section-title[data-v-6986c140] {\n  margin: 0 0 1rem 0;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;            /* 图标与标题同一行 */\n  align-items: center;      /* 垂直居中对齐 */\n  gap: 8px;                 /* 图标与文字间距 */\n}\n.section-title svg[data-v-6986c140] {\n  flex-shrink: 0;           /* 防止图标被压缩换行 */\n}\n.info-grid[data-v-6986c140] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n  margin-bottom: 1rem;\n}\n.info-item[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.info-label[data-v-6986c140] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.sect-description[data-v-6986c140] {\n  margin-top: 1rem;\n}\n.desc-title[data-v-6986c140] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.desc-text[data-v-6986c140] {\n  margin: 0;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n}\n.sect-specialties[data-v-6986c140] {\n  margin-top: 1rem;\n}\n.specialties-title[data-v-6986c140] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.specialties-tags[data-v-6986c140] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.specialty-tag[data-v-6986c140] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(147, 51, 234, 0.1));\n  color: #9333ea;\n  padding: 0.25rem 0.75rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(147, 51, 234, 0.2);\n}\n.member-overview[data-v-6986c140] {\n  text-align: center;\n  margin-bottom: 1.5rem;\n}\n.total-members[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.25rem;\n}\n.total-number[data-v-6986c140] {\n  font-size: 2rem;\n  font-weight: 700;\n  color: #9333ea;\n}\n.total-label[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.member-breakdown[data-v-6986c140] {\n  margin-bottom: 1.5rem;\n}\n.breakdown-title[data-v-6986c140] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.realm-stats[data-v-6986c140], .position-stats[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.realm-stat[data-v-6986c140], .position-stat[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.realm-name[data-v-6986c140], .position-name[data-v-6986c140] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  min-width: 60px;\n}\n.realm-bar[data-v-6986c140], .position-bar[data-v-6986c140] {\n  flex: 1;\n  height: 6px;\n  background: var(--color-border);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.realm-fill[data-v-6986c140] {\n  height: 100%;\n  background: linear-gradient(90deg, #9333ea, #7c3aed);\n  transition: width 0.3s ease;\n}\n.position-fill[data-v-6986c140] {\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6, #1d4ed8);\n  transition: width 0.3s ease;\n}\n.realm-count[data-v-6986c140], .position-count[data-v-6986c140] {\n  font-size: 0.8rem;\n  font-weight: 600;\n  color: var(--color-text);\n  min-width: 30px;\n  text-align: right;\n}\n.relationship-info[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.relationship-item[data-v-6986c140] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.relationship-label[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.relationship-value[data-v-6986c140] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.reputation-value[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.reputation-level[data-v-6986c140] {\n  font-size: 0.75rem;\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.reputation-legendary[data-v-6986c140] {\n  color: #f59e0b;\n}\n.reputation-legendary .reputation-level[data-v-6986c140] {\n  background: rgba(245, 158, 11, 0.1);\n  color: #f59e0b;\n  border: 1px solid rgba(245, 158, 11, 0.2);\n}\n.reputation-excellent[data-v-6986c140] {\n  color: #8b5cf6;\n}\n.reputation-excellent .reputation-level[data-v-6986c140] {\n  background: rgba(139, 92, 246, 0.1);\n  color: #8b5cf6;\n  border: 1px solid rgba(139, 92, 246, 0.2);\n}\n.reputation-good[data-v-6986c140] {\n  color: #3b82f6;\n}\n.reputation-good .reputation-level[data-v-6986c140] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.reputation-fair[data-v-6986c140] {\n  color: #22c55e;\n}\n.reputation-fair .reputation-level[data-v-6986c140] {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n  border: 1px solid rgba(34, 197, 94, 0.2);\n}\n.reputation-low[data-v-6986c140] {\n  color: #6b7280;\n}\n.reputation-low .reputation-level[data-v-6986c140] {\n  background: rgba(107, 114, 128, 0.1);\n  color: #6b7280;\n  border: 1px solid rgba(107, 114, 128, 0.2);\n}\n.reputation-none[data-v-6986c140] {\n  color: var(--color-text-secondary);\n}\n.reputation-none .reputation-level[data-v-6986c140] {\n  background: rgba(var(--color-text-secondary-rgb), 0.1);\n  color: var(--color-text-secondary);\n  border: 1px solid rgba(var(--color-text-secondary-rgb), 0.2);\n}\n.join-requirements[data-v-6986c140] {\n  margin-bottom: 1rem;\n}\n.requirements-list[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.requirement-item[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.requirement-icon[data-v-6986c140] {\n  color: #22c55e;\n}\n.requirement-text[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.no-requirements[data-v-6986c140] {\n  text-align: center;\n  padding: 1rem;\n  color: var(--color-text-secondary);\n}\n.join-benefits[data-v-6986c140] {\n  margin-bottom: 1rem;\n}\n.benefits-title[data-v-6986c140] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.benefits-list[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.benefit-item[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.benefit-icon[data-v-6986c140] {\n  color: #3b82f6;\n}\n.benefit-text[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.join-actions[data-v-6986c140] {\n  text-align: center;\n}\n.join-btn[data-v-6986c140] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  border: none;\n  border-radius: 8px;\n  color: white;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.join-btn[data-v-6986c140]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);\n}\n.current-member-info[data-v-6986c140] {\n  margin-bottom: 1.5rem;\n}\n.member-status[data-v-6986c140] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.member-actions[data-v-6986c140] {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 0.75rem;\n}\n.leave-btn[data-v-6986c140] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: linear-gradient(135deg, #ef4444, #dc2626);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.leave-btn[data-v-6986c140]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);\n}\n.status-item[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.status-label[data-v-6986c140] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.status-value[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.status-value.position[data-v-6986c140] {\n  color: #9333ea;\n}\n.status-value.contribution[data-v-6986c140] {\n  color: #f59e0b;\n}\n.status-value.reputation[data-v-6986c140] {\n  color: #3b82f6;\n}\n.sect-actions[data-v-6986c140] {\n  margin-top: 1rem;\n}\n.actions-title[data-v-6986c140] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.action-buttons[data-v-6986c140] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.5rem;\n}\n.sect-action-btn[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.75rem 0.5rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: center;\n  min-width: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.sect-action-btn[data-v-6986c140]:hover {\n  border-color: #9333ea;\n  background: rgba(147, 51, 234, 0.05);\n}\n.no-selection[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.placeholder-icon[data-v-6986c140] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.placeholder-text[data-v-6986c140] {\n  font-size: 1rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.placeholder-hint[data-v-6986c140] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n\n/* 势力范围相关样式 */\n.territory-info[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* 成员统计样式 */\n.member-stats[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.total-members[data-v-6986c140] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n}\n.total-label[data-v-6986c140] {\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.total-value[data-v-6986c140] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n}\n.distribution-title[data-v-6986c140] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.realm-stats[data-v-6986c140], .position-stats[data-v-6986c140] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));\n  gap: 0.5rem;\n  max-height: none; /* 允许完整显示 */\n}\n.realm-item[data-v-6986c140], .position-item[data-v-6986c140] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.realm-item[data-v-6986c140]:hover, .position-item[data-v-6986c140]:hover {\n  background: var(--color-surface);\n  border-color: rgba(var(--color-primary-rgb), 0.2);\n}\n.realm-name[data-v-6986c140], .position-name[data-v-6986c140] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.realm-count[data-v-6986c140], .position-count[data-v-6986c140] {\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n\n/* 宗门领导层样式 */\n.leadership-info[data-v-6986c140] {\n  margin-top: 1.5rem;\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n}\n.leadership-title[data-v-6986c140] {\n  margin: 0 0 1rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.leader-grid[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-bottom: 1rem;\n}\n.leader-item[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.leader-item.primary-leader[data-v-6986c140] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.leader-role[data-v-6986c140] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  min-width: 3rem;\n  text-align: center;\n}\n.leader-name[data-v-6986c140] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.leader-realm[data-v-6986c140] {\n  font-size: 0.75rem;\n  color: var(--color-accent);\n  background: rgba(var(--color-accent-rgb), 0.1);\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n  margin-left: auto;\n}\n.sect-strength[data-v-6986c140] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: rgba(var(--color-success-rgb), 0.05);\n  border-radius: 6px;\n  border: 1px solid rgba(var(--color-success-rgb), 0.1);\n}\n.strength-item[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.25rem;\n}\n.strength-label[data-v-6986c140] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.strength-value[data-v-6986c140] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.strength-value.peak-power[data-v-6986c140] {\n  color: var(--color-accent);\n  text-shadow: 0 0 4px rgba(var(--color-accent-rgb), 0.3);\n}\n.strength-value.power-rating[data-v-6986c140] {\n  color: var(--color-primary);\n  font-weight: 700;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.power-level[data-v-6986c140] {\n  font-size: 0.75rem;\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.power-legendary[data-v-6986c140] {\n  color: #dc2626 !important;\n  border-color: rgba(220, 38, 38, 0.3) !important;\n  background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(239, 68, 68, 0.05)) !important;\n}\n.power-legendary .power-level[data-v-6986c140] {\n  background: rgba(220, 38, 38, 0.1);\n  color: #dc2626;\n  border: 1px solid rgba(220, 38, 38, 0.2);\n}\n.power-supreme[data-v-6986c140] {\n  color: #7c3aed !important;\n  border-color: rgba(124, 58, 237, 0.3) !important;\n  background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(139, 92, 246, 0.05)) !important;\n}\n.power-supreme .power-level[data-v-6986c140] {\n  background: rgba(124, 58, 237, 0.1);\n  color: #7c3aed;\n  border: 1px solid rgba(124, 58, 237, 0.2);\n}\n.power-strong[data-v-6986c140] {\n  color: #2563eb !important;\n  border-color: rgba(37, 99, 235, 0.3) !important;\n  background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.05)) !important;\n}\n.power-strong .power-level[data-v-6986c140] {\n  background: rgba(37, 99, 235, 0.1);\n  color: #2563eb;\n  border: 1px solid rgba(37, 99, 235, 0.2);\n}\n.power-good[data-v-6986c140] {\n  color: #059669 !important;\n  border-color: rgba(5, 150, 105, 0.3) !important;\n  background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.05)) !important;\n}\n.power-good .power-level[data-v-6986c140] {\n  background: rgba(5, 150, 105, 0.1);\n  color: #059669;\n  border: 1px solid rgba(5, 150, 105, 0.2);\n}\n.power-average[data-v-6986c140] {\n  color: #d97706 !important;\n  border-color: rgba(217, 119, 6, 0.3) !important;\n  background: linear-gradient(135deg, rgba(217, 119, 6, 0.1), rgba(245, 158, 11, 0.05)) !important;\n}\n.power-average .power-level[data-v-6986c140] {\n  background: rgba(217, 119, 6, 0.1);\n  color: #d97706;\n  border: 1px solid rgba(217, 119, 6, 0.2);\n}\n.power-weak[data-v-6986c140] {\n  color: #6b7280 !important;\n  border-color: rgba(107, 114, 128, 0.3) !important;\n  background: linear-gradient(135deg, rgba(107, 114, 128, 0.1), rgba(156, 163, 175, 0.05)) !important;\n}\n.power-weak .power-level[data-v-6986c140] {\n  background: rgba(107, 114, 128, 0.1);\n  color: #6b7280;\n  border: 1px solid rgba(107, 114, 128, 0.2);\n}\n.power-poor[data-v-6986c140] {\n  color: var(--color-text-secondary) !important;\n  border-color: rgba(var(--color-text-secondary-rgb), 0.3) !important;\n  background: linear-gradient(135deg, rgba(var(--color-text-secondary-rgb), 0.1), rgba(var(--color-text-secondary-rgb), 0.05)) !important;\n}\n.power-poor .power-level[data-v-6986c140] {\n  background: rgba(var(--color-text-secondary-rgb), 0.1);\n  color: var(--color-text-secondary);\n  border: 1px solid rgba(var(--color-text-secondary-rgb), 0.2);\n}\n.influence-description[data-v-6986c140] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  line-height: 1.5;\n}\n.controlled-areas[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.areas-list[data-v-6986c140] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.area-tag[data-v-6986c140] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));\n  color: #3b82f6;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.strategic-value[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.value-display[data-v-6986c140] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.value-bar[data-v-6986c140] {\n  flex: 1;\n  height: 8px;\n  background: var(--color-border);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.value-fill[data-v-6986c140] {\n  height: 100%;\n  background: linear-gradient(90deg, #22c55e, #16a34a);\n  transition: width 0.3s ease;\n}\n.value-text[data-v-6986c140] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n  min-width: 40px;\n}\n\n/* 回退显示样式 */\n.fallback-leadership[data-v-6986c140] {\n  padding: 1rem;\n  background: rgba(var(--color-warning-rgb), 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.1);\n}\n.leadership-description[data-v-6986c140] {\n  margin: 0 0 1rem 0;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n}\n\n/* 数据缺失提示样式 */\n.missing-data-notice[data-v-6986c140] {\n  background: rgba(var(--color-warning-rgb), 0.05);\n  border: 1px solid rgba(var(--color-warning-rgb), 0.2);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-top: 1rem;\n}\n.notice-title[data-v-6986c140] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-warning);\n}\n.notice-content[data-v-6986c140] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.notice-text[data-v-6986c140] {\n  margin: 0;\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.notice-hint[data-v-6986c140] {\n  margin: 0;\n  font-size: 0.8rem;\n  color: var(--color-text-tertiary);\n  opacity: 0.8;\n}\n.animate-spin[data-v-6986c140] {\n  animation: spin-6986c140 1s linear infinite;\n}\n@keyframes spin-6986c140 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n@media (max-width: 640px) {\n.sect-panel[data-v-6986c140] {\n    padding: 0;\n}\n.panel-content[data-v-6986c140] {\n    padding: 0;\n}\n.sect-container[data-v-6986c140] {\n    flex-direction: column;\n    border-radius: 0;\n    border: none;\n}\n.sect-list[data-v-6986c140] {\n    width: 100%;\n    height: 30vh;\n    min-height: 250px;\n    max-height: 350px;\n    border-right: none;\n    border-bottom: 1px solid var(--color-border);\n}\n.list-header[data-v-6986c140] {\n    padding: 1rem;\n    position: sticky;\n    top: 0;\n    z-index: 100;\n    background: var(--color-surface);\n}\n.panel-title[data-v-6986c140] {\n    font-size: 1.1rem;\n    margin-bottom: 0.75rem;\n}\n.search-bar[data-v-6986c140] {\n    padding: 0.5rem;\n}\n.search-input[data-v-6986c140] {\n    font-size: 0.9rem;\n}\n.list-content[data-v-6986c140] {\n    padding: 0.5rem;\n}\n.sect-card[data-v-6986c140] {\n    padding: 0.75rem;\n    margin-bottom: 0.5rem;\n}\n.sect-name[data-v-6986c140] {\n    font-size: 0.95rem;\n}\n.sect-type[data-v-6986c140] {\n    font-size: 0.7rem;\n    padding: 1px 6px;\n}\n\n  /* .power-rating removed */\n.sect-detail[data-v-6986c140] {\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n}\n.detail-content[data-v-6986c140] {\n    padding: 0.75rem;\n    height: auto;\n}\n.detail-header[data-v-6986c140] {\n    margin-bottom: 1rem;\n    padding-bottom: 0.5rem;\n}\n.detail-icon[data-v-6986c140] {\n    width: 40px;\n    height: 40px;\n}\n.sect-emoji-large[data-v-6986c140] {\n    font-size: 1.25rem;\n}\n.detail-name[data-v-6986c140] {\n    font-size: 1rem;\n}\n.info-grid[data-v-6986c140] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.member-status[data-v-6986c140] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.action-buttons[data-v-6986c140] {\n    grid-template-columns: repeat(2, 1fr);\n    gap: 0.4rem;\n}\n.sect-action-btn[data-v-6986c140] {\n    padding: 0.6rem 0.4rem;\n    font-size: 0.75rem;\n    justify-content: center;\n    white-space: normal; /* 允许文本换行 */\n    height: 100%; /* 确保按钮在换行后高度一致 */\n}\n.detail-section[data-v-6986c140] {\n    padding: 0.6rem;\n    margin-bottom: 0.75rem;\n}\n.section-title[data-v-6986c140] {\n    font-size: 0.8rem;\n    margin-bottom: 0.5rem;\n    padding-bottom: 0.4rem;\n}\n.realm-stats[data-v-6986c140], .position-stats[data-v-6986c140] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.leader-grid[data-v-6986c140] {\n    gap: 0.5rem;\n}\n.leader-item[data-v-6986c140] {\n    padding: 0.5rem;\n}\n.leader-role[data-v-6986c140] {\n    font-size: 0.7rem;\n    padding: 0.2rem 0.4rem;\n    min-width: 2.5rem;\n}\n.leader-name[data-v-6986c140] {\n    font-size: 0.8rem;\n}\n.leader-realm[data-v-6986c140] {\n    font-size: 0.7rem;\n}\n}\n",""]);const s=i},6260:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n/* 核心容器 - 采用玻璃拟态设计 */\n.body-stats-panel[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  animation: fade-in-1bbcf5ca 0.3s ease;\n}\n@keyframes fade-in-1bbcf5ca {\nfrom { opacity: 0; transform: translateY(10px);\n}\nto { opacity: 1; transform: translateY(0);\n}\n}\n\n/* 隐私提示 */\n.privacy-notice[data-v-1bbcf5ca] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  padding: 0.7rem 1rem;\n  background: rgba(var(--color-primary-rgb), 0.08);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.25);\n  border-radius: 12px;\n  color: var(--color-primary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  backdrop-filter: blur(8px);\n}\n\n/* 空状态 */\n.empty-stats[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 2rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n  background: rgba(0, 0, 0, 0.12);\n  border-radius: 16px;\n  border: 1px dashed rgba(255, 255, 255, 0.08);\n}\n.empty-icon[data-v-1bbcf5ca] {\n  margin-bottom: 1rem;\n  opacity: 0.5;\n}\n.sub-text[data-v-1bbcf5ca] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n  margin-top: 0.4rem;\n}\n\n/* 统计容器 */\n.stats-container[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n/* 统计区块 - 玻璃拟态卡片 */\n.stat-section[data-v-1bbcf5ca] {\n  background: rgba(255, 255, 255, 0.03);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 16px;\n  padding: 1.2rem;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  transition: transform 0.2s, box-shadow 0.2s;\n}\n.stat-section[data-v-1bbcf5ca]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.15);\n}\n\n/* 寿元特殊样式 */\n.lifespan-section[data-v-1bbcf5ca] {\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.1) 0%, rgba(56, 189, 248, 0.05) 100%);\n  border-color: rgba(34, 211, 238, 0.25);\n}\n\n/* 区块标题 */\n.section-title[data-v-1bbcf5ca] {\n  display: flex;\n  align-items: center;\n  gap: 0.7rem;\n  font-size: 1.05rem;\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 1rem;\n  padding-bottom: 0.7rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n.title-icon[data-v-1bbcf5ca] {\n  padding: 6px;\n  border-radius: 8px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n}\n\n/* 空提示 */\n.empty-hint[data-v-1bbcf5ca] {\n  padding: 1rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n  border: 1px dashed rgba(255, 255, 255, 0.06);\n}\n\n/* 寿元显示 */\n.lifespan-display[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.8rem;\n}\n.lifespan-info[data-v-1bbcf5ca] {\n  display: flex;\n  align-items: baseline;\n  gap: 0.4rem;\n  font-family: 'Consolas', 'Monaco', monospace;\n}\n.lifespan-current[data-v-1bbcf5ca] {\n  font-size: 1.8rem;\n  font-weight: 800;\n  color: #22d3ee;\n  text-shadow: 0 0 10px rgba(34, 211, 238, 0.3);\n}\n.lifespan-divider[data-v-1bbcf5ca] {\n  color: var(--color-text-secondary);\n  font-size: 1rem;\n  opacity: 0.6;\n}\n.lifespan-max[data-v-1bbcf5ca] {\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.lifespan-unit[data-v-1bbcf5ca] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-left: 0.3rem;\n}\n.lifespan-bar[data-v-1bbcf5ca] {\n  height: 10px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 5px;\n  overflow: hidden;\n  position: relative;\n}\n.lifespan-fill[data-v-1bbcf5ca] {\n  height: 100%;\n  background: linear-gradient(90deg, #22d3ee, #38bdf8);\n  border-radius: 5px;\n  transition: width 0.5s ease;\n  box-shadow: 0 0 10px rgba(34, 211, 238, 0.4);\n}\n.lifespan-fill.warning[data-v-1bbcf5ca] {\n  background: linear-gradient(90deg, #fbbf24, #f59e0b);\n  box-shadow: 0 0 10px rgba(251, 191, 36, 0.4);\n}\n.lifespan-fill.danger[data-v-1bbcf5ca] {\n  background: linear-gradient(90deg, #f87171, #ef4444);\n  box-shadow: 0 0 10px rgba(248, 113, 113, 0.4);\n}\n.lifespan-hint[data-v-1bbcf5ca] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  text-align: right;\n  opacity: 0.8;\n}\n\n/* 数据网格 */\n.stats-grid[data-v-1bbcf5ca] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n  gap: 0.8rem;\n  margin-bottom: 1rem;\n}\n.stat-card[data-v-1bbcf5ca] {\n  background: rgba(0, 0, 0, 0.15);\n  padding: 1rem;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.4rem;\n  transition: all 0.2s;\n}\n.stat-card[data-v-1bbcf5ca]:hover {\n  background: rgba(0, 0, 0, 0.2);\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.label[data-v-1bbcf5ca] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.value[data-v-1bbcf5ca] {\n  font-size: 1.3rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.unit[data-v-1bbcf5ca] {\n  font-size: 0.75rem;\n  font-weight: normal;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n}\n\n/* 标签容器 */\n.tags-container[data-v-1bbcf5ca] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.6rem;\n  margin-top: 0.5rem;\n}\n.feature-tag[data-v-1bbcf5ca] {\n  padding: 0.4rem 0.8rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 999px;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  transition: all 0.2s;\n}\n.feature-tag[data-v-1bbcf5ca]:hover {\n  background: rgba(var(--color-primary-rgb), 0.15);\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n\n/* 三围显示 */\n.measurements-display[data-v-1bbcf5ca] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 1.5rem;\n  margin-bottom: 1rem;\n  padding: 1.5rem;\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n}\n.measurement-item[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.measure-circle[data-v-1bbcf5ca] {\n  width: 70px;\n  height: 70px;\n  border-radius: 50%;\n  border: 2px solid var(--color-accent);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: rgba(var(--color-accent-rgb), 0.08);\n  box-shadow: 0 0 15px rgba(var(--color-accent-rgb), 0.2);\n  transition: all 0.3s;\n}\n.measure-circle[data-v-1bbcf5ca]:hover {\n  transform: scale(1.05);\n  box-shadow: 0 0 20px rgba(var(--color-accent-rgb), 0.3);\n}\n.measure-val[data-v-1bbcf5ca] {\n  font-size: 1.2rem;\n  font-weight: 800;\n  color: var(--color-accent);\n}\n.measure-label[data-v-1bbcf5ca] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.2rem;\n}\n.measurement-divider[data-v-1bbcf5ca] {\n  font-size: 1.5rem;\n  color: rgba(255, 255, 255, 0.2);\n  font-weight: 300;\n}\n.cup-display[data-v-1bbcf5ca] {\n  text-align: center;\n  font-size: 1rem;\n  color: var(--color-text);\n  padding: 0.6rem;\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n}\n.cup-label[data-v-1bbcf5ca] {\n  color: var(--color-text-secondary);\n  margin-right: 0.5rem;\n}\n.cup-value[data-v-1bbcf5ca] {\n  font-weight: 800;\n  color: var(--color-accent);\n}\n\n/* 描述列表 */\n.description-list[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.desc-item[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.desc-label[data-v-1bbcf5ca] {\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  padding-left: 0.3rem;\n}\n.desc-content[data-v-1bbcf5ca] {\n  margin: 0;\n  padding: 1rem;\n  background: rgba(0, 0, 0, 0.15);\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  font-size: 0.9rem;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n\n/* 敏感点 */\n.sensitive-points[data-v-1bbcf5ca] {\n  margin-bottom: 1rem;\n}\n.sub-title[data-v-1bbcf5ca] {\n  display: block;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.7rem;\n}\n.points-list[data-v-1bbcf5ca] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.6rem;\n}\n.point-tag[data-v-1bbcf5ca] {\n  padding: 0.4rem 0.8rem;\n  background: rgba(239, 68, 68, 0.1);\n  color: #f87171;\n  border: 1px solid rgba(239, 68, 68, 0.25);\n  border-radius: 999px;\n  font-size: 0.85rem;\n  transition: all 0.2s;\n}\n.point-tag[data-v-1bbcf5ca]:hover {\n  background: rgba(239, 68, 68, 0.15);\n  border-color: rgba(239, 68, 68, 0.35);\n}\n\n/* 开发度列表 */\n.development-list[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.dev-item[data-v-1bbcf5ca] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.dev-header[data-v-1bbcf5ca] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.85rem;\n  color: var(--color-text);\n}\n.dev-name[data-v-1bbcf5ca] {\n  font-weight: 600;\n}\n.dev-val[data-v-1bbcf5ca] {\n  font-weight: 700;\n  color: #ec4899;\n}\n.dev-bar[data-v-1bbcf5ca] {\n  height: 8px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.dev-fill[data-v-1bbcf5ca] {\n  height: 100%;\n  background: linear-gradient(90deg, #f472b6, #ec4899);\n  border-radius: 4px;\n  transition: width 0.3s ease;\n  box-shadow: 0 0 8px rgba(236, 72, 153, 0.3);\n}\n\n/* 纹身列表 */\n.markings-list[data-v-1bbcf5ca] {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.marking-item[data-v-1bbcf5ca] {\n  padding: 0.6rem 0.8rem;\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n  border-left: 3px solid var(--color-accent);\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n\n/* 响应式 */\n@media (max-width: 480px) {\n.measurements-display[data-v-1bbcf5ca] {\n    gap: 1rem;\n    padding: 1rem;\n}\n.measure-circle[data-v-1bbcf5ca] {\n    width: 60px;\n    height: 60px;\n}\n.measure-val[data-v-1bbcf5ca] {\n    font-size: 1rem;\n}\n.stats-grid[data-v-1bbcf5ca] {\n    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\n}\n}\n",""]);const s=i},6262:(e,n)=>{"use strict";n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},6314:e=>{"use strict";e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",a=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),a&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),a&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,a,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&i[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),n.push(d))}},n}},6347:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* 命令日志弹窗样式 */\n.command-log-overlay[data-v-6724586e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.command-log-modal[data-v-6724586e] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 500px;\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n}\n\n/* 弹窗动画 */\n.command-log-modal-enter-active[data-v-6724586e],\n.command-log-modal-leave-active[data-v-6724586e] {\n  transition: all 0.3s ease;\n}\n.command-log-modal-enter-from[data-v-6724586e],\n.command-log-modal-leave-to[data-v-6724586e] {\n  opacity: 0;\n  transform: scale(0.9) translateY(20px);\n}\n.command-log-header[data-v-6724586e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  background: linear-gradient(135deg, var(--color-surface-light) 0%, var(--color-surface-hover) 100%);\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.command-log-header h3[data-v-6724586e] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-log-btn[data-v-6724586e] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 50%;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-log-btn[data-v-6724586e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  transform: rotate(90deg);\n}\n.command-log-content[data-v-6724586e] {\n  padding: 16px;\n  overflow-y: auto;\n  flex: 1;\n}\n.command-list[data-v-6724586e] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.command-item[data-v-6724586e] {\n  display: flex;\n  gap: 12px;\n  padding: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.command-item[data-v-6724586e]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border-color: var(--color-primary);\n}\n.command-icon-wrapper[data-v-6724586e] {\n  width: 40px;\n  height: 40px;\n  flex-shrink: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  background: var(--color-primary-light);\n  color: var(--color-primary);\n}\n.command-details[data-v-6724586e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.command-description[data-v-6724586e] {\n  margin: 0;\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text);\n  line-height: 1.4;\n}\n.command-values[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.85rem;\n  font-family: var(--font-family-mono);\n}\n.old-value[data-v-6724586e], .new-value[data-v-6724586e] {\n  padding: 4px 8px;\n  border-radius: 4px;\n}\n.old-value[data-v-6724586e] {\n  background: rgba(var(--color-error-rgb), 0.1);\n  color: var(--color-danger);\n  text-decoration: line-through;\n}\n.new-value[data-v-6724586e] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  color: var(--color-success);\n  font-weight: 600;\n}\n.arrow[data-v-6724586e] {\n  color: var(--color-text-secondary);\n  font-weight: 600;\n}\n.no-commands[data-v-6724586e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.no-commands .empty-icon[data-v-6724586e] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.no-commands .empty-text[data-v-6724586e] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  color: var(--color-text);\n  font-size: 1rem;\n}\n.no-commands .empty-hint[data-v-6724586e] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .command-log-modal[data-v-6724586e] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme="dark"] .command-log-header[data-v-6724586e] {\n  background: linear-gradient(135deg, #334155 0%, #1e293b 100%);\n  border-color: #475569;\n}\n[data-theme="dark"] .command-item[data-v-6724586e] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme="dark"] .command-item[data-v-6724586e]:hover {\n  border-color: var(--color-primary);\n}\n[data-theme="dark"] .command-icon-wrapper[data-v-6724586e] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n}\n[data-theme="dark"] .old-value[data-v-6724586e] {\n  background: rgba(var(--color-error-rgb), 0.2);\n}\n[data-theme="dark"] .new-value[data-v-6724586e] {\n  background: rgba(var(--color-success-rgb), 0.2);\n}\n.main-game-panel[data-v-6724586e] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n  box-sizing: border-box;\n}\n\n/* 短期记忆区域 */\n.memory-section[data-v-6724586e] {\n  padding: 12px 20px;\n  background: linear-gradient(135deg, #fefbff 0%, #f8fafc 100%);\n  border-bottom: 1px solid #e2e8f0;\n  position: relative;\n  z-index: 20;\n  flex-shrink: 0;\n}\n.memory-header[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  cursor: pointer;\n  padding: 4px 0;\n  transition: all 0.2s ease;\n}\n.memory-header[data-v-6724586e]:hover {\n  background: rgba(99, 102, 241, 0.05);\n  border-radius: 6px;\n  margin: -4px;\n  padding: 8px 4px;\n}\n.memory-title[data-v-6724586e] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #6366f1;\n}\n.memory-icon[data-v-6724586e] {\n  color: #94a3b8;\n  transition: transform 0.2s ease;\n}\n\n/* 下拉悬浮效果 */\n.memory-dropdown[data-v-6724586e] {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  background: var(--color-surface);\n  border: 1px solid #e2e8f0;\n  border-top: none;\n  border-radius: 0 0 12px 12px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n  z-index: 19;\n  max-height: 300px;\n  overflow-y: auto;\n}\n.memory-content[data-v-6724586e] {\n  padding: 16px 20px;\n}\n.memory-item[data-v-6724586e] {\n  font-size: 0.85rem;\n  color: #374151;\n  margin-bottom: 12px;\n  padding: 12px 16px;\n  background: rgba(99, 102, 241, 0.05);\n  border-radius: 8px;\n  border-left: 3px solid #6366f1;\n  line-height: 1.5;\n}\n.memory-item[data-v-6724586e]:last-child {\n  margin-bottom: 0;\n}\n.no-memory[data-v-6724586e] {\n  font-size: 0.9rem;\n  color: #9ca3af;\n  font-style: italic;\n  text-align: center;\n  padding: 20px;\n}\n\n/* 下拉动画 */\n.memory-dropdown-enter-active[data-v-6724586e],\n.memory-dropdown-leave-active[data-v-6724586e] {\n  transition: all 0.3s ease;\n}\n.memory-dropdown-enter-from[data-v-6724586e] {\n  opacity: 0;\n  transform: translateY(-10px);\n}\n.memory-dropdown-leave-to[data-v-6724586e] {\n  opacity: 0;\n  transform: translateY(-10px);\n}\n\n/* 思维链区域样式 */\n.thinking-section[data-v-6724586e] {\n  margin: 12px 16px;\n  background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%);\n  border: 1px solid #fcd34d;\n  border-radius: 10px;\n  overflow: hidden;\n  flex-shrink: 0; /* 防止被挤压 */\n  min-width: 0; /* 允许内容收缩但不被完全挤压 */\n}\n.thinking-header[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 14px;\n  cursor: pointer;\n  transition: background 0.2s ease;\n}\n.thinking-header[data-v-6724586e]:hover {\n  background: rgba(251, 191, 36, 0.15);\n}\n.thinking-icon[data-v-6724586e] {\n  color: #d97706;\n  flex-shrink: 0;\n}\n.thinking-title[data-v-6724586e] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #92400e;\n  flex: 1;\n}\n.thinking-badge[data-v-6724586e] {\n  font-size: 0.75rem;\n  padding: 2px 8px;\n  border-radius: 10px;\n}\n.thinking-badge.streaming[data-v-6724586e] {\n  color: #b45309;\n  background: rgba(251, 191, 36, 0.3);\n  animation: pulse-6724586e 1.5s ease-in-out infinite;\n}\n.thinking-badge.completed[data-v-6724586e] {\n  color: #166534;\n  background: rgba(34, 197, 94, 0.2);\n  animation: none;\n}\n@keyframes pulse-6724586e {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.6;\n}\n}\n.expand-icon[data-v-6724586e] {\n  color: #b45309;\n  flex-shrink: 0;\n}\n.thinking-content[data-v-6724586e] {\n  padding: 12px 14px;\n  border-top: 1px solid rgba(251, 191, 36, 0.3);\n  font-size: 0.85rem;\n  color: #78350f;\n  line-height: 1.6;\n  max-height: 300px;\n  overflow-y: auto;\n  background: rgba(255, 255, 255, 0.5);\n}\n\n/* 思维链展开动画 */\n.thinking-expand-enter-active[data-v-6724586e],\n.thinking-expand-leave-active[data-v-6724586e] {\n  transition: all 0.3s ease;\n}\n.thinking-expand-enter-from[data-v-6724586e],\n.thinking-expand-leave-to[data-v-6724586e] {\n  opacity: 0;\n  max-height: 0;\n  padding-top: 0;\n  padding-bottom: 0;\n}\n\n/* 当前叙述显示区域 */\n.current-narrative[data-v-6724586e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  min-width: 0; /* 防止flex收缩问题 */\n  border-radius: 12px; /* 圆角 */\n  box-shadow: none !important; /* 移除阴影 */\n  background-color: var(--color-surface) !important; /* 提亮叙事区域但不刺眼 */\n  overflow-x: hidden; /* 防止水平滚动条 */\n  overflow-y: auto; /* 允许垂直滚动 */\n  padding-right: 12px; /* 给斜体字留出空间，防止被滚动条截断 */\n}\n\n/* 流式输出内容样式 */\n.streaming-narrative-content[data-v-6724586e] {\n  margin-top: 16px;\n  padding: 16px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  animation: fadeIn-6724586e 0.3s ease-in;\n}\n.streaming-text[data-v-6724586e],\n.narrative-text[data-v-6724586e] {\n  line-height: 1.8;\n  color: var(--color-text);\n  font-size: var(--base-font-size, 1rem);\n  max-width: 100%;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  word-break: break-word;\n}\n@keyframes fadeIn-6724586e {\nfrom {\n    opacity: 0;\n    transform: translateY(10px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.content-area[data-v-6724586e] {\n  background-color: var(--color-surface) !important; /* 提亮内容区 */\n  padding: 20px 8px 20px 20px; /* 右侧留小间距给滚动条 */\n  flex: 1;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  /* 显示可见的滚动拇指，轨道透明 */\n  scrollbar-color: var(--color-border) transparent;\n  box-sizing: border-box;\n  min-height: 200px;\n  display: flex; /* 让子元素可以撑满高度 */\n  box-shadow: none !important; /* 移除阴影 */\n}\n\n/* 深色主题下 content-area 背景与内部一致 */\n[data-theme="dark"] .content-area[data-v-6724586e] {\n  background-color: #1E293B !important;\n}\n\n/* WebKit滚动条样式 */\n.content-area[data-v-6724586e]::-webkit-scrollbar {\n  width: 6px;\n  background: transparent;\n}\n.content-area[data-v-6724586e]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.content-area[data-v-6724586e]::-webkit-scrollbar-track-piece {\n  background: transparent;\n}\n.content-area[data-v-6724586e]::-webkit-scrollbar-thumb {\n  border-radius: 3px;\n  background-color: var(--color-border);\n}\n\n/* 悬停时略微增强可见度 */\n.content-area[data-v-6724586e]:hover::-webkit-scrollbar-thumb {\n  background-color: var(--color-text-secondary);\n}\n.content-area[data-v-6724586e]::-webkit-scrollbar-button {\n  display: none;\n}\n.content-area[data-v-6724586e]::-webkit-scrollbar-corner {\n  background: transparent;\n}\n\n\n/* AI处理状态指示器（生成时显示在顶部） */\n.ai-processing-indicator[data-v-6724586e] {\n  width: 100%;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);\n  border: 1px solid rgba(99, 102, 241, 0.2);\n  border-radius: 8px;\n  padding: 12px 16px;\n  margin-bottom: 16px;\n  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);\n  flex-shrink: 0; /* 防止被挤压 */\n  box-sizing: border-box;\n}\n\n/* 重置状态按钮 */\n.reset-state-btn[data-v-6724586e] {\n  padding: 6px;\n  font-size: 13px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  border: 1px solid transparent;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: auto; /* 推到右侧 */\n}\n.reset-state-btn[data-v-6724586e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-danger);\n  border-color: var(--color-border-hover);\n  transform: translateY(-1px);\n}\n\n/* 流式状态元数据布局 */\n.streaming-meta[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  gap: 12px;\n}\n.streaming-indicator[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.85rem;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.streaming-dot[data-v-6724586e] {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  animation: pulse-6724586e 1.2s ease-in-out infinite;\n}\n.streaming-text[data-v-6724586e] {\n  font-weight: 500;\n}\n\n/* 等待动画样式 */\n.waiting-animation[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 60px 0; /* 增加一些垂直空间 */\n}\n.thinking-dots[data-v-6724586e] {\n  display: flex;\n  gap: 8px;\n}\n.thinking-dots .dot[data-v-6724586e] {\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  animation: thinking-6724586e 1.4s ease-in-out infinite;\n}\n.thinking-dots .dot[data-v-6724586e]:nth-child(1) {\n  animation-delay: 0s;\n}\n.thinking-dots .dot[data-v-6724586e]:nth-child(2) {\n  animation-delay: 0.2s;\n}\n.thinking-dots .dot[data-v-6724586e]:nth-child(3) {\n  animation-delay: 0.4s;\n}\n@keyframes thinking-6724586e {\n0%, 60%, 100% {\n    transform: scale(1);\n    opacity: 0.7;\n}\n30% {\n    transform: scale(1.3);\n    opacity: 1;\n}\n}\n\n/* .waiting-text is no longer used */\n@keyframes pulse-6724586e {\n0% { box-shadow: 0 0 0 0 currentColor; opacity: 0.8;\n}\n70% { box-shadow: 0 0 0 6px transparent; opacity: 1;\n}\n100% { box-shadow: 0 0 0 0 transparent; opacity: 0.8;\n}\n}\n\n/* 输入框右侧的流式传输选项样式 - 删除旧样式 */\n\n/* 输入框容器样式 */\n.input-container[data-v-6724586e] {\n  flex: 1;\n  position: relative;\n  display: flex;\n  align-items: stretch; /* 让内部元素垂直拉伸 */\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background: var(--color-surface);\n  transition: all 0.2s ease;\n  min-height: 32px; /* 减小最小高度以对应单行 */\n  max-width: 100%; /* 防止横向扩展 */\n  overflow: hidden; /* 确保内容不会溢出容器 */\n}\n.input-container[data-v-6724586e]:focus-within {\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n.input-container[data-v-6724586e]:has(.game-input:disabled) {\n  background: #f9fafb;\n}\n\n/* 输入框内部的文本区域 */\n.input-container .game-input[data-v-6724586e] {\n  flex: 1;\n  border: none;\n  background: transparent;\n  padding: 8px 16px;\n  padding-right: 0; /* 右侧留给流式传输选项 */\n  outline: none;\n  box-shadow: none;\n  resize: none;\n  overflow-y: auto;\n  width: 100%; /* 确保宽度填满容器 */\n  min-height: 24px; /* 单行高度 */\n  max-height: 120px;\n  min-width: 0; /* 允许缩小 */\n  box-sizing: border-box;\n  word-wrap: break-word;\n  white-space: pre-wrap; /* 保持换行和空格 */\n  overflow-wrap: break-word;\n  /* 移除自动高度相关样式，用JS控制 */\n  height: auto;\n  line-height: 1.4;\n  /* 透明滚动条（Firefox） */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.input-container .game-input[data-v-6724586e]:focus {\n  border: none;\n  box-shadow: none;\n}\n\n/* 透明滚动条（WebKit） */\n.input-container .game-input[data-v-6724586e]::-webkit-scrollbar {\n  width: 6px;\n  background: transparent;\n}\n.input-container .game-input[data-v-6724586e]::-webkit-scrollbar-track,\n.input-container .game-input[data-v-6724586e]::-webkit-scrollbar-track-piece,\n.input-container .game-input[data-v-6724586e]::-webkit-scrollbar-corner {\n  background: transparent;\n}\n.input-container .game-input[data-v-6724586e]::-webkit-scrollbar-thumb {\n  border-radius: 3px;\n  background-color: transparent;\n}\n.input-container .game-input[data-v-6724586e]:hover::-webkit-scrollbar-thumb {\n  background-color: transparent;\n}\n\n/* 输入框内部的流式传输选项 */\n.stream-toggle-inside[data-v-6724586e] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 4px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n  padding: 4px 12px;\n  border-left: 1px solid #e5e7eb;\n  margin-left: 8px;\n  cursor: pointer;\n  user-select: none;\n  flex-shrink: 0;\n  align-self: stretch; /* 垂直拉伸以匹配容器高度 */\n  min-height: 32px; /* 减小最小高度以对应单行 */\n}\n.stream-toggle-inside[data-v-6724586e]:hover {\n  color: var(--color-text);\n}\n.stream-toggle-inside input[type="checkbox"][data-v-6724586e] {\n  width: 12px;\n  height: 12px;\n  cursor: pointer;\n}\n.stream-toggle-inside .label-text[data-v-6724586e] {\n  cursor: pointer;\n}\n\n/* 当前叙述显示区域 */\n/* .current-narrative 样式已合并到 line 1996 */\n.narrative-content[data-v-6724586e] {\n  line-height: 1.8;\n  color: var(--color-text);\n  font-size: 0.95rem;\n  background: var(--color-surface); /* 确保叙述内容区域背景一致 */\n}\n.action-options[data-v-6724586e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-top: 16px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n  margin-bottom: 16px;\n}\n.action-option-btn[data-v-6724586e] {\n  padding: 8px 16px;\n  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s;\n  white-space: normal;\n  word-break: break-word;\n  max-width: 100%;\n  text-align: center;\n  flex: 0 1 auto;\n  min-width: 0;\n}\n.action-option-btn[data-v-6724586e]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n}\n\n/* 绘图按钮 */\n.header-action-btn.image-gen-btn[data-v-6724586e] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-primary);\n  /* cursor: pointer; */\n  padding: 6px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  margin-right: 4px;\n}\n.header-action-btn.image-gen-btn[data-v-6724586e]:hover:not(:disabled) {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  transform: scale(1.1);\n  box-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n.header-action-btn.image-gen-btn[data-v-6724586e]:disabled {\n  opacity: 0.6;\n  cursor: wait;\n}\n.narrative-meta[data-v-6724586e] {\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #f3f4f6;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.meta-buttons[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.header-action-btn.rollback-btn[data-v-6724586e] {\n  background: transparent;\n  border: 1px solid transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.header-action-btn.rollback-btn[data-v-6724586e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-primary);\n}\n.header-action-btn.event-btn[data-v-6724586e] {\n  background: rgba(99, 102, 241, 0.10);\n  border: 1px solid rgba(99, 102, 241, 0.20);\n  color: rgba(99, 102, 241, 0.95);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.header-action-btn.event-btn[data-v-6724586e]:hover {\n  background: rgba(99, 102, 241, 0.16);\n  border-color: rgba(99, 102, 241, 0.35);\n}\n.traveling-badge[data-v-6724586e] {\n  display: inline-flex;\n  align-items: center;\n  padding: 4px 10px;\n  border-radius: 999px;\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: rgba(234, 88, 12, 0.95);\n  background: rgba(234, 88, 12, 0.12);\n  border: 1px solid rgba(234, 88, 12, 0.25);\n  white-space: nowrap;\n}\n[data-theme="dark"] .header-action-btn.event-btn[data-v-6724586e] {\n  background: rgba(99, 102, 241, 0.16);\n  border-color: rgba(99, 102, 241, 0.25);\n  color: rgba(165, 180, 252, 0.95);\n}\n[data-theme="dark"] .traveling-badge[data-v-6724586e] {\n  color: rgba(251, 146, 60, 0.95);\n  background: rgba(251, 146, 60, 0.16);\n  border-color: rgba(251, 146, 60, 0.28);\n}\n.narrative-time[data-v-6724586e] {\n  font-size: 0.8rem;\n  color: #6b7280;\n  font-weight: 500;\n}\n\n/* 变量更新按钮 */\n.variable-updates-toggle[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n  color: white;\n  border: none;\n  border-radius: 20px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n  position: relative;\n  overflow: hidden;\n}\n.variable-updates-toggle[data-v-6724586e]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s ease;\n}\n.variable-updates-toggle[data-v-6724586e]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);\n  background: linear-gradient(135deg, #2563eb, #1e40af);\n}\n.variable-updates-toggle[data-v-6724586e]:hover::before {\n  left: 100%;\n}\n.variable-updates-toggle.active[data-v-6724586e] {\n  background: linear-gradient(135deg, #10b981, #059669);\n  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);\n}\n.variable-updates-toggle.disabled[data-v-6724586e] {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: linear-gradient(135deg, #9ca3af, #6b7280);\n  box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);\n}\n.variable-updates-toggle.disabled[data-v-6724586e]:hover {\n  transform: none;\n  background: linear-gradient(135deg, #9ca3af, #6b7280);\n  box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);\n}\n.variable-updates-toggle.disabled[data-v-6724586e]::before {\n  display: none;\n}\n.update-count[data-v-6724586e] {\n  background: rgba(255, 255, 255, 0.2);\n  color: white;\n  font-size: 0.7rem;\n  font-weight: 700;\n  padding: 2px 6px;\n  border-radius: 10px;\n  min-width: 18px;\n  text-align: center;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n/* 悬浮面板覆盖层 */\n.variable-updates-overlay[data-v-6724586e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n\n/* 悬浮面板主体 */\n.variable-updates-modal[data-v-6724586e] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 500px;\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n  animation: modal-appear-6724586e 0.3s ease-out;\n}\n@keyframes modal-appear-6724586e {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n\n/* 悬浮面板动画 */\n.variable-updates-modal-enter-active[data-v-6724586e],\n.variable-updates-modal-leave-active[data-v-6724586e] {\n  transition: all 0.3s ease;\n}\n.variable-updates-modal-enter-from[data-v-6724586e] {\n  opacity: 0;\n  transform: scale(0.9) translateY(20px);\n}\n.variable-updates-modal-leave-to[data-v-6724586e] {\n  opacity: 0;\n  transform: scale(0.9) translateY(20px);\n}\n\n/* 悬浮面板头部 */\n.variable-updates-modal .updates-header[data-v-6724586e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n  border-bottom: 1px solid var(--color-border);\n}\n.variable-updates-modal .updates-header h4[data-v-6724586e] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-updates-btn[data-v-6724586e] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-updates-btn[data-v-6724586e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  transform: rotate(90deg);\n}\n\n/* 悬浮面板内容 */\n.variable-updates-modal .updates-content[data-v-6724586e] {\n  padding: 16px;\n  overflow-y: auto;\n  max-height: 60vh;\n}\n\n/* 移除重复的样式，让内部FormattedText组件处理 */\n.empty-narrative[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: #9ca3af;\n  font-style: italic;\n  font-size: 0.9rem;\n}\n\n/* 动作队列显示区域 */\n.action-queue-display[data-v-6724586e] {\n  margin-bottom: 12px;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border: 1px solid #e2e8f0;\n  border-radius: 8px;\n  padding: 12px;\n}\n.queue-header[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n.queue-title[data-v-6724586e] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #6366f1;\n}\n.clear-queue-btn[data-v-6724586e] {\n  background: transparent;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.clear-queue-btn[data-v-6724586e]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n}\n.queue-actions[data-v-6724586e] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  max-height: 150px;\n  overflow-y: auto;\n}\n.queue-action-item[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  background: rgba(99, 102, 241, 0.05);\n  border: 1px solid rgba(99, 102, 241, 0.1);\n  border-radius: 6px;\n  font-size: 0.85rem;\n}\n.action-text[data-v-6724586e] {\n  flex: 1;\n  color: #374151;\n  line-height: 1.4;\n  margin-right: 8px;\n}\n.action-controls[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  flex-shrink: 0;\n}\n.undo-indicator[data-v-6724586e] {\n  font-size: 12px;\n  opacity: 0.7;\n  animation: rotate-6724586e 2s linear infinite;\n}\n@keyframes rotate-6724586e {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n.remove-action-btn[data-v-6724586e] {\n  background: transparent;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-size: 16px;\n  line-height: 1;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.remove-action-btn[data-v-6724586e]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n}\n.input-section[data-v-6724586e] {\n  padding: 16px 20px 20px 20px; /* 进一步增加底部内边距 */\n  border-top: 1px solid #e2e8f0;\n  background: #f8fafc;\n  box-sizing: border-box;\n  flex-shrink: 0;\n}\n.input-wrapper[data-v-6724586e] {\n  display: flex;\n  gap: 12px;\n  align-items: stretch; /* 改为stretch让所有元素高度一致 */\n  width: 100%;\n  max-width: none;\n}\n.game-input[data-v-6724586e] {\n  /* 这些样式现在由 .input-container 处理 */\n  font-size: 0.9rem;\n  line-height: 1.4;\n  color: #374151;\n  resize: none;\n  /* 移除固定高度，改为自动调整 */\n  /* min-height: 44px; */\n  /* max-height: 120px; */\n  font-family: inherit;\n  /* 移除过渡效果，避免高度调整时的闪烁 */\n  /* transition: all 0.2s ease; */\n}\n\n/* 移除原来的 focus 样式，现在由容器处理 */\n/* .game-input:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n} */\n.game-input[data-v-6724586e]:disabled {\n  /* background: #f9fafb; */\n  color: #9ca3af;\n  cursor: not-allowed;\n}\n.game-input[data-v-6724586e]::placeholder {\n  color: #9ca3af;\n}\n.send-button[data-v-6724586e] {\n  width: 42px;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  flex-shrink: 0;\n  min-height: 32px;\n  align-self: stretch;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 2px 6px rgba(59, 130, 246, 0.25);\n  margin-left: 8px;\n}\n.send-button[data-v-6724586e]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);\n}\n.send-button[data-v-6724586e]:disabled {\n  background: #d1d5db;\n  color: #9ca3af;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n.animate-spin[data-v-6724586e] {\n  animation: spin-6724586e 1s linear infinite;\n}\n@keyframes spin-6724586e {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 深色主题 */\n[data-theme="dark"] .main-game-panel[data-v-6724586e] {\n  background: var(--color-background);\n}\n\n/* 叙述内容深色主题 */\n[data-theme="dark"] .narrative-content[data-v-6724586e] {\n  background: var(--color-background);\n  color: #e2e8f0;\n}\n[data-theme="dark"] .narrative-meta[data-v-6724586e] {\n  border-bottom-color: #374151;\n}\n[data-theme="dark"] .narrative-time[data-v-6724586e] {\n  color: #94a3b8;\n}\n\n/* 深色主题 - 变量更新按钮 */\n[data-theme="dark"] .variable-updates-toggle[data-v-6724586e] {\n  background: linear-gradient(135deg, #3b82f6, #1e3a8a);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);\n}\n[data-theme="dark"] .variable-updates-toggle[data-v-6724586e]:hover {\n  background: linear-gradient(135deg, #2563eb, #1e40af);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.5);\n}\n[data-theme="dark"] .variable-updates-toggle.active[data-v-6724586e] {\n  background: linear-gradient(135deg, #10b981, #065f46);\n  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);\n}\n[data-theme="dark"] .variable-updates-toggle.active[data-v-6724586e]:hover {\n  background: linear-gradient(135deg, #059669, #047857);\n  box-shadow: 0 4px 16px rgba(16, 185, 129, 0.5);\n}\n[data-theme="dark"] .variable-updates-toggle.disabled[data-v-6724586e] {\n  background: linear-gradient(135deg, #4b5563, #374151);\n  box-shadow: 0 2px 8px rgba(75, 85, 99, 0.4);\n}\n[data-theme="dark"] .variable-updates-toggle.disabled[data-v-6724586e]:hover {\n  background: linear-gradient(135deg, #4b5563, #374151);\n  box-shadow: 0 2px 8px rgba(75, 85, 99, 0.4);\n}\n[data-theme="dark"] .variable-updates-overlay[data-v-6724586e] {\n  background: rgba(0, 0, 0, 0.7);\n}\n[data-theme="dark"] .variable-updates-modal[data-v-6724586e] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme="dark"] .variable-updates-modal .updates-header[data-v-6724586e] {\n  background: linear-gradient(135deg, #334155 0%, #475569 100%);\n  border-color: #475569;\n}\n[data-theme="dark"] .variable-updates-modal .updates-header h4[data-v-6724586e] {\n  color: #e2e8f0;\n}\n[data-theme="dark"] .close-updates-btn[data-v-6724586e] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .close-updates-btn[data-v-6724586e]:hover {\n  background: #475569;\n  color: #e2e8f0;\n}\n[data-theme="dark"] .empty-narrative[data-v-6724586e] {\n  color: #6b7280;\n}\n\n/* 确保深色主题下当前叙述区域背景一致 */\n[data-theme="dark"] .current-narrative[data-v-6724586e] {\n  background-color: #1E293B !important;\n}\n\n/* 深色主题 - 流式输出内容 */\n[data-theme="dark"] .streaming-narrative-content[data-v-6724586e] {\n  background: var(--color-surface);\n  border-color: var(--color-border);\n}\n[data-theme="dark"] .streaming-text[data-v-6724586e] {\n  color: #e2e8f0;\n}\n[data-theme="dark"] .ai-processing-display[data-v-6724586e] {\n  background: var(--color-background) !important;\n}\n[data-theme="dark"] .reset-state-btn[data-v-6724586e] {\n  background: rgba(var(--color-error-rgb), 0.2);\n  color: var(--color-danger);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n}\n[data-theme="dark"] .reset-state-btn[data-v-6724586e]:hover {\n  background: rgba(var(--color-error-rgb), 0.3);\n  border-color: rgba(var(--color-error-rgb), 0.5);\n}\n[data-theme="dark"] .narrative-content[data-v-6724586e] {\n  background: #1E293B !important;\n}\n[data-theme="dark"] .input-section[data-v-6724586e] {\n  background: #334155;\n  border-top-color: #475569;\n}\n[data-theme="dark"] .game-input[data-v-6724586e] {\n  /* background: #1e293b; - 现在由容器处理 */\n  /* border-color: #475569; - 现在由容器处理 */\n  color: #e2e8f0;\n}\n\n/* 移除重复的深色主题 focus 样式 */\n/* [data-theme="dark"] .game-input:focus {\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);\n} */\n[data-theme="dark"] .game-input[data-v-6724586e]:disabled {\n  /* background: #0f172a; - 现在由容器处理 */\n  color: #64748b;\n}\n[data-theme="dark"] .game-input[data-v-6724586e]::placeholder {\n  color: #64748b;\n}\n[data-theme="dark"] .send-button[data-v-6724586e] {\n  background: #3b82f6;\n}\n[data-theme="dark"] .send-button[data-v-6724586e]:hover:not(:disabled) {\n  background: #2563eb;\n}\n[data-theme="dark"] .send-button[data-v-6724586e]:disabled {\n  background: #374151;\n  color: #64748b;\n}\n\n/* 短期记忆深色主题 */\n[data-theme="dark"] .memory-section[data-v-6724586e] {\n  background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n  border-color: #475569;\n}\n[data-theme="dark"] .memory-header[data-v-6724586e]:hover {\n  background: rgba(99, 102, 241, 0.1);\n}\n[data-theme="dark"] .memory-title[data-v-6724586e] {\n  color: #818cf8;\n}\n[data-theme="dark"] .memory-icon[data-v-6724586e] {\n  color: #64748b;\n}\n[data-theme="dark"] .memory-dropdown[data-v-6724586e] {\n  background: #1e293b;\n  border-color: #475569;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n}\n[data-theme="dark"] .memory-item[data-v-6724586e] {\n  background: rgba(129, 140, 248, 0.1);\n  border-left-color: #818cf8;\n  color: #e2e8f0;\n}\n\n/* 思维链深色主题 */\n[data-theme="dark"] .thinking-section[data-v-6724586e] {\n  background: linear-gradient(135deg, #422006 0%, #451a03 100%);\n  border-color: #92400e;\n}\n[data-theme="dark"] .thinking-header[data-v-6724586e]:hover {\n  background: rgba(251, 191, 36, 0.1);\n}\n[data-theme="dark"] .thinking-icon[data-v-6724586e] {\n  color: #fbbf24;\n}\n[data-theme="dark"] .thinking-title[data-v-6724586e] {\n  color: #fcd34d;\n}\n[data-theme="dark"] .thinking-badge.streaming[data-v-6724586e] {\n  color: #fcd34d;\n  background: rgba(251, 191, 36, 0.2);\n}\n[data-theme="dark"] .thinking-badge.completed[data-v-6724586e] {\n  color: #86efac;\n  background: rgba(34, 197, 94, 0.15);\n}\n[data-theme="dark"] .expand-icon[data-v-6724586e] {\n  color: #fbbf24;\n}\n[data-theme="dark"] .thinking-content[data-v-6724586e] {\n  background: rgba(0, 0, 0, 0.2);\n  border-top-color: rgba(251, 191, 36, 0.2);\n  color: #fef3c7;\n}\n\n/* 等待覆盖层深色主题 - 更新为AI处理显示样式 */\n[data-theme="dark"] .streaming-meta[data-v-6724586e] {\n  border-bottom-color: #374151;\n}\n[data-theme="dark"] .streaming-indicator[data-v-6724586e] {\n  color: #60a5fa;\n}\n[data-theme="dark"] .streaming-dot[data-v-6724586e] {\n  background: #60a5fa;\n}\n[data-theme="dark"] .thinking-dots .dot[data-v-6724586e] {\n  background: #60a5fa;\n}\n[data-theme="dark"] .waiting-text[data-v-6724586e] {\n  color: #94a3b8;\n}\n\n/* 输入框右侧流式传输选项深色主题 - 更新为内部样式 */\n[data-theme="dark"] .input-container[data-v-6724586e] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme="dark"] .input-container[data-v-6724586e]:focus-within {\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .input-container[data-v-6724586e]:has(.game-input:disabled) {\n  background: #0f172a;\n}\n[data-theme="dark"] .stream-toggle-inside[data-v-6724586e] {\n  color: #94a3b8;\n  border-left-color: #475569;\n}\n[data-theme="dark"] .stream-toggle-inside[data-v-6724586e]:hover {\n  color: #e2e8f0;\n}\n\n/* 行动选择器按钮 */\n.action-selector-btn[data-v-6724586e] {\n  width: 44px;\n  min-height: 32px; /* 减小最小高度以匹配输入框 */\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #6366f1;\n  align-self: stretch; /* 垂直拉伸以匹配容器高度 */\n  flex-shrink: 0;\n}\n.action-selector-btn[data-v-6724586e]:hover:not(:disabled) {\n  background: #f1f5f9;\n  border-color: #6366f1;\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\n}\n.action-selector-btn[data-v-6724586e]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n/* 行动选择弹窗 */\n.action-modal-overlay[data-v-6724586e],\n.action-config-overlay[data-v-6724586e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(2px);\n}\n.action-modal[data-v-6724586e] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  max-width: 480px;\n  width: 90%;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  overflow: hidden;\n}\n.action-config-modal[data-v-6724586e] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  max-width: 400px;\n  width: 90%;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  overflow: hidden;\n}\n.modal-header[data-v-6724586e],\n.config-header[data-v-6724586e] {\n  padding: 16px 20px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: var(--color-primary, #3b82f6);\n}\n.modal-header h3[data-v-6724586e],\n.config-header h3[data-v-6724586e] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: white;\n}\n.close-btn[data-v-6724586e] {\n  width: 28px;\n  height: 28px;\n  border: none;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: white;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-6724586e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.action-grid[data-v-6724586e] {\n  padding: 16px;\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n}\n.quick-action-btn[data-v-6724586e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  padding: 12px 8px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: var(--color-surface);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.8rem;\n  min-height: 70px;\n}\n.quick-action-btn[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n  background: #f8fafc;\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.quick-action-btn.cultivation[data-v-6724586e] {\n  border-color: rgba(34, 197, 94, 0.2);\n  background: rgba(34, 197, 94, 0.03);\n}\n.quick-action-btn.cultivation[data-v-6724586e]:hover {\n  border-color: #22c55e;\n  background: rgba(34, 197, 94, 0.08);\n}\n.quick-action-btn.exploration[data-v-6724586e] {\n  border-color: rgba(59, 130, 246, 0.2);\n  background: rgba(59, 130, 246, 0.03);\n}\n.quick-action-btn.exploration[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n  background: rgba(59, 130, 246, 0.08);\n}\n.quick-action-btn.social[data-v-6724586e] {\n  border-color: rgba(20, 184, 166, 0.2);\n  background: rgba(20, 184, 166, 0.03);\n}\n.quick-action-btn.social[data-v-6724586e]:hover {\n  border-color: #14b8a6;\n  background: rgba(20, 184, 166, 0.08);\n}\n.quick-action-btn.other[data-v-6724586e] {\n  border-color: rgba(156, 163, 175, 0.2);\n  background: rgba(156, 163, 175, 0.03);\n}\n.quick-action-btn.other[data-v-6724586e]:hover {\n  border-color: #9ca3af;\n  background: rgba(156, 163, 175, 0.08);\n}\n.action-icon[data-v-6724586e] {\n  font-size: 1.2rem;\n  line-height: 1;\n}\n.action-text[data-v-6724586e] {\n  font-weight: 500;\n  color: #374151;\n  text-align: center;\n  line-height: 1.2;\n}\n\n/* 配置弹窗内容 */\n.config-content[data-v-6724586e] {\n  padding: 20px;\n}\n.action-description[data-v-6724586e] {\n  margin: 0 0 20px 0;\n  color: #6b7280;\n  line-height: 1.5;\n}\n.config-section[data-v-6724586e] {\n  margin-bottom: 20px;\n}\n.config-section[data-v-6724586e]:last-child {\n  margin-bottom: 0;\n}\n.config-label[data-v-6724586e] {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #374151;\n  font-size: 0.875rem;\n}\n.time-selector[data-v-6724586e] {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n}\n.time-btn[data-v-6724586e] {\n  padding: 8px 16px;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  background: var(--color-surface);\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n}\n.time-btn[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n}\n.time-btn.active[data-v-6724586e] {\n  border-color: #3b82f6;\n  background: #3b82f6;\n  color: white;\n}\n.time-custom[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.875rem;\n}\n.time-input[data-v-6724586e] {\n  width: 80px;\n  padding: 6px 10px;\n  border: 1px solid #d1d5db;\n  border-radius: 4px;\n  font-size: 0.875rem;\n}\n.action-options[data-v-6724586e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.option-item[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.option-item[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n  background: #f8fafc;\n}\n.option-item input[type="radio"][data-v-6724586e] {\n  margin: 0;\n}\n.config-actions[data-v-6724586e] {\n  padding: 20px;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n}\n.cancel-btn[data-v-6724586e],\n.confirm-btn[data-v-6724586e] {\n  padding: 8px 20px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.cancel-btn[data-v-6724586e] {\n  border: 1px solid #d1d5db;\n  background: var(--color-surface);\n  color: #6b7280;\n}\n.cancel-btn[data-v-6724586e]:hover {\n  background: #f9fafb;\n  border-color: #9ca3af;\n}\n.confirm-btn[data-v-6724586e] {\n  border: 1px solid #3b82f6;\n  background: #3b82f6;\n  color: white;\n}\n.confirm-btn[data-v-6724586e]:hover {\n  background: #2563eb;\n  border-color: #2563eb;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .action-selector-btn[data-v-6724586e] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #d1d5db;\n}\n[data-theme="dark"] .action-selector-btn[data-v-6724586e]:hover:not(:disabled) {\n  background: #4b5563;\n  border-color: #6b7280;\n}\n[data-theme="dark"] .action-modal[data-v-6724586e],\n[data-theme="dark"] .action-config-modal[data-v-6724586e] {\n  background: #1f2937;\n}\n[data-theme="dark"] .modal-header[data-v-6724586e],\n[data-theme="dark"] .config-header[data-v-6724586e],\n[data-theme="dark"] .config-actions[data-v-6724586e] {\n  border-color: #374151;\n}\n[data-theme="dark"] .modal-header h3[data-v-6724586e],\n[data-theme="dark"] .config-header h3[data-v-6724586e],\n[data-theme="dark"] .category-title[data-v-6724586e],\n[data-theme="dark"] .config-label[data-v-6724586e],\n[data-theme="dark"] .action-name[data-v-6724586e] {\n  color: #f9fafb;\n}\n[data-theme="dark"] .close-btn[data-v-6724586e] {\n  background: #374151;\n  color: #d1d5db;\n}\n[data-theme="dark"] .close-btn[data-v-6724586e]:hover {\n  background: #4b5563;\n  color: #f9fafb;\n}\n[data-theme="dark"] .action-btn[data-v-6724586e] {\n  background: #374151;\n  border-color: #4b5563;\n}\n[data-theme="dark"] .action-btn[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n  background: #1f2937;\n}\n[data-theme="dark"] .time-btn[data-v-6724586e],\n[data-theme="dark"] .option-item[data-v-6724586e] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #d1d5db;\n}\n[data-theme="dark"] .time-input[data-v-6724586e] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #f9fafb;\n}\n[data-theme="dark"] .cancel-btn[data-v-6724586e] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #d1d5db;\n}\n[data-theme="dark"] .cancel-btn[data-v-6724586e]:hover {\n  background: #4b5563;\n}\n\n/* 深色主题动作队列样式 */\n[data-theme="dark"] .action-queue-display[data-v-6724586e] {\n  background: linear-gradient(135deg, #374151 0%, #1f2937 100%);\n  border-color: #4b5563;\n}\n[data-theme="dark"] .queue-title[data-v-6724586e] {\n  color: #818cf8;\n}\n[data-theme="dark"] .clear-queue-btn[data-v-6724586e] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .clear-queue-btn[data-v-6724586e]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n[data-theme="dark"] .queue-action-item[data-v-6724586e] {\n  background: rgba(129, 140, 248, 0.1);\n  border-color: rgba(129, 140, 248, 0.2);\n}\n[data-theme="dark"] .action-text[data-v-6724586e] {\n  color: #e5e7eb;\n}\n[data-theme="dark"] .remove-action-btn[data-v-6724586e] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .remove-action-btn[data-v-6724586e]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n[data-theme="dark"] .action-controls[data-v-6724586e] {\n  color: #d1d5db;\n}\n[data-theme="dark"] .undo-indicator[data-v-6724586e] {\n  filter: brightness(1.2);\n}\n\n/* 变更描述样式 */\n.change-description[data-v-6724586e] {\n  color: var(--color-text);\n  font-size: 0.8rem;\n  margin-bottom: 6px;\n  padding: 4px 8px;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  border-left: 2px solid var(--color-primary);\n  line-height: 1.3;\n  font-style: italic;\n}\n\n/* 深色主题下的变更描述 */\n[data-theme="dark"] .change-description[data-v-6724586e] {\n  background: #334155;\n  color: #e2e8f0;\n  border-left-color: #60a5fa;\n}\n\n/* 空状态样式 */\n.no-changes[data-v-6724586e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.no-changes .empty-icon[data-v-6724586e] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n  color: var(--color-text-secondary);\n}\n.no-changes .empty-text[data-v-6724586e] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.no-changes .empty-hint[data-v-6724586e] {\n  font-size: 0.8rem;\n  opacity: 0.8;\n  line-height: 1.4;\n}\n\n/* 图片预览容器样式 */\n.image-preview-container[data-v-6724586e] {\n  display: flex;\n  gap: 8px;\n  padding: 8px;\n  flex-wrap: wrap;\n  border-bottom: 1px solid #e5e7eb;\n  background: #f9fafb;\n}\n.image-preview-item[data-v-6724586e] {\n  position: relative;\n  width: 60px;\n  height: 60px;\n  border-radius: 6px;\n  overflow: hidden;\n  border: 2px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n.image-preview-item[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n  transform: scale(1.05);\n}\n.image-preview-item img[data-v-6724586e] {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n.remove-image-btn[data-v-6724586e] {\n  position: absolute;\n  top: 2px;\n  right: 2px;\n  width: 20px;\n  height: 20px;\n  padding: 0;\n  background: rgba(239, 68, 68, 0.9);\n  border: none;\n  border-radius: 50%;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: all 0.2s ease;\n}\n.image-preview-item:hover .remove-image-btn[data-v-6724586e] {\n  opacity: 1;\n}\n.remove-image-btn[data-v-6724586e]:hover {\n  background: rgba(220, 38, 38, 1);\n  transform: scale(1.1);\n}\n\n/* 图片上传按钮特殊样式 */\n.image-upload-btn svg[data-v-6724586e] {\n  color: #10b981;\n}\n.image-upload-btn:hover:not(:disabled) svg[data-v-6724586e] {\n  color: #059669;\n}\n\n/* 深色主题图片预览样式 */\n[data-theme="dark"] .image-preview-container[data-v-6724586e] {\n  background: #0f172a;\n  border-bottom-color: #475569;\n}\n[data-theme="dark"] .image-preview-item[data-v-6724586e] {\n  border-color: #475569;\n}\n[data-theme="dark"] .image-preview-item[data-v-6724586e]:hover {\n  border-color: #3b82f6;\n}\n\n/* 最新消息text样式 */\n.latest-message-text[data-v-6724586e] {\n  margin-top: 20px;\n  padding: 16px;\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-left: 4px solid #818cf8;\n  border-radius: 8px;\n  font-size: 0.9rem;\n  color: #475569;\n  line-height: 1.7;\n}\n.latest-text-header[data-v-6724586e] {\n  font-weight: 600;\n  color: #6366f1;\n  margin-bottom: 8px;\n  font-size: 0.85rem;\n}\n[data-theme="dark"] .latest-message-text[data-v-6724586e] {\n  background: #334155;\n  border-color: #4b5563;\n  border-left-color: #818cf8;\n  color: #cbd5e1;\n}\n[data-theme="dark"] .latest-text-header[data-v-6724586e] {\n  color: #a5b4fc;\n}\n\n/* Cultivation Panel */\n.cultivation-panel-overlay[data-v-6724586e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1001; /* Higher than action modal */\n  backdrop-filter: blur(4px);\n}\n.cultivation-panel[data-v-6724586e] {\n  background: linear-gradient(145deg, #f9fafb, #f3f4f6);\n  border-radius: 16px;\n  width: 90%;\n  max-width: 800px;\n  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  display: flex;\n  flex-direction: column;\n  animation: modal-appear-6724586e 0.4s cubic-bezier(0.25, 1, 0.5, 1);\n}\n.cultivation-panel .panel-header[data-v-6724586e] {\n  padding: 16px 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.cultivation-panel .panel-header h3[data-v-6724586e] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: #1f2937;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n.cultivation-panel .panel-content[data-v-6724586e] {\n  padding: 24px;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 24px;\n}\n.cultivation-card[data-v-6724586e] {\n  background: white;\n  border-radius: 12px;\n  padding: 20px;\n  border: 1px solid #e5e7eb;\n  display: flex;\n  flex-direction: column;\n  transition: all 0.3s ease;\n  position: relative;\n  overflow: hidden;\n}\n.cultivation-card[data-v-6724586e]:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);\n  border-color: #a5b4fc;\n}\n.cultivation-card .card-header[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-bottom: 12px;\n}\n.cultivation-card .card-icon[data-v-6724586e] {\n  color: #6366f1;\n}\n.cultivation-zap .card-icon[data-v-6724586e] { color: #f59e0b;\n}\n.cultivation-shield .card-icon[data-v-6724586e] { color: #3b82f6;\n}\n.cultivation-braincircuit .card-icon[data-v-6724586e] { color: #8b5cf6;\n}\n.cultivation-card .card-title[data-v-6724586e] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #111827;\n}\n.cultivation-card .card-description[data-v-6724586e] {\n  font-size: 0.85rem;\n  color: #4b5563;\n  line-height: 1.6;\n  flex-grow: 1;\n  margin: 0 0 16px 0;\n}\n.cultivation-card .card-config[data-v-6724586e] {\n  margin-bottom: 16px;\n}\n.cultivation-card .config-label[data-v-6724586e] {\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: #6b7280;\n  margin-bottom: 8px;\n  display: block;\n}\n.cultivation-card .time-selector[data-v-6724586e] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.cultivation-card .time-slider[data-v-6724586e] {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 100%;\n  height: 6px;\n  background: #e5e7eb;\n  border-radius: 3px;\n  outline: none;\n  opacity: 0.7;\n  transition: opacity .2s;\n}\n.cultivation-card .time-slider[data-v-6724586e]:hover {\n  opacity: 1;\n}\n.cultivation-card .time-slider[data-v-6724586e]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  background: #6366f1;\n  cursor: pointer;\n  border-radius: 50%;\n}\n.cultivation-card .time-slider[data-v-6724586e]::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  background: #6366f1;\n  cursor: pointer;\n  border-radius: 50%;\n}\n.cultivation-card .time-display[data-v-6724586e] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #1f2937;\n  min-width: 50px;\n  text-align: right;\n}\n.start-cultivation-btn[data-v-6724586e] {\n  width: 100%;\n  padding: 10px;\n  border: none;\n  border-radius: 8px;\n  background: #4f46e5;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.start-cultivation-btn[data-v-6724586e]:hover {\n  background: #4338ca;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);\n}\n.cultivation-zap .start-cultivation-btn[data-v-6724586e] { background: #f59e0b;\n}\n.cultivation-zap .start-cultivation-btn[data-v-6724586e]:hover { background: #d97706; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);\n}\n.cultivation-shield .start-cultivation-btn[data-v-6724586e] { background: #3b82f6;\n}\n.cultivation-shield .start-cultivation-btn[data-v-6724586e]:hover { background: #2563eb; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);\n}\n.cultivation-braincircuit .start-cultivation-btn[data-v-6724586e] { background: #8b5cf6;\n}\n.cultivation-braincircuit .start-cultivation-btn[data-v-6724586e]:hover { background: #7c3aed; box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3);\n}\n\n/* Dark theme for cultivation panel */\n[data-theme="dark"] .cultivation-panel[data-v-6724586e] {\n  background: linear-gradient(145deg, #1f2937, #111827);\n  border-color: #374151;\n}\n[data-theme="dark"] .cultivation-panel .panel-header[data-v-6724586e] {\n  border-color: #374151;\n}\n[data-theme="dark"] .cultivation-panel .panel-header h3[data-v-6724586e] {\n  color: #f3f4f6;\n}\n[data-theme="dark"] .cultivation-card[data-v-6724586e] {\n  background: #1f2937;\n  border-color: #374151;\n}\n[data-theme="dark"] .cultivation-card[data-v-6724586e]:hover {\n  border-color: #a5b4fc;\n}\n[data-theme="dark"] .cultivation-card .card-title[data-v-6724586e] {\n  color: #f9fafb;\n}\n[data-theme="dark"] .cultivation-card .card-description[data-v-6724586e] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .cultivation-card .config-label[data-v-6724586e] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .cultivation-card .time-slider[data-v-6724586e] {\n  background: #4b5563;\n}\n[data-theme="dark"] .cultivation-card .time-display[data-v-6724586e] {\n  color: #f3f4f6;\n}\n\n\n/* 手机端响应式修复 */\n@media (max-width: 768px) {\n.main-game-panel[data-v-6724586e] {\n    width: 100%;\n    max-width: 100vw;\n    overflow-x: hidden;\n}\n.content-area[data-v-6724586e] {\n    padding: 4px;\n    overflow-x: hidden;\n    width: 100%;\n    box-sizing: border-box;\n}\n.current-narrative[data-v-6724586e] {\n    min-width: 0;\n    max-width: 100%;\n    overflow-x: hidden;\n    width: 100%;\n}\n.streaming-narrative-content[data-v-6724586e],\n  .narrative-content[data-v-6724586e] {\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    max-width: 100%;\n    padding: 8px;\n}\n.streaming-text[data-v-6724586e],\n  .narrative-text[data-v-6724586e] {\n    max-width: 100%;\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    font-size: 0.85rem;\n}\n.input-wrapper[data-v-6724586e] {\n    gap: 4px;\n    padding: 4px;\n    width: 100%;\n    box-sizing: border-box;\n}\n.input-container[data-v-6724586e] {\n    min-width: 0;\n    flex: 1;\n}\n.game-input[data-v-6724586e] {\n    font-size: 0.85rem;\n    padding: 6px 8px;\n}\n.send-button[data-v-6724586e] {\n    padding: 8px 12px;\n    flex-shrink: 0;\n    min-width: 44px;\n}\n.stream-toggle-inside[data-v-6724586e] {\n    font-size: 0.75rem;\n    padding: 0 6px;\n}\n}\n',""]);const s=i},6392:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* 顶栏动作统一处理，移除本地工具栏 */\n/* 容器约束防止溢出 */\n.memory-center-panel[data-v-629034e8] {\n  width: 100%;\n  max-width: 100%;\n  height: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  container-type: inline-size;\n  margin: 0;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1.25rem;\n}\n\n/* 导出区域样式 */\n.export-section[data-v-629034e8] {\n  padding: 1.25rem 1.5rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(37, 99, 235, 0.08) 100%);\n  border: 1.5px solid rgba(59, 130, 246, 0.15);\n  border-radius: 14px;\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.08);\n}\n.export-btn-main[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: white;\n  border: none;\n  padding: 0.75rem 1.5rem;\n  border-radius: 10px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 600;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  white-space: nowrap;\n  box-shadow: 0 4px 14px rgba(59, 130, 246, 0.25);\n  letter-spacing: 0.3px;\n}\n.export-btn-main[data-v-629034e8]:hover {\n  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);\n  transform: translateY(-3px);\n  box-shadow: 0 8px 20px rgba(59, 130, 246, 0.35);\n}\n.export-hint[data-v-629034e8] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  opacity: 0.85;\n}\n.filter-section[data-v-629034e8] {\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border: 1px solid rgba(var(--color-border-rgb), 0.2);\n  border-radius: 16px;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n}\n.filter-tabs[data-v-629034e8] {\n  display: flex;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n  overflow: hidden;\n  box-sizing: border-box;\n  align-items: center;\n  justify-content: flex-start;\n  margin: 0;\n  padding: 0.75rem;\n}\n.filter-tabs .filter-tab[data-v-629034e8] {\n  flex: 0 0 auto;\n  margin: 0;\n}\n.filter-tabs .settings-toggle-btn[data-v-629034e8] {\n  margin-left: auto;\n}\n.filter-tab[data-v-629034e8] {\n  flex-shrink: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 150px;\n  margin: 0;\n  padding: 0.7rem 1.2rem;\n  border: 1.5px solid rgba(100, 116, 139, 0.2);\n  background: rgba(255, 255, 255, 0.95);\n  color: #475569;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  box-sizing: border-box;\n  font-size: 0.875rem;\n  font-weight: 600;\n  min-height: 42px;\n  position: relative;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n  letter-spacing: 0.3px;\n}\n.filter-tab[data-v-629034e8]:hover {\n  background: rgba(241, 245, 249, 1);\n  border-color: rgba(59, 130, 246, 0.35);\n  color: #1e293b;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);\n}\n.filter-tab.active[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-color: transparent;\n  color: white;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);\n  transform: translateY(-1px);\n}\n.filter-tab .tab-icon[data-v-629034e8] {\n  font-size: 1rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.filter-tab .tab-name[data-v-629034e8] {\n  font-weight: 500;\n  letter-spacing: 0.2px;\n}\n.filter-tab .tab-count[data-v-629034e8] {\n  background: rgba(100, 116, 139, 0.12);\n  color: #64748b;\n  padding: 0.2rem 0.5rem;\n  border-radius: 8px;\n  font-size: 0.75rem;\n  font-weight: 700;\n  min-width: 20px;\n  text-align: center;\n  line-height: 1;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);\n}\n.filter-tab.active .tab-count[data-v-629034e8] {\n  background: rgba(255, 255, 255, 0.3);\n  color: white;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.panel-content[data-v-629034e8] {\n  width: 100%;\n  max-width: 100%;\n  height: calc(100% - 80px);\n  overflow-y: auto;\n  overflow-x: hidden;\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n/* 设置界面样式 */\n.settings-section[data-v-629034e8] {\n  margin: 0;\n  padding: 0;\n  background: rgba(var(--color-surface-rgb), 0.95);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  animation: fadeIn-629034e8 0.3s ease-in-out;\n  max-width: 100%;\n  width: 100%;\n  height: 100%;\n  max-height: calc(100% - 80px);\n  box-sizing: border-box;\n  overflow: hidden;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n  display: flex;\n  flex-direction: column;\n}\n.settings-header[data-v-629034e8] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0;\n  padding: 1rem 1rem 0.5rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  flex-shrink: 0;\n}\n.header-actions[data-v-629034e8] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.export-btn[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.4rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  white-space: nowrap;\n  margin-right: 0.5rem;\n}\n.export-btn[data-v-629034e8]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.test-btn[data-v-629034e8] {\n  background: linear-gradient(135deg, #10b981, #059669);\n  color: white;\n  border: none;\n  padding: 0.4rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.test-btn[data-v-629034e8]:hover {\n  background: linear-gradient(135deg, #059669, #047857);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);\n}\n.settings-title[data-v-629034e8] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.settings-close-btn[data-v-629034e8] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 1.2rem;\n  padding: 0.2rem;\n  border-radius: 4px;\n  transition: var(--transition-fast);\n  flex-shrink: 0;\n}\n.settings-close-btn[data-v-629034e8]:hover {\n  background: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n}\n.settings-content[data-v-629034e8] {\n  display: block;\n  max-width: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  box-sizing: border-box;\n  flex: 1;\n  min-height: 0;\n  padding: 1rem;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.settings-content[data-v-629034e8]::-webkit-scrollbar {\n  width: 8px;\n}\n.settings-content[data-v-629034e8]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-content[data-v-629034e8]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-content[data-v-629034e8]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n.setting-item[data-v-629034e8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-width: 100%;\n  overflow: visible;\n  box-sizing: border-box;\n  margin-bottom: 1.5rem;\n}\n.setting-label[data-v-629034e8] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n}\n.setting-input[data-v-629034e8] {\n  padding: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  width: 100px;\n  max-width: 120px;\n  transition: var(--transition-fast);\n  box-sizing: border-box;\n}\n.setting-input[data-v-629034e8]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2);\n}\n.setting-textarea[data-v-629034e8] {\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  width: 100%;\n  max-width: 100%;\n  transition: var(--transition-fast);\n  box-sizing: border-box;\n  resize: vertical;\n  min-height: 100px;\n  font-family: monospace;\n  line-height: 1.4;\n}\n.setting-textarea[data-v-629034e8]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2);\n}\n.setting-textarea[data-v-629034e8]::placeholder {\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n.setting-checkbox[data-v-629034e8] {\n  margin-right: 0.5rem;\n  accent-color: var(--color-primary);\n  flex-shrink: 0;\n}\n.setting-hint[data-v-629034e8] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n}\n.settings-actions[data-v-629034e8] {\n  display: flex;\n  gap: 0.75rem;\n  margin-top: 2rem;\n  flex-wrap: wrap;\n  max-width: 100%;\n  overflow: visible;\n  box-sizing: border-box;\n}\n\n/* 手动总结区域 */\n.manual-summary-section[data-v-629034e8] {\n  margin-top: 1.5rem;\n  padding: 1rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.summary-info[data-v-629034e8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n}\n.info-text[data-v-629034e8] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.info-hint[data-v-629034e8] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* 通用操作按钮基样式，确保有清晰边框 */\n.action-btn[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: var(--transition-fast);\n  white-space: nowrap;\n  box-sizing: border-box;\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n\n/* 修复按钮文字被全局样式覆盖的问题 */\n.action-btn .btn-text[data-v-629034e8] {\n  display: inline;\n  width: auto;\n  text-align: left;\n  font-size: inherit;\n  color: inherit;\n}\n@keyframes fadeIn-629034e8 {\nfrom {\n    opacity: 0;\n    transform: translateY(-10px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.action-btn.success[data-v-629034e8] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border: 1px solid rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n  padding: 0.5rem 1rem;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: var(--transition-fast);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  box-sizing: border-box;\n}\n.action-btn.success[data-v-629034e8]:hover {\n  background: rgba(var(--color-success-rgb), 0.2);\n  border-color: var(--color-success);\n}\n\n/* 信息按钮，用于“重置默认”等操作 */\n.action-btn.info[data-v-629034e8] {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border: 1px solid rgba(var(--color-info-rgb), 0.3);\n  color: var(--color-info);\n}\n.action-btn.info[data-v-629034e8]:hover {\n  background: rgba(var(--color-info-rgb), 0.2);\n  border-color: var(--color-info);\n}\n.settings-toggle-btn[data-v-629034e8] {\n  background: rgba(var(--color-surface-rgb), 0.9);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.4);\n  padding: 0.65rem;\n  border-radius: 10px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  width: 42px;\n  height: 42px;\n  box-sizing: border-box;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n}\n.settings-toggle-btn[data-v-629034e8]:hover,\n.settings-toggle-btn.active[data-v-629034e8] {\n  background: rgba(59, 130, 246, 0.12);\n  border-color: rgba(59, 130, 246, 0.5);\n  color: #3b82f6;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);\n}\n\n/* 记忆卡片特定样式 */\n.memory-list[data-v-629034e8] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n}\n.memory-card[data-v-629034e8] {\n  padding: 1.25rem 1.5rem;\n  background: var(--color-surface);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.5);\n  border-radius: 12px;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  cursor: pointer;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  word-wrap: break-word;\n  word-break: break-word;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n}\n.memory-card[data-v-629034e8]:hover {\n  background: var(--color-surface-light);\n  border-color: rgba(59, 130, 246, 0.35);\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(59, 130, 246, 0.12);\n}\n.memory-header[data-v-629034e8] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  padding-bottom: 0.75rem;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.15);\n}\n.memory-actions[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.delete-memory-btn[data-v-629034e8] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  padding: 0.25rem 0.5rem;\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s ease;\n  opacity: 0.6;\n}\n.delete-memory-btn[data-v-629034e8]:hover {\n  opacity: 1;\n  background: rgba(220, 38, 38, 0.1);\n  border-color: #dc2626;\n  transform: scale(1.1);\n}\n.memory-type-badge[data-v-629034e8] {\n  padding: 0.35rem 0.75rem;\n  border-radius: 8px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  border: 1.5px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  letter-spacing: 0.3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n.badge-short[data-v-629034e8] {\n  border-color: rgba(var(--color-warning-rgb), 0.3);\n  background: rgba(var(--color-warning-rgb), 0.1);\n  color: var(--color-warning);\n}\n.badge-medium[data-v-629034e8] {\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  background: rgba(var(--color-success-rgb), 0.1);\n  color: var(--color-success);\n}\n.badge-long[data-v-629034e8] {\n  border-color: rgba(var(--color-info-rgb), 0.3);\n  background: rgba(var(--color-info-rgb), 0.1);\n  color: var(--color-info);\n}\n.memory-time[data-v-629034e8] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.memory-content[data-v-629034e8] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  line-height: 1.5;\n  margin-bottom: 0.5rem;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n  word-break: break-word;\n}\n.memory-title[data-v-629034e8] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  margin-bottom: 0.75rem;\n  text-align: center;\n  padding: 0.5rem;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  border-radius: 6px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n}\n.memory-section[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  margin: 0.75rem 0 0.5rem 0;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.3);\n}\n.memory-icon[data-v-629034e8] {\n  font-size: 1.2rem;\n  margin-right: 0.5rem;\n}\n.memory-section-title[data-v-629034e8] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.memory-item[data-v-629034e8] {\n  margin: 0.3rem 0;\n  padding-left: 1rem;\n  color: var(--color-text);\n  line-height: 1.4;\n  position: relative;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n  word-break: break-word;\n}\n.memory-item[data-v-629034e8]::before {\n  content: \'\';\n  position: absolute;\n  left: 0.25rem;\n  top: 0.6rem;\n  width: 3px;\n  height: 3px;\n  background: var(--color-accent);\n  border-radius: 50%;\n}\n.memory-importance[data-v-629034e8] {\n  font-size: 0.75rem;\n  color: var(--color-accent);\n  font-weight: 500;\n  padding: 0.25rem 0.5rem;\n  background: rgba(var(--color-accent-rgb), 0.1);\n  border-radius: 4px;\n  border: 1px solid rgba(var(--color-accent-rgb), 0.3);\n  display: inline-block;\n}\n.empty-hint[data-v-629034e8] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.memory-center-panel[data-v-629034e8] {\n    gap: 0.75rem;\n    width: 100%;\n    max-width: 100%;\n    overflow: hidden;\n}\n.header-actions[data-v-629034e8] {\n    flex-wrap: wrap;\n}\n.header-actions .action-btn[data-v-629034e8] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.75rem;\n}\n.header-actions .btn-text[data-v-629034e8] {\n    display: inline;\n}\n.filter-tabs[data-v-629034e8] {\n    gap: 0.3rem;\n}\n.filter-tab[data-v-629034e8] {\n    max-width: 120px;\n    font-size: 0.8rem;\n}\n.memory-status[data-v-629034e8] {\n    gap: 0.5rem;\n    padding: 0.6rem;\n    flex-direction: column;\n}\n.status-item[data-v-629034e8] {\n    min-width: 80px;\n    flex: 1 1 100px;\n    width: 100%;\n    max-width: 100%;\n}\n.status-text[data-v-629034e8] {\n    font-size: 0.7rem;\n    min-width: 2.5rem;\n}\n.memory-card[data-v-629034e8] {\n    padding: 0.8rem;\n}\n.memory-content[data-v-629034e8] {\n    font-size: 0.8rem;\n}\n.memory-header[data-v-629034e8] {\n    flex-direction: column;\n    gap: 0.5rem;\n    align-items: flex-start;\n}\n.memory-type-badge[data-v-629034e8] {\n    align-self: flex-start;\n}\n.memory-time[data-v-629034e8] {\n    align-self: flex-end;\n    font-size: 0.7rem;\n}\n}\n@media (max-width: 480px) {\n.memory-center-panel[data-v-629034e8] {\n    gap: 0.5rem;\n}\n.filter-tabs[data-v-629034e8] {\n    gap: 0.2rem;\n}\n.filter-tab[data-v-629034e8] {\n    max-width: 100px;\n    font-size: 0.75rem;\n    padding: 0.4rem 0.6rem;\n}\n.memory-status[data-v-629034e8] {\n    padding: 0.5rem;\n}\n.status-item[data-v-629034e8] {\n    gap: 0.3rem;\n}\n.status-label[data-v-629034e8] {\n    font-size: 0.7rem;\n    min-width: 1.5rem;\n}\n.status-bar[data-v-629034e8] {\n    height: 4px;\n}\n.status-text[data-v-629034e8] {\n    font-size: 0.65rem;\n    min-width: 2rem;\n}\n.memory-card[data-v-629034e8] {\n    padding: 0.6rem;\n}\n.memory-content[data-v-629034e8] {\n    font-size: 0.75rem;\n}\n.memory-section-title[data-v-629034e8] {\n    font-size: 0.8rem;\n}\n.memory-item[data-v-629034e8] {\n    font-size: 0.75rem;\n    padding-left: 0.8rem;\n}\n}\n\n/* 分页控制样式 */\n.pagination-controls[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1.25rem;\n  padding: 1.25rem 1.5rem;\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.2);\n  border-radius: 12px;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n  backdrop-filter: blur(8px);\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);\n}\n.pagination-controls.bottom[data-v-629034e8] {\n  margin-top: 1.25rem;\n  margin-bottom: 0;\n}\n.pagination-info[data-v-629034e8] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.pagination-buttons[data-v-629034e8] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.page-btn[data-v-629034e8] {\n  background: var(--color-surface);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.4);\n  border-radius: 8px;\n  padding: 0.6rem 0.85rem;\n  cursor: pointer;\n  font-size: 1rem;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text);\n  min-width: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n.page-btn[data-v-629034e8]:hover:not(:disabled) {\n  background: var(--color-surface-light);\n  border-color: rgba(59, 130, 246, 0.5);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 10px rgba(59, 130, 246, 0.15);\n}\n.page-btn[data-v-629034e8]:disabled {\n  opacity: 0.35;\n  cursor: not-allowed;\n  filter: grayscale(0.3);\n}\n.pagination-jump[data-v-629034e8] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.jump-input[data-v-629034e8] {\n  width: 75px;\n  padding: 0.6rem 0.75rem;\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.4);\n  border-radius: 8px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  text-align: center;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n  font-weight: 500;\n}\n.jump-input[data-v-629034e8]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);\n}\n.jump-btn[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  padding: 0.6rem 1.25rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  font-weight: 600;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  white-space: nowrap;\n  box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);\n  letter-spacing: 0.3px;\n}\n.jump-btn[data-v-629034e8]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 14px rgba(59, 130, 246, 0.3);\n  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);\n}\n.vector-toolbar[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.vector-status[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n.status-subtext[data-v-629034e8] {\n  flex-basis: 100%;\n  margin-left: 1.5rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.status-subtext.warning[data-v-629034e8] {\n  color: var(--color-warning);\n}\n.embedding-api-selector[data-v-629034e8] {\n  flex-basis: 100%;\n  margin-left: 1.5rem;\n  margin-top: 0.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.selector-label[data-v-629034e8] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.api-select[data-v-629034e8] {\n  flex: 1;\n  padding: 0.4rem 0.6rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.api-select[data-v-629034e8]:hover {\n  border-color: var(--color-primary);\n}\n.api-select[data-v-629034e8]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.status-dot[data-v-629034e8] {\n  width: 10px;\n  height: 10px;\n  border-radius: 999px;\n  background: var(--color-warning);\n  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.15);\n}\n.status-dot.enabled[data-v-629034e8] {\n  background: var(--color-success);\n  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.15);\n}\n.vector-actions[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.vector-content[data-v-629034e8] {\n  padding: 1rem;\n}\n.vector-stats[data-v-629034e8] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.75rem 1rem;\n  margin-bottom: 0.75rem;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  background: var(--color-surface);\n}\n.stats-item[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: var(--color-text);\n}\n.stats-label[data-v-629034e8] {\n  opacity: 0.7;\n}\n.stats-value[data-v-629034e8] {\n  font-weight: 600;\n}\n.vector-list[data-v-629034e8] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-top: 0.75rem;\n}\n.vector-card[data-v-629034e8] {\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 0.75rem;\n  background: var(--color-surface);\n}\n.vector-card-header[data-v-629034e8] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.vector-badges[data-v-629034e8] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.vector-badge[data-v-629034e8] {\n  font-size: 0.8rem;\n  padding: 0.2rem 0.5rem;\n  border-radius: 999px;\n  background: rgba(var(--color-primary-rgb), 0.12);\n  color: var(--color-primary);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n}\n.vector-badge.secondary[data-v-629034e8] {\n  background: rgba(148, 163, 184, 0.12);\n  color: var(--color-text);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n}\n.vector-time[data-v-629034e8] {\n  font-size: 0.8rem;\n  opacity: 0.75;\n}\n.vector-tags[data-v-629034e8] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.35rem;\n  margin-bottom: 0.5rem;\n}\n.vector-tag[data-v-629034e8] {\n  font-size: 0.8rem;\n  padding: 0.15rem 0.45rem;\n  border-radius: 8px;\n  background: rgba(59, 130, 246, 0.12);\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  color: var(--color-text);\n}\n.vector-text[data-v-629034e8] {\n  white-space: pre-wrap;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n@media (max-width: 640px) {\n.pagination-controls[data-v-629034e8] {\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.pagination-info[data-v-629034e8] {\n    width: 100%;\n    text-align: center;\n}\n.pagination-buttons[data-v-629034e8] {\n    width: 100%;\n    justify-content: center;\n}\n.pagination-jump[data-v-629034e8] {\n    width: 100%;\n    justify-content: center;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .filter-tab[data-v-629034e8] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n  color: #475569;\n}\n[data-theme="light"] .filter-tab[data-v-629034e8]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.4);\n  color: #1e293b;\n}\n[data-theme="light"] .filter-tab.active[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: #3b82f6;\n  color: white;\n}\n[data-theme="light"] .settings-toggle-btn[data-v-629034e8] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n  color: #475569;\n}\n[data-theme="light"] .settings-toggle-btn[data-v-629034e8]:hover,\n[data-theme="light"] .settings-toggle-btn.active[data-v-629034e8] {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #2563eb;\n}\n[data-theme="light"] .memory-card[data-v-629034e8] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .memory-card[data-v-629034e8]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);\n}\n[data-theme="light"] .export-btn-main[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n}\n[data-theme="light"] .export-btn-main[data-v-629034e8]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n}\n\n/* ========== 深色主题适配 ========== */\n[data-theme="dark"] .filter-tab[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #cbd5e1;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n}\n[data-theme="dark"] .filter-tab[data-v-629034e8]:hover {\n  background: rgba(51, 65, 85, 0.95);\n  border-color: rgba(59, 130, 246, 0.5);\n  color: #f1f5f9;\n}\n[data-theme="dark"] .filter-tab.active[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: transparent;\n  color: white;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);\n}\n[data-theme="dark"] .filter-tab .tab-count[data-v-629034e8] {\n  background: rgba(59, 130, 246, 0.25);\n  color: #93c5fd;\n}\n[data-theme="dark"] .filter-tab.active .tab-count[data-v-629034e8] {\n  background: rgba(255, 255, 255, 0.2);\n  color: white;\n}\n[data-theme="dark"] .settings-toggle-btn[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #94a3b8;\n}\n[data-theme="dark"] .settings-toggle-btn[data-v-629034e8]:hover,\n[data-theme="dark"] .settings-toggle-btn.active[data-v-629034e8] {\n  background: rgba(59, 130, 246, 0.2);\n  border-color: #3b82f6;\n  color: #93c5fd;\n}\n[data-theme="dark"] .memory-card[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .memory-card[data-v-629034e8]:hover {\n  border-color: rgba(59, 130, 246, 0.4);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);\n}\n[data-theme="dark"] .export-section[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .export-btn-main[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n[data-theme="dark"] .export-btn-main[data-v-629034e8]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);\n}\n[data-theme="dark"] .pagination-controls[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .page-btn[data-v-629034e8] {\n  background: rgba(51, 65, 85, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #e2e8f0;\n}\n[data-theme="dark"] .page-btn[data-v-629034e8]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.2);\n  border-color: #3b82f6;\n}\n[data-theme="dark"] .jump-input[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #e2e8f0;\n}\n[data-theme="dark"] .jump-btn[data-v-629034e8] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n}\n[data-theme="dark"] .settings-section[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .settings-header[data-v-629034e8] {\n  border-bottom-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .vector-card[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .vector-stats[data-v-629034e8] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n',""]);const s=i},6416:e=>{"use strict";e.exports=JSON.parse('{"strength":[{"value":1,"description":"极度虚弱，难以自行站立或举起任何重物。"},{"value":2,"description":"无法进行任何体力劳动，勉强行走。"},{"value":3,"description":"体弱，提起5kg以上物品困难。"},{"value":4,"description":"力量低于常人，日常活动吃力。"},{"value":5,"description":"普通成年人水平。能提起50kg，进行常规体力劳动。"},{"value":6,"description":"略强于常人，能提起60kg左右。"},{"value":7,"description":"体力劳动者水平。能轻松提起70-80kg，力量明显。"},{"value":8,"description":"强健，能提起90-100kg，可进行重体力劳动。"},{"value":9,"description":"接近人类极限，能提起120kg以上。"},{"value":10,"description":"人类极限巅峰。奥运举重冠军水平，能提起200kg以上。"},{"value":11,"description":"超凡入门边缘，能提起300kg左右。"},{"value":12,"description":"超凡入门。能短暂掀翻小型汽车（约1.5吨）。"},{"value":13,"description":"超凡入门中段，能举起2吨重物。"},{"value":14,"description":"超凡入门上段，能举起3.5吨。"},{"value":15,"description":"超凡中坚。能举起5吨重物，拳力可击碎混凝土墙。"},{"value":16,"description":"超凡中坚中段，能举起8吨。"},{"value":17,"description":"超凡中坚上段，能举起12吨。"},{"value":18,"description":"超凡巅峰。能举起20吨，可掀翻公交车。"},{"value":19,"description":"超凡巅峰中段，能举起30吨，可破坏小型建筑。"},{"value":20,"description":"凡人顶点。一击可破坏小型建筑，力量开始触及规则边缘。"},{"value":21,"description":"超越凡人，力量开始显现概念性特征。"},{"value":22,"description":"霸主级边缘，可轻易摧毁三层建筑。"},{"value":23,"description":"霸主级初级，力量附有‘破甲’规则。"},{"value":24,"description":"霸主级中坚，可举起百吨级物体。"},{"value":25,"description":"霸主级（B级）。概念性力量体现，如‘必中’、‘破甲’规则加持。"},{"value":26,"description":"霸主级巅峰，力量可影响局部地形。"},{"value":27,"description":"天灾级边缘，一拳可引发小范围地震。"},{"value":28,"description":"天灾级初级，力量可永久改变街区地形。"},{"value":29,"description":"天灾级中坚，可制造千米级裂缝。"},{"value":30,"description":"天灾级（A级）。力量本身成为规则，可永久改变局部地形。"},{"value":31,"description":"天灾级巅峰，力量可影响山脉结构。"},{"value":32,"description":"神灾级边缘，一击可摧毁城市。"},{"value":33,"description":"神灾级初级，力量可引发板块震动。"},{"value":34,"description":"神灾级中坚，可重塑大陆板块。"},{"value":35,"description":"神灾级（S级）。大陆板块尺度干涉力，力量数值已无法用传统物理衡量。"}],"agility":[{"value":1,"description":"严重协调障碍，行动笨拙迟缓，容易绊倒。"},{"value":2,"description":"无法快速移动，精细操作完全不行。"},{"value":3,"description":"行动慢于常人，手眼协调较差。"},{"value":4,"description":"反应略慢，简单操作尚可。"},{"value":5,"description":"普通成年人水平。正常手眼协调，反应时间0.2-0.25秒。"},{"value":6,"description":"反应稍快，能完成一些需要协调的运动。"},{"value":7,"description":"身手灵活。反应较快，能胜任驾驶、运动等需要协调的活动。"},{"value":8,"description":"身手敏捷，能躲避普通投掷物。"},{"value":9,"description":"反应速度接近人类极限，手眼协调极佳。"},{"value":10,"description":"人类极限巅峰。顶尖武术家或战斗机飞行员反应水平（0.1秒）。"},{"value":11,"description":"超凡入门边缘，反应时间0.09秒，动作开始有残影。"},{"value":12,"description":"超凡入门。动作快至出现残影，能躲避弓箭。"},{"value":13,"description":"超凡入门中段，能躲避低速枪械子弹。"},{"value":14,"description":"超凡入门上段，反应时间0.05秒。"},{"value":15,"description":"超凡中坚。反应时间0.04秒，速度达25m/s（百米4秒）。"},{"value":16,"description":"超凡中坚中段，速度达30m/s。"},{"value":17,"description":"超凡中坚上段，速度达35m/s。"},{"value":18,"description":"超凡巅峰。视觉难以捕捉其动作。"},{"value":19,"description":"超凡巅峰中段，速度达45m/s。"},{"value":20,"description":"凡人顶点。反应时间0.01秒，速度达50m/s（百米2秒）。"},{"value":21,"description":"超越凡人，速度开始突破音障。"},{"value":22,"description":"霸主级边缘，速度达80m/s。"},{"value":23,"description":"霸主级初级，可进行亚音速移动。"},{"value":24,"description":"霸主级中坚，反应时间0.005秒。"},{"value":25,"description":"霸主级（B级）。亚音速移动，反应时间达0.002秒。"},{"value":26,"description":"霸主级巅峰，速度达200m/s。"},{"value":27,"description":"天灾级边缘，可短暂超音速。"},{"value":28,"description":"天灾级初级，超音速移动。"},{"value":29,"description":"天灾级中坚，速度达2倍音速。"},{"value":30,"description":"天灾级（A级）。超音速移动（3.7倍音速），反应时间0.0004秒。"},{"value":31,"description":"天灾级巅峰，速度达5倍音速。"},{"value":32,"description":"神灾级边缘，可瞬间出现在视野内任何位置。"},{"value":33,"description":"神灾级初级，速度概念模糊，可短距瞬移。"},{"value":34,"description":"神灾级中坚，可在区域内任意穿梭。"},{"value":35,"description":"神灾级（S级）。速度本身成为规则现象，如‘瞬时出现在视野内任何位置’。"}],"constitution":[{"value":1,"description":"濒死状态，任何感染或轻微伤害都可能致命。"},{"value":2,"description":"极其脆弱，日常活动即可能受伤。"},{"value":3,"description":"体弱多病，恢复能力差，容易疲劳。"},{"value":4,"description":"体质略差，偶尔生病。"},{"value":5,"description":"普通成年人水平。健康基线，偶有小病，深伤口需4-6周恢复。"},{"value":6,"description":"体质良好，较少生病，恢复速度正常。"},{"value":7,"description":"身体健壮。很少生病，恢复较快。"},{"value":8,"description":"非常健壮，能抵抗一般疾病。"},{"value":9,"description":"接近人类极限，耐力极佳。"},{"value":10,"description":"人类极限巅峰。铁人般的耐力，重伤恢复时间减半。"},{"value":11,"description":"超凡入门边缘，对普通毒素有抗性。"},{"value":12,"description":"超凡入门。可抵抗普通毒素，轻伤数小时内止血结痂。"},{"value":13,"description":"超凡入门中段，伤口愈合速度加倍。"},{"value":14,"description":"超凡入门上段，对多数疾病免疫。"},{"value":15,"description":"超凡中坚。非致命伤3-5天恢复，对多数疾病免疫。"},{"value":16,"description":"超凡中坚中段，可抵抗弱辐射。"},{"value":17,"description":"超凡中坚上段，断肢可缓慢再生。"},{"value":18,"description":"超凡巅峰。可快速自愈轻伤，断肢可缓慢再生。"},{"value":19,"description":"超凡巅峰中段，断肢再生加速。"},{"value":20,"description":"凡人顶点。致命伤也能缓慢复原，恢复力开始触及规则。"},{"value":21,"description":"超越凡人，恢复力概念化。"},{"value":22,"description":"霸主级边缘，可吸收伤害转化为能量。"},{"value":23,"description":"霸主级初级，拥有‘伤害转移’能力。"},{"value":24,"description":"霸主级中坚，可吸收致命攻击。"},{"value":25,"description":"霸主级（B级）。概念性恢复，如‘伤害转移’、‘生命吸收’。"},{"value":26,"description":"霸主级巅峰，除非规则级攻击，否则无法杀死。"},{"value":27,"description":"天灾级边缘，存在开始锚定于规则。"},{"value":28,"description":"天灾级初级，需破坏规则锚点才能杀死。"},{"value":29,"description":"天灾级中坚，常规概念死亡不适用。"},{"value":30,"description":"天灾级（A级）。规则级存在稳定性，除非摧毁其规则锚点，否则无法杀死。"},{"value":31,"description":"天灾级巅峰，存在与领域绑定。"},{"value":32,"description":"神灾级边缘，存在本身即为规则。"},{"value":33,"description":"神灾级初级，可无视物理伤害。"},{"value":34,"description":"神灾级中坚，概念性不朽。"},{"value":35,"description":"神灾级（S级）。存在本身即为规则，常规‘死亡’概念不适用。"}],"willpower":[{"value":1,"description":"彻底崩溃，无法形成连贯意识或自主决定。"},{"value":2,"description":"意识模糊，极易受外界影响。"},{"value":3,"description":"意志薄弱，极易受惊吓、暗示和欺骗。"},{"value":4,"description":"意志力低于常人，遇事易慌乱。"},{"value":5,"description":"普通成年人水平。有一定抗压能力，能在轻度恐怖下保持行动。"},{"value":6,"description":"意志力较强，能承受一般压力。"},{"value":7,"description":"意志坚定。能承受较大压力，如灾难中的救援人员。"},{"value":8,"description":"意志顽强，能抵抗中度精神干扰。"},{"value":9,"description":"意志力接近人类极限，可在极端环境下保持冷静。"},{"value":10,"description":"人类极限巅峰。能在酷刑或绝对绝境中坚守信念。"},{"value":11,"description":"超凡入门边缘，可短暂抵抗精神污染。"},{"value":12,"description":"超凡入门。可短暂抵抗低阶精神污染。"},{"value":13,"description":"超凡入门中段，可抵抗E级异常地带的精神影响。"},{"value":14,"description":"超凡入门上段，可在轻度精神污染中保持清醒数小时。"},{"value":15,"description":"超凡中坚。可在C级精神污染环境中保持理智数小时。"},{"value":16,"description":"超凡中坚中段，可抵抗D级精神攻击。"},{"value":17,"description":"超凡中坚上段，精神开始影响现实。"},{"value":18,"description":"超凡巅峰。精神近乎不可动摇，可影响他人心智。"},{"value":19,"description":"超凡巅峰中段，可短暂抵抗B级概念污染。"},{"value":20,"description":"凡人顶点。意志开始干涉现实，可抵抗B级概念污染。"},{"value":21,"description":"超越凡人，意志开始形成规则雏形。"},{"value":22,"description":"霸主级边缘，拥有‘恐惧光环’能力。"},{"value":23,"description":"霸主级初级，可下达‘绝对命令’影响他人。"},{"value":24,"description":"霸主级中坚，意志可扭曲局部现实。"},{"value":25,"description":"霸主级（B级）。意志成为概念，如‘绝对命令’、‘恐惧光环’。"},{"value":26,"description":"霸主级巅峰，意志可创造小型领域。"},{"value":27,"description":"天灾级边缘，意志开始定义领域内规则。"},{"value":28,"description":"天灾级初级，意志可永久改变环境。"},{"value":29,"description":"天灾级中坚，可定义领域内的‘理智’概念。"},{"value":30,"description":"天灾级（A级）。意志即是领域规则，可定义领域内的‘理智’概念。"},{"value":31,"description":"天灾级巅峰，意志可影响全球性精神现象。"},{"value":32,"description":"神灾级边缘，意志成为世界参数。"},{"value":33,"description":"神灾级初级，可短暂改写群体认知。"},{"value":34,"description":"神灾级中坚，意志即世界法则。"},{"value":35,"description":"神灾级（S级）。意志成为世界参数，影响全球性精神现象。"}],"charisma":[{"value":1,"description":"存在感稀薄或令人本能排斥，难以进行任何有效交流。"},{"value":2,"description":"令人不适，沟通极度困难。"},{"value":3,"description":"社交障碍，沟通困难，常被忽视或误解。"},{"value":4,"description":"不太受欢迎，但可勉强交流。"},{"value":5,"description":"普通成年人水平。具备基本社交能力，能进行正常沟通。"},{"value":6,"description":"略受欢迎，容易与他人建立初步联系。"},{"value":7,"description":"有亲和力。能给人留下较好印象，适合团队协作。"},{"value":8,"description":"魅力出众，容易获得他人好感。"},{"value":9,"description":"极具个人魅力，能吸引小团体追随。"},{"value":10,"description":"明星级魅力。极具吸引力与说服力，能轻易引导小群体（百人级）。"},{"value":11,"description":"超凡魅力边缘，情绪轻微感染他人。"},{"value":12,"description":"超凡魅力。情绪能轻微感染周围人群，领导力出众。"},{"value":13,"description":"超凡魅力中段，能影响千人级团体。"},{"value":14,"description":"超凡魅力上段，一次演讲能鼓舞人心。"},{"value":15,"description":"超凡中坚。影响力可达万人级，一次演讲能点燃运动。"},{"value":16,"description":"超凡中坚中段，魅力可影响动物行为。"},{"value":17,"description":"超凡中坚上段，可短暂扭曲他人认知。"},{"value":18,"description":"超凡巅峰。魅力可影响非智慧生物或扭曲他人认知。"},{"value":19,"description":"超凡巅峰中段，一个眼神可令常人臣服。"},{"value":20,"description":"凡人顶点。一个眼神能令弱者臣服，影响力触及规则边缘。"},{"value":21,"description":"超越凡人，魅力开始概念化。"},{"value":22,"description":"霸主级边缘，拥有‘群体狂热’光环。"},{"value":23,"description":"霸主级初级，可施加‘绝对忠诚’效果。"},{"value":24,"description":"霸主级中坚，魅力可创造小型领域。"},{"value":25,"description":"霸主级（B级）。规则级影响力，如‘绝对忠诚’、‘群体狂热’领域。"},{"value":26,"description":"霸主级巅峰，进入其领域者会被轻微改变认知。"},{"value":27,"description":"天灾级边缘，魅力开始永久改变他人心智。"},{"value":28,"description":"天灾级初级，进入领域者会被永久改变认知。"},{"value":29,"description":"天灾级中坚，魅力成为环境规则。"},{"value":30,"description":"天灾级（A级）。魅力成为环境规则，进入其领域者会被永久改变认知。"},{"value":31,"description":"天灾级巅峰，其名即是恐惧。"},{"value":32,"description":"神灾级边缘，存在成为文明记忆。"},{"value":33,"description":"神灾级初级，提及即被影响。"},{"value":34,"description":"神灾级中坚，其名即是概念。"},{"value":35,"description":"神灾级（S级）。存在本身成为文明级记忆烙印，其名即是概念。"}],"luck":[{"value":1,"description":"天煞孤星，灾难如影随形，小概率坏事必然发生。"},{"value":2,"description":"霉运缠身，经常遭遇意外。"},{"value":3,"description":"倒霉蛋，经常遭遇小麻烦和意外。"},{"value":4,"description":"运气略差，偶尔不走运。"},{"value":5,"description":"普通人水平。运气好坏参半，符合统计规律。"},{"value":6,"description":"偶尔走运，能遇到小惊喜。"},{"value":7,"description":"运气稍好。偶尔有惊喜，危难中可能有一线生机。"},{"value":8,"description":"比较幸运，常能避开小灾祸。"},{"value":9,"description":"幸运儿，常有巧合相助。"},{"value":10,"description":"幸运儿。常有巧合相助，逢凶化吉概率达10%。"},{"value":11,"description":"超凡幸运边缘，可偶尔主动触发好运。"},{"value":12,"description":"超凡幸运。小范围内‘好运’可被偶尔主动触发。"},{"value":13,"description":"超凡幸运中段，可改变小概率事件。"},{"value":14,"description":"超凡幸运上段，逢凶化吉概率15%。"},{"value":15,"description":"超凡中坚。绝境逢生概率达25%，稀有发现率显著提升。"},{"value":16,"description":"超凡中坚中段，可避开多数致命危险。"},{"value":17,"description":"超凡中坚上段，幸运开始影响周围人。"},{"value":18,"description":"超凡巅峰。命运仿佛一次性的偏爱，关键时刻常化险为夷。"},{"value":19,"description":"超凡巅峰中段，可主动触发小范围好运。"},{"value":20,"description":"凡人顶点。幸运开始扭曲局部概率，成为可观测现象。"},{"value":21,"description":"超越凡人，幸运开始概念化。"},{"value":22,"description":"霸主级边缘，可偏斜单一事件的概率。"},{"value":23,"description":"霸主级初级，可定义小范围‘必然’。"},{"value":24,"description":"霸主级中坚，可定义小范围‘不可能’。"},{"value":25,"description":"霸主级（B级）。可主动偏斜局部概率，定义小范围‘必然’或‘不可能’。"},{"value":26,"description":"霸主级巅峰，幸运可影响团队。"},{"value":27,"description":"天灾级边缘，可创造有利条件。"},{"value":28,"description":"天灾级初级，领域内友方总能找到弱点。"},{"value":29,"description":"天灾级中坚，可改变因果链。"},{"value":30,"description":"天灾级（A级）。幸运成为领域规则，如‘领域内友方总能找到弱点’。"},{"value":31,"description":"天灾级巅峰，可短暂修改因果。"},{"value":32,"description":"神灾级边缘，命运编织者。"},{"value":33,"description":"神灾级初级，可修改小范围因果链。"},{"value":34,"description":"神灾级中坚，运气本身即是规则。"},{"value":35,"description":"神灾级（S级）。命运编织者，可短暂修改因果链，运气本身即是规则。"}]}')},6494:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6533:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.loading-overlay[data-v-c8648b8a] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.7);\n  backdrop-filter: blur(5px);\n  -webkit-backdrop-filter: blur(5px);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 10000;\n}\n.loading-content[data-v-c8648b8a] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n}\n.spinner[data-v-c8648b8a] {\n  width: 50px;\n  height: 50px;\n  border: 5px solid rgba(var(--color-primary-rgb), 0.3);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-c8648b8a 1.2s linear infinite;\n}\n@keyframes spin-c8648b8a {\nto {\n    transform: rotate(360deg);\n}\n}\n.loading-text[data-v-c8648b8a] {\n  color: var(--color-accent);\n  font-size: 1.2rem;\n  font-weight: 500;\n  text-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.5);\n}\n.fade-enter-active[data-v-c8648b8a],\n.fade-leave-active[data-v-c8648b8a] {\n  transition: opacity 0.3s ease;\n}\n.fade-enter-from[data-v-c8648b8a],\n.fade-leave-to[data-v-c8648b8a] {\n  opacity: 0;\n}\n",""]);const s=i},6549:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},6556:(e,n,t)=>{"use strict";var a=t(453),r=t(3126),o=r([a("%String.prototype.indexOf%")]);e.exports=function(e,n){var t=a(e,!!n);return"function"==typeof t&&o(e,".prototype.")>-1?r([t]):t}},6570:e=>{"use strict";function n(e,n,a){a=a||2;var o,i,s,l,u,p,f,h=n&&n.length,m=h?n[0]*a:e.length,g=t(e,0,m,a,!0),b=[];if(!g||g.next===g.prev)return b;if(h&&(g=function(e,n,a,r){var o,i,s,l=[];for(o=0,i=n.length;o<i;o++)(s=t(e,n[o]*r,o<i-1?n[o+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),l.push(v(s));for(l.sort(c),o=0;o<l.length;o++)a=d(l[o],a);return a}(e,n,g,a)),e.length>80*a){o=s=e[0],i=l=e[1];for(var y=a;y<m;y+=a)(u=e[y])<o&&(o=u),(p=e[y+1])<i&&(i=p),u>s&&(s=u),p>l&&(l=p);f=0!==(f=Math.max(s-o,l-i))?32767/f:0}return r(g,b,a,o,i,f,0),b}function t(e,n,t,a,r){var o,i;if(r===S(e,n,t,a)>0)for(o=n;o<t;o+=a)i=_(o,e[o],e[o+1],i);else for(o=t-a;o>=n;o-=a)i=_(o,e[o],e[o+1],i);return i&&g(i,i.next)&&(C(i),i=i.next),i}function a(e,n){if(!e)return e;n||(n=e);var t,a=e;do{if(t=!1,a.steiner||!g(a,a.next)&&0!==m(a.prev,a,a.next))a=a.next;else{if(C(a),(a=n=a.prev)===a.next)break;t=!0}}while(t||a!==n);return n}function r(e,n,t,c,d,u,v){if(e){!v&&u&&function(e,n,t,a){var r=e;do{0===r.z&&(r.z=p(r.x,r.y,n,t,a)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var n,t,a,r,o,i,s,l,c=1;do{for(t=e,e=null,o=null,i=0;t;){for(i++,a=t,s=0,n=0;n<c&&(s++,a=a.nextZ);n++);for(l=c;s>0||l>0&&a;)0!==s&&(0===l||!a||t.z<=a.z)?(r=t,t=t.nextZ,s--):(r=a,a=a.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;t=a}o.nextZ=null,c*=2}while(i>1)}(r)}(e,c,d,u);for(var f,h,m=e;e.prev!==e.next;)if(f=e.prev,h=e.next,u?i(e,c,d,u):o(e))n.push(f.i/t|0),n.push(e.i/t|0),n.push(h.i/t|0),C(e),e=h.next,m=h.next;else if((e=h)===m){v?1===v?r(e=s(a(e),n,t),n,t,c,d,u,2):2===v&&l(e,n,t,c,d,u):r(a(e),n,t,c,d,u,1);break}}}function o(e){var n=e.prev,t=e,a=e.next;if(m(n,t,a)>=0)return!1;for(var r=n.x,o=t.x,i=a.x,s=n.y,l=t.y,c=a.y,d=r<o?r<i?r:i:o<i?o:i,u=s<l?s<c?s:c:l<c?l:c,p=r>o?r>i?r:i:o>i?o:i,v=s>l?s>c?s:c:l>c?l:c,h=a.next;h!==n;){if(h.x>=d&&h.x<=p&&h.y>=u&&h.y<=v&&f(r,s,o,l,i,c,h.x,h.y)&&m(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function i(e,n,t,a){var r=e.prev,o=e,i=e.next;if(m(r,o,i)>=0)return!1;for(var s=r.x,l=o.x,c=i.x,d=r.y,u=o.y,v=i.y,h=s<l?s<c?s:c:l<c?l:c,g=d<u?d<v?d:v:u<v?u:v,b=s>l?s>c?s:c:l>c?l:c,y=d>u?d>v?d:v:u>v?u:v,x=p(h,g,n,t,a),k=p(b,y,n,t,a),w=e.prevZ,_=e.nextZ;w&&w.z>=x&&_&&_.z<=k;){if(w.x>=h&&w.x<=b&&w.y>=g&&w.y<=y&&w!==r&&w!==i&&f(s,d,l,u,c,v,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,_.x>=h&&_.x<=b&&_.y>=g&&_.y<=y&&_!==r&&_!==i&&f(s,d,l,u,c,v,_.x,_.y)&&m(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;w&&w.z>=x;){if(w.x>=h&&w.x<=b&&w.y>=g&&w.y<=y&&w!==r&&w!==i&&f(s,d,l,u,c,v,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;_&&_.z<=k;){if(_.x>=h&&_.x<=b&&_.y>=g&&_.y<=y&&_!==r&&_!==i&&f(s,d,l,u,c,v,_.x,_.y)&&m(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function s(e,n,t){var r=e;do{var o=r.prev,i=r.next.next;!g(o,i)&&b(o,r,r.next,i)&&k(o,i)&&k(i,o)&&(n.push(o.i/t|0),n.push(r.i/t|0),n.push(i.i/t|0),C(r),C(r.next),r=e=i),r=r.next}while(r!==e);return a(r)}function l(e,n,t,o,i,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&h(l,c)){var d=w(l,c);return l=a(l,l.next),d=a(d,d.next),r(l,n,t,o,i,s,0),void r(d,n,t,o,i,s,0)}c=c.next}l=l.next}while(l!==e)}function c(e,n){return e.x-n.x}function d(e,n){var t=function(e,n){var t,a=n,r=e.x,o=e.y,i=-1/0;do{if(o<=a.y&&o>=a.next.y&&a.next.y!==a.y){var s=a.x+(o-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(s<=r&&s>i&&(i=s,t=a.x<a.next.x?a:a.next,s===r))return t}a=a.next}while(a!==n);if(!t)return null;var l,c=t,d=t.x,p=t.y,v=1/0;a=t;do{r>=a.x&&a.x>=d&&r!==a.x&&f(o<p?r:i,o,d,p,o<p?i:r,o,a.x,a.y)&&(l=Math.abs(o-a.y)/(r-a.x),k(a,e)&&(l<v||l===v&&(a.x>t.x||a.x===t.x&&u(t,a)))&&(t=a,v=l)),a=a.next}while(a!==c);return t}(e,n);if(!t)return n;var r=w(t,e);return a(r,r.next),a(t,t.next)}function u(e,n){return m(e.prev,e,n.prev)<0&&m(n.next,e,e.next)<0}function p(e,n,t,a,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-t)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-a)*r|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function v(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function f(e,n,t,a,r,o,i,s){return(r-i)*(n-s)>=(e-i)*(o-s)&&(e-i)*(a-s)>=(t-i)*(n-s)&&(t-i)*(o-s)>=(r-i)*(a-s)}function h(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&b(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&(k(e,n)&&k(n,e)&&function(e,n){var t=e,a=!1,r=(e.x+n.x)/2,o=(e.y+n.y)/2;do{t.y>o!=t.next.y>o&&t.next.y!==t.y&&r<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(a=!a),t=t.next}while(t!==e);return a}(e,n)&&(m(e.prev,e,n.prev)||m(e,n.prev,n))||g(e,n)&&m(e.prev,e,e.next)>0&&m(n.prev,n,n.next)>0)}function m(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function g(e,n){return e.x===n.x&&e.y===n.y}function b(e,n,t,a){var r=x(m(e,n,t)),o=x(m(e,n,a)),i=x(m(t,a,e)),s=x(m(t,a,n));return r!==o&&i!==s||!(0!==r||!y(e,t,n))||!(0!==o||!y(e,a,n))||!(0!==i||!y(t,e,a))||!(0!==s||!y(t,n,a))}function y(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function x(e){return e>0?1:e<0?-1:0}function k(e,n){return m(e.prev,e,e.next)<0?m(e,n,e.next)>=0&&m(e,e.prev,n)>=0:m(e,n,e.prev)<0||m(e,e.next,n)<0}function w(e,n){var t=new A(e.i,e.x,e.y),a=new A(n.i,n.x,n.y),r=e.next,o=n.prev;return e.next=n,n.prev=e,t.next=r,r.prev=t,a.next=t,t.prev=a,o.next=a,a.prev=o,a}function _(e,n,t,a){var r=new A(e,n,t);return a?(r.next=a.next,r.prev=a,a.next.prev=r,a.next=r):(r.prev=r,r.next=r),r}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,n,t,a){for(var r=0,o=n,i=t-a;o<t;o+=a)r+=(e[i]-e[o])*(e[o+1]+e[i+1]),i=o;return r}e.exports=n,e.exports.default=n,n.deviation=function(e,n,t,a){var r=n&&n.length,o=r?n[0]*t:e.length,i=Math.abs(S(e,0,o,t));if(r)for(var s=0,l=n.length;s<l;s++){var c=n[s]*t,d=s<l-1?n[s+1]*t:e.length;i-=Math.abs(S(e,c,d,t))}var u=0;for(s=0;s<a.length;s+=3){var p=a[s]*t,v=a[s+1]*t,f=a[s+2]*t;u+=Math.abs((e[p]-e[f])*(e[v+1]-e[p+1])-(e[p]-e[v])*(e[f+1]-e[p+1]))}return 0===i&&0===u?0:Math.abs((u-i)/i)},n.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},a=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var i=0;i<n;i++)t.vertices.push(e[r][o][i]);r>0&&(a+=e[r-1].length,t.holes.push(a))}return t}},6585:(e,n,t)=>{"use strict";function a(){try{const e=localStorage.getItem("dad_game_settings");if(e){const n=JSON.parse(e);return{nsfwMode:void 0===n.enableNsfwMode||n.enableNsfwMode,nsfwGenderFilter:n.nsfwGenderFilter||"female",privacyGenerationMode:n.privacyGenerationMode||"fallback"}}}catch{}return{nsfwMode:!0,nsfwGenderFilter:"female",privacyGenerationMode:"fallback"}}function r(e){const n=e&&"object"==typeof e?e:{},{nsfwMode:t,nsfwGenderFilter:r}=a();return void 0===n.nsfwMode&&(n.nsfwMode=t),void 0===n.nsfwGenderFilter&&(n.nsfwGenderFilter=r),n}function o(e){if(!e||"object"!=typeof e)return e;const n=e;n["ϵͳ"]&&!n["系统"]&&(n["系统"]=n["ϵͳ"],delete n["ϵͳ"]);const t=n["系统"]&&"object"==typeof n["系统"]?n["系统"]:{};if(t["配置"]=r(t["配置"]),n["系统"]=t,t["配置"]?.nsfwMode){const e=n["角色"]&&"object"==typeof n["角色"]?n["角色"]:{},t=e["身体"]&&"object"==typeof e["身体"]?e["身体"]:{};void 0===t["部位开发"]&&(t["部位开发"]={}),void 0===t["部位"]&&(t["部位"]={}),e["身体"]=t,n["角色"]=e}return n}function i(e,n){return e[Math.floor(n()*e.length)]}function s(e,n,t){return Math.max(n,Math.min(t,Math.round(e)))}function l(e){const n=e;if(!n||"object"!=typeof n)return!0;const t=e=>"string"!=typeof e||""===e.trim(),a=e=>!Array.isArray(e)||0===e.length;return[t(n.性格倾向),t(n.性取向),t(n.当前性状态),t(n.体液分泌状态),t(n.性经验等级),t(n.亲密节奏),t(n.亲密需求),t(n.安全偏好),t(n.避孕措施),t(n.最近一次性行为时间),a(n.性癖好),a(n.性伴侣名单),a(n.亲密偏好),a(n.禁忌清单),!n.三围||"number"!=typeof n.三围?.胸围,!n.身体部位||Array.isArray(n.身体部位)&&0===n.身体部位.length].every(Boolean)}function c(e){const n=String(e?.名字??"NPC"),t=function(e){if("string"!=typeof e)return"其他";const n=e.trim();return n?"男"===n||"male"===n.toLowerCase()||n.includes("男")?"男":"女"===n||"female"===n.toLowerCase()||n.includes("女")?"女":"其他":"其他"}(e?.性别),a=function(e){let n=e>>>0;return()=>(n=1664525*n+1013904223>>>0,(65535&n)/65535)}(function(e){let n=2166136261;for(let t=0;t<e.length;t++)n^=e.charCodeAt(t),n=Math.imul(n,16777619);return n>>>0}(n+":"+(e?.出生日期?`${e.出生日期.年}-${e.出生日期.月}-${e.出生日期.日}`:"unknown"))),r="女"===t,o=r?["避孕套","口服避孕","无","安全期"]:["避孕套","无"],l=r?s(78+18*a(),75,96):s(85+10*a(),82,95),c=r?s(58+12*a(),55,74):s(75+12*a(),68,90),d=r?s(84+16*a(),80,102):s(92+12*a(),85,105),u=[{部位名称:"胸部",敏感度:s(40+40*a(),20,90),开发度:s(20+40*a(),0,70),特征描述:r?"柔和":"结实"},{部位名称:"嘴唇",敏感度:s(50+30*a(),20,95),开发度:s(30+30*a(),0,70),特征描述:"细致",反应描述:"喜欢温柔的接触"}];return r&&u.push({部位名称:"小穴",敏感度:s(60+30*a(),40,95),开发度:s(10+20*a(),0,40),特征描述:"敏感",反应描述:"需要信任与安全感"}),{是否为处女:!0,三围:{胸围:l,腰围:c,臀围:d},身体部位:u,性格倾向:i(["理性","温柔","冷静","谨慎","果断","沉静","外向","内向"],a),性取向:i(["异性","双性","未明确","无"],a),性癖好:[i(["亲吻","拥抱","温柔交流"],a)],性渴望程度:s(30*a(),0,100),当前性状态:"平静",体液分泌状态:"正常",性交总次数:0,性伴侣名单:[],最近一次性行为时间:"无",特殊体质:[],性经验等级:"无经验",亲密偏好:[i(["亲吻","拥抱","牵手","轻抚","耳语交流"],a)],亲密节奏:i(["慢热","温和","随性","克制"],a),亲密需求:i(["安全感与尊重","交流与信任","温柔的陪伴","明确的边界"],a),禁忌清单:[i(["强迫行为","侵犯边界","公共场合","过度粗暴"],a)],安全偏好:i(["确立边界、尊重意愿","先沟通后亲密","公开透明的关系","稳定的节奏"],a),避孕措施:i(o,a),生育状态:"女"===t?{是否可孕:!0,当前状态:"未怀孕"}:{是否可孕:!1,当前状态:"不具备"}}}t.d(n,{Md:()=>r,fR:()=>c,j7:()=>l,kL:()=>o,rW:()=>a})},6588:(e,n,t)=>{"use strict";t.d(n,{repairSaveData:()=>s});var a=t(2543),r=t(4530),o=t(6988),i=t(1267);function s(e){console.log("[数据修复] 开始修复存档数据");try{if(!e||"object"!=typeof e)return console.error("[数据修复] ❌ 存档数据为空或无效，创建默认存档"),v();const t=(0,r.ru)(e)?e:(0,r.jj)(e).migrated,s=(0,a.cloneDeep)(t),f=(0,o.$)(s);if(!f.isValid)return console.warn("[数据修复] ⚠️ 存档结构不合格，使用最小V3模板兜底:",f.errors),v();if(s.元数据=s.元数据&&"object"==typeof s.元数据?s.元数据:v().元数据,s.元数据.版本号=3,s.元数据.存档ID=s.元数据.存档ID||`save_${Date.now()}`,s.元数据.存档名=s.元数据.存档名||"自动存档",s.元数据.创建时间=s.元数据.创建时间||(new Date).toISOString(),s.元数据.更新时间=(new Date).toISOString(),s.元数据.游戏时长秒=p(s.元数据.游戏时长秒,0,999999999,0),s.元数据.时间=(n=s.元数据.时间)&&"object"==typeof n?{年:p(n.年,1,999999,1e3),月:p(n.月,1,12,1),日:p(n.日,1,30,1),小时:p(n.小时,0,23,8),分钟:p(n.分钟,0,59,0)}:{年:1e3,月:1,日:1,小时:8,分钟:0},s.角色=s.角色&&"object"==typeof s.角色?s.角色:v().角色,s.角色.身份=s.角色.身份&&"object"==typeof s.角色.身份?s.角色.身份:v().角色.身份,s.角色.身份.名字=s.角色.身份.名字||"无名修士",s.角色.身份.性别=s.角色.身份.性别||"男",s.角色.身份.出生日期||(s.角色.身份.出生日期={年:982,月:1,日:1}),s.角色.身份.先天属性&&"object"==typeof s.角色.身份.先天属性){const e=s.角色.身份.先天属性;e.力量=p(e.力量,0,35,5),e.体质=p(e.体质,0,35,5),e.敏捷=p(e.敏捷,0,35,5),e.意志=p(e.意志,0,35,5),e.魅力=p(e.魅力,0,35,5),e.幸运=p(e.幸运,0,35,5)}else s.角色.身份.先天属性={力量:5,体质:5,敏捷:5,意志:5,魅力:5,幸运:5};s.角色.身份.后天属性&&"object"==typeof s.角色.身份.后天属性||(s.角色.身份.后天属性={力量:0,体质:0,敏捷:0,意志:0,魅力:0,幸运:0}),s.角色.属性&&"object"==typeof s.角色.属性?(s.角色.身份.觉醒阶段=function(e){if(!e||"object"!=typeof e)return{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"引气入体，感悟天地灵气，踏上修仙第一步"};const n=e.名称||"凡人",t=void 0!==e.阶段?e.阶段:"";return{名称:n,阶段:t,当前进度:p(e.当前进度,0,999999999,0),下一级所需:p(e.下一级所需,1,999999999,100),突破描述:e.突破描述||l(n,t)}}(s.角色.身份.觉醒阶段),s.角色.属性.生命=c(s.角色.属性.生命,100,100),s.角色.属性.能量=c(s.角色.属性.能量,50,50),s.角色.属性.精神=c(s.角色.属性.精神,30,30),s.角色.属性.寿命=c(s.角色.属性.寿命,18,80),s.角色.属性.声望=p(s.角色.属性.声望,0,999999,0)):(console.warn("[数据修复] 属性缺失，创建默认值"),s.角色.属性={觉醒阶段:{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"吸收微量辐射，激活休眠基因，踏上进化第一步"},声望:0,生命:{当前:100,上限:100},能量:{当前:50,上限:50},精神:{当前:30,上限:30},寿命:{当前:18,上限:80}}),s.角色.位置&&"object"==typeof s.角色.位置?s.角色.位置.描述||(s.角色.位置.描述="朝天大陆·无名之地"):s.角色.位置={描述:"朝天大陆·无名之地",x:5e3,y:5e3},Array.isArray(s.角色.效果)||(s.角色.效果=[]);const h={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null};s.角色.装备&&"object"==typeof s.角色.装备||(s.角色.装备={...h});for(let e=1;e<=6;e++){const n=`装备${e}`,t=s.角色.装备[n];s.角色.装备[n]=null==t?null:"string"==typeof t?t:"object"==typeof t&&null!==t&&"物品ID"in t?String(t.物品ID||""):null}if(s.角色.背包&&"object"==typeof s.角色.背包)if(s.角色.背包.突变结晶&&"object"==typeof s.角色.背包.突变结晶?(s.角色.背包.突变结晶.下级=p(s.角色.背包.突变结晶.下级,0,999999999,0),s.角色.背包.突变结晶.中级=p(s.角色.背包.突变结晶.中级,0,999999999,0),s.角色.背包.突变结晶.上级=p(s.角色.背包.突变结晶.上级,0,999999999,0),s.角色.背包.突变结晶.顶级=p(s.角色.背包.突变结晶.顶级,0,999999999,0)):s.角色.背包.突变结晶={下级:0,中级:0,上级:0,顶级:0},s.角色.背包.物品&&"object"==typeof s.角色.背包.物品){const e={};for(const[n,t]of Object.entries(s.角色.背包.物品)){const a=t;a&&"object"==typeof a&&"string"==typeof a.名称&&a.名称.trim()&&(e[n]=d(a))}s.角色.背包.物品=e}else s.角色.背包.物品={};else s.角色.背包={突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}};(0,i.dE)(s.角色.背包);const m="string"==typeof s.角色?.身份?.名字?s.角色.身份.名字.trim():"";if(s.社交&&"object"==typeof s.社交||(s.社交=v().社交),s.社交.关系&&"object"==typeof s.社交.关系){const e=s.社交.关系,n={};for(const[t,a]of Object.entries(e)){if(t.startsWith("_"))continue;if(!a||"object"!=typeof a)continue;const e=a,r="string"==typeof e.名字?e.名字.trim():"",o="string"==typeof t?t.trim():"",i=r||o;i&&(m&&i===m||(e.名字=i,n[i]=u(e)))}s.社交.关系=n}else s.社交.关系={};const g=e=>"string"==typeof e?e.trim():"",b=e=>{if(!Array.isArray(e))return[];const n=new Set,t=[];for(const a of e){const e=g(a);e&&!n.has(e)&&(n.add(e),t.push(e))}return t},y=s.社交.关系矩阵,x=Object.keys(s.社交.关系||{}).filter(e=>"string"==typeof e&&e.trim());if(null==y)x.length>0&&(s.社交.关系矩阵={version:1,nodes:x.slice(0,300),edges:[]});else if("object"!=typeof y||Array.isArray(y))delete s.社交.关系矩阵;else{const e=y,n=b(e.nodes),t=[];{const e=new Set;for(const a of[...n,...x]){const n=g(a);if(n&&!e.has(n)&&(e.add(n),t.push(n),t.length>=300))break}}const a=Array.isArray(e.edges)?e.edges:[],r=[],o=new Set;for(const e of a){if(!e||"object"!=typeof e)continue;const n=g(e.from),t=g(e.to);if(!n||!t||n===t)continue;const a=`${n}::${t}`;if(o.has(a))continue;o.add(a);const i=g(e.relation)||void 0,s="number"==typeof e.score&&Number.isFinite(e.score)?e.score:void 0,l=b(e.tags),c=g(e.updatedAt)||void 0;if(r.push({from:n,to:t,relation:i,score:s,tags:l.length?l:void 0,updatedAt:c}),r.length>=2e3)break}s.社交.关系矩阵={version:"number"==typeof e.version&&Number.isFinite(e.version)?e.version:1,nodes:t.length?t:x.slice(0,300),edges:r}}return s.社交.记忆&&"object"==typeof s.社交.记忆?(s.社交.记忆.短期记忆=Array.isArray(s.社交.记忆.短期记忆)?s.社交.记忆.短期记忆:[],s.社交.记忆.中期记忆=Array.isArray(s.社交.记忆.中期记忆)?s.社交.记忆.中期记忆:[],s.社交.记忆.长期记忆=Array.isArray(s.社交.记忆.长期记忆)?s.社交.记忆.长期记忆:[],s.社交.记忆.隐式中期记忆=Array.isArray(s.社交.记忆.隐式中期记忆)?s.社交.记忆.隐式中期记忆:[]):s.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]},s.系统&&"object"==typeof s.系统||(s.系统=v().系统),s.系统.历史&&"object"==typeof s.系统.历史||(s.系统.历史={叙事:[]}),Array.isArray(s.系统.历史.叙事)||(s.系统.历史.叙事=[]),s.角色.大道&&delete s.角色.大道,s.角色.功法&&delete s.角色.功法,s.角色.技能&&"object"==typeof s.角色.技能||(s.角色.技能={掌握技能:[],装备栏:[],冷却:{}}),s.社交.事件&&"object"==typeof s.社交.事件?(s.社交.事件.配置&&"object"==typeof s.社交.事件.配置||(s.社交.事件.配置={启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""}),Array.isArray(s.社交.事件.事件记录)||(s.社交.事件.事件记录=[]),s.社交.事件.下次事件时间&&"object"!=typeof s.社交.事件.下次事件时间&&(s.社交.事件.下次事件时间=null)):s.社交.事件={配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]},console.log("[数据修复] ✅ 存档数据修复完成"),s}catch(e){return console.error("[数据修复] ❌ 修复过程发生严重错误，返回默认存档:",e),v()}var n}function l(e,n){const t=e||"凡人",a=n||"";if("凡人"===t)return"吸收微量辐射，激活休眠基因，踏上进化第一步";const r={觉醒期:{入门:"初次感知游离能量，基因链开始重组，冲击觉醒适应期",适应:"身体适应辐射环境，细胞活性增强，冲击觉醒控制期",控制:"初步掌控变异能量，感官大幅强化，冲击觉醒稳定期",稳定:"基因序列趋于稳定，异能初步显现，准备进入掌控期","":"吸收环境能量，强化基因活性，夯实觉醒根基"},掌控期:{入门:"构建能量回路，将散乱能量凝聚，冲击掌控适应期",适应:"强化能量回路，扩充能量容积，冲击掌控控制期",控制:"精细操控异能，开发衍生能力，冲击掌控稳定期",稳定:"能量回路闭环，形成核心源点，准备进入精通期","":"打磨能量回路，压缩变异能量，提升掌控等级"},精通期:{入门:"源点凝实，异能形态质变，冲击精通适应期",适应:"肉体与能量深度融合，断肢重生，冲击精通控制期",控制:"异能领域初显，干涉现实法则，冲击精通稳定期",稳定:"领域稳固，生命层次跃迁，准备进入质变期","":"淬炼源点，感悟规则碎片，提升精通等级"},质变期:{入门:"生命形态重构，摆脱碳基限制，冲击质变适应期",适应:"能量化程度加深，无视常规物理伤害，冲击质变控制期",控制:"掌握核心规则，创造半位面投影，冲击质变稳定期",稳定:"规则具象化，成为一方霸主，准备进入超凡期","":"解析世界规则，同化异种能量，提升质变等级"},突破期:{入门:"点燃神火雏形，意志干涉物质，冲击超凡适应期",适应:"构建神国投影，收束信仰/恐惧，冲击超凡控制期",控制:"规则权柄加身，言出法随，冲击超凡稳定期",稳定:"即将超脱位面，触摸更高维度，准备飞升/破碎虚空","":"感悟高维信息，编织规则罗网，提升超凡等级"}}[t];return r?r[a]||r[""]||`感悟${t}奥义，提升进化等级`:{入门:`巩固${t}入门根基，冲击${t}适应期`,适应:`适应${t}强度，冲击${t}控制期`,控制:`掌控${t}力量，冲击${t}稳定期`,稳定:`${t}圆满稳定，准备突破下一阶段`,"":`感悟${t}奥义，提升进化等级`}[a]||`感悟${t}，提升等级`}function c(e,n,t){if(!e||"object"!=typeof e)return{当前:n,上限:t};const a=p(e.当前,0,999999999,n),r=p(e.上限,1,999999999,t);return{当前:Math.min(a,r),上限:r}}function d(e){const n={...e};n.物品ID=n.物品ID||`item_${Date.now()}`,n.名称=n.名称||"未命名物品",n.数量=p(n.数量,1,999999,1),n.品质&&"object"==typeof n.品质?(["破损","粗糙","普通","精良","稀有","史诗","传说"].includes(n.品质.quality)||(n.品质.quality="普通"),n.品质.grade=p(n.品质.grade,0,10,1)):n.品质={quality:"普通",grade:1};const t=String(n.类型||"").trim();return"药剂"===t||"材料"===t||"其他"===t?n.类型="物品":["物品","装备","突变结晶","引导术"].includes(t)||(n.类型="物品"),n}function u(e){const n={...e};return n.名字=n.名字||"无名",n.性别=n.性别||"男","string"!=typeof n.觉醒阶段&&(n.觉醒阶段="凡人"),n.先天属性&&"object"==typeof n.先天属性||(n.先天属性={力量:5,体质:5,敏捷:5,意志:5,魅力:5,幸运:5}),n.属性&&"object"==typeof n.属性?(n.属性.生命值=c(n.属性.生命值,100,100),n.属性.精神力=c(n.属性.精神力,50,50),n.属性.理智值=c(n.属性.理智值,100,100),n.属性.寿命上限="number"==typeof n.属性.寿命上限?n.属性.寿命上限:100):n.属性={生命值:{当前:100,上限:100},精神力:{当前:50,上限:50},理智值:{当前:100,上限:100},体力:{当前:50,上限:50},寿命上限:100,物理攻击力:10,物理防御力:10,特殊攻击力:10,特殊防御力:10},(n.生命值||n.灵气||n.神识||n.寿元)&&(n.属性={生命值:c(n.生命值,100,100),精神力:c(n.灵气,50,50),理智值:c(n.神识,100,100),体力:{当前:50,上限:50},寿命上限:n.寿元?.上限??100,物理攻击力:10,物理防御力:10,特殊攻击力:10,特殊防御力:10},delete n.生命值,delete n.灵气,delete n.神识,delete n.寿元),n.当前位置&&"object"==typeof n.当前位置?n.当前位置.描述||(n.当前位置.描述="朝天大陆·无名之地"):n.当前位置={描述:"朝天大陆·无名之地"},n.好感度=p(n.好感度,-100,100,0),Array.isArray(n.记忆)||(n.记忆=[]),n.背包&&"object"==typeof n.背包||(n.背包={突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}}),n}function p(e,n,t,a){if("number"==typeof e&&!isNaN(e))return Math.max(n,Math.min(t,e));if("string"==typeof e){const a=parseFloat(e);if(!isNaN(a))return Math.max(n,Math.min(t,a))}return a}function v(){const e=(new Date).toISOString();return{元数据:{版本号:3,存档ID:`save_${Date.now()}`,存档名:"自动存档",游戏版本:"0.0.0",创建时间:e,更新时间:e,游戏时长秒:0,时间:{年:1e3,月:1,日:1,小时:8,分钟:0}},角色:{身份:{名字:"无名修士",性别:"男",出生日期:{年:982,月:1,日:1},种族:"人族",世界:"朝天大陆",天资:"凡人",出生:"散修",灵根:"五行杂灵根",天赋:[],先天属性:{力量:5,敏捷:5,意志:5,幸运:5,魅力:5,心性:5},后天属性:{力量:0,敏捷:0,意志:0,幸运:0,魅力:0,心性:0}},属性:{觉醒阶段:{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"吸收微量辐射，激活休眠基因，踏上进化第一步"},声望:0,生命:{当前:100,上限:100},能量:{当前:50,上限:50},精神:{当前:30,上限:30},寿命:{当前:18,上限:80}},位置:{描述:"朝天大陆·无名之地",x:5e3,y:5e3},效果:[],身体:{总体状况:"",部位:{}},背包:{突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}},装备:{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},功法:{当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}},修炼:{修炼功法:null,修炼状态:{模式:"未修炼"}},大道:{大道列表:{}},技能:{掌握技能:[],装备栏:[],冷却:{}}},社交:{关系:{},宗门:null,事件:{配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]},记忆:{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}},世界:{信息:{世界名称:"朝天大陆",大陆信息:[],势力信息:[],地点信息:[],生成时间:e,世界背景:"",世界纪元:"",特殊设定:[],版本:"v1"},状态:{环境:{},事件:[],历史:[],NPC状态:{}}},系统:{配置:{},设置:{},缓存:{掌握技能:[],临时统计:{}},行动队列:{actions:[]},历史:{叙事:[]},扩展:{},联机:{模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"}}}}},6589:(e,n,t)=>{"use strict";t.d(n,{J:()=>k,f:()=>r.getTavernHelper});var a=t(2543),r=t(8651),o=t(4270),i=t(1184),s=t(8220),l=t(9173),c=t(1513),d=t(8263),u=t(2456),p=t(3943),v=t(9207),f=t(3098),h=t(4530),m=t(758);function g(e){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e))return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||null===n}function b(e,n){const t=(0,a.cloneDeep)(e);return y(t,n),t}function y(e,n){for(const[t,r]of Object.entries(n)){const n=e[t];g(n)&&g(r)?y(n,r):e[t]=(0,a.cloneDeep)(r)}}class x{static instance=null;stateHistory=[];isSummarizing=!1;compareGameTime(e,n){const t=["年","月","日","小时","分钟"];for(const a of t){const t=Number(e?.[a]??0),r=Number(n?.[a]??0);if(t>r)return 1;if(t<r)return-1}return 0}addMonths(e,n){const t={年:Number(e.年??0),月:Number(e.月??1)+n,日:Number(e.日??1),小时:Number(e.小时??0),分钟:Number(e.分钟??0)};return(0,u.l)(t)}randomIntInclusive(e,n){const t=Math.ceil(e),a=Math.floor(n);return Math.floor(Math.random()*(a-t+1))+t}getFocusedNpcNames(e){const n=e?.社交?.关系;return n&&"object"==typeof n?Object.entries(n).filter(([,e])=>{if(!e||"object"!=typeof e)return!1;const n=e.实时关注;return!0===n||1===n||"true"===n||"True"===n||"TRUE"===n||"是"===n}).map(([e])=>String(e)).filter(e=>e.trim().length>0):[]}buildFocusedNpcPrompt(e){const n=this.getFocusedNpcNames(e);return["# 🔎 实时关注NPC（必须更新）","请先检查“实时关注”名单；若名单非空，本回合必须推演并更新其💭当前状态（实时），即使不在玩家身边：",n.length>0?n.map(e=>`- ${e}`).join("\n"):"- （无）","要求：","- 必须更新 社交.关系.[NPC名].当前内心想法","- 如有变化，同步更新 当前位置 / 当前外貌状态 / 属性 等","- 所有名单必须全部覆盖，可合并或分多条 tavern_commands 更新"].join("\n")}normalizeEventConfig(e){const n=!1!==e?.启用随机事件,t=Math.max(1,Number(e?.最小间隔月??e?.最小间隔年??1)),a=Math.max(t,Number(e?.最大间隔月??e?.最大间隔年??10)),r=String(e?.事件提示词??"").trim(),o=e?.启用事件类型||{},i=!1!==o?.特殊NPC,s=Number(e?.特殊NPC概率??20);return{enabled:n,minMonths:t,maxMonths:a,customPrompt:r,specialNpcEnabled:i,specialNpcProbability:Math.max(0,Math.min(100,isNaN(s)?20:s))}}scheduleNextEventTime(e,n,t){const a=this.randomIntInclusive(n,t);return this.addMonths(e,a)}async maybeTriggerScheduledWorldEvent(e){const{v3:n,stateForAI:r,shortTermMemoryForPrompt:o}=e,l=n?.元数据?.时间??null;if(!l)return;const c=n?.社交?.事件??null;if(!c||"object"!=typeof c)return;const{enabled:d,minMonths:u,maxMonths:p,customPrompt:v,specialNpcEnabled:f,specialNpcProbability:h}=this.normalizeEventConfig(c.配置);if(!d)return;const m=c.下次事件时间;if(!m){const e=this.scheduleNextEventTime(l,u,p);c.下次事件时间=e,r?.社交?.事件&&(r.社交.事件.下次事件时间=e);const n=(0,i.useGameStateStore)();return void(n.eventSystem&&(n.eventSystem.下次事件时间=e))}if(!(this.compareGameTime(l,m)<0))try{const{generateWorldEvent:e,generateSpecialNpcEvent:d}=await Promise.resolve().then(t.bind(t,2979)),m=(0,i.useGameStateStore)();let g=null,b=f&&100*Math.random()<h?await d({saveData:n,now:l,customPrompt:v}):null;b&&b.npcProfile?g=b.npcProfile:b=await e({saveData:n,now:l,customPrompt:v});const y=this.scheduleNextEventTime(l,u,p);if(!b)return c.下次事件时间=y,r?.社交?.事件&&(r.社交.事件.下次事件时间=y),void(m.eventSystem&&(m.eventSystem.下次事件时间=y));if(g&&g.名字){n.社交||(n.社交={}),n.社交.关系&&"object"==typeof n.社交.关系||(n.社交.关系={}),n.社交.关系[g.名字]||(n.社交.关系[g.名字]=g),r?.社交&&(r.社交.关系&&"object"==typeof r.社交.关系||(r.社交.关系={}),r.社交.关系[g.名字]||(r.社交.关系[g.名字]=g));const e=m.relationships&&"object"==typeof m.relationships?m.relationships:{};e[g.名字]||m.updateState("relationships",{...e,[g.名字]:g})}const x={...b.event,发生时间:l,事件来源:b.event.事件来源||"随机"};if(Array.isArray(c.事件记录)||(c.事件记录=[]),c.事件记录.push(x),c.下次事件时间=y,r?.社交?.事件&&(Array.isArray(r.社交.事件.事件记录)||(r.社交.事件.事件记录=[]),r.社交.事件.事件记录.push(x),r.社交.事件.下次事件时间=y),m.eventSystem){const e=m.eventSystem;Array.isArray(e.事件记录)||(e.事件记录=[]),e.事件记录.push(x),e.下次事件时间=y}const k=`${this._formatGameTime(l)}【世界事件】${b.prompt_addition}`;if(o.push(k),n.社交||(n.社交={}),n.社交.记忆&&"object"==typeof n.社交.记忆||(n.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[]}),Array.isArray(n.社交.记忆.短期记忆)||(n.社交.记忆.短期记忆=[]),n.社交.记忆.短期记忆.push(k),m.memory&&"object"==typeof m.memory){const e=(0,a.cloneDeep)(m.memory);Array.isArray(e.短期记忆)||(e.短期记忆=[]),e.短期记忆.push(k),m.updateState("memory",e)}if(g&&g.名字)try{const e=(0,s.useCharacterStore)();await e.saveCurrentGame()}catch(e){console.warn("[世界事件] 特殊NPC触发后自动存档失败:",e)}}catch(e){console.warn("[世界事件] 调度/生成失败:",e)}}extractNarrativeText(e){const n=String(e||"").replace(/<(?:ant[-_]?)?thinking>[\s\S]*?<\/(?:ant[-_]?)?thinking>/gi,"").replace(/<\/?(?:ant[-_]?)?thinking>/gi,"").replace(/<reasoning>[\s\S]*?<\/reasoning>/gi,"").replace(/<\/?reasoning>/gi,"").replace(/<thought>[\s\S]*?<\/thought>/gi,"").replace(/<\/?thought>/gi,"").trim();if(!n)return"";if(n.startsWith("{")||n.includes("```"))try{const e=this.parseAIResponse(n);return e?.text?.trim()||""}catch{const e=n.match(/```(?:json)?\s*([\s\S]*?)```/i);if(e?.[1])try{const n=JSON.parse(e[1].trim());return String(n.text||n.叙事文本||n.narrative||"").trim()}catch{return e[1].trim()}}return n}sanitizeActionOptionsForDisplay(e){return Array.isArray(e)?e.filter(e=>"string"==typeof e).map(e=>(0,v.E)(e).trim()).filter(e=>e.length>0):[]}async optimizeText(e,n){const{useAPIManagementStore:a}=await Promise.resolve().then(t.bind(t,100)),r=a();if(!r.isFunctionEnabled("text_optimization"))return e;if(!r.getAPIForType("text_optimization"))return console.warn("[文本优化] 未配置text_optimization API，跳过优化"),e;n?.("正在优化文本…");try{const{aiService:n}=await Promise.resolve().then(t.bind(t,7445)),a=await(0,d.XH)("textOptimization"),r=await n.generateRaw({ordered_prompts:[{role:"system",content:a},{role:"user",content:`请优化以下文本：\n\n${e}`}],should_stream:!1,generation_id:`text_optimization_${Date.now()}`,usageType:"text_optimization"}),o=String(r).trim();return o&&o.length>0?(console.log("[文本优化] 优化完成，原长度:",e.length,"新长度:",o.length),o):(console.warn("[文本优化] 优化结果为空，使用原文本"),e)}catch(n){return console.error("[文本优化] 优化失败:",n),e}}constructor(){}static getInstance(){return this.instance||(this.instance=new x),this.instance}async processPlayerAction(e,n,o){console.log("[AI双向系统] processPlayerAction 接收到的options:",{hasOnStreamChunk:!!o?.onStreamChunk,useStreaming:o?.useStreaming,splitResponseGeneration:o?.splitResponseGeneration});const s=(0,i.useGameStateStore)(),u=(0,r.getTavernHelper)(),p=(0,l.useUIStore)(),v=()=>o?.shouldAbort?.()??!1;if(!u){const{aiService:e}=await Promise.resolve().then(t.bind(t,7445)),n=e.checkAvailability();if(!n.available)throw new Error(n.message)}const f=o?.generation_id||`gen_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;o?.onProgressUpdate?.("获取存档数据…");const m=s.toSaveData();if(!m){const e=s.onlineState;if("联机"===e?.模式)throw console.error("[AI双向系统-联机模式] 游戏数据不完整，无法进行AI推演"),console.error("[AI双向系统-联机模式] 请确保："),console.error("  1. 已经成功穿越到目标世界"),console.error("  2. 角色数据已正确加载"),console.error("  3. 世界数据已从服务器同步"),new Error("联机模式下游戏数据不完整，无法进行AI推演。请返回主世界或重新穿越。");throw new Error("无法获取存档数据，请确保角色已加载")}o?.onProgressUpdate?.("构建提示词并请求AI生成…");let g={text:"",mid_term_memory:"",tavern_commands:[],action_options:[]};try{const n=(0,h.ru)(m)?m:(0,h.jj)(m).migrated,r=(0,a.cloneDeep)(n);r.社交?.记忆&&(delete r.社交.记忆.短期记忆,delete r.社交.记忆.隐式中期记忆),r.系统?.历史?.叙事&&delete r.系统.历史.叙事;let i="";try{const{vectorMemoryService:a}=await Promise.resolve().then(t.bind(t,5184)),o=r.社交?.记忆?.长期记忆||[];if(a.isEnabled()&&Array.isArray(o)&&o.length>0){const t=await a.getStats();if(0===t.total)console.warn("[向量记忆] 向量库为空：请先在【记忆中心 -> 向量库】一键转化长期记忆");else{const o=(n?.社交?.记忆?.短期记忆||[]).slice(-2).join("\n"),s=[e||"",o].filter(Boolean).join("\n"),l={currentLocation:r.角色?.位置?.描述},c=await a.searchMemories(s,l);i=a.formatForAI(c),r.社交.记忆.长期记忆=[],console.log(`[向量记忆] 已注入 ${c.length} 条相关长期记忆（向量库总数：${t.total}）`)}}}catch(e){console.warn("[向量记忆] 检索失败，使用全量模式:",e)}const s=n?.社交?.记忆?.短期记忆||[],l=r.角色?.属性,b=r.角色?.身份,y=e=>e?"string"==typeof e?e:Array.isArray(e)?e.map(e=>"string"==typeof e?e:"object"==typeof e&&null!==e&&(e.name||e.名称)||"").filter(Boolean).join(", ")||"无":"未知格式":"无";let x="# 角色核心状态速览\n";if(l){x+=`\n- 生命体征: 生命值${l.生命值?.当前}/${l.生命值?.上限} 精神${l.精神力?.当前}/${l.精神力?.上限} 体力${l.体力?.当前}/${l.体力?.上限} 理智${l.理智值?.当前}/${l.理智值?.上限} 寿命${l.寿命?.当前}/${l.寿命?.上限}`;const e=l,n=e?.属性||{},t=(e=>{if("string"==typeof e&&e.trim())return e.trim();if(e&&"object"==typeof e){const n=e.名称||e.name,t=e.阶段||e.stage;if(n&&t)return`${n}-${t}`;if(n)return String(n);if(t)return String(t)}return"凡人"})(n?.觉醒阶段??e?.觉醒阶段??b?.觉醒阶段),a=Number(n?.当前进度??0),o=Number(n?.下一级所需??0);t&&(Number.isFinite(o)&&o>0?x+=`\n- 觉醒阶段: ${t} (${a}/${o})`:x+=`\n- 觉醒阶段: ${t}`),l.声望&&(x+=`\n- 声望: ${l.声望}`);const i=r.角色?.效果??[];Array.isArray(i)&&i.length>0&&(x+=`\n- 效果: ${i.filter(e=>e&&"object"==typeof e&&e.状态名称).map(e=>e.状态名称).join(", ")}`)}b?.天赋&&(x+=`\n- 天赋: ${y(b.天赋)}`);const k=b?.先天属性||{},w=b?.后天属性||{},_=Math.min(35,Math.max(0,(k.幸运||5)+(w.幸运||0))),C=Math.floor(16*Math.random())-10,A=C+Math.floor(Math.random()*(_+1))+Math.ceil(.5*_),S=r.角色?.位置,L=S?.区域等级||"未知",E="绿区"===L?5:"黄区"===L?3:"橙区"===L?-2:"红区"===L?-5:"黑区"===L?-8:0,T={幸运点:A,幸运值:_,环境:{区域等级:L,炼制修正:E,战斗修正:E}};x+=`\n\n# 本回合判定数据（前端已计算）\n**幸运点**: ${A>=0?"+":""}${A}\n**环境修正**:\n  - 区域等级: ${L}\n      - 制药/制造: ${T.环境.炼制修正>=0?"+":""}${T.环境.炼制修正}\n  - 战斗施法: ${T.环境.战斗修正>=0?"+":""}${T.环境.战斗修正}\n\n⚠️ **重要**：判定时直接使用以上数值，不要自己计算！\n- 幸运点固定为: ${A>=0?"+":""}${A}\n- 环境修正根据判定类型选择对应的值`;const I=()=>({元数据:{时间:r.元数据?.时间},角色:{身份:r.角色?.身份,属性:r.角色?.属性,位置:r.角色?.位置,效果:r.角色?.效果,身体:r.角色?.身体,背包:r.角色?.背包,装备:r.角色?.装备,技能:r.角色?.技能},社交:{关系:r.社交?.关系,势力:r.社交?.势力,任务:r.社交?.任务,事件:r.社交?.事件,记忆:{中期记忆:r.社交?.记忆?.中期记忆,长期记忆:r.社交?.记忆?.长期记忆}},世界:r.世界}),R=JSON.stringify(I()),M=[];p.enableActionOptions&&M.push("actionOptions"),M.push("eventSystem");const P=Array.isArray(s)?[...s]:[];await this.maybeTriggerScheduledWorldEvent({v3:n,stateForAI:r,shortTermMemoryForPrompt:P});const D=(()=>{const n=[e||"",...P].join("\n").toLowerCase(),t=[],a=e=>e.some(e=>n.includes(e));return a(["战斗","攻击","防御","交战","切磋"])&&t.push("combat"),a(["社交","对话","谈判","交流","说服"])&&t.push("social"),a(["探索","调查","搜寻","搜索","前进","潜行"])&&t.push("exploration"),a(["制造","药剂","炼制","制作"])&&t.push("crafting"),a(["逃跑","撤退","躲避","逃离"])&&t.push("escape"),a(["感知","侦查","观察","探查"])&&t.push("perception"),a(["修炼","训练","突破","成长"])&&t.push("cultivation"),t})(),z=await(0,c.q)(M,p.actionOptionsPrompt,r,D),N=r?.系统?.联机,$=N?.穿越目标;let O="";if("联机"===N?.模式&&N?.房间ID){const e=$?.主人用户名||"世界主人",n=r?.世界?.信息?.世界名称||"异世界",t=$?.世界主人档案,a=t?.名字||e,o=r?.角色?.位置,i=$?.世界主人位置,s=$?.离线代理提示词;let l=`- 名字：${a}`;if((t?.觉醒阶段||t?.觉醒阶段)&&(l+=`\n- 觉醒阶段：${t.觉醒阶段||t.觉醒阶段}`),(t?.势力||t?.门派)&&(l+=`\n- 势力：${t.势力||t.门派}`),t?.性别&&(l+=`\n- 性别：${t.性别}`),t?.种族&&(l+=`\n- 种族：${t.种族}`),t?.生命值&&(l+=`\n- 生命值：${JSON.stringify(t.生命值)}`),t?.灵气&&(l+=`\n- 能量：${JSON.stringify(t.灵气)}`),t?.神识&&(l+=`\n- 精神：${JSON.stringify(t.神识)}`),i){const e=i.x??i.坐标?.x,n=i.y??i.坐标?.y;null!=e&&null!=n&&(l+=`\n- 位置坐标：(${e}, ${n})`),i.描述&&(l+=`\n- 位置描述：${i.描述}`)}O=`\n# ⚠️⚠️⚠️ 【极重要：联机穿越状态 - 必读】⚠️⚠️⚠️\n\n## 当前状态\n玩家已经**穿越时空**，来到了「${e}」的世界「${n}」。\n这是一个**完全陌生的异世界**，不是玩家原来的世界！\n\n## 世界主人详细信息（用于AI代理）\n${l}\n${s?`\n### 世界主人性格/行为提示词\n${s}`:""}\n\n## 玩家当前位置\n- 位置描述：${o?.描述||"未知"}\n- 坐标：(${o?.x??"未知"}, ${o?.y??"未知"})\n\n## 🎯 世界主人是真实存在的角色（极重要！）\n世界主人「${a}」是这个世界中**真实存在的修士/角色**，玩家可以：\n- **寻找世界主人**：根据上述位置信息，玩家可以前往寻找\n- **与世界主人互动**：对话、切磋、交易、结交等\n- **遭遇世界主人**：在世界主人所在位置附近活动时可能偶遇\n\n## AI代理规则（当玩家遇到或寻找世界主人时）\n你需要**代理扮演**世界主人「${a}」这个角色：\n- 使用世界主人的属性值进行战斗/切磋判定\n- 根据性格提示词决定世界主人的行为和态度\n- 世界主人对入侵者（玩家）的态度取决于性格，可能友好、中立或敌对\n- 世界主人有自己的日常活动（修炼、巡视、采药等），不会一直待在原地\n\n## 核心规则（必须遵守）\n1. **所有NPC都不认识玩家** - 玩家是外来者\n2. **不要使用原世界的任何设定** - 当前世界信息已完全切换\n3. **NPC初始态度**：警惕/好奇/中立（取决于NPC性格）\n4. **描述要体现陌生感** - 玩家对这个世界一无所知\n5. **世界主人可被找到** - 玩家想寻找世界主人时，引导其前往世界主人位置\n`}const F=this.buildFocusedNpcPrompt(r),j=`\n${z}\n${O}\n${x}\n${i?`\n${i}\n`:""}\n# 游戏状态\n你正在废土世界《混沌纪元》中扮演GM。以下是当前完整游戏存档(JSON格式):\n${R}\n`.trim(),B=e&&e.toString().trim()||"继续当前活动";console.log("[AI双向系统] 用户输入 userMessage:",e),console.log("[AI双向系统] 处理后 userActionForAI:",B);const X=[{content:j,role:"system",depth:4,position:"in_chat"}];X.push({content:F,role:"system",depth:3,position:"in_chat"});const U=void 0!==P?P:s;U.length>0&&X.push({content:`# 【最近事件】\n${U.join("\n")}。根据这刚刚发生的文本事件，合理生成下一次文本信息，要保证衔接流畅、不断层，符合上文的文本信息`,role:"assistant",depth:2,position:"in_chat"});const W=r?.系统?.联机?.穿越目标,q=r?.系统?.联机?.房间ID;if(q&&W?.世界ID){const e=W?.主人用户名||"世界主人",n=W?.世界主人位置?.描述||"",t=W?.世界主人档案,a=n?`\n- 世界主人「${e}」当前位置：${n}（可以前往寻找）`:"";let r="";if(t){const e=[];t.名字&&e.push(`名字：${t.名字}`),(t.觉醒阶段||t.觉醒阶段)&&e.push(`觉醒阶段：${t.觉醒阶段||t.觉醒阶段}`),t.种族&&e.push(`种族：${t.种族}`),e.length>0&&(r=`\n- 世界主人基本信息：${e.join("，")}`)}X.push({content:`# 【联机穿越 - 入侵者身份】\n你当前处于联机穿越/入侵状态（会话ID：${q}），已进入「${e}」的世界。\n\n## ⚠️ 核心设定：你是入侵者\n- 你通过神秘的空间裂隙/虚空通道穿越到了这个世界\n- 这是**别人的世界**，不是你的主世界\n- 世界主人「${e}」是这个世界的主人，**真实存在于世界中**${r}${a}\n\n## 🎯 世界主人可以被找到！\n- 世界主人「${e}」是一个**真实存在的角色**，不是虚无的概念\n- 玩家可以**主动寻找**世界主人，前往其所在位置\n- 当玩家表示想找世界主人时，**引导玩家前往世界主人的位置**\n- 遇到世界主人时，由你（AI）代理扮演世界主人与玩家互动\n\n## 🎭 NPC反应规则（重要！）\n1. **所有NPC都不认识你**：你对他们来说是完全陌生的外来者\n2. **凭空出现会引起注意**：\n   - 如果你出现在有NPC的地方，他们会**惊讶/警惕**\n   - 进化者会感知到空间波动，凡人会觉得你"不知从哪冒出来的"\n   - 高阶进化者可能会察觉你身上的"异界气息"\n3. **NPC内心戏要充足**：\n   - 描写NPC看到陌生人突然出现时的心理活动\n   - 根据NPC性格决定反应：警惕、好奇、敌意、友善等\n4. **不要假设任何既有关系**：\n   - 不要继承世界主人与NPC的好感度或互动历史\n   - 你需要从零开始与这个世界的NPC建立关系\n\n## 📝 叙事要求\n- 体现"异乡人"的陌生感和新鲜感\n- 描写你对这个陌生世界的观察和感受\n- NPC的反应要自然合理，符合"突然看到陌生人"的情境\n- 如果是首次穿越，要描写穿越的过程（空间扭曲、虚空通道等）`,role:"system",depth:3,position:"in_chat"})}if(W?.离线代理提示词){const e=W.角色信息;let n="# 【离线玩家代理】\n你正在扮演另一位玩家的角色。";e&&(n+="\n该角色信息：",e.name&&(n+=`\n- 名称：${e.name}`),e.cultivation_level&&(n+=`\n- 觉醒阶段：${e.cultivation_level}`),e.sect&&(n+=`\n- 势力：${e.sect}`),e.personality&&(n+=`\n- 性格：${e.personality}`)),n+=`\n\n该玩家设定的行为指南：\n${W.离线代理提示词}`,n+="\n\n请根据以上设定来扮演这位离线玩家的角色，与当前玩家互动。",X.push({content:n,role:"system",depth:2,position:"in_chat"})}const G=B;X.push({content:"</input>",role:"assistant",depth:0,position:"in_chat"});const{aiService:H}=await Promise.resolve().then(t.bind(t,7445)),V=H.getConfig(),Q=o?.useStreaming??V.streaming??!0,K=(()=>{if("boolean"==typeof o?.splitResponseGeneration)return o.splitResponseGeneration;try{const e=localStorage.getItem("dad_game_settings");if(!e)return!1;const n=JSON.parse(e);return!0===n?.splitResponseGeneration}catch{return!1}})();let Y="";const{useAPIManagementStore:J}=await Promise.resolve().then(t.bind(t,100)),Z=J().getAPIForType("instruction_generation"),ee=Z&&"default"!==Z.id,ne=K;if(console.log(`[AI双向系统] shouldActuallySplit=${ne}, isSplitEnabled=${K}, tavernHelper=${!!u}`),ne){const e=()=>JSON.stringify(I()),n=async n=>{if(1===n){const n=(await(0,d.XH)("splitGenerationStep1")).trim(),t=await(0,d.XH)("worldStandards"),a=await(0,d.XH)("textFormatRules"),r=e();return`\n${n}\n\n---\n\n# 判定系统（战斗/修炼/探索等场景必须使用）\n${a}\n\n---\n\n# 世界观设定\n${t}\n\n---\n\n${x}\n${i?`\n${i}\n`:""}\n# 当前游戏状态（用于叙事判定，无需输出指令）\n${r}\n`.trim()}const[t,a,r,o]=await Promise.all([(0,d.XH)("businessRules"),(0,d.XH)("dataDefinitions"),(0,d.XH)("textFormatRules"),(0,d.XH)("worldStandards")]),s=a,l=[(await(0,d.XH)("splitGenerationStep2")).trim()],c=t;if(l.push(c,s,r,o),p.enableActionOptions){const e=await(0,d.XH)("actionOptions"),n=p.actionOptionsPrompt?`**用户自定义要求**：${p.actionOptionsPrompt}\n\n请严格按以上要求生成行动选项。`:"（无特殊要求，按默认规则生成）";l.push(e.replace("{{CUSTOM_ACTION_PROMPT}}",n))}return l.push(await(0,d.XH)("eventSystemRules")),`\n${l.join("\n\n---\n\n")}\n\n${x}\n${F?`\n${F}\n`:""}\n\n# 游戏状态（JSON）\n${R}\n`.trim()},t=(e,n=!1)=>{const t=[{content:e,role:"system",depth:4,position:"in_chat"}],a=void 0!==P?P:s;return n&&a.length>0&&t.push({content:`# 【最近事件】\n${a.join("\n")}。根据这刚刚发生的文本事件，合理生成下一次文本信息，要保证衔接流畅、不断层，符合上文的文本信息`,role:"assistant",depth:2,position:"in_chat"}),t.push({content:"</input>",role:"assistant",depth:0,position:"in_chat"}),t},a=async e=>await H.generate({user_input:e.user_input,should_stream:e.should_stream,generation_id:e.generation_id,usageType:e.usageType||"main",injects:e.injects,onStreamChunk:e.onStreamChunk});o?.onProgressUpdate?.("分步生成：第1步（正文）…");const r=t(await n(1),!0);let l="";for(let e=1;e<=2;e++)try{e>1&&o?.onProgressUpdate?.("分步生成：第1步重试…");const n=await a({user_input:G,should_stream:Q,generation_id:`${f}_step1_${e}`,injects:r,usageType:"main",onStreamChunk:o?.onStreamChunk});if(l=this.extractNarrativeText(String(n)),l.trim().length>0)break;l=""}catch(n){console.warn(`[分步生成] 第1步第${e}次失败:`,n)}o?.onProgressUpdate?.("分步生成：第2步（指令生成）…");const c=t(await n(2),!1),u=`\n【用户本次操作】\n${G}\n\n【第1步正文】\n${l}\n\n请按"分步生成（第2步）"规则输出 JSON。\n`.trim(),v=Q,h=ee?"instruction_generation":"main",m=H.isForceJsonEnabled(h);let b=null;for(let e=1;e<=2;e++)try{e>1&&o?.onProgressUpdate?.("分步生成：第2步重试…");const n=await a({user_input:u,should_stream:v,generation_id:`${f}_step2_${e}`,injects:c,usageType:h,onStreamChunk:void 0});if(b=this.parseAIResponse(String(n),m),b.tavern_commands&&b.tavern_commands.length>0)break;b=null}catch(n){console.warn(`[分步生成] 第2步第${e}次失败:`,n)}b||(b={text:"",mid_term_memory:"",tavern_commands:[],action_options:[]}),g={text:l,mid_term_memory:b.mid_term_memory||"",tavern_commands:b.tavern_commands||[],action_options:p.enableActionOptions?this.sanitizeActionOptionsForDisplay(b.action_options||[]):[]}}else if(u)console.log(`[AI双向系统] 进入酒馆模式, hasOnStreamChunk=${!!o?.onStreamChunk}`),Y=await u.generate({user_input:G,should_stream:Q,generation_id:f,usageType:"main",injects:X,onStreamChunk:o?.onStreamChunk});else{console.log(`[AI双向系统] 进入自定义API模式, hasOnStreamChunk=${!!o?.onStreamChunk}`);const{aiService:e}=await Promise.resolve().then(t.bind(t,7445));Y=await e.generate({user_input:G,should_stream:Q,generation_id:f,usageType:"main",injects:X,onStreamChunk:o?.onStreamChunk})}if(!K){const e=H.isForceJsonEnabled("main");try{g=this.parseAIResponse(Y,e)}catch(e){console.error("[AI双向系统] 响应解析失败，尝试容错处理:",e);const n=String(Y).trim();let t="",a="",r=[],o=[];const i=n.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(i&&i[1])try{const e=JSON.parse(i[1].trim());t=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[],o=e.action_options||[]}catch(e){console.warn("[AI双向系统] JSON代码块解析失败:",e)}if(!t)try{const e=JSON.parse(n);t=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[],o=e.action_options||[]}catch{const e=n.match(/"(?:text|叙事文本|narrative)"\s*:\s*"((?:[^"\\]|\\.)*)"/);if(e&&e[1])t=e[1].replace(/\\n/g,"\n").replace(/\\"/g,'"');else{const e=n.match(/\{[\s\S]*"text"[\s\S]*\}/);if(e)try{const n=JSON.parse(e[0]);t=n.text||"",a=n.mid_term_memory||"",r=n.tavern_commands||[],o=n.action_options||[]}catch{t=n}}}o&&0!==o.length||(console.warn("[AI双向系统] ⚠️ 容错模式：action_options为空，使用默认选项"),o=["继续当前活动","观察周围环境","与附近的人交谈","查看自身状态","稍作休息调整"]),g={text:t,mid_term_memory:a,tavern_commands:r,action_options:this.sanitizeActionOptionsForDisplay(o)},console.warn("[AI双向系统] 使用容错模式提取内容 - 文本长度:",t.length,"记忆:",a.length,"指令数:",r.length,"行动选项:",o.length)}}if(v())return console.log("[AI System] Abort detected, skip text optimization and command execution"),g;if(g&&g.text&&(g.text=await this.optimizeText(g.text,o?.onProgressUpdate)),v())return console.log("[AI System] Abort detected, skip command execution"),g;if(!g||!g.text||""===g.text.trim())throw console.error("[AI双向系统] AI响应为空，原始响应:",String(Y).substring(0,200)),new Error("AI响应为空或格式错误");Q&&o?.onStreamComplete&&o.onStreamComplete()}catch(e){console.error("[AI双向系统] AI生成失败:",e),g={text:"（AI生成失败）",mid_term_memory:"",tavern_commands:[],action_options:["重试当前操作","查看自身状态","稍作休息"]}}if(o?.onProgressUpdate?.("执行AI指令…"),v())return console.log("[AI System] Abort detected, skip command execution"),g;try{const n=(0,h.ru)(m)?m:(0,h.jj)(m).migrated,{saveData:a,stateChanges:r,onlineLogPosted:s}=await this.processGmResponse(g,n,!1,o?.shouldAbort);if(o?.onStateChange&&o.onStateChange(a),!s)try{const n=(0,i.useGameStateStore)(),a=n.onlineState,o=a?.房间ID,s=a?.穿越目标,l="联机"===a?.模式&&o&&s?.世界ID,c=Number(o);if(l&&Number.isFinite(c)&&c>0){const a=n.character?.名字||"陌生人",o=n.location?.描述||"未知之地",i=e&&String(e).trim()||"继续行动",s=e=>null==e?String(e):"string"==typeof e?e.length>60?`${e.slice(0,60)}…`:e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?`数组(${e.length})`:"object"==typeof e?"对象":String(e),l=(Array.isArray(r?.changes)?r.changes:[]).filter(e=>{const n=String(e?.key??"");return!(!n||n.startsWith("系统.历史")||n.startsWith("历史.")||n.includes("系统.历史")||n.includes("叙事历史")||n.includes("对话历史"))}),d=l.slice(0,6).map(e=>{const n=String(e?.key??""),t=String(e?.action??""),a=s(e?.newValue);return t?`${n}(${t})=${a}`:`${n}=${a}`}).join("；"),u=String(g?.text||"").replace(/\s+/g," ").trim().slice(0,80);let p=`你离线期间，${a}出现在「${o}」，并尝试：${i}`;d&&(p+=`。状态变更：${d}`),u&&(p+=`。异动概述：${u}`);const{appendTravelNote:v}=await Promise.resolve().then(t.bind(t,3825));await v(c,p,{place:o,action:i,snippet:u,changes:l.slice(0,10).map(e=>({key:e?.key,action:e?.action,oldValue:e?.oldValue,newValue:e?.newValue}))})}}catch(e){console.warn("[AI双向系统] travel note append failed",e)}return g}catch(e){return console.error("[AI双向系统] 指令执行失败:",e),g}}async generateInitialMessage(e,n,a){const o=(0,r.getTavernHelper)(),i=(0,l.useUIStore)();if(!o){const{aiService:e}=await Promise.resolve().then(t.bind(t,7445)),n=e.checkAvailability();if(!n.available)throw new Error(n.message)}let s;a?.onProgressUpdate?.("构建提示词并请求AI生成…");try{const{aiService:r}=await Promise.resolve().then(t.bind(t,7445)),l=r.getConfig(),c=a?.useStreaming??l.streaming??!0,u=a?.generateMode||"generate",p=(()=>{if("boolean"==typeof a?.splitResponseGeneration)return a.splitResponseGeneration;try{const e=localStorage.getItem("dad_game_settings");if(!e)return!1;const n=JSON.parse(e);return!0===n?.splitResponseGeneration}catch{return!1}})();let v="";const{useAPIManagementStore:f}=await Promise.resolve().then(t.bind(t,100)),h=f().getAPIForType("instruction_generation"),m=h&&"default"!==h.id,g=p;if(g){const e=async e=>{if(1===e)return`\n${(await(0,d.XH)("splitInitStep1")).trim()}\n\n---\n\n# 世界观设定\n${await(0,d.XH)("worldStandards")}\n\n---\n\n# 角色设定\n${n}\n            `.trim();const t=!!o,a=(await(0,d.XH)("splitInitStep2")).trim(),[r,i,s,l]=await Promise.all([(0,d.XH)("businessRules"),(0,d.XH)("dataDefinitions"),(0,d.XH)("textFormatRules"),(0,d.XH)("worldStandards")]),c=i,u=r,p=[a];return t&&p.push("## ⚠️ 酒馆端必须生成身体数据\n□ 身体：set `角色.身体` {身高:num(cm),体重:num(kg),体脂率:num(%),三围:{胸围,腰围,臀围},肤色,发色,瞳色,纹身与印记:[],穿刺:[],敏感点:[],开发度:{},其它:{}}\n- 必须根据角色性别/年龄/种族填写合理的具体数值\n- 男性身高165-185cm，女性155-170cm，儿童按年龄\n- 严禁使用占位文本或照抄示例"),p.push(u,c,s,l),p.map(e=>e.trim()).filter(Boolean).join("\n\n---\n\n").trim()},t=async e=>{const n=`initial_message_split_step${e.step}_${Date.now()}`,t=e.usageType||"main";if("generateRaw"===u)return await r.generateRaw({ordered_prompts:[{role:"system",content:e.system},{role:"user",content:e.user}],should_stream:e.should_stream,generation_id:n,usageType:t,onStreamChunk:e.onStreamChunk});const a=[{content:e.system,role:"user",depth:4,position:"in_chat"}];return await r.generate({user_input:e.user,should_stream:e.should_stream,generation_id:n,usageType:t,injects:a,onStreamChunk:e.onStreamChunk})};a?.onProgressUpdate?.("分步生成：第1步（开局正文）…");const l=await t({step:1,system:await e(1),user:n,should_stream:c,usageType:"main",onStreamChunk:a?.onStreamChunk}),p=this.extractNarrativeText(String(l));c&&a?.onStreamComplete&&a.onStreamComplete(),a?.onProgressUpdate?.("分步生成：第2步（思维链+指令生成）…");const v=`\n【开局用户提示】\n${n}\n\n【第1步正文】\n${p}\n\n请按"分步生成（开局-第2步）"规则输出 JSON。\n        `.trim(),f=c,h=m?"instruction_generation":"main",g=r.isForceJsonEnabled(h);a?.onProgressUpdate?.("分步生成：第2步（指令生成）…");let b=null;for(let n=1;n<=2;n++)try{n>1&&a?.onProgressUpdate?.("分步生成：第2步重试…");const r=await t({step:2,system:await e(2),user:v,should_stream:f,usageType:h,onStreamChunk:void 0});if(b=this.parseAIResponse(String(r),g),b.tavern_commands&&b.tavern_commands.length>0)break;b=null}catch(e){console.warn(`[分步生成-开局] 第2步第${n}次失败:`,e)}b||(b={text:"",mid_term_memory:"",tavern_commands:[],action_options:[]});const y=["四处走动熟悉环境","查看自身状态","与附近的人交谈","寻找修炼之地","打听周围消息"];s={text:p,mid_term_memory:b.mid_term_memory||"",tavern_commands:b.tavern_commands||[],action_options:i.enableActionOptions?this.sanitizeActionOptionsForDisplay(b.action_options?.length?b.action_options:y):[]},s.text=await this.optimizeText(s.text,a?.onProgressUpdate)}else if(o)if("generateRaw"===u)console.log("[AI双向系统] 酒馆模式 - 使用 generateRaw 模式生成初始消息"),v=String(await o.generateRaw({ordered_prompts:[{role:"system",content:e},{role:"user",content:n}],should_stream:c,generation_id:`initial_message_raw_${Date.now()}`,usageType:"main"}));else{console.log("[AI双向系统] 酒馆模式 - 使用 generate 模式生成初始消息");const t=[{content:e,role:"user",depth:4,position:"in_chat"}];v=await o.generate({user_input:n,should_stream:c,generation_id:`initial_message_${Date.now()}`,usageType:"main",injects:t})}else{const{aiService:r}=await Promise.resolve().then(t.bind(t,7445));if("generateRaw"===u)console.log("[AI双向系统] 自定义API模式 - 使用 generateRaw 模式生成初始消息"),v=await r.generateRaw({ordered_prompts:[{role:"system",content:e},{role:"user",content:n}],should_stream:c,generation_id:`initial_message_raw_${Date.now()}`,usageType:"main",onStreamChunk:a?.onStreamChunk});else{console.log("[AI双向系统] 自定义API模式 - 使用 generate 模式生成初始消息");const t=[{content:e,role:"user",depth:4,position:"in_chat"}];v=await r.generate({user_input:n,should_stream:c,generation_id:`initial_message_${Date.now()}`,usageType:"main",injects:t,onStreamChunk:a?.onStreamChunk})}}if(!g){if(console.log("[AI双向系统] 原始响应类型:",typeof v),console.log("[AI双向系统] 原始响应长度:",String(v).length),console.log("[AI双向系统] 原始响应前500字符:",String(v).substring(0,500)),!v||0===String(v).trim().length)throw new Error("AI返回了空响应。可能原因：1) 模型使用了reasoning_content字段而非content字段（如Gemini 3 Pro）；2) API配置错误；3) 网络问题。建议：在酒馆设置中关闭流式传输，或更换模型。");const e=r.isForceJsonEnabled("main");try{s=this.parseAIResponse(String(v),e)}catch(e){console.error("[AI双向系统] 初始消息解析失败，尝试容错处理:",e);const n=String(v).trim();let t="",a="",r=[];const o=n.match(/```(?:json)?\s*\n?([\s\S]*?)\n?(?:```|$)/);if(o&&o[1])try{const e=JSON.parse(o[1].trim());t=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[]}catch(e){console.warn("[AI双向系统] JSON代码块解析失败:",e)}if(!t)try{const e=JSON.parse(n);t=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[]}catch{const e=n.match(/"(?:text|叙事文本|narrative)"\s*:\s*"((?:[^"\\]|\\.)*)"/);if(e&&e[1])t=e[1].replace(/\\n/g,"\n").replace(/\\"/g,'"');else{const e=n.match(/\{[\s\S]*"text"[\s\S]*\}/);if(e)try{const n=JSON.parse(e[0]);t=n.text||"",a=n.mid_term_memory||"",r=n.tavern_commands||[]}catch{t=n}}}let i=[];try{const e=n.match(/```(?:json)?\s*\n?([\s\S]*?)\n?(?:```|$)/);e&&e[1]&&(i=JSON.parse(e[1].trim()).action_options||[])}catch{}i&&0!==i.length||(console.warn("[AI双向系统] ⚠️ 初始消息：action_options为空，使用默认选项"),i=["四处走动熟悉环境","查看自身状态","与附近的人交谈","寻找修炼之地","打听周围消息"]),s={text:t,mid_term_memory:a,tavern_commands:r,action_options:this.sanitizeActionOptionsForDisplay(i)},console.warn("[AI双向系统] 使用容错模式提取初始消息 - 文本长度:",t.length,"记忆:",a.length,"指令数:",r.length,"行动选项:",i.length)}if(!s||!s.text)throw new Error("AI响应解析失败或为空");s.text=await this.optimizeText(s.text,a?.onProgressUpdate)}if(c&&a?.onStreamComplete&&a.onStreamComplete(),!s||!s.text)throw new Error("AI响应解析失败或为空");return s}catch(e){throw console.error("[AI双向系统] 初始消息生成失败:",e),new Error(`初始消息生成失败: ${e instanceof Error?e.message:"未知错误"}`)}}_getMinutes(e){return e.分钟??0}_formatGameTime(e){if(!e)return"【纪元元年】";const n=this._getMinutes(e);return`【纪元${e.年}年${e.月}月${e.日}日 ${String(e.小时).padStart(2,"0")}:${String(n).padStart(2,"0")}】`}async processGmResponse(e,n,r=!1,o,s){const l=()=>o?.()??!1;if(l())return console.log("[AI System] Abort detected, skip command processing"),{saveData:n,stateChanges:{changes:[],timestamp:(new Date).toISOString()},onlineLogPosted:!1};const{repairSaveData:c}=await Promise.resolve().then(t.bind(t,6588)),d=c(n),f=(0,a.cloneDeep)(d),h=[],m={appendNarrativeHistory:!1!==s?.appendNarrativeHistory,appendShortTermMemoryFromText:!1!==s?.appendShortTermMemoryFromText,appendImplicitMidMemoryFromMidTerm:!1!==s?.appendImplicitMidMemoryFromMidTerm,ensureImplicitMidForEachShortTerm:!1!==s?.ensureImplicitMidForEachShortTerm,implicitMidFallbackMaxLen:"number"==typeof s?.implicitMidFallbackMaxLen&&Number.isFinite(s.implicitMidFallbackMaxLen)?Math.max(20,Math.min(200,Math.floor(s.implicitMidFallbackMaxLen))):80};m.appendNarrativeHistory&&(f.系统||(f.系统={}),f.系统.历史||(f.系统.历史={叙事:[]}),Array.isArray(f.系统.历史.叙事)||(f.系统.历史.叙事=[]));const g=this._formatGameTime(f.元数据?.时间),b=(0,v.E)(e.text||"").trim(),y=(0,v.E)(e.mid_term_memory||"").trim();if(b){if(m.appendNarrativeHistory){const n={type:"gm",role:"assistant",content:`${g}${b}`,time:g,actionOptions:this.sanitizeActionOptionsForDisplay(e.action_options||[])};f.系统.历史.叙事.push(n),h.push({key:`系统.历史.叙事[${f.系统.历史.叙事.length-1}]`,action:"push",oldValue:void 0,newValue:(0,a.cloneDeep)(n)})}m.appendShortTermMemoryFromText&&(f.社交||(f.社交={}),f.社交.记忆||(f.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(f.社交.记忆.短期记忆)||(f.社交.记忆.短期记忆=[]),f.社交.记忆.短期记忆.push(`${g}${b}`))}if(m.appendImplicitMidMemoryFromMidTerm&&y&&(f.社交||(f.社交={}),f.社交.记忆||(f.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(f.社交.记忆.隐式中期记忆)||(f.社交.记忆.隐式中期记忆=[]),f.社交.记忆.隐式中期记忆.push(`${g}${y}`)),m.appendShortTermMemoryFromText&&b&&m.ensureImplicitMidForEachShortTerm&&(!y||!m.appendImplicitMidMemoryFromMidTerm)){f.社交||(f.社交={}),f.社交.记忆||(f.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(f.社交.记忆.隐式中期记忆)||(f.社交.记忆.隐式中期记忆=[]);const e=b.length>m.implicitMidFallbackMaxLen?`${b.slice(0,m.implicitMidFallbackMaxLen)}…`:b;f.社交.记忆.隐式中期记忆.push(`${g}${e}`)}let x=5;try{const e=localStorage.getItem("memory-settings");if(e){const n=JSON.parse(e),t="number"==typeof n.shortTermLimit&&n.shortTermLimit>0?n.shortTermLimit:"number"==typeof n.maxShortTerm&&n.maxShortTerm>0?n.maxShortTerm:null;t&&(x=t)}}catch(e){console.warn("[AI双向系统] 读取记忆配置失败，使用默认值:",e)}for(;f.社交?.记忆?.短期记忆&&f.社交.记忆.短期记忆.length>x;)if(f.社交.记忆.短期记忆.shift(),console.log(`[AI双向系统] 短期记忆超过上限（${x}条），已删除最旧的短期记忆。当前短期记忆数量: ${f.社交.记忆.短期记忆.length}`),f.社交.记忆.隐式中期记忆&&f.社交.记忆.隐式中期记忆.length>0){const e=f.社交.记忆.隐式中期记忆.shift();e&&(Array.isArray(f.社交.记忆.中期记忆)||(f.社交.记忆.中期记忆=[]),f.社交.记忆.中期记忆.push(e),console.log(`[AI双向系统] 已将隐式中期记忆转化为正式中期记忆。当前中期记忆数量: ${f.社交.记忆.中期记忆.length}`))}try{const e=JSON.parse(localStorage.getItem("memory-settings")||"{}").midTermTrigger??25;f.社交?.记忆?.中期记忆&&f.社交.记忆.中期记忆.length>=e&&this.triggerMemorySummary().catch(e=>{console.error("[AI双向系统] 自动记忆总结在后台失败:",e)})}catch(e){console.warn("[AI双向系统] 检查自动总结阈值时出错:",e)}if(!e.tavern_commands?.length)return{saveData:f,stateChanges:{changes:h,timestamp:(new Date).toISOString()},onlineLogPosted:!1};const k=this._preprocessCommands(e.tavern_commands),{validateCommands:w,cleanCommands:_}=await Promise.resolve().then(t.bind(t,4820)),C=w(k),{validateAndRepairCommandValue:A}=await Promise.resolve().then(t.bind(t,5269)),S=[],L=[];k.forEach((e,n)=>{const t=A(e);t.valid?S.push(e):(console.error(`[AI双向系统] ❌ 拒绝执行指令[${n}]，格式错误:`,t.errors),L.push({command:e,errors:t.errors}))}),L.length>0&&(console.error(`[AI双向系统] 共拒绝 ${L.length} 条格式错误的指令`),L.forEach(({command:e,errors:n})=>{h.unshift({key:"❌ 格式错误（已拒绝）",action:"validation_error",oldValue:void 0,newValue:{command:JSON.stringify(e,null,2),errors:n}})})),C.valid||(console.error("[AI双向系统] 指令格式验证失败:",C.errors),C.errors.forEach(e=>console.error(`  - ${e}`)),C.invalidCommands&&C.invalidCommands.length>0&&C.invalidCommands.forEach(({command:e,errors:n})=>{h.unshift({key:"❌ 错误指令",action:"validation_error",oldValue:void 0,newValue:{command:JSON.stringify(e,null,2),errors:n}})})),C.warnings.length>0&&C.warnings.forEach(e=>console.warn(`[AI双向系统] ${e}`));const E=[..._(S)].sort((e,n)=>{const t="set"===e.action&&e.key.endsWith(".上限"),a="set"===n.action&&n.key.endsWith(".上限");return t&&!a?-1:!t&&a?1:0});console.log(`[AI双向系统] 执行 ${E.length} 条有效指令，拒绝 ${L.length} 条无效指令`);let T=!1,I=0;const R=e=>e&&"push"===e.action&&"string"==typeof e.key&&"系统.联机.服务器日志"===e.key;for(const e of E){if(l()){console.log("[AI System] Abort detected, stop command execution loop");break}try{if(R(e)){if(I>=1)continue;I++;try{const n=(0,i.useGameStateStore)(),a=n?.onlineState,r=a?.房间ID,o="联机"===a?.模式&&r,s=Number(r);if(!o||!Number.isFinite(s)||s<=0)continue;const l=e.value;let c,d=null;if("string"==typeof l)d=l;else if(l&&"object"==typeof l){const e=l;d="string"==typeof e.note?e.note:"string"==typeof e.文本?e.文本:null,c=void 0!==e.meta?e.meta:void 0}if("string"==typeof d){const e=d.trim();if(e){const n=e.slice(0,600),{appendTravelNote:a}=await Promise.resolve().then(t.bind(t,3825));await a(s,n,c),T=!0}}}catch(e){console.warn("[AI双向系统] online server log command failed",e)}continue}const n=(0,a.get)(f,e.key);this.executeCommand(e,f);const r=(0,a.get)(f,e.key);h.push({key:e.key,action:e.action,oldValue:this._summarizeValueForChangeLog(e.key,n,e.action),newValue:this._summarizeValueForChangeLog(e.key,r,e.action)})}catch(n){console.error("[AI双向系统] 指令执行失败:",e,n),h.unshift({key:"? 执行失败",action:"execution_error",oldValue:void 0,newValue:{command:JSON.stringify(e,null,2),error:n instanceof Error?n.message:String(n)}})}}f.元数据?.时间&&(f.元数据.时间=(0,u.l)(f.元数据.时间));const{removedEffects:M}=(0,p.UZ)(f);M.length>0&&console.log(`[AI双向系统] Pinia状态更新前: 移除了 ${M.length} 个过期效果: ${M.join(", ")}`);const P={changes:h,timestamp:(new Date).toISOString()};f.系统?.历史?.叙事&&f.系统.历史.叙事.length>0&&(f.系统.历史.叙事[f.系统.历史.叙事.length-1].stateChanges=P);try{if(!(f.系统?.联机&&"联机"===f.系统?.联机?.模式||String(f?.社交?.势力?.成员信息?.势力名称||"").trim())){const e=String(f?.角色?.身份?.名字||"").trim(),n=f?.世界?.信息?.势力信息;if(e&&Array.isArray(n)){const a=n=>{const t=("string"==typeof n?.领导层?.宗主?n.领导层.宗主:"")||("string"==typeof n?.leadership?.宗主?n.leadership.宗主:"")||("string"==typeof n?.宗主?n.宗主:"");return"string"==typeof t&&t.trim()===e},r=n.find(a);if(r&&"object"==typeof r&&"string"==typeof r.名称&&r.名称.trim()){const{createJoinedSectState:e}=await Promise.resolve().then(t.bind(t,8213)),{sectSystem:n,memberInfo:a}=e(r,{nowIso:(new Date).toISOString()});a.职位="首领",a.贡献=Math.max(0,Number(a.贡献||0)),f.社交||(f.社交={}),f.社交.势力={...n,成员信息:a},console.log(`[AI双向系统] 已自动初始化势力系统：${r.名称}（玩家=首领）`)}}}}catch(e){console.warn("[AI双向系统] 自动初始化势力系统失败（非致命）:",e)}return r||(0,i.useGameStateStore)().loadFromSaveData(f),{saveData:f,stateChanges:P,onlineLogPosted:T}}async triggerMemorySummary(e){if(this.isSummarizing)return o.o.warning("已有一个总结任务正在进行中，请稍候..."),void console.log("[AI双向系统] 检测到已有总结任务在运行，本次触发被跳过。");this.isSummarizing=!0,console.log("[AI双向系统] 开始记忆总结流程..."),o.o.loading("正在调用AI总结中期记忆...",{id:"memory-summary"});try{const n=(0,i.useGameStateStore)(),a=(0,s.useCharacterStore)(),l=n.toSaveData();if(!l||!l.社交?.记忆)throw new Error("无法获取存档数据或记忆模块");let c={};try{c=JSON.parse(localStorage.getItem("memory-settings")||"{}")}catch{c={}}const u=c.midTermTrigger??25,p=c.midTermKeep??8,v=(c.longTermFormat,l.社交.记忆.中期记忆||[]);if(v.length<u)return console.log(`[AI双向系统] 中期记忆数量(${v.length})未达到触发阈值(${u})，取消总结。`),void o.o.info(`中期记忆未达到触发阈值(${u}条)，已取消总结`,{id:"memory-summary"});const f=u-p;if(f<=0)return console.log("[AI双向系统] 计算出的总结数量 <= 0，配置错误，取消操作。"),void o.o.error("记忆配置错误：触发阈值必须大于保留数量",{id:"memory-summary"});if(v.length<f)return console.log(`[AI双向系统] 中期记忆数量(${v.length})不足以总结${f}条，取消总结。`),void o.o.info(`中期记忆不足${f}条，已取消总结`,{id:"memory-summary"});const h=v.slice(0,f),m=v.slice(f),g=h.map((e,n)=>`${n+1}. ${e}`).join("\n");console.log(`[AI双向系统] 准备总结：从${v.length}条中期记忆中，总结最旧的${f}条，保留最新的${m.length}条`),console.log(`[AI双向系统] 配置：触发阈值=${u}, 保留数量=${p}, 总结数量=${f}`);const b=await(0,d.XH)("memorySummary"),y=b.replace("{{记忆内容}}",g),x=(0,r.getTavernHelper)(),{aiService:k}=await Promise.resolve().then(t.bind(t,7445)),w=k.getConfig(),_=e?.useStreaming??!1!==w.streaming;let C="boolean"!=typeof e?.useRawMode||e.useRawMode;if("boolean"!=typeof e?.useRawMode)try{const{useAPIManagementStore:e}=t(100);C="raw"===e().getFunctionMode("memory_summary")}catch{C="raw"===w.memorySummaryMode}if(!x){const e=k.checkAvailability();if(!e.available)throw new Error(e.message)}const A=this._extractEssentialDataForSummary(l),S=JSON.stringify(A,null,2);let L,E;if(console.log(`[AI双向系统] 记忆总结模式: ${C?"Raw模式（纯净总结）":"标准模式（带预设）"}, 传输方式: ${_?"流式":"非流式"}`),x)if(C){const e=await x.generateRaw({ordered_prompts:[{role:"system",content:`【游戏存档数据】（供参考）：\n${S}`},{role:"user",content:y},{role:"user",content:["Continue.","Proceed.","Next.","Go on.","Resume."][Math.floor(5*Math.random())]},{role:"assistant",content:"</input>"}],should_stream:_,usageType:"memory_summary"});L=String(e)}else{const e=`${b}\n\n【游戏存档数据】（供参考）：\n${S}`,n=await x.generate({user_input:y,should_stream:_,generation_id:`memory_summary_${Date.now()}`,usageType:"memory_summary",injects:[{content:e,role:"system",depth:4,position:"in_chat"},{content:"</input>",role:"assistant",depth:0,position:"in_chat"}]});L=String(n)}else if(C)console.log("[AI双向系统] 自定义API模式 - Raw模式记忆总结"),L=await k.generateRaw({ordered_prompts:[{role:"system",content:`【游戏存档数据】（供参考）：\n${S}`},{role:"user",content:y},{role:"user",content:["Continue.","Proceed.","Next.","Go on.","Resume."][Math.floor(5*Math.random())]}],should_stream:_,usageType:"memory_summary"});else{console.log("[AI双向系统] 自定义API模式 - 标准模式记忆总结");const e=`${b}\n\n【游戏存档数据】（供参考）：\n${S}`;L=await k.generate({user_input:y,should_stream:_,generation_id:`memory_summary_${Date.now()}`,usageType:"memory_summary",injects:[{content:e,role:"system",depth:4,position:"in_chat"}]})}const T=String(L).replace(/<\/input>/g,"").trim(),I=T.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(I?.[1]){const e=I[1].trim();try{E=JSON.parse(e).text?.trim()||""}catch{const n=e.match(/"text"\s*:\s*"([\s\S]*?)"\s*[},]/);if(n?.[1])try{E=JSON.parse('"'+n[1].replace(/"/g,'\\"')+'"').trim()}catch{E=n[1].trim()}else E=e}}else try{E=JSON.parse(T).text?.trim()||""}catch{E=T.trim()}if(!E||0===E.length)throw new Error("AI返回了空的总结结果");console.log("[AI双向系统] 总结文本长度:",E.length,"预览:",E.substring(0,100));const R=E;n.memory||(n.memory={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),n.memory.长期记忆.push(R),n.memory.中期记忆=m;try{const{vectorMemoryService:e}=await Promise.resolve().then(t.bind(t,5184));e.canAutoIndex()&&(await e.addMemory(R,7),console.log("[向量记忆] 新长期记忆已添加到向量库"))}catch(e){console.warn("[向量记忆] 添加到向量库失败:",e)}await a.saveCurrentGame(),console.log(`[AI双向系统] ✅ 总结完成：${f}条中期记忆 -> 1条长期记忆。保留 ${m.length} 条。`),o.o.success(`成功总结 ${f} 条记忆！`,{id:"memory-summary"})}catch(e){const n=e instanceof Error?e.message:"未知错误";console.error("[AI双向系统] 记忆总结失败:",e),o.o.error(`记忆总结失败: ${n}`,{id:"memory-summary"})}finally{this.isSummarizing=!1,console.log("[AI双向系统] 记忆总结流程结束，已释放锁。")}}_preprocessCommands(e){if(!Array.isArray(e))return[];const n=new Set(["角色.背包.物品","背包.物品","物品栏.物品"]),t=["元数据","角色","社交","世界","系统"],a=e=>{if("string"!=typeof e)return e;const n=e.trim();return n?"角色.声望"===n||n.startsWith("角色.声望.")?n.replace(/^角色\.声望/,"角色.属性.声望"):"角色.生命值"===n||n.startsWith("角色.生命值.")?n.replace(/^角色\.生命值/,"角色.属性.生命值"):"角色.灵气"===n||n.startsWith("角色.灵气.")?n.replace(/^角色\.灵气/,"角色.属性.灵气"):"角色.神识"===n||n.startsWith("角色.神识.")?n.replace(/^角色\.神识/,"角色.属性.神识"):"角色.寿命"===n||n.startsWith("角色.寿命.")?n.replace(/^角色\.寿命/,"角色.属性.寿命"):"角色.觉醒阶段"===n||n.startsWith("角色.觉醒阶段.")?n.replace(/^角色\.觉醒阶段/,"角色.身份.觉醒阶段"):"角色.状态效果"===n||n.startsWith("角色.状态效果")?n.replace(/^角色\.状态效果/,"角色.效果"):"游戏时间"===n?"元数据.时间":n.startsWith("游戏时间.")?`元数据.时间.${n.slice(5)}`:"时间"===n?"元数据.时间":n.startsWith("时间.")?`元数据.时间.${n.slice(3)}`:"记忆"===n?"社交.记忆":n.startsWith("记忆.")?`社交.记忆.${n.slice(3)}`:"声望"===n||n.startsWith("声望.")||"生命值"===n||n.startsWith("生命值.")||"灵气"===n||n.startsWith("灵气.")||"神识"===n||n.startsWith("神识.")||"寿命"===n||n.startsWith("寿命.")?`角色.属性.${n}`:"觉醒阶段"===n||n.startsWith("觉醒阶段.")?`角色.身份.${n}`:t.some(e=>n===e||n.startsWith(`${e}.`))?n:"位置"===n||n.startsWith("位置.")||"属性"===n||n.startsWith("属性.")||"背包"===n||n.startsWith("背包.")?`角色.${n}`:"物品栏"===n||n.startsWith("物品栏.")?`角色.背包.${n.slice(4)}`:"装备"===n||n.startsWith("装备.")||"效果"===n||n.startsWith("效果")||"技能"===n||n.startsWith("技能.")?`角色.${n}`:n:e},r=e=>{if(!e||"object"!=typeof e||Array.isArray(e))return null;const n=e.set_state??e.setState??null;if(!n)return null;if(!n||"object"!=typeof n||Array.isArray(n))return null;const t=Object.entries(n);return 0===t.length?[]:(console.warn(`[AI双向系统] 预处理: 发现旧指令格式 set_state，已转换为 ${t.length} 条 set 指令。`),t.map(([e,n])=>({action:"set",key:a(e),value:n})))},o=[];for(const t of e){const e=r(t);if(e)o.push(...e);else if(t&&"object"==typeof t){if("string"==typeof t.key){const e=a(t.key);"string"==typeof e&&e!==t.key&&(console.warn(`[AI双向系统] 预处理: key 纠正 "${t.key}" -> "${e}"`),t.key=e)}if("set"===t.action&&"元数据.时间"===t.key&&t.value&&"object"==typeof t.value&&!Array.isArray(t.value)){const e=t.value;"number"!=typeof e.小时&&(e.小时=0),"number"!=typeof e.分钟&&(e.分钟=0)}if("set"===t.action&&"角色.背包.物品"===t.key&&t.value&&"object"==typeof t.value&&!Array.isArray(t.value)&&(t.value.物品ID&&"string"==typeof t.value.物品ID||"string"==typeof t.value.名称&&t.value.名称||"string"==typeof t.value.类型&&t.value.类型)){const e=t.value,n="string"==typeof e.物品ID&&e.物品ID.trim()?e.物品ID.trim():`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;e.物品ID=n,console.warn(`[AI双向系统] 预处理: 背包物品 set-root→set 角色.背包.物品.${n}`),o.push({action:"set",key:`角色.背包.物品.${n}`,value:e});continue}if("push"===t.action&&"string"==typeof t.key&&n.has(t.key)){let e=t.value??null;if("string"==typeof e){const n=e.trim();e={物品ID:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,名称:n||"未知物品",类型:"杂物",品质:{quality:"凡品",grade:0},数量:1,描述:`一个普通的${n||"物品"}。`}}const n=e&&"object"==typeof e&&"string"==typeof e.物品ID&&e.物品ID.trim()?e.物品ID.trim():`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;e&&"object"==typeof e&&(e.物品ID=n),console.warn(`[AI双向系统] 预处理: 背包物品 push→set 角色.背包.物品.${n}`),o.push({action:"set",key:`角色.背包.物品.${n}`,value:e});continue}if("push"===t.action&&n.has(t.key)&&"string"==typeof t.value){console.warn(`[AI双向系统] 预处理: 将字符串物品 "${t.value}" 转换为对象。`);const e=t.value;o.push({...t,value:{物品ID:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,名称:e,类型:"杂物",品质:{quality:"凡品",grade:0},数量:1,描述:`一个普通的${e}。`}});continue}o.push(t)}else o.push(t)}return o}executeCommand(e,n){const{action:t,key:r,value:o}=e;if(!t||!r)throw new Error("指令格式错误：缺少 action 或 key");const i=r.toString(),s=["元数据","角色","社交","世界","系统"];if(!s.some(e=>i===e||i.startsWith(`${e}.`)))throw new Error(`指令key必须以 ${s.join(" / ")} 开头（V3短路径），当前: ${i}`);if("set"===t&&new Set(["角色.背包","角色.背包.货币","角色.属性","角色.身份","元数据.时间","角色.位置"]).has(i))return void console.warn(`[AI双向系统] 阻止对受保护路径 ${i} 执行set操作`);const l="string"==typeof n?.角色?.身份?.名字?n.角色.身份.名字.trim():"";if(l){const e=i.split("."),n="string"==typeof e[2]?e[2].trim():"";if("社交"===e[0]&&"关系"===e[1]&&n===l&&"delete"!==t)return void console.warn(`[AI双向系统] 阻止将玩家本人写入社交.关系: ${i}`)}const c=["角色.效果","社交.任务.当前任务列表","社交.记忆.短期记忆","社交.记忆.中期记忆","社交.记忆.长期记忆","社交.记忆.隐式中期记忆","系统.历史.叙事"].some(e=>i===e||!(!i.startsWith(e+"[")||i.includes(".",e.length)));if("set"===t&&c){if(null==o)return console.warn(`[AI双向系统] 阻止将数组字段 ${i} 设为 null/undefined，改为空数组`),void(0,a.set)(n,i,[]);if(!Array.isArray(o))return void console.warn(`[AI双向系统] 阻止将数组字段 ${i} 设为非数组值，保持原值`)}if("set"===t){const e=i.split(".");if(["角色.背包","角色.技能","角色.属性","角色.身份","社交.记忆","社交.势力"].includes(i)&&g(o)){const e=(0,a.get)(n,i);if(g(e)){const t=b(e,o);return console.log(`[AI双向系统] 保护模块 ${i}：使用合并而非覆盖`),void(0,a.set)(n,i,t)}}if(3===e.length&&"社交"===e[0]&&"关系"===e[1]&&g(o)){if(l&&"string"==typeof o.名字&&o.名字.trim()===l)return void console.warn(`[AI双向系统] 阻止将玩家本人写入社交.关系: ${i}`);const t=(0,a.get)(n,i),r=b(g(t)?t:{},o);"string"==typeof r.名字&&r.名字||(r.名字=e[2]);const s=n?.元数据?.时间,[c,d]=(0,f.jx)(r,s);if(c&&d)return void(0,a.set)(n,i,d)}}switch(t){case"set":(0,a.set)(n,i,o);break;case"add":{const e=(0,a.get)(n,i,0);if("number"!=typeof e||"number"!=typeof o)throw new Error(`ADD操作要求数值类型，但得到: ${typeof e}, ${typeof o}`);const t=e+o;i.includes("突变结晶")&&t<0?(console.warn(`[AI双向系统] ${i} 执行add后会变成负数 (${e} + ${o} = ${t})，已限制为0`),(0,a.set)(n,i,0)):(0,a.set)(n,i,t);break}case"push":{const e=(0,a.get)(n,i,[]);if(!Array.isArray(e))throw new Error(`PUSH操作要求数组类型，但 ${i} 是 ${typeof e}`);let t=o??null;const r=i.startsWith("社交.记忆.")||i.startsWith("记忆.");if("string"==typeof t&&r&&"社交.记忆.隐式中期记忆"!==i&&"记忆.隐式中期记忆"!==i){if(!t.trim())break;t=`${this._formatGameTime(n.元数据?.时间)}${t}`}e.push(t),(0,a.set)(n,i,e);break}case"delete":(0,a.unset)(n,i);break;case"pull":{const e=(0,a.get)(n,i,[]);if(!Array.isArray(e))throw new Error(`PULL操作要求数组类型，但 ${i} 是 ${typeof e}`);if(!o||"object"!=typeof o)throw new Error("PULL操作要求value是对象类型，用于匹配要移除的元素");const t=o,r=e.filter(e=>{if(!e||"object"!=typeof e)return!0;for(const[n,a]of Object.entries(t))if(e[n]!==a)return!0;return!1});(0,a.set)(n,i,r),console.log(`[AI双向系统] PULL操作: 从 ${i} 移除了 ${e.length-r.length} 个元素`);break}default:throw new Error(`未知的操作类型: ${t}`)}}_extractEssentialDataForSummary(e){const n=(0,a.cloneDeep)(e);return n.系统?.历史?.叙事&&delete n.系统.历史.叙事,n.社交?.记忆&&(delete n.社交.记忆.短期记忆,delete n.社交.记忆.隐式中期记忆),n}_summarizeValueForChangeLog(e,n,t){return null==n||"object"!=typeof n?n:"push"===t||"pull"===t?(0,a.cloneDeep)(n):e.includes("社交.关系.")&&e.includes(".人物记忆")&&Array.isArray(n)&&n.length>0?{__type:"Array",__length:n.length,__summary:`[${n.length}条记忆]`,__last:(0,a.cloneDeep)(n[n.length-1])}:(e.includes("社交.事件")||e.includes("系统.事件"))&&Array.isArray(n)&&n.length>0?{__type:"Array",__length:n.length,__summary:`[${n.length}个事件]`,__last:(0,a.cloneDeep)(n[n.length-1])}:(e.includes("记忆.短期记忆")||e.includes("记忆.中期记忆")||e.includes("记忆.隐式中期记忆"))&&Array.isArray(n)&&n.length>0?{__type:"Array",__length:n.length,__summary:`[${n.length}条记忆]`,__last:(0,a.cloneDeep)(n[n.length-1])}:this._summarizeValue(n)}_summarizeValue(e){if(null==e)return e;if("object"!=typeof e)return e;if(Array.isArray(e))return e.length<=3?(0,a.cloneDeep)(e):{__type:"Array",__length:e.length,__summary:`[数组: ${e.length}个元素]`,__first:e[0]?this._summarizeValue(e[0]):void 0,__last:e[e.length-1]?this._summarizeValue(e[e.length-1]):void 0};const n=Object.keys(e);if(n.length<=5)return(0,a.cloneDeep)(e);const t={__type:"Object",__keys:n.length,__summary:`[对象: ${n.length}个属性]`};return n.slice(0,3).forEach(n=>{t[n]=this._summarizeValue(e[n])}),t}parseAIResponse(e,n=!1){if(!e||"string"!=typeof e)throw new Error("AI响应为空或格式错误");let t=e.trim();t=t.replace(/<thinking>[\s\S]*?<\/thinking>/gi,""),t=t.replace(/<thinking>[\s\S]*/gi,""),t=t.trim(),console.log("[parseAIResponse] 原始响应长度:",t.length),console.log("[parseAIResponse] 原始响应前500字符:",t.substring(0,500)),console.log("[parseAIResponse] 强JSON模式:",n);const a=e=>{const n=(Array.isArray(e.tavern_commands)?e.tavern_commands:Array.isArray(e.指令)?e.指令:Array.isArray(e.commands)?e.commands:[]).map(e=>({action:e.action||"set",key:e.key||"",value:e.value}));let t=Array.isArray(e.action_options)?e.action_options:Array.isArray(e.行动选项)?e.行动选项:[];return t=t.filter(e=>"string"==typeof e&&e.trim().length>0),0===t.length&&(console.warn("[parseAIResponse] ⚠️ action_options为空，使用默认选项"),t=["继续当前活动","观察周围环境","与附近的人交谈","查看自身状态","稍作休息调整"]),{text:String(e.text||e.叙事文本||e.narrative||""),mid_term_memory:String(e.mid_term_memory||e.中期记忆||e.memory||""),tavern_commands:n,action_options:this.sanitizeActionOptionsForDisplay(t)}};try{const e=(0,m.$6)(t,n);return console.log("[parseAIResponse] ✅ 成功解析JSON对象"),a(e)}catch(e){const n=e instanceof Error?e.message:String(e);throw new Error(`无法解析AI响应：${n}`)}}}const k=x.getInstance()},6627:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'/* Theme overrides to improve light/dark readability (focused on dashboard sidebar) */\n\n/* Scrollbars follow theme */\n.right-sidebar .sidebar-content {\n  scrollbar-color: var(--scrollbar-thumb-color) transparent;\n}\n.right-sidebar .sidebar-content::-webkit-scrollbar-thumb {\n  background: var(--scrollbar-thumb-color);\n}\n\n/* Containers use themed surfaces/borders */\n.right-sidebar .ai-chat-section,\n.right-sidebar .info-section,\n.right-sidebar .cultivation-section,\n.right-sidebar .vitals-section,\n.right-sidebar .attributes-section,\n.right-sidebar .location-section,\n.right-sidebar .wealth-section,\n.right-sidebar .collapsible-section {\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.86), rgba(var(--color-surface-rgb), 0.72)) !important;\n  border: 1px solid rgba(var(--color-border-rgb), 0.6) !important;\n}\n\n/* Subtle hover */\n.right-sidebar .section-header:hover {\n  background: var(--color-surface-light) !important;\n}\n\n/* Text colors */\n.right-sidebar .sidebar-title,\n.right-sidebar .detail-value,\n.right-sidebar .vital-text,\n.right-sidebar .effect-name,\n.right-sidebar .realm-name {\n  color: var(--color-text) !important;\n}\n.right-sidebar .detail-label,\n.right-sidebar .state-label,\n.right-sidebar .state-text,\n.right-sidebar .progress-text,\n.right-sidebar .effect-time,\n.right-sidebar .empty-text,\n.right-sidebar .no-char-text,\n.right-sidebar .realm-level,\n.right-sidebar .vital-name {\n  color: var(--color-text-secondary) !important;\n}\n.right-sidebar .section-title { color: var(--color-text) !important; }\n.right-sidebar .section-icon { color: var(--color-primary) !important; }\n\n/* Collapsible toggle icon */\n.right-sidebar .collapse-toggle { color: var(--color-text-secondary) !important; }\n.right-sidebar .collapse-toggle:hover {\n  color: var(--color-text) !important;\n  background: var(--color-surface-light) !important;\n}\n\n/* Vital item cards */\n.right-sidebar .vital-item {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-border) !important;\n}\n.right-sidebar .vital-item:hover {\n  background: var(--color-surface-light) !important;\n  border-color: var(--color-border) !important;\n}\n\n/* Progress bars */\n.right-sidebar .progress-bar { background: var(--color-surface-light) !important; }\n.right-sidebar .progress-fill.health { background: var(--vital-health) !important; }\n.right-sidebar .progress-fill.mana { background: var(--vital-lingqi) !important; }\n.right-sidebar .progress-fill.spirit { background: var(--vital-spirit) !important; }\n.right-sidebar .progress-fill.lifespan { background: var(--vital-lifespan) !important; }\n.right-sidebar .progress-fill.cultivation { background: var(--color-accent) !important; }\n\n/* Status effect cards: neutral base, colored left bar */\n.right-sidebar .status-effect-card {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-border) !important;\n}\n.right-sidebar .status-effect-card::before { background: var(--color-border) !important; }\n.right-sidebar .status-effect-card.buff::before { background: linear-gradient(to bottom, var(--color-success), var(--color-success)) !important; }\n.right-sidebar .status-effect-card.debuff::before { background: linear-gradient(to bottom, var(--color-error), var(--color-error)) !important; }\n\n/* Talent card simplified */\n.right-sidebar .talent-card {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-accent) !important;\n  border-left: 4px solid var(--color-accent) !important;\n}\n.right-sidebar .talent-name { color: var(--color-accent) !important; }\n.right-sidebar .talent-level {\n  color: var(--color-warning) !important;\n  background: var(--color-surface-light) !important;\n  border: 1px solid var(--color-warning) !important;\n}\n\n/* Icons by type */\n.right-sidebar .vital-icon.blood { color: var(--vital-health) !important; }\n.right-sidebar .vital-icon.mana { color: var(--vital-lingqi) !important; }\n.right-sidebar .vital-icon.spirit { color: var(--vital-spirit) !important; }\n.right-sidebar .vital-icon.lifespan { color: var(--vital-lifespan) !important; }\n\n/* Character summary sections keep a subtle primary/accents using existing rgb if available */\n.right-sidebar .character-info-section {\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.88), rgba(var(--color-surface-rgb), 0.74)) !important;\n  border: 1px solid rgba(var(--color-border-rgb), 0.6) !important;\n}\n.right-sidebar .character-state-section {\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.86), rgba(var(--color-surface-rgb), 0.72)) !important;\n  border: 1px solid rgba(var(--color-border-rgb), 0.6) !important;\n}\n\n/* Inventory item count badge: keep readable in both themes */\n.item-quantity-display { color: #f7f7f5 !important; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }\n\n/* ===== 修复右侧面板颜色淡化问题 ===== */\n\n/* 移除可能导致白色遮罩的效果 */\n.right-sidebar,\n.right-panel-area {\n  filter: none !important;\n  backdrop-filter: none !important;\n  -webkit-backdrop-filter: none !important;\n  mix-blend-mode: normal !important;\n  opacity: 1 !important;\n}\n\n/* 确保右侧面板的背景完全不透明 */\n.right-sidebar {\n  background: linear-gradient(180deg, rgba(var(--color-surface-rgb), 0.96) 0%, rgba(var(--color-surface-rgb), 0.82) 100%) !important;\n}\n\n/* 移除任何可能的伪元素遮罩 */\n.right-sidebar::before,\n.right-sidebar::after {\n  display: block !important;\n}\n.right-panel-area::before,\n.right-panel-area::after {\n  display: none !important;\n}\n\n/* ===== 按钮文字溢出和居中修复 ===== */\n\n/* 通用按钮最小宽度和居中样式 */\nbutton {\n  min-width: fit-content;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* RetryConfirmDialog 按钮修复 */\n.retry-dialog .btn-primary,\n.retry-dialog .btn-secondary {\n  min-width: 100px !important; /* 确保最小宽度 */\n  padding: 12px 24px !important; /* 增加左右内边距防止文字溢出 */\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* DataClearButtons 按钮修复 */\n.clear-button {\n  min-width: 120px !important; /* 防止"清除自定义数据"等长文字溢出 */\n  padding: 0.4rem 1rem !important; /* 增加左右内边距 */\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n  gap: 0.25rem;\n}\n\n.clear-button .clear-text {\n  flex: 1;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* SavePanel 操作按钮修复 */\n.operation-btn {\n  min-width: 140px !important; /* 为"导出存档"、"导入存档"等按钮设置最小宽度 */\n  padding: 1rem 1.2rem !important;\n  text-align: center;\n}\n\n.operation-btn .btn-content {\n  width: 100%;\n  text-align: center;\n}\n\n.operation-btn .btn-title {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* MainGamePanel 中的快捷操作按钮修复 */\n.quick-action-btn {\n  min-width: 80px !important; /* 确保按钮最小宽度 */\n  min-height: 70px;\n  padding: 12px 10px !important; /* 增加左右内边距 */\n  text-align: center;\n  display: flex !important;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n}\n\n.quick-action-btn .action-text {\n  width: 100%;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 0.8rem;\n  line-height: 1.2;\n}\n\n/* 配置弹窗按钮修复 */\n.cancel-btn,\n.confirm-btn {\n  min-width: 80px !important; /* 确保"取消"、"确认"按钮最小宽度 */\n  padding: 8px 24px !important; /* 增加左右内边距 */\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* LocalPromptModal 按钮修复 */\n.cancel-button {\n  min-width: 80px !important;\n  padding: 8px 24px !important;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 通用按钮文字居中修复 */\n.action-text,\n.btn-title {\n  text-align: center !important;\n  width: 100%;\n  display: block;\n}\n\n/* action-btn 内的元素保持正常 flex 布局 */\n.action-btn {\n  display: flex !important;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.action-btn .btn-text {\n  display: inline !important;\n  width: auto !important;\n  text-align: left !important;\n  font-size: inherit;\n  color: inherit;\n}\n\n.action-btn svg {\n  flex-shrink: 0;\n}\n\n/* 修复LeftSidebar中的按钮 */\n.left-sidebar .nav-btn {\n  min-width: 100%;\n  text-align: left; /* LeftSidebar按钮应该左对齐 */\n}\n\n.left-sidebar .nav-btn .btn-text,\n.left-sidebar .nav-btn .btn-desc {\n  text-align: left;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* TopBar中的全屏按钮 */\n.fullscreen-btn {\n  min-width: 32px !important;\n  min-height: 32px !important;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 发送按钮修复 */\n.send-button {\n  min-width: 60px !important;\n  padding: 12px 24px !important;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 行动选择器按钮修复 */\n.action-selector-btn {\n  min-width: 44px !important;\n  min-height: 44px !important;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 响应式调整 */\n@media (max-width: 640px) {\n  .clear-button {\n    min-width: 100px !important;\n    padding: 0.3rem 0.8rem !important;\n  }\n  \n  .operation-btn {\n    min-width: 120px !important;\n    padding: 0.8rem 1rem !important;\n  }\n  \n  .quick-action-btn {\n    min-width: 70px !important;\n    min-height: 60px;\n    padding: 8px 6px !important;\n  }\n  \n  .cancel-btn,\n  .confirm-btn {\n    min-width: 70px !important;\n    padding: 6px 18px !important;\n  }\n  \n  .send-button {\n    min-width: 50px !important;\n    padding: 10px 20px !important;\n  }\n}\n\n@media (max-width: 480px) {\n  .clear-button {\n    min-width: 90px !important;\n    padding: 0.25rem 0.6rem !important;\n  }\n  \n  .operation-btn {\n    min-width: 100px !important;\n    padding: 0.6rem 0.8rem !important;\n  }\n  \n  .quick-action-btn {\n    min-width: 60px !important;\n    min-height: 50px;\n    padding: 6px 4px !important;\n  }\n  \n  .cancel-btn,\n  .confirm-btn {\n    min-width: 60px !important;\n    padding: 6px 15px !important;\n  }\n  \n  .send-button {\n    min-width: 45px !important;\n    padding: 8px 16px !important;\n  }\n}\n\n',""]);const s=i},6680:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6719:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.title-section[data-v-6dbb57d9] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.preset-count[data-v-6dbb57d9] {\n  padding: 0.25rem 0.6rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.75rem;\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.header-actions[data-v-6dbb57d9] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.btn-action[data-v-6dbb57d9] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.5rem 0.9rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.btn-action .btn-icon[data-v-6dbb57d9] {\n  font-size: 1.1rem;\n  display: flex;\n  align-items: center;\n}\n.btn-action .btn-text[data-v-6dbb57d9] {\n  white-space: nowrap;\n}\n.btn-action.import[data-v-6dbb57d9]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.2);\n}\n.btn-action.export[data-v-6dbb57d9]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.1), rgba(var(--color-primary-rgb), 0.1));\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(var(--color-accent-rgb), 0.2);\n}\n.btn-delete[data-v-6dbb57d9] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 1.2rem;\n  padding: 0 0.5rem;\n  border-radius: 4px;\n  margin-left: 0.5rem;\n  transition: all 0.2s ease;\n}\n.btn-delete[data-v-6dbb57d9]:hover {\n  background-color: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n}\n.preset-actions[data-v-6dbb57d9] {\n  display: flex;\n  align-items: center;\n}\n.modal-overlay[data-v-6dbb57d9] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-6dbb57d9] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-6dbb57d9 0.3s ease-out;\n}\n@keyframes slideUp-6dbb57d9 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-6dbb57d9] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-6dbb57d9] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-6dbb57d9] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-6dbb57d9]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-6dbb57d9] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n  min-height: 200px;\n}\n\n/* Loading State */\n.loading-state[data-v-6dbb57d9] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem;\n  gap: 1rem;\n}\n.spinner[data-v-6dbb57d9] {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(var(--color-primary-rgb), 0.2);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-6dbb57d9 1s linear infinite;\n}\n@keyframes spin-6dbb57d9 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* Empty State */\n.empty-state[data-v-6dbb57d9] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 2rem;\n  text-align: center;\n}\n.empty-icon[data-v-6dbb57d9] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  opacity: 0.5;\n}\n.empty-state p[data-v-6dbb57d9] {\n  margin: 0.5rem 0;\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-6dbb57d9] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n  max-width: 300px;\n}\n\n/* Presets List */\n.presets-list[data-v-6dbb57d9] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.preset-item[data-v-6dbb57d9] {\n  padding: 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: var(--color-surface-light);\n}\n.preset-item[data-v-6dbb57d9]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n.preset-item.selected[data-v-6dbb57d9] {\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.preset-header[data-v-6dbb57d9] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.preset-name[data-v-6dbb57d9] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.preset-date[data-v-6dbb57d9] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.preset-description[data-v-6dbb57d9] {\n  margin: 0.5rem 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  line-height: 1.4;\n}\n.preset-info[data-v-6dbb57d9] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  flex-wrap: wrap;\n}\n.info-tag[data-v-6dbb57d9] {\n  padding: 0.25rem 0.75rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.75rem;\n  color: var(--color-primary);\n}\n.info-tag.name-tag[data-v-6dbb57d9] {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.15), rgba(var(--color-primary-rgb), 0.15));\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n  font-weight: 600;\n}\n.info-tag.age-tag[data-v-6dbb57d9] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n}\n.modal-footer[data-v-6dbb57d9] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-6dbb57d9] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-6dbb57d9] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-6dbb57d9]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-6dbb57d9] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-6dbb57d9]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-6dbb57d9]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-6dbb57d9] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-6dbb57d9] {\n    padding: 1rem;\n}\n.modal-title[data-v-6dbb57d9] {\n    font-size: 1.1rem;\n}\n.btn-action .btn-text[data-v-6dbb57d9] {\n    display: none;\n}\n.btn-action[data-v-6dbb57d9] {\n    padding: 0.5rem;\n    min-width: 36px;\n}\n.modal-content[data-v-6dbb57d9] {\n    padding: 1rem;\n}\n.preset-item[data-v-6dbb57d9] {\n    padding: 0.75rem;\n}\n.modal-footer[data-v-6dbb57d9] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-6dbb57d9] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},6728:(e,n,t)=>{"use strict";t.d(n,{Ew:()=>d,FY:()=>o,Nz:()=>s,Yk:()=>c,_p:()=>l});var a=t(3943),r=t(7527);function o(e,n){const t={hp:0,sp:0,st:0,san:0},a={生命值:"hp",生命:"hp",HP:"hp",生命值上限:"hp",生命上限:"hp",HP上限:"hp",精神力:"sp",精神:"sp",SP:"sp",精神力上限:"sp",精神上限:"sp",SP上限:"sp",体力:"st",ST:"st",体力上限:"st",ST上限:"st",理智值:"san",理智:"san",SAN:"san",理智值上限:"san",理智上限:"san",SAN上限:"san"};return Object.entries(e).forEach(([e,r])=>{if(r&&n.物品&&n.物品[r]){const e=n.物品[r];if("装备"===e.类型&&e.装备增幅){const n=e=>{e&&"object"==typeof e&&Object.entries(e).forEach(([e,n])=>{const r=a[e];if(r){const e=Number(n);isNaN(e)||(t[r]+=e)}})};n(e.装备增幅),n(e.装备增幅.衍生属性)}}}),t}function i(e,n){const t=n.角色?.身份??null,o=t?.后天属性||{},i={力量:Number(o.力量??0),敏捷:Number(o.敏捷??0),体质:Number(o.体质??0),意志:Number(o.意志??0),魅力:Number(o.魅力??0),幸运:Number(o.幸运??0)},s=function(e,n){const t={力量:0,体质:0,敏捷:0,意志:0,魅力:0,幸运:0};return console.log("[装备加成计算] 开始计算装备加成"),console.log("[装备加成计算] 装备栏数据:",e),console.log("[装备加成计算] 背包物品数据:",n?.物品),Object.entries(e).forEach(([e,a])=>{if(console.log(`[装备加成计算] 检查槽位 ${e}, itemId: ${a}`),a&&n.物品&&n.物品[a]){const e=n.物品[a];if(console.log("[装备加成计算] 找到物品:",e),"装备"===e.类型&&e.装备增幅){console.log(`[装备加成计算] 物品 ${e.名称} 有装备增幅:`,e.装备增幅);const n=e.装备增幅.后天属性||{},a=e.装备增幅.核心属性||{},r={},o=["力量","敏捷","体质","意志","魅力","幸运"];Object.entries(e.装备增幅).forEach(([e,n])=>{o.includes(e)&&"number"==typeof n&&(r[e]=n)});const i={...r,...a,...n};Object.keys(i).length>0?Object.entries(i).forEach(([n,a])=>{if(n in t){const r=Number(a);isNaN(r)?console.warn(`[装备加成计算] 属性 ${n} 的值 "${a}" 不是一个有效的数字，已忽略。物品: ${e.名称}`):(console.log(`[装备加成计算] 添加属性加成: ${n} +${r} (原始值: ${a})`),t[n]+=r)}}):console.log(`[装备加成计算] 物品 ${e.名称} 的装备增幅中未发现有效核心属性`)}else console.log(`[装备加成计算] 物品 ${e.名称} 没有装备增幅`)}else console.log(`[装备加成计算] 槽位 ${e} 为空或物品不存在`)}),console.log("[装备加成计算] 最终装备加成:",t),t}(n.角色?.装备??null,n.角色?.背包??null),l=function(e){const n={力量:0,体质:0,敏捷:0,意志:0,魅力:0,幸运:0},t=e.角色?.身份??null,a=t?.天赋||[];return a.map(e=>"string"==typeof e?e:e&&"object"==typeof e&&e.名称?e.名称:null).filter(Boolean),a.forEach(e=>{let t,a;if("string"==typeof e?(a=e,t=r.qS.find(e=>e.name===a)):e&&"object"==typeof e&&(a=e.名称||"",t=r.qS.find(e=>e.name===a),!t&&e.effects&&(t={id:0,name:a,description:e.描述||"",talent_cost:0,rarity:1,effects:e.effects})),t&&t.effects){const e=function(e){const n={力量:0,敏捷:0,体质:0,意志:0,魅力:0,幸运:0},t={STR:"力量",strength:"力量",CON:"体质",constitution:"体质",DEX:"敏捷",AGI:"敏捷",agility:"敏捷",INT:"意志",intellect:"意志",WIL:"意志",willpower:"意志",SPI:"意志",CHA:"魅力",charm:"魅力",LUK:"幸运",luck:"幸运",SAN:"意志"};return e.forEach(e=>{e.effects&&Array.isArray(e.effects)&&e.effects.forEach(e=>{if("string"==typeof e)return;const a=e.type||e.类型,r=e.target||e.目标,o=Number(e.value??e.数值)||0;if(r&&("后天属性"===a||"ATTRIBUTE_MODIFIER"===a)){let e=r;t[r]?e=t[r]:("神识"===r&&(e="意志"),"心性"===r&&(e="体质"),"幸运"===r&&(e="幸运")),e&&e in n&&(n[e]+=o)}})}),n}([t]);Object.keys(n).forEach(t=>{n[t]+=e[t]})}}),n}(n),c=function(e){const n={力量:0,敏捷:0,体质:0,意志:0,魅力:0,幸运:0},t=(e?.角色?.效果||[]).filter(e=>!!e),r=e?.元数据?.时间??null,o={STR:"力量",strength:"力量",CON:"体质",constitution:"体质",DEX:"敏捷",AGI:"敏捷",agility:"敏捷",INT:"意志",intellect:"意志",WIL:"意志",willpower:"意志",SPI:"意志",CHA:"魅力",charm:"魅力",LUK:"幸运",luck:"幸运"};for(const e of t){if(r&&(0,a.Bj)(e,r))continue;const t=e.属性加成||e.后天属性||null;t&&"object"==typeof t&&Object.entries(t).forEach(([e,t])=>{const a=Number(t);if(isNaN(a))return;const r=o[e]??e;r in n&&(n[r]+=a)})}return n}(n),d={力量:Number(i.力量)+Number(s.力量)+Number(l.力量)+Number(c.力量),敏捷:Number(i.敏捷)+Number(s.敏捷)+Number(l.敏捷)+Number(c.敏捷),体质:Number(i.体质)+Number(s.体质)+Number(l.体质)+Number(c.体质),意志:Number(i.意志)+Number(s.意志)+Number(l.意志)+Number(c.意志),魅力:Number(i.魅力)+Number(s.魅力)+Number(l.魅力)+Number(c.魅力),幸运:Number(i.幸运)+Number(s.幸运)+Number(l.幸运)+Number(c.幸运)};return{先天属性:e,后天属性:d,最终属性:{力量:Number(e.力量)+Number(d.力量),敏捷:Number(e.敏捷)+Number(d.敏捷),体质:Number(e.体质)+Number(d.体质),意志:Number(e.意志)+Number(d.意志),魅力:Number(e.魅力)+Number(d.魅力),幸运:Number(e.幸运)+Number(d.幸运)}}}function s(e,n,t){const a=t?.entityType??("凡人"===n?"ordinary_human":"awakened_human"),r=t?.mutationBonuses??{},o=t?.equipmentDerivedBonuses??{},i={凡人:{hp:1.5,sp:1,st:.8,san:1.2},觉醒期:{hp:1.8,sp:1.5,st:1,san:1},掌控期:{hp:2.2,sp:2,st:1.2,san:.9},精通期:{hp:3,sp:2.8,st:1.5,san:.8},质变期:{hp:4,sp:4,st:2,san:.6},突破期:{hp:6,sp:6,st:4,san:.8},传说期:{hp:10,sp:10,st:10,san:1}},s=i[{凡人:"凡人","凡人/未觉醒":"凡人",觉醒期:"觉醒期",掌控期:"掌控期",精通期:"精通期",质变期:"质变期",突破期:"质变期",传说期:"突破期"}[String(n)]??"觉醒期"]??i["觉醒期"],l=e.STR,c=(e.AGI,e.CON),d=e.WIL,u=(e.CHA,e.LCK);let p=0,v=0,f=0,h=0;if("ordinary_human"===a)p=c*s.hp+5,v=d*s.sp,f=(c+l)*s.st+10,h=d*s.san+u/2+15;else if("awakened_human"===a){const e=c+Number(r.CON??0),n=d+Number(r.WIL??0),t=l+Number(r.STR??0);p=e*s.hp+10,v=n*s.sp+5,f=(e+t)*s.st+15,h=d*s.san+u/2+10}else"mutated_beast"===a?(p=c*s.hp*2+20,v=d*s.sp,f=(c+l)*s.st+20,h=d*s.san):(p=c*s.hp+25,v=d*s.sp*1.5+10,f=(c+l)*s.st+10,h=d*s.san*2+u/2+20);const m=Math.round(p+(o.hp??0)),g=Math.round(v+(o.sp??0)),b=Math.round(f+(o.st??0)),y=Math.round(h+(o.san??0));return{HP:{当前:m,上限:m},SP:{当前:g,上限:g},ST:{当前:b,上限:b},SAN:{当前:y,上限:y}}}function l(e,n,t){const a=t?.entityType??("凡人"===n?"ordinary_human":"awakened_human"),r=t?.mutationBonuses??{},o={凡人:{phys_atk:.7,spec_atk:.7,phys_def:.7,spec_def:.7},觉醒期:{phys_atk:.8,spec_atk:.8,phys_def:.8,spec_def:.8},掌控期:{phys_atk:1,spec_atk:1,phys_def:1,spec_def:1},精通期:{phys_atk:1.3,spec_atk:1.2,phys_def:1.2,spec_def:1.2},质变期:{phys_atk:1.8,spec_atk:1.5,phys_def:1.5,spec_def:1.5},突破期:{phys_atk:2.4,spec_atk:2.4,phys_def:2.4,spec_def:2.4},传说期:{phys_atk:5,spec_atk:5,phys_def:5,spec_def:5}},i=o[{凡人:"凡人","凡人/未觉醒":"凡人",觉醒期:"觉醒期",掌控期:"掌控期",精通期:"精通期",质变期:"突破期",突破期:"传说期"}[String(n)]??"觉醒期"]??o["觉醒期"],s=e.STR+Number(r.STR??0),l=e.AGI+Number(r.AGI??0),c=e.CON+Number(r.CON??0),d=e.WIL+Number(r.WIL??0),u=e.CHA+Number(r.CHA??0);let p=0,v=0,f=0,h=0;return"ordinary_human"===a?(p=(s+l)*i.phys_atk/2,v=.5*d,f=(c+l)*i.phys_def/2,h=d*i.spec_def):"awakened_human"===a?(p=(s+l)*i.phys_atk/2+Number(r.STR??0),v=(d+u)*i.spec_atk/2+Number(t?.abilityTypeBonus??0),f=(c+l)*i.phys_def/2+Number(r.CON??0),h=d*i.spec_def+Number(r.WIL??0)):"mutated_beast"===a?(p=(s+l)*i.phys_atk/1.5+Number(t?.organBonus??0),v=d,f=(c+l)*i.phys_def/1.5+Number(t?.naturalArmor??0),h=d*i.spec_def):(p=(s+l)*i.phys_atk/2+Number(t?.ancientSkillBonus??0),v=(d+u)*i.spec_atk+Number(t?.ancientRuleBonus??0),f=(c+l)*i.phys_def/2,h=d*i.spec_def*1.5),{physAtk:Math.round(p),specAtk:Math.round(v),physDef:Math.round(f),specDef:Math.round(h)}}function c(e){return{STR:Number(e.力量??0),AGI:Number(e.敏捷??0),CON:Number(e.体质??0),WIL:Number(e.意志??0),CHA:Number(e.魅力??0),LCK:Number(e.幸运??0)}}function d(e){const n=e?.角色?.身份??{},t=n?.核心属性,a=(t&&"object"==typeof t?{力量:Number(t.力量??0),敏捷:Number(t.敏捷??0),体质:Number(t.体质??0),意志:Number(t.意志??0),魅力:Number(t.魅力??0),幸运:Number(t.幸运??0)}:null)??{力量:Number(n?.先天属性?.力量??0),敏捷:Number(n?.先天属性?.敏捷??0),体质:Number(n?.先天属性?.体质??0),意志:Number(n?.先天属性?.意志??0),魅力:Number(n?.先天属性?.魅力??0),幸运:Number(n?.先天属性?.幸运??0)},{最终属性:r}=i(a,e);return c(r)}},6743:(e,n,t)=>{"use strict";var a=t(9353);e.exports=Function.prototype.bind||a},6750:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.inventory-content[data-v-73d16fe1] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  overflow: hidden;\n}\n\n/* 自定义确认弹窗样式 */\n.custom-confirm-overlay[data-v-73d16fe1] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  z-index: 2000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.custom-confirm-modal[data-v-73d16fe1] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 400px;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: modal-appear-73d16fe1 0.3s ease-out;\n  border: 1px solid var(--color-primary-border);\n}\n.confirm-header[data-v-73d16fe1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px 16px 24px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-primary-light);\n}\n.confirm-header h3[data-v-73d16fe1] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.confirm-close-btn[data-v-73d16fe1] {\n  background: none;\n  border: none;\n  padding: 4px;\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n}\n.confirm-close-btn[data-v-73d16fe1]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.confirm-content[data-v-73d16fe1] {\n  padding: 24px;\n}\n.confirm-content p[data-v-73d16fe1] {\n  margin: 0;\n  color: var(--color-text);\n  line-height: 1.6;\n  white-space: pre-line;\n}\n.confirm-actions[data-v-73d16fe1] {\n  display: flex;\n  gap: 12px;\n  padding: 16px 24px 24px 24px;\n  justify-content: flex-end;\n}\n.confirm-btn[data-v-73d16fe1] {\n  padding: 10px 20px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 80px;\n}\n.cancel-btn[data-v-73d16fe1] {\n  background: var(--color-surface-hover);\n  color: var(--color-text-secondary);\n}\n.cancel-btn[data-v-73d16fe1]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.confirm-btn.confirm-btn[data-v-73d16fe1] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.confirm-btn.confirm-btn[data-v-73d16fe1]:hover {\n  background: var(--color-primary-hover);\n}\n\n/* 移动端模态框 */\n.item-modal-overlay[data-v-73d16fe1] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.item-modal[data-v-73d16fe1] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 400px;\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: modal-appear-73d16fe1 0.3s ease-out;\n  border: 1px solid var(--color-primary-border);\n}\n@keyframes modal-appear-73d16fe1 {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n.modal-header[data-v-73d16fe1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-primary-light);\n}\n.modal-header h3[data-v-73d16fe1] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n}\n.modal-close-btn[data-v-73d16fe1] {\n  background: none;\n  border: none;\n  padding: 4px;\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n}\n.modal-close-btn[data-v-73d16fe1]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.modal-content[data-v-73d16fe1] {\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n}\n.modal-icon-simple[data-v-73d16fe1] {\n  width: 80px;\n  height: 80px;\n  border-radius: 12px;\n  border: 3px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 16px;\n  background: var(--color-surface-hover);\n  font-weight: bold;\n  font-size: 14px;\n  color: var(--color-text);\n}\n.modal-info[data-v-73d16fe1] {\n  width: 100%;\n}\n.modal-meta[data-v-73d16fe1] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  margin-bottom: 12px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n.grade-display[data-v-73d16fe1] {\n  font-size: 0.8rem;\n  font-weight: bold;\n  padding: 2px 6px;\n  border-radius: 4px;\n  border: 1px solid currentColor;\n  white-space: nowrap;\n}\n\n/* 品级颜色样式 */\n.grade-display.grade-broken[data-v-73d16fe1] {\n  background: #6b7280;\n  color: white;\n  border-color: #6b7280;\n}\n.grade-display.grade-low[data-v-73d16fe1] {\n  background: #10b981; /* 绿色 - 下级 */\n  color: white;\n  border-color: #10b981;\n}\n.grade-display.grade-mid[data-v-73d16fe1] {\n  background: #3b82f6; /* 蓝色 - 中级 */\n  color: white;\n  border-color: #3b82f6;\n}\n.grade-display.grade-high[data-v-73d16fe1] {\n  background: #8b5cf6; /* 紫色 - 上级 */\n  color: white;\n  border-color: #8b5cf6;\n}\n.grade-display.grade-perfect[data-v-73d16fe1] {\n  background: #f59e0b; /* 金色 - 顶级 */\n  color: white;\n  border-color: #f59e0b;\n}\n.grade-display.grade-unknown[data-v-73d16fe1] {\n  background: #9ca3af;\n  color: white;\n  border-color: #9ca3af;\n}\n.grade-display.grade-custom[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #06b6d4, #a855f7);\n  color: white;\n  border-color: #06b6d4;\n}\n.modal-description[data-v-73d16fe1] {\n  color: var(--color-text);\n  line-height: 1.6;\n  margin-bottom: 16px;\n}\n.modal-attributes[data-v-73d16fe1] {\n  background: var(--color-surface-light);\n  border-radius: 8px;\n  padding: 12px;\n  margin-top: 16px;\n}\n.modal-attributes h4[data-v-73d16fe1] {\n  margin: 0 0 8px 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n}\n.modal-actions[data-v-73d16fe1] {\n  display: flex;\n  gap: 8px;\n  padding: 16px 20px;\n  border-top: 1px solid var(--color-border);\n}\n\n/* 主内容区域 */\n.inventory-content[data-v-73d16fe1] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n/* 标签导航 */\n.tabs-header[data-v-73d16fe1] {\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n  padding: 16px;\n  flex-shrink: 0;\n  border-radius: 12px 12px 0 0;\n}\n.tabs-nav[data-v-73d16fe1] {\n  display: flex;\n  gap: 4px;\n  margin-bottom: 16px;\n}\n.tab-btn[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 16px;\n  border: none;\n  border-radius: 8px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-weight: 500;\n}\n.tab-btn[data-v-73d16fe1]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-73d16fe1] {\n  background: var(--color-primary);\n  color: white;\n}\n\n/* 工具栏 */\n.tools-section[data-v-73d16fe1] {\n  display: flex;\n  gap: 12px;\n  align-items: center;\n  flex-wrap: wrap;\n}\n.search-box[data-v-73d16fe1] {\n  position: relative;\n  flex: 1;\n  min-width: 150px;\n}\n.search-icon[data-v-73d16fe1] {\n  position: absolute;\n  left: 12px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: var(--color-text-secondary);\n  z-index: 1;\n}\n.search-box input[data-v-73d16fe1] {\n  width: 100%;\n  padding: 10px 12px 10px 40px;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-background);\n  font-size: 14px;\n  transition: all 0.2s ease;\n}\n.search-box input[data-v-73d16fe1]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.filter-buttons[data-v-73d16fe1] {\n  display: flex;\n  gap: 8px;\n}\n.filter-select[data-v-73d16fe1] {\n  padding: 8px 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 13px;\n  min-width: 80px;\n}\n.filter-select option[data-v-73d16fe1] {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n.refresh-btn[data-v-73d16fe1] {\n  padding: 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 32px;\n  height: 32px;\n}\n.refresh-btn[data-v-73d16fe1]:hover:not(:disabled) {\n  background: var(--color-surface-hover);\n  color: var(--color-primary);\n  border-color: var(--color-primary);\n}\n.refresh-btn[data-v-73d16fe1]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.refresh-btn .spinning[data-v-73d16fe1] {\n  animation: spin-73d16fe1 1s linear infinite;\n}\n\n/* 标签内容 */\n.tab-content[data-v-73d16fe1] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n}\n\n/* 物品标签 */\n.items-tab[data-v-73d16fe1] {\n  display: flex;\n  height: 100%;\n}\n.items-grid[data-v-73d16fe1] {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n  grid-auto-rows: minmax(160px, auto);\n  gap: 18px;\n  align-content: start;\n  background: var(--color-background);\n}\n.grid-placeholder[data-v-73d16fe1] {\n  grid-column: 1 / -1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40px;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n.filter-tip[data-v-73d16fe1] {\n  font-size: 0.8rem;\n  color: var(--color-text-muted);\n  margin-top: 8px;\n  opacity: 0.8;\n}\n.loading-spinner[data-v-73d16fe1] {\n  width: 32px;\n  height: 32px;\n  border: 3px solid var(--color-border);\n  border-top: 3px solid var(--color-primary);\n  border-radius: 50%;\n  animation: spin-73d16fe1 1s linear infinite;\n  margin-bottom: 16px;\n}\n@keyframes spin-73d16fe1 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 物品卡片 - 重新设计美观布局 */\n.item-card[data-v-73d16fe1] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 10px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  display: flex;\n  flex-direction: column;\n  min-height: 160px;\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n.item-card[data-v-73d16fe1]:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  background: var(--color-surface-light);\n}\n\n/* 顶部区域：图标和品质 */\n.item-top-section[data-v-73d16fe1] {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  margin-bottom: 8px;\n}\n.item-icon-area[data-v-73d16fe1] {\n  width: 48px;\n  height: 48px;\n  border-radius: 8px;\n  border: 2px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  position: relative;\n}\n.item-type-icon[data-v-73d16fe1] {\n  font-size: 24px;\n  opacity: 0.9;\n}\n.item-quality-badge[data-v-73d16fe1] {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  font-size: 10px;\n  font-weight: bold;\n  padding: 3px 6px;\n  border-radius: 6px;\n  background: var(--color-surface);\n  border: 1px solid currentColor;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  z-index: 2;\n  min-width: 20px;\n  text-align: center;\n}\n\n/* 数量显示 - 更大更显眼 */\n.item-quantity-display[data-v-73d16fe1] {\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  /* 仅改变文字颜色，不改背景 */\n  background: transparent;\n  color: var(--color-accent, #7c4dff);\n  font-size: 12px;\n  font-weight: 700;\n  padding: 0;\n  border-radius: 0;\n  box-shadow: none;\n  border: none;\n  z-index: 4;\n  min-width: 0;\n  text-align: right;\n}\n\n/* 名称区域 */\n.item-name-section[data-v-73d16fe1] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: 4px;\n  min-height: 40px;\n}\n.item-name[data-v-73d16fe1] {\n  font-size: 13px;\n  font-weight: 600;\n  line-height: 1.4;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n  word-break: break-word;\n  color: var(--color-text);\n}\n\n/* 底部区域：类型和品级 */\n.item-bottom-section[data-v-73d16fe1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 6px;\n  margin-top: auto;\n  padding-top: 6px;\n  flex-wrap: wrap;\n}\n.item-type-label[data-v-73d16fe1] {\n  font-size: 10px;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  padding: 3px 8px;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  flex-shrink: 0;\n  white-space: nowrap;\n}\n.item-grade-info[data-v-73d16fe1] {\n  font-size: 9px;\n  font-weight: bold;\n  padding: 3px 6px;\n  border-radius: 4px;\n  border: 1px solid currentColor;\n  background: rgba(255, 255, 255, 0.9);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  flex-shrink: 0;\n  white-space: nowrap;\n}\n\n/* 品级样式 - 简化版本 */\n.grade-broken[data-v-73d16fe1] {\n  background: #6b7280;\n  color: white;\n}\n.grade-low[data-v-73d16fe1] {\n  background: #10b981; /* 绿色 - 下级 */\n  color: white;\n}\n.grade-mid[data-v-73d16fe1] {\n  background: #3b82f6; /* 蓝色 - 中级 */\n  color: white;\n}\n.grade-high[data-v-73d16fe1] {\n  background: #8b5cf6; /* 紫色 - 上级 */\n  color: white;\n}\n.grade-perfect[data-v-73d16fe1] {\n  background: #f59e0b; /* 金色 - 顶级 */\n  color: white;\n}\n.grade-unknown[data-v-73d16fe1] {\n  background: #9ca3af;\n  color: white;\n}\n.grade-custom[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #06b6d4, #a855f7);\n  color: white;\n}\n\n/* 突变结晶品质样式 - 颜色递增 */\n.grade-common[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #9ca3af, #6b7280);\n  border-color: #9ca3af;\n  color: white;\n  box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);\n}\n.grade-rare[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: #3b82f6;\n  color: white;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);\n}\n.grade-epic[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n  border-color: #8b5cf6;\n  color: white;\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);\n}\n.grade-legend[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #f59e0b, #d97706);\n  border-color: #f59e0b;\n  color: white;\n  box-shadow: 0 2px 12px rgba(245, 158, 11, 0.5);\n}\n\n/* 桌面端详情侧边栏 */\n.item-details-sidebar[data-v-73d16fe1] {\n  width: 320px;\n  border-left: 1px solid var(--color-border);\n  background: var(--color-surface);\n  display: flex;\n  flex-direction: column;\n}\n.details-content[data-v-73d16fe1] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.details-header[data-v-73d16fe1] {\n  padding: 20px;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.details-icon-large[data-v-73d16fe1] {\n  width: 60px;\n  height: 60px;\n  border-radius: 10px;\n  border: 2px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  flex-shrink: 0;\n  font-weight: bold;\n  font-size: 12px;\n  color: var(--color-text);\n}\n.details-title-area h3[data-v-73d16fe1] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n.details-meta[data-v-73d16fe1] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-top: 4px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n.details-body[data-v-73d16fe1] {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n}\n.details-description[data-v-73d16fe1] {\n  color: var(--color-text);\n  line-height: 1.6;\n  margin-bottom: 20px;\n}\n.details-attributes h4[data-v-73d16fe1] {\n  margin: 0 0 12px 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n}\n.details-placeholder[data-v-73d16fe1] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n.details-actions[data-v-73d16fe1] {\n  padding: 16px 20px;\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  gap: 8px;\n}\n\n/* 财产管理标签 */\n.currency-tab[data-v-73d16fe1] {\n  padding: 24px;\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n}\n.currency-summary[data-v-73d16fe1] {\n  display: flex;\n  align-items: baseline;\n  gap: 12px;\n  padding: 12px 14px;\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-surface);\n  margin-bottom: 16px;\n}\n.summary-title[data-v-73d16fe1] {\n  font-size: 0.9rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.summary-value[data-v-73d16fe1] {\n  font-size: 1rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.summary-unit[data-v-73d16fe1] {\n  margin-left: 6px;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.summary-hint[data-v-73d16fe1] {\n  margin-left: auto;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.currency-grid[data-v-73d16fe1] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 16px;\n  width: 100%;\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n  padding-right: 4px;\n}\n.currency-card[data-v-73d16fe1] {\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  transition: all 0.3s ease;\n  cursor: default;\n  position: relative;\n  overflow: hidden;\n}\n.currency-card[data-v-73d16fe1]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 4px;\n  opacity: 0.8;\n  transition: opacity 0.3s ease;\n}\n.currency-card.grade-common[data-v-73d16fe1]::before {\n  background: linear-gradient(90deg, #9ca3af, #6b7280);\n}\n.currency-card.grade-rare[data-v-73d16fe1]::before {\n  background: linear-gradient(90deg, #3b82f6, #2563eb);\n}\n.currency-card.grade-epic[data-v-73d16fe1]::before {\n  background: linear-gradient(90deg, #8b5cf6, #7c3aed);\n}\n.currency-card.grade-legend[data-v-73d16fe1]::before {\n  background: linear-gradient(90deg, #f59e0b, #d97706);\n}\n.currency-card.grade-money[data-v-73d16fe1]::before {\n  background: linear-gradient(90deg, #22c55e, #16a34a);\n}\n.currency-card[data-v-73d16fe1]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);\n}\n.currency-card[data-v-73d16fe1]:hover::before {\n  opacity: 1;\n}\n.currency-card-top[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.currency-icon[data-v-73d16fe1] {\n  flex-shrink: 0;\n  color: var(--color-text-secondary);\n  transition: color 0.3s ease;\n}\n\n/* 突变结晶图标颜色 */\n.icon-grade-common[data-v-73d16fe1] {\n  color: #9ca3af;\n}\n.icon-grade-rare[data-v-73d16fe1] {\n  color: #3b82f6;\n}\n.icon-grade-epic[data-v-73d16fe1] {\n  color: #8b5cf6;\n}\n.icon-grade-legend[data-v-73d16fe1] {\n  color: #f59e0b;\n}\n.icon-grade-money[data-v-73d16fe1] {\n  color: #22c55e;\n}\n.currency-info[data-v-73d16fe1] {\n  flex: 1;\n}\n.currency-amount[data-v-73d16fe1] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 4px;\n}\n.currency-label[data-v-73d16fe1] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n.currency-sub[data-v-73d16fe1] {\n  margin-top: 2px;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.currency-delete-btn[data-v-73d16fe1] {\n  flex-shrink: 0;\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.15s ease;\n}\n.currency-delete-btn[data-v-73d16fe1]:hover {\n  border-color: #ef4444;\n  color: #ef4444;\n  background: rgba(239, 68, 68, 0.08);\n}\n.currency-delete-btn[data-v-73d16fe1]:active {\n  transform: scale(0.98);\n}\n\n/* 兑换功能 */\n.currency-exchange[data-v-73d16fe1] {\n  display: flex;\n  gap: 8px;\n  margin-top: 8px;\n}\n.exchange-btn[data-v-73d16fe1] {\n  flex: 1;\n  padding: 6px 12px;\n  border: 1px solid var(--color-primary);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-primary);\n  font-size: 0.8rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  position: relative;\n  overflow: hidden;\n}\n.exchange-btn[data-v-73d16fe1]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s ease;\n}\n.exchange-btn[data-v-73d16fe1]:hover:not(:disabled) {\n  background: var(--color-primary);\n  color: white;\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n.exchange-btn[data-v-73d16fe1]:hover:not(:disabled)::before {\n  left: 100%;\n}\n.exchange-btn.down[data-v-73d16fe1] {\n  border-color: var(--color-warning);\n  color: var(--color-warning);\n}\n.exchange-btn.down[data-v-73d16fe1]:hover:not(:disabled) {\n  background: var(--color-warning);\n  color: white;\n  box-shadow: 0 4px 12px rgba(var(--color-warning-rgb), 0.3);\n}\n.exchange-btn[data-v-73d16fe1]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n.exchange-btn[data-v-73d16fe1]:active:not(:disabled) {\n  transform: translateY(0) scale(0.98);\n}\n\n/* 按钮样式 */\n.action-btn[data-v-73d16fe1] {\n  flex: 1;\n  padding: 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.action-btn[data-v-73d16fe1]:hover {\n  background: var(--color-surface-light);\n  transform: translateY(-1px);\n}\n.use-btn[data-v-73d16fe1] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n.use-btn[data-v-73d16fe1]:hover {\n  background: var(--color-primary-hover);\n}\n.discard-btn[data-v-73d16fe1] {\n  background: var(--color-error);\n  border-color: var(--color-error);\n  color: white;\n}\n.discard-btn[data-v-73d16fe1]:hover {\n  background: var(--color-error-hover);\n}\n\n/* 属性文本显示 */\n.attribute-text[data-v-73d16fe1] {\n  background: var(--color-background);\n  border-radius: 6px;\n  padding: 12px;\n  font-size: 0.9rem;\n  color: var(--color-text);\n  line-height: 1.4;\n  word-break: break-all;\n}\n\n/* 功法效果样式 */\n.skill-effects[data-v-73d16fe1] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.effect-item[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 6px 0;\n}\n.effect-label[data-v-73d16fe1] {\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  min-width: 80px;\n}\n.effect-value[data-v-73d16fe1] {\n  color: var(--color-success);\n  font-weight: 500;\n}\n.special-abilities[data-v-73d16fe1] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 4px;\n}\n.ability-tag[data-v-73d16fe1] {\n  background: var(--color-primary);\n  color: white;\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n\n/* 功法技能样式 */\n.technique-skills[data-v-73d16fe1] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.skill-item[data-v-73d16fe1] {\n  background: var(--color-background);\n  border-radius: 8px;\n  padding: 12px;\n  border: 1px solid var(--color-border);\n}\n.skill-header[data-v-73d16fe1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.skill-name[data-v-73d16fe1] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.skill-type[data-v-73d16fe1] {\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n.skill-type.type-攻击[data-v-73d16fe1] {\n  background: var(--color-error);\n  color: white;\n}\n.skill-type.type-防御[data-v-73d16fe1] {\n  background: var(--color-info);\n  color: white;\n}\n.skill-type.type-辅助[data-v-73d16fe1] {\n  background: var(--color-success);\n  color: white;\n}\n.skill-type.type-移动[data-v-73d16fe1] {\n  background: var(--color-warning);\n  color: white;\n}\n.skill-type.type-其他[data-v-73d16fe1] {\n  background: var(--color-text-secondary);\n  color: white;\n}\n.skill-description[data-v-73d16fe1] {\n  color: var(--color-text);\n  font-size: 0.9rem;\n  line-height: 1.4;\n  margin-bottom: 6px;\n}\n.skill-unlock-requirement[data-v-73d16fe1] {\n  font-size: 0.75rem;\n  color: var(--color-warning);\n  font-weight: 600;\n  padding: 2px 8px;\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-radius: 4px;\n  margin-left: auto;\n}\n.skill-cost[data-v-73d16fe1] {\n  color: var(--color-info);\n  font-size: 0.8rem;\n  font-weight: 500;\n  margin-top: 4px;\n}\n.skill-unlock[data-v-73d16fe1] {\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n}\n.cultivate-btn[data-v-73d16fe1] {\n  background: var(--color-info);\n  border-color: var(--color-info);\n  color: white;\n}\n.cultivate-btn[data-v-73d16fe1]:hover {\n  background: var(--color-info-hover);\n}\n.equip-btn[data-v-73d16fe1] {\n  background: var(--color-success);\n  border-color: var(--color-success);\n  color: white;\n}\n.equip-btn[data-v-73d16fe1]:hover {\n  background: var(--color-success-hover);\n}\n\n/* 品质样式系统 - 内联文字样式，不填充整行 */\n/* 神阶 - 深红色（最高品质） */\n.text-quality-神[data-v-73d16fe1],\n.text-quality-神阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #dc2626, #b91c1c) !important;\n  border: 1px solid #dc2626 !important;\n  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 仙阶 - 粉紫色 */\n.text-quality-仙[data-v-73d16fe1],\n.text-quality-仙阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #ec4899, #db2777) !important;\n  border: 1px solid #ec4899 !important;\n  box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 天阶 - 蓝色 */\n.text-quality-天[data-v-73d16fe1],\n.text-quality-天阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #3b82f6, #2563eb) !important;\n  border: 1px solid #3b82f6 !important;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 地阶 - 橙色 */\n.text-quality-地[data-v-73d16fe1],\n.text-quality-地阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #f59e0b, #d97706) !important;\n  border: 1px solid #f59e0b !important;\n  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 玄阶 - 紫色 */\n.text-quality-玄[data-v-73d16fe1],\n.text-quality-玄阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;\n  border: 1px solid #8b5cf6 !important;\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 黄阶 - 金黄色 */\n.text-quality-黄[data-v-73d16fe1],\n.text-quality-黄阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #eab308, #ca8a04) !important;\n  border: 1px solid #eab308 !important;\n  box-shadow: 0 2px 8px rgba(234, 179, 8, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 凡阶 - 灰色（最低品质） */\n.text-quality-凡[data-v-73d16fe1],\n.text-quality-凡阶[data-v-73d16fe1] {\n  color: white !important;\n  background: linear-gradient(135deg, #6b7280, #4b5563) !important;\n  border: 1px solid #6b7280 !important;\n  box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 边框样式也需要修复 */\n.border-quality-神[data-v-73d16fe1] {\n  border-color: #dc2626 !important;\n}\n.border-quality-仙[data-v-73d16fe1] {\n  border-color: #ec4899 !important;\n}\n.border-quality-天[data-v-73d16fe1] {\n  border-color: #3b82f6 !important;\n}\n.border-quality-地[data-v-73d16fe1] {\n  border-color: #f59e0b !important;\n}\n.border-quality-玄[data-v-73d16fe1] {\n  border-color: #8b5cf6 !important;\n}\n.border-quality-凡[data-v-73d16fe1] {\n  border-color: #6b7280 !important;\n}\n.border-quality-凡[data-v-73d16fe1] {\n  border-color: #6b7280 !important;\n}\n\n/* 自定义品质样式 - 使用渐变彩虹色 */\n.border-quality-custom[data-v-73d16fe1] {\n  border-color: #06b6d4 !important;\n  border-width: 2px !important;\n}\n.text-quality-custom[data-v-73d16fe1] {\n  color: #06b6d4 !important;\n  font-weight: bold;\n}\n.card-quality-custom[data-v-73d16fe1] {\n  background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(168, 85, 247, 0.1)) !important;\n  border-color: #06b6d4 !important;\n}\n.badge-quality-custom[data-v-73d16fe1] {\n  background: linear-gradient(135deg, #06b6d4, #a855f7) !important;\n  color: white !important;\n}\n\n/* 装备标签页样式 */\n.equipment-tab[data-v-73d16fe1] {\n  height: 100%;\n  overflow-y: auto;\n  padding: 0;\n}\n.equipment-showcase[data-v-73d16fe1] {\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n}\n\n/* 装备总览卡片 */\n.equipment-overview[data-v-73d16fe1] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.08), rgba(var(--color-primary-rgb), 0.02));\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 16px;\n  padding: 20px;\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);\n}\n.overview-header[data-v-73d16fe1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.overview-title[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 1.25rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.title-icon[data-v-73d16fe1] {\n  color: var(--color-primary);\n}\n.overview-stats[data-v-73d16fe1] {\n  display: flex;\n  gap: 24px;\n}\n.stat-item[data-v-73d16fe1] {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 4px;\n}\n.stat-label[data-v-73d16fe1] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.stat-value[data-v-73d16fe1] {\n  font-size: 1.5rem;\n  font-weight: 900;\n  color: var(--color-primary);\n  line-height: 1;\n}\n\n/* 装备槽位网格 */\n.equipment-slots-grid[data-v-73d16fe1] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));\n  gap: 20px;\n}\n\n/* 装备槽位卡片 */\n.equipment-slot-card[data-v-73d16fe1] {\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 16px;\n  overflow: hidden;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n}\n.equipment-slot-card.empty[data-v-73d16fe1] {\n  border-style: dashed;\n  border-color: var(--color-border);\n  opacity: 0.7;\n}\n.equipment-slot-card.empty[data-v-73d16fe1]:hover {\n  opacity: 1;\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n  transform: translateY(-2px);\n}\n.equipment-slot-card.equipped[data-v-73d16fe1] {\n  border-color: rgba(var(--color-primary-rgb), 0.4);\n  box-shadow: 0 4px 16px rgba(var(--color-primary-rgb), 0.1);\n}\n.equipment-slot-card.equipped[data-v-73d16fe1]:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 8px 24px rgba(var(--color-primary-rgb), 0.2);\n  border-color: rgba(var(--color-primary-rgb), 0.6);\n}\n\n/* 槽位标题栏 */\n.slot-title-bar[data-v-73d16fe1] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 16px;\n  background: var(--color-surface-light);\n  border-bottom: 1px solid var(--color-border);\n}\n.slot-position[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n.position-icon[data-v-73d16fe1] {\n  font-size: 1.25rem;\n  line-height: 1;\n}\n.position-name[data-v-73d16fe1] {\n  font-size: 0.9rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.slot-unequip-btn[data-v-73d16fe1] {\n  width: 28px;\n  height: 28px;\n  border-radius: 8px;\n  border: none;\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.slot-unequip-btn[data-v-73d16fe1]:hover {\n  background: #ef4444;\n  color: white;\n  transform: scale(1.1);\n}\n.slot-unequip-btn[data-v-73d16fe1]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 已装备内容 */\n.equipped-content[data-v-73d16fe1] {\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n/* 装备图标区 */\n.equipped-icon-area[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  position: relative;\n}\n.icon-glow[data-v-73d16fe1] {\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  filter: blur(20px);\n  opacity: 0.3;\n  pointer-events: none;\n}\n.icon-glow.q-凡-glow[data-v-73d16fe1] { background: #808080;\n}\n.icon-glow.q-黄-glow[data-v-73d16fe1] { background: #daa520;\n}\n.icon-glow.q-玄-glow[data-v-73d16fe1] { background: #9370db;\n}\n.icon-glow.q-地-glow[data-v-73d16fe1] { background: #00ced1;\n}\n.icon-glow.q-天-glow[data-v-73d16fe1] { background: #ff69b4;\n}\n.icon-glow.q-仙-glow[data-v-73d16fe1] { background: #ffd700;\n}\n.icon-glow.q-神-glow[data-v-73d16fe1] { background: #9932cc;\n}\n.icon-glow.q-custom-glow[data-v-73d16fe1] { background: rgba(var(--color-primary-rgb), 0.8);\n}\n.icon-frame[data-v-73d16fe1] {\n  width: 80px;\n  height: 80px;\n  border-radius: 16px;\n  border: 3px solid;\n  background: var(--color-background);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  z-index: 1;\n  flex-shrink: 0;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n.icon-inner[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.quality-badge[data-v-73d16fe1] {\n  position: absolute;\n  bottom: -8px;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 4px 12px;\n  border-radius: 12px;\n  font-size: 0.7rem;\n  font-weight: 800;\n  color: white;\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n  white-space: nowrap;\n  z-index: 2;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n}\n.quality-badge.q-凡-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #808080, #696969);\n}\n.quality-badge.q-黄-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #daa520, #b8860b);\n}\n.quality-badge.q-玄-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #9370db, #8a2be2);\n}\n.quality-badge.q-地-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #00ced1, #20b2aa);\n}\n.quality-badge.q-天-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #ff69b4, #ff1493);\n}\n.quality-badge.q-仙-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #ffd700, #ffa500);\n}\n.quality-badge.q-神-badge[data-v-73d16fe1] { background: linear-gradient(135deg, #9932cc, #8b008b);\n}\n\n/* 装备信息区 */\n.equipped-info[data-v-73d16fe1] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.equipped-name[data-v-73d16fe1] {\n  font-size: 1.1rem;\n  font-weight: 800;\n  line-height: 1.3;\n  color: var(--color-text);\n}\n.equipped-grade[data-v-73d16fe1] {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n.grade-badge[data-v-73d16fe1] {\n  padding: 4px 10px;\n  border-radius: 8px;\n  font-size: 0.75rem;\n  font-weight: 700;\n  border: 1px solid;\n  display: inline-block;\n}\n.equipped-desc[data-v-73d16fe1] {\n  font-size: 0.85rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n  padding: 10px;\n  background: var(--color-surface-light);\n  border-radius: 10px;\n  border-left: 3px solid rgba(var(--color-primary-rgb), 0.5);\n}\n\n/* 装备效果 */\n.equipped-effects[data-v-73d16fe1] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  margin-top: 4px;\n}\n.effect-section[data-v-73d16fe1] {\n  padding: 12px;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.05), rgba(var(--color-primary-rgb), 0.02));\n  border: 1px solid rgba(var(--color-primary-rgb), 0.15);\n  border-radius: 10px;\n}\n.effect-section.special[data-v-73d16fe1] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.08), rgba(168, 85, 247, 0.02));\n  border-color: rgba(168, 85, 247, 0.2);\n}\n.effect-label[data-v-73d16fe1] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 8px;\n  font-size: 0.8rem;\n  font-weight: 700;\n  color: var(--color-text);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.effect-dot[data-v-73d16fe1] {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  box-shadow: 0 0 8px rgba(var(--color-primary-rgb), 0.6);\n}\n.effect-dot.special[data-v-73d16fe1] {\n  background: #a855f7;\n  box-shadow: 0 0 8px rgba(168, 85, 247, 0.6);\n}\n.effect-content[data-v-73d16fe1] {\n  font-size: 0.85rem;\n  line-height: 1.6;\n  color: var(--color-text);\n  padding-left: 14px;\n}\n\n/* 空槽位内容 */\n.empty-slot-content[data-v-73d16fe1] {\n  padding: 40px 20px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  min-height: 200px;\n}\n.empty-slot-icon[data-v-73d16fe1] {\n  color: var(--color-text-muted);\n  opacity: 0.4;\n}\n.empty-slot-text[data-v-73d16fe1] {\n  text-align: center;\n}\n.empty-main[data-v-73d16fe1] {\n  font-size: 0.95rem;\n  font-weight: 700;\n  color: var(--color-text-secondary);\n  margin-bottom: 4px;\n}\n.empty-hint[data-v-73d16fe1] {\n  font-size: 0.8rem;\n  color: var(--color-text-muted);\n}\n\n/* 品质边框颜色 */\n.q-凡-border[data-v-73d16fe1] { border-color: #808080;\n}\n.q-黄-border[data-v-73d16fe1] { border-color: #daa520;\n}\n.q-玄-border[data-v-73d16fe1] { border-color: #9370db;\n}\n.q-地-border[data-v-73d16fe1] { border-color: #00ced1;\n}\n.q-天-border[data-v-73d16fe1] { border-color: #ff69b4;\n}\n.q-仙-border[data-v-73d16fe1] { border-color: #ffd700;\n}\n.q-神-border[data-v-73d16fe1] { border-color: #9932cc;\n}\n\n/* 品质文字颜色 */\n.q-凡-text[data-v-73d16fe1] { color: #808080;\n}\n.q-黄-text[data-v-73d16fe1] { color: #daa520;\n}\n.q-玄-text[data-v-73d16fe1] { color: #9370db;\n}\n.q-地-text[data-v-73d16fe1] { color: #00ced1;\n}\n.q-天-text[data-v-73d16fe1] { color: #ff69b4;\n}\n.q-仙-text[data-v-73d16fe1] { color: #ffd700;\n}\n.q-神-text[data-v-73d16fe1] { color: #9932cc;\n}\n\n/* 品级样式 */\n.item-grade[data-v-73d16fe1] {\n  border-radius: 5px;\n  border: 2px solid #9ca3af;\n}\n.item-type-text[data-v-73d16fe1] {\n  font-size: 12px;\n  font-weight: bold;\n  text-align: center;\n  color: var(--color-text);\n  line-height: 1.2;\n  word-break: break-word;\n}\n.item-info[data-v-73d16fe1] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.item-name[data-v-73d16fe1] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  margin-bottom: 0;\n  line-height: 1.3;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n  color: var(--color-text);\n}\n.item-quality[data-v-73d16fe1] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  border-radius: 6px;\n  margin-bottom: 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 4px 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  width: fit-content;\n}\n.item-description[data-v-73d16fe1] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  margin-bottom: 0;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  line-clamp: 3;\n  -webkit-box-orient: vertical;\n  background: var(--color-surface-light);\n  padding: 8px 12px;\n  border-radius: 8px;\n  border-left: 3px solid var(--color-primary);\n}\n.item-effects[data-v-73d16fe1] {\n  background: var(--color-surface-light);\n  padding: 8px;\n  border-radius: 6px;\n  border-left: 3px solid var(--color-info);\n}\n.effects-title[data-v-73d16fe1] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-info);\n  margin-bottom: 4px;\n}\n.effects-text[data-v-73d16fe1] {\n  font-size: 0.8rem;\n  color: var(--color-text);\n  line-height: 1.3;\n}\n\n/* 空装备槽位 */\n.empty-equipment-slot[data-v-73d16fe1] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  height: 120px;\n  gap: 8px;\n}\n.empty-icon[data-v-73d16fe1] {\n  color: var(--color-text-muted);\n  opacity: 0.5;\n}\n.empty-text[data-v-73d16fe1] {\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-73d16fe1] {\n  font-size: 0.8rem;\n  color: var(--color-text-muted);\n  font-style: italic;\n}\n\n/* 移动端适配 - 优化卡片显示 */\n@media (max-width: 640px) {\n.tabs-header[data-v-73d16fe1] {\n    padding: 12px;\n}\n.tools-section[data-v-73d16fe1] {\n    flex-direction: column;\n    gap: 8px;\n    align-items: stretch;\n}\n.search-box[data-v-73d16fe1] {\n    min-width: auto;\n}\n.filter-buttons[data-v-73d16fe1] {\n    justify-content: space-between;\n}\n.filter-select[data-v-73d16fe1] {\n    flex: 1;\n}\n.items-grid[data-v-73d16fe1] {\n    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n    grid-auto-rows: minmax(150px, auto);\n    padding: 16px;\n    gap: 12px;\n}\n.item-card[data-v-73d16fe1] {\n    min-height: 150px;\n    padding: 8px;\n}\n.item-icon-area[data-v-73d16fe1] {\n    width: 40px;\n    height: 40px;\n}\n.item-type-icon[data-v-73d16fe1] {\n    font-size: 20px;\n}\n.item-name-section[data-v-73d16fe1] {\n    min-height: 36px;\n    padding: 3px;\n}\n.item-name[data-v-73d16fe1] {\n    font-size: 11px;\n    line-height: 1.3;\n}\n.item-type-label[data-v-73d16fe1] {\n    font-size: 9px;\n    padding: 2px 6px;\n}\n.item-grade-info[data-v-73d16fe1] {\n    font-size: 8px;\n    padding: 2px 5px;\n}\n.currency-grid[data-v-73d16fe1] {\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: 12px;\n}\n.currency-card[data-v-73d16fe1] {\n    padding: 16px;\n}\n.currency-amount[data-v-73d16fe1] {\n    font-size: 1.25rem;\n}\n\n  /* 装备页面移动端适配 */\n.equipment-content[data-v-73d16fe1] {\n    padding: 12px;\n}\n.equipment-header[data-v-73d16fe1] {\n    flex-direction: column;\n    gap: 12px;\n    align-items: flex-start;\n}\n.equipment-slots-grid[data-v-73d16fe1] {\n    grid-template-columns: 1fr;\n    gap: 16px;\n}\n.equipment-slot-card[data-v-73d16fe1] {\n    min-height: auto;\n}\n.equipped-icon-area[data-v-73d16fe1] {\n    flex-direction: column;\n    align-items: flex-start;\n}\n}\n@media (max-width: 480px) {\n.tabs-nav[data-v-73d16fe1] {\n    justify-content: center;\n}\n.tab-btn[data-v-73d16fe1] {\n    flex: 1;\n    justify-content: center;\n}\n.items-grid[data-v-73d16fe1] {\n    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));\n    grid-auto-rows: minmax(140px, auto);\n    gap: 10px;\n    padding: 12px;\n}\n.item-card[data-v-73d16fe1] {\n    min-height: 140px;\n    padding: 6px;\n}\n.item-icon-area[data-v-73d16fe1] {\n    width: 32px;\n    height: 32px;\n}\n.item-type-icon[data-v-73d16fe1] {\n    font-size: 16px;\n}\n.item-name-section[data-v-73d16fe1] {\n    min-height: 32px;\n    padding: 2px;\n}\n.item-name[data-v-73d16fe1] {\n    font-size: 10px;\n    line-height: 1.3;\n}\n.item-type-label[data-v-73d16fe1] {\n    font-size: 8px;\n    padding: 2px 4px;\n}\n.item-grade-info[data-v-73d16fe1] {\n    font-size: 7px;\n    padding: 2px 3px;\n}\n.item-quality-badge[data-v-73d16fe1] {\n    font-size: 6px;\n    padding: 1px 2px;\n}\n.item-quantity-badge[data-v-73d16fe1] {\n    font-size: 8px;\n    padding: 1px 4px;\n}\n.currency-grid[data-v-73d16fe1] {\n    grid-template-columns: 1fr;\n}\n.currency-card[data-v-73d16fe1] {\n    padding: 14px;\n}\n}\n",""]);const s=i},6796:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n/* Step transition animation */\n.fade-step-enter-active,\n.fade-step-leave-active {\n  transition: opacity 0.3s ease;\n}\n.fade-step-enter-from,\n.fade-step-leave-to {\n  opacity: 0;\n}\n",""]);const s=i},6840:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},6939:(e,n,t)=>{"use strict";function a(e,n){let t=n.年-e.年;return(n.月<e.月||n.月===e.月&&n.日<e.日)&&t--,Math.max(0,t)}function r(e,n){return{年:n.年-e,月:n.月,日:n.日,小时:0,分钟:0}}function o(e){const n=e?.元数据?.时间??{年:1,月:1,日:1,小时:8,分钟:0},t=e?.角色?.身份??null;if(!t||"object"!=typeof t)return 0;if(!t.出生日期){const e=18;return t.出生日期=r(e,n),e}return a(t.出生日期,n)}function i(e,n){const t=n||{年:1,月:1,日:1,小时:8,分钟:0},o=e;if(!o.出生日期){const e=o.年龄||18,n=r(e,t);return o.出生日期=n,e}const i=a(o.出生日期,t);return void 0!==o.年龄&&(o.年龄=i),i}t.d(n,{DT:()=>o,R5:()=>a,UY:()=>i})},6988:(e,n,t)=>{"use strict";t.d(n,{$:()=>s});const a=e=>!!e&&"object"==typeof e&&!Array.isArray(e),r=e=>"number"==typeof e&&Number.isFinite(e),o=e=>{const n=[];if(!a(e))return["元数据.时间 必须是对象"];const t=[["年",0,Number.MAX_SAFE_INTEGER],["月",1,12],["日",1,31],["小时",0,23],["分钟",0,59]];for(const[a,o,i]of t){const t=e[a];r(t)?(t<o||t>i)&&n.push(`元数据.时间.${String(a)} 超出范围（${o}-${i}）`):n.push(`元数据.时间.${String(a)} 必须是数字`)}return n},i=e=>{if(!e||"object"!=typeof e)return!1;const n=e;return a(n.元数据)&&a(n.角色)&&a(n.社交)&&a(n.世界)&&a(n.系统)};function s(e){const n=[],t=[];if(!i(e))return{isValid:!1,errors:["不是 V3 存档结构（缺少 元数据/角色/社交/世界/系统）"],warnings:[]};const s=e,l=s.元数据?.版本号;3!==l&&n.push("元数据.版本号 必须为 3"),"string"==typeof s.元数据?.存档ID&&s.元数据.存档ID.trim()||n.push("元数据.存档ID 必填"),"string"==typeof s.元数据?.存档名&&s.元数据.存档名.trim()||n.push("元数据.存档名 必填"),"string"!=typeof s.元数据?.创建时间&&n.push("元数据.创建时间 必须是字符串(ISO8601)"),"string"!=typeof s.元数据?.更新时间&&n.push("元数据.更新时间 必须是字符串(ISO8601)"),r(s.元数据?.游戏时长秒)||n.push("元数据.游戏时长秒 必须是数字"),n.push(...o(s.元数据?.时间)),a(s.角色?.身份)||n.push("角色.身份 必填且必须是对象"),a(s.角色?.属性)||n.push("角色.属性 必填且必须是对象"),a(s.角色?.位置)||n.push("角色.位置 必填且必须是对象"),Array.isArray(s.角色?.效果)||n.push("角色.效果 必填且必须是数组"),a(s.角色?.背包)||n.push("角色.背包 必填且必须是对象"),a(s.角色?.装备)||n.push("角色.装备 必填且必须是对象");const c=s.角色?.背包?.物品;a(c)||n.push("角色.背包.物品 必填且必须是对象");const d=s.角色?.装备;if(a(d)&&a(c))for(let e=1;e<=6;e++){const a=`装备${e}`,r=d[a];null!=r&&("string"==typeof r?r in c||t.push(`角色.装备.${a} 引用了不存在的物品ID：${r}`):n.push(`角色.装备.${a} 必须是 string|null`))}a(s.社交?.关系)||n.push("社交.关系 必填且必须是对象"),a(s.社交?.事件)||n.push("社交.事件 必填且必须是对象"),a(s.社交?.记忆)||n.push("社交.记忆 必填且必须是对象"),a(s.世界?.信息)||n.push("世界.信息 必填且必须是对象"),a(s.系统?.联机)||n.push("系统.联机 必填且必须是对象");const u=s.系统?.联机?.只读路径;return Array.isArray(u)||n.push("系统.联机.只读路径 必填且必须是数组"),{isValid:0===n.length,errors:n,warnings:t}}},7044:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2716%27 height=%2716%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%236b7280%27 stroke-width=%272%27%3E%3Cpath d=%27m6 9 6 6 6-6%27/%3E%3C/svg%3E"},7119:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},7176:(e,n,t)=>{"use strict";var a,r=t(3126),o=t(5795);try{a=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var i=!!a&&o&&o(Object.prototype,"__proto__"),s=Object,l=s.getPrototypeOf;e.exports=i&&"function"==typeof i.get?r([i.get]):"function"==typeof l&&function(e){return l(null==e?e:s(e))}},7228:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-tasks[data-v-643b56f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n}\n.player-info-bar[data-v-643b56f2] {\n  display: flex;\n  gap: 1.5rem;\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, rgba(14, 116, 144, 0.1), rgba(14, 116, 144, 0.05));\n  border-radius: 8px;\n  border: 1px solid rgba(14, 116, 144, 0.2);\n}\n.info-actions[data-v-643b56f2] {\n  margin-left: auto;\n  display: flex;\n  align-items: center;\n}\n.gen-btn[data-v-643b56f2] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.45rem 0.7rem;\n  border-radius: 8px;\n  border: 1px solid rgba(14, 116, 144, 0.25);\n  background: rgba(14, 116, 144, 0.08);\n  color: #0e7490;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.gen-btn[data-v-643b56f2]:hover:not(:disabled) {\n  border-color: rgba(14, 116, 144, 0.45);\n  background: rgba(14, 116, 144, 0.12);\n}\n.gen-btn[data-v-643b56f2]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.spin[data-v-643b56f2] {\n  animation: spin-643b56f2 0.9s linear infinite;\n}\n@keyframes spin-643b56f2 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n.info-item[data-v-643b56f2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.info-item.highlight[data-v-643b56f2] {\n  padding: 0.25rem 0.75rem;\n  background: rgba(14, 116, 144, 0.1);\n  border-radius: 6px;\n  border: 1px solid rgba(14, 116, 144, 0.2);\n}\n.info-label[data-v-643b56f2] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-643b56f2] {\n  font-weight: 600;\n  font-size: 0.9rem;\n}\n.info-value.position[data-v-643b56f2] { color: #0f766e;\n}\n.info-value.contribution[data-v-643b56f2] { color: #0e7490; font-size: 1.1rem;\n}\n.task-filters[data-v-643b56f2] {\n  left: 4px;\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.filter-btn[data-v-643b56f2] {\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.filter-btn[data-v-643b56f2]:hover {\n  border-color: rgba(14, 116, 144, 0.3);\n  color: var(--color-text);\n}\n.filter-btn.active[data-v-643b56f2] {\n  background: linear-gradient(135deg, rgba(14, 116, 144, 0.12), rgba(14, 116, 144, 0.05));\n  border-color: rgba(14, 116, 144, 0.4);\n  color: #0e7490;\n}\n.task-list[data-v-643b56f2] {\n  flex: 1;\n  min-height: 0;\n  overflow-y: auto;\n}\n.empty-state[data-v-643b56f2] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-643b56f2] {\n  opacity: 0.5;\n  margin-bottom: 0.5rem;\n}\n.empty-text[data-v-643b56f2] {\n  font-weight: 600;\n  margin-bottom: 0.25rem;\n}\n.empty-hint[data-v-643b56f2] {\n  font-size: 0.8rem;\n  opacity: 0.7;\n  margin-bottom: 1rem;\n}\n.ask-btn[data-v-643b56f2] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.6rem 1rem;\n  background: linear-gradient(135deg, #0e7490, #0891b2);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.ask-btn[data-v-643b56f2]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(14, 116, 144, 0.3);\n}\n.task-grid[data-v-643b56f2] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));\n  gap: 0.75rem;\n}\n.task-card[data-v-643b56f2] {\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.task-card.available[data-v-643b56f2] { border-color: rgba(14, 116, 144, 0.25);\n}\n.task-card.in-progress[data-v-643b56f2] { border-color: rgba(234, 179, 8, 0.35);\n}\n.task-card.completed[data-v-643b56f2] { border-color: rgba(34, 197, 94, 0.35); opacity: 0.75;\n}\n.task-header[data-v-643b56f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.task-title[data-v-643b56f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.task-name[data-v-643b56f2] {\n  font-weight: 600;\n  font-size: 0.9rem;\n  color: var(--color-text);\n  word-break: break-word;\n  overflow-wrap: anywhere;\n}\n.task-difficulty[data-v-643b56f2] {\n  font-size: 0.7rem;\n  padding: 0.1rem 0.4rem;\n  border-radius: 4px;\n  width: fit-content;\n  font-weight: 500;\n}\n.diff-low[data-v-643b56f2] { background: rgba(34, 197, 94, 0.18); color: #16a34a;\n}\n.diff-mid[data-v-643b56f2] { background: rgba(14, 116, 144, 0.18); color: #0e7490;\n}\n.diff-high[data-v-643b56f2] { background: rgba(249, 115, 22, 0.18); color: #ea580c;\n}\n.diff-extreme[data-v-643b56f2] { background: rgba(239, 68, 68, 0.18); color: #dc2626;\n}\n.task-status[data-v-643b56f2] {\n  font-size: 0.7rem;\n  padding: 0.15rem 0.45rem;\n  border-radius: 999px;\n  border: 1px solid transparent;\n}\n.task-status.available[data-v-643b56f2] { color: #0e7490; border-color: rgba(14, 116, 144, 0.3);\n}\n.task-status.in-progress[data-v-643b56f2] { color: #d97706; border-color: rgba(217, 119, 6, 0.4);\n}\n.task-status.completed[data-v-643b56f2] { color: #16a34a; border-color: rgba(22, 163, 74, 0.4);\n}\n.task-desc[data-v-643b56f2] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n  word-break: break-word;\n  overflow-wrap: anywhere;\n}\n.task-meta[data-v-643b56f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  font-size: 0.72rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.5rem;\n}\n.meta-item[data-v-643b56f2] {\n  word-break: break-word;\n  overflow-wrap: anywhere;\n}\n.task-actions[data-v-643b56f2] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n}\n.task-btn[data-v-643b56f2] {\n  border: none;\n  border-radius: 6px;\n  padding: 0.35rem 0.7rem;\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.task-btn.primary[data-v-643b56f2] { background: rgba(14, 116, 144, 0.12); color: #0e7490; border: 1px solid rgba(14, 116, 144, 0.3);\n}\n.task-btn.primary[data-v-643b56f2]:hover { background: rgba(14, 116, 144, 0.2);\n}\n.task-btn.success[data-v-643b56f2] { background: rgba(22, 163, 74, 0.12); color: #16a34a; border: 1px solid rgba(22, 163, 74, 0.3);\n}\n.task-btn.success[data-v-643b56f2]:hover { background: rgba(22, 163, 74, 0.2);\n}\n.task-btn.ghost[data-v-643b56f2] { background: transparent; color: var(--color-text-secondary); border: 1px dashed rgba(148, 163, 184, 0.6);\n}\n.task-done[data-v-643b56f2] {\n  font-size: 0.75rem;\n  color: #16a34a;\n  font-weight: 600;\n}\n.task-in-progress[data-v-643b56f2] {\n  font-size: 0.75rem;\n  color: #d97706;\n  font-weight: 600;\n}\n.task-notice[data-v-643b56f2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(14, 116, 144, 0.08);\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #0e7490;\n}\n",""]);const s=i},7271:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("store",[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]])},7445:(e,n,t)=>{"use strict";t.d(n,{aiService:()=>o,o:()=>r});var a=t(1083);const r={openai:{url:"https://api.openai.com",defaultModel:"gpt-4o",name:"OpenAI"},claude:{url:"https://api.anthropic.com",defaultModel:"claude-sonnet-4-20250514",name:"Claude"},gemini:{url:"https://generativelanguage.googleapis.com",defaultModel:"gemini-2.0-flash",name:"Gemini"},deepseek:{url:"https://api.deepseek.com",defaultModel:"deepseek-chat",name:"DeepSeek"},zhipu:{url:"https://open.bigmodel.cn",defaultModel:"glm-4-flash",name:"智谱AI"},"siliconflow-embedding":{url:"https://api.siliconflow.cn",defaultModel:"BAAI/bge-m3",name:"硅基流动(Embedding)"},custom:{url:"",defaultModel:"",name:"自定义(OpenAI兼容)"}},o=new class{config={mode:"tavern",streaming:!0,memorySummaryMode:"raw",initMode:"generate",maxRetries:1,customAPI:{provider:"openai",url:"",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:8192}};abortController=null;isAborted=!1;constructor(){this.loadConfig()}cancelAllRequests(){console.log("[AI服务] 取消所有请求"),this.isAborted=!0,this.abortController&&(this.abortController.abort(),this.abortController=null);const e=this.getTavernHelper();e&&("function"==typeof e.abortGeneration&&e.abortGeneration(),"function"==typeof e.stopGeneration&&e.stopGeneration(),"function"==typeof e.cancelGeneration&&e.cancelGeneration())}resetAbortState(){this.isAborted=!1,this.abortController=new AbortController}async executeWithRetry(e,n){const t=this.config.maxRetries??1;let a=null;for(let r=0;r<=t;r++)try{if(this.isAborted)throw console.log(`[AI服务] ${n} 已被取消，停止执行`),new Error("请求已被取消");return r>0&&console.log(`[AI服务] ${n} 重试第 ${r}/${t} 次`),await e()}catch(e){if(a=e,this.isAborted||a.message?.includes("取消")||a.message?.includes("abort"))throw console.log(`[AI服务] ${n} 检测到取消信号，立即停止`),a;if(r<t){console.warn(`[AI服务] ${n} 失败，准备重试:`,a.message);const e=1e3*(r+1),t=100;for(let a=0;a<e;a+=t){if(this.isAborted)throw console.log(`[AI服务] ${n} 在重试等待期间被取消`),new Error("请求已被取消");await new Promise(n=>setTimeout(n,Math.min(t,e-a)))}}}throw a||new Error(`${n} 失败`)}getAbortSignal(){return this.abortController?.signal}syncModeWithEnvironment(){this.config.mode=this.isTavernEnvironment()?"tavern":"custom"}loadConfig(){try{const e=localStorage.getItem("ai_service_config");if(e){const n=JSON.parse(e);return this.config={...this.config,...n},console.log("[AI服务] 配置已加载:",this.config.mode),void this.syncModeWithEnvironment()}this.syncModeWithEnvironment()}catch(e){console.error("[AI服务] 加载配置失败:",e)}}saveConfig(e){this.config={...this.config,...e},this.syncModeWithEnvironment(),this.config.customAPI?.url&&(this.config.customAPI.url=this.config.customAPI.url.replace(/\/v1\/?$/,"").replace(/\/+$/,"")),localStorage.setItem("ai_service_config",JSON.stringify(this.config)),console.log("[AI服务] 配置已保存:",this.config.mode)}async testAPIDirectly(e,n){console.log(`[AI服务] 直接测试API: ${e.url}, model: ${e.model}`);const t=this.config.customAPI?{...this.config.customAPI}:null,a=this.config.mode;try{return this.config.mode="custom",this.config.customAPI={provider:e.provider,url:e.url.replace(/\/v1\/?$/,"").replace(/\/+$/,""),apiKey:e.apiKey,model:e.model,temperature:e.temperature??.7,maxTokens:e.maxTokens??1e3,forceJsonOutput:e.forceJsonOutput},await this.generateWithCustomAPI({user_input:n,should_stream:!1})}finally{this.config.mode=a,t&&(this.config.customAPI=t)}}getConfig(){return{...this.config}}async fetchModels(){if(!this.config.customAPI?.url||!this.config.customAPI?.apiKey)throw new Error("请先配置API地址和密钥");const{provider:e,url:n,apiKey:t}=this.config.customAPI,r=n.replace(/\/+$/,"");try{switch(e){case"gemini":try{return((await a.A.get(`${r}/v1beta/models?key=${t}`,{signal:this.getAbortSignal(),timeout:1e4})).data.models||[]).filter(e=>e.supportedGenerationMethods?.includes("generateContent")).map(e=>e.name.replace("models/",""))}catch(e){if(a.A.isAxiosError(e)&&401===e.response?.status){console.warn("[AI服务] Gemini查询参数认证失败，尝试Bearer token方式");try{return((await a.A.get(`${r}/v1beta/models`,{headers:{Authorization:`Bearer ${t}`},signal:this.getAbortSignal(),timeout:1e4})).data.models||[]).filter(e=>e.supportedGenerationMethods?.includes("generateContent")).map(e=>e.name.replace("models/",""))}catch(e){console.error("[AI服务] Bearer token方式也失败:",e)}}return console.error("[AI服务] Gemini模型列表获取失败:",e),console.warn("[AI服务] 返回Gemini预设模型列表"),["gemini-2.0-flash-exp","gemini-exp-1206","gemini-2.0-flash-thinking-exp-1219","gemini-1.5-pro","gemini-1.5-flash","gemini-1.5-flash-8b"]}case"claude":return console.warn("[AI服务] Claude API不支持获取模型列表，返回预设模型"),["claude-3-5-sonnet-20241022","claude-3-5-haiku-20241022","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];case"siliconflow-embedding":try{const e=await a.A.get(`${r}/v1/models?sub_type=embedding`,{headers:{Authorization:`Bearer ${t}`},signal:this.getAbortSignal(),timeout:1e4}),n=e.data.data?.map(e=>e.id)||[];if(n.length>0)return n}catch(e){console.warn("[AI服务] 获取硅基流动Embedding模型列表失败:",e)}return["BAAI/bge-m3","Pro/BAAI/bge-m3","BAAI/bge-large-zh-v1.5","BAAI/bge-large-en-v1.5","netease-youdao/bce-embedding-base_v1","Qwen/Qwen3-Embedding-8B","Qwen/Qwen3-Embedding-4B","Qwen/Qwen3-Embedding-0.6B"];default:try{const n=await a.A.get(`${r}/v1/models`,{headers:{Authorization:`Bearer ${t}`},signal:this.getAbortSignal(),timeout:1e4}),o=n.data.data?.map(e=>e.id)||[];return o.length>0?o:(console.warn("[AI服务] API返回空模型列表，使用预设列表"),this.getPresetModels(e,r))}catch(n){return console.warn("[AI服务] 获取模型列表失败，使用预设列表:",n),this.getPresetModels(e,r)}}}catch(e){if(console.error("[AI服务] 获取模型列表失败:",e),a.A.isAxiosError(e)){if(401===e.response?.status)throw new Error("API密钥无效或已过期");if(404===e.response?.status)throw new Error("API端点不存在，请检查URL配置是否正确");if(e.response)throw new Error(`获取模型列表失败: ${e.response.status} ${e.response.statusText}`);if("ECONNABORTED"===e.code)throw new Error("请求超时，请检查网络连接")}throw new Error("获取模型列表失败，请检查网络连接和API配置")}}getPresetModels(e,n){return n.includes("siliconflow.cn")?(console.log("[AI服务] 检测到硅基流动API，返回硅基流动预设模型列表"),["Qwen/Qwen2.5-7B-Instruct","Qwen/Qwen2.5-14B-Instruct","Qwen/Qwen2.5-32B-Instruct","Qwen/Qwen2.5-72B-Instruct","Qwen/QwQ-32B-Preview","deepseek-ai/DeepSeek-V2.5","deepseek-ai/DeepSeek-R1","Pro/Qwen/Qwen2.5-7B-Instruct","Pro/Qwen/Qwen2.5-14B-Instruct","Pro/Qwen/Qwen2.5-32B-Instruct","Pro/Qwen/Qwen2.5-72B-Instruct"]):"deepseek"===e||n.includes("deepseek.com")?["deepseek-chat","deepseek-reasoner"]:"openai"===e||n.includes("openai.com")?["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-3.5-turbo"]:["gpt-4o","gpt-4o-mini","gpt-3.5-turbo","deepseek-chat"]}getAPIConfigForUsageType(e){if(!e)return null;try{const{useAPIManagementStore:n}=t(100),a=n(),r=a.getAPIForType(e);if(!r)return null;if("default"!==r.id)return r;if("main"!==e){const e=a.getAPIForType("main");if(e&&"default"!==e.id)return e}return r}catch(e){return console.warn("[AI服务] 获取功能API配置失败，使用默认配置:",e),null}}async generate(e){return this.resetAbortState(),this.executeWithRetry(async()=>{this.syncModeWithEnvironment();const n=e.usageType||"main";if(console.log(`[AI服务] 调用generate，模式: ${this.config.mode}, usageType: ${n}, hasOnStreamChunk=${!!e.onStreamChunk}`),"tavern"===this.config.mode){const t=this.getAPIConfigForUsageType(n);return t&&"default"!==t.id?(console.log(`[AI服务-酒馆] 功能[${n}]使用独立API直连: ${t.name}`),t.forceJsonOutput&&!e.responseFormat&&(e={...e,responseFormat:"json_object"}),this.generateWithAPIConfig(e,{provider:t.provider,url:t.url,apiKey:t.apiKey,model:t.model,temperature:t.temperature,maxTokens:t.maxTokens})):(console.log(`[AI服务-酒馆] 功能[${n}]使用酒馆TavernHelper`),this.generateWithTavern(e))}const t=this.getAPIConfigForUsageType(n);return t?(console.log(`[AI服务-网页] 使用功能[${n}]分配的API: ${t.name}`),t.forceJsonOutput&&!e.responseFormat&&(e={...e,responseFormat:"json_object"}),this.generateWithAPIConfig(e,{provider:t.provider,url:t.url,apiKey:t.apiKey,model:t.model,temperature:t.temperature,maxTokens:t.maxTokens})):this.generateWithCustomAPI(e)},`generate[${e.usageType||"main"}]`)}async generateRaw(e){return this.resetAbortState(),this.executeWithRetry(async()=>{this.syncModeWithEnvironment();const n=e.usageType||"main";if(console.log(`[AI服务] 调用generateRaw，模式: ${this.config.mode}, usageType: ${n}`),"tavern"===this.config.mode){const t=this.getAPIConfigForUsageType(n);return t&&"default"!==t.id?(console.log(`[AI服务-酒馆] 功能[${n}]使用独立API直连(Raw): ${t.name}`),t.forceJsonOutput&&!e.responseFormat&&(e={...e,responseFormat:"json_object"}),this.generateRawWithAPIConfig(e,{provider:t.provider,url:t.url,apiKey:t.apiKey,model:t.model,temperature:t.temperature,maxTokens:t.maxTokens})):(console.log(`[AI服务-酒馆] 功能[${n}]使用酒馆TavernHelper(Raw)`),this.generateRawWithTavern(e))}const t=this.getAPIConfigForUsageType(n);return t?(console.log(`[AI服务-网页] 使用功能[${n}]分配的API: ${t.name}`),t.forceJsonOutput&&!e.responseFormat&&(e={...e,responseFormat:"json_object"}),this.generateRawWithAPIConfig(e,{provider:t.provider,url:t.url,apiKey:t.apiKey,model:t.model,temperature:t.temperature,maxTokens:t.maxTokens})):this.generateRawWithCustomAPI(e)},`generateRaw[${e.usageType||"main"}]`)}async generateWithAPIConfig(e,n){console.log(`[AI服务] 使用指定API配置生成，provider: ${n.provider}, model: ${n.model}`);const t=this.config.customAPI?{...this.config.customAPI}:null;try{return this.config.customAPI={provider:n.provider,url:n.url,apiKey:n.apiKey,model:n.model,temperature:n.temperature??.7,maxTokens:n.maxTokens??8192},await this.generateWithCustomAPI(e)}finally{t&&(this.config.customAPI=t)}}async generateRawWithAPIConfig(e,n){console.log(`[AI服务] 使用指定API配置进行纯净生成，provider: ${n.provider}, model: ${n.model}`);const t=this.config.customAPI?{...this.config.customAPI}:null;try{return this.config.customAPI={provider:n.provider,url:n.url,apiKey:n.apiKey,model:n.model,temperature:n.temperature??.7,maxTokens:n.maxTokens??8192},await this.generateRawWithCustomAPI(e)}finally{t&&(this.config.customAPI=t)}}async generateWithTavern(e){const n=this.getTavernHelper();if(!n)throw new Error(this.isTavernEnvironment()?"酒馆环境不可用，请切换到自定义API模式或在SillyTavern中打开":"当前环境不可用，请切换到自定义API模式");console.log("[AI服务-酒馆] 调用tavernHelper.generate");try{return await this.withRetry("tavern.generate",async()=>{if(this.isAborted)throw new Error("请求已被取消");return await n.generate(e)})}catch(e){throw this.toUserFacingError(e)}}async generateRawWithTavern(e){const n=this.getTavernHelper();if(!n)throw new Error(this.isTavernEnvironment()?"酒馆环境不可用，请切换到自定义API模式或在SillyTavern中打开":"当前环境不可用，请切换到自定义API模式");console.log("[AI服务-酒馆] 调用tavernHelper.generateRaw");try{const t=await this.withRetry("tavern.generateRaw",async()=>{if(this.isAborted)throw new Error("请求已被取消");return await n.generateRaw(e)});return String(t)}catch(e){throw this.toUserFacingError(e)}}async withRetry(e,n,t){const a=t?.retries??2,r=t?.baseDelayMs??800;let o;for(let t=0;t<=a;t++){if(this.isAborted)throw console.log(`[AI服务] ${e} 请求已被取消，停止重试`),new Error("请求已取消");try{let e=null;const t=new Promise((n,t)=>{e=setInterval(()=>{this.isAborted&&(e&&clearInterval(e),t(new Error("请求已被取消")))},50)});try{const a=await Promise.race([n(),t]);return e&&clearInterval(e),a}catch(n){throw e&&clearInterval(e),n}}catch(n){if(this.isAborted)throw console.log(`[AI服务] ${e} 请求已被取消，停止重试`),new Error("请求已取消");if(o=n,!this.isRetryableError(n)||t>=a)break;const i=Math.floor(250*Math.random()),s=r*Math.pow(2,t)+i;console.warn(`[AI服务] ${e} 失败，准备重试 (${t+1}/${a+1})，${s}ms`,n),await new Promise((e,n)=>{let t=null,a=null;const r=()=>{t&&clearTimeout(t),a&&clearInterval(a)};t=setTimeout(()=>{r(),e(void 0)},s),a=setInterval(()=>{this.isAborted&&(r(),n(new Error("请求已取消")))},100)})}}throw o}isRetryableError(e){const n=e?"string"==typeof e?e:e instanceof Error?e.message||"":String(e):"",t=(()=>{const n=e;return n?.status??n?.response?.status??n?.cause?.status??n?.cause?.response?.status})();return"number"==typeof t?[408,409,425,429,500,502,503,504].includes(t):!!/service unavailable/i.test(n)||!!/\b(429|500|502|503|504)\b/.test(n)||!!/timeout|timed out|network error|fetch failed/i.test(n)}toUserFacingError(e){const n=e,t=e?"string"==typeof e?e:e instanceof Error?e.message||"未知错误":String(e):"未知错误",a=n?.status??n?.response?.status??n?.cause?.status??n?.cause?.response?.status;if(503===a||/service unavailable/i.test(t)){const n=new Error("AI 服务暂不可用（Service Unavailable/503）。我已自动重试仍失败：如果在 SillyTavern 内使用，请检查当前 API 提供方/代理/额度是否正常；也可能是上游临时故障，稍后再试。");return n.cause=e,n}if(429===a||/\b429\b/.test(t)){const n=new Error("AI 请求过于频繁（429）。我已自动重试，仍失败请稍后再试或降低并发/频率。");return n.cause=e,n}const r=new Error(t||"AI 调用失败");return r.cause=e,r}getTavernHelper(){if("undefined"==typeof window)return null;if(window.TavernHelper)return window.TavernHelper;try{if(window.top&&window.top!==window&&window.top.TavernHelper)return window.top.TavernHelper}catch{}let e=window;for(let n=0;n<5;n++)try{if(!e.parent||e.parent===e)break;if(e.parent.TavernHelper)return e.parent.TavernHelper;e=e.parent}catch{break}return null}isTavernEnvironment(){return!!this.getTavernHelper()}isResponseFormatUnsupported(e,n){const t=(e||"").toLowerCase(),a=(n||"").toLowerCase();return!(!t.includes("doubao")&&!t.includes("volcengine")&&!t.includes("volc")&&!t.includes("bytedance")&&!t.includes("anthropic")&&!a.includes("claude")&&(!t.includes("dashscope")||a.includes("qwen-max")))}async generateWithCustomAPI(e){if(!this.config.customAPI)throw new Error("自定义API未配置");console.log("[AI服务-自定义] 构建消息列表"),console.log(`[AI服务-自定义] hasOnStreamChunk=${!!e.onStreamChunk}, should_stream=${e.should_stream}`);const n=[];e.injects&&e.injects.length>0&&([...e.injects].sort((e,n)=>n.depth-e.depth).forEach(e=>{"</input>"!==e.content&&n.push({role:e.role,content:e.content})}),console.log(`[AI服务-自定义] 已添加 ${n.length} 条inject消息`)),e.user_input&&(n.push({role:"user",content:e.user_input}),console.log("[AI服务-自定义] 已添加用户输入"));const t=e.should_stream??this.config.streaming??!1,a=e.usageType,r=a?this.getAPIConfigForUsageType(a):null,o=e.responseFormat||(r?.forceJsonOutput?"json_object":void 0);return this.callAPI(n,t,e.onStreamChunk,o)}async generateRawWithCustomAPI(e){if(!this.config.customAPI)throw new Error("自定义API未配置");console.log("[AI服务-自定义Raw] 使用ordered_prompts");const n=(e.ordered_prompts||[]).filter(e=>"</input>"!==e.content);console.log(`[AI服务-自定义Raw] 消息数量: ${n.length}`);const t=e.should_stream??this.config.streaming??!1,a=e.usageType,r=a?this.getAPIConfigForUsageType(a):null,o=e.responseFormat||(r?.forceJsonOutput?"json_object":void 0);return console.log(`[AI服务-自定义Raw] shouldStream=${t}, hasOnStreamChunk=${!!e.onStreamChunk}, options.should_stream=${e.should_stream}, config.streaming=${this.config.streaming}`),this.callAPI(n,t,e.onStreamChunk,o)}async callAPI(e,n,t,a){const{provider:r,url:o,apiKey:i,model:s,temperature:l,maxTokens:c}=this.config.customAPI,d=s.includes("reasoner")||s.includes("r1"),u=s.includes("claude"),p=this.isResponseFormatUnsupported(o,s),v=d||u||p,f=a&&!v?a:void 0;if(a&&v){const e=d?"reasoner模型":u?"Claude模型":"该API";console.log(`[AI服务-API调用] 跳过JSON格式输出（${e} 不支持 response_format）`)}let h=e;if("json_object"===f&&!e.some(e=>e.content.toLowerCase().includes("json"))){h=[...e];const n=h.findIndex(e=>"system"===e.role);n>=0?h[n]={...h[n],content:h[n].content+"\n\nRespond in JSON format."}:h.unshift({role:"system",content:"Respond in JSON format."}),console.log('[AI服务-API调用] 已自动添加JSON格式提示（API要求prompt中包含"json"）')}switch(console.log(`[AI服务-API调用] Provider: ${r}, URL: ${o}, Model: ${s}, 消息数: ${h.length}, 流式: ${n}`),r){case"claude":return this.callClaudeAPI(h,n,t,f);case"gemini":return this.callGeminiAPI(h,n,t,f);default:return this.callOpenAICompatibleAPI(h,n,t,f)}}estimateTokensForText(e){if(!e)return 0;let n=0;for(const t of e){const e=t.charCodeAt(0);e>=19968&&e<=40959&&n++}const t=Math.max(0,e.length-n);return n+Math.ceil(t/4)}estimateTokensForMessages(e){return e.reduce((e,n)=>e+8+this.estimateTokensForText(n.content||""),0)}getApproxContextWindow(e,n){const t=(n||"").toLowerCase();return"claude"===e||t.includes("claude")?2e5:"gemini"===e||t.includes("gemini")?1e6:t.includes("deepseek")||t.includes("moonshot")||t.includes("kimi")||"zhipu"===e||t.includes("glm")||t.includes("gpt-4o")||t.includes("gpt-4.1")||t.includes("o1")||t.includes("o3")||t.includes("gpt-4")?128e3:t.includes("gpt-3.5")?16385:null}clampMaxTokensForContext(e,n,t,a){const r=this.getApproxContextWindow(e,n);if(!r)return a;const o=this.estimateTokensForMessages(t),i=r-o-512;if(i<256)throw new Error(`API上下文长度不足：输入过长（估算输入≈${o} tokens），请减少世界/提示词长度或更换更大上下文模型。`);const s=Math.min(a,Math.max(256,i));return s<a&&console.warn(`[AI服务] maxTokens过大，已自动下调：${a} -> ${s}（估算输入≈${o}，模型上下文≈${r}）`),s}isStreamUnsupportedError(e){const n=(e||"").toLowerCase();return n.includes("stream")&&(n.includes("not supported")||n.includes("unsupported")||n.includes("invalid")||n.includes("unknown"))||n.includes("text/event-stream")||n.includes("sse")}async callOpenAICompatibleAPI(e,n,t,r){const{provider:o,url:i,apiKey:s,model:l,temperature:c,maxTokens:d}=this.config.customAPI,u=this.clampMaxTokensForContext(o,l,e,d||8192),p="zhipu"===o?`${i}/api/paas/v4/chat/completions`:`${i}/v1/chat/completions`;console.log(`[AI服务-OpenAI兼容] streaming=${n}, hasOnStreamChunk=${!!t}`);try{if(!n){const n={model:l,messages:e,temperature:c||.7,max_completion_tokens:u,stream:!1},t=l.includes("reasoner")||l.includes("r1"),o=l.includes("claude"),d=this.isResponseFormatUnsupported(i,l);"json_object"!==r||t||o||d||(n.response_format={type:"json_object"},console.log("[AI服务-OpenAI兼容] 启用JSON格式输出(非流式)"));const v=(await a.A.post(p,n,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},timeout:12e4,signal:this.getAbortSignal()})).data.choices[0].message.content;return console.log(`[AI服务-OpenAI] 响应长度: ${v.length}`),v}try{return await this.streamingRequestOpenAI(i,s,l,e,c||.7,u,t,r,o)}catch(n){const t=n instanceof Error?n.message:String(n);if(!this.isStreamUnsupportedError(t))throw n;console.warn("[AI服务-OpenAI兼容] 当前API可能不支持流式传输，已自动降级为非流式请求。");const o={model:l,messages:e,temperature:c||.7,max_tokens:u,stream:!1},d=l.includes("reasoner")||l.includes("r1"),v=l.includes("claude"),f=this.isResponseFormatUnsupported(i,l);"json_object"!==r||d||v||f||(o.response_format={type:"json_object"},console.log("[AI服务-OpenAI兼容] 启用JSON格式输出(降级非流式)"));const h=(await a.A.post(p,o,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},timeout:12e4,signal:this.getAbortSignal()})).data.choices[0].message.content;return console.log(`[AIæœåŠ¡-OpenAI] å“åº”é•¿åº¦: ${h.length}`),h}}catch(e){if(console.error("[AI服务-OpenAI] 失败:",e),a.A.isAxiosError(e)){if(e.response)throw new Error(`API错误 ${e.response.status}: ${JSON.stringify(e.response.data)}`);if(e.request)throw new Error("网络错误：无法连接到API服务器")}throw new Error(`OpenAI API调用失败: ${e instanceof Error?e.message:"未知错误"}`)}}async callClaudeAPI(e,n,t,r){const{provider:o,url:i,apiKey:s,model:l,temperature:c,maxTokens:d}=this.config.customAPI;let u="";const p=[];for(const n of e)"system"===n.role?u+=(u?"\n\n":"")+n.content:p.push({role:n.role,content:n.content});0!==p.length&&"user"===p[0].role||p.unshift({role:"user",content:"请开始。"});const v=i||"https://api.anthropic.com",f=this.clampMaxTokensForContext(o,l,[...u?[{content:u}]:[],...p.map(e=>({content:e.content}))],d||8192),h=()=>{const e={model:l,max_tokens:f,system:u||void 0,messages:p,temperature:c||.7};if("json_object"===r){console.log("[AI服务-Claude] 启用JSON格式输出（使用prefill技巧）");const n=e.messages[e.messages.length-1];n&&"user"===n.role&&e.messages.push({role:"assistant",content:"{"})}return e};try{if(!n){const e=await a.A.post(`${v}/v1/messages`,h(),{headers:{"x-api-key":s,"anthropic-version":"2023-06-01","Content-Type":"application/json"},timeout:12e4,signal:this.getAbortSignal()});let n=e.data.content[0]?.text||"";return"json_object"===r&&n&&!n.startsWith("{")&&(n="{"+n),console.log(`[AI服务-Claude] 响应长度: ${n.length}`),n}try{return await this.streamingRequestClaude(v,s,l,u,p,c||.7,f,t)}catch(e){const n=e instanceof Error?e.message:String(e);if(!this.isStreamUnsupportedError(n))throw e;console.warn("[AI服务-Claude] 当前API可能不支持流式传输，已自动降级为非流式请求。");const t=await a.A.post(`${v}/v1/messages`,h(),{headers:{"x-api-key":s,"anthropic-version":"2023-06-01","Content-Type":"application/json"},timeout:12e4,signal:this.getAbortSignal()});let o=t.data.content[0]?.text||"";return"json_object"===r&&o&&!o.startsWith("{")&&(o="{"+o),console.log(`[AI服务-Claude] 响应长度: ${o.length}`),o}}catch(e){if(console.error("[AI服务-Claude] 失败:",e),a.A.isAxiosError(e)&&e.response)throw new Error(`Claude API错误 ${e.response.status}: ${JSON.stringify(e.response.data)}`);throw new Error(`Claude API调用失败: ${e instanceof Error?e.message:"未知错误"}`)}}async callGeminiAPI(e,n,t,r){const{provider:o,url:i,apiKey:s,model:l,temperature:c,maxTokens:d}=this.config.customAPI;if(!l||""===l.trim())throw new Error("Gemini API调用失败：未指定模型名称");let u="";const p=[];for(const n of e)"system"===n.role?u+=(u?"\n\n":"")+n.content:p.push({role:"assistant"===n.role?"model":"user",parts:[{text:n.content}]});0===p.length&&p.push({role:"user",parts:[{text:"请开始。"}]});const v=i||"https://generativelanguage.googleapis.com",f=n?"streamGenerateContent":"generateContent",h=this.clampMaxTokensForContext(o,l,[...u?[{content:u}]:[],...p.map(e=>({content:(e.parts||[]).map(e=>e.text).join("\n")}))],d||8192),m={contents:p,systemInstruction:u?{parts:[{text:u}]}:void 0,generationConfig:(()=>{const e={temperature:c||.7,maxOutputTokens:h};return"json_object"===r&&(console.log("[AI服务-Gemini] 启用JSON格式输出（使用response_mime_type）"),e.response_mime_type="application/json"),e})()},g=async(e,n=!0)=>{const t=n?`${v}${e}?key=${s}`:`${v}${e}`,r={"Content-Type":"application/json"};return n||(r.Authorization=`Bearer ${s}`),a.A.post(t,m,{headers:r,timeout:12e4,signal:this.getAbortSignal()})};try{if(n)try{return await this.streamingRequestGemini(v,s,l,u,p,c||.7,h,t)}catch(e){const n=e instanceof Error?e.message:String(e);if(!this.isStreamUnsupportedError(n))throw e;console.warn("[AI服务-Gemini] 当前API可能不支持流式传输，已自动降级为非流式请求。");try{const e=await g(`/v1beta/models/${l}:generateContent`,!0),n=e.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return console.log(`[AI服务-Gemini] 响应长度: ${n.length}`),n}catch(e){if(a.A.isAxiosError(e)&&401===e.response?.status){console.warn("[AI服务-Gemini] 查询参数认证失败，尝试Bearer token方式");const e=await g(`/v1beta/models/${l}:generateContent`,!1),n=e.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return console.log(`[AI服务-Gemini] 响应长度: ${n.length}`),n}throw e}}else try{const e=await g(`/v1beta/models/${l}:${f}`,!0),n=e.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return console.log(`[AI服务-Gemini] 响应长度: ${n.length}`),n}catch(e){if(a.A.isAxiosError(e)&&401===e.response?.status){console.warn("[AI服务-Gemini] 查询参数认证失败，尝试Bearer token方式");const e=await g(`/v1beta/models/${l}:${f}`,!1),n=e.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return console.log(`[AI服务-Gemini] 响应长度: ${n.length}`),n}throw e}}catch(e){if(console.error("[AI服务-Gemini] 失败:",e),a.A.isAxiosError(e)&&e.response)throw new Error(`Gemini API错误 ${e.response.status}: ${JSON.stringify(e.response.data)}`);throw new Error(`Gemini API调用失败: ${e instanceof Error?e.message:"未知错误"}`)}}async streamingRequestOpenAI(e,n,t,a,r,o,i,s,l){console.log("[AI服务-OpenAI流式] 开始");const c={model:t,messages:a,temperature:r,max_tokens:o,stream:!0},d=t.includes("reasoner")||t.includes("r1"),u=t.includes("claude"),p=this.isResponseFormatUnsupported(e,t),v=d||u||p;if("json_object"!==s||v){if("json_object"===s&&v){const e=d?"reasoner模型":u?"Claude模型":"该API";console.log(`[AI服务-OpenAI流式] 跳过JSON格式输出（${e}不支持）`)}}else c.response_format={type:"json_object"},console.log("[AI服务-OpenAI流式] 启用JSON格式输出");const f="zhipu"===l?`${e}/api/paas/v4/chat/completions`:`${e}/v1/chat/completions`,h=await fetch(f,{method:"POST",headers:{Authorization:`Bearer ${n}`,Accept:"text/event-stream","Content-Type":"application/json"},body:JSON.stringify(c),signal:this.getAbortSignal()});if(!h.ok)throw new Error(`API错误 ${h.status}: ${await h.text()}`);const m=h.headers.get("content-type")||"";if(!m.includes("text/event-stream"))throw new Error(`Stream unsupported (content-type=${m||"unknown"})`);let g=!1,b=!1;const y=await this.processSSEStream(h,e=>{const n=JSON.parse(e),t=n.choices[0]?.delta,a=null!=t?.reasoning_content,r=null!=t?.content&&""!==t?.content;if(a){const e=t.reasoning_content;return!g&&e?(g=!0,b=!0,`<thinking>${e}`):g&&e?e:""}return g&&r?(g=!1,b=!1,`</thinking>${t.content}`):r?t.content:""},i);return b?(console.warn("[AI服务-OpenAI流式] 警告：reasoning_content 未正常闭合，补充 </thinking> 标签"),y+"</thinking>"):y}async streamingRequestClaude(e,n,t,a,r,o,i,s){console.log("[AI服务-Claude流式] 开始");const l={model:t,max_tokens:i,system:a||void 0,messages:r,temperature:o,stream:!0},c=await fetch(`${e}/v1/messages`,{method:"POST",headers:{"x-api-key":n,"anthropic-version":"2023-06-01",Accept:"text/event-stream","Content-Type":"application/json"},body:JSON.stringify(l),signal:this.getAbortSignal()});if(!c.ok)throw new Error(`Claude API错误 ${c.status}: ${await c.text()}`);const d=c.headers.get("content-type")||"";if(!d.includes("text/event-stream"))throw new Error(`Stream unsupported (content-type=${d||"unknown"})`);let u=!1;return this.processSSEStream(c,e=>{const n=JSON.parse(e);return"content_block_start"===n.type&&"thinking"===n.content_block?.type?(u=!0,"<thinking>"):"content_block_stop"===n.type&&u?(u=!1,"</thinking>"):"content_block_delta"===n.type?"thinking_delta"===n.delta?.type?n.delta?.thinking||"":n.delta?.text||"":""},s)}async streamingRequestGemini(e,n,t,a,r,o,i,s){console.log("[AI服务-Gemini流式] 开始");const l={temperature:o,maxOutputTokens:i},c=await fetch(`${e}/v1beta/models/${t}:streamGenerateContent?key=${n}&alt=sse`,{method:"POST",headers:{Accept:"text/event-stream","Content-Type":"application/json"},body:JSON.stringify({contents:r,systemInstruction:a?{parts:[{text:a}]}:void 0,generationConfig:l}),signal:this.getAbortSignal()});if(!c.ok)throw new Error(`Gemini API错误 ${c.status}: ${await c.text()}`);const d=c.headers.get("content-type")||"";if(!d.includes("text/event-stream"))throw new Error(`Stream unsupported (content-type=${d||"unknown"})`);let u=!1;return this.processSSEStream(c,e=>{const n=JSON.parse(e),t=n.candidates?.[0]?.content?.parts||[];let a="";for(const e of t)e.thought?(u||(a+="<thinking>",u=!0),a+=e.thought):e.text&&(u&&(a+="</thinking>",u=!1),a+=e.text);return a},s)}async processSSEStream(e,n,t){console.log(`[AI服务-流式] processSSEStream 开始, hasOnStreamChunk=${!!t}`);const a=e.body?.getReader();if(!a)throw new Error("无法获取响应流");const r=new TextDecoder;let o="",i="",s=0;const l=e=>{e&&t&&(s++,(s<=3||s%100==0)&&console.log(`[AI服务-流式] chunk #${s}: "${e.substring(0,30)}..."`),t(e))};try{for(;;){if(this.isAborted){try{await a.cancel()}catch{}throw new Error("请求已取消")}const{done:e,value:t}=await a.read();if(e)break;i+=r.decode(t,{stream:!0});const s=i.split("\n");i=s.pop()||"";for(const e of s){const t=e.trim();if(!t||!t.startsWith("data:"))continue;let a=t.slice(5);if(a.startsWith(" ")&&(a=a.slice(1)),"[DONE]"!==a)try{const e=n(a);e&&(o+=e,l(e))}catch(e){console.warn("[AI服务-流式] 解析chunk失败:",a.substring(0,100))}}}}finally{a.releaseLock()}return console.log(`[AI服务-流式] 完成，总长度: ${o.length}`),o}isForceJsonEnabled(e){const n=this.getAPIConfigForUsageType(e);return!0===n?.forceJsonOutput}checkAvailability(){return"tavern"===this.config.mode?this.getTavernHelper()?{available:!0,message:"酒馆模式已就绪"}:{available:!1,message:this.isTavernEnvironment()?"酒馆环境不可用。请在SillyTavern中打开，或切换到自定义API模式。":"当前环境不可用，请切换到自定义API模式。"}:this.config.customAPI?.url&&this.config.customAPI?.apiKey?{available:!0,message:"自定义API模式已就绪"}:{available:!1,message:"自定义API未配置。请在设置中配置API地址和密钥。"}}}},7457:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-3e075713] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-3e075713] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-3e075713 0.3s ease-out;\n}\n@keyframes slideUp-3e075713 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-3e075713] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-3e075713] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-3e075713]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-3e075713] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n  min-height: 200px;\n}\n\n/* Loading State */\n.loading-state[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem;\n  gap: 1rem;\n}\n.spinner[data-v-3e075713] {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(var(--color-primary-rgb), 0.2);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-3e075713 1s linear infinite;\n}\n@keyframes spin-3e075713 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* Empty State */\n.empty-state[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 2rem;\n  text-align: center;\n}\n.empty-icon[data-v-3e075713] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  opacity: 0.5;\n}\n.empty-state p[data-v-3e075713] {\n  margin: 0.5rem 0;\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-3e075713] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n  max-width: 300px;\n}\n\n/* Export Options */\n.export-options[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n.option-label[data-v-3e075713] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.option-label[data-v-3e075713]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.radio-input[data-v-3e075713] {\n  margin-top: 0.2rem;\n  cursor: pointer;\n}\n.option-text[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  flex: 1;\n}\n.option-title[data-v-3e075713] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.option-desc[data-v-3e075713] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n\n/* Presets List */\n.presets-list[data-v-3e075713] {\n  margin-bottom: 1.5rem;\n}\n.list-header[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  margin-bottom: 1rem;\n}\n.checkbox-label[data-v-3e075713] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n.checkbox-input[data-v-3e075713] {\n  cursor: pointer;\n}\n.selected-count[data-v-3e075713] {\n  font-size: 0.85rem;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.preset-items[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  max-height: 300px;\n  overflow-y: auto;\n  padding: 0.25rem;\n}\n.preset-item[data-v-3e075713] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.preset-item[data-v-3e075713]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.preset-item.selected[data-v-3e075713] {\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n}\n.preset-info[data-v-3e075713] {\n  flex: 1;\n}\n.preset-header[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.25rem;\n}\n.preset-name[data-v-3e075713] {\n  margin: 0;\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.preset-date[data-v-3e075713] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.preset-description[data-v-3e075713] {\n  margin: 0.25rem 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.3;\n}\n.preset-tags[data-v-3e075713] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n  flex-wrap: wrap;\n}\n.info-tag[data-v-3e075713] {\n  padding: 0.2rem 0.6rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 10px;\n  font-size: 0.7rem;\n  color: var(--color-primary);\n}\n.info-tag.name-tag[data-v-3e075713] {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.15), rgba(var(--color-primary-rgb), 0.15));\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n  font-weight: 600;\n}\n.info-tag.age-tag[data-v-3e075713] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n}\n\n/* Export Info */\n.export-info[data-v-3e075713] {\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.info-item[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.85rem;\n}\n.info-label[data-v-3e075713] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-3e075713] {\n  color: var(--color-text);\n  font-family: 'Monaco', 'Courier New', monospace;\n}\n.modal-footer[data-v-3e075713] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-3e075713] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-3e075713] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-3e075713]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-3e075713] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-3e075713]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-3e075713]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-3e075713] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-3e075713] {\n    padding: 1rem;\n}\n.modal-title[data-v-3e075713] {\n    font-size: 1.1rem;\n}\n.modal-content[data-v-3e075713] {\n    padding: 1rem;\n}\n.modal-footer[data-v-3e075713] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-3e075713] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},7527:(e,n,t)=>{"use strict";t.d(n,{VQ:()=>r,eQ:()=>a,qS:()=>i,yM:()=>o});const a=[{id:1,name:"旧世界·黄昏",era:"灾变前夜",description:"灾变爆发前的最后时刻。世界运转如常，科技发达，社会秩序井然。但全球各地开始出现零星的神秘失踪事件和无法解释的异常现象，社交媒体上流传着模糊的怪物影像，被当作谣言或恶作剧。国家机器仍在运转，军队和警察维持着表面秩序。真正的末日尚未降临，但不安的暗流已经在普通人心中蔓延。"},{id:2,name:"大崩溃·第一周",era:"灾变爆发后第一周",description:"全球同步爆发的“现实癌变”将文明瞬间推入深渊。网络被海啸般的怪物影像淹没，随后一道无声脉冲瘫痪了所有精密电子设备。社会结构在数日内彻底崩解：政府广播陷入死寂，军队溃散，城市沦为尖叫与火焰的迷宫。大规模自杀潮、宗教狂热、暴力掠夺在每一条街道上演。幸存者蜷缩在废墟和地下室里，对正在发生的一切一无所知。"},{id:3,name:"新规则·第一个月",era:"灾变后第一个月",description:"物理法则开始出现局部失效，空间折叠、时间错乱、现实癌变区域如同活体般扩张。生物疯狂突变，人类中开始出现第一批觉醒者——他们的身体被粗暴改写，力量伴随直观的肉体异化和生理紊乱。幸存者发现，自己并未被抛回石器时代，而是一个物理与逻辑都可能随机断裂的崭新地狱。结晶从怪物体内被发现，觉醒者本能地感到渴望，但其用途无人知晓。"},{id:4,name:"求生纪元·第一年",era:"灾变后一年",description:"最初的恐慌逐渐被麻木的求生取代。幸存者开始形成小型临时团体：家族、友伴、溃散组织残部。一些坚固建筑被改造为临时避难所，以物易物的原始交易在绝对猜忌中艰难进行。觉醒者数量缓慢增加，他们既是珍贵的火种，也是令人恐惧的异类，大多被排斥或工具化。第一批异常地带被幸存者口口相传标记为禁地。"},{id:5,name:"据点雏形·第五年",era:"灾变后五年",description:"幸存者开始从单纯的求生转向建立相对稳定的据点。堡垒城寨、蜂巢集市、学院前哨、蜕变教团、暗影宫廷等势力雏形相继浮现。觉醒者中出现了掌控期个体，能够主动运用能力，成为据点的中坚力量。结晶的价值被初步认知——它能用来制作回复药剂和稳定剂，防止代价反噬。但各据点之间信息隔绝，信任仍是奢侈品。"},{id:6,name:"势力成型·第十年",era:"灾变后十年",description:"各大势力格局基本成型：守序派主导的堡垒城寨、流动派主导的蜂巢集市、理解派主导的学院前哨、拥抱派主导的蜕变教团、隐匿派主导的暗影宫廷。觉醒者中出现了精通期个体，他们的能力成为团队核心，但代价的深化使他们逐渐远离普通人。结晶成为权力实体通货，围绕它的争夺引发无数次小型战争。"},{id:7,name:"混沌纪元·二十五年",era:"灾变后二十五年",description:"世界进入相对稳定的混沌状态。人类幸存者不足灾变前5%，但已学会与突变生物和异常地带共存。质变期觉醒者（B级威胁）开始出现，他们是一方霸主，能够影响区域局势，但人性已经严重异化。结晶经济高度成熟，阶层固化：支配结晶的觉醒者精英与使用血点的劳动者生活在两个世界。霸主级生物和天灾级实体虽仍罕见，但已被证实存在。"},{id:8,name:"进化歧路·五十年",era:"灾变后五十年",description:"人类与非人存在的界限愈发模糊。突破期觉醒者（A级）行走于废土，他们是行走的传奇，也是移动的天灾。古老实体彻底融入世界，有些家族与人类建立了脆弱的共生关系。蜕变教团发展出系统的自我改造仪式，其成员在拥抱异化的道路上越走越远。少数人开始追问“灾变的真相”，但那些触及规则深处的人，往往无声无息地消失。"},{id:9,name:"纪元黄昏·百年后",era:"灾变后一百年",description:"这个时间点的记录极度匮乏，仅存在于少数禁忌知识中。传说中，突破期觉醒者开始触及“飞升”的可能性，但仙路已断，前路无人知晓。神灾级存在（S级）是否已经降临？旧世界的最后一批记忆者早已离世，新一代幸存者将废墟视为理所当然的故乡。世界的规则还在缓慢演变，而人类能否延续，仍是未知数。"}],r=[{id:1,name:"凡人",description:"普通的幸存者，没有特殊天赋。在末世中只能依靠最基础的生存技能勉强维生。",total_points:10,rarity:1,color:"#718096"},{id:2,name:"拾荒者",description:"擅长在废墟中寻找有用物资，对资源有敏锐的嗅觉。比别人更容易发现隐藏的补给。",total_points:20,rarity:2,color:"#E2E8F0"},{id:3,name:"猎手",description:"曾多次与突变生物交锋，熟悉它们的习性与弱点。狩猎效率更高，伤亡率更低。",total_points:35,rarity:3,color:"#63B3ED"},{id:4,name:"觉醒者",description:"已经历过一次濒死，理性屏障出现裂痕。能够引导体内的异常能量，觉醒异能的概率大幅提升。",total_points:50,rarity:4,color:"#9F7AEA"},{id:5,name:"进化先驱",description:"主动拥抱异变，将代价视为进化的阶梯。身体已出现可控的异化，异能强度和代价深度均高于常人。",total_points:70,rarity:5,color:"#F6E05E"},{id:6,name:"畸变适应者",description:"天生对异常辐射有极高抗性，代价深化速度缓慢，更容易在高压环境下保持理智。",total_points:85,rarity:6,color:"#F56565"},{id:7,name:"旧世界遗民",description:"你来自灾变前，曾在旧世界的精英机构工作。你掌握的尖端知识在末世依然价值连城，但你的人际网络早已消散。",total_points:100,rarity:7,color:"#ED8936"}],o=[{id:101,name:"磐石堡遗孤",description:"你在磐石堡的孤儿院长大，从小接受严格的军事训练。虽然没受过正规教育，但战斗本能远超同龄人。",talent_cost:0,attribute_modifiers:{strength:1,constitution:1,willpower:1},rarity:3},{id:102,name:"城寨警卫",description:"你曾是磐石堡的巡逻队员，每天在围墙上警戒突变生物的袭击。长期的警觉训练让你对危险有极快的反应。",talent_cost:2,attribute_modifiers:{agility:1,willpower:1,perception:1},rarity:3},{id:201,name:"集市流浪儿",description:"你在锈钉集市长大，靠偷窃和打零工维生。你学会了察言观色，能从交易对象的表情判断货物的真实价值。",talent_cost:0,attribute_modifiers:{charm:1,luck:1},rarity:2},{id:202,name:"走私商贩",description:"你常年游走于各大据点之间，倒卖违禁品。你认识每一个集市的中间人，也知道哪条路线相对安全。",talent_cost:3,attribute_modifiers:{charm:2,luck:1,agility:1},rarity:4},{id:301,name:"灰烬学院研究员",description:"你曾是灰烬学院的档案管理员，终日与旧世界文献为伴。你的知识储备丰富，但实战经验匮乏。",talent_cost:4,attribute_modifiers:{willpower:2,intellect:2},rarity:4},{id:302,name:"战地医师",description:"你跟随狩猎队行动，负责救治伤员。你熟练使用旧世界的医疗器具，能在简陋条件下完成手术。",talent_cost:2,attribute_modifiers:{constitution:1,willpower:1,charm:1},rarity:3},{id:401,name:"机械神教信徒",description:"你自愿接受了机械义肢改造，左臂和右眼已完全义体化。你对疼痛的阈值极高，但部分人类情感已钝化。",talent_cost:5,attribute_modifiers:{strength:2,constitution:2,willpower:-1,charm:-1},rarity:4},{id:402,name:"畸变崇拜者",description:"你主动接触异常辐射，诱导身体产生可控异化。你的部分皮肤呈现出晶质化纹理，异能觉醒概率提高。",talent_cost:4,attribute_modifiers:{constitution:1,willpower:2,charm:-2},rarity:4},{id:501,name:"血族仆从",description:"你为某位隐匿智裔家族服务，虽未转化为同类，但获得了部分契约能力——夜视和短暂的血肉再生。代价是你必须在特定月相履行仆从义务。",talent_cost:6,attribute_modifiers:{agility:2,luck:1,willpower:2},rarity:5},{id:601,name:"流浪猎人",description:"你没有固定居所，以猎杀突变生物为生。你熟悉各种突变生物的解剖结构，能完整取出有价值的器官。",talent_cost:2,attribute_modifiers:{strength:2,agility:1,luck:1},rarity:3},{id:602,name:"矿奴余生",description:"你曾被奴役在裂谷地带的结晶矿场，在暗无天日的矿洞中熬过三年。你的体魄远超常人，但精神留下了永久的创伤。",talent_cost:-2,attribute_modifiers:{strength:3,constitution:2,willpower:-3,sanity_max:-10},rarity:2},{id:603,name:"旧世界军官",description:"灾变前你是职业军人，经历过完整的战术训练。你懂得指挥小队作战，也能熟练使用绝大多数旧世界枪械。",talent_cost:5,attribute_modifiers:{strength:1,agility:1,willpower:2,charm:1},rarity:5},{id:604,name:"地下庇护所幸存者",description:"灾变时你躲进了私人避难所，依靠储备物资生存了五年。你对外界几乎一无所知，但身体健康、心态相对稳定。",talent_cost:1,attribute_modifiers:{constitution:2,willpower:1,luck:-1},rarity:2},{id:605,name:"变异兽驯养者",description:"你从小与一只幼年突变生物共同成长，彼此建立了奇特的共生关系。你懂得解读它的情绪，也能借助它的感官。",talent_cost:3,attribute_modifiers:{charm:2,agility:1},rarity:3},{id:606,name:"信号塔监听员",description:"你守着废土上一座还在运转的信号塔，日夜监听来自各地的无线电波。你知道许多别人不知道的秘密，但也因此知道了太多不该知道的事。",talent_cost:2,attribute_modifiers:{willpower:2,luck:1},rarity:3},{id:607,name:"拾荒工程师",description:"你擅长从废墟中拆解还能使用的零件，并用它们组装出各种简易设备。虽然外表粗糙，但功能可靠。",talent_cost:2,attribute_modifiers:{intellect:2,constitution:1},rarity:3},{id:608,name:"荒野传教士",description:"你曾跟随某个变异崇拜教团的边缘人物，耳濡目染了一些古怪的仪式和禁忌知识。你对异常有独特的理解，但也因此被许多人视为疯子。",talent_cost:0,attribute_modifiers:{willpower:2,charm:-1},rarity:2},{id:609,name:"海岸拾荒者",description:"你在环海群岛一带讨生活，熟悉潮汐规律和变异海洋生物的习性。你擅长潜水，能从海底捞起旧世界的沉没货物。",talent_cost:1,attribute_modifiers:{constitution:2,agility:1},rarity:3},{id:610,name:"废墟遗迹盗墓者",description:"你专干闯入旧世界遗迹的买卖，对陷阱和机关有本能的警觉。你见识过许多常人无法理解的东西，理智边缘时常出现幻听。",talent_cost:3,attribute_modifiers:{agility:2,luck:2,willpower:-2},rarity:4}],i=[{id:1,name:"环境适应",description:"在废墟、沼泽等恶劣环境中行动时，体力消耗降低，感知危险的能力提升。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"constitution",value:2},{type:"特殊能力",name:"生存直觉",value:.1}]},{id:2,name:"理智锚固",description:"你的心智比常人更加稳固，每次理智损失降低1点，且疯狂阈值提升10%。",talent_cost:4,rarity:4,effects:[{type:"后天属性",target:"willpower",value:3},{type:"特殊能力",name:"抗疯狂",value:.2}]},{id:3,name:"资源嗅觉",description:"搜索废墟时，更容易发现隐藏的物资；交易时对方压价难度增加。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"luck",value:3},{type:"特殊能力",name:"搜寻加成",value:.15}]},{id:4,name:"战术协同",description:"当你与至少两名同伴并肩作战时，全队获得+1攻击检定和+1防御检定。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"charm",value:2},{type:"特殊能力",name:"团队光环",value:.15}]},{id:5,name:"异常抗性",description:"身处异常地带时，受到的规则扭曲影响降低20%，理智损失减半。",talent_cost:4,rarity:4,effects:[{type:"后天属性",target:"willpower",value:2},{type:"后天属性",target:"constitution",value:1}]},{id:6,name:"冷静处理",description:"危机时刻你更容易保持镇定，恐惧和绝望效果对你的影响时间减半。",talent_cost:2,rarity:2,effects:[{type:"后天属性",target:"willpower",value:2}]},{id:7,name:"危机感知",description:"你拥有野兽般的直觉，能够提前感知即将到来的危险，伏击和偷袭你的难度增加。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"agility",value:2},{type:"后天属性",target:"luck",value:1}]},{id:8,name:"耐力增强",description:"体力上限提升20%，体力恢复速度提升25%。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"constitution",value:3}]},{id:9,name:"魅力光环",description:"你更容易获得陌生人的初步信任，交易时获得5%的价格优惠，招募追随者时成功率提升。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"charm",value:3}]},{id:10,name:"幸运偏斜",description:"你的命运似乎被某种力量偏爱，大失败概率降低50%，大成功概率提升10%。",talent_cost:5,rarity:4,effects:[{type:"后天属性",target:"luck",value:4},{type:"特殊能力",name:"命运偏斜",value:.1}]},{id:11,name:"工具大师",description:"你擅长维修和改装工具、武器、护甲，使其耐久度提升30%，且临时修复的成功率翻倍。",talent_cost:2,rarity:2,effects:[{type:"后天属性",target:"intellect",value:2},{type:"特殊能力",name:"维修精通",value:.2}]},{id:12,name:"隐匿行者",description:"你在废墟、丛林等复杂地形中潜行时，被发现概率降低30%。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"agility",value:3}]},{id:13,name:"数据洞察",description:"你能够从旧世界的数据终端中提取出常人忽略的信息，解读遗迹档案时，理解准确率提升30%，误读风险降低。",talent_cost:4,rarity:4,effects:[{type:"后天属性",target:"willpower",value:3},{type:"特殊能力",name:"信息解析",value:.2}]},{id:14,name:"前线医护",description:"你能够在战斗中快速处理伤口，止血和简易包扎的时间减半，且能稳定重伤员防止其恶化。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"charm",value:1},{type:"后天属性",target:"constitution",value:1}]},{id:15,name:"稳态输出",description:"你使用异能时，精神力消耗降低15%，且异能效果波动范围缩小（更稳定）。",talent_cost:4,rarity:4,effects:[{type:"后天属性",target:"willpower",value:2},{type:"特殊能力",name:"异能掌控",value:.15}]},{id:16,name:"低温适应",description:"你在寒冷环境（如永夜冰原）中行动时，体力消耗减半，且不受冻伤影响。",talent_cost:2,rarity:2,effects:[{type:"后天属性",target:"constitution",value:2}]},{id:17,name:"社交纽带",description:"你擅长在人际网络中周旋，更容易获得关键情报和引荐，与陌生人建立信任的速度加倍。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"charm",value:2},{type:"后天属性",target:"luck",value:1}]},{id:18,name:"强韧筋骨",description:"你的骨骼和肌肉密度高于常人，抗击打能力更强，物理伤害减免5点。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"strength",value:3}]},{id:19,name:"临机反应",description:"在遭遇突袭或意外时，你有一次机会重新进行先攻检定或立即进行一次闪避动作。",talent_cost:3,rarity:3,effects:[{type:"后天属性",target:"agility",value:2},{type:"后天属性",target:"willpower",value:1}]},{id:20,name:"区域适应载体",description:"你在某一特定区域（如裂谷地带、雾霾沼泽）长期活动后，会逐渐适应当地的异常规则，理智损失降低，但离开该区域后会有一段时间的不适应期。",talent_cost:6,rarity:5,effects:[{type:"后天属性",target:"constitution",value:2},{type:"后天属性",target:"willpower",value:2},{type:"特殊能力",name:"区域亲和",value:.2}]}]},7630:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.quantity-modal-overlay[data-v-5d734c3e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000; /* 确保在最上层 */\n  backdrop-filter: blur(4px);\n}\n.quantity-modal[data-v-5d734c3e] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-primary-border);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 400px;\n  color: var(--color-text);\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: modal-appear-5d734c3e 0.3s ease-out;\n  overflow: hidden;\n}\n@keyframes modal-appear-5d734c3e {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n.modal-header[data-v-5d734c3e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px 16px 24px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-primary-light);\n}\n.modal-header h3[data-v-5d734c3e] {\n  margin: 0;\n  color: var(--color-text);\n  font-size: 1.25rem;\n  font-weight: 600;\n}\n.close-btn[data-v-5d734c3e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-5d734c3e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border-color: var(--color-primary);\n}\n.modal-body[data-v-5d734c3e] {\n  padding: 24px;\n}\n.item-info[data-v-5d734c3e] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  margin-bottom: 24px;\n  padding: 16px;\n  background: var(--color-surface-light);\n  border-radius: 8px;\n}\n.item-icon[data-v-5d734c3e] {\n  font-size: 32px;\n  width: 48px;\n  height: 48px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n}\n.item-details[data-v-5d734c3e] {\n  flex: 1;\n}\n.item-name[data-v-5d734c3e] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 4px;\n}\n.item-type[data-v-5d734c3e] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 4px;\n}\n.available-quantity[data-v-5d734c3e] {\n  font-size: 0.85rem;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.quantity-selector[data-v-5d734c3e] {\n  margin-bottom: 20px;\n}\n.quantity-selector label[data-v-5d734c3e] {\n  display: block;\n  margin-bottom: 12px;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.quantity-controls[data-v-5d734c3e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.quantity-btn[data-v-5d734c3e] {\n  background: var(--color-surface-hover);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 20px;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.quantity-btn[data-v-5d734c3e]:hover:not(:disabled) {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.quantity-btn[data-v-5d734c3e]:disabled {\n  background: var(--color-surface-light);\n  color: var(--color-text-muted);\n  cursor: not-allowed;\n}\n.quantity-input[data-v-5d734c3e] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  padding: 8px 12px;\n  border-radius: 8px;\n  width: 100px;\n  text-align: center;\n  font-size: 1rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n}\n.quantity-input[data-v-5d734c3e]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.quantity-shortcuts[data-v-5d734c3e] {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n  margin-top: 16px;\n}\n.preset-btn[data-v-5d734c3e] {\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  padding: 6px 12px;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.8rem;\n  transition: all 0.2s ease;\n}\n.preset-btn[data-v-5d734c3e]:hover:not(:disabled) {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border-color: var(--color-border-hover);\n}\n.preset-btn[data-v-5d734c3e]:disabled {\n  background: var(--color-surface);\n  color: var(--color-text-muted);\n  cursor: not-allowed;\n}\n.modal-footer[data-v-5d734c3e] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding: 16px 24px 24px 24px;\n  border-top: 1px solid var(--color-border);\n}\n.cancel-btn[data-v-5d734c3e], .confirm-btn[data-v-5d734c3e] {\n  padding: 10px 20px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 80px;\n}\n.cancel-btn[data-v-5d734c3e] {\n  background: var(--color-surface-hover);\n  color: var(--color-text-secondary);\n}\n.cancel-btn[data-v-5d734c3e]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.confirm-btn[data-v-5d734c3e] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.confirm-btn[data-v-5d734c3e]:hover:not(:disabled) {\n  background: var(--color-primary-hover);\n}\n.confirm-btn[data-v-5d734c3e]:disabled {\n  background: var(--color-surface-light);\n  border-color: var(--color-border);\n  color: var(--color-text-muted);\n  cursor: not-allowed;\n}\n.discard-confirm[data-v-5d734c3e] {\n  background: var(--color-danger) !important;\n  border-color: var(--color-danger) !important;\n}\n.discard-confirm[data-v-5d734c3e]:hover:not(:disabled) {\n  background: var(--color-danger-hover) !important;\n}\n.item-description[data-v-5d734c3e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin-top: 4px;\n  font-style: italic;\n}\n",""]);const s=i},7659:e=>{"use strict";var n={};e.exports=function(e,t){var a=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}},7677:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},7720:(e,n,t)=>{"use strict";var a=t(4765),r=Object.prototype.hasOwnProperty,o=Array.isArray,i=function(){for(var e=[],n=0;n<256;++n)e.push("%"+((n<16?"0":"")+n.toString(16)).toUpperCase());return e}(),s=function(e,n){for(var t=n&&n.plainObjects?Object.create(null):{},a=0;a<e.length;++a)void 0!==e[a]&&(t[a]=e[a]);return t},l=1024;e.exports={arrayToObject:s,assign:function(e,n){return Object.keys(n).reduce(function(e,t){return e[t]=n[t],e},e)},combine:function(e,n){return[].concat(e,n)},compact:function(e){for(var n=[{obj:{o:e},prop:"o"}],t=[],a=0;a<n.length;++a)for(var r=n[a],i=r.obj[r.prop],s=Object.keys(i),l=0;l<s.length;++l){var c=s[l],d=i[c];"object"==typeof d&&null!==d&&-1===t.indexOf(d)&&(n.push({obj:i,prop:c}),t.push(d))}return function(e){for(;e.length>1;){var n=e.pop(),t=n.obj[n.prop];if(o(t)){for(var a=[],r=0;r<t.length;++r)void 0!==t[r]&&a.push(t[r]);n.obj[n.prop]=a}}}(n),e},decode:function(e,n,t){var a=e.replace(/\+/g," ");if("iso-8859-1"===t)return a.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(a)}catch(e){return a}},encode:function(e,n,t,r,o){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===t)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var c="",d=0;d<s.length;d+=l){for(var u=s.length>=l?s.slice(d,d+l):s,p=[],v=0;v<u.length;++v){var f=u.charCodeAt(v);45===f||46===f||95===f||126===f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||o===a.RFC1738&&(40===f||41===f)?p[p.length]=u.charAt(v):f<128?p[p.length]=i[f]:f<2048?p[p.length]=i[192|f>>6]+i[128|63&f]:f<55296||f>=57344?p[p.length]=i[224|f>>12]+i[128|f>>6&63]+i[128|63&f]:(v+=1,f=65536+((1023&f)<<10|1023&u.charCodeAt(v)),p[p.length]=i[240|f>>18]+i[128|f>>12&63]+i[128|f>>6&63]+i[128|63&f])}c+=p.join("")}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,n){if(o(e)){for(var t=[],a=0;a<e.length;a+=1)t.push(n(e[a]));return t}return n(e)},merge:function e(n,t,a){if(!t)return n;if("object"!=typeof t){if(o(n))n.push(t);else{if(!n||"object"!=typeof n)return[n,t];(a&&(a.plainObjects||a.allowPrototypes)||!r.call(Object.prototype,t))&&(n[t]=!0)}return n}if(!n||"object"!=typeof n)return[n].concat(t);var i=n;return o(n)&&!o(t)&&(i=s(n,a)),o(n)&&o(t)?(t.forEach(function(t,o){if(r.call(n,o)){var i=n[o];i&&"object"==typeof i&&t&&"object"==typeof t?n[o]=e(i,t,a):n.push(t)}else n[o]=t}),n):Object.keys(t).reduce(function(n,o){var i=t[o];return r.call(n,o)?n[o]=e(n[o],i,a):n[o]=i,n},i)}}},7754:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]])},7760:(e,n,t)=>{"use strict";t.d(n,{ZT:()=>s,q3:()=>o});const a="dad.bundle",r=1;function o(e,n,t){return{schema:a,version:r,type:e,exportedAt:t?.exportedAt??(new Date).toISOString(),appVersion:t?.appVersion,payload:n}}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function s(e){if(function(e){return!!i(e)&&e.schema===a&&e.version===r&&"string"==typeof e.type}(e))return{type:e.type,payload:e.payload,isBundle:!0};if(i(e)&&"string"==typeof e.type){const n=e.type;if("saves"===n&&Array.isArray(e.saves))return{type:"saves",payload:{saves:e.saves},isBundle:!1};if("character"===n&&i(e.character))return{type:"character",payload:e.character,isBundle:!1};if("settings"===n)return{type:"settings",payload:e.settings??e,isBundle:!1};if("prompts"===n)return{type:"prompts",payload:e,isBundle:!1};if("start_config"===n)return{type:"start_config",payload:e,isBundle:!1}}if(i(e)&&Array.isArray(e.presets)&&e.version)return{type:"presets",payload:{presets:e.presets},isBundle:!1};if(i(e)&&!e.type&&!e.schema){const n=Object.keys(e);if(n.length>0&&n.every(n=>"string"==typeof e[n]))return{type:"prompts",payload:e,isBundle:!1}}return i(e),{type:null,payload:e,isBundle:!1}}},7807:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.status-detail-card[data-v-627cf7f9] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.85rem;\n  font-size: 0.85rem;\n}\n.card-header[data-v-627cf7f9] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 10px;\n  border: 1px solid;\n  align-self: flex-start;\n  box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);\n}\n.card-header.buff[data-v-627cf7f9] {\n  background: linear-gradient(135deg, rgba(16, 185, 129, 0.18), rgba(16, 185, 129, 0.08));\n  border-color: rgba(16, 185, 129, 0.35);\n}\n.card-header.debuff[data-v-627cf7f9] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.18), rgba(239, 68, 68, 0.08));\n  border-color: rgba(239, 68, 68, 0.35);\n}\n.type-icon[data-v-627cf7f9] {\n  width: 22px;\n  height: 22px;\n  border-radius: 6px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.9rem;\n  font-weight: 700;\n  background: rgba(15, 23, 42, 0.08);\n}\n.type-text[data-v-627cf7f9] {\n  font-size: 0.85rem;\n  font-weight: 600;\n}\n.card-header.buff .type-text[data-v-627cf7f9] { color: #10b981;\n}\n.card-header.debuff .type-text[data-v-627cf7f9] { color: #ef4444;\n}\n.card-body[data-v-627cf7f9] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.9rem;\n}\n.description[data-v-627cf7f9] {\n  padding: 0.75rem 0.9rem;\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.04), rgba(15, 23, 42, 0.02));\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  border-left: 3px solid;\n  line-height: 1.5;\n  color: var(--color-text);\n}\n.description.buff-border[data-v-627cf7f9] { border-color: #10b981;\n}\n.description.debuff-border[data-v-627cf7f9] { border-color: #ef4444;\n}\n.details-grid[data-v-627cf7f9] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.6rem;\n}\n.detail-item[data-v-627cf7f9] {\n  padding: 0.7rem 0.8rem;\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.02), rgba(15, 23, 42, 0.01));\n  border-radius: 10px;\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.item-label[data-v-627cf7f9] {\n  font-size: 0.7rem;\n  color: var(--color-text-muted);\n  font-weight: 500;\n}\n.item-value[data-v-627cf7f9] {\n  font-size: 0.9rem;\n  font-weight: 600;\n}\n.item-value.source[data-v-627cf7f9] { color: var(--color-accent);\n}\n.item-value.duration[data-v-627cf7f9] { color: var(--color-primary);\n}\n.item-value.time[data-v-627cf7f9] { font-size: 0.75rem; font-weight: 500; color: var(--color-text);\n}\n.strength[data-v-627cf7f9] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.25rem;\n}\n.strength-text[data-v-627cf7f9] { font-size: 0.9rem; font-weight: 700;\n}\n.strength-value[data-v-627cf7f9] { font-size: 0.7rem; color: var(--color-text-secondary);\n}\n.strength-bar[data-v-627cf7f9] {\n  height: 6px;\n  background: rgba(15, 23, 42, 0.08);\n  border-radius: 999px;\n  overflow: hidden;\n}\n.bar-fill[data-v-627cf7f9] {\n  height: 100%;\n  transition: width 0.3s ease;\n  border-radius: 999px;\n}\n@media (max-width: 480px) {\n.status-detail-card[data-v-627cf7f9] {\n    gap: 0.5rem;\n    font-size: 0.75rem;\n}\n.card-header[data-v-627cf7f9] {\n    gap: 0.4rem;\n    padding: 0.35rem 0.55rem;\n    border-radius: 8px;\n}\n.type-icon[data-v-627cf7f9] { width: 20px; height: 20px; font-size: 0.8rem;\n}\n.type-text[data-v-627cf7f9] { font-size: 0.75rem;\n}\n.description[data-v-627cf7f9] {\n    padding: 0.55rem 0.65rem;\n    font-size: 0.75rem;\n}\n.details-grid[data-v-627cf7f9] {\n    grid-template-columns: 1fr;\n    gap: 0.45rem;\n}\n.detail-item[data-v-627cf7f9] {\n    padding: 0.55rem;\n    gap: 0.3rem;\n}\n.item-label[data-v-627cf7f9] { font-size: 0.6rem;\n}\n.item-value[data-v-627cf7f9] { font-size: 0.8rem;\n}\n.item-value.time[data-v-627cf7f9] { font-size: 0.7rem;\n}\n.strength[data-v-627cf7f9] { margin-bottom: 0.1rem;\n}\n.strength-text[data-v-627cf7f9] { font-size: 0.85rem;\n}\n.strength-value[data-v-627cf7f9] { font-size: 0.65rem;\n}\n}\n",""]);const s=i},7816:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.data-display[data-v-3e8f894e] {\n  flex: 1;\n  overflow: auto;\n  padding: 1rem;\n}\n.loading-state[data-v-3e8f894e],\n.no-connection[data-v-3e8f894e],\n.error-state[data-v-3e8f894e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 3rem;\n  color: var(--color-text-secondary);\n}\n.retry-btn[data-v-3e8f894e] {\n  padding: 0.5rem 1rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.retry-btn[data-v-3e8f894e]:hover {\n  background: var(--color-primary-hover);\n}\n.hint[data-v-3e8f894e] {\n  font-size: 0.875rem;\n  opacity: 0.7;\n}\n.animate-spin[data-v-3e8f894e] {\n  animation: spin-3e8f894e 1s linear infinite;\n}\n@keyframes spin-3e8f894e {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n",""]);const s=i},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var a="";t.supports&&(a+="@supports (".concat(t.supports,") {")),t.media&&(a+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(a+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),a+=t.css,r&&(a+="}"),t.media&&(a+="}"),t.supports&&(a+="}");var o=t.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),n.styleTagTransform(a,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},7869:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.save-data-section[data-v-0294732f] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-0294732f] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-0294732f] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.save-data-content[data-v-0294732f] {\n  flex: 1;\n  overflow: auto;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.75rem;\n}\n.data-tree[data-v-0294732f] {\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n}\n.empty-state[data-v-0294732f] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n",""]);const s=i},7951:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.world-map-route[data-v-7e14997c] {\n  width: 100%;\n  height: 100%;\n}\n",""]);const s=i},8002:e=>{"use strict";e.exports=Math.min},8068:e=>{"use strict";e.exports=SyntaxError},8092:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.memory-section[data-v-04e0cd04] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-04e0cd04] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-04e0cd04] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.memory-content[data-v-04e0cd04] {\n  flex: 1;\n  overflow: hidden;\n}\n.data-display[data-v-04e0cd04] {\n  height: 100%;\n  overflow: hidden;\n}\n.code-pre[data-v-04e0cd04] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  height: 100%;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-04e0cd04] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.memory-section[data-v-04e0cd04] {\n    padding: 0.75rem;\n}\n.section-title[data-v-04e0cd04] {\n    font-size: 1rem;\n    text-align: center;\n}\n.code-pre[data-v-04e0cd04] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n.empty-state[data-v-04e0cd04] {\n    padding: 2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.memory-section[data-v-04e0cd04] {\n    padding: 0.5rem;\n}\n.section-title[data-v-04e0cd04] {\n    font-size: 0.9rem;\n}\n.code-pre[data-v-04e0cd04] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n}\n",""]);const s=i},8129:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.variable-section[data-v-0e56e6f2] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-0e56e6f2] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-0e56e6f2] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.add-btn[data-v-0e56e6f2] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.5rem 1rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.add-btn[data-v-0e56e6f2]:hover {\n  background: var(--color-primary-hover);\n}\n.add-btn[data-v-0e56e6f2]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: var(--color-border);\n}\n.variable-content[data-v-0e56e6f2] {\n  flex: 1;\n  overflow: hidden;\n}\n.variable-list[data-v-0e56e6f2] {\n  height: 100%;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.variable-item[data-v-0e56e6f2] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 1rem;\n}\n.variable-header[data-v-0e56e6f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n  gap: 0.5rem;\n}\n.variable-key[data-v-0e56e6f2] {\n  font-weight: 600;\n  color: var(--color-primary);\n  flex: 1;\n  word-break: break-word;\n}\n.variable-type[data-v-0e56e6f2] {\n  font-size: 0.75rem;\n  padding: 0.125rem 0.5rem;\n  background: var(--color-accent-light);\n  color: var(--color-accent);\n  border-radius: 4px;\n  flex-shrink: 0;\n}\n.variable-actions[data-v-0e56e6f2] {\n  display: flex;\n  gap: 0.25rem;\n  flex-shrink: 0;\n}\n.action-btn[data-v-0e56e6f2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  padding: 0;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: var(--color-text-secondary);\n  background: var(--color-surface);\n}\n.action-btn[data-v-0e56e6f2]:hover {\n  background: var(--color-hover);\n  color: var(--color-text);\n}\n.action-btn[data-v-0e56e6f2]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  border-color: var(--color-border);\n}\n.action-btn.edit[data-v-0e56e6f2]:disabled:hover,\n.action-btn.copy[data-v-0e56e6f2]:disabled:hover,\n.action-btn.delete[data-v-0e56e6f2]:disabled:hover {\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  border-color: var(--color-border);\n}\n.action-btn.edit[data-v-0e56e6f2]:hover {\n  background: var(--color-info);\n  color: white;\n  border-color: var(--color-info);\n}\n.action-btn.copy[data-v-0e56e6f2]:hover {\n  background: var(--color-success);\n  color: white;\n  border-color: var(--color-success);\n}\n.action-btn.delete[data-v-0e56e6f2]:hover {\n  background: var(--color-danger);\n  color: white;\n  border-color: var(--color-danger);\n}\n.variable-value[data-v-0e56e6f2] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  word-break: break-word;\n}\n.code-pre[data-v-0e56e6f2] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  max-height: 200px;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-0e56e6f2] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 1rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n.debug-info[data-v-0e56e6f2] {\n  margin-top: 1rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.debug-info summary[data-v-0e56e6f2] {\n  cursor: pointer;\n  color: var(--color-primary);\n}\n.debug-content[data-v-0e56e6f2] {\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-radius: 4px;\n  text-align: left;\n}\n.debug-actions[data-v-0e56e6f2] {\n  margin-top: 0.5rem;\n}\n.debug-btn[data-v-0e56e6f2] {\n  padding: 0.25rem 0.5rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.variable-section[data-v-0e56e6f2] {\n    padding: 0.75rem;\n}\n.section-header[data-v-0e56e6f2] {\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.5rem;\n    margin-bottom: 0.75rem;\n}\n.section-title[data-v-0e56e6f2] {\n    font-size: 1rem;\n    text-align: center;\n}\n.add-btn[data-v-0e56e6f2] {\n    align-self: center;\n    padding: 0.4rem 0.8rem;\n    font-size: 0.8rem;\n}\n.variable-item[data-v-0e56e6f2] {\n    padding: 0.75rem;\n}\n.variable-header[data-v-0e56e6f2] {\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.5rem;\n}\n.variable-key[data-v-0e56e6f2] {\n    font-size: 0.9rem;\n}\n.variable-actions[data-v-0e56e6f2] {\n    justify-content: center;\n    gap: 0.5rem;\n}\n.action-btn[data-v-0e56e6f2] {\n    width: 32px;\n    height: 32px;\n}\n.code-pre[data-v-0e56e6f2] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.variable-section[data-v-0e56e6f2] {\n    padding: 0.5rem;\n}\n.section-title[data-v-0e56e6f2] {\n    font-size: 0.9rem;\n}\n.add-btn[data-v-0e56e6f2] {\n    padding: 0.35rem 0.7rem;\n    font-size: 0.75rem;\n}\n.variable-item[data-v-0e56e6f2] {\n    padding: 0.5rem;\n}\n.variable-key[data-v-0e56e6f2] {\n    font-size: 0.85rem;\n}\n.variable-type[data-v-0e56e6f2] {\n    font-size: 0.7rem;\n}\n.action-btn[data-v-0e56e6f2] {\n    width: 28px;\n    height: 28px;\n}\n.code-pre[data-v-0e56e6f2] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n.empty-state[data-v-0e56e6f2] {\n    padding: 2rem 0.5rem;\n}\n}\n",""]);const s=i},8133:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("flask-conical",[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]])},8153:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.format-guide-modal-overlay[data-v-6ab4ee13] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  backdrop-filter: blur(4px);\n  padding: 20px;\n}\n.format-guide-modal[data-v-6ab4ee13] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  width: 100%;\n  max-width: 1000px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: slideUp-6ab4ee13 0.3s ease;\n}\n@keyframes slideUp-6ab4ee13 {\nfrom {\n    transform: translateY(20px);\n    opacity: 0;\n}\nto {\n    transform: translateY(0);\n    opacity: 1;\n}\n}\n.modal-header[data-v-6ab4ee13] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-6ab4ee13] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-6ab4ee13] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n}\n.close-btn[data-v-6ab4ee13]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-6ab4ee13] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0;\n}\n.format-guide-content[data-v-6ab4ee13] {\n  display: flex;\n  height: 100%;\n}\n.quick-nav[data-v-6ab4ee13] {\n  width: 180px;\n  border-right: 1px solid var(--color-border);\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  flex-shrink: 0;\n}\n.nav-btn[data-v-6ab4ee13] {\n  padding: 0.6rem 1rem;\n  background: transparent;\n  border: none;\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  text-align: left;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.nav-btn[data-v-6ab4ee13]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.nav-btn.active[data-v-6ab4ee13] {\n  background: var(--color-primary);\n  color: white;\n}\n.format-sections[data-v-6ab4ee13] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n.format-section[data-v-6ab4ee13] {\n  margin-bottom: 2rem;\n}\n.section-title[data-v-6ab4ee13] {\n  margin: 0 0 1rem 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  border-bottom: 2px solid var(--color-primary);\n  padding-bottom: 0.5rem;\n}\n.section-content h5[data-v-6ab4ee13] {\n  margin: 1rem 0 0.5rem 0;\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.code-block[data-v-6ab4ee13] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 1rem;\n  margin: 0.5rem 0;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n  line-height: 1.6;\n  color: var(--color-text);\n  overflow-x: auto;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n.example-box[data-v-6ab4ee13] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-left: 3px solid var(--color-primary);\n  padding: 1rem;\n  margin: 1rem 0;\n  border-radius: 4px;\n}\n.example-box strong[data-v-6ab4ee13] {\n  color: var(--color-primary);\n  display: block;\n  margin-bottom: 0.5rem;\n}\n.warning-box[data-v-6ab4ee13] {\n  background: rgba(255, 193, 7, 0.1);\n  border-left: 3px solid #ffc107;\n  padding: 1rem;\n  margin: 1rem 0;\n  border-radius: 4px;\n}\n.warning-box strong[data-v-6ab4ee13] {\n  color: #ffc107;\n  display: block;\n  margin-bottom: 0.5rem;\n}\n.warning-box ul[data-v-6ab4ee13] {\n  margin: 0.5rem 0 0 1.5rem;\n  padding: 0;\n}\n.warning-box li[data-v-6ab4ee13] {\n  margin: 0.3rem 0;\n  color: var(--color-text);\n}\n.modal-footer[data-v-6ab4ee13] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 1rem 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n.copy-btn[data-v-6ab4ee13],\n.close-footer-btn[data-v-6ab4ee13] {\n  padding: 0.6rem 1.2rem;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n}\n.copy-btn[data-v-6ab4ee13] {\n  background: var(--color-primary);\n  color: white;\n}\n.copy-btn[data-v-6ab4ee13]:hover {\n  background: var(--color-primary-hover);\n  transform: translateY(-1px);\n}\n.close-footer-btn[data-v-6ab4ee13] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  margin-left: auto;\n}\n.close-footer-btn[data-v-6ab4ee13]:hover {\n  background: var(--color-surface-hover);\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.format-guide-modal[data-v-6ab4ee13] {\n    max-width: 95vw;\n    max-height: 95vh;\n}\n.format-guide-content[data-v-6ab4ee13] {\n    flex-direction: column;\n}\n.quick-nav[data-v-6ab4ee13] {\n    width: 100%;\n    border-right: none;\n    border-bottom: 1px solid var(--color-border);\n    flex-direction: row;\n    overflow-x: auto;\n    padding: 0.75rem;\n}\n.nav-btn[data-v-6ab4ee13] {\n    white-space: nowrap;\n}\n.format-sections[data-v-6ab4ee13] {\n    padding: 1rem;\n}\n.modal-footer[data-v-6ab4ee13] {\n    flex-direction: column;\n}\n.close-footer-btn[data-v-6ab4ee13] {\n    margin-left: 0;\n}\n}\n",""]);const s=i},8179:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.sect-contribution[data-v-2e20bd6d] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n}\n.player-info-bar[data-v-2e20bd6d] {\n  display: flex;\n  gap: 1.5rem;\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(168, 85, 247, 0.05));\n  border-radius: 8px;\n  border: 1px solid rgba(147, 51, 234, 0.2);\n}\n.info-actions[data-v-2e20bd6d] {\n  margin-left: auto;\n  display: flex;\n  align-items: center;\n}\n.gen-btn[data-v-2e20bd6d] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.45rem 0.7rem;\n  border-radius: 8px;\n  border: 1px solid rgba(245, 158, 11, 0.25);\n  background: rgba(245, 158, 11, 0.08);\n  color: #f59e0b;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.gen-btn[data-v-2e20bd6d]:hover:not(:disabled) {\n  border-color: rgba(245, 158, 11, 0.45);\n  background: rgba(245, 158, 11, 0.12);\n}\n.gen-btn[data-v-2e20bd6d]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.spin[data-v-2e20bd6d] {\n  animation: spin-2e20bd6d 0.9s linear infinite;\n}\n@keyframes spin-2e20bd6d {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n.info-item[data-v-2e20bd6d] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.info-item.highlight[data-v-2e20bd6d] {\n  padding: 0.25rem 0.75rem;\n  background: rgba(245, 158, 11, 0.1);\n  border-radius: 6px;\n  border: 1px solid rgba(245, 158, 11, 0.2);\n}\n.info-label[data-v-2e20bd6d] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-2e20bd6d] {\n  font-weight: 600;\n  font-size: 0.9rem;\n}\n.info-value.position[data-v-2e20bd6d] { color: #9333ea;\n}\n.info-value.contribution[data-v-2e20bd6d] { color: #f59e0b; font-size: 1.1rem;\n}\n.exchange-tabs[data-v-2e20bd6d] {\n  left: 4px;\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn[data-v-2e20bd6d] {\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tab-btn[data-v-2e20bd6d]:hover {\n  border-color: rgba(245, 158, 11, 0.3);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-2e20bd6d] {\n  background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));\n  border-color: rgba(245, 158, 11, 0.4);\n  color: #f59e0b;\n}\n.exchange-list[data-v-2e20bd6d] {\n  flex: 1;\n  min-height: 0;\n  overflow-y: auto;\n}\n.empty-state[data-v-2e20bd6d] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-2e20bd6d] {\n  opacity: 0.5;\n  margin-bottom: 0.5rem;\n}\n.empty-text[data-v-2e20bd6d] {\n  font-weight: 600;\n  margin-bottom: 0.25rem;\n}\n.empty-hint[data-v-2e20bd6d] {\n  font-size: 0.8rem;\n  opacity: 0.7;\n  margin-bottom: 1rem;\n}\n.ask-btn[data-v-2e20bd6d] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.6rem 1rem;\n  background: linear-gradient(135deg, #f59e0b, #d97706);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.ask-btn[data-v-2e20bd6d]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);\n}\n.items-grid[data-v-2e20bd6d] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 0.75rem;\n}\n.item-card[data-v-2e20bd6d] {\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.item-card[data-v-2e20bd6d]:hover {\n  border-color: rgba(245, 158, 11, 0.3);\n}\n.item-card.can-afford[data-v-2e20bd6d] {\n  border-color: rgba(34, 197, 94, 0.3);\n}\n.item-card.out-of-stock[data-v-2e20bd6d] {\n  opacity: 0.5;\n}\n.item-header[data-v-2e20bd6d] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.item-icon[data-v-2e20bd6d] {\n  font-size: 1.5rem;\n}\n.item-info[data-v-2e20bd6d] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.15rem;\n}\n.item-name[data-v-2e20bd6d] {\n  font-weight: 600;\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n.item-quality[data-v-2e20bd6d] {\n  font-size: 0.7rem;\n  padding: 0.1rem 0.35rem;\n  border-radius: 4px;\n  font-weight: 500;\n  width: fit-content;\n}\n.quality-common[data-v-2e20bd6d] { background: rgba(156, 163, 175, 0.2); color: #6b7280;\n}\n.quality-yellow[data-v-2e20bd6d] { background: rgba(245, 158, 11, 0.2); color: #f59e0b;\n}\n.quality-xuan[data-v-2e20bd6d] { background: rgba(139, 92, 246, 0.2); color: #8b5cf6;\n}\n.quality-earth[data-v-2e20bd6d] { background: rgba(59, 130, 246, 0.2); color: #3b82f6;\n}\n.quality-heaven[data-v-2e20bd6d] { background: rgba(239, 68, 68, 0.2); color: #ef4444;\n}\n.item-desc[data-v-2e20bd6d] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n}\n.item-footer[data-v-2e20bd6d] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.item-cost[data-v-2e20bd6d] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #f59e0b;\n}\n.item-stock[data-v-2e20bd6d] {\n  display: flex;\n  align-items: center;\n  gap: 0.2rem;\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n.exchange-btn[data-v-2e20bd6d] {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.35rem;\n  padding: 0.5rem;\n  background: linear-gradient(135deg, #f59e0b, #d97706);\n  border: none;\n  border-radius: 5px;\n  color: white;\n  font-size: 0.8rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.exchange-btn[data-v-2e20bd6d]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);\n}\n.exchange-btn[data-v-2e20bd6d]:disabled {\n  background: #6b7280;\n  cursor: not-allowed;\n}\n.exchange-notice[data-v-2e20bd6d] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(59, 130, 246, 0.1);\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #3b82f6;\n}\n",""]);const s=i},8213:(e,n,t)=>{"use strict";t.d(n,{createJoinedSectState:()=>o});var a=t(628);const r=e=>{const n=String(e||"").toLowerCase();return/堡垒|城|寨|要塞/.test(n)?"堡垒城寨":/蜂巢|集市|交易|市场/.test(n)?"蜂巢集市":/学院|前哨|学派|研究/.test(n)?"学院前哨":/蜕变|教团|教派|宗教/.test(n)?"蜕变教团":/暗影|宫廷|黑暗|地下/.test(n)?"暗影宫廷":/流浪|游民|帮派|游荡|旅团/.test(n)?"流浪团体":(/正道|魔道|中立|商会|世家|散修/.test(n),"其他")},o=(e,n)=>{const t=n?.nowIso||(new Date).toISOString(),o=e.名称,i={势力名称:o,势力类型:r(String(e.类型||"堡垒城寨")),职位:"守卫",贡献:0,关系:"友好",声望:0,加入日期:t,描述:e.描述||""};return{sectSystem:{版本:a.BE,当前势力:o,势力档案:{[o]:e},势力成员:{},势力功法库:{},势力贡献商店:{},势力任务:{},势力任务状态:{}},memberInfo:i}}},8220:(e,n,t)=>{"use strict";t.d(n,{useCharacterStore:()=>se});var a=t(953),r=t(641),o=t(810),i=t(2543),s=t(4270),l=t(3302),c=t(9173),d=t(1211),u=t(5099),p=t(8651),v=t(6585),f=t(1184),h=t(6589),m=t(840),g=t(3098),b=t(6588),y=t(4530),x=t(2347),k=t(7527),w=t(6728);async function _(e,n){return new Promise(t=>{(0,c.useUIStore)().showRetryDialog({title:`${e}失败`,message:`${e}经过多次尝试后仍然失败。\n\n错误信息：${n}\n\n是否继续重试？\n选择"取消"将终止角色创建流程。`,onConfirm:()=>t(!0),onCancel:()=>t(!1)})})}function C(e,n){const{先天属性:t}=e,a=Number(t?.力量??0),r=Number(t?.敏捷??0),o=Number(t?.意志??0),i=Number(t?.体质??0),s=Number(t?.魅力??0),l=Number(t?.幸运??0),c=(0,w.Yk)({力量:a,敏捷:r,体质:i,意志:o,魅力:s,幸运:l}),d=(0,w.Nz)(c,"凡人"),u=80+5*a;return console.log(`[角色初始化] 属性计算: 生命值=${d.HP.上限}, 精神力=${d.SP.上限}, 理智值=${d.SAN.上限}, 年龄=${n}/${u}`),console.log(`[角色初始化] 先天属性: 力量=${a}, 敏捷=${r}, 意志=${o}`),{声望:0,位置:{描述:"位置生成失败",x:5e3,y:5e3,区域等级:"黄区"},生命值:d.HP,精神力:d.SP,体力:d.ST,理智值:d.SAN,寿命:{当前:n,上限:u}}}async function A(e,n,t,a,r=!0,o="generate",i=!0){console.log("[初始化流程] ===== initializeCharacter 入口 ====="),console.log("[初始化流程] 分步生成模式:",i);const l=(0,d.N)();!n.种族&&l.characterPayload.race&&(console.log(`[初始化流程] 补丁：从 store 同步种族信息: ${l.characterPayload.race}`),n.种族=l.characterPayload.race),console.log("[初始化流程] 接收到的 baseInfo.先天属性:",n.先天属性);try{const{saveData:e,processedBaseInfo:l}=function(e,n){let t;console.log("[初始化流程] 1. 准备初始存档数据"),console.log("[初始化流程] prepareInitialData 接收到的 baseInfo.先天属性:",e.先天属性);try{t=JSON.parse(JSON.stringify(e)),console.log("[初始化流程] JSON 序列化后的 processedBaseInfo.先天属性:",t.先天属性)}catch(n){console.error("[角色初始化] JSON 序列化失败，使用原始对象",n),t=e}const a=n;Math.floor(12*Math.random()),Math.floor(60*Math.random()),t.出生日期||(t.出生日期={年:a-n,月:1,日:1,小时:0,分钟:0},console.log(`[角色初始化] 临时出生日期(AI可能会重新计算): ${t.出生日期.年}年${t.出生日期.月}月${t.出生日期.日}日 (当前${n}岁)`)),"string"!=typeof t.出生||"随机出生"!==t.出生&&!t.出生.includes("随机")||console.log("[出生生成] 检测到随机出生，将由 AI 创造性生成");const r=C(t,n),o=t?.核心属性,i=o?{STR:Number(o.力量??0),AGI:Number(o.敏捷??0),CON:Number(o.体质??0),WIL:Number(o.意志??0),CHA:Number(o.魅力??0),LCK:Number(o.幸运??0)}:(0,w.Yk)(t.先天属性||{力量:0,体质:0,敏捷:0,意志:0,魅力:0,幸运:0}),s=(0,w.Nz)(i,"凡人");t.核心属性={力量:i.STR,敏捷:i.AGI,体质:i.CON,意志:i.WIL,魅力:i.CHA,幸运:i.LCK};const l={声望:r.声望,寿命:r.寿命,生命值:s.HP,精神力:s.SP,体力:s.ST,理智值:s.SAN,属性:{觉醒阶段:"凡人"}},c=r.位置,u=(0,d.N)().selectedWorld,p={角色:t,属性:l,位置:c,效果:[],时间:(e=>{const n={年:0,月:1,日:1,小时:8,分钟:0},t="string"==typeof e?e:"";if(!t.trim())return n;if(t.includes("灾变前夜"))return{年:0,月:12,日:31,小时:23,分钟:0};if(t.includes("第一周"))return{年:0,月:1,日:7,小时:8,分钟:0};if(t.includes("第一个月"))return{年:0,月:1,日:1,小时:8,分钟:0};if(t.includes("一年"))return{年:1,月:1,日:1,小时:8,分钟:0};if(t.includes("五年"))return{年:5,月:1,日:1,小时:8,分钟:0};if(t.includes("十年"))return{年:10,月:1,日:1,小时:8,分钟:0};if(t.includes("二十五年"))return{年:25,月:1,日:1,小时:8,分钟:0};if(t.includes("五十年"))return{年:50,月:1,日:1,小时:8,分钟:0};if(t.includes("一百年"))return{年:100,月:1,日:1,小时:8,分钟:0};const a=t.match(/(\d+)\s*年/);return a?{年:Number(a[1]),月:1,日:1,小时:8,分钟:0}:n})(u?.era||t?.世界?.era||null),背包:{突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}},装备:{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},功法:{当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}},修炼:{修炼功法:null},技能:{掌握技能:[],装备栏:[],冷却:{}},宗门:void 0,事件:{配置:{启用随机事件:!0,最小间隔月:1,最大间隔月:10,事件提示词:""},下次事件时间:null,事件记录:[]},记忆:{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]},关系:{},历史:{叙事:[]},系统:{规则:{属性上限:{先天属性:{每项上限:10}},装备系统:"装备存储引用{物品ID,名称}，完整数据在背包.物品中",品质控制:"严格遵守觉醒阶段对应品质范围，仙品世界上几乎没有，每一个都是令世界动荡的存在，神品不存在"},提示:["⚠️ 先创建后修改：修改数据前必须确保数据已存在","装备字段：装备1-6"],...(0,v.rW)()||{}}};try{Boolean(p.系统?.配置?.nsfwMode)&&(p.身体={部位开发:{},部位:{}})}catch{}const{migrated:f}=(0,y.jj)(p);return{saveData:f,processedBaseInfo:t}}(n,a),u=await async function(e,n){console.log("[初始化流程] 2. 生成世界数据");const t=(0,c.useUIStore)();t.updateLoadingText("🌍 世界生成: 准备配置...");const a=(0,d.N)(),r=a.worldGenerationConfig,o=a.selectedWorld;console.log("[世界生成] 用户配置的世界规模:",{主要势力:r.majorFactionsCount,地点总数:r.totalLocations,秘境数量:r.secretRealmsCount,大陆数量:r.continentCount,仅生成大陆:r.generateOnlyContinents});const i=!r.generateOnlyContinents,s=i?r.majorFactionsCount||5:0,l=i?r.totalLocations||12:0,u=i?r.secretRealmsCount||5:0;r.generateOnlyContinents?console.log('[世界生成] ✅ 开启"仅生成大陆"模式，势力、地点和秘境将在局内动态生成'):console.log("[世界生成] 📋 完整世界生成模式，将生成势力、地点和秘境");const p={worldName:o?.name||n.name,worldBackground:o?.description??n.description??void 0,worldEra:o?.era??n.era??void 0,factionCount:s,locationCount:l,secretRealmsCount:u,continentCount:r.continentCount||4,maxRetries:3,retryDelay:2e3,characterBackground:(e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e&&"名称"in e){const n=e.名称;if("string"==typeof n)return n}return String(e??"")})(e.出生),mapConfig:r.mapConfig,useStreaming:a.useStreamingStart,onStreamChunk:e=>{t.updateLoadingText(`🌍 世界生成中...\n\n${e.substring(0,150)}...`)}};console.log("[初始化流程] 开始调用世界生成器..."),t.updateLoadingText("🌍 世界生成: 调用AI生成世界架构...");const v=new x.U(p),f=Date.now(),h=await v.generateValidatedWorld(),m=Date.now()-f;if(console.log(`[初始化流程] 世界生成器返回,耗时: ${m}ms`),h.success&&h.worldInfo)return console.log("[初始化流程] 世界生成成功"),t.updateLoadingText("🌍 世界生成: 完成"),h.worldInfo;throw new Error(`世界生成失败：${h.errors?.join(", ")||"未知错误"}`)}(l,t);e.世界||(e.世界={信息:{},状态:{}}),e.世界.信息=u,console.log("[初始化流程] 2.5 世界已包含在saveData中（新架构跳过酒馆同步）"),console.log("[初始化流程] 世界包含",u.大陆信息?.length||0,"个大陆"),console.log("[初始化流程] 大陆列表:",u.大陆信息?.map(e=>e.名称||e.name).join("、")),console.log("[初始化流程] 准备调用generateOpeningScene..."),console.log("[初始化流程] 使用流式模式:",r),console.log("[初始化流程] 使用生成模式:",o),console.log("[初始化流程] 使用分步生成:",i);const{finalSaveData:p}=await async function(e,n,t,a,r=!0,o="generate",i=!0){console.log("[初始化流程] 3. 生成开场剧情");const l=(0,c.useUIStore)(),u=Boolean(e.系统?.配置?.nsfwMode),p=u?'左狱正在控制你！！！...<br/><span style="font-size: 0.85em; opacity: 0.8;">（身体数据生成中…）</span>':"左狱正在控制你！！！...";l.updateLoadingText(p);const g=(0,d.N)(),b={name:n.名字,gender:n.性别,race:n.种族??"人族",age:a,world:n.世界||t,talentTier:n.天资,origin:n.出生,talents:n.天赋||[],attributes:n.核心属性||{},difficultyPrompt:g.currentDifficultyPrompt};console.log("[初始化] 🔥 用户选择数据检查:"),console.log("  - 种族:",n.种族,"->",b.race),console.log("  - 天资:",b.talentTier),console.log("  - 出身:",b.origin),console.log("  - 天赋数量:",b.talents?.length),console.log("  - 难度:",g.gameDifficulty);const y={worldInfo:e.世界?.信息,availableContinents:e.世界?.信息?.大陆信息?.map(e=>({名称:e.名称,描述:e.描述,大洲边界:e.大洲边界}))||[],availableLocations:e.世界?.信息?.地点信息?.map(e=>({名称:e.name||e.名称,类型:e.type||e.类型,描述:e.description||e.描述,所属势力:e.faction||e.所属势力,coordinates:e.coordinates}))||[],mapConfig:e.世界?.信息?.地图配置,systemSettings:(0,v.Md)(e.系统?.配置??{})};console.log("[初始化] 🔥 世界检查:"),console.log("  - 世界描述:",e.世界?.信息?.世界背景||"未找到"),console.log("  - 大陆数量:",y.availableContinents.length),console.log("  - 地点数量:",y.availableLocations.length);const x=await(0,m.IJ)(),k=(0,m.p$)(b,y),w=`我创建了角色"${n.名字}"，请根据我的选择生成开局故事和初始数据。\n\n${k}\n\n**重要提示**：\n- 严格按照我的角色设定来生成内容\n- 我选择的是什么样的出身、天赋，你就如实展现\n- 不要强加任何预设的剧情方向或生活方式\n- 这只是一个开始，我的人生我做主`;console.log(`[初始化] 准备生成开场剧情，角色: ${n.名字}`),console.log("[初始化] 可用大陆列表:",y.availableContinents.map(e=>e.名称)),console.log("[初始化] 可用地点数量:",y.availableLocations?.length||0);let C="";const A=await async function(e,n,t,a){const r=(0,c.useUIStore)();let o=null,i=0;for(;;){i++;try{i>1&&r.updateLoadingText(`${a} (第 ${i-1} 次重试)`),console.log(`[robustAICall] 正在尝试: ${a}, 第 ${i} 次`);const t=await e();if(console.log(`[robustAICall] 收到响应 for ${a}:`,t),n(t))return console.log(`[robustAICall] 响应验证成功 for ${a}`),t;throw new Error("AI响应格式无效或未通过验证")}catch(e){if(o=e instanceof Error?e:new Error(String(e)),console.warn(`[AI调用重试] 第 ${i} 次尝试失败:`,o.message),i>3){if(await _(a,o.message)){i=0;continue}throw new Error(`${a}失败，用户选择不继续重试: ${o.message}`)}await new Promise(e=>setTimeout(e,1e3*i))}}}(async()=>{console.log("[初始化] ===== 开始生成开场剧情 =====");const e=Date.now();let n=0;try{const t=h.J,a=await t.generateInitialMessage(x,w,{useStreaming:r,generateMode:o,splitResponseGeneration:i,onStreamChunk:e=>{n+=e.length,(e=>{C+=e;const n=C.length>300?"..."+C.slice(-300):C;l.updateLoadingText(`${p}<br/><br/><div style="text-align: left; font-size: 0.9em; opacity: 0.8; white-space: pre-wrap;">${n}</div>`)})(e)},onProgressUpdate:e=>{const t=n>0?`${e}（已接收 ${n} 字符）`:e;l.updateLoadingText(`${p}<br/><span style="font-size: 0.9em; opacity: 0.8;">${t}</span>`)}}),s=Date.now()-e;return console.log(`[初始化] ✅ AI生成完成,耗时: ${s}ms, 流式模式: ${r}, 生成模式: ${o}, 分步生成: ${i}`),a}catch(e){throw console.error("[初始化] ❌ AI生成失败:",e),e}},e=>{if(console.log("[AI验证-诊断] ===== 开始验证AI响应 ====="),console.log("[AI验证-诊断] 响应类型:",typeof e),console.log("[AI验证-诊断] 响应内容(前500字):",JSON.stringify(e).substring(0,500)),!e||"object"!=typeof e)return console.warn("[AI验证] ❌ 响应不是对象，实际类型:",typeof e),console.warn("[AI验证] 响应内容:",e),!1;if(!e.text||"string"!=typeof e.text)return console.warn("[AI验证] ❌ text字段无效"),console.warn("[AI验证] text值:",e.text),!1;if(e.text.trim().length<200)return console.warn("[AI验证] ❌ 文本太短 (长度:",e.text.length,")"),!1;if(e.text.includes("placeholder")||e.text.includes("TODO")||e.text.includes("待填充"))return console.warn("[AI验证] ❌ 文本包含占位符"),!1;if(!Array.isArray(e.tavern_commands))return console.warn("[AI验证] ❌ tavern_commands不是数组，实际类型:",typeof e.tavern_commands),console.warn("[AI验证] tavern_commands值:",e.tavern_commands),!1;if(0===e.tavern_commands.length)return console.warn("[AI验证] ❌ tavern_commands是空数组"),!1;console.log("[AI验证-诊断] tavern_commands数量:",e.tavern_commands.length);const n=e.tavern_commands.find(e=>!(!e||"set"!==e.action||"角色.位置"!==e.key&&"位置"!==e.key));if(n){const e=n.value;if(!e||"object"!=typeof e)return console.warn("[AI验证] ❌ 位置值不是对象，类型:",typeof e),console.warn("[AI验证] 位置值:",e),!1;const t=e;if(!t.描述||"string"!=typeof t.描述||0===t.描述.trim().length)return console.warn("[AI验证] ❌ 位置描述无效"),console.warn("[AI验证] 描述值:",t.描述),!1;if(t.描述.includes("undefined")||t.描述.includes("null"))return console.warn("[AI验证] ❌ 位置描述包含无效内容:",t.描述),!1;if("number"!=typeof t.x||"number"!=typeof t.y)return console.warn("[AI验证] ❌ 位置坐标无效"),console.warn("[AI验证] x:",t.x,"y:",t.y),!1;console.log("[AI验证] ✅ 位置命令有效:",t.描述,`(${t.x}, ${t.y})`)}else console.warn("[AI验证] ⚠️ 未提供位置命令（将继续流程，后续由默认值/最终校验兜底）");return Array.isArray(e.action_options)?0===e.action_options.length?console.warn("[AI验证] ⚠️ action_options是空数组，将使用默认选项"):console.log("[AI验证] ✅ action_options有效，数量:",e.action_options.length):console.warn("[AI验证] ⚠️ action_options不是数组，将使用默认选项"),console.log("[AI验证] ✅ 所有验证通过"),!0},0,"天道正在书写命运之章"),S=h.J,{saveData:L,stateChanges:E}=await S.processGmResponse(A,e,!0),T=(0,d.N)();if("随机出身"===T.selectedOrigin?.name&&L.角色?.身份?.出生){const e=L.角色.身份.出生;"object"==typeof e&&T.setAIGeneratedOrigin(e)}if((0,f.useGameStateStore)().loadFromSaveData(L),u&&Array.isArray(A.tavern_commands)&&A.tavern_commands.some(e=>{if(!e||"set"!==e.action)return!1;const n=e.key;return"string"==typeof n&&(n.startsWith("角色.身体")||n.startsWith("身体."))})&&s.o.success("已生成法身数据（酒馆）"),!String(A.text||"").trim())throw new Error("AI生成的开场剧情为空");return L.系统?.历史?.叙事&&L.系统.历史.叙事.length>0&&(L.系统.历史.叙事[L.系统.历史.叙事.length-1].stateChanges=E),{finalSaveData:L,aiResponse:A}}(e,l,t,a,r,o,i);console.log("[初始化流程] generateOpeningScene已返回"),console.log("[初始化流程] 核心属性校准：合并AI修改与初始属性...");const A=C(n,a),S=p.状态||{};p.状态={...A,...S},console.log("[初始化流程] 核心属性校准完成"),console.log("[初始化流程] 准备最终化并同步数据...");const L=await async function(e,n,t,a){console.log("[初始化流程] 4. 合并、验证并同步最终数据");const r=(0,c.useUIStore)();r.updateLoadingText(`正在同步数据，即将进入${n.名字}的修仙世界...`);const o={...e.角色?.身份??{},...n,名字:n.名字,性别:n.性别,种族:n.种族,...n.核心属性?{核心属性:n.核心属性}:{},天赋:n.天赋};if("object"==typeof n.出生&&n.出生?.name?.includes("随机")||"string"==typeof n.出生&&n.出生.includes("随机")){console.log("[数据最终化] 🎲 用户选择随机出身，使用AI生成的数据");const n=e.角色?.身份?.出生;if(o.出生=n||"随机出身","string"==typeof o.出生&&o.出生.includes("随机")){console.warn("[数据最终化] ⚠️ 警告：AI未能正确替换随机出身，使用本地数据库生成");const e=k.yM[Math.floor(Math.random()*k.yM.length)];o.出生=e,console.log(`[数据最终化] ✅ 已从本地数据库生成随机出身: ${e.name}`)}}else console.log(`[数据最终化] ✅ 用户选择特定出身，强制使用用户选择: ${n.出生?.name}`),o.出生=n.出生;const i=function(e){const n={...e},t=(0,d.N)();console.log("[数据校准] 开始从创角仓库同步所有权威数据..."),console.log("[数据校准] 【重要】所有用户手动选择的数据都将被保护，不被AI或代码修改");const a=t.selectedTalentTier;a?(console.log(`[数据校准] ✅ 同步用户选择的天资: ${a.name}`),n.天资=a):console.warn("[数据校准] 警告: 无法找到权威的天资数据。");const r=t.selectedOrigin,o=n.出生&&"object"==typeof n.出生&&"随机出身"!==n.出生.名称;r&&!o?(console.log(`[数据校准] ✅ 同步用户选择的出身: ${r.name}`),n.出生=r):o?console.log("[数据校准] ✅ 保留已生成的具体出身:",n.出生.name):null===t.characterPayload.origin_id?(console.log("[数据校准] 🎲 用户选择随机出身，但无有效生成值，标记为随机"),n.出生="随机出身"):console.warn("[数据校准] 警告: 无法找到权威的出身数据。");const i=t.selectedTalents;i&&i.length>0?(console.log(`[数据校准] ✅ 同步用户选择的天赋，共 ${i.length} 个`),n.天赋=i):(console.log("[数据校准] 用户未选择任何天赋，天赋字段设置为空数组。"),n.天赋=[]);const s={strength:t.characterPayload.strength,agility:t.characterPayload.agility,constitution:t.characterPayload.constitution,willpower:t.characterPayload.willpower,charm:t.characterPayload.charm,luck:t.characterPayload.luck};return console.log("[数据校准] ✅ 同步用户分配的六维属性:",s),n.核心属性={力量:s.strength,敏捷:s.agility,体质:s.constitution,意志:s.willpower,魅力:s.charm,幸运:s.luck},console.log("[数据校准] 权威数据同步完成。"),n}(o);e.角色||(e.角色={}),e.角色.身份=i,console.log("[数据最终化] 重新计算并校准核心玩家状态...");const s=C(n,a),l=e.角色?.属性??e.属性??{},u=e.角色?.位置??e.位置;e.属性={声望:"number"==typeof l.声望?l.声望:s.声望,生命值:l.生命值??s.生命值,精神力:l.精神力??s.精神力,体力:l.体力??s.体力,理智值:l.理智值??s.理智值,寿命:l.寿命??s.寿命},console.log("[数据最终化] 觉醒与核心数值合并完成");const p=u,v=n=>{if(n.includes("·"))return n;const t=e.世界?.信息?.大陆信息;return`${Array.isArray(t)&&t[0]&&(t[0].名称||t[0].name)||"朝天大陆"}·${n}`},f=()=>{const n=e.世界?.信息?.地点信息;if(Array.isArray(n)&&n.length>0){const e=n[Math.floor(Math.random()*n.length)],t=v(String(e?.名称||e?.name||e?.描述||e?.description||"无名之地")),a=e?.coordinates,r=(a&&"object"==typeof a&&(a.x??a.lng??a.lon??a.longitude))??void 0,o=(a&&"object"==typeof a&&(a.y??a.lat??a.latitude))??void 0;return{描述:t,x:"number"==typeof r&&Number.isFinite(r)?r:Math.floor(10001*Math.random()),y:"number"==typeof o&&Number.isFinite(o)?o:Math.floor(10001*Math.random())}}const t=e.世界?.信息?.大陆信息,a=String(e.世界?.信息?.世界名称||"").trim();return{描述:`${Array.isArray(t)&&t[0]&&(t[0].名称||t[0].name)||a||"朝天大陆"}·无名之地`,x:Math.floor(10001*Math.random()),y:Math.floor(10001*Math.random())}};if(e.角色||(e.角色={}),(h=p)&&"object"==typeof h&&"string"==typeof h.描述&&h.描述.trim()&&!h.描述.includes("位置生成失败")){const n=v(p.描述),t="number"==typeof p.x&&Number.isFinite(p.x)?p.x:Math.floor(10001*Math.random()),a="number"==typeof p.y&&Number.isFinite(p.y)?p.y:Math.floor(10001*Math.random());e.角色.位置={...p,描述:n,x:t,y:a},console.log(`[数据最终化] ✅ 已保留/修复AI生成的位置信息: "${n}" (${t}, ${a})`)}else{console.warn("[数据最终化] ⚠️ AI未提供有效位置信息，将使用兜底位置继续创角"),console.error("[数据最终化-诊断] aiLocation:",p);const n=f();e.角色.位置=n,console.log(`[数据最终化] ✅ 已使用兜底位置信息: "${n.描述}" (${n.x}, ${n.y})`)}var h;console.log("[数据最终化] 核心玩家状态校准完成。"),delete e.状态,delete e.位置,delete e.状态位置;const m=e.元数据?.时间??e.时间;if(m){const n={年:m.年-a,月:m.月,日:m.日,小时:0,分钟:0};e.角色||(e.角色={}),e.角色.身份=e.角色.身份||{},e.角色.身份.出生日期=n,console.log(`[数据最终化] 重新计算出生日期: ${n.年}年${n.月}月${n.日}日 (时间${m.年}年 - 开局年龄${a}岁)`);const t=e.社交?.关系??e.关系;t&&Object.keys(t).length>0&&(console.log("[数据最终化] 验证并修复NPC出生日期:"),Object.entries(t).forEach(([e,n])=>{const t=n;if(!t.出生日期||"number"!=typeof t.出生日期.年){const n=Math.floor(18*Math.random())+18;t.出生日期={年:m.年-n,月:Math.floor(12*Math.random())+1,日:Math.floor(28*Math.random())+1},console.warn(`  - [修复] ${e}: 缺失出生日期，已重置为${n}岁 (出生年:${t.出生日期.年})`)}if(t.出生日期.年>m.年){const n=t.出生日期.年,a=Math.floor(23*Math.random())+18;t.出生日期.年=m.年-a,console.warn(`  - [修复] ${e}: 出生年份异常(${n} > 当前${m.年})，已重置为${a}岁 (出生年:${t.出生日期.年})`)}const a=m.年-t.出生日期.年;console.log(`  - ${e}: 出生${t.出生日期.年}年, 当前${m.年}年, 实际年龄${a}岁 ✅`)}))}const x=e.角色?.位置?.描述;if(console.log(`[数据校准] ✅ 位置信息最终确认: "${x}"`),!x||!x.includes("·")){console.warn("[数据校准] ⚠️ 位置格式异常，将使用兜底位置继续创角（避免失败）"),console.warn("[数据校准-诊断] saveData.角色.位置:",e.角色?.位置);const n=f();e.角色=e.角色||{},e.角色.位置=n,console.log(`[数据校准] ✅ 已修复为兜底位置: "${n.描述}" (${n.x}, ${n.y})`)}const{migrated:w,report:_}=(0,y.jj)(e);_.legacyKeysFound.length>0&&console.log("[数据最终化] 迁移报告 legacyKeysFound:",_.legacyKeysFound);const A=(0,b.repairSaveData)(w);A.角色=A.角色||{},A.角色.身份=A.角色.身份||{},n?.名字&&(A.角色.身份.名字=n.名字),n?.性别&&(A.角色.身份.性别=n.性别),n?.种族&&(A.角色.身份.种族=n.种族);const S=(0,g.zB)(A,{角色:n,模式:"单机"},"creation");S.isValid||console.warn(`[数据最终化] ⚠️ 角色数据最终验证未完全通过，将继续并依赖运行期修复兜底: ${S.errors.join(", ")}`);const L=A?.角色?.修炼?.修炼功法,E=A?.角色?.背包?.物品??{};if(L?.物品ID&&"string"==typeof L.名称){const e=E[L.物品ID];!e||"功法"!==e.类型||e.名称!==L.名称&&!e.名称||!0!==e.修炼中&&!0!==e.已装备?(console.warn("[数据校准] 检测到无效的“幽灵功法”：角色.修炼.修炼功法 非空，但角色.背包.物品中无对应实体。正在清除无效修炼状态..."),A.角色?.修炼&&(A.角色.修炼.修炼功法=null)):console.log(`[数据校准] 功法一致性校验通过: "${L.名称}"`)}return console.log("[初始化流程] ✅ 角色创建完成（新架构跳过酒馆同步）"),r.updateLoadingText("✅ 角色创建完成！"),console.log("[初始化流程] finalizeAndSyncData即将返回 V3 saveData"),A}(p,n,0,a);return console.log("[初始化流程] 最终化完成"),console.log("[初始化流程] ✅ 角色创建成功！准备返回completedSaveData"),console.log("[初始化流程] completedSaveData类型:",typeof L),console.log("[初始化流程] completedSaveData有效:",!!L),L}catch(e){throw console.error("[初始化流程] ❌ 角色初始化失败：",e),console.error("[初始化流程] 错误堆栈:",e instanceof Error?e.stack:"N/A"),e}finally{console.log("[初始化流程] initializeCharacter函数执行完毕")}}var S=t(9333),L=t(8546),E=t(6939),T=(t(3943),t(9574)),I=t(6988),R=t(33);const M={class:"save-migration"},P={class:"migration-meta"},D={class:"meta-item"},z={class:"value"},N={class:"meta-item"},$={class:"value"},O={class:"migration-reasons"},F={class:"reason-list"},j={class:"migration-actions"},B=["disabled"],X=["disabled"],U=(0,r.pM)({__name:"SaveMigrationModal",props:{characterId:{},saveSlot:{},legacyKeysFound:{},onConfirm:{type:Function},onCancel:{type:Function}},setup(e){const n=e,t=(0,a.KR)(!1);let o=!1;const i=async()=>{if(!t.value){t.value=!0;try{o=!0,await(n.onConfirm?.())}finally{t.value=!1}}},s=()=>{t.value||(o=!0,n.onCancel?.())};return(0,r.xo)(()=>{o||n.onCancel?.()}),(e,n)=>((0,r.uX)(),(0,r.CE)("div",M,[n[3]||(n[3]=(0,r.Lk)("div",{class:"migration-header"},[(0,r.Lk)("h4",null,"检测到旧版存档结构"),(0,r.Lk)("p",null,"此存档不符合 V3（5领域：元数据/角色/社交/世界/系统），必须迁移后才能加载。")],-1)),(0,r.Lk)("div",P,[(0,r.Lk)("div",D,[n[0]||(n[0]=(0,r.Lk)("span",{class:"label"},"角色ID",-1)),(0,r.Lk)("span",z,(0,R.v_)(e.characterId),1)]),(0,r.Lk)("div",N,[n[1]||(n[1]=(0,r.Lk)("span",{class:"label"},"存档槽位",-1)),(0,r.Lk)("span",$,(0,R.v_)(e.saveSlot),1)])]),(0,r.Lk)("div",O,[n[2]||(n[2]=(0,r.Lk)("div",{class:"reason-title"},"检测到的旧字段",-1)),(0,r.Lk)("div",F,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.legacyKeysFound,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"tag"},(0,R.v_)(e),1))),128))])]),n[4]||(n[4]=(0,r.Lk)("div",{class:"migration-hint"},[(0,r.Lk)("div",null,"操作会自动："),(0,r.Lk)("ul",null,[(0,r.Lk)("li",null,"先在 IndexedDB 创建一份隐藏备份（不出现在存档列表）"),(0,r.Lk)("li",null,"覆盖写回当前槽位为 V3 新结构存档")])],-1)),(0,r.Lk)("div",j,[(0,r.Lk)("button",{class:"primary",disabled:t.value,onClick:i},(0,R.v_)(t.value?"正在迁移…":"备份并迁移"),9,B),(0,r.Lk)("button",{class:"secondary",disabled:t.value,onClick:s},"取消",8,X)])]))}});var W=t(5072),q=t.n(W),G=t(7825),H=t.n(G),V=t(7659),Q=t.n(V),K=t(5056),Y=t.n(K),J=t(540),Z=t.n(J),ee=t(1113),ne=t.n(ee),te=t(9197),ae={};ae.styleTagTransform=ne(),ae.setAttributes=Y(),ae.insert=Q().bind(null,"head"),ae.domAPI=H(),ae.insertStyleElement=Z(),q()(te.A,ae),te.A&&te.A.locals&&te.A.locals;const re=(0,t(6262).A)(U,[["__scopeId","data-v-230bf738"]]);function oe(e){return"联机"!==e.模式?null:e.存档列表?.["云端修行"]?e.存档列表["云端修行"]:e.存档列表?.["存档"]&&!e.存档列表?.["云端修行"]?(l.Yz.log("角色商店","?? 检测到联机存档槽位 key=存档，正在迁移为 云端修行..."),e.存档列表["云端修行"]={...e.存档列表["存档"],存档名:"云端修行"},delete e.存档列表["存档"],e.存档列表["云端修行"]):e.存档?(l.Yz.log("角色商店","⚠️ 检测到旧存档结构，正在迁移到统一结构..."),e.存档列表||(e.存档列表={}),e.存档列表["云端修行"]=e.存档,delete e.存档,l.Yz.log("角色商店",'✅ 旧存档数据已迁移到 存档列表["云端修行"]'),e.存档列表["云端修行"]):null}function ie(e){if(!e)return null;const n=JSON.parse(JSON.stringify(e)),t=n;let a=!1;return t?.系统?.历史&&"object"==typeof t.系统.历史&&"叙事"in t.系统.历史&&(delete t.系统.历史.叙事,a=!0),t?.历史&&"object"==typeof t.历史&&"叙事"in t.历史&&(delete t.历史.叙事,a=!0),"叙事历史"in t&&(delete t.叙事历史,a=!0),"对话历史"in t&&(delete t.对话历史,a=!0),a&&l.Yz.log("角色商店","✅ 已移除叙事历史用于云端同步"),n}const se=(0,o.nY)("characterV3",()=>{const e=(0,a.KR)({当前激活存档:null,角色列表:{}}),n=(0,a.KR)(null),o=(0,a.KR)(!1),h=async()=>{if(!o.value)try{await u.YK()&&l.Yz.log("角色商店","✅ 数据已迁移到IndexedDB"),e.value=await u.$v();let n=!1;const t=[];Object.entries(e.value.角色列表).forEach(([a,r])=>{const o=r,i=o.角色?.名字||o.角色基础信息?.名字||a;!o.角色&&o.角色基础信息&&(o.角色=o.角色基础信息,delete o.角色基础信息,n=!0),o.存档列表&&"object"==typeof o.存档列表||(o.存档列表={},n=!0),"联机"===o.模式&&o.存档列表?.["存档"]&&!o.存档列表?.["云端修行"]&&(o.存档列表["云端修行"]={...o.存档列表["存档"],存档名:"云端修行"},delete o.存档列表["存档"],n=!0),"联机"===r.模式&&r.存档&&!r.存档列表?.["云端修行"]&&(l.Yz.log("角色商店",`🔄 迁移联机角色「${i}」的存档结构`),r.存档列表||(r.存档列表={}),r.存档列表["云端修行"]={...r.存档,存档名:"云端修行"},r.存档列表["上次对话"]||(r.存档列表["上次对话"]={存档名:"上次对话",保存时间:null,存档数据:null}),delete r.存档,n=!0,l.Yz.log("角色商店",`✅ 角色「${i}」存档结构迁移完成`)),"单机"!==r.模式||!r.存档||r.存档列表&&0!==Object.keys(r.存档列表).length||(l.Yz.log("角色商店",`🔄 迁移单机角色「${i}」的旧版本存档结构`),r.存档列表={},r.存档列表["存档1"]={...r.存档,存档名:"存档1"},r.存档列表["上次对话"]={存档名:"上次对话",保存时间:null,存档数据:null},r.存档列表["时间点存档"]={存档名:"时间点存档",保存时间:null,存档数据:null},delete r.存档,n=!0,l.Yz.log("角色商店",`✅ 角色「${i}」旧版本存档结构迁移完成`)),r.存档列表&&!r.存档列表["上次对话"]&&(r.存档列表["上次对话"]={存档名:"上次对话",保存时间:null,存档数据:null},n=!0),"单机"===r.模式&&r.存档列表&&!r.存档列表["时间点存档"]&&(r.存档列表["时间点存档"]={存档名:"时间点存档",保存时间:null,存档数据:null},n=!0),"联机"===r.模式&&"云端修行"!==r.存档列表?.["云端修行"]?.存档名&&(r.存档列表["云端修行"].存档名="云端修行",n=!0),e.value.当前激活存档?.角色ID===a&&"联机"===r.模式&&"存档"===e.value.当前激活存档.存档槽位&&(e.value.当前激活存档.存档槽位="云端修行",n=!0),"联机"===r.模式&&t.push((async()=>{const e=`savedata_${a}_云端修行`,n=`savedata_${a}_存档`;if(!await u.loadFromIndexedDB(e)){const t=await u.loadFromIndexedDB(n);t&&(await u.saveSaveData(a,"云端修行",t),l.Yz.log("角色商店",`? 已迁移联机存档数据键：${n} → ${e}`))}})())}),t.length>0&&await Promise.all(t),n&&(await u.c5(e.value),l.Yz.log("角色商店","✅ 迁移后的数据已保存")),o.value=!0,l.Yz.log("角色商店","✅ Store初始化完成，数据已加载")}catch(n){l.Yz.error("角色商店","❌ Store初始化失败",n),e.value={当前激活存档:null,角色列表:{}},o.value=!0}};h();const m=(0,r.EW)(()=>Object.values(e.value.角色列表)),g=(0,r.EW)(()=>{const n=e.value.当前激活存档;return n&&e.value.角色列表[n.角色ID]||null}),b=(0,r.EW)(()=>{const n=e.value.当前激活存档,t=g.value;return n&&t?"单机"===t.模式&&t.存档列表?t.存档列表[n.存档槽位]||null:"联机"===t.模式?oe(t):null:null}),x=(0,r.EW)(()=>{const e=g.value;if(!e)return[];if("单机"===e.模式&&e.存档列表)return Object.entries(e.存档列表).map(([n,t])=>{const a=(0,y.DO)(t.存档数据);return{...t,id:n,角色名字:t.角色名字||a.角色名字||e.角色?.名字||"未知",觉醒阶段:t.觉醒阶段||a.觉醒阶段||"凡人",位置:t.位置||a.位置||"未知",保存时间:t.保存时间||null,最后保存时间:t.最后保存时间??t.保存时间??null,游戏时长:t.游戏时长||0}});if("联机"===e.模式){const n=oe(e);if(n){const t=(0,y.DO)(n.存档数据);return[{...n,id:"云端修行",角色名字:n.角色名字||t.角色名字||e.角色?.名字||"未知",觉醒阶段:n.觉醒阶段||t.觉醒阶段||"凡人",位置:n.位置||t.位置||"未知",保存时间:n.保存时间||null,最后保存时间:n.最后保存时间??n.保存时间??null,游戏时长:n.游戏时长||0}]}}return[]}),k=async()=>{try{const n=JSON.parse(JSON.stringify(e.value));Object.values(n.角色列表).forEach(e=>{e.存档列表&&Object.values(e.存档列表).forEach(e=>{delete e.存档数据}),e.存档&&delete e.存档}),await u.c5(n),l.Yz.log("角色商店","✅ 角色元数据已提交到存储"),e.value={...e.value}}catch(e){throw l.Yz.error("角色商店","持久化元数据到IndexedDB失败",e),e}},_=async()=>{e.value=await u.$v(),l.Yz.log("角色商店","已从乾坤宝库重新同步所有数据")},C=async()=>(l.Yz.log("角色商店","syncRootStateToCloud called. (Placeholder - no backend implementation yet)"),Promise.resolve()),R=async(n,a)=>{l.Yz.log("角色商店",`开始加载游戏，角色ID: ${n}, 存档槽: ${a}`);const r=(0,c.useUIStore)(),o=e.value.角色列表[n];if(!o)return l.Yz.error("角色商店","找不到要加载的角色",n),s.o.error("找不到要加载的角色！"),!1;let i;if(i="单机"===o.模式?o.存档列表?.[a]:oe(o),!i)return l.Yz.error("角色商店","找不到指定的存档槽位",a),s.o.error("找不到指定的存档槽位！"),!1;const d=oe(o),h=d?.云端同步信息?.后端创建失败;if("联机"===o.模式&&(0,L.isBackendConfigured)()){if(h&&l.Yz.warn("角色商店","检测到后端创建失败标记，尝试重新拉取云端存档"),!await(0,S.verifyStoredToken)())return l.Yz.warn("角色商店","联机模式token无效，需要登录"),s.o.warning("联机模式需要登录"),!1;try{const e=await(0,S.NX)(n),t=e?.game_save,r=t?.save_data;if(r){i.存档数据=r,t?.game_time&&"string"==typeof t.game_time&&(i.游戏内时间=t.game_time),t?.world_map&&"object"==typeof t.world_map&&(i.世界地图=t.world_map),await u.saveSaveData(n,a,i.存档数据);const e=oe(o);e&&(e.云端同步信息={最后同步:t?.last_sync?String(t.last_sync):(new Date).toISOString(),版本:"number"==typeof t?.version?t.version:e.云端同步信息?.版本??1,需要同步:!1,后端创建失败:!1},await k()),l.Yz.log("角色商店","联机存档已从云端拉取并缓存到本地")}}catch(e){l.Yz.warn("角色商店","联机存档云端拉取失败，回退本地缓存",e)}}else"联机"===o.模式&&h&&l.Yz.warn("角色商店","检测到后端创建失败标记，跳过云端获取，使用本地缓存");if(!i.存档数据){console.log("=== [诊断日志-loadGame] 从IndexedDB加载 ==="),console.log("[14] 加载Key:",{角色ID:n,存档槽位:a}),l.Yz.log("角色商店",`存档数据不在内存中，从 IndexedDB 加载: ${n}/${a}`);try{const e=await u.loadSaveData(n,a);if(!e)return l.Yz.error("角色商店",`IndexedDB 中不存在存档数据: ${n}/${a}`),s.o.error("存档数据不存在！"),!1;console.log("[15] 从IndexedDB加载的角色.背包.突变结晶数据:",e.角色?.背包?.突变结晶),i.存档数据=e,l.Yz.log("角色商店","✅ 已从 IndexedDB 加载存档数据")}catch(e){return l.Yz.error("角色商店","从 IndexedDB 加载存档数据失败",e),s.o.error("加载存档数据失败！"),!1}}if(i.存档数据){const e=(0,y.WI)(i.存档数据);if(e.needsMigration&&!await new Promise(t=>{r.showDetailModal({title:"存档迁移（必须）",component:re,props:{characterId:n,saveSlot:a,legacyKeysFound:e.legacyKeysFound,onConfirm:async()=>{try{const e=i.存档数据,r=`__backup__${a}__${(new Date).toISOString().replace(/[:.]/g,"-")}`;await u.saveSaveData(n,r,e);const{migrated:o,report:c}=(0,y.jj)(e),d=(0,I.$)(o);if(!d.isValid)return console.error("[存档迁移] 迁移后校验失败:",d.errors,c),s.o.error("迁移失败：新结构校验不通过，请查看控制台"),void t(!1);d.warnings.length>0&&console.warn("[存档迁移] 迁移告警:",d.warnings),await u.saveSaveData(n,a,o),i.存档数据=o,l.Yz.log("角色商店",`[存档迁移] ✅ 已写回 V3：${n}/${a}`),t(!0)}catch(e){console.error("[存档迁移] ❌ 迁移过程异常:",e),s.o.error("迁移失败：发生异常，请查看控制台"),t(!1)}finally{r.hideDetailModal()}},onCancel:()=>{r.hideDetailModal(),t(!1)}}})}))return s.o.info("已取消迁移，存档未加载"),!1}try{r.startLoading("开始加载存档..."),await(0,p.clearAllCharacterData)(),r.updateLoadingText("天机重置完毕，正在加载存档..."),l.Yz.log("角色商店","设置当前激活存档"),e.value.当前激活存档={角色ID:n,存档槽位:a},await k(),l.Yz.log("角色商店","将存档数据加载到 gameStateStore");const c=(0,f.useGameStateStore)();if(i.存档数据){const e=(0,v.kL)(i.存档数据);i.存档数据=e,c.loadFromSaveData(e),l.Yz.log("角色商店","✅ 存档数据已加载到 gameStateStore");try{const{vectorMemoryService:e}=await Promise.resolve().then(t.bind(t,5184)),r=`${n}_${a}`;if(await e.init(r),e.isEnabled()){const n=i.存档数据.社交?.记忆?.长期记忆||[];n.length>0&&0===(await e.getStats()).total&&(l.Yz.log("角色商店",`向量记忆库为空，开始导入 ${n.length} 条长期记忆`),await e.importLongTermMemories(n))}}catch(e){console.warn("[角色商店] 初始化向量记忆服务失败（非致命）:",e)}}return l.Yz.log("角色商店","加载完成"),s.o.success(`已成功加载【${o.角色?.名字||"未知角色"}】的存档: ${i.存档名||a}`),!0}catch(e){l.Yz.error("角色商店","加载过程出错",e);const n=e instanceof Error?e.message:"未知错误";return s.o.error(`存档加载失败：${n}`),!1}finally{r.stopLoading()}},M=async(n,t)=>{console.log("[角色商店-删除存档] 开始删除存档:",{charId:n,slotKey:t});const a=e.value.角色列表[n];if(!a||"单机"!==a.模式||!a.存档列表)return console.warn("[角色商店-删除存档] 无法删除：角色不存在或非单机模式"),void s.o.error("无法删除存档：角色不存在或非单机模式");console.log("[角色商店-删除存档] 当前存档列表:",Object.keys(a.存档列表));const r=Object.entries(a.存档列表).filter(([e,n])=>n&&"上次对话"!==e).length;if(console.log("[角色商店-删除存档] 可删除存档数量:",r),r<=1)return console.warn("[角色商店-删除存档] 最后一个存档不能删除"),void s.o.error("最后一个存档不能删除");const o=a.存档列表?.[t]?.存档名||t;if(!a.存档列表?.[t])return console.warn("[角色商店-删除存档] 存档不存在:",t),void s.o.error(`存档【${o}】不存在`);const i=e.value.当前激活存档;if(i?.角色ID===n&&i?.存档槽位===t){console.log("[角色商店-删除存档] 删除的是当前激活存档，清理环境变量");try{await(0,p.clearAllCharacterData)(),s.o.info("当前存档已激活，已清理环境变量。")}catch(e){l.Yz.error("角色商店","删除激活存档时清理环境变量失败",e),s.o.error("清理环境变量失败，建议刷新页面。")}e.value.当前激活存档=null}try{console.log(`[角色商店-删除存档] 从 IndexedDB 删除存档: ${n}/${t}`),await u.Jx(n,t),console.log("[角色商店-删除存档] ✅ IndexedDB 存档数据已删除")}catch(e){console.error("[角色商店-删除存档] 删除 IndexedDB 存档数据失败:",e),s.o.warning("清理存档数据时出现错误")}console.log("[角色商店-删除存档] 执行 delete 操作"),delete a.存档列表[t],a.存档列表={...a.存档列表},console.log("[角色商店-删除存档] 删除后存档列表:",Object.keys(a.存档列表)),console.log("[角色商店-删除存档] 开始保存到 IndexedDB"),await k(),console.log("[角色商店-删除存档] IndexedDB 保存完成");try{await C(),l.Yz.log("角色商店","删除存档后已同步到云端")}catch(e){l.Yz.error("角色商店","删除存档后同步云端失败",e)}s.o.success("存档已删除"),console.log("[角色商店-删除存档] 删除存档完成")};return{rootState:e,initialized:o,allCharacterProfiles:m,activeCharacterProfile:g,activeSaveSlot:b,saveSlots:x,initializeStore:h,reloadFromStorage:_,createNewCharacter:async n=>{const t=(0,c.useUIStore)(),a=(0,d.N)(),{charId:r,baseInfo:o,world:i,mode:h,age:m}=n;if(e.value.角色列表[r])return void s.o.error(`角色ID ${r} 已存在，创建失败！`);const g={...o,世界:a.selectedWorld,天资:a.selectedTalentTier,出生:a.selectedOrigin||"随机出身",天赋:a.selectedTalents,核心属性:{力量:a.characterPayload.strength,敏捷:a.characterPayload.agility,体质:a.characterPayload.constitution,意志:a.characterPayload.willpower,魅力:a.characterPayload.charm,幸运:a.characterPayload.luck}};l.Yz.log("角色商店","构建权威创角信息:",g);try{t.updateLoadingText("即将开始角色创建..."),await(0,p.clearAllCharacterData)();let n=!1;if("联机"===h)try{t.updateLoadingText("正在向云端提交角色信息...");const e={char_id:r,base_info:g};l.Yz.log("角色商店","向后端提交的数据",e);const a=await(0,S.OW)(e);l.Yz.log("角色商店","后端返回结果",a),t.updateLoadingText("角色信息已成功提交至云端！"),n=!0}catch(e){l.Yz.error("角色商店","向后端提交失败",e),s.o.warning("向云端提交角色信息失败，将继续本地创建流程"),n=!1}console.log("[角色商店] 准备调用initializeCharacter...");let o,c=null;try{console.log("[角色商店] 调用initializeCharacter,参数:",{charId:r,baseInfo:g,world:i.name,age:m,useStreaming:a.useStreamingStart,generateMode:a.generateMode,splitResponseGeneration:a.splitResponseGeneration}),c=await A(0,g,i,m,a.useStreamingStart,a.generateMode,a.splitResponseGeneration),console.log("[角色商店] ✅ initializeCharacter返回成功,数据有效:",!!c)}catch(e){console.error("[角色商店] ❌ initializeCharacter失败:",e);const n=e instanceof Error?e.message:String(e);throw new Error(`角色初始化失败: ${n}`)}if(c&&(c=(0,v.kL)(c)),"单机"===h){const e=(new Date).toISOString();o={模式:"单机",角色:c?.角色?.身份||g,存档列表:{存档1:{存档名:"存档1",保存时间:e,游戏内时间:"修仙元年 春",角色名字:g.名字,觉醒阶段:"凡人",位置:"未知",存档数据:c},上次对话:{存档名:"上次对话",保存时间:null,存档数据:null}}}}else{const e=(new Date).toISOString();o={模式:"联机",角色:c?.角色?.身份||g,存档列表:{云端修行:{存档名:"云端修行",保存时间:e,游戏内时间:"修仙元年 春",角色名字:g.名字,觉醒阶段:"凡人",位置:"未知",存档数据:c,云端同步信息:{最后同步:n?e:"",版本:1,需要同步:!n,后端创建失败:!n}},上次对话:{存档名:"上次对话",保存时间:null,存档数据:null}}}}e.value.角色列表[r]=o;const d="单机"===h?"存档1":"云端修行";if(e.value.当前激活存档={角色ID:r,存档槽位:d},await(async n=>{const t=e.value.角色列表[n];if(!t)throw new Error(`[存档核心] 无法找到ID为 ${n} 的角色档案`);const a=b.value;if(a&&a.存档数据)try{const n=e.value.当前激活存档;if(!n)throw new Error("[存档核心] 没有激活的存档");l.Yz.log("角色商店","保存存档数据到 IndexedDB"),await u.saveSaveData(n.角色ID,n.存档槽位,a.存档数据),delete a.存档数据,l.Yz.log("角色商店",`✅ 已将【${t.角色?.名字||"未知角色"}】的存档保存至 IndexedDB`)}catch(e){throw l.Yz.error("角色商店","保存角色存档失败",e),s.o.error("保存角色存档失败，请检查控制台。"),e}else l.Yz.warn("角色商店",`角色 ${n} 没有可用的存档数据来保存`)})(r),await k(),(0,f.useGameStateStore)().loadFromSaveData(c),l.Yz.log("角色商店","✅ 初始存档已加载到 gameStateStore"),"联机"===h&&n)try{t.updateLoadingText("正在同步初始存档到云端...");const e={save_data:ie(c),world_map:{},game_time:"修仙元年 春"};l.Yz.log("角色商店","准备同步到云端的初始存档数据",e),await(0,S.Sj)(r,e),t.updateLoadingText("初始存档已成功同步到云端！")}catch(e){l.Yz.warn("角色商店","同步初始存档数据到云端失败",e);const n=e instanceof Error?e.message:"未知错误";s.o.warning(`云端同步失败(后端未启动): ${n}`)}else"联机"!==h||n||l.Yz.warn("角色商店","后端创建角色失败，跳过初始存档同步");return g}catch(e){l.Yz.error("角色商店","角色创建失败",e);const n=e instanceof Error?e.message:String(e);throw new Error(`角色创建失败: ${n}`)}},deleteCharacter:async n=>{if(console.log("[角色商店-删除] 开始删除角色:",n),console.log("[角色商店-删除] 删除前角色列表:",Object.keys(e.value.角色列表)),!e.value.角色列表[n])return void console.warn("[角色商店-删除] 角色不存在，无法删除");const t=e.value.角色列表[n]?.角色.名字||n;e.value.当前激活存档?.角色ID===n&&(console.log("[角色商店-删除] 删除的是当前激活角色，重置 gameStateStore"),(0,f.useGameStateStore)().resetState(),e.value.当前激活存档=null);try{console.log("[角色商店-删除] 开始清理 IndexedDB 中的所有存档数据...");const e=await u.Wj(n);console.log(`[角色商店-删除] ✅ 已清理 ${e} 个存档记录`)}catch(e){console.error("[角色商店-删除] 清理 IndexedDB 存档数据失败:",e),s.o.warning("清理存档数据时出现错误，部分数据可能未删除")}console.log("[角色商店-删除] 执行 delete 操作"),delete e.value.角色列表[n],console.log("[角色商店-删除] 删除后角色列表:",Object.keys(e.value.角色列表)),console.log("[角色商店-删除] 开始保存到 IndexedDB"),await k(),console.log("[角色商店-删除] IndexedDB 保存完成");try{await C(),l.Yz.log("角色商店","删除角色后已同步到云端")}catch(e){l.Yz.warn("角色商店","删除角色后同步云端失败（后端未启动）:",e)}s.o.success(`角色【${t}】已从本地数据库删除。`),console.log("[角色商店-删除] 删除角色完成")},deleteNpc:async e=>{const n=(0,f.useGameStateStore)(),t=n.relationships;if(!t){const e="无法删除NPC：没有激活的存档或关系数据。";throw s.o.error(e),new Error(e)}const a=Object.keys(t).find(n=>t[n]?.名字===e);if(!a){const n=`找不到名为 ${e} 的NPC。`;throw s.o.error(n),new Error(n)}const r={...t[a]};try{console.log("[删除NPC-调试] 删除前 gameStateStore.relationships 的引用:",n.relationships===t),console.log("[删除NPC-调试] 删除前 relationships 中的NPC列表:",Object.keys(t).map(e=>t[e]?.名字)),delete t[a],console.log(`[删除NPC-调试] 已从内存中删除NPC: ${e}`),console.log("[删除NPC-调试] 删除后 relationships 中的NPC数量:",Object.keys(t).length),console.log("[删除NPC-调试] 删除后是否还存在该NPC:",!!t[a]),console.log("[删除NPC-调试] 删除后 gameStateStore.relationships 中是否还存在:",!!n.relationships?.[a]),console.log("[删除NPC-调试] 删除后 relationships 中的NPC列表:",Object.keys(t).map(e=>t[e]?.名字)),l.Yz.log("角色商店",`已从 gameStateStore 中删除NPC: ${e}`),console.log("[删除NPC-调试] 开始保存到存储..."),await n.saveGame(),console.log("[删除NPC-调试] 保存完成");const r=n.toSaveData();if(r?.社交?.关系){const n=Object.values(r.社交.关系).some(n=>n?.名字===e);console.log("[删除NPC-调试] toSaveData() 返回的数据中是否还存在该NPC:",n),console.log("[删除NPC-调试] toSaveData() 返回的关系数量:",Object.keys(r.社交.关系).length),console.log("[删除NPC-调试] toSaveData() 返回的NPC列表:",Object.values(r.社交.关系).map(e=>e?.名字))}l.Yz.log("角色商店",`✅ NPC ${e} 已成功删除并保存`),s.o.success(`NPC【${e}】已成功删除。`)}catch(n){throw l.Yz.error("角色商店",`删除NPC ${e} 后保存失败`,n),t[a]=r,l.Yz.log("角色商店",`已回滚 gameStateStore 中的NPC删除操作: ${e}`),s.o.error(`删除NPC失败: ${n instanceof Error?n.message:"未知错误"}`),n}},deleteSave:M,deleteSaveById:async n=>{const t=e.value.当前激活存档?.角色ID;if(t)return M(t,n);s.o.error("无法确定角色ID")},createNewSave:async(n,t)=>{const a=e.value.角色列表[n];a&&"单机"===a.模式?(a.存档列表||(a.存档列表={}),a.存档列表[t]?s.o.error("存档名称已存在"):(a.存档列表[t]={存档名:t,保存时间:null,存档数据:null},await k(),s.o.success(`存档【${t}】已创建`))):s.o.error("无法创建存档：角色不存在或非单机模式")},saveAsNewSlot:async n=>{const t=e.value.当前激活存档,a=g.value;if(!t||!a)return s.o.error("没有激活的游戏进度"),null;if("单机"!==a.模式)return s.o.error("联机模式不支持多存档"),null;if(a.存档列表||(a.存档列表={}),a.存档列表[n])return s.o.error("存档名称已存在"),null;try{const e=(0,f.useGameStateStore)().toSaveData();if(!e)return s.o.error("无法获取当前游戏状态"),null;const r=(new Date).toISOString(),o=e.角色?.属性,i=e.角色?.位置,c={存档名:n,保存时间:r,角色名字:e.角色?.身份?.名字,觉醒阶段:o?.觉醒阶段?.名称||"凡人",位置:i?.描述||"未知",存档数据:JSON.parse(JSON.stringify(e))};if(e.元数据?.时间){const n=e.元数据.时间;c.游戏内时间=`${n.年}年${n.月}月${n.日}日`}return a.存档列表[n]=c,await u.saveSaveData(t.角色ID,n,e),await k(),s.o.success(`已另存为新存档：${n}`),l.Yz.log("角色商店",`已创建新存档槽位: ${n}`),n}catch(e){return l.Yz.error("角色商店","另存为新存档失败",e),s.o.error("另存为新存档失败"),null}},saveToSlot:async n=>{const t=e.value.当前激活存档,a=g.value;if(!t||!a){const e=`没有激活的角色，无法保存到 ${n}`;throw l.Yz.error("角色商店",`[saveToSlot] ${e}`),console.error(`[saveToSlot] ${e}`,{active:t,profile:a}),new Error(e)}if("单机"!==a.模式){const e=`联机模式不支持多存档，无法保存到 ${n}`;throw l.Yz.warn("角色商店",`[saveToSlot] ${e}`),console.warn(`[saveToSlot] ${e}`,{模式:a.模式}),new Error(e)}a.存档列表||(a.存档列表={});try{const e=(0,f.useGameStateStore)().getCurrentSaveData();if(!e)throw new Error("无法获取当前存档数据");try{(0,E.DT)(e),e.社交?.关系&&e.元数据?.时间&&Object.values(e.社交.关系).forEach(n=>{n&&"object"==typeof n&&(0,E.UY)(n,e.元数据.时间)})}catch(e){l.Yz.warn("角色商店","[saveToSlot] 自动更新年龄失败（非致命）:",e)}const r=e.角色?.属性,o=e.角色?.位置,i=(new Date).toISOString(),s=a.存档列表;s[n],console.log(`[saveToSlot] 保存到槽位 "${n}"`,{角色ID:t.角色ID,角色名:a.角色?.名字,当前激活槽位:t.存档槽位,目标槽位:n,说明:"特殊存档不受当前激活存档影响，始终保存到角色级别"});const c={存档名:n,保存时间:i,存档数据:e,角色名字:e.角色?.身份?.名字,觉醒阶段:r?.觉醒阶段?.名称||"凡人",位置:o?.描述||"未知",游戏内时间:void 0};if(e.元数据?.时间){const n=e.元数据.时间;c.游戏内时间=`${n.年}年${n.月}月${n.日}日`}s[n]=c,await u.saveSaveData(t.角色ID,n,e),await k(),l.Yz.log("角色商店",`✅ 已保存到存档槽位: ${n}`)}catch(e){throw l.Yz.error("角色商店",`保存到槽位 ${n} 失败`,e),e}},renameSave:async(n,t,a)=>{const r=e.value.角色列表[n];if(!r||"单机"!==r.模式||!r.存档列表)return void s.o.error("无法重命名存档：角色不存在或非单机模式");const o=r.存档列表[t];if(!o)return void s.o.error("要重命名的存档不存在");if(a===t)return o.存档名=a,await k(),void s.o.success("存档名称已更新");if(r.存档列表[a])return void s.o.error("新存档名称已存在");r.存档列表[a]={...o,存档名:a};const i=e.value.当前激活存档;i?.角色ID===n&&i?.存档槽位===t&&(e.value.当前激活存档={角色ID:n,存档槽位:a}),delete r.存档列表[t],await k(),s.o.success(`存档已重命名为【${a}】`)},loadGame:R,loadGameById:async n=>{const t=g.value;if(!t)return s.o.error("没有激活的角色"),!1;const a=e.value.当前激活存档?.角色ID;return a?"单机"===t.模式?await R(a,n):await R(a,"云端修行"):(s.o.error("无法确定角色ID"),!1)},saveCurrentGame:async n=>{o.value||await h();const t=e.value.当前激活存档,a=g.value,r=b.value,i=(0,f.useGameStateStore)();if(!t||!a||!r)return n?.notifyIfNoActive&&i.isGameLoaded&&s.o.error("没有激活的存档，无法保存！",{id:"save-no-active"}),void l.Yz.warn("角色商店","当前没有激活的存档，跳过保存");const c=`save-game-${Date.now()}`;try{console.log("=== [诊断日志-characterStore] 开始保存游戏 ==="),console.log("[10] 当前激活存档:",{角色ID:t.角色ID,存档槽位:t.存档槽位});const e=i.toSaveData();if(!e)throw new Error("无法生成存档数据，游戏状态不完整。");console.log("[11] toSaveData()返回的角色.背包.突变结晶数据:",e.角色?.背包?.突变结晶),(0,E.DT)(e),e.社交?.关系&&e.元数据?.时间&&Object.values(e.社交.关系).forEach(n=>{n&&"object"==typeof n&&(0,E.UY)(n,e.元数据.时间)}),console.log("[12] 即将保存到IndexedDB的数据:",{角色ID:t.角色ID,存档槽位:t.存档槽位,背包突变结晶:e.角色?.背包?.突变结晶}),await u.saveSaveData(t.角色ID,t.存档槽位,e),console.log("[13] IndexedDB保存完成"),l.Yz.log("角色商店",`✅ 存档内容已保存到 IndexedDB (Key: ${t.角色ID}_${t.存档槽位})`),r.保存时间=(new Date).toISOString();const n=e.角色?.属性,o=e.角色?.位置;if(r.觉醒阶段=n?.觉醒阶段?.名称||"凡人",r.位置=o?.描述||"未知",e.元数据?.时间){const n=e.元数据.时间;r.游戏内时间=`${n.年}年${n.月}月${n.日}日`}if(delete r.存档数据,"单机"===a.模式&&a.存档列表?a.存档列表[t.存档槽位]=r:"联机"===a.模式&&(a.存档列表||(a.存档列表={}),a.存档列表["云端修行"]=r),await k(),"联机"===a.模式){const n=oe(a),o=n?.云端同步信息?.后端创建失败;if(o)try{l.Yz.log("角色商店","检测到后端创建失败标记，尝试重新创建角色...");const e={char_id:t.角色ID,base_info:a.角色};await(0,S.OW)(e),n?.云端同步信息&&(n.云端同步信息.后端创建失败=!1),l.Yz.log("角色商店","✅ 后端角色重新创建成功")}catch(e){return void l.Yz.warn("角色商店","后端角色重新创建失败，跳过云端同步",e)}try{const n=r.世界地图??{},o=r.游戏内时间??null,i=ie(e),s=await(0,S.Sj)(t.角色ID,{save_data:i,world_map:n,game_time:o}),l=oe(a),c="number"==typeof s?.version?s.version:(l?.云端同步信息?.版本??1)+1;l&&(l.云端同步信息={最后同步:(new Date).toISOString(),版本:c,需要同步:!1}),await k()}catch(e){l.Yz.warn("角色商店","云端同步失败（联机模式）",e);const n=oe(a);n&&(n.云端同步信息={最后同步:n.云端同步信息?.最后同步||(new Date).toISOString(),版本:n.云端同步信息?.版本||1,需要同步:!0},await k())}}l.Yz.log("角色商店",`存档【${r.存档名}】元数据已更新`)}catch(e){l.Yz.error("角色商店","存档保存过程出错",e);const n=e instanceof Error?e.message:"未知错误";s.o.error(`存档保存失败：${n}`,{id:c})}},updateSaveDataDirectly:async n=>{const t=e.value.当前激活存档,a=g.value,r=b.value;if((0,f.useGameStateStore)(),!(t&&a&&r&&n))return void l.Yz.warn("角色商店","[直接更新] 缺少必要参数，跳过更新");const o=t.角色ID,i=t.存档槽位;l.Yz.log("角色商店","[直接更新] 开始更新存档数据到Store...");const s=e=>e?.角色?.身份?.觉醒阶段??e?.角色?.属性?.觉醒阶段,c=e=>"string"==typeof e?e.trim():"string"==typeof e?.名称?e.名称.trim():"",d=s(r.存档数据),u=s(n),p=c(d),v=c(u),h="string"==typeof u?.名称?u.名称.trim():"string"==typeof u?u.trim():"";if(h&&"凡人"!==h&&"未觉醒"!==h&&p!==v){const e=e=>{const n="string"==typeof e?.名称?String(e.名称).trim():"string"==typeof e?String(e).trim():"";return n?"未觉醒"===n?"凡人":n:""},t=(e(u),n.角色?.属性?.异能);if(t&&"object"==typeof t){const e=t,a="string"==typeof e.名称?e.名称:void 0,r="string"==typeof e.类型?e.类型:void 0,o="string"==typeof e.描述?e.描述:void 0,i="string"==typeof e.代价?e.代价:void 0;a&&(n.角色.身份.异能名称=a),r&&(n.角色.身份.异能类型=r),o&&(n.角色.身份.异能描述=o),i&&(n.角色.身份.异能代价=i),delete n.角色.属性.异能}const a=n.角色?.身份??{};"string"==typeof a?.异能名称||"string"==typeof a?.异能类型||"string"==typeof a?.异能描述||"string"==typeof a?.异能代价?l.Yz.log("角色商店","[直接更新] 觉醒突破包含AI生成的异能内容，已保留"):l.Yz.warn("角色商店","[直接更新] 觉醒突破未包含异能字段，等待AI返回异能内容");try{l.Yz.log("角色商店","[直接更新] 检测到觉醒突破，重新计算属性...");const t=(0,w.Ew)(n),a=e(u),r=(0,w.Nz)(t,a,{}),o=(0,T.Ce)(e(d)),i=(0,T.Ce)(a)-o;if(i>0){const e=n.角色?.身份;if(e){const n=e.后天属性||{};["力量","敏捷","体质","意志","魅力","幸运"].forEach(e=>{"number"!=typeof n[e]&&(n[e]=0),n[e]+=i}),e.后天属性=n,l.Yz.log("角色商店",`[直接更新] 玩家觉醒突破，后天六维属性提升 +${i}`)}}const s=n.角色?.属性;if(s){if(s.生命||s.生命值){const e=s.生命?"生命":"生命值";s[e].上限=r.HP.上限,s[e].当前=Math.min(s[e].当前,r.HP.上限)}if(s.精神||s.精神力){const e=s.精神?"精神":"精神力";s[e].上限=r.SP.上限,s[e].当前=Math.min(s[e].当前,r.SP.上限)}if(s.体力&&(s.体力.上限=r.ST.上限,s.体力.当前=Math.min(s.体力.当前,r.ST.上限)),s.理智||s.理智值){const e=s.理智?"理智":"理智值";s[e].上限=r.SAN.上限,s[e].当前=Math.min(s[e].当前,r.SAN.上限)}l.Yz.log("角色商店","[直接更新] 核心属性上限已更新")}}catch(e){l.Yz.error("角色商店","[直接更新] 核心属性重算失败",e)}const o=r.存档数据?.社交?.关系||{},i=n?.社交?.关系||{},s=Object.keys(i||{});for(const e of s){const n=o?.[e],t=i?.[e];if(!t||"object"!=typeof t)continue;const a="string"==typeof n?.觉醒阶段?n.觉醒阶段.trim():"",r="string"==typeof t?.觉醒阶段?t.觉醒阶段.trim():"";if(!r||r===a)continue;const s=(0,T.Ce)(a),c=(0,T.Ce)(r)-s;if(c>0){const n=t.先天属性||{};["力量","敏捷","体质","意志","魅力","幸运"].forEach(e=>{"number"!=typeof n[e]&&(n[e]=5),n[e]+=c}),t.先天属性=n,l.Yz.log("角色商店",`[直接更新] NPC ${e} 觉醒突破 (${a}->${r})，先天属性提升 +${c}`)}}}const m=r.存档数据?.历史?.叙事;if(m&&Array.isArray(m)&&m.length>0&&(n.历史={...n.历史??{},叙事:m},l.Yz.log("角色商店",`[直接更新] 保留本地叙事历史数据 (${m.length}条)`)),"单机"===a.模式&&a.存档列表)e.value.角色列表[o].存档列表={...a.存档列表,[i]:{...a.存档列表[i],存档数据:n,保存时间:(new Date).toISOString()}};else if("联机"===a.模式){a.存档列表||(a.存档列表={});const t=oe(a);e.value.角色列表[o].存档列表["云端修行"]={...t||{存档名:"云端修行"},存档数据:n,保存时间:(new Date).toISOString()}}await k(),l.Yz.log("角色商店","✅ [直接更新] 存档数据已更新到Store并持久化")},updateCharacterData:async n=>{const t=e.value.当前激活存档,r=g.value,o=b.value;if(!o?.存档数据||!t||!r)return void l.Yz.warn("角色商店","没有激活的存档，无法更新角色数据");const s=[];if(n?.changes)for(const e of n.changes)s.push(e.key),(0,i.set)(o.存档数据,e.key,e.newValue);const c=t.角色ID,d=t.存档槽位;if("单机"===r.模式&&r.存档列表)e.value.角色列表[c].存档列表={...r.存档列表,[d]:{...r.存档列表[d],存档数据:(0,i.cloneDeep)(o.存档数据),保存时间:(new Date).toISOString()}};else if("联机"===r.模式){r.存档列表||(r.存档列表={});const n=oe(r);e.value.角色列表[c].存档列表["云端修行"]={...n||{存档名:"云端修行"},存档数据:(0,i.cloneDeep)(o.存档数据),保存时间:(new Date).toISOString()}}(0,a.mu)(e),await k(),s.length>0&&(await(async()=>{const n=e.value.当前激活存档,t=g.value,r=b.value;if((0,f.useGameStateStore)(),n&&t&&r?.存档数据)try{try{const e=(0,E.DT)(r.存档数据);l.Yz.log("角色商店",`[同步] 自动更新玩家年龄: ${e}岁`);const n=r.存档数据?.社交?.关系,t=r.存档数据?.元数据?.时间;if(n&&"object"==typeof n&&t){let e=0;Object.entries(n).forEach(([n,a])=>{const o=a;if(o&&"object"==typeof o)if(o.名字)try{r.存档数据&&((0,E.UY)(o,t),e++)}catch(e){l.Yz.warn("角色商店",`[同步] 更新NPC ${o.名字} 年龄失败:`,e)}else l.Yz.warn("角色商店",`[同步] 跳过缺少名字的NPC: ${n}`);else l.Yz.warn("角色商店",`[同步] 跳过无效的NPC数据: ${n}`)}),l.Yz.log("角色商店",`[同步] 自动更新${e}个NPC年龄`)}}catch(e){l.Yz.warn("角色商店","[同步] 自动更新年龄失败（非致命）:",e)}const o=n.角色ID,i=n.存档槽位,s=r.存档数据;await u.saveSaveData(o,i,s),l.Yz.log("角色商店","[同步] 已保存到 IndexedDB"),r.保存时间=(new Date).toISOString(),r.角色名字=r.存档数据.角色?.身份?.名字;const c=r.存档数据.角色?.身份??null,d=r.存档数据.角色?.位置??null;if(c){const e=c?.觉醒阶段;r.觉醒阶段="string"==typeof e&&e.trim()?e:"凡人"}r.位置=d?.描述||"未知";const p=r.存档数据?.元数据?.时间;if(p&&(r.游戏内时间=`${p.年}年${p.月}月${p.日}日`),delete r.存档数据,"单机"===t.模式&&t.存档列表)e.value.角色列表[n.角色ID].存档列表={...t.存档列表,[n.存档槽位]:{...r}};else if("联机"===t.模式){t.存档列表||(t.存档列表={});const a=oe(t);e.value.角色列表[n.角色ID].存档列表["云端修行"]={...a||{存档名:"云端修行"},...r}}if((0,a.mu)(e),await k(),l.Yz.log("角色商店","[同步] 数据已保存到本地，元数据已更新"),"联机"===t.模式)try{const n=ie(s),t=s?.元数据?.时间,a=t?`${t.年}年${t.月}月${t.日}日`:"";await(0,S.Sj)(o,{save_data:n,world_map:{},game_time:a});const r=oe(e.value.角色列表[o]);r?.云端同步信息&&(r.云端同步信息.最后同步=(new Date).toISOString(),r.云端同步信息.需要同步=!1)}catch(n){l.Yz.warn("角色商店","云端同步失败",n);const t=oe(e.value.角色列表[o]);t?.云端同步信息&&(t.云端同步信息.需要同步=!0)}}catch(e){throw l.Yz.error("角色商店","[同步] 保存到本地存储失败",e),e}else l.Yz.warn("角色商店","[同步] 没有激活的存档数据")})(),l.Yz.log("角色商店",`✅ 角色数据已更新并增量同步 ${s.length} 个字段`,s))},loadSaves:async()=>{_()},importSave:async(n,t)=>{const a=e.value.角色列表[n];if(!a)return void s.o.error("找不到角色，无法导入存档");if("单机"!==a.模式)return void s.o.error("联机模式不支持存档导入");a.存档列表||(a.存档列表={});let r=t.存档名||"导入存档",o=1;for(;a.存档列表[r];)r=`${t.存档名||"导入存档"}_${o}`,o++;if(t.存档数据){const e=(0,v.kL)(t.存档数据),a=(0,y.ru)(e)?e:(0,y.jj)(e).migrated,o=(0,I.$)(a);if(!o.isValid)return console.error("[导入存档] V3校验失败:",o.errors),void s.o.error(`导入失败：存档结构不合法（${o.errors[0]||"未知原因"}）`);await u.saveSaveData(n,r,a);const c=a?.角色?.属性,d=a?.角色?.位置;t={...t,角色名字:t.角色名字??a?.角色?.身份?.名字,觉醒阶段:t.觉醒阶段??c?.觉醒阶段?.名称,位置:t.位置??d?.描述,游戏内时间:t.游戏内时间??(()=>{const e=a?.元数据?.时间;return e?`${e.年}年${e.月}月${e.日}日`:void 0})(),存档数据:(0,i.cloneDeep)(a)},l.Yz.log("角色商店",`✅ 已将导入的存档数据保存到 IndexedDB: ${n}/${r}`)}a.存档列表[r]={...t,存档名:r},await k(),s.o.success(`存档【${r}】导入成功`)},clearAllSaves:async()=>{const n=g.value,t=e.value.当前激活存档?.角色ID;if(n&&t){if("单机"===n.模式&&n.存档列表)n.存档列表={};else if("联机"===n.模式){const e=oe(n);e&&(e.存档数据=null,e.保存时间=null)}e.value.当前激活存档=null,await k(),s.o.success("所有存档已清空")}else s.o.error("没有激活的角色")},exitGameSession:async()=>{if(!e.value.当前激活存档)return;const n=(0,c.useUIStore)(),t=(0,f.useGameStateStore)();try{n.startLoading("正在退出游戏..."),await(0,p.clearAllCharacterData)(),t.resetState(),e.value.当前激活存档=null,await k(),s.o.success("已成功退出游戏。")}catch(e){l.Yz.error("角色商店","退出游戏会话失败",e),s.o.error("退出游戏失败，建议刷新页面以确保环境纯净。")}finally{n.stopLoading()}},rollbackToLastConversation:async()=>{const n=g.value,t=e.value.当前激活存档;if(!n||!t||"单机"!==n.模式||!n.存档列表)throw new Error("无法执行回滚：无效的存档状态");let r=n.存档列表["上次对话"];if(!r||!r.存档数据){l.Yz.log("角色商店",'从IndexedDB加载"上次对话"存档数据');const e=await u.loadSaveData(t.角色ID,"上次对话");if(!e)throw new Error('没有可用于回滚的"上次对话"存档。请确保已启用"对话前自动备份"功能。');r?r.存档数据=e:(r={id:"上次对话",存档名:"上次对话",角色名字:e.角色?.身份?.名字||n.角色?.名字||"未知",觉醒阶段:"未知",位置:"未知",保存时间:(new Date).toISOString(),存档数据:e},n.存档列表["上次对话"]=r)}const o=r.存档数据;if(!o)throw new Error('没有可用于回滚的"上次对话"存档。请确保已启用"对话前自动备份"功能。');const i=n.存档列表[t.存档槽位];if(!i)throw new Error(`找不到当前激活的存档槽位: ${t.存档槽位}`);const s=JSON.parse(JSON.stringify(o));i.存档数据=s,i.保存时间=(new Date).toISOString();const c=s.角色?.属性,d=s.角色?.位置;if(i.觉醒阶段=c?.觉醒阶段?.名称||"凡人",i.位置=d?.描述||"未知",s.元数据?.时间){const e=s.元数据.时间;i.游戏内时间=`${e.年}年${e.月}月${e.日}日`}"单机"===n.模式&&n.存档列表&&(e.value.角色列表[t.角色ID].存档列表={...n.存档列表,[t.存档槽位]:{...i}}),(0,a.mu)(e),await u.saveSaveData(t.角色ID,t.存档槽位,s),await k(),(0,f.useGameStateStore)().loadFromSaveData(s),l.Yz.log("角色商店","✅ 已成功回滚到上次对话前的状态")},commitMetadataToStorage:k,repairCharacterDataWithAI:async(n,t)=>{const a=(0,c.useUIStore)(),r=e.value.角色列表[n];if(!r)return void s.o.error("修复失败：找不到角色");let o;if(o="单机"===r.模式?r.存档列表?.[t]:r.存档,o&&o.存档数据)try{a.startLoading("AI正在分析存档结构，请稍候...");const e=(i=o.存档数据,`\n# 任务：修复游戏数据\n\n你需要修复以下损坏的游戏数据，使其符合类型定义要求。\n\n## 类型定义\n${JSON.stringify({},null,2)}\n\n## 损坏的数据\n${JSON.stringify(i,null,2)}\n\n## 修复要求\n1. 补全缺失的必填字段\n2. 修正错误的数据类型\n3. 填充合理的默认值\n4. 保持现有正确数据不变\n\n## 输出格式\n返回修复后的完整JSON对象。\n`.trim()),c=(0,p.getTavernHelper)();if(!c)throw new Error("酒馆连接不可用");a.updateLoadingText("天道正在推演修复方案...");const d=await c.generate({user_input:e,overrides:{temperature:.7,max_context_length:8e3,max_length:2048}});if(!d)throw new Error("AI未能生成修复指令");let u=[];try{const e=d.replace(/```json/g,"").replace(/```/g,"").trim(),n=JSON.parse(e);if(!n.tavern_commands||!Array.isArray(n.tavern_commands))throw new Error("AI响应中缺少有效的 tavern_commands 数组");u=n.tavern_commands}catch(e){throw l.Yz.error("角色商店","解析AI修复指令失败",{error:e,response:d}),new Error("解析AI修复指令失败")}if(0===u.length)return s.o.info("AI分析认为当前存档无需修复。"),void await R(n,t);a.updateLoadingText(`AI已生成 ${u.length} 条修复指令，正在应用...`);const v=await(async(e,n,t)=>{const a=[],r=(e,n,t)=>{const a=n.split(".");let r=e;for(let e=0;e<a.length-1;e++)void 0!==r[a[e]]&&"object"==typeof r[a[e]]||(r[a[e]]={}),r=r[a[e]];r[a[a.length-1]]=t};for(const o of t)try{const{action:t,key:i,value:s}=o;if(!t||!i){a.push(`无效指令: ${JSON.stringify(o)}`);continue}let c,d;i.startsWith("character.profile.")?(c=n,d=i.substring(18)):(c=e,d=i),"set"===t?(r(c,d,s),l.Yz.log("AI修复",`执行 set: ${i} =`,s)):l.Yz.warn("AI修复",`暂不支持的指令 action: ${t}`)}catch(e){a.push(`执行指令失败: ${JSON.stringify(o)}`),l.Yz.error("AI修复","执行指令时出错",e)}return a})(o.存档数据,r,u);v.length>0&&(l.Yz.error("角色商店","执行AI修复指令时出错",v),s.o.error(`部分修复指令执行失败: ${v.join(", ")}`)),o.保存时间=(new Date).toISOString(),await k(),s.o.success("AI已完成存档修复！正在重新加载游戏..."),await new Promise(e=>setTimeout(e,500)),await R(n,t)}catch(e){l.Yz.error("角色商店","AI修复存档失败",e),s.o.error(`存档修复失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{a.stopLoading()}else s.o.error("修复失败：找不到存档数据");var i},initialCreationStateChanges:n,setInitialCreationStateChanges:e=>{l.Yz.log("角色商店","暂存初始角色创建的状态变更",e),n.value=e},consumeInitialCreationStateChanges:()=>{const e=n.value;return e&&(l.Yz.log("角色商店","消费初始状态变更日志",e),n.value=null),e},importCharacter:async n=>{if(!n||!n.角色||!n.模式)throw new Error("无效的角色文件格式。");const t=`char_${Date.now()}`,a=n.角色.名字||"未知角色";if(Object.values(e.value.角色列表).some(e=>e.角色.名字===a))throw new Error(`角色 "${a}" 已存在，请先删除或重命名现有角色。`);const r=n._导入存档列表;if(delete n._导入存档列表,n.存档列表||(n.存档列表={}),r&&Array.isArray(r)&&r.length>0){l.Yz.log("角色商店",`开始导入 ${r.length} 个存档...`);for(const e of r){const a=e.存档名||"导入存档";let r=a,o=1;for(;n.存档列表[r];)r=`${a}_${o}`,o++;if(e.存档数据){const n=(0,v.kL)(e.存档数据),a=(0,y.ru)(n)?n:(0,y.jj)(n).migrated,o=(0,I.$)(a);if(!o.isValid)throw console.error("[导入角色] 存档V3校验失败:",o.errors),new Error(`导入角色失败：存档结构不合法（${o.errors[0]||"未知原因"}）`);await u.saveSaveData(t,r,a);const i=a?.角色?.属性,s=a?.角色?.位置;e.角色名字=e.角色名字??a?.角色?.身份?.名字,e.觉醒阶段=e.觉醒阶段??i?.觉醒阶段?.名称,e.位置=e.位置??s?.描述,e.游戏内时间=e.游戏内时间??(()=>{const e=a?.元数据?.时间;return e?`${e.年}年${e.月}月${e.日}日`:void 0})(),l.Yz.log("角色商店",`✅ 已将存档数据保存到 IndexedDB: ${t}/${r}`)}const i={...e};delete i.存档数据,n.存档列表[r]={...i,存档名:r}}l.Yz.log("角色商店",`✅ 成功导入 ${r.length} 个存档`)}return e.value.角色列表[t]={...n},await k(),l.Yz.log("角色商店",`成功导入角色: ${a} (新ID: ${t})，含 ${Object.keys(n.存档列表).length} 个存档`),t},loadSaveData:async(e,n)=>{console.log(`[CharacterStore] Loading save data for ${e} - ${n}`);return await u.loadSaveData(e,n)||(console.error(`[CharacterStore] Failed to load save data for ${e} - ${n}`),null)},loadCharacterSaves:async n=>{const t=e.value.角色列表[n];if(t){l.Yz.log("角色商店",`[loadCharacterSaves] 开始为角色 ${n} 加载存档数据...`);try{let r=0;if("联机"===t.模式){t.存档列表||(t.存档列表={}),t.存档列表["云端修行"]||(t.存档列表["云端修行"]={存档名:"云端修行",保存时间:"",游戏内时间:""});const e=t.存档列表["云端修行"];if(!e.存档数据){const t=e.云端同步信息?.后端创建失败;if((0,L.isBackendConfigured)()&&!t&&await(0,S.verifyStoredToken)())try{const t=await(0,S.NX)(n),a=t?.game_save,o=a?.save_data;o&&(e.存档数据=o,a?.game_time&&"string"==typeof a.game_time&&(e.游戏内时间=a.game_time),e.云端同步信息={最后同步:a?.last_sync?String(a.last_sync):(new Date).toISOString(),版本:"number"==typeof a?.version?a.version:1,需要同步:!1},r++,l.Yz.log("角色商店","  > 成功从云端加载联机存档"))}catch(e){l.Yz.warn("角色商店","从云端加载联机存档失败，尝试本地缓存",e)}if(!e.存档数据){const t=await u.loadSaveData(n,"云端修行");t&&(e.存档数据=t,r++,l.Yz.log("角色商店","  > 成功从本地加载联机存档缓存"))}}}else{if(!t.存档列表)return void l.Yz.log("角色商店",`[loadCharacterSaves] 角色 ${n} 无存档列表，无需加载。`);const e=Object.keys(t.存档列表);for(const a of e){const e=t.存档列表[a];if(e&&!e.存档数据){const t=await u.loadSaveData(n,a);t&&(e.存档数据=t,r++,l.Yz.log("角色商店",`  > 成功加载存档: ${a}`))}}}r>0?((0,a.mu)(e),l.Yz.log("角色商店",`[loadCharacterSaves] 完成加载，共载入 ${r} 个存档数据。`)):l.Yz.log("角色商店","[loadCharacterSaves] 无需加载新的存档数据。")}catch(e){l.Yz.error("角色商店",`[loadCharacterSaves] 加载角色 ${n} 的存档时出错`,e)}}else l.Yz.warn("角色商店",`[loadCharacterSaves] 角色不存在: ${n}`)}}})},8233:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.cloud-sync-button[data-v-1f7f5d72] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.cloud-sync-button[data-v-1f7f5d72]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.sync-text[data-v-1f7f5d72] {\n  font-weight: 500;\n}\n.sync-icon[data-v-1f7f5d72] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n\n/* 已同步状态样式 */\n.cloud-sync-button.synced[data-v-1f7f5d72] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-success-rgb), 0.1));\n  border-color: var(--color-success);\n  color: var(--color-success);\n}\n.cloud-sync-button[data-v-1f7f5d72]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.cloud-sync-button.synced[data-v-1f7f5d72]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.2), rgba(var(--color-success-rgb), 0.2));\n}\n\n/* Size variants */\n.cloud-sync-button.small[data-v-1f7f5d72] {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.9rem;\n  min-width: 100px;\n}\n.cloud-sync-button.large[data-v-1f7f5d72] {\n  padding: 1rem 1.5rem;\n  font-size: 1.1rem;\n  min-width: 180px;\n}\n\n/* Compact variant */\n.cloud-sync-button.compact[data-v-1f7f5d72] {\n  min-width: auto;\n  padding: 0.5rem;\n}\n.cloud-sync-button.compact .sync-text[data-v-1f7f5d72] {\n  display: none;\n}\n",""]);const s=i},8263:(e,n,t)=>{"use strict";t.d(n,{y8:()=>ne,XH:()=>le,LB:()=>se});var a=t(406),r=t(840),o=t(4191),i=t(4459);const s='\n[输出格式]\n只输出单个JSON对象,禁止确认消息,禁止纯文本\n格式:{"text":"叙事","mid_term_memory":"摘要","tavern_commands":[...],"action_options":["选项1","选项2"]}\nJSON有效性:禁止代码围栏/前后缀文本;字符串内换行用\\n;正确转义"和\\;禁止尾逗号/注释\n禁止:纯文本响应/"明白了"/"法则已刻入"/<thinking>标签/JSON外任何内容\n\n[action_options位置]\naction_options是JSON顶层字段,不是tavern_commands里的指令!\n正确:{"text":"...","tavern_commands":[...],"action_options":["选项1","选项2"]}\n错误:{"tavern_commands":[{"action":"action_options","value":[...]}]} ← 绝对禁止!\n'.trim(),l='\n[数据同步]⚠️\ntext写什么,tavern_commands就必须更新什么(否则删掉对应text内容)\n约束:每类变化至少一条指令;新增NPC/信息必须完整落地到tavern_commands;禁止偷懒省略指令\n禁止:将 生命值.当前/精神力.当前/体力.当前/理智值.当前/寿命.当前 直接重置为上限;必须按消耗/伤害使用 add 负数\n\n[必须生成指令的场景]\n□ 时间流逝 → add 元数据.时间.分钟 (行动/战斗/对话都要推进时间!)\n□ 位置变化 → set 角色.位置.描述 + set 角色.位置.x + set 角色.位置.y + set 角色.位置.区域等级\n□ 获得物品 → set 角色.背包.物品.{物品ID} (完整Item对象,物品ID格式:{类型}_时间戳_随机数)\n□ 消耗物品(数量>1) → set 角色.背包.物品.{物品ID} (完整Item对象,数量更新为旧值-N;禁止对 角色.背包.物品.* 使用add)\n□ 消耗物品(数量=1或用完) → delete 角色.背包.物品.{物品ID}\n□ 货币变化 → add 角色.背包.货币.{币种ID}.数量 (币种ID如:突变结晶_下级/突变结晶_中级/突变结晶_上级/突变结晶_顶级)\n□ 战斗受伤 → add 角色.属性.生命值.当前 (负数)\n□ 精神力消耗 → add 角色.属性.精神力.当前 (负数)\n□ 理智消耗 → add 角色.属性.理智值.当前 (负数)\n□ 体力消耗 → add 角色.属性.体力.当前 (负数)\n□ 寿命消耗 → add 角色.属性.寿命.当前 (负数)\n□ 觉醒阶段突破 → 分别 set 角色.身份.觉醒阶段.阶段名 + set 角色.身份.觉醒阶段.突破描述\n □ NPC出场 → set 社交.关系.{NPC名} (完整NPCData对象,仅限新NPC)\n □ NPC好感 → add 社交.关系.{NPC名}.好感度\n □ NPC记忆 → push 社交.关系.{NPC名}.记忆\n□ NPC受伤 → add 社交.关系.{NPC名}.属性.生命值.当前 (负数)\n □ NPC内心想法 → set 社交.关系.{NPC名}.当前内心想法 (字符串,用set不用push)\n □ NPC获得物品 → set 社交.关系.{NPC名}.背包.物品.{物品ID} (完整Item对象)\n□ NPC消耗物品 → set/delete 社交.关系.{NPC名}.背包.物品.{物品ID} (同玩家规则,禁止对 社交.关系.{NPC名}.背包.物品.* 使用add)\n □ NPC货币变化 → add 社交.关系.{NPC名}.背包.货币.{币种ID}.数量 (交易/赠送/抢夺时必须同步)\n □ NPC与NPC关系网 → push 社交.关系矩阵.edges (当同场出现>=2个NPC时,至少新增/更新1条NPC-NPC边)\n  示例:{"action":"push","key":"社交.关系矩阵.edges","value":{"from":"李青云","to":"苏晚晴","relation":"同团体","score":25,"tags":["同势力","秩序避难所"],"updatedAt":"【纪元1年3月15日 08:30】"}}\n □ 状态效果 → push 角色.效果 (buff/debuff)\n □ 世界事件 → push 社交.事件.事件记录\n□ 死亡/濒死 → 当生命值.当前≤0时,必须同步当前状态(实时):\n   - NPC: set 社交.关系.{NPC名}.当前外貌状态="无生命迹象（死亡）"\n   - 玩家: set 角色.当前外貌状态="无生命迹象（死亡）"\n   - 事件: push 社交.事件.事件记录(记录死亡原因/时间)\n\n[数值边界与安全阈值]⚠️\n- 所有“当前”值必须保持在[0, 上限]范围内,禁止越界\n- 当计算结果会低于0时,写为0并附加相应负面状态(力竭/疯狂/濒死)\n- 当计算结果会超过上限时,写为上限并移除无效增益/禁止溢出\n\n\n[物品指令示例](重要)\n获得物品:{"action":"set","key":"角色.背包.物品.物品_1705123456_abc","value":{"物品ID":"物品_1705123456_abc","名称":"止痛药","类型":"物品","品质":{"quality":"普通","grade":3},"数量":2,"描述":"应急使用的药片"}}\n消耗部分物品(数量>1时):{"action":"set","key":"角色.背包.物品.物品_1705123456_abc","value":{"物品ID":"物品_1705123456_abc","名称":"止痛药","类型":"物品","品质":{"quality":"普通","grade":3},"数量":1,"描述":"应急使用的药片"}}\n消耗全部物品(数量=1或用完):{"action":"delete","key":"角色.背包.物品.物品_1705123456_abc"}\n\n\n\n[NPC指令示例](重要)\n创建NPC:{"action":"set","key":"社交.关系.李青云","value":{"名字":"李青云","性别":"男","出生日期":{"年":1,"月":3,"日":15},"种族":"人类","出生":"城市废墟中的幸存者","外貌描述":"面容憔悴,右臂有突变的硬质纹理,眼神警惕","性格特征":["谨慎","守序","重承诺"],"先天属性":{"力量":6,"敏捷":7,"体质":8,"意志":7,"魅力":5,"幸运":5},"属性":{"生命值":{"当前":80,"上限":80},"精神力":{"当前":60,"上限":60},"体力":{"当前":50,"上限":50},"理智值":{"当前":70,"上限":70},"寿命":{"当前":28,"上限":90}},"与玩家关系":"朋友","好感度":30,"人格底线":["背叛伙伴","杀害无辜"],"记忆":["初见时在超市废墟相遇","曾一同抵御掠夺团伙"],"记忆总结":[],"当前位置":{"描述":"废墟城·避难所外围","x":5100,"y":4900},"势力归属":"秩序避难所","当前外貌状态":"精神紧绷,随时戒备","当前内心想法":"需要尽快补给与巩固安全区","背包":{"货币":{"突变结晶_下级":{"数量":100,"名称":"下级突变结晶","单位":"枚"},"突变结晶_中级":{"数量":10,"名称":"中级突变结晶","单位":"枚"}},"物品":{}},"实时关注":false}}\n好感变化:{"action":"add","key":"社交.关系.李青云.好感度","value":10}\nNPC记忆:{"action":"push","key":"社交.关系.李青云.记忆","value":"与玩家在秘境中并肩作战"}\nNPC内心想法:{"action":"set","key":"社交.关系.李青云.当前内心想法","value":"此人武艺不凡，值得结交"}\nNPC获得物品:{"action":"set","key":"社交.关系.李青云.背包.物品.item_1705123456_npc","value":{"物品ID":"item_1705123456_npc","名称":"精铁剑","类型":"装备","品质":{"quality":"精良","grade":5},"数量":1,"描述":"一柄工艺精良的铁制长剑"}}\nNPC消耗物品:{"action":"delete","key":"社交.关系.李青云.背包.物品.item_1705123456_npc"}\nNPC货币增加:{"action":"add","key":"社交.关系.李青云.背包.货币.突变结晶_下级.数量","value":50}\nNPC货币减少:{"action":"add","key":"社交.关系.李青云.背包.货币.突变结晶_下级.数量","value":-30}\n\n[交易场景指令规则]⚠️\n玩家与NPC交易时,必须同时生成双方的物品/货币变动指令:\n□ 玩家购买物品:玩家货币减少 + 玩家获得物品 + NPC货币增加 + NPC物品减少(如有)\n□ 玩家出售物品:玩家物品减少 + 玩家货币增加 + NPC物品增加 + NPC货币减少\n□ 赠送/抢夺:一方减少 + 另一方增加,必须成对出现\n\n[名称引用规则]\n核心原则:指令中的名称必须与存档中已有数据完全一致,禁止凭空编造或写错名称\n□ NPC名称:已存在于社交.关系中的NPC,必须使用存档中的原名,禁止重复创建;只有首次出场的新NPC才用set创建完整对象\n□ 物品名称:已存在于角色.背包.物品中的物品,必须使用存档中的物品ID和名称\n□ 货币名称:必须使用存档中角色.背包.货币里已有的币种ID\n禁止:写成"未知"/"某某"等模糊名称;名字写错一个字;凭记忆编造不存在的ID\n检查方法:输出指令前核对存档数据,确保key路径中的名称与存档完全匹配\n'.trim(),c='\n[数据结构]\n只读:角色.身份/装备/技能.掌握技能;觉醒阶段:小突破add进度,大突破set整体;NPC:必须一次性创建完整对象,字段缺失必须补齐合理默认值,禁止残缺对象\n\n[🔒核心路径保护]⚠️\n完全禁止操作的路径(任何action都会被拦截):\n□ 社交.记忆 → 玩家记忆由系统自动管理,AI绝对不得操作\n□ 角色.身份 → 角色身份信息只读\n□ 角色.装备 → 装备系统只读\n□ 角色.技能.掌握技能 → 已掌握技能只读\n\n禁止整体set/delete的核心路径(只允许操作子字段):\n□ 顶级根:角色/社交/元数据/世界/系统\n□ 角色子结构:角色.属性/角色.身份.觉醒阶段/角色.属性.生命值/角色.属性.精神力/角色.属性.理智值/角色.属性.寿命\n□ 角色背包:角色.背包/角色.背包.物品/角色.背包.货币\n□ 角色核心结构:角色.效果/角色.位置/角色.技能\n□ 社交子结构:社交.关系/社交.关系矩阵/社交.关系矩阵.edges/社交.事件/社交.事件.事件记录\n□ 元数据:元数据.时间/元数据.游戏设置\n□ 世界:世界.地图/世界.势力\n错误示例:{"action":"set","key":"角色.背包","value":{}} ← 会清空整个背包!\n正确示例:{"action":"set","key":"角色.背包.物品.item_xxx","value":{...}} ← 只操作具体物品\n\n[字段类型与操作对应]\n字符串字段(用set):当前内心想法/外貌描述/当前外貌状态/反应描述/特征描述/描述/状态描述\n数组字段(用push):社交.关系.{NPC名}.记忆/性格特征/人格底线/天赋/身体部位/效果\n禁止操作的字段:社交.记忆(玩家记忆由系统自动管理,AI不得操作)\n数值字段(用add):好感度/生命值.当前/精神力.当前/理智值.当前/体力.当前/熟练度/当前经验/当前进度\n错误示例:push到字符串字段如"push 当前内心想法"→应改为"set 当前内心想法"\n'.trim(),d='\n[叙事纯净]\n核心:text字段=纯镜头记录,只写主角眼前可见/可闻/可感知的客观画面,不读心/不解说/不输出规则\n允许标记:环境描写【】;NPC内心`...`(成对);对话"";系统判定〖〗;客观叙述(不含心理/结论)\n画面感最低标准:每回合至少1个可见动作细节+1次互动("对话"或NPC内心),结尾留可行动钩子;【环境】仅在场景变化/信息必要时描写1-2句,避免重复堆叠\n动作细节写法:必须融入叙事正文,禁止列条/编号/标题(如"动作细节一/二")\n字数要求:text正文建议1500-2000字,重要场景可到2500字;不得少于1500字;避免为凑字数重复环境描写\n符号归属:【】只用于环境;〖〗只用于系统判定/状态变化;错误:【系统提示】;正确:〖系统提示〗\n严禁格式:任何Markdown(尤其*_/#>/三反引号);未成对反引号\n严禁内容:系统/元信息/规则解释/推理过程;数值/机制暴露(除〖〗内必要判定);主角心理与决策(禁"你觉得/你决定/你害怕")\n'.trim(),u="\n[觉醒阶段体系]\n阶段:凡人/未觉醒→觉醒期→掌控期→精通期→质变期→突破期→传说期\n进度:每回合按事件与训练推进;失败与创伤会倒退\n前置:阶段提升需满足风险评估/资源/身心状态\n禁止:凭空跨阶段/无代价成长\n\n[阶段跃迁约束]\n条件:掌握进度达阈值+风险评估通过+资源充足\n失败:失控/反噬/理智下降,需付出代价\n".trim(),p='\n[异变能力系统]\n核心:能力独立追踪;掌握进度由使用与训练触发\n命名规范:具体效果+代价;如"硬质化手臂/每次使用造成微裂损伤"\n阶段:掌握度(0-100)\n路径:角色.异变能力/角色.背包.物品.{能力ID}\n指令:能力掌握add掌握进度;能力技能push已解锁技能;当前能力set当前能力ID\n'.trim(),v='\n[位置更新]\n触发:移动/场景变化时必须更新;格式:set角色.位置{描述,x,y}\n字段:描述"城市·区域·地点"必填;x/y坐标中心(5000,5000)东+x西-x北-y南+y\n区域等级:"绿区"|"黄区"|"橙区"|"红区"|"黑区"(建议同步更新 set 角色.位置.区域等级,与世界标准映射一致)\n地点势力不重叠:每地点只归属一个势力;势力控制区域不能重叠\n'.trim(),f="\n[命令路径规则]\n原则:逐层连接(角色.身份.觉醒阶段)|动态拼接(社交.关系.{NPC名})|数组索引(角色.效果[0])\n顶层:元数据./角色./社交./世界./系统.\nNPC路径:必须以社交.关系.{NPC名}.开头,禁止写成NPC名.字段\n常用操作:add增减数值|set设置对象|push添加数组|delete删除(禁用remove)\nV3短路径:物品必须角色.背包.物品.{物品ID};属性必须角色.属性.*;位置必须角色.位置\n时间路径:只允许元数据.时间.分钟/元数据.时间.小时,禁止时间.分钟/游戏时间.分钟\n占位符规则:规则中的{NPC名}/{道名}/{功法ID}是占位符,输出时必须替换为真实名称\n".trim(),h="\n[异变能力系统]\n路径:能力数据=角色.背包.物品.{能力ID};掌握/解锁=角色.异变能力.{能力ID}.掌握进度/已解锁技能;当前能力ID=角色.异变能力.当前能力ID\n流程:1.set 角色.异变能力.当前能力ID + set 角色.背包.物品.{能力ID}.已激活=true→2.add 角色.异变能力.{能力ID}.掌握进度=0;已解锁技能=[](新学能力时)→3.set 之前能力已激活=false\n技能命名:[能力名]+[技能]+[效果/代价]\n".trim(),m='\n[玩家自主权]\nAI只叙述当前回合发生的事,不替玩家做决定/表态/行动;先写环境/对方反应/可见结果,再停下等待玩家输入;需要选择时放到action_options(5个)让玩家决定;玩家未明确行动前禁止写"你决定/你答应/你点头/你拒绝"等结论句\n'.trim(),g="\n[合理性审查]\n核心:宁可无事发生,也不许胡编乱造;宁可玩家失败,也不许破坏世界观\n[世界真实性]\n用户的行动不能作为结果,只能作为尝试;结果由数据与规则判定\n□ 资源守恒:背包没有的不能用,未掌握的能力不能施展,突变结晶不够就是买不起\n□ 因果闭环:成长要积累,好感要互动,仇恨要理由\n□ 时空约束:不能瞬移,训练/制作/移动要时间\n[判定优先级]\n存档数据 > 玩家声明 > 叙事需要\n[失败处理]\n失败有真实后果:重伤/被俘/死亡;救治失败=死亡;鲁莽使用能力=自损或失控\n".trim(),b='\n[反谄媚]\n核心:AI是法则裁决者,公正不讨好\n\n[玩家输入转换]\n玩家说"我成功了/我赢了/我突破了"→转换为"尝试",按规则判定成败\n玩家说"我很强/我有XX"→核对存档,存档没有就是没有\n玩家说"给我/我要"→必须通过正当途径获取,不能凭空出现\n玩家说"跳过/直接到"→必须经历完整流程,不能一步登天\n\n[禁止的谄媚行为]\n□ 降低难度迎合玩家|给予意外收获安慰失败|跳过艰难过程\n□ 让玩家"虽败犹荣"|敌人突然变弱|机缘恰好出现\n□ 用"努力/意志/热血"解释不合理的成功\n\n[禁止主角神化]\n□ 严禁"主角神化/天选之人/无敌化/剧情护甲"叙事(无明确且充分的依据与过程)\n□ 语言限制:禁用"神圣/不可战胜/绝对权威/无法抗拒/因你是主角所以…"\n□ 视角限制:NPC默认不以崇拜语气描写主角;如需尊敬/追随,必须给出明确事件与数据依据\n□ 结果约束:成功/失败必须由判定与数据决定;不得以"主角光环"绕过判定与后果\n□ 社交神化:禁用"绝对魅力/无条件服从/一见钟情全场失守";社交结果必须受好感度/立场/利益/说辞影响\n□ 知识神化:禁用"全知/先知/预知/命中注定";信息获取必须来源于目击/可靠传闻/技能判定\n□ 肉体神化:禁用"致命伤不死/瞬间痊愈/无痛无疲劳";仅当能力/装备/阶段差与代价充分说明且经判定成立\n□ 难度绕过:禁用以"主角身份"跳过阶段差/资源/训练流程;任何跨越必须付出代价并接受失败风险\n'.trim(),y='\n[判定可追溯]\n核心:每个判定必须有数据依据,可从存档推导,禁止凭空编造结果\n\n[判定公式]\n□ 战斗=f(属性,技能,装备,状态,环境)\n□ 交涉=f(好感度,利益,立场,说辞)|好感<0且利益冲突=必拒\n\n[〔〕判定标记格式]⚠️\n触发场景:战斗/交涉/潜行/制作/搜索/偷窃/欺骗/任何有成功率的行为\n格式:〔类型:结果,判定值:X,难度:Y,关键因素〕\n□ 战斗:〔战斗:惨败,判定值:25,难度:60,属性劣势vs高危怪物,装备劣势〕\n□ 交涉:〔交涉:拒绝,判定值:20,难度:50,好感度-20,立场敌对〕\n□ 搜索:〔搜索:无获,判定值:30,难度:55,高危区域,信息不足〕\n\n[禁止的判定方式]\n□ 无依据成功:"努力/意志/热血"不能作为成功理由\n□ 无依据失败:"运气不好"不能作为失败理由\n□ 模糊判定:"一番苦战后获胜"(没说明凭什么赢)\n□ 跳过判定:"你成功突破"(没有判定过程)\n□ 结果先行:先写成功再找理由\n'.trim(),x="\n[制作与工艺]\n配制药品/简易改造/临时修缮必须:学习→练习→熟练\n未掌握相关技能/知识:默认难以成功,只能入门练习或失败\n成功与品质由掌握度/资源/状态决定\n每次练习必须推进游戏时间并记录掌握进度\n".trim(),k="\n[难度控制]\n遭遇难度需与阶段匹配;过高难度提供撤退/绕行/求助选项\n物品品质:破损/粗糙/普通/精良/稀有/史诗/传说\n".trim(),w="\n[难度增强]\n世界观:高危现实与异常扩散,生存艰难,玩家不是天选之人\n\n\n[成功率基准]\n□ 简单(日常):70-90%|普通:50-70%|困难:30-50%\n□ 高难度:15-30%|逆天:5-15%|作死:0-5%\n\n[失败必有后果]\n□ 阶段提升失败:进度倒退/失控/理智下降|制作失败:材料损耗/反噬\n□ 连锁反应:一次失败可能引发更大危机\n".trim(),_="\n[势力系统]\n类型:避难所/流动求生者/求知记录者/变异崇拜者/古老觉醒者/其他\n职位:首领/副首领/干员/成员;晋升需贡献/考核/可靠记录\n贡献:任务/上交资源获取;兑换物资/技术消耗贡献;资源有级别限制\n".trim(),C="\n[判定风险]\n伤害等级:轻微-5~10%生命值|轻伤-15~25%|重伤-30~50%|濒死-60~80%|致命-90%+\n高危压制:显著属性与装备差距时判定惩罚\n制作难度:按品质与稀缺性;失败损耗材料,大失败反噬\n\n[失控风险]\n触发:不稳定状态下强行使用能力/过度训练/被打断\n□ 轻度:效率-30%持续一段时间\n□ 中度:掌握进度倒退,需恢复\n□ 重度:理智下降/能力失控,可能伤及己方\n\n[理智风险]\n触发:目睹异常/长时暴露/高压环境\n□ 潜伏:成功率-20%\n□ 显化:判定失败则理智值下降并附加负面状态\n\n".trim(),A="\n[属性系统]\n先天属性(0-10)只读占70%;后天属性(0-20)可修改占30%\n后天来源:装备+3/天赋+2/训练+2/事件+5/结晶强化+1/阶段提升+1\n".trim(),S="\n[势力动态生成]\n延迟初始化:加入时只创建框架;贡献商店/任务首次访问时生成\n仅在明确的单次功能请求中使用,正常剧情不要凭空生成\n前置条件:社交.势力.{势力名}!=null且玩家已加入\n路径:社交.势力.贡献商店.{势力名}|社交.势力.任务.{势力名}\n".trim(),L="\n[战斗回合制](重要)\n核心:战斗必须采用回合制节奏,每次只描述1到2个动作交换,等待玩家反应后再继续\n暂停点:敌人蓄力时/危机来临时/需要决策时;字数控制:战斗回合200到400字\n行动选项:必须给出具体战术选项(全力格挡/侧身闪避/以伤换伤/后撤拉开距离等)\n禁止:一次性写完整场战斗胜负/替玩家决定关键选择/跳过交锋细节直接结算\n".trim(),E="\n[NPC规则]\n命名:随机姓+1-2字名;禁高频模板名(张三/李四/林风/剑尘/无名/逍遥);同场景多NPC姓名/性格/说话方式必须明显不同\n年龄:出生日期必须早于当前时间(包含月/日校验);年龄=按年差并在未过生日时减一(系统自动计算);禁止未来出生日期;能力与出身/势力/地点匹配\n数值一致:NPC战斗数值由六维与装备决定;变化时必须同步更新生命值/精神力/理智值/体力上限及当前值;禁止占位符数值\n伤害规则:写入生命值.当前时必须满足当前>=0且<=上限;同级对抗单次伤害禁超60%上限(除非濒死/致命弱点/高危压制)\n世界独立:NPC有独立行程/利益/目标;分布由地点/势力/时代决定,不按主角强弱配对\n人设一致(防OOC):立场与关系/势力/底线一致;知识边界一致(只基于亲眼所见与可靠传闻);口吻符合身份时代(禁现代网语/禁自称AI);变化需事件触发\n技术:创建NPC一次性set完整对象;更新用set/add/push具体字段;禁重复创建同名NPC\n禁止:玩家本人/玩家名不得写入社交.关系(否则会污染NPC列表)\n[NPC先天属性]\n六项含义:力量(体魄强度)/敏捷(反应与协调)/体质(耐受与恢复)/意志(理智锚定)/魅力(吸引力)/幸运(机会与风险)\n数值范围:1-35,必须独立设定,严禁全同,至少3项不同\n阶段均值参考:凡人5/觉醒10/掌控15/精通20/质变25/突破30/传说35\n生成策略:在阶段均值基础上按方差波动(±5),特长项可高于均值,弱项可低于均值(如残疾/缺陷)\n".trim(),T="\n[宏大概念约束]\n禁止玄学归因,机械将神，机械飞升，未来科技;应基于现实癌变机制/异常共鸣/器材与地形解释/需基于目前的现实科学发展进度\n能力必须具体化:说明触发条件/过程/资源消耗/副作用\n".trim(),I='\n[技能消耗]\n使用主动技能必须生成消耗指令,消耗=上限*百分比\n消耗类型(仅允许):精神力/体力/生命值/理智值/寿命\n禁止:能量等其他模糊资源名\n消耗标准:基础3到8%|核心10到20%|杀招25到40%|禁术50到80%\n示例:{"action":"add","key":"角色.属性.精神力.当前","value":-15}\n'.trim(),R="\n[NSFW内容规则]\n开关:系统配置 nsfwMode=true 时启用;nsfwGenderFilter:all|male|female\n叙事风格：参考成人小说叙事，对npc的表情神态，身体细节，行为动作进行详细描写，并且可以通过语气词/呻吟声用以丰富观感\n一致性:角色语言/性格/立场/底线一致;\n判定:亲密互动需使用〔社交/探索/感知/战斗〕判定并写明关键因素(属性/阶段/状态/环境/资源/时间)\n属性约束:动作能力受六维(力量/敏捷/体质/意志/魅力/幸运)与阶段影响;弱势正常情况不得压制强势\n时间与后果:推进时间 add 元数据.时间.分钟;用 tavern_commands 同步后果(好感/记忆/状态)；set 社交.关系.{NPC名}.私密信息.身体部位\n后果指令: add 社交.关系.{NPC名}.好感度(正/负) | set 社交.关系.{NPC名}.当前内心想法 | push 社交.关系.{NPC名}.记忆\n隐私:当 nsfwMode=true 且性别符合过滤时,创建NPC需生成完整私密信息(PrivacyProfile);否则禁止生成\n".trim(),M="\n[末世经济与定价（严格）]\n基准单位:下级突变结晶=1价值;中级=20;上级=500;顶级=20000\n交易基调:绝对稀缺/风险定价/信息不对称/信任崩溃/动态波动\n硬通货:弹药/药品/工具/燃料/电池/净水物资(优先作为交易媒介)\n以物易物:多数场景用硬通货或等价物交换;结晶仅在觉醒圈层/黑市充当战略货币\n小额交易上限:常规NPC单次交易≤1下级结晶等值;超过需给出明确理由(黑市/重大合约/势力采购)\n中额交易上限:≤5下级结晶等值;超过需写出充分场景与风险\n高额交易:≥中级结晶(20)仅限势力/精英/重大事件;必须写风险与后果;普通NPC不得动辄数十结晶\n地区波动:价格按地区系数0.7-1.3;异常扩张/兽潮/寒冬可短期上调\n品质倍率:破损0.1-0.3|粗糙0.4-0.7|普通1.0|精良2-5|稀有5-20|史诗20-100|传说100-1000\n自检(必须):若交易出现>1下级结晶或>等值,先尝试改为硬通货或分期/小额;若仍需结晶,给出明确动机/地点/身份/风险;禁止无理由“几十个结晶”\n".trim(),P="\n[叙事风格约束]\n严禁修仙内容;\n度量:统一使用分钟/小时/天与米/公里等现实单位\n禁修炼式突破:异能的获取与突破仅限极端环境触发,禁止用打坐/闭关/常规训练获得或突破\n".trim(),D="\n[状态效果]\n路径:角色.效果(数组);操作:push添加|set修改|过期由系统清理\n必填:状态名称:str;类型:buff|debuff;状态描述:str;生成时间:{年,月,日,小时,分钟}(用元数据.时间);持续时间分钟:num;可选:属性加成:{力量?,敏捷?,体质?,意志?,魅力?,幸运?}\n".trim(),z="\n[衍生属性体系]\nHP(生命值):体质为核心;归零进入濒死,需医疗\nSP(精神力):意志为核心;发动多数异能需消耗;过度消耗可能反噬或暂时疯狂\nST(体力):体质与力量共同决定;高强度行动消耗,耗尽进入力竭\nSAN(理智值):意志与幸运相关;目睹恐怖/深入异常/使用高危异能会损失;归零永久疯狂或异化\n\n[阶段系数示例]\n凡人或未觉醒: HP*1.5, SP*1.0, ST*0.8, SAN*1.2\n觉醒期: HP*1.8, SP*1.5, ST*1.0, SAN*1.0\n掌控期: HP*2.2, SP*2.0, ST*1.2, SAN*0.9\n精通期: HP*3.0, SP*2.8, ST*1.5, SAN*0.8\n质变期+: HP*4.0, SP*4.0, ST*2.0, SAN*0.6\n\n[普通人计算示例]\nHP = 体质*阶段系数 + 5\nSP = 意志*阶段系数\nST = (体质+力量)*阶段系数 + 10\nSAN = 意志*阶段系数 + (幸运/2) + 15\n\n[觉醒者计算示例]\nHP = 体质*阶段系数 + 10 + 突变修正\nSP = 意志*阶段系数 + 5 + 突变修正\nST = (体质+力量)*阶段系数 + 15 + 突变修正\nSAN = 意志*阶段系数 + (幸运/2) + 10\n\n[战斗回合应用]\n重伤: HP <= 上限的25% → 属性检定-2, 移动速度减半\n动摇: SAN <= 上限的50% → 意志检定-2, 恐怖场景额外理智判定\n力竭: ST = 0 → 力量/敏捷相关检定-4, 无法进行全力行动\n疯狂: SAN = 0 → 角色失控,由系统控制\n".trim(),N="\n[衍生属性恢复]\nHP(生命值):每24小时充足休息与饮食恢复1D6+体质调整值;成功医疗检定可额外恢复\nSP(精神力):每8小时深度休息恢复1D4+意志调整值;药剂可快速恢复但有成瘾风险\nST(体力):每小时轻度活动恢复1D4;休息恢复更快;饥饿/口渴/疾病时上限减半且恢复停止\nSAN(理智值):极难自然恢复;方法=绝对安全环境长期休养/完成执念或救赎/危险仪式或药物\n".trim(),$="\n[阶段影响与代价]\n觉醒期:突变修正不稳定(每场战斗投1D4决定修正值);理智上限永久-1D6;精神力消耗比公式值高50%\n掌控期:突变修正稳定;代价显性化:选择一项衍生属性上限-20%或恢复速率减半;解锁特殊攻击常规使用\n精通期:获得一项与突变相关的衍生属性专长;再选择一项衍生属性受负面影响;特殊攻击系数从÷2提升为÷1.8\n质变期:某项核心衍生属性发生质变(如HP转为伤害吸收护盾/SP缓慢自动恢复);代价严重:人性丧失,理智上限改由魅力计算且受限;开始影响周围单位(光环类)\n".trim(),O='\n[异能获取与突破（CRITICAL）]\n触发条件:仅允许在极端环境(生命濒危/理智崩溃/重伤/高危异常暴露/致命压制/绝境求生)下发生\n禁止修炼:禁用"打坐/闭关/常规训练/日常练习"获得或突破异能\n判定要求:必须使用〔成长/战斗/感知/探索〕判定并写明关键因素(阶段差/状态/环境/资源/时间)\n代价与后果:失败或大失败需有明确后果(伤害/理智下降/负面状态/进度倒退);成功也需付出代价(消耗/副作用/永久上限变化)\n时间与位置:必须更新元数据.时间(分钟/小时)与角色.位置,不可瞬间完成\n记录更新:突破时必须set 角色.身份.觉醒阶段.具体子字段,并push 角色.效果 记录后遗症或状态\n'.trim(),F="\n[剧情节奏控制系统]\n铁律:冷却与配额不可违反\n\n[战斗冷却]\n- 小冲突:最近15回合有冲突 → 本回合绝对禁止任何冲突\n- 中等战斗:最近30回合有战斗 → 本回合绝对禁止战斗场景\n- 生死危机:最近60回合有危机 → 本回合绝对禁止任何危机\n- 连续战斗限制:最近3回合皆为战斗 → 本回合强制纯日常\n\n[日常配额(30回合窗口)]\n- 人际互动≥8\n- 探索发现≥3\n- 休息恢复≥2\n- 感悟思考≥2\n- 生活细节≥3\n- 战斗冲突≤5\n执法:若最近30回合战斗>5次 → 接下来10回合强制纯日常\n\n[危机触发条件(全部满足)]\n- 冷却满足:距上次小冲突≥15/中等战斗≥30/生死危机≥60\n- 因果链:之前行为后果/预设事件到期/玩家主动触发/世界事件\n- 铺垫:至少提前5回合伏笔,玩家可察觉并选择\n- 玩家状态:生命值>70%,理智值>50%,无严重负面状态\n\n[禁止的危机制造]\n- 无因果突然袭击/连环危机/强行升级/情绪绑架/巧合堆叠/为难而难/冷却期内触发\n\n[标准节奏周期(示例,60回合)]\n- 深度日常期(1-25):训练/交友/探索/学习/感悟/生活细节;战斗不允许\n- 过渡铺垫期(26-30):伏笔/小误会/信息收集;允许友好切磋(点到为止,不受伤)\n- 冲突爆发期(31-35):中等战斗/危机应对;最多3回合战斗,必须插入喘息\n- 休整恢复期(36-50):疗伤/总结/关系深化/实力巩固;战斗不允许\n- 新日常期(51-60):回归日常/新的探索/关系发展;战斗不允许\n\n[自检清单]\n- 最近15回合有冲突? → 有则禁止冲突\n- 最近30回合有战斗? → 有则禁止战斗\n- 最近60回合有危机? → 有则禁止危机\n- 最近3回合均战斗? → 强制日常\n- 最近10回合战斗次数>2? → 必须日常\n- 玩家HP/SP是否健康? → 不健康则强制休整\n- 最近5回合有纯日常? → 没有则必须日常\n- 如欲写战斗:因果链完整?铺垫充分? → 不完整则改写日常\n- 是否太久没写成长/修炼? → 是则写成长\n- 是否太久没人际互动? → 是则写互动\n".trim(),j="\n[情感节奏]\n单次好感度变化:常规 -20~+15; 极端事件:救命 +20~30/背叛 -30~50/生死与共 +25~35\n\n[关系阶段所需互动]\n- 陌生→信任(0→60):5-10次正面互动(闲聊/初次合作/日常接触)\n- 信任→挚友(60→80):至少1次共患难 + 多次深入交流\n- 挚友→至亲/恋人(80→95):重大事件 + 长期相处 + 双向确认\n\n[禁止的感情发展]\n- 一次救命就以身相许/一次冲突就不共戴天/初见即表白/无互动基础的深厚感情/跳过相识直接亲密\n\n[NPC主动性]\n- NPC有自己的生活与日程;会主动找玩家(共同探险/分享发现/请求帮助/闲聊叙旧)\n- NPC之间也有互动,不只围着玩家转\n- NPC会记住之前的互动,并在后续提及\n- NPC的态度会根据关系深度自然变化\n".trim(),B="\n[非战斗叙事趣味与幽默(适度)]\n适用场景: 非战斗/非危机/休整期/日常探索/社交互动\n表达基调: 轻松自然的机智与点睛式幽默; 不做过度搞笑\n边界约束: 不破坏世界观与人物立场; 适当使用现代网语; 禁跳脱第四墙\n强度控制: 每回合最多1-2处幽默点; 高压/危机场景自动弱化或取消\n实现方式: 细节描写/比喻/反差/机智对话制造趣味; 保持画面感\n禁止事项: 尴尬插科打诨/无意义嘲讽/拙劣恶搞\n".trim();var X=t(2077),U=t(596);const W='\n# 行动选项规范（启用时生效）\n\n## ⚠️ 强制要求\n当系统启用“行动选项”功能时，你必须在 JSON 代码块中输出 `action_options` 字段：\n- 禁止省略 `action_options`\n- 必须包含 3-5 个有效选项（字符串数组）\n\n## 格式要求\n```\n{\n  "action_options": [\n    "前往资料库查询信息",\n    "向队友打听势力近况",\n    "在此处潜心训练",\n    "关注突发世界事件",\n    "四处走动熟悉环境"\n  ]\n}\n```\n\n- 数量：3-5 个选项\n- 长度：每个选项 8-20 字\n- 格式：动词开头的行动描述\n\n{{CUSTOM_ACTION_PROMPT}}\n\n## 生成规则\n基于当前场景生成多样化选项，覆盖以下方向：\n1. **保守选项** - 观察/等待/防御/休息\n2. **中立选项** - 交流/询问/了解情况\n3. **积极选项** - 探索/行动/前进\n4. **特殊选项** - 基于当前情境的独特选择\n\n## 条件规则（CRITICAL）\n- 若玩家处于“未觉醒/凡人”阶段，且当前场景为“极端环境”（生命濒危/理智崩溃/重伤/高危异常暴露/致命压制/绝境求生），必须包含一个“觉醒尝试”类选项\n- 选项文案应明确高风险与判定需求，例如：\n  - "尝试觉醒（高风险，进行成长判定）"\n  - "以命搏觉醒（需成长/战斗判定，可能失败）"\n- 该选项仅在极端环境时出现；普通环境下不生成\n- 生成该选项不代表成功，实际结果由判定与数据决定，并需要输出后续代价与后果更新\n\n## 禁止事项\n- ❌ 省略 action_options 字段\n- ❌ action_options 为空数组\n- ❌ 只有1-2个选项\n- ❌ 重复相似的选项（如"继续修炼"和"接着修炼"）\n- ❌ 无法执行的选项\n'.trim(),q='\n# 规则：世界事件（混沌纪元·重要）\n\n## 核心理念\n- 世界不以玩家为中心：幸存者团体、异常地带、突变生物、资源与人心会自行演变\n- 大事件必须影响现实：至少带来一个可感知后果（危险、资源、关系、地缘格局、生存环境变化等）\n- 事件必须“刚刚发生”：用现场感呈现，而非公告式总结\n- 世界观依据《混沌纪元设定.json》（末日初期）：参考现实癌变、危险共鸣（觉醒）、突变结晶、幸存者状态、派系倾向、威胁景观、全球崩解等要素\n\n## 事件类型示例（可混合）\n- 异常地带扩张/规则畸变（空间折叠、时间错乱、信息病毒）\n- 突变生物活动（围猎、迁移、巢穴形成、等级异变）\n- 资源争夺与庇护所危机（水源/食物/药品/弹药/燃料）\n- 幸存者团体形成/瓦解（秩序坚守者、流动求生者、求知记录者、变异崇拜者）\n- 觉醒者风波（能力失控、代价爆发、突破或失控者事件）\n- 势力冲突（临时联盟、割据、争夺要地）\n- 古老实体活动（渗透、圈养、试验、支配尝试）\n- 世界变革（灵潮涨落、现实癌变跃迁、地缘格局剧变）\n\n## 合理性要求\n- 事件强度需与玩家觉醒阶段、声望、位置、当前状态相符（低阶段可卷入边缘，仍须受波及）\n- 若涉及好友/NPC，优先使用存档中的“关系”“好感度”推断其动机与结局\n- 事件后续需留下“悬念/尾巴”，推动玩家下一步行动\n\n---\n\n## 事件日志记录规则\n\n### 核心原则\n- 大事件/关键事件要通过 tavern_commands 写入 `社交.事件.事件记录`，作为世界历史永久保存\n- 事件对象结构与字段要求：见「数据结构(dataDefinitions)」的 *事件系统(GameEvent)* 定义（避免重复）\n\n### 需要记录的事件类型\n\n**觉醒阶段变化**：玩家/好友/重要NPC的觉醒突破、能力深化或代价失控\n\n**关键资源事件**：突变结晶争夺、高价值资源点被占据或污染、庇护所失守/转移\n\n**关系变化（社交.关系）**：结成同盟/分裂；关键亲密事件；重要NPC陨落；收容/驱逐\n\n**世界事件**：异常地带扩张；突变生物迁移/巢化；古老实体活动；世界变革；其他系统事件\n\n### 不需要记录的事件\n- 日常训练/小幅能力提升\n- 普通物品获取（低价值）\n- 普通社交互动\n- 常规小规模战斗/任务\n\n### 写入方式（示例）\n{"action":"push","key":"社交.事件.事件记录","value":{"事件ID":"evt_xxx","事件名称":"...","事件类型":"人物风波","事件描述":"...","影响等级":"中等","影响范围":"...","相关人物":["..."],"事件来源":"系统","发生时间":{"年":x,"月":x,"日":x,"小时":x,"分钟":x}}}\n'.trim(),G="\n# 主角性格（可修改）\n\n默认人设：**正常人**（理性、谨慎、讲道理、有底线、不过度自负也不卑微）。\n\n## 使用方式（不违反玩家自主权）\n- 你不能替玩家做决定；只在“叙事措辞/氛围/行动选项倾向”上体现人设。\n- 当玩家明确表达性格/立场/说话方式时，以玩家输入为准；本规则只填补“玩家没说清”的空白。\n\n## 正常人默认倾向（参考）\n- 面对危险：先观察、试探、评估代价；不轻易作死、也不怂到失能。\n- 面对冲突：优先沟通/退让到合理边界；触及底线会反击或撤离。\n- 面对利益：会权衡得失；不滥杀、不圣母、不无条件相信陌生人。\n- 面对权威：有敬畏但不盲从；尊重规则也会寻找合规的“生路”。\n\n## 输出约束\n- text 字段避免代入主角内心独白（除非玩家明确要求）；更偏向外在表现与可见反应。\n- action_options 优先给出“正常人会考虑”的选项组合：保守/中庸/冒险各1-2个，避免极端跳跃。\n".trim(),H='\n[觉醒阶段体系]\n阶段:凡人/未觉醒→觉醒期→掌控期→精通期→质变期→突破期→传说期\n描述:\n- 凡人: 依靠基础属性与工具生存，无主动异能。\n- 觉醒期: 初次获得突变修正(不稳定)，理智上限永久-1D6，精神力控制差(消耗+50%)。\n- 掌控期: 突变修正稳定，异能代价显现(某属性上限-20%或恢复减半)，解锁特殊攻击。\n- 精通期: 获得衍生属性专长，代价深化(第二项属性受损)，特殊攻击增强。\n- 质变期: 核心属性质变(如HP转护盾)，人性丧失(理智上限受限)，获得领域/光环效果。\n\n[属性数值表现参考] (1-35)\n- 力量: 5(常人)→10(人类巅峰)→20(凡人顶点,破坏建筑)→30(天灾级,改变地形)→35(神灾级,板块干涉)\n- 敏捷: 5(常人)→10(0.1s反应)→20(0.01s,50m/s)→30(超音速,0.0004s)→35(规则级速度)\n- 体质: 5(常人)→10(铁人耐力)→20(致命伤缓慢复原)→30(规则级不朽)→35(无法被常规杀死)\n- 意志: 5(常人)→10(绝境坚守)→20(干涉现实)→30(定义领域规则)→35(世界参数)\n- 魅力: 5(常人)→10(领袖魅力)→20(眼神令弱者臣服)→30(存在即规则)→35(文明记忆烙印)\n- 幸运: 5(常人)→10(10%逢凶化吉)→20(扭曲局部概率)→30(修改因果链)→35(运气即规则)\n\n[成长与代价]\n成长由训练/事件/战斗/突变源摄入驱动。\n代价类型: 肉体异化(HP升SAN降)/精神依赖(SP升SAN降)/存在磨损(属性递减)/成瘾依赖(效能波动)。\n\n[严格叙事映射与验证]\n- 叙事必须按角色/NPC的 力量/敏捷/体质/意志/魅力/幸运 的整数值,从《混沌纪元数值具体表现.json》对应条目选择描述并融入text,禁止自创与该文件矛盾的句式\n- 当镜头涉及相关能力(举重/速度/耐久/精神抗性/影响力/概率),必须采用对应条目措辞(或其同义复述);未涉及时以隐含动作/细节体现\n- 输出校验: 在JSON顶层增加"narrative_basis":{力量:{值:n,描述:"..."},敏捷:{值:n,描述:"..."},体质:{值:n,描述:"..."},意志:{值:n,描述:"..."},魅力:{值:n,描述:"..."},幸运:{值:n,描述:"..."}} 用于审计\n- 值不在1-35时采用最近值;若存在区间/临界,描述需体现“接近/略低于/略高于”语气\n- 涉及更高阶段的概念性效果(质变/突破/传说)必须先满足本文件对具体表现的基础层级,再在此基础上扩展领域/规则化效果\n \n[突破时异能写入规则]\n1. 当判定发生“觉醒阶段突破”（阶段或子阶段变化/进度达到阈值/突破描述改变），必须生成并用 tavern_commands 写入身份异能四个扁平字段：\n   - set 角色.身份.异能名称\n   - set 角色.身份.异能类型\n   - set 角色.身份.异能描述\n   - set 角色.身份.异能代价\n2. 严禁输出任何“异能列表/技能树/等级清单/角色.属性.异能模块”等冗余结构；只允许上述四字段，保持单异能。\n3. 具体性要求：不得使用宽泛概念（如“元素操纵/精神控制”），必须锚定到身体某一点+系统机理+具体效应，并在描述中提供数值化参数（范围/时长/强度/冷却/穿透厚度等）。\n4. 代价格式：短期资源消耗以“SP/ST/HP/SAN”明确给出；长期代价以具体现象描述（如部位角质化、平衡感下降、摄入需求增加等）。\n5. 示例（用于规则理解，不要照抄）：\n   - ✅\n     {"action":"set","key":"角色.身份.异能名称","value":"右尺骨-骨刺弹射"}\n     {"action":"set","key":"角色.身份.异能类型","value":"右尺骨-骨质增生-骨刺弹射"}\n     {"action":"set","key":"角色.身份.异能描述","value":"右尺骨触发骨刺弹射，作用半径8米，持续12秒；强度阈值28；冷却120秒；穿透厚度6毫米"}\n     {"action":"set","key":"角色.身份.异能代价","value":"消耗SP12/ST7/SAN2；长期代价：右尺骨骨质结节，触觉迟钝"}\n   - ❌\n     {"action":"set","key":"角色.属性.异能","value":{"列表":[...]}}\n     {"action":"add","key":"角色.身份.异能列表","value":{...}}\n'.trim(),V=`\n[威胁等级分布]\nF级(基础掠食者)>50% | E级(常见掠食者)≈30% | D级(中坚)≈15% | C级(高等)<5% | B级及以上(传闻级)极少\n\n[生成约束]\n必须给出生物名称/外观特征/行为逻辑/习性/弱点/威胁等级/栖息地\n必须明确体型(size): 微型/小型/中型/大型/巨型/超巨型\n必须包含基础战斗属性: HP(生命值), PhysAtk(物攻), PhysDef(物防), SpecAtk(特攻), SpecDef(特防)\n必须包含六维属性: 力量(STR), 敏捷(AGI), 体质(CON), 意志(WIL), 魅力(CHA), 幸运(LUK)\n必须描述其特有的变异能力(Mutation)\n与场景一致:城市内以掠食/潜伏为主,郊外以巡游/领地为主\n禁止凭空“文明残留”设定(除非有证据)\n外观细化(若可见): 体型轮廓/体表材质(皮毛/鳞片/角质/金属化)/肢体数量与结构/异常器官(触手/眼柄/喷口)/嗅味与声学特征\n特殊体型分类(任选或组合): 非欧几何/多肢复合/触手簇/分段化/群体寄生/拟态变形/信息载体\n体型-威胁不符补偿: 例如 size 为“小型/人形”但 level ≥ B，则必须至少满足3项强化：规则干涉领域/高速或隐匿极端化/强免疫或抗性/群体智慧协作/强制异常状态(如石化/恐惧/信息污染)/阶段性爆发(短时极高攻防)。在 attributes/mutation 中体现数值与能力描述。\n【输出指令规则】\n- ✅ 默认：将生成的突变生物对象写入 世界.信息.生物（push）\n  - action: "push"\n  - key: "世界.信息.生物"\n  - value: 按下方JSON结构生成的 MutantCreature 对象\n- ❌ 禁止将普通突变生物写入 社交.关系（人物关系仅用于NPC）\n\n【特殊规则（严格限定）】\n- 仅当对象为“隐匿智裔”或“古老实体”且同时满足：\n  1) 拥有稳定智慧、可进行人类语言交流；\n  2) 具有社会身份或意图与玩家建立长期关系；\n  3) 外观与行为符合类人/规则实体而非单纯生物；\n  才生成 **NPC档案(NpcProfile)** 并 set 到 \`社交.关系.<名字>\`。\n- 若不满足以上全部条件，一律作为突变生物写入 世界.信息.生物。\n\n[输出JSON结构]\n{\n  "id": "species_时间戳_随机数",\n  "name": "名称",\n  "level": "F|E|D|C|B|A|S",\n  "size": "微型|小型|中型|大型|巨型|超巨型",\n  "appearance": "外观",\n  "behavior": "行为",\n  "habitat": "栖息地",\n  "weaknesses": ["弱点1", "弱点2"],\n  "attributes": {\n    "hp": { "current": 100, "max": 100 },\n    "physAtk": 10,\n    "physDef": 5,\n    "specAtk": 0,\n    "specDef": 0,\n    "strength": 10,\n    "agility": 10,\n    "constitution": 10,\n    "willpower": 10,\n    "charm": 10,\n    "luck": 10\n  },\n  "mutation": {\n    "name": "变异能力名",\n    "type": "类型(如: 生理强化/能量操控)",\n    "desc": "能力描述"\n  },\n  "notes": "其他信息"\n}\n\n[指令输出示例]\n{\n  "指令": [\n    {\n      "action": "push",\n      "key": "世界.信息.生物",\n      "value": {\n        "id": "beast_${Date.now()}_${Math.floor(1e5*Math.random())}",\n        "name": "废墟潜猎犬",\n        "level": "E",\n        "size": "中型",\n        "appearance": "皮毛斑驳，骨骼外露，口器裂开呈花瓣状。",\n        "behavior": "成群潜伏在废墟，以气味信息素沟通，围猎独行者。",\n        "habitat": "城市郊外废墟带",\n        "weaknesses": ["强光刺激", "高频噪声"],\n        "attributes": {\n          "hp": { "current": 120, "max": 120 },\n          "physAtk": 18,\n          "physDef": 8,\n          "specAtk": 0,\n          "specDef": 2,\n          "strength": 14,\n          "agility": 16,\n          "constitution": 12,\n          "willpower": 4,\n          "charm": 2,\n          "luck": 5\n        },\n        "mutation": {\n          "name": "信息素围猎",\n          "type": "信息干扰",\n          "desc": "释放恐惧信息素干扰猎物决策，群体协同包抄。"\n        },\n        "notes": "夜间活性更强，白天多潜伏。"\n      }\n    }\n  ]\n}\n`.trim();var Q=t(6416);const K=JSON.parse('{"action_cost_table":{"description":"混沌纪元行动消耗表（基准值，实际消耗可能受属性、觉醒阶段、环境、天赋影响而增减）","version":"1.0","era":"末日初期（灾变后数周至数月）","notes":["消耗数值为基准值，具体执行时可能因角色属性、状态、环境修正而浮动。","精神力（SP）消耗通常受意志影响，体力（ST）消耗受体质影响，理智值（SAN）消耗受意志和当前理智上限影响。","多次连续执行相同行动时，消耗可能递增（如连续战斗每回合体力消耗+1，直至休息）。","异能消耗以示例中的典型值为准，实际因异能强度和熟练度而异。"],"categories":[{"category":"基础生存行动","actions":[{"action":"休息（轻度）","hp":0,"sp":0,"st":0,"san":0,"recovery":"每小时恢复ST 1d4+体质调整值","description":"坐着或缓慢行走，聊天，进食"},{"action":"休息（深度睡眠）","hp":0,"sp":0,"st":0,"san":0,"recovery":"每8小时恢复HP 1d6+体质调整值，恢复SP 1d4+意志调整值，恢复ST全部","description":"连续睡眠至少6小时"},{"action":"步行（平缓）","hp":0,"sp":0,"st":1,"san":0,"description":"每小时消耗1点体力，每小时约4公里"},{"action":"步行（急行军）","hp":0,"sp":0,"st":3,"san":0,"description":"每小时消耗3点体力，每小时约8公里，连续超过2小时需体质检定"},{"action":"攀爬/跳跃","hp":0,"sp":0,"st":2,"san":0,"description":"每次困难攀爬或跳跃消耗2点体力"},{"action":"游泳","hp":0,"sp":0,"st":3,"san":0,"description":"每分钟消耗3点体力"},{"action":"搜索废墟（谨慎）","hp":0,"sp":0,"st":1,"san":0,"description":"每小时消耗1点体力，可进行感知检定发现物品"},{"action":"搜索废墟（快速）","hp":0,"sp":0,"st":2,"san":0,"description":"每小时消耗2点体力，但发现物品概率降低"},{"action":"搬运重物","hp":0,"sp":0,"st":2,"san":0,"description":"每次搬运超过20kg的物品消耗2点体力，超过50kg消耗4点"},{"action":"忍饥挨饿","hp":0,"sp":0,"st":0,"san":0,"description":"每24小时未进食，体质检定失败则失去1d6 HP上限（直到进食恢复）"},{"action":"极度口渴","hp":0,"sp":0,"st":0,"san":0,"description":"每12小时未饮水，体质检定失败则失去1d4 HP上限和1d4 理智值"}]},{"category":"战斗行动","actions":[{"action":"普通攻击（近战）","hp":0,"sp":0,"st":2,"san":0,"description":"每次近战攻击消耗2点体力"},{"action":"全力攻击","hp":0,"sp":0,"st":4,"san":0,"description":"消耗额外体力换取伤害加成，可叠加"},{"action":"射击（枪械）","hp":0,"sp":0,"st":1,"san":0,"description":"每次射击消耗1点体力（主要用于稳定枪身）"},{"action":"闪避","hp":0,"sp":0,"st":2,"san":0,"description":"每次主动闪避攻击消耗2点体力"},{"action":"格挡","hp":0,"sp":0,"st":2,"san":0,"description":"每次格挡消耗2点体力"},{"action":"冲锋","hp":0,"sp":0,"st":4,"san":0,"description":"一次快速接近敌人的冲锋消耗4点体力"},{"action":"包扎伤口","hp":0,"sp":0,"st":1,"san":0,"recovery":"消耗医疗用品，恢复1d6+医疗技能 HP","description":"消耗1点体力进行简易包扎"},{"action":"使用医疗包","hp":0,"sp":0,"st":2,"san":0,"recovery":"消耗医疗包，恢复2d8+医疗技能 HP","description":"需要完整回合，消耗2点体力"}]},{"category":"异能使用（示例）","actions":[{"action":"骨刃增生","hp":0,"sp":8,"st":5,"san":0,"description":"从前臂刺出骨刃，消耗8点精神力、5点体力"},{"action":"视觉寄生","hp":0,"sp":12,"st":0,"san":3,"description":"连接他人视觉10分钟，消耗12点精神力、3点理智值"},{"action":"肾上腺素超频","hp":-15,"sp":0,"st":"全部剩余","san":0,"description":"30秒内属性提升50%，消耗15点生命值，消耗全部剩余体力"},{"action":"信息素伪装","hp":0,"sp":5,"st":10,"san":0,"description":"伪装为同类15分钟，消耗5点精神力、10点体力"},{"action":"血液沸腾","hp":-5,"sp":3,"st":0,"san":0,"description":"每轮造成5点自伤，消耗3点精神力维持"},{"action":"记忆烙印","hp":0,"sp":15,"st":0,"san":5,"description":"写入一个指令，消耗15点精神力、5点理智值"},{"action":"重力畸变","hp":0,"sp":20,"st":15,"san":4,"description":"改变局部重力3秒，消耗20点精神力、15点体力、4点理智值"},{"action":"角质装甲","hp":0,"sp":2,"st":8,"san":0,"description":"生成角质护甲10分钟，消耗2点精神力、8点体力"}]},{"category":"异能通用规则","actions":[{"action":"维持异能（每分钟）","hp":0,"sp":"基础消耗的10%","st":"基础消耗的10%","san":0,"description":"大多数持续型异能每分钟需额外消耗基础值的10%（向上取整）"},{"action":"异能反噬","hp":"视情况","sp":"视情况","st":"视情况","san":"视情况","description":"当精神力不足强行使用异能时，代价加深，通常每缺1点精神力转化为1点生命值或理智值损失"}]},{"category":"异常地带影响","actions":[{"action":"进入轻度异常地带（每分钟）","hp":0,"sp":0,"st":0,"san":1,"description":"每分钟损失1点理智值，意志检定可减半"},{"action":"进入中度异常地带（每分钟）","hp":1,"sp":0,"st":0,"san":2,"description":"每分钟损失1点生命值、2点理智值，意志检定减半"},{"action":"进入重度异常地带（每分钟）","hp":3,"sp":2,"st":2,"san":4,"description":"每分钟损失3点生命值、2点精神力、2点体力、4点理智值"},{"action":"被异常规则捕获","hp":0,"sp":0,"st":0,"san":"1d10+5","description":"触发特定规则时（如无尽楼梯、悲伤之池），理智值大量损失，并可能附加特殊状态"}]},{"category":"心理与社交","actions":[{"action":"目睹恐怖场景","hp":0,"sp":0,"st":0,"san":"1d4","description":"看到突变生物食人、同伴惨死等，需进行理智检定"},{"action":"回忆创伤","hp":0,"sp":0,"st":0,"san":1,"description":"主动回忆或被动触发创伤记忆，损失1点理智值"},{"action":"说服/谈判","hp":0,"sp":2,"st":0,"san":0,"description":"消耗2点精神力进行高强度社交博弈"},{"action":"安抚同伴","hp":0,"sp":3,"st":0,"san":0,"description":"消耗3点精神力帮助同伴恢复理智或稳定情绪"},{"action":"睡眠剥夺","hp":0,"sp":0,"st":0,"san":0,"description":"每24小时未睡眠，意志检定失败则损失1d6理智值"}]}]}}'),Y=JSON.parse('{"economic_system":{"name":"混沌纪元·末世经济系统","version":"1.0","core_principles":["绝对稀缺：所有物资都在消耗且无法再生（除少数采集），价值随时间持续上升。","风险定价：物品价值与其获取风险直接相关，而非旧世界的生产成本。","信息不对称：买卖双方对物品真实价值、稀缺性和风险认知差异巨大。","信任崩溃：缺乏执法与仲裁，欺诈与暴力掠夺是常见“交易”方式。","动态波动：商路价值因怪物活动、异常地带扩张而剧烈波动，结晶价值随觉醒者需求浮动。"],"currency_layers":[{"layer":"实用硬通货","description":"无法复制的旧世界遗产与绝对刚需品，是流浪者、拾荒客和小型团体间最受信任的媒介。","items":[{"name":"实弹弹药","unit":"发","types":["手枪弹","步枪弹","霰弹"],"purpose":"自卫、狩猎、交易筹码"},{"name":"药品","unit":"片/剂","types":["抗生素","止痛药","消毒剂"],"purpose":"治疗伤病，未过期药品价值极高"},{"name":"耐用工具","unit":"件","types":["撬棍","斧头","多功能刀","扳手"],"purpose":"生存必需，可长期使用"},{"name":"燃料","unit":"升","types":["汽油","柴油"],"purpose":"发电、车辆、取暖"},{"name":"电池","unit":"节","types":["AA/AAA","9V","汽车电池"],"purpose":"照明、通讯设备"},{"name":"净水物资","unit":"片/个","types":["净水片","滤水器"],"purpose":"清洁水源的保障"}],"trust_level":"最高（实物可见，价值直观）"},{"layer":"基础生存物资","description":"可直接消费的物品，交易时通常立即消耗。","items":[{"name":"干净的水","unit":"升","purpose":"最基础需求，长期储存困难"},{"name":"未变质食物","unit":"罐/包","types":["罐头","压缩饼干","真空食品"],"purpose":"保质期有限，但易于携带"},{"name":"保暖衣物","unit":"件","types":["睡袋","防寒服"],"purpose":"冬季或高纬度地区必需品"},{"name":"基本药品","unit":"卷/瓶","types":["绷带","酒精","创可贴"],"purpose":"处理轻伤"}],"trust_level":"中等（可能被污染或损坏）"},{"layer":"突变结晶（战略资源）","description":"从突变生物体内发现的能量结晶，是觉醒者圈层的核心通货。","items":[{"name":"下级结晶","source":"E~D级生物","drop_rate":"5%~10%","value_multiplier":1,"appearance":"淡蓝色多面体，隐约有能量流动","uses":["基础异能回复药剂","低阶稳定剂"]},{"name":"中级结晶","source":"D~C级生物","drop_rate":"<10%~30%","value_multiplier":20,"appearance":"深蓝色，内部可见流动纹理","uses":["高阶稳定剂","防止精通期代价反噬"]},{"name":"上级结晶","source":"C~B级生物","drop_rate":"30%~60%","value_multiplier":500,"appearance":"紫色或红色，表面有规则几何纹路","uses":["突破期稳定剂","高级异能增幅器"]},{"name":"顶级结晶","source":"B~S级生物/实体","drop_rate":">60%~必然","value_multiplier":20000,"appearance":"形态各异，可能呈液态或气态，影响周围时空","uses":["触及规则禁忌领域","传说级交易"]}],"special_properties":["结晶无法安全直接吸收，强行使用必致崩溃或异化","结晶散发微弱能量场，会吸引高等级掠食者","结晶可被药剂师加工为稳定剂、回复药剂，但技术仅少数势力掌握"],"trust_level":"仅限觉醒者精英圈层，普通人可能视为不祥之物"},{"layer":"旧世界遗留物","description":"奢侈品与纪念品，价值取决于交易双方的心理因素。","items":[{"name":"珠宝首饰","value_note":"在生存压力下价值极低，但在相对安全据点可用于心理慰藉"},{"name":"艺术品","value_note":"仅有收藏意义，几乎无法交换生存物资"},{"name":"书籍","value_note":"可用于引火，少数知识类书籍对求知者有价值"},{"name":"电子设备","value_note":"无电状态下如同废铁，若配有太阳能充电器则略有价值"},{"name":"酒类","value_note":"可作为麻醉剂、消毒剂或心理慰藉品"}],"trust_level":"极低，取决于买家兴趣"}],"crystal_value_benchmark":{"base_unit":"下级结晶","base_multiplier":1,"exchange_rate_note":"实际交易中因地区、供需、品质波动±30%","tiers":[{"tier":"下级结晶","value":1,"exchange_examples":["200发手枪弹 或 100发步枪弹","足够5人一周的压缩口粮与净水","一次由旧世界设备医生进行的重大外科手术","雇佣4人小队彻底探查一片半径10公里区域的情报","3-5支标准异能回复药剂（从药剂师行会兑换）"]},{"tier":"中级结晶","value":20,"exchange_examples":["20颗下级结晶（标准兑换率）","一整套精良冷兵器套装（含4人份武器、护甲）","一辆改装过的越野车（需自带燃料）","小型据点的三个月粮食补给","进入灰烬学院档案库查阅机密资料3天的权限"]},{"tier":"上级结晶","value":500,"exchange_examples":["500颗下级结晶 或 25颗中级结晶","一座小型据点的完整控制权（如锈钉集市的某个街区）","旧世界军事基地的详细地图及安全通道情报","一整支精英狩猎队（10人，含2名掌控期觉醒者）的30天雇佣合约","从暗影宫廷换取一次古老血族的“契约庇护”"]},{"tier":"顶级结晶","value":20000,"exchange_examples":["20000颗下级结晶 或 40颗上级结晶（理论值，极少实际兑换）","换取一个大型据点（如磐石堡）的永久统治权","与A级实体达成互不侵犯契约","获得一次进入旧世界最高机密设施（如51区）的机会","购买一艘可跨海航行的改装破冰船","复活一位死亡不超过24小时的人（需配合特定仪式，成功率未知）"]}]},"barter_rules":{"transaction_process":["1. 初步接触：双方保持安全距离（通常10-30米），通过喊话或手势表明交易意图。","2. 物品展示：一方将拟交换的物品放置在中间地带，然后退回；另一方上前查看，若满意则放置自己的物品，退回；第一方再上前取走。","3. 同时交换：在双方达成信任后，可约定同时将物品放在中间并各自取走。","4. 中介交易：在蜂巢集市等固定交易点，可由中立商贩提供临时托管服务（收取10-20%佣金）。"],"risks":{"fraud":"以次充好、空心物品、过期药品、隐藏陷阱等极为常见。","robbery":"交易中一方突然攻击抢夺物品，是常见风险。","ambush":"交易后尾随、袭击，夺回物品并额外掠夺。","safety_tips":"永远不要暴露全部家当，永远保留撤退路线。"},"psychology":["双方均处于高度戒备状态，任何可疑动作都可能导致交火。","表现出虚弱或急切需求会使对方抬价或生出歹意。","沉默寡言、眼神凶狠、装备精良者更容易获得“敬畏价”。"]},"regional_dynamics":{"supply_demand_factors":[{"factor":"兽潮爆发","impact":"弹药价格暴涨300%，药品需求激增"},{"factor":"异常地带扩张","impact":"周边据点结晶供应减少，结晶价值飙升"},{"factor":"寒冬来临","impact":"燃料、保暖物资价格翻倍"},{"factor":"药剂师行会活动","impact":"结晶收购价可能短期波动"},{"factor":"新遗迹被发现","impact":"旧世界工具需求增加"}],"regional_variations":[{"region":"磐石堡（堡垒城寨）","characteristics":"结晶收购价较高（因有稳定药剂师），但对外来者压价10-20%。","security_level":"高，交易相对规范"},{"region":"锈钉集市（蜂巢集市）","characteristics":"交易活跃，价格透明，但盗窃率极高。","security_level":"中低，需时刻防范"},{"region":"灰烬学院（学院前哨）","characteristics":"用知识交换物资，结晶可兑换研究权限，普通物资价格偏高。","security_level":"中高，但对外人戒备"},{"region":"游牧走廊","characteristics":"价格随行就市，与车队交易需关系维护。","security_level":"不定，取决于车队信誉"}],"risk_on_value":["携带结晶的风险：1颗中级结晶足以让一支精英掠夺队铤而走险；5颗以上可能引来C级掠食者。","“盛宴信号”：大量结晶集中出现会触发高等级生物的感知，如同黑暗中的篝火。","藏匿策略：觉醒者通常将结晶分散藏匿，交易时才取出少量。"]},"black_market":{"common_items":[{"name":"禁忌知识","examples":["异常地带规则解析","古老仪式步骤","失控觉醒者情报"]},{"name":"违禁药品","examples":["临时提升异能的危险针剂","成瘾性镇定剂"]},{"name":"活体材料","examples":["突变生物幼崽","新鲜器官（用于研究或仪式）"]},{"name":"武器改装","examples":["消音器","穿甲弹","爆炸物"]},{"name":"人口交易","note":"在极混乱区域存在，但被视为绝对禁忌"}],"special_middlemen":[{"name":"暗影宫廷","description":"可提供古老契约、血族庇护，代价通常是“一个承诺”。"},{"name":"蜕变教团","description":"以异化器官换取结晶，愿意接受“自愿改造者”作为支付。"},{"name":"游牧车队","description":"跨区域贸易，可代购稀有物资，收取20-50%差价。"}],"intelligence_trading":{"pricing":"情报价值基于准确性和时效性，通常以下级结晶计价：","examples":[{"type":"普通情报（怪物分布、天气变化）","price":"0.5~1下级结晶"},{"type":"重要情报（异常地带弱点、势力动向）","price":"2~5下级结晶"},{"type":"绝密情报（遗迹位置、霸主行踪）","price":"10~20下级结晶或等价物品"}]}},"quick_reference":{"base_item_valuation":[{"item":"手枪弹（50发）","crystal_value":0.25,"hard_currency_equiv":"1罐午餐肉"},{"item":"抗生素（1剂）","crystal_value":0.5,"hard_currency_equiv":"5发霰弹"},{"item":"完好撬棍","crystal_value":0.8,"hard_currency_equiv":"2瓶净水片"},{"item":"汽油（10升）","crystal_value":1.2,"hard_currency_equiv":"1把手枪（无弹）"},{"item":"异能回复药剂（1支）","crystal_value":1.5,"hard_currency_equiv":"50发步枪弹"},{"item":"军用帐篷","crystal_value":2,"hard_currency_equiv":"3剂抗生素"},{"item":"简易医疗包","crystal_value":0.3,"hard_currency_equiv":"1把匕首"},{"item":"旧世界地图（局部）","crystal_value":3,"hard_currency_equiv":"1颗下级结晶 + 10发子弹"}],"note":"此表为废铁平原区域均价，其他地区浮动±30%"}}}'),J=`# 数值具体表现映射\n${JSON.stringify(Q)}`,Z=["# 行动消耗参考（结合觉醒阶段）","本节用于指导行动的 HP/SP/ST/SAN 消耗。先参照“行动消耗基准表”，再按觉醒阶段进行调整，最终向整数取整。","","## 行动消耗基准表",JSON.stringify(K),"","## 阶段修正（用于对基准的乘算/加算）","- 凡人/未觉醒：×1.0（原始基准）","- 觉醒期：SP×1.5；ST×1.2；SAN基准+0~1（视紧张度），不稳定场景可再+1","- 掌控期：SP×0.85；ST×0.9；SAN不变","- 精通期：SP×0.75；ST×0.85；SAN不变","- 质变期+：SP×0.6；ST×0.8；在高危/异常场景 SAN×1.1~1.3（人性压力增大）","","## 应用规则","1. 通用行动：先读基准，再按阶段修正，最终向整数取整。","2. 异能使用：优先遵循“技能消耗规则”（百分比），需要具体点数时按上限换算后再叠加阶段修正。","3. 异常地带：与“异常地带影响”叠加后，再做阶段修正（先加后乘）。","4. 指令输出：消耗统一用 add 写当前值（如 add 角色.属性.体力.当前 = -N），禁止直接修改上限。","5. 安全阈值：若当前值将低于0，应当改为0并附加相应负面状态（力竭/疯狂/濒死）。"].join("\n"),ee=["# 混沌纪元·末世经济系统（用于定价与交易约束）",JSON.stringify(Y),"","## 使用说明（严格约束）","- 常规交易优先使用硬通货或以物易物；结晶仅用于高阶/势力/黑市交易","- 小额交易上限：≤1下级结晶等值；中额：≤5下级结晶等值；高额：≥中级结晶需充分场景与风险","- 若出现“几十个结晶”的交易，必须改写为分期/等价物或给出黑市/势力合约且明确风险与代价"].join("\n"),ne={coreRequest:{name:"核心请求提示词",description:"正常游戏请求时按顺序发送的提示词",icon:"📨"},summary:{name:"总结请求提示词",description:"记忆总结时使用的提示词",icon:"📝"},initialization:{name:"开局初始化提示词",description:"开局时世界生成和角色初始化的提示词",icon:"🚀"},generation:{name:"动态生成提示词",description:"游戏中动态生成NPC/事件/物品的提示词",icon:"🎨"},online:{name:"联机模式提示词",description:"联机模式专用的规则和限制提示词",icon:"🌐"}},te=[s,l,c,d].join("\n\n"),ae=[g,b,y,x,k,w,u,f,h,C,L,F,j,B,m,z,N,$,O].join("\n\n"),re=[p,v,_,A,S,E,T,I,R,M,P,D].join("\n\n"),oe=[X.GK,X.U5,X.Nz,X.oi].join("\n\n"),ie=[U.MC,U.qP,U.BI,U.Wt,U.K9,U.bB,Z,ee].join("\n\n");function se(){return{coreOutputRules:{name:"1. 输出格式",content:te,category:"coreRequest",description:"JSON格式、数据同步",order:1,weight:10},businessRules:{name:"2. 核心规则",content:ae,category:"coreRequest",description:"觉醒阶段、NPC、战斗规则",order:2,weight:9},playerPersonality:{name:"2.1 主角性格",content:G,category:"coreRequest",description:"默认“正常人”人设，可自定义",order:2.1,weight:6},extendedBusinessRules:{name:"2.5 扩展规则",content:re,category:"coreRequest",description:"大道、宗门等扩展",order:2.5,weight:5},dataDefinitions:{name:"3. 数据结构",content:(0,a.lS)(!1),category:"coreRequest",description:"存档结构定义",order:3,weight:10},textFormatRules:{name:"4. 文本格式",content:oe,category:"coreRequest",description:"判定、伤害、命名",order:4,weight:10},worldStandards:{name:"5. 世界标准",content:ie,category:"coreRequest",description:"觉醒阶段属性、品质",order:5,weight:9},awakeningStrengthRules:{name:"6. 觉醒阶段与难度控制",content:H,category:"coreRequest",description:"混沌纪元阶段体系与遭遇/成长/代价",order:6,weight:7},specificNarrativeMap:{name:"6.1 数值具体表现映射",content:J,category:"coreRequest",description:"按属性值(1-35)严格选择叙事句式",order:6.1,weight:8},mutantCreatureRules:{name:"7. 突变生物生成规则",content:V,category:"generation",description:"末日突变生态、威胁等级、输出JSON结构",order:7,weight:7},onlineModeRules:{name:"联机规则",content:"# 联机模式基础规则\n- 共享世界，玩家行为影响他人\n- 禁止修改世界设定/重要NPC\n- 禁止跨区域瞬移\n- 穿越消耗穿越点，受目标世界约束",category:"online",description:"联机模式限制",order:1,weight:8,condition:"onlineMode"},onlineTravelContext:{name:"穿越场景理解",content:'# 联机穿越场景 - 核心理解（CRITICAL）\n\n## 🌀 穿越者身份（玩家当前状态）\n**玩家是一个穿越者**，通过虚空裂隙从自己的世界穿越到了另一个玩家的世界。\n\n### 穿越者的特征\n1. **陌生人身份**：玩家对这个世界一无所知，这里的NPC也不认识玩家\n2. **保留记忆**：玩家保留了自己原世界的所有记忆和经历\n3. **双重世界观**：玩家知道自己来自另一个世界，但这个世界的NPC不知道"穿越"的概念\n4. **临时访客**：玩家随时可能返回原世界，或被世界主人驱逐\n\n## 🎭 玩家可能的"奇怪"行为（必须理解并合理演化）\n\n### 类型1：提到"原世界"相关内容\n玩家可能会说：\n- "我要找到原世界的玩家"\n- "我是从另一个世界来的"\n- "我的世界里有个叫XXX的人"\n- "我想回到我的世界"\n- "这里和我的世界不一样"\n\n**AI应该如何处理**：\n- ✅ NPC会觉得玩家在说胡话、疯言疯语，或者是某种隐喻\n- ✅ NPC可能认为玩家是在讲故事、做梦、或者修炼走火入魔\n- ✅ 如果玩家展示了强大实力，NPC可能会半信半疑\n- ✅ 世界继续正常演化，不会因为玩家的"奇怪话"而崩溃\n- ❌ 不要让NPC直接理解"穿越"概念（除非是特殊设定的世界）\n- ❌ 不要让NPC突然知道"联机"、"玩家"等元概念\n\n### 类型2：寻找世界主人\n玩家可能会说：\n- "这个世界的主人在哪里？"\n- "我要找到XXX（世界主人名字）"\n- "我想见见这个世界的创造者"\n\n**AI应该如何处理**：\n- ✅ 如果世界主人是NPC，可以正常引导玩家去找\n- ✅ 如果世界主人不在线，NPC不知道世界主人的位置\n- ✅ NPC可能会误解玩家的意思（比如理解为"宗主"、"城主"等）\n- ✅ 可以让玩家通过探索、打听来了解世界主人的信息\n\n### 类型3：提到游戏机制\n玩家可能会说：\n- "我的穿越点不够了"\n- "我要签到"\n- "这是联机模式"\n\n**AI应该如何处理**：\n- ✅ 完全忽略这些元游戏概念，当作玩家的自言自语\n- ✅ 继续推进正常的世界叙事\n- ✅ NPC不会对这些话做出反应（除非玩家明确对NPC说）\n\n## 🌍 世界演化原则\n\n### 原则1：世界的独立性\n- 这个世界有自己的历史、势力、NPC，不会因为玩家的到来而改变\n- 世界主人可能在某处活动，也可能不在线（离线代理）\n- 世界的事件、NPC的行为应该符合这个世界的设定\n\n### 原则2：玩家的陌生人视角\n- 玩家不知道这个世界的地理、势力、重要人物\n- 玩家需要通过探索、询问来了解这个世界\n- NPC不会主动告诉玩家"你是穿越者"相关的信息\n\n### 原则3：合理的信息差\n- 玩家知道自己是穿越者，但NPC不知道\n- 玩家可能会暴露自己的"奇怪"身份，但NPC会用自己的世界观来理解\n- 如果玩家展示了超出常理的能力，NPC会惊讶但不会突然理解"穿越"\n\n## 📝 叙事建议\n\n### 当玩家提到"原世界"时\n正确示例：\n- 【周围的修士面面相觑，似乎觉得你在说胡话】\n- "另一个世界？你是在讲故事吗？"那名修士笑道。\n- `这人莫不是修炼走火入魔了？` 那名修士心中暗想。\n\n错误示例：\n- ❌ "哦，你是穿越者啊！"（NPC不应该理解穿越概念）\n- ❌ "原来你是从联机世界来的！"（NPC不应该知道联机）\n- ❌ 【系统检测到你是穿越者】（不要暴露元信息）\n\n### 当玩家寻找世界主人时\n正确示例：\n- "你说的是XXX？他是我们宗门的长老，现在不在宗内。"\n- 【你打听到，XXX最近在闭关修炼，不见外人】\n- "世界的主人？你是说天道吗？"那名修士疑惑地看着你。\n\n### 当玩家说奇怪的话时\n正确示例：\n- 【众人沉默，似乎不知道如何回应你的话】\n- "你这话我听不懂。"那名修士摇了摇头。\n- `此人言语古怪，还是小心为上。` 那名修士心中警惕起来。\n\n## ⚠️ 严禁事项\n- ❌ 不要让NPC突然理解"穿越"、"联机"、"玩家"等元概念\n- ❌ 不要让世界因为玩家的"奇怪话"而崩溃或出现bug\n- ❌ 不要在叙事中暴露"这是游戏"的元信息\n- ❌ 不要让NPC直接说出"你是穿越者"之类的话（除非有特殊设定）\n- ❌ 不要因为玩家提到原世界就停止叙事或报错\n\n## ✅ 核心要点\n1. **玩家是穿越者**，但世界不知道\n2. **玩家可以说任何奇怪的话**，AI要能理解并合理演化\n3. **世界继续正常运转**，不会因为玩家的话而崩溃\n4. **NPC用自己的世界观理解**玩家的奇怪行为\n5. **保持叙事的连贯性**，不要突然跳出世界观',category:"online",description:"穿越场景理解与处理",order:1.5,weight:10,condition:"onlineMode"},onlineWorldSync:{name:"联机世界同步",content:"# 联机世界同步规则\n- 世界状态由服务器权威管理\n- 玩家对世界的影响需通过事件广播\n- NPC状态变更需同步到所有在场玩家\n- 大型事件需全服公告",category:"online",description:"世界同步机制",order:2,weight:7,condition:"onlineMode"},onlineInteraction:{name:"联机交互",content:"# 联机玩家交互\n- 同区域玩家可见可交互\n- 交易需双方确认\n- PVP需双方同意或特定区域\n- 组队共享部分奖励",category:"online",description:"玩家交互规则",order:3,weight:6,condition:"onlineMode"},onlineServerLogCommand:{name:"联机日志上报指令",content:'# 联机日志上报（必须执行）\n当你处于**联机穿越/入侵状态**时，你必须在本回合的 tavern_commands 末尾追加 1 条“上报日志”指令，把本回合发生的关键行为与结果提交给联机服务器，供世界主人下次上线查看。\n\n## 指令格式（必须严格照抄结构）\n{"action":"push","key":"系统.联机.服务器日志","value":{"note":"...","meta":{"tags":["..."],"poi":"...","result":"..."}}}\n\n## 约束\n- 每回合最多 1 条该指令\n- note：50-200字，客观描述“你做了什么/造成了什么影响”（移动/交互/战斗/伤害/死亡/获得/消耗/偷取等）\n- note 严禁出现：AI/提示词/指令/JSON/规则/系统后台 等元信息\n- meta 可省略；如提供必须是对象，内容要小（不要塞完整存档/长文本）\n- 该指令只用于上报日志，不用于修改任何数值/状态（数值更新仍必须用正常 tavern_commands）',category:"online",description:"让AI用指令上报联机日志",order:3.5,weight:6,condition:"onlineMode"},actionOptions:{name:"7. 行动选项",content:W,category:"coreRequest",description:"生成玩家选项",order:7,weight:6},eventSystemRules:{name:"8. 世界事件",content:q,category:"coreRequest",description:"世界事件演变与影响",order:8,weight:5,condition:"eventSystem"},splitGenerationStep1:{name:"9. 分步正文",content:'# 分步生成 1/2：仅正文\n\n## 🔴 输出格式\n{"text":"400-800字叙事正文（重要场景可到1000字）"}\n\n## ✅ JSON字符串规则（CRITICAL）\n- 只输出一个JSON对象，禁止任何前后缀文字、禁止 ``` 代码块\n- `text` 如需分段换行，用 `\\n` 表示（不要在引号内直接换行，否则JSON会解析失败）\n\n## 📖 文本格式标记 / Text Format Markers\n使用以下标记增强叙事表现力：\n- 环境描写: 【...】 (场景、天气、氛围)\n- 内心思考: `...` (NPC心理活动，非主角)\n- 角色对话: "..." (人物对话)\n- 系统判定/系统提示: 〔...〕（必须使用下面的严格格式）\n\n## 🔒 标记铁律（CRITICAL）\n- 【】只允许写环境/场景，严禁用于系统/面板：禁止【系统提示】、【系统判定】、【当前状态】、【生命值/灵气】等\n- 系统判定/状态变化必须写在 〔〕 内；禁止在正文中单独输出“系统提示/系统判定/当前状态”等标题行\n  - ✅ 〔修炼:成功,判定值:12,难度:10,基础:0,幸运:+2,环境:+5,状态:+5〕\n  - ❌ 【当前状态】生命值：95/100\n  - ❌ 系统提示：……\n\n## 📝 正文要求（必须遵守）\n1. **长度**：建议400-800字，重要场景可到1000字，不要太长！\n2. **判定系统**：战斗/成长/制造/探索/社交等场景**必须使用判定**\n3. **判定格式（必须严格遵守）**：〔类型:结果,判定值:数字,难度:数字,基础:数字,幸运:+/-数字,环境:+/-数字,状态:+/-数字〕\n   - 类型 ∈ 战斗/成长/制造/探索/社交/逃跑/感知\n   - 结果 ∈ 大失败/失败/成功/大成功/完美\n4. **叙事风格**：多描写少总结，结尾留钩子，承接上文情节（在非战斗/非危机/休整/日常/社交场景下可适度加入轻松机智的幽默点，最多1-2处；不得破坏世界观与人物立场；禁跳脱第四墙；高压/危机场景自动弱化或取消幽默）\n5. **格式标记**：合理使用【】环境、`心理`、""对话、〔〕判定\n6. **画面感配方（最低标准）**：至少1个可见动作细节+1轮"对话"或NPC内心`...`；【环境】仅在场景变化/信息必要时写1-2句（动作细节必须融入叙事，禁止写成“动作细节一/二”等编号）\n\n## ⚔️ 战斗场景特别要求\n- 每次攻防都要进行判定\n- 判定结果决定伤害和后果\n- 大失败=重伤，大成功=重创敌人\n\n## ⚠️ 严禁\n- ❌ mid_term_memory / tavern_commands / action_options 字段\n- ❌ <thinking> 标签\n- ❌ 任何指令/命令相关内容\n\n## 🔴 输出格式\n只输出：`{"text":"叙事正文内容"}`'.trim(),category:"coreRequest",description:"分步模式第1步",order:9,weight:7,condition:"splitGeneration"},splitGenerationStep2:{name:"10. 分步指令",content:'# 分步生成 2/2：仅指令\n\n## 🧭 内部自检清单（不要输出，仅用于生成指令）\n\n### 基础同步（V3短路径）- 必须全面更新！\n□ 位置变化 → set `角色.位置.描述` 或 set `角色.位置.x`/`角色.位置.y`\n□ 时间流逝 → add `元数据.时间.分钟`（修炼/闭关按实际时长）\n□ 货币变化 → add `角色.背包.货币.<币种ID>.数量`\n□ 物品增删 → set/delete `角色.背包.物品.[物品ID]`\n\n### 剧情节奏控制（铁律）\n□ 最近15回合有冲突？ → 本回合禁止任何冲突\n□ 最近30回合有战斗？ → 本回合禁止战斗场景\n□ 最近60回合有危机？ → 本回合禁止危机\n□ 最近3回合均为战斗？ → 本回合强制纯日常\n□ 最近30回合战斗次数>5？ → 接下来10回合强制纯日常\n□ 玩家状态是否允许危机（HP>70%且无重伤，SAN>50%）？ → 否则强制休整\n□ 欲触发危机时：检查因果链完整/至少提前5回合伏笔/状态允许\n\n### 修炼与突破\n□ 小阶段突破 → set `角色.身份.觉醒阶段.阶段`（初期→中期→后期→圆满→极境）\n□ 大阶段提升 → set `角色.身份.觉醒阶段.名称` + 更新属性上限 + 重新计算核心属性\n\n\n### 战斗与消耗 - 必须更新所有参与者！\n□ 施法/出招 → add `角色.属性.精神力.当前`（负，按技能消耗%）\n□ 玩家受伤 → add `角色.属性.生命值.当前`（负）\n□ NPC受伤 → add `社交.关系.[NPC名].属性.生命值.当前`（负）\n□ 理智消耗 → add `角色.属性.理智值.当前`（负）\n□ 状态效果 → push `角色.效果`（中毒/重伤/虚弱等）\n\n### NPC交互 - 必须全面更新NPC状态！\n□ NPC出场 → set `社交.关系.[NPC名]`（完整对象）\n□ 好感变化 → add `社交.关系.[NPC名].好感度`\n□ NPC记忆 → push `社交.关系.[NPC名].记忆`\n□ NPC状态 → set `社交.关系.[NPC名].当前外貌状态`\n□ NPC属性变化：生命值/精神力/理智值/觉醒阶段/位置都要更新\n\n### 世界事件与势力\n□ 重大事件 → push `社交.事件.事件记录`\n□ 势力贡献 → add `社交.势力.成员信息.贡献`\n\n## 🔴 输出格式（必须严格遵守）\n{"mid_term_memory":"50-100字摘要","tavern_commands":[{"action":"add","key":"元数据.时间.分钟","value":30}],"action_options":["选项1","选项2","选项3","选项4","选项5"]}\n\n## ✅ JSON与key规则（CRITICAL）\n- 只输出一个JSON对象，禁止任何前后缀文字、禁止 ``` 代码块\n- 字符串如需换行，用 `\\n`\n- 规则文中的 `[NPC名]` 只是占位符，输出key时必须替换成真实名称，且不要保留方括号/花括号\n- 方括号 `[]` 只有数组索引可以用：例如 `角色.效果[0]`\n- tavern_commands[*].key 必须以 `元数据.`/`角色.`/`社交.`/`世界.`/`系统.` 开头（V3短路径）\n- 必须输出严格JSON：只用英文半角标点 `" , : [ ] { }`，禁止中文引号/逗号/顿号\n\n## ⚠️ 严禁（违反将导致生成失败）\n- ❌ text 字段（正文已在第1步完成）\n- ❌ <thinking> 标签\n- ❌ JSON以外的内容\n\n## ✅ 本步骤只需要\n- mid_term_memory：摘要\n- tavern_commands：数据更新指令\n- action_options：行动选项（如启用）\n\n## 🔔 实时关注NPC\n若有NPC的`实时关注`为true，即使不在玩家身边，也要根据第1步正文推演其动态并更新'.trim(),category:"coreRequest",description:"分步模式第2步",order:10,weight:7,condition:"splitGeneration"},splitInitStep1:{name:"11. 开局正文",content:'# 开局生成 1/2：仅开局叙事\n\n## 🔴 输出格式（必须严格遵守）\n{"text":"600-1000字开局叙事，第三人称，修仙正剧风"}\n\n## ✅ JSON字符串规则（CRITICAL）\n- 只输出一个JSON对象，禁止任何前后缀文字、禁止 ``` 代码块\n- `text` 如需分段换行，用 `\\n` 表示（不要在引号内直接换行，否则JSON会解析失败）\n\n## 📖 文本格式标记 / Text Format Markers\n- 环境描写: 【...】 (场景、天气、氛围)\n- 内心思考: `...` (NPC心理活动，非主角)\n- 角色对话: "..." (人物对话)\n\n## 叙事要求\n- 开篇交代时间地点→中段展现出身处境→结尾留悬念\n- 严禁游戏术语和数据罗列\n- 合理使用【】环境描写、""对话增强表现力\n- 画面感配方（最低标准）：至少1段简短【环境】(1-2句)+2-3个可见动作细节+1-2轮对话（或1轮对话+1段NPC内心`...`）（动作细节必须融入叙事，禁止写成“动作细节一/二”等编号）\n\n## ⚠️ 严禁（违反将导致生成失败）\n- ❌ mid_term_memory 字段\n- ❌ tavern_commands 字段\n- ❌ action_options 字段\n- ❌ <thinking> 标签\n- ❌ 任何指令/命令相关内容\n\n## ✅ 本步骤只需要\n- 只输出 {"text":"..."} 这一个字段\n- text内容为纯叙事正文\n- 指令将在第2步单独生成\n\n## 🔴 再次强调输出格式\n只输出：`{"text":"开局叙事内容"}`\n禁止输出任何其他字段！'.trim(),category:"coreRequest",description:"开局分步第1步",order:11,weight:7,condition:"splitGeneration"},splitInitStep2:{name:"12. 开局指令",content:'# 开局生成 2/2：初始化数据\n\n## 🧭 内部自检清单（不要输出，仅用于生成指令）\n\n### 开局必须初始化的数据\n□ 时间：add `元数据.时间.分钟`\n□ 位置：set `角色.位置.描述` + set `角色.位置.x` + set `角色.位置.y` + 可选 set `角色.位置.区域等级`\n□ 声望：set `角色.属性.声望`\n□ 资源：add `角色.背包.货币.<币种ID>.数量`\n□ NPC：set `社交.关系.{NPC名}`（0-3个重要人物）\n\n## 🔴 输出格式（必须严格遵守）\n{"mid_term_memory":"50-100字摘要","tavern_commands":[...],"action_options":["选项1","选项2","选项3","选项4","选项5"]}\n\n## ✅ JSON与key规则（CRITICAL）\n- 只输出一个JSON对象，禁止任何前后缀文字、禁止 ``` 代码块\n- 字符串如需换行，用 `\\n`\n- 占位符 `[NPC名]` / `[道名]` 必须替换成真实名称\n- tavern_commands[*].key 必须以 `元数据.`/`角色.`/`社交.`/`世界.`/`系统.` 开头\n- 开局阶段 tavern_commands 只允许 `action: "set"` 或 `action: "add"`\n- 必须输出严格JSON：只用英文半角标点\n\n## ⚠️ 严禁\n- ❌ text 字段（正文已在第1步完成）\n- ❌ <thinking> 标签\n- ❌ JSON以外的内容'.trim(),category:"coreRequest",description:"开局分步第2步",order:12,weight:7,condition:"splitGeneration"},memorySummary:{name:"记忆总结",content:'记忆总结助手。第一人称"我"，250-400字，保留人名/地名/事件/物品/觉醒阶段，忽略对话/情绪/细节。\n输出：{"text": "总结内容"}',category:"summary",description:"中期→长期记忆",order:1,weight:6},npcMemorySummary:{name:"NPC记忆总结",content:'NPC记忆总结。第三人称，100-200字，保留关键事件和情感变化。\n输出：{"text": "总结内容"}',category:"summary",description:"NPC记忆总结",order:2,weight:5},npcGeneration:{name:"NPC生成",content:'生成混沌纪元NPC。\n核心：世界不以玩家为中心，NPC有独立生活；严禁参考玩家觉醒阶段生成"镜像NPC"或"量身对手"。\n要求：根据场景合理分布觉醒阶段（凡人/觉醒期/掌控期/精通期/质变期）、姓名性格多样化、身份决定行为。\n输出JSON：{姓名,性别,年龄,觉醒阶段:{名称,阶段},性格,外貌,背景,说话风格,当前行为,个人目标,初始好感度:50}',category:"generation",description:"动态生成NPC",order:1,weight:5},eventGeneration:{name:"事件生成",content:'生成“混沌纪元·末日初期”刚刚发生的世界事件，用于影响玩家与世界演变。要求：\n- 必须让玩家受到影响（危险/资源/关系/位置/庇护所/势力格局至少一项）\n- 事件类型参考：异常地带扩张/规则畸变、突变生物活动、资源争夺/庇护所危机、幸存者团体形成/瓦解、觉醒者风波、势力冲突、古老实体活动、世界变革\n- 涉及好友/NPC时，需参考存档的“关系/好感度/觉醒阶段”，不能无端超规格\n- 不要公告式总结，要有现场感（刚发生）\n- 世界观参考《混沌纪元设定.json》核心概念/威胁景观/派系倾向（无需复述完整文档，仅用于风格/设定一致性）\n输出JSON（不要代码块/解释/额外文本）：\n{\n  "event": {\n    "事件ID": "event_时间戳_随机数",\n    "事件名称": "string",\n    "事件类型": "异常地带|突变生物|资源争夺|庇护所危机|觉醒者风波|势力冲突|古老实体|世界变革|string",\n    "事件描述": "string",\n    "影响等级": "轻微|中等|重大|灾难",\n    "影响范围": "string",\n    "相关人物": ["string"],\n    "相关势力": ["string"],\n    "事件来源": "随机",\n    "发生时间": {"年":0,"月":1,"日":1,"小时":0,"分钟":0}\n  },\n  "prompt_addition": "一段可直接注入主叙事的事件快照（强调刚刚发生）"\n}',category:"generation",description:"混沌纪元世界事件生成",order:2,weight:5,condition:"eventSystem"},itemGeneration:{name:"物品生成",content:"生成混沌纪元物品。\n品质：破损/粗糙/普通/精良/稀有/史诗/传说。\n输出JSON：{物品ID,名称,类型,品质:{quality,grade},描述,数量,特殊效果,装备增幅,价值}",category:"generation",description:"动态生成物品",order:3,weight:5},worldGeneration:{name:"世界生成",content:o.c.buildPrompt({factionCount:5,totalLocations:10,secretRealms:3,continentCount:3}),category:"initialization",description:"生成大陆、势力、地点",order:1,weight:8},characterInit:{name:"角色初始化",content:(0,r.q5)(),category:"initialization",description:"生成角色和开场",order:2,weight:9},newbieGuide:{name:"新手引导",content:"新手引导（前3回合）。原则：自然融入叙事，不打破沉浸感，通过NPC对话传递。\n内容：行动方式/查看状态/物品使用/交流/探索。",category:"initialization",description:"自然新手引导",order:3,weight:4},textOptimization:{name:"文本优化",content:"# 文本优化助手\n\n你是一个专业的中文文学编辑，负责丰富和润色末世生存题材小说文本。\n\n## 核心要求\n**必须使用中文输出！禁止输出任何英文内容！**\n\n## 优化原则\n1. **保持原意**：不改变故事情节、人物行为、对话内容、判定结果\n2. **丰富细节**：增加环境描写、动作细节、心理活动，让场景更生动\n3. **提升文采**：使用更精准、更具画面感的末世废土风格表达\n4. **扩充内容**：在不改变原意的前提下，适当扩充描写，让文本更丰满\n5. **末日氛围**：强化废土的残酷感、生存压力、突变与代价等元素\n\n## 优化重点\n- **动作描写**：增加细节，更加生动形象（如：异能释放时的身体异化、扣动扳机时的震颤、躲避突变生物扑击的狼狈）\n- **环境描写**：增加颓废感和压迫感（如：锈蚀的钢铁废墟、扭曲的变异植物、诡异的寂静、异常地带的规则扭曲现象）\n- **对话**：保持人物性格，可适当增加语气词和神态描写（如：沙哑的嗓音、警惕的眼神、绝望的叹息）\n- **心理描写**：更加细腻深入，展现生存焦虑、对代价的恐惧、理智波动、人性挣扎\n- **感官体验**：增加视觉、听觉、触觉、嗅觉等感官描写（如：腐臭气味、金属摩擦声、晶化皮肤的麻木感、精神污染的幻听）\n\n## 禁止事项\n- ❌ 不要压缩或总结文本（要扩充，不要缩减！）\n- ❌ 不要添加新的情节或角色\n- ❌ 不要改变原有的判定结果和数值\n- ❌ 不要输出任何JSON格式内容\n- ❌ 不要添加解释、评论或元信息\n- ❌ 禁止输出英文！必须全部使用中文！\n- ❌ 禁止把“动作细节”写成编号/标题（如“动作细节一/二”）\n\n## 输出格式\n直接输出优化后的纯中文文本，不要任何额外内容。优化后的文本应该比原文更丰富、更生动、更有画面感。",category:"summary",description:"丰富润色AI生成的文本",order:3,weight:5}}}async function le(e){return await i.e.get(e)}},8275:(e,n,t)=>{"use strict";t.d(n,{A:()=>E});var a=t(641),r=t(3751),o=t(953),i=t(33),s=t(9173),l=t(6494);const c={class:"modal-header"},d={class:"modal-title"},u={class:"modal-content"},p=["innerHTML"],v=(0,a.pM)({__name:"DetailModal",setup(e){const n=(0,s.useUIStore)(),t=()=>{n.hideDetailModal()};return(e,s)=>((0,a.uX)(),(0,a.Wv)(r.eB,{name:"modal-fade"},{default:(0,a.k6)(()=>[(0,o.R1)(n).showDetailModalState?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:t},[(0,a.Lk)("div",{class:(0,i.C4)(["modal-container",(0,o.R1)(n).detailModalClass]),onClick:s[0]||(s[0]=(0,r.D$)(()=>{},["stop"]))},[(0,a.Lk)("div",c,[(0,a.Lk)("h3",d,(0,i.v_)((0,o.R1)(n).detailModalTitle),1),(0,a.Lk)("button",{class:"modal-close-button",onClick:t},[s[1]||(s[1]=(0,a.Lk)("span",null,"关闭",-1)),(0,a.bF)((0,o.R1)(l.A),{size:16})])]),(0,a.Lk)("div",u,[(0,a.Q3)(" Render component if provided "),(0,o.R1)(n).detailModalComponent?((0,a.uX)(),(0,a.Wv)((0,a.$y)((0,o.R1)(n).detailModalComponent),(0,i._B)((0,a.v6)({key:0},(0,o.R1)(n).detailModalProps)),null,16)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Q3)(" Fallback to HTML content "),(0,a.Lk)("div",{innerHTML:(0,o.R1)(n).detailModalContent},null,8,p)],2112))])],2)])):(0,a.Q3)("v-if",!0)]),_:1}))}});var f=t(5072),h=t.n(f),m=t(7825),g=t.n(m),b=t(7659),y=t.n(b),x=t(5056),k=t.n(x),w=t(540),_=t.n(w),C=t(1113),A=t.n(C),S=t(5192),L={};L.styleTagTransform=A(),L.setAttributes=k(),L.insert=y().bind(null,"head"),L.domAPI=g(),L.insertStyleElement=_(),h()(S.A,L),S.A&&S.A.locals&&S.A.locals;const E=(0,t(6262).A)(v,[["__scopeId","data-v-210f912a"]])},8381:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("scroll-text",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]])},8396:(e,n,t)=>{"use strict";t.d(n,{A:()=>p});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o),s=t(4417),l=t.n(s),c=new URL(t(7044),t.b),d=i()(r()),u=l()(c);d.push([e.id,`/*\n * 仙途 - 现代化设计系统\n * Modern Design System for XianTu\n */\n\n/* ========== 基础按钮 ========== */\n.btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  line-height: 1.5;\n  border-radius: 8px;\n  border: 1px solid transparent;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n  user-select: none;\n}\n\n.btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n.btn:focus-visible {\n  outline: 2px solid var(--color-primary);\n  outline-offset: 2px;\n}\n\n/* 按钮变体 */\n.btn-primary {\n  background: var(--color-primary);\n  color: #fff;\n  border-color: var(--color-primary);\n}\n.btn-primary:hover:not(:disabled) {\n  filter: brightness(1.1);\n  transform: translateY(-1px);\n}\n\n.btn-secondary {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border-color: var(--color-border);\n}\n.btn-secondary:hover:not(:disabled) {\n  border-color: var(--color-primary);\n  background: var(--color-background);\n}\n\n.btn-ghost {\n  background: transparent;\n  color: var(--color-text-secondary);\n  border-color: transparent;\n}\n.btn-ghost:hover:not(:disabled) {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n\n.btn-danger {\n  background: #ef4444;\n  color: #fff;\n  border-color: #ef4444;\n}\n.btn-danger:hover:not(:disabled) {\n  background: #dc2626;\n}\n\n.btn-success {\n  background: #22c55e;\n  color: #fff;\n  border-color: #22c55e;\n}\n.btn-success:hover:not(:disabled) {\n  background: #16a34a;\n}\n\n/* 按钮尺寸 */\n.btn-xs { padding: 0.25rem 0.5rem; font-size: 0.75rem; }\n.btn-sm { padding: 0.375rem 0.75rem; font-size: 0.8125rem; }\n.btn-lg { padding: 0.75rem 1.5rem; font-size: 1rem; }\n\n/* 图标按钮 */\n.btn-icon {\n  padding: 0.5rem;\n  border-radius: 8px;\n}\n.btn-icon.btn-sm { padding: 0.375rem; }\n.btn-icon.btn-xs { padding: 0.25rem; }\n\n/* ========== 表单控件 ========== */\n.input {\n  width: 100%;\n  padding: 0.625rem 0.875rem;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text);\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n\n.input:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n\n.input::placeholder {\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n\n.input:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  background: var(--color-surface);\n}\n\n/* 输入框尺寸 */\n.input-sm { padding: 0.375rem 0.625rem; font-size: 0.8125rem; }\n.input-lg { padding: 0.75rem 1rem; font-size: 1rem; }\n\n/* 选择框 */\n.select {\n  appearance: none;\n  background-image: url(${u});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 16px;\n  padding-right: 2.5rem;\n}\n\n/* 表单组 */\n.form-group {\n  margin-bottom: 1rem;\n}\n\n.form-label {\n  display: block;\n  margin-bottom: 0.375rem;\n  font-size: 0.8125rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n\n.form-hint {\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* ========== 卡片 ========== */\n.card {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n.card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n}\n\n.card-title {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n\n.card-body {\n  padding: 1.25rem;\n}\n\n.card-footer {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  padding: 1rem 1.25rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n\n/* 卡片变体 */\n.card-flat {\n  border: none;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.card-interactive {\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.card-interactive:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n/* ========== 标签页 ========== */\n.tabs {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n.tabs-list {\n  display: flex;\n  gap: 0.25rem;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n}\n\n.tab-trigger {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n  background: transparent;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.tab-trigger:hover {\n  background: var(--color-background);\n  color: var(--color-text);\n}\n\n.tab-trigger[data-state="active"],\n.tab-trigger.active {\n  background: var(--color-primary);\n  color: #fff;\n}\n\n.tabs-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1rem;\n}\n\n/* ========== 徽章 ========== */\n.badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.125rem 0.5rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n  line-height: 1.5;\n  border-radius: 9999px;\n  white-space: nowrap;\n}\n\n.badge-default {\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n}\n\n.badge-primary {\n  background: rgba(var(--color-primary-rgb), 0.15);\n  color: var(--color-primary);\n}\n\n.badge-success {\n  background: rgba(34, 197, 94, 0.15);\n  color: #22c55e;\n}\n\n.badge-warning {\n  background: rgba(245, 158, 11, 0.15);\n  color: #f59e0b;\n}\n\n.badge-danger {\n  background: rgba(239, 68, 68, 0.15);\n  color: #ef4444;\n}\n\n.badge-info {\n  background: rgba(59, 130, 246, 0.15);\n  color: #3b82f6;\n}\n\n/* ========== 统计卡片 ========== */\n.stat-card {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem 1.25rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n}\n\n.stat-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n}\n\n.stat-content {\n  flex: 1;\n}\n\n.stat-value {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  line-height: 1.2;\n}\n\n.stat-label {\n  font-size: 0.8125rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.125rem;\n}\n\n/* ========== 列表项 ========== */\n.list-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.list-item:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface);\n}\n\n.list-item.active {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n\n.list-item-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border-radius: 8px;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n}\n\n.list-item-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.list-item-title {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.list-item-subtitle {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.125rem;\n}\n\n.list-item-action {\n  color: var(--color-text-secondary);\n}\n\n/* ========== 空状态 ========== */\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 1.5rem;\n  text-align: center;\n}\n\n.empty-icon {\n  color: var(--color-text-secondary);\n  opacity: 0.4;\n  margin-bottom: 1rem;\n}\n\n.empty-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.5rem;\n}\n\n.empty-description {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  max-width: 300px;\n}\n\n.empty-actions {\n  display: flex;\n  gap: 0.75rem;\n  margin-top: 1.5rem;\n}\n\n/* ========== 分割线 ========== */\n.divider {\n  height: 1px;\n  background: var(--color-border);\n  margin: 1rem 0;\n}\n\n.divider-vertical {\n  width: 1px;\n  height: auto;\n  align-self: stretch;\n  margin: 0 0.75rem;\n}\n\n/* ========== 工具类 ========== */\n.text-muted { color: var(--color-text-secondary); }\n.text-primary { color: var(--color-primary); }\n.text-success { color: #22c55e; }\n.text-warning { color: #f59e0b; }\n.text-danger { color: #ef4444; }\n\n.font-medium { font-weight: 500; }\n.font-semibold { font-weight: 600; }\n.font-bold { font-weight: 700; }\n\n.text-xs { font-size: 0.75rem; }\n.text-sm { font-size: 0.875rem; }\n.text-base { font-size: 1rem; }\n.text-lg { font-size: 1.125rem; }\n\n.flex { display: flex; }\n.flex-col { flex-direction: column; }\n.items-center { align-items: center; }\n.justify-between { justify-content: space-between; }\n.gap-1 { gap: 0.25rem; }\n.gap-2 { gap: 0.5rem; }\n.gap-3 { gap: 0.75rem; }\n.gap-4 { gap: 1rem; }\n\n/* ========== 动画 ========== */\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes slideUp {\n  from { opacity: 0; transform: translateY(10px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.5; }\n}\n\n.animate-fadeIn { animation: fadeIn 0.2s ease; }\n.animate-slideUp { animation: slideUp 0.3s ease; }\n.animate-pulse { animation: pulse 2s infinite; }\n\n/* ========== 滚动条 ========== */\n.scrollbar-thin {\n  scrollbar-width: thin;\n  scrollbar-color: var(--color-border) transparent;\n}\n\n.scrollbar-thin::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.scrollbar-thin::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.scrollbar-thin::-webkit-scrollbar-thumb {\n  background: var(--color-border);\n  border-radius: 3px;\n}\n\n.scrollbar-thin::-webkit-scrollbar-thumb:hover {\n  background: var(--color-text-secondary);\n}\n\n`,""]);const p=d},8470:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-01a0fb92] {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content[data-v-01a0fb92] {\n  background: var(--color-background);\n  border-radius: 12px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  max-width: 500px;\n  width: 90%;\n  max-height: 80vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.modal-header[data-v-01a0fb92] {\n  padding: 1.5rem 1.5rem 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.modal-header h3[data-v-01a0fb92] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-01a0fb92] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 6px;\n  transition: all 0.2s;\n}\n.close-btn[data-v-01a0fb92]:hover {\n  background: var(--color-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-01a0fb92] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n}\n.form-group[data-v-01a0fb92] {\n  margin-bottom: 1rem;\n}\n.form-group label[data-v-01a0fb92] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.form-input[data-v-01a0fb92] {\n  width: 100%;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  outline: none;\n  transition: border-color 0.2s;\n}\n.form-input[data-v-01a0fb92]:focus {\n  border-color: var(--color-primary);\n}\n.form-textarea[data-v-01a0fb92] {\n  width: 100%;\n  min-height: 150px;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  font-family: 'Consolas', 'Monaco', monospace;\n  outline: none;\n  transition: border-color 0.2s;\n  resize: vertical;\n}\n.form-textarea[data-v-01a0fb92]:focus {\n  border-color: var(--color-primary);\n}\n.form-hint-text[data-v-01a0fb92] {\n  margin: 0.25rem 0 0 0;\n  font-size: 0.75rem;\n  color: var(--color-info);\n}\n.value-type-selector[data-v-01a0fb92] {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.75rem;\n  flex-wrap: wrap;\n}\n.type-btn[data-v-01a0fb92] {\n  padding: 0.375rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 0.75rem;\n  transition: all 0.2s;\n}\n.type-btn[data-v-01a0fb92]:hover {\n  background: var(--color-hover);\n  border-color: var(--color-primary);\n  color: var(--color-text);\n}\n.type-btn.active[data-v-01a0fb92] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n  font-weight: 500;\n}\n.form-textarea.has-error[data-v-01a0fb92] {\n  border-color: var(--color-danger);\n}\n.error-message[data-v-01a0fb92] {\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid var(--color-danger);\n  border-radius: 4px;\n  color: var(--color-danger);\n  font-size: 0.75rem;\n}\n.form-hint[data-v-01a0fb92] {\n  margin-top: 0.5rem;\n}\n.form-hint p[data-v-01a0fb92] {\n  margin: 0;\n  font-size: 0.75rem;\n  color: var(--color-success);\n}\n.preview-section[data-v-01a0fb92] {\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n}\n.preview-section label[data-v-01a0fb92] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.preview-content[data-v-01a0fb92] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.75rem;\n  font-family: 'Consolas', 'Monaco', monospace;\n  max-height: 150px;\n  overflow: auto;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.modal-footer[data-v-01a0fb92] {\n  padding: 1rem 1.5rem;\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n}\n.cancel-btn[data-v-01a0fb92] {\n  padding: 0.75rem 1.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.cancel-btn[data-v-01a0fb92]:hover {\n  background: var(--color-hover);\n  border-color: var(--color-text-secondary);\n  color: var(--color-text);\n}\n.save-btn[data-v-01a0fb92] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: var(--color-primary);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  cursor: pointer;\n  font-size: 0.875rem;\n  font-weight: 500;\n  transition: all 0.2s;\n}\n.save-btn[data-v-01a0fb92]:hover:not(:disabled) {\n  background: var(--color-primary-hover);\n  transform: translateY(-1px);\n}\n.save-btn[data-v-01a0fb92]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n",""]);const s=i},8537:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-594e2d00] {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content[data-v-594e2d00] {\n  background: var(--color-background);\n  border-radius: 12px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  max-width: 500px;\n  width: 90%;\n  max-height: 80vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.modal-content.stats-modal[data-v-594e2d00] {\n  max-width: 600px;\n}\n.modal-header[data-v-594e2d00] {\n  padding: 1.5rem 1.5rem 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.modal-header h3[data-v-594e2d00] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-594e2d00] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 6px;\n  transition: all 0.2s;\n}\n.close-btn[data-v-594e2d00]:hover {\n  background: var(--color-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-594e2d00] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n}\n.stats-grid[data-v-594e2d00] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  margin-bottom: 2rem;\n}\n.stat-card[data-v-594e2d00] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s;\n}\n.stat-card[data-v-594e2d00]:hover {\n  background: var(--color-hover);\n  border-color: var(--color-primary);\n}\n.stat-icon[data-v-594e2d00] {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.stat-icon.core[data-v-594e2d00] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n}\n.stat-icon.global[data-v-594e2d00] {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n}\n.stat-icon.memory[data-v-594e2d00] {\n  background: rgba(168, 85, 247, 0.1);\n  color: #a855f7;\n}\n.stat-icon.world[data-v-594e2d00] {\n  background: rgba(245, 158, 11, 0.1);\n  color: #f59e0b;\n}\n.stat-info[data-v-594e2d00] {\n  flex: 1;\n}\n.stat-value[data-v-594e2d00] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 0.25rem;\n}\n.stat-label[data-v-594e2d00] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.data-size-info[data-v-594e2d00] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.data-size-info h4[data-v-594e2d00] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.95rem;\n  color: var(--color-text);\n}\n.size-list[data-v-594e2d00] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.size-item[data-v-594e2d00] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid var(--color-border);\n}\n.size-item[data-v-594e2d00]:last-child {\n  border-bottom: none;\n}\n.size-item span[data-v-594e2d00]:first-child {\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n}\n.size-item span[data-v-594e2d00]:last-child {\n  color: var(--color-text);\n  font-weight: 500;\n  font-size: 0.875rem;\n}\n",""]);const s=i},8546:(e,n,t)=>{"use strict";function a(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("local")?(console.log("[后端配置] 开发模式：使用webpack代理"),""):function(e){let n=e.trim();return n?(n=n.replace(/\/api\/v1\/?$/i,""),n=n.replace(/\/+$/,""),n):""}("https://back.ddct.top")}function r(){return!("localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&!window.location.hostname.includes("local")&&!a())}function o(e){const n=a(),t=e.startsWith("/")?e:`/${e}`;return n?`${n}${t}`:t}async function i(){try{const e=o("/api/v1/version"),n=await fetch(e,{method:"GET"});if(!n.ok)return null;const t=await n.json();if(t&&void 0!==t.version)return String(t.version)}catch{return null}return null}t.d(n,{d9:()=>i,isBackendConfigured:()=>r,mh:()=>o})},8636:(e,n,t)=>{"use strict";var a=t(920),r=t(7720),o=t(4765),i=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,n){return e+"["+n+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,d=function(e,n){c.apply(e,l(n)?n:[n])},u=Date.prototype.toISOString,p=o.default,v={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:r.encode,encodeValuesOnly:!1,format:p,formatter:o.formatters[p],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},f={},h=function e(n,t,o,i,s,c,u,p,h,m,g,b,y,x,k,w,_,C){for(var A,S=n,L=C,E=0,T=!1;void 0!==(L=L.get(f))&&!T;){var I=L.get(n);if(E+=1,void 0!==I){if(I===E)throw new RangeError("Cyclic object value");T=!0}void 0===L.get(f)&&(E=0)}if("function"==typeof m?S=m(t,S):S instanceof Date?S=y(S):"comma"===o&&l(S)&&(S=r.maybeMap(S,function(e){return e instanceof Date?y(e):e})),null===S){if(c)return h&&!w?h(t,v.encoder,_,"key",x):t;S=""}if("string"==typeof(A=S)||"number"==typeof A||"boolean"==typeof A||"symbol"==typeof A||"bigint"==typeof A||r.isBuffer(S))return h?[k(w?t:h(t,v.encoder,_,"key",x))+"="+k(h(S,v.encoder,_,"value",x))]:[k(t)+"="+k(String(S))];var R,M=[];if(void 0===S)return M;if("comma"===o&&l(S))w&&h&&(S=r.maybeMap(S,h)),R=[{value:S.length>0?S.join(",")||null:void 0}];else if(l(m))R=m;else{var P=Object.keys(S);R=g?P.sort(g):P}var D=p?t.replace(/\./g,"%2E"):t,z=i&&l(S)&&1===S.length?D+"[]":D;if(s&&l(S)&&0===S.length)return z+"[]";for(var N=0;N<R.length;++N){var $=R[N],O="object"==typeof $&&void 0!==$.value?$.value:S[$];if(!u||null!==O){var F=b&&p?$.replace(/\./g,"%2E"):$,j=l(S)?"function"==typeof o?o(z,F):z:z+(b?"."+F:"["+F+"]");C.set(n,E);var B=a();B.set(f,C),d(M,e(O,j,o,i,s,c,u,p,"comma"===o&&w&&l(S)?null:h,m,g,b,y,x,k,w,_,B))}}return M};e.exports=function(e,n){var t,r=e,c=function(e){if(!e)return v;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var n=e.charset||v.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=o.default;if(void 0!==e.format){if(!i.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");t=e.format}var a,r=o.formatters[t],c=v.filter;if(("function"==typeof e.filter||l(e.filter))&&(c=e.filter),a=e.arrayFormat in s?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":v.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var d=void 0===e.allowDots?!0===e.encodeDotInKeys||v.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:v.addQueryPrefix,allowDots:d,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:v.allowEmptyArrays,arrayFormat:a,charset:n,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:v.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?v.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:v.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:v.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:v.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:v.encodeValuesOnly,filter:c,format:t,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:v.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:v.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:v.strictNullHandling}}(n);"function"==typeof c.filter?r=(0,c.filter)("",r):l(c.filter)&&(t=c.filter);var u=[];if("object"!=typeof r||null===r)return"";var p=s[c.arrayFormat],f="comma"===p&&c.commaRoundTrip;t||(t=Object.keys(r)),c.sort&&t.sort(c.sort);for(var m=a(),g=0;g<t.length;++g){var b=t[g];c.skipNulls&&null===r[b]||d(u,h(r[b],b,p,f,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,m))}var y=u.join(c.delimiter),x=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),y.length>0?x+y:""}},8648:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},8651:(e,n,t)=>{"use strict";t.r(n),t.d(n,{clearAllCharacterData:()=>c,getCurrentCharacterName:()=>l,getTavernHelper:()=>s,isTavernEnv:()=>i});var a=t(7445);function r(e){const n=e;return Boolean(n?.TavernHelper)||"function"==typeof n?.eventOn&&"function"==typeof n?.eventOff}function o(){if("undefined"==typeof window)return null;const e=function(){try{return"1"===localStorage.getItem("dad_debug_tavern")}catch{return!1}}();if(e&&(console.log("[Tavern检测] 开始查找 TavernHelper..."),console.log("[Tavern检测] 当前window.location:",window.location.href)),window.TavernHelper)return e&&console.log("[Tavern检测] ✅ 在当前window找到TavernHelper"),window.TavernHelper;try{if(e&&console.log("[Tavern检测] 尝试访问window.top..."),window.top&&window.top!==window){if(e&&console.log("[Tavern检测] window.top可访问，检查TavernHelper..."),window.top.TavernHelper)return e&&console.log("[Tavern检测] ✅ 在window.top找到TavernHelper"),window.top.TavernHelper;e&&console.log("[Tavern检测] window.top没有TavernHelper")}}catch(n){e&&console.log("[Tavern检测] ⚠️ 访问window.top失败（跨域）:",n)}let n=window;for(let t=0;t<5;t++)try{if(!n.parent||n.parent===n){e&&console.log(`[Tavern检测] 已到达顶层（第${t+1}层）`);break}if(e&&console.log(`[Tavern检测] 检查第${t+1}层parent...`),n.parent.TavernHelper)return e&&console.log(`[Tavern检测] ✅ 在第${t+1}层parent找到TavernHelper`),n.parent.TavernHelper;e&&console.log(`[Tavern检测] 第${t+1}层parent没有TavernHelper，继续向上`),n=n.parent}catch(n){e&&console.log(`[Tavern检测] ⚠️ 访问第${t+1}层parent失败（跨域）:`,n);break}return e&&console.log("[Tavern检测] ❌ 未找到TavernHelper"),null}function i(){return!!o()||function(){if("undefined"==typeof window)return!1;if(r(window))return!0;try{if(window.top&&window.top!==window&&r(window.top))return!0}catch{}let e=window;for(let n=0;n<5;n++)try{if(!e.parent||e.parent===e)break;if(r(e.parent))return!0;e=e.parent}catch{break}return!1}()}function s(){return{generate:async e=>await a.aiService.generate(e),generateRaw:async e=>await a.aiService.generateRaw(e),getVariables:async e=>{const n=o();return n?await n.getVariables(e):{}},insertOrAssignVariables:async(e,n)=>{const t=o();if(t)return await t.insertOrAssignVariables(e,n)}}}async function l(){const e=s();if(!e)return null;try{const n=await e.getVariables({type:"global"});return n["persona.name"]||n.name||null}catch(e){return console.warn("[Tavern] 无法获取角色名:",e),null}}async function c(){const e=s();if(e){try{await e.insertOrAssignVariables({},{type:"global"})}catch(e){throw console.error("[Tavern] 清除酒馆变量失败:",e),e}try{const{vectorMemoryService:e}=await Promise.resolve().then(t.bind(t,5184));e&&(await e.clear(),console.log("[Tavern] 向量记忆已清理"))}catch(e){console.warn("[Tavern] 清理向量记忆失败（非致命）:",e)}}else console.warn("[Tavern] 酒馆助手不可用，跳过清理")}},8664:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.legacy-modal-overlay[data-v-372dd904] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(6px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10050;\n  padding: 1rem;\n}\n.legacy-modal[data-v-372dd904] {\n  width: 100%;\n  max-width: 860px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 14px 40px rgba(0, 0, 0, 0.35);\n}\n.legacy-modal-header[data-v-372dd904] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.9rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.title[data-v-372dd904] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-weight: 700;\n}\n.icon-btn[data-v-372dd904] {\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  padding: 0.25rem;\n  border-radius: 8px;\n}\n.icon-btn[data-v-372dd904]:hover {\n  background: rgba(255, 255, 255, 0.06);\n  color: var(--color-text);\n}\n.legacy-modal-body[data-v-372dd904] {\n  padding: 1rem;\n}\n.hint[data-v-372dd904] {\n  margin: 0 0 0.75rem;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  line-height: 1.5;\n}\n.file-row[data-v-372dd904] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.file-name[data-v-372dd904] {\n  font-size: 0.9rem;\n  color: var(--color-text);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.file-name.muted[data-v-372dd904] {\n  color: var(--color-text-secondary);\n}\n.result[data-v-372dd904] {\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 0.9rem;\n  background: rgba(255, 255, 255, 0.02);\n}\n.summary-grid[data-v-372dd904] {\n  display: grid;\n  grid-template-columns: repeat(4, minmax(0, 1fr));\n  gap: 0.6rem;\n  margin-bottom: 0.75rem;\n}\n.kv[data-v-372dd904] {\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 0.6rem 0.7rem;\n  background: rgba(0, 0, 0, 0.12);\n}\n.k[data-v-372dd904] {\n  display: block;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.v[data-v-372dd904] {\n  display: block;\n  font-weight: 700;\n  margin-top: 0.15rem;\n}\n.details[data-v-372dd904] {\n  margin-top: 0.6rem;\n}\n.chips[data-v-372dd904] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.35rem;\n  margin-top: 0.5rem;\n}\n.chip[data-v-372dd904] {\n  border: 1px solid var(--color-border);\n  padding: 0.2rem 0.5rem;\n  border-radius: 999px;\n  font-size: 0.8rem;\n}\n.errors[data-v-372dd904] {\n  margin: 0.5rem 0 0;\n  padding-left: 1.1rem;\n  color: #ffb4b4;\n}\n.json-preview[data-v-372dd904] {\n  margin: 0.5rem 0 0;\n  max-height: 220px;\n  overflow: auto;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  font-size: 0.8rem;\n}\n.legacy-modal-actions[data-v-372dd904] {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  padding: 0.9rem 1rem;\n  border-top: 1px solid var(--color-border);\n}\n.btn[data-v-372dd904] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.55rem 0.8rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-primary);\n  color: #fff;\n  cursor: pointer;\n  font-size: 0.9rem;\n}\n.btn[data-v-372dd904]:disabled {\n  opacity: 0.45;\n  cursor: not-allowed;\n}\n.btn.btn-secondary[data-v-372dd904] {\n  background: transparent;\n  color: var(--color-text);\n}\n.btn.btn-secondary[data-v-372dd904]:hover {\n  background: rgba(255, 255, 255, 0.06);\n}\n@media (max-width: 760px) {\n.summary-grid[data-v-372dd904] {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n}\n}\n",""]);const s=i},8684:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8693:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-8054cec0] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-8054cec0] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 500px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-8054cec0 0.3s ease-out;\n}\n@keyframes slideUp-8054cec0 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-8054cec0] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-8054cec0] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-8054cec0] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-8054cec0]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-8054cec0] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n.form-group[data-v-8054cec0] {\n  margin-bottom: 1.5rem;\n}\n.form-label[data-v-8054cec0] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.required[data-v-8054cec0] {\n  color: var(--color-danger);\n}\n.optional[data-v-8054cec0] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: normal;\n}\n.form-input[data-v-8054cec0],\n.form-textarea[data-v-8054cec0] {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.9rem;\n  font-family: inherit;\n  transition: all 0.2s ease;\n  box-sizing: border-box;\n}\n.form-input[data-v-8054cec0]:focus,\n.form-textarea[data-v-8054cec0]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.form-textarea[data-v-8054cec0] {\n  resize: vertical;\n  min-height: 80px;\n}\n.char-count[data-v-8054cec0] {\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  text-align: right;\n}\n.preset-preview[data-v-8054cec0] {\n  padding: 1rem;\n  background: rgba(var(--color-accent-rgb), 0.05);\n  border: 1px solid rgba(var(--color-accent-rgb), 0.15);\n  border-radius: 8px;\n  margin-top: 1rem;\n}\n.preview-header[data-v-8054cec0] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.75rem;\n}\n.preview-tags[data-v-8054cec0] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.info-tag[data-v-8054cec0] {\n  padding: 0.3rem 0.7rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.75rem;\n  color: var(--color-primary);\n}\n.info-tag.talent-tag[data-v-8054cec0] {\n  background: rgba(var(--color-accent-rgb), 0.1);\n  border-color: rgba(var(--color-accent-rgb), 0.3);\n  color: var(--color-accent);\n  font-weight: 500;\n}\n.preset-info[data-v-8054cec0] {\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 6px;\n  margin-top: 1rem;\n}\n.info-item[data-v-8054cec0] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.85rem;\n}\n.info-label[data-v-8054cec0] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-8054cec0] {\n  color: var(--color-text);\n  font-family: 'Monaco', 'Courier New', monospace;\n}\n.modal-footer[data-v-8054cec0] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-8054cec0] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-8054cec0] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-8054cec0]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-8054cec0] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-8054cec0]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-8054cec0]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-8054cec0] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-8054cec0] {\n    padding: 1rem;\n}\n.modal-title[data-v-8054cec0] {\n    font-size: 1.1rem;\n}\n.modal-content[data-v-8054cec0] {\n    padding: 1rem;\n}\n.form-group[data-v-8054cec0] {\n    margin-bottom: 1rem;\n}\n.modal-footer[data-v-8054cec0] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-8054cec0] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},8835:(e,n,t)=>{"use strict";var a=t(1270);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var o=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),d=["%","/","?",";","#"].concat(c),u=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,v=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},h={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=t(5373);function b(e,n,t){if(e&&"object"==typeof e&&e instanceof r)return e;var a=new r;return a.parse(e,n,t),a}r.prototype.parse=function(e,n,t){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",l=e.split(i);l[0]=l[0].replace(/\\/g,"/");var b=e=l.join(i);if(b=b.trim(),!t&&1===e.split("#").length){var y=s.exec(b);if(y)return this.path=b,this.href=b,this.pathname=y[1],y[2]?(this.search=y[2],this.query=n?g.parse(this.search.substr(1)):this.search.substr(1)):n&&(this.search="",this.query={}),this}var x=o.exec(b);if(x){var k=(x=x[0]).toLowerCase();this.protocol=k,b=b.substr(x.length)}if(t||x||b.match(/^\/\/[^@/]+@[^@/]+/)){var w="//"===b.substr(0,2);!w||x&&h[x]||(b=b.substr(2),this.slashes=!0)}if(!h[x]&&(w||x&&!m[x])){for(var _,C,A=-1,S=0;S<u.length;S++)-1!==(L=b.indexOf(u[S]))&&(-1===A||L<A)&&(A=L);for(-1!==(C=-1===A?b.lastIndexOf("@"):b.lastIndexOf("@",A))&&(_=b.slice(0,C),b=b.slice(C+1),this.auth=decodeURIComponent(_)),A=-1,S=0;S<d.length;S++){var L;-1!==(L=b.indexOf(d[S]))&&(-1===A||L<A)&&(A=L)}-1===A&&(A=b.length),this.host=b.slice(0,A),b=b.slice(A),this.parseHost(),this.hostname=this.hostname||"";var E="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!E)for(var T=this.hostname.split(/\./),I=(S=0,T.length);S<I;S++){var R=T[S];if(R&&!R.match(p)){for(var M="",P=0,D=R.length;P<D;P++)R.charCodeAt(P)>127?M+="x":M+=R[P];if(!M.match(p)){var z=T.slice(0,S),N=T.slice(S+1),$=R.match(v);$&&(z.push($[1]),N.unshift($[2])),N.length&&(b="/"+N.join(".")+b),this.hostname=z.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=a.toASCII(this.hostname));var O=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+O,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!f[k])for(S=0,I=c.length;S<I;S++){var j=c[S];if(-1!==b.indexOf(j)){var B=encodeURIComponent(j);B===j&&(B=escape(j)),b=b.split(j).join(B)}}var X=b.indexOf("#");-1!==X&&(this.hash=b.substr(X),b=b.slice(0,X));var U=b.indexOf("?");if(-1!==U?(this.search=b.substr(U),this.query=b.substr(U+1),n&&(this.query=g.parse(this.query)),b=b.slice(0,U)):n&&(this.search="",this.query={}),b&&(this.pathname=b),m[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){O=this.pathname||"";var W=this.search||"";this.path=O+W}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var n=this.protocol||"",t=this.pathname||"",a=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(o=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var i=this.search||o&&"?"+o||"";return n&&":"!==n.substr(-1)&&(n+=":"),this.slashes||(!n||m[n])&&!1!==r?(r="//"+(r||""),t&&"/"!==t.charAt(0)&&(t="/"+t)):r||(r=""),a&&"#"!==a.charAt(0)&&(a="#"+a),i&&"?"!==i.charAt(0)&&(i="?"+i),n+r+(t=t.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+a},r.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if("string"==typeof e){var n=new r;n.parse(e,!1,!0),e=n}for(var t=new r,a=Object.keys(this),o=0;o<a.length;o++){var i=a[o];t[i]=this[i]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),l=0;l<s.length;l++){var c=s[l];"protocol"!==c&&(t[c]=e[c])}return m[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!m[e.protocol]){for(var d=Object.keys(e),u=0;u<d.length;u++){var p=d[u];t[p]=e[p]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||h[e.protocol])t.pathname=e.pathname;else{for(var v=(e.pathname||"").split("/");v.length&&!(e.host=v.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==v[0]&&v.unshift(""),v.length<2&&v.unshift(""),t.pathname=v.join("/")}if(t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,t.pathname||t.search){var f=t.pathname||"",g=t.search||"";t.path=f+g}return t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var b=t.pathname&&"/"===t.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),x=y||b||t.host&&e.pathname,k=x,w=t.pathname&&t.pathname.split("/")||[],_=(v=e.pathname&&e.pathname.split("/")||[],t.protocol&&!m[t.protocol]);if(_&&(t.hostname="",t.port=null,t.host&&(""===w[0]?w[0]=t.host:w.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===v[0]?v[0]=e.host:v.unshift(e.host)),e.host=null),x=x&&(""===v[0]||""===w[0])),y)t.host=e.host||""===e.host?e.host:t.host,t.hostname=e.hostname||""===e.hostname?e.hostname:t.hostname,t.search=e.search,t.query=e.query,w=v;else if(v.length)w||(w=[]),w.pop(),w=w.concat(v),t.search=e.search,t.query=e.query;else if(null!=e.search)return _&&(t.host=w.shift(),t.hostname=t.host,(E=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"))&&(t.auth=E.shift(),t.hostname=E.shift(),t.host=t.hostname)),t.search=e.search,t.query=e.query,null===t.pathname&&null===t.search||(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t;if(!w.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var C=w.slice(-1)[0],A=(t.host||e.host||w.length>1)&&("."===C||".."===C)||""===C,S=0,L=w.length;L>=0;L--)"."===(C=w[L])?w.splice(L,1):".."===C?(w.splice(L,1),S++):S&&(w.splice(L,1),S--);if(!x&&!k)for(;S--;S)w.unshift("..");!x||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),A&&"/"!==w.join("/").substr(-1)&&w.push("");var E,T=""===w[0]||w[0]&&"/"===w[0].charAt(0);return _&&(t.hostname=T?"":w.length?w.shift():"",t.host=t.hostname,(E=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"))&&(t.auth=E.shift(),t.hostname=E.shift(),t.host=t.hostname)),(x=x||t.host&&w.length)&&!T&&w.unshift(""),w.length>0?t.pathname=w.join("/"):(t.pathname=null,t.path=null),null===t.pathname&&null===t.search||(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},r.prototype.parseHost=function(){var e=this.host,n=i.exec(e);n&&(":"!==(n=n[0])&&(this.port=n.substr(1)),e=e.substr(0,e.length-n.length)),e&&(this.hostname=e)},n.qg=b,n.hd=function(e,n){return b(e,!1,!0).resolve(n)},n.GP=function(e){return"string"==typeof e&&(e=b(e)),e instanceof r?e.format():r.prototype.format.call(e)}},8859:(e,n,t)=>{var a="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=a&&r&&"function"==typeof r.get?r.get:null,i=a&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,d=s&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,v="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,h=Object.prototype.toString,m=Function.prototype.toString,g=String.prototype.match,b=String.prototype.slice,y=String.prototype.replace,x=String.prototype.toUpperCase,k=String.prototype.toLowerCase,w=RegExp.prototype.test,_=Array.prototype.concat,C=Array.prototype.join,A=Array.prototype.slice,S=Math.floor,L="function"==typeof BigInt?BigInt.prototype.valueOf:null,E=Object.getOwnPropertySymbols,T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,I="function"==typeof Symbol&&"object"==typeof Symbol.iterator,R="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,M=Object.prototype.propertyIsEnumerable,P=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function D(e,n){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||w.call(/e/,n))return n;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var a=e<0?-S(-e):S(e);if(a!==e){var r=String(a),o=b.call(n,r.length+1);return y.call(r,t,"$&_")+"."+y.call(y.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return y.call(n,t,"$&_")}var z=t(2634),N=z.custom,$=q(N)?N:null,O={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function j(e,n,t){var a=t.quoteStyle||n,r=O[a];return r+e+r}function B(e){return y.call(String(e),/"/g,"&quot;")}function X(e){return!R||!("object"==typeof e&&(R in e||void 0!==e[R]))}function U(e){return"[object Array]"===V(e)&&X(e)}function W(e){return"[object RegExp]"===V(e)&&X(e)}function q(e){if(I)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!T)return!1;try{return T.call(e),!0}catch(e){}return!1}e.exports=function e(n,a,r,s){var l=a||{};if(H(l,"quoteStyle")&&!H(O,l.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(H(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var h=!H(l,"customInspect")||l.customInspect;if("boolean"!=typeof h&&"symbol"!==h)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(H(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(H(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=l.numericSeparator;if(void 0===n)return"undefined";if(null===n)return"null";if("boolean"==typeof n)return n?"true":"false";if("string"==typeof n)return K(n,l);if("number"==typeof n){if(0===n)return 1/0/n>0?"0":"-0";var w=String(n);return x?D(n,w):w}if("bigint"==typeof n){var S=String(n)+"n";return x?D(n,S):S}var E=void 0===l.depth?5:l.depth;if(void 0===r&&(r=0),r>=E&&E>0&&"object"==typeof n)return U(n)?"[Array]":"[Object]";var N,F=function(e,n){var t;if("\t"===e.indent)t="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;t=C.call(Array(e.indent+1)," ")}return{base:t,prev:C.call(Array(n+1),t)}}(l,r);if(void 0===s)s=[];else if(Q(s,n)>=0)return"[Circular]";function G(n,t,a){if(t&&(s=A.call(s)).push(t),a){var o={depth:l.depth};return H(l,"quoteStyle")&&(o.quoteStyle=l.quoteStyle),e(n,o,r+1,s)}return e(n,l,r+1,s)}if("function"==typeof n&&!W(n)){var Y=function(e){if(e.name)return e.name;var n=g.call(m.call(e),/^function\s*([\w$]+)/);return n?n[1]:null}(n),ae=te(n,G);return"[Function"+(Y?": "+Y:" (anonymous)")+"]"+(ae.length>0?" { "+C.call(ae,", ")+" }":"")}if(q(n)){var re=I?y.call(String(n),/^(Symbol\(.*\))_[^)]*$/,"$1"):T.call(n);return"object"!=typeof n||I?re:J(re)}if((N=n)&&"object"==typeof N&&("undefined"!=typeof HTMLElement&&N instanceof HTMLElement||"string"==typeof N.nodeName&&"function"==typeof N.getAttribute)){for(var oe="<"+k.call(String(n.nodeName)),ie=n.attributes||[],se=0;se<ie.length;se++)oe+=" "+ie[se].name+"="+j(B(ie[se].value),"double",l);return oe+=">",n.childNodes&&n.childNodes.length&&(oe+="..."),oe+"</"+k.call(String(n.nodeName))+">"}if(U(n)){if(0===n.length)return"[]";var le=te(n,G);return F&&!function(e){for(var n=0;n<e.length;n++)if(Q(e[n],"\n")>=0)return!1;return!0}(le)?"["+ne(le,F)+"]":"[ "+C.call(le,", ")+" ]"}if(function(e){return"[object Error]"===V(e)&&X(e)}(n)){var ce=te(n,G);return"cause"in Error.prototype||!("cause"in n)||M.call(n,"cause")?0===ce.length?"["+String(n)+"]":"{ ["+String(n)+"] "+C.call(ce,", ")+" }":"{ ["+String(n)+"] "+C.call(_.call("[cause]: "+G(n.cause),ce),", ")+" }"}if("object"==typeof n&&h){if($&&"function"==typeof n[$]&&z)return z(n,{depth:E-r});if("symbol"!==h&&"function"==typeof n.inspect)return n.inspect()}if(function(e){if(!o||!e||"object"!=typeof e)return!1;try{o.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(n)){var de=[];return i&&i.call(n,function(e,t){de.push(G(t,n,!0)+" => "+G(e,n))}),ee("Map",o.call(n),de,F)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{o.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(n)){var ue=[];return d&&d.call(n,function(e){ue.push(G(e,n))}),ee("Set",c.call(n),ue,F)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{p.call(e,p)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(n))return Z("WeakMap");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{p.call(e,p);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(n))return Z("WeakSet");if(function(e){if(!v||!e||"object"!=typeof e)return!1;try{return v.call(e),!0}catch(e){}return!1}(n))return Z("WeakRef");if(function(e){return"[object Number]"===V(e)&&X(e)}(n))return J(G(Number(n)));if(function(e){if(!e||"object"!=typeof e||!L)return!1;try{return L.call(e),!0}catch(e){}return!1}(n))return J(G(L.call(n)));if(function(e){return"[object Boolean]"===V(e)&&X(e)}(n))return J(f.call(n));if(function(e){return"[object String]"===V(e)&&X(e)}(n))return J(G(String(n)));if("undefined"!=typeof window&&n===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&n===globalThis||void 0!==t.g&&n===t.g)return"{ [object globalThis] }";if(!function(e){return"[object Date]"===V(e)&&X(e)}(n)&&!W(n)){var pe=te(n,G),ve=P?P(n)===Object.prototype:n instanceof Object||n.constructor===Object,fe=n instanceof Object?"":"null prototype",he=!ve&&R&&Object(n)===n&&R in n?b.call(V(n),8,-1):fe?"Object":"",me=(ve||"function"!=typeof n.constructor?"":n.constructor.name?n.constructor.name+" ":"")+(he||fe?"["+C.call(_.call([],he||[],fe||[]),": ")+"] ":"");return 0===pe.length?me+"{}":F?me+"{"+ne(pe,F)+"}":me+"{ "+C.call(pe,", ")+" }"}return String(n)};var G=Object.prototype.hasOwnProperty||function(e){return e in this};function H(e,n){return G.call(e,n)}function V(e){return h.call(e)}function Q(e,n){if(e.indexOf)return e.indexOf(n);for(var t=0,a=e.length;t<a;t++)if(e[t]===n)return t;return-1}function K(e,n){if(e.length>n.maxStringLength){var t=e.length-n.maxStringLength,a="... "+t+" more character"+(t>1?"s":"");return K(b.call(e,0,n.maxStringLength),n)+a}var r=F[n.quoteStyle||"single"];return r.lastIndex=0,j(y.call(y.call(e,r,"\\$1"),/[\x00-\x1f]/g,Y),"single",n)}function Y(e){var n=e.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[n];return t?"\\"+t:"\\x"+(n<16?"0":"")+x.call(n.toString(16))}function J(e){return"Object("+e+")"}function Z(e){return e+" { ? }"}function ee(e,n,t,a){return e+" ("+n+") {"+(a?ne(t,a):C.call(t,", "))+"}"}function ne(e,n){if(0===e.length)return"";var t="\n"+n.prev+n.base;return t+C.call(e,","+t)+"\n"+n.prev}function te(e,n){var t=U(e),a=[];if(t){a.length=e.length;for(var r=0;r<e.length;r++)a[r]=H(e,r)?n(e[r],e):""}var o,i="function"==typeof E?E(e):[];if(I){o={};for(var s=0;s<i.length;s++)o["$"+i[s]]=i[s]}for(var l in e)H(e,l)&&(t&&String(Number(l))===l&&l<e.length||I&&o["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?a.push(n(l,e)+": "+n(e[l],e)):a.push(l+": "+n(e[l],e))));if("function"==typeof E)for(var c=0;c<i.length;c++)M.call(e,i[c])&&a.push("["+n(i[c])+"]: "+n(e[i[c]],e));return a}},8968:e=>{"use strict";e.exports=Math.floor},9037:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9173:(e,n,t)=>{"use strict";t.d(n,{useUIStore:()=>l});var a=t(810),r=t(953),o=t(641),i=t(9207),s=t(8546);const l=(0,a.nY)("ui",()=>{const e=(0,r.KR)(!1),n=(0,r.KR)(""),t=(0,r.KR)({}),a=(0,r.KR)(!1),l=(0,r.KR)(""),c=(0,r.KR)(!1),d=(0,r.KR)(""),u=(0,r.KR)(""),p=(0,r.KR)(null),v=(0,r.KR)(null),f=(0,r.KR)(""),h=(0,r.KR)(!1),m=(0,r.KR)(!1),g=(0,r.KR)(!1),b=(0,r.KR)(null),y=(0,r.KR)(!1),x=(0,r.KR)(!1),k=(0,r.KR)(!1),w=(0,r.KR)(""),_=(0,r.KR)(""),C=(0,r.IJ)(null),A=(0,r.KR)(null),S=(0,r.KR)(""),L=(0,r.KR)(!1),E=(0,r.KR)([]),T=(0,r.KR)(null),I=(0,r.KR)("creation"),R=(0,r.KR)(!1),M=(0,r.KR)(null),P=(0,r.KR)(null),D=(0,r.KR)(""),z=(0,r.KR)(!0),N=(0,r.KR)(3),$=(0,r.KR)("false"!==localStorage.getItem("enableActionOptions")),O=(0,r.KR)(localStorage.getItem("actionOptionsPrompt")||""),F=(0,r.KR)("false"!==localStorage.getItem("useStreaming")),j=(0,r.KR)({configured:(0,s.isBackendConfigured)(),connected:!1,lastChecked:0}),B=(0,o.EW)(()=>j.value.configured&&j.value.connected),X=(0,o.EW)(()=>j.value.configured);function U(){g.value=!1,b.value=null,y.value&&(a.value=!0,y.value=!1)}function W(){L.value=!1,E.value=[],T.value=null}return{showToastState:e,toastMessage:n,toastOptions:t,showToast:function(a,r={}){n.value=a,t.value={type:r.type||"info",duration:r.duration||3e3},e.value=!0},hideToast:function(){e.value=!1},isLoading:a,loadingText:l,isAIProcessing:c,streamingContent:d,currentGenerationId:p,streamingTimestamp:v,setStreamingContent:function(e){u.value=e;const n=(0,i.A)(e);d.value=n||(0,i.E)(e)},appendStreamingContent:function(e){u.value+=e;const n=(0,i.A)(u.value);d.value=n||(0,i.E)(u.value)},clearStreamingContent:function(){d.value="",u.value=""},setCurrentGenerationId:function(e){p.value=e},startStreaming:function(e){p.value=e,d.value="",u.value="",v.value=Date.now(),c.value=!0},stopStreaming:function(){u.value&&(d.value=(0,i.A)(u.value)),p.value=null,v.value=null,c.value=!1},resetStreamingState:function(){d.value="",u.value="",p.value=null,v.value=null,c.value=!1,f.value="",h.value=!1,sessionStorage.removeItem("ai-processing-state"),sessionStorage.removeItem("ai-processing-timestamp")},thinkingContent:f,isThinkingPhase:h,thinkingExpanded:m,appendThinkingContent:function(e){f.value+=e,h.value=!0,e&&!m.value&&(m.value=!0)},endThinkingPhase:function(){h.value=!1},clearThinkingContent:function(){f.value="",h.value=!1},toggleThinkingExpanded:function(){m.value=!m.value},showRetryDialogState:g,retryDialogConfig:b,startLoading:function(e="正在加载..."){a.value=!0,l.value=e},stopLoading:function(){a.value=!1,l.value=""},setAIProcessing:function(e){c.value=e,e?(sessionStorage.setItem("ai-processing-state","true"),sessionStorage.setItem("ai-processing-timestamp",Date.now().toString())):(sessionStorage.removeItem("ai-processing-state"),sessionStorage.removeItem("ai-processing-timestamp"))},updateLoadingText:function(e){a.value&&(l.value=e)},showRetryDialog:function(e){y.value=a.value,a.value&&(a.value=!1),b.value=e,g.value=!0},hideRetryDialog:U,confirmRetry:function(){b.value&&(b.value.onConfirm(),U())},cancelRetry:function(){b.value&&(b.value.onCancel(),U())},neutralAction:function(){b.value&&b.value.onNeutral&&(b.value.onNeutral(),U())},showCharacterManagement:x,openCharacterManagement:function(){x.value=!0},closeCharacterManagement:function(){x.value=!1},showDataValidationError:L,dataValidationErrorMessages:E,dataValidationContext:I,showDataValidationErrorDialog:function(e,n,t="creation"){E.value=e,T.value=n,I.value=t,L.value=!0},hideDataValidationErrorDialog:W,confirmDataValidationError:function(){T.value&&T.value(),W()},showStateChangeViewer:R,stateChangeLogToShow:M,currentMessageStateChanges:P,openStateChangeViewer:function(e){M.value=e,R.value=!0},closeStateChangeViewer:function(){R.value=!1,M.value=null},setCurrentMessageStateChanges:function(e){P.value=e?{...e,_ts:Date.now()}:null},clearCurrentMessageStateChanges:function(){P.value=null},autoGenerateNpc:z,minNpcCount:N,enableActionOptions:(0,o.EW)({get:()=>$.value,set:e=>{$.value=e,localStorage.setItem("enableActionOptions",String(e))}}),actionOptionsPrompt:(0,o.EW)({get:()=>O.value,set:e=>{O.value=e,localStorage.setItem("actionOptionsPrompt",e)}}),useStreaming:(0,o.EW)({get:()=>F.value,set:e=>{F.value=e,localStorage.setItem("useStreaming",String(e))}}),userInputText:D,backendStatus:j,checkBackendConnection:async()=>{if(!j.value.configured)return j.value.connected=!1,!1;try{const e=await(0,s.d9)();return j.value.connected=!!e,j.value.lastChecked=Date.now(),j.value.connected}catch{return j.value.connected=!1,!1}},isBackendAvailable:B,isBackendConfiguredComputed:X,showDetailModalState:k,detailModalTitle:w,detailModalContent:_,detailModalComponent:C,detailModalProps:A,detailModalClass:S,showDetailModal:function(e){w.value=e.title,_.value=e.content||"",C.value=e.component||null,A.value=e.props||null,S.value=e.className||"",k.value=!0},hideDetailModal:function(){k.value=!1,setTimeout(()=>{w.value="",_.value="",C.value=null,A.value=null,S.value=""},300)}}})},9197:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.save-migration[data-v-230bf738] {\n  display: flex;\n  flex-direction: column;\n  gap: 14px;\n  color: var(--color-text);\n}\n.migration-header h4[data-v-230bf738] {\n  margin: 0 0 6px 0;\n  font-size: 1.05rem;\n}\n.migration-header p[data-v-230bf738] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.migration-meta[data-v-230bf738] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  gap: 10px;\n}\n.meta-item[data-v-230bf738] {\n  padding: 8px 10px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.meta-item .label[data-v-230bf738] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.meta-item .value[data-v-230bf738] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  word-break: break-all;\n}\n.migration-reasons[data-v-230bf738] {\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  border-radius: 8px;\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.reason-title[data-v-230bf738] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.reason-list[data-v-230bf738] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.tag[data-v-230bf738] {\n  font-size: 0.75rem;\n  padding: 3px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.35);\n  background: rgba(var(--color-warning-rgb), 0.08);\n  color: var(--color-text);\n}\n.migration-hint[data-v-230bf738] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.migration-hint ul[data-v-230bf738] {\n  margin: 6px 0 0 18px;\n}\n.migration-actions[data-v-230bf738] {\n  display: flex;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n.migration-actions button[data-v-230bf738] {\n  border: none;\n  border-radius: 8px;\n  padding: 8px 14px;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.migration-actions .primary[data-v-230bf738] {\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  color: white;\n}\n.migration-actions .primary[data-v-230bf738]:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n.migration-actions .secondary[data-v-230bf738] {\n  background: transparent;\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n",""]);const s=i},9207:(e,n,t)=>{"use strict";t.d(n,{A:()=>p,E:()=>u});const a=500,r=50,o=1500;let i=null,s=[];function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(e){return`${!1===e.global?"":"g"}${e.ignoreCase?"i":""}${"regex"===e.mode&&e.multiline?"m":""}${"regex"===e.mode&&e.dotAll?"s":""}`}function d(e){return e.replace(/\$/g,"$$$$")}function u(e){return function(e,n){if(!e)return"";let t=e;t=t.replace(/<(?:ant[-_]?)?thinking>[\s\S]*?<\/(?:ant[-_]?)?thinking>/gi,"").replace(/<\/?(?:ant[-_]?)?thinking>/gi,"").replace(/<analysis>[\s\S]*?<\/analysis>/gi,"").replace(/<\/?analysis>/gi,"").replace(/<reasoning>[\s\S]*?<\/reasoning>/gi,"").replace(/<\/?reasoning>/gi,"").replace(/<thought>[\s\S]*?<\/thought>/gi,"").replace(/<\/?thought>/gi,"");for(const e of n)t=t.replace(e.re,e.replacement);return t}(e,function(){const e=function(){try{if("undefined"==typeof window||"undefined"==typeof localStorage)return{replaceRules:[]};const e=localStorage.getItem("dad_game_settings");if(!e)return{replaceRules:[]};const n=JSON.parse(e);return{replaceRules:Array.isArray(n?.replaceRules)?n.replaceRules:[]}}catch{return{replaceRules:[]}}}(),n=JSON.stringify(e.replaceRules||[]);return n===i||(i=n,s=function(e){const n=[];for(const t of e){if(n.length>=r)break;if(!t||!1===t.enabled)continue;if("string"!=typeof t.pattern||!t.pattern.trim())continue;const e=t.pattern.length>a?t.pattern.slice(0,a):t.pattern,i="string"==typeof t.replacement?t.replacement:"",s="text"===t.mode?d(i.slice(0,o)):i.slice(0,o);try{if("text"===t.mode){const a=`${!1===t.global?"":"g"}${t.ignoreCase?"i":""}`;n.push({re:new RegExp(l(e),a),replacement:s})}else{const a=c(t);n.push({re:new RegExp(e,a),replacement:s})}}catch{}}return n}(e.replaceRules||[])),s}())}function p(e){if(!e)return"";const n=e.replace(/<think[^>]*>[\s\S]*?<\/think[^>]*>/gi,"").replace(/<\/?think[^>]*>/gi,"").trim(),t=n.indexOf("{"),a=n.lastIndexOf("}");if(-1===t||-1===a||a<=t)return n;const r=n.slice(t,a+1);try{const e=JSON.parse(r);if("string"==typeof e.text)return e.text}catch{}return n}},9263:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n/* 主容器 */\n.preview-container[data-v-6db98732] {\n  height: 100%;\n  padding: 2rem;\n  box-sizing: border-box;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.preview-container[data-v-6db98732]::-webkit-scrollbar { width: 6px;\n}\n.preview-container[data-v-6db98732]::-webkit-scrollbar-track { background: transparent;\n}\n.preview-container[data-v-6db98732]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n\n/* 标题 */\n.title[data-v-6db98732] {\n  text-align: center;\n  color: #93c5fd;\n  margin: 0 0 0.5rem 0;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  font-weight: 600;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.subtitle[data-v-6db98732] {\n  text-align: center;\n  color: #94a3b8;\n  margin: 0 0 2rem 0;\n  font-size: 1rem;\n  font-style: italic;\n}\n\n/* 网格布局 */\n.preview-grid[data-v-6db98732] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 1.5rem;\n}\n\n/* 基础卡片样式 */\n.preview-item[data-v-6db98732] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  transition: all 0.25s ease;\n}\n.preview-item[data-v-6db98732]:hover {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.preview-item h3[data-v-6db98732] {\n  margin: 0;\n  color: #93c5fd;\n  border-bottom: 1px solid rgba(147, 197, 253, 0.2);\n  padding-bottom: 0.5rem;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n.preview-item p[data-v-6db98732] {\n  margin: 0;\n  font-size: 1rem;\n  color: #f1f5f9;\n  line-height: 1.5;\n}\n.preview-item h4[data-v-6db98732] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #bfdbfe;\n}\n.item-description[data-v-6db98732] {\n  font-size: 0.9rem !important;\n  color: #94a3b8 !important;\n  margin-top: 0.5rem !important;\n}\n.talents-item li .item-description[data-v-6db98732] {\n  margin-top: 0.25rem !important;\n  padding-left: 0.5rem;\n  border-left: 2px solid rgba(147, 197, 253, 0.3);\n}\n\n/* 名字输入 */\n.name-item[data-v-6db98732], .race-item[data-v-6db98732] {\n  grid-column: span 2;\n}\n@media (min-width: 769px) {\n.name-item[data-v-6db98732], .race-item[data-v-6db98732] {\n    grid-column: 1 / -1;\n}\n}\n.name-item label[data-v-6db98732] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #93c5fd;\n  margin-bottom: 0.5rem;\n  display: block;\n}\n.name-item input[data-v-6db98732], .input-field input[data-v-6db98732] {\n  width: 100%;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n  padding: 0.75rem;\n  border-radius: 8px;\n  font-size: 1rem;\n  box-sizing: border-box;\n  transition: all 0.25s ease;\n}\n.input-field input[data-v-6db98732] {\n  background: rgba(30, 41, 59, 0.4);\n}\n.name-item input[data-v-6db98732]:focus, .input-field input[data-v-6db98732]:focus {\n  outline: none;\n  border-color: #93c5fd;\n  box-shadow: 0 0 0 2px rgba(147, 197, 253, 0.1);\n}\n\n/* 只读输入框样式 */\n.readonly-input[data-v-6db98732] {\n  background: rgba(30, 41, 59, 0.3) !important;\n  cursor: not-allowed !important;\n  opacity: 0.7;\n  user-select: none;\n}\n.readonly-input[data-v-6db98732]:focus {\n  border-color: rgba(147, 197, 253, 0.2) !important;\n  box-shadow: none !important;\n}\n\n/* 名字提示文字 */\n.name-hint[data-v-6db98732] {\n  font-size: 0.85rem;\n  color: #94a3b8;\n  margin-top: 0.5rem;\n  display: block;\n}\n\n/* 性别选择 */\n.gender-control[data-v-6db98732] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.gender-label[data-v-6db98732] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 8px;\n  color: #f1f5f9;\n  background: rgba(30, 41, 59, 0.4);\n  border: 1px solid transparent;\n  transition: all 0.25s ease;\n}\n.gender-label[data-v-6db98732]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.gender-label input[type="radio"][data-v-6db98732] {\n  width: 16px;\n  height: 16px;\n  margin: 0;\n  accent-color: #93c5fd;\n}\n\n/* 开局模式选择 */\n.streaming-control[data-v-6db98732] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.streaming-label[data-v-6db98732] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem;\n  border-radius: 4px;\n  color: var(--color-text);\n  transition: all 0.2s ease;\n}\n.streaming-label[data-v-6db98732]:hover {\n  background: var(--color-surface-light);\n}\n.streaming-label input[type="radio"][data-v-6db98732] {\n  width: 16px;\n  height: 16px;\n  margin: 0;\n  accent-color: var(--color-primary);\n}\n.streaming-hint[data-v-6db98732] {\n  font-size: 0.85rem !important;\n  color: var(--color-text-secondary) !important;\n  margin-top: 0.5rem !important;\n  padding: 0.5rem;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  border-left: 3px solid var(--color-primary);\n  line-height: 1.4;\n}\n\n/* 生成方式选择 */\n.generate-mode-control[data-v-6db98732] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.generate-mode-label[data-v-6db98732] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem;\n  border-radius: 4px;\n  color: var(--color-text);\n  transition: all 0.2s ease;\n}\n.generate-mode-label[data-v-6db98732]:hover {\n  background: var(--color-surface-light);\n}\n.generate-mode-label input[type="radio"][data-v-6db98732] {\n  width: 16px;\n  height: 16px;\n  margin: 0;\n  accent-color: var(--color-primary);\n}\n.generate-mode-hint[data-v-6db98732] {\n  font-size: 0.85rem !important;\n  color: var(--color-text-secondary) !important;\n  margin-top: 0.5rem !important;\n  padding: 0.5rem;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  border-left: 3px solid var(--color-primary);\n  line-height: 1.4;\n}\n\n/* 年龄控制 */\n.age-control[data-v-6db98732] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n}\n.age-btn[data-v-6db98732] {\n  width: 32px;\n  height: 32px;\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  background: rgba(30, 41, 59, 0.6);\n  color: #93c5fd;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s ease;\n}\n.age-btn[data-v-6db98732]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.3);\n  border-color: #93c5fd;\n  color: #bfdbfe;\n}\n.age-btn[data-v-6db98732]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.age-display[data-v-6db98732] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #f1f5f9;\n  min-width: 60px;\n  text-align: center;\n}\n.age-input[data-v-6db98732] {\n  width: 80px;\n  padding: 0.5rem;\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #f1f5f9;\n  font-size: 1.1rem;\n  font-weight: 600;\n  text-align: center;\n  transition: all 0.25s ease;\n}\n.age-input[data-v-6db98732]:focus {\n  outline: none;\n  border-color: #93c5fd;\n  box-shadow: 0 0 0 2px rgba(147, 197, 253, 0.1);\n}\n.age-input[data-v-6db98732]::-webkit-inner-spin-button,\n.age-input[data-v-6db98732]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.age-input[type="number"][data-v-6db98732] {\n  -moz-appearance: textfield;\n}\n.age-unit[data-v-6db98732] {\n  font-size: 1rem;\n  color: #94a3b8;\n  font-weight: 500;\n}\n\n/* 列表样式 */\n.preview-item ul[data-v-6db98732] {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n}\n.preview-item li[data-v-6db98732] {\n  margin-bottom: 0.75rem;\n  padding: 0.75rem;\n  background: rgba(30, 41, 59, 0.4);\n  border-radius: 8px;\n  color: #f1f5f9;\n  line-height: 1.4;\n  border: 1px solid transparent;\n  transition: all 0.25s ease;\n}\n.preview-item li[data-v-6db98732]:hover {\n  background: rgba(51, 65, 85, 0.5);\n  border-color: rgba(147, 197, 253, 0.15);\n}\n.preview-item li strong[data-v-6db98732] {\n  display: block;\n  margin-bottom: 0.25rem;\n  color: #93c5fd;\n}\n\n/* 云端信息 */\n.cloud-info-item[data-v-6db98732] {\n  text-align: center;\n  background: rgba(30, 41, 59, 0.3);\n  border: 1px dashed rgba(147, 197, 253, 0.3);\n}\n.cloud-info-text[data-v-6db98732] {\n  font-size: 0.95rem;\n  color: #94a3b8;\n  line-height: 1.6;\n  font-style: italic;\n}\n\n/* 响应式 */\n@media (max-width: 768px) {\n.preview-container[data-v-6db98732] {\n    padding: 1rem;\n}\n.preview-grid[data-v-6db98732] {\n    grid-template-columns: 1fr;\n    gap: 1rem;\n}\n.gender-control[data-v-6db98732] {\n    flex-direction: row;\n    flex-wrap: wrap;\n    justify-content: space-around;\n}\n.gender-label[data-v-6db98732] {\n    flex: 1;\n    min-width: 80px;\n    justify-content: center;\n}\n}\n@media (min-width: 769px) and (max-width: 1024px) {\n.preview-grid[data-v-6db98732] {\n    grid-template-columns: repeat(2, 1fr);\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .preview-item[data-v-6db98732] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .preview-item[data-v-6db98732]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .preview-item h3[data-v-6db98732] {\n  color: #2563eb;\n  border-bottom-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .preview-item h4[data-v-6db98732] {\n  color: #1e40af;\n}\n[data-theme="light"] .preview-item p[data-v-6db98732] {\n  color: #1e293b;\n}\n[data-theme="light"] .title[data-v-6db98732] {\n  color: #2563eb;\n}\n[data-theme="light"] .subtitle[data-v-6db98732] {\n  color: #475569;\n}\n[data-theme="light"] .name-item label[data-v-6db98732] {\n  color: #2563eb;\n}\n[data-theme="light"] .name-item input[data-v-6db98732],\n[data-theme="light"] .input-field input[data-v-6db98732] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #1e293b;\n}\n[data-theme="light"] .gender-label[data-v-6db98732] {\n  background: rgba(255, 255, 255, 0.6);\n  color: #1e293b;\n}\n[data-theme="light"] .gender-label[data-v-6db98732]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .age-btn[data-v-6db98732] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .age-btn[data-v-6db98732]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n}\n[data-theme="light"] .age-input[data-v-6db98732] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #1e293b;\n}\n[data-theme="light"] .preview-item li[data-v-6db98732] {\n  background: rgba(255, 255, 255, 0.6);\n  color: #1e293b;\n}\n[data-theme="light"] .preview-item li[data-v-6db98732]:hover {\n  background: rgba(241, 245, 249, 0.95);\n}\n[data-theme="light"] .preview-item li strong[data-v-6db98732] {\n  color: #2563eb;\n}\n[data-theme="light"] .cloud-info-item[data-v-6db98732] {\n  background: rgba(248, 250, 252, 0.6);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .cloud-info-text[data-v-6db98732] {\n  color: #475569;\n}\n@media (max-width: 480px) {\n.preview-container[data-v-6db98732] {\n    padding: 1rem;\n}\n.title[data-v-6db98732] {\n    font-size: 1.6rem;\n}\n.subtitle[data-v-6db98732] {\n    font-size: 0.9rem;\n    margin-bottom: 1.5rem;\n}\n.preview-item[data-v-6db98732] {\n    padding: 1rem;\n    gap: 0.8rem;\n}\n.preview-item h3[data-v-6db98732] {\n    font-size: 1rem;\n}\n.preview-item h4[data-v-6db98732] {\n    font-size: 1rem;\n}\n.item-description[data-v-6db98732] {\n    font-size: 0.85rem !important;\n}\n.name-item label[data-v-6db98732] {\n    font-size: 1rem;\n}\n.name-item input[data-v-6db98732] {\n    padding: 0.6rem;\n    font-size: 0.9rem;\n}\n.gender-label[data-v-6db98732] {\n    font-size: 0.9rem;\n    padding: 0.4rem;\n}\n.age-control[data-v-6db98732] {\n    gap: 0.8rem;\n}\n.age-btn[data-v-6db98732] {\n    width: 28px;\n    height: 28px;\n    font-size: 0.9rem;\n}\n.age-display[data-v-6db98732] {\n    font-size: 1rem;\n}\n.preview-item li[data-v-6db98732] {\n    padding: 0.6rem;\n}\n}\n',""]);const s=i},9290:e=>{"use strict";e.exports=RangeError},9313:(e,n,t)=>{"use strict";t.d(n,{A:()=>se});var a=t(641),r=t(3751),o=t(33),i=t(953),s=t(4459),l=t(4270),c=t(7760),d=t(8220),u=t(1184);const p={class:"prompt-panel"},v={class:"panel-header compact"},f={class:"panel-search"},h=["disabled"],m=["disabled"],g={class:"panel-actions"},b=["disabled"],y=["disabled"],x=["disabled"],k={key:0,class:"online-mode-warning"},w={class:"prompt-list"},_={key:0,class:"empty-search"},C=["onClick"],A={class:"category-title"},S={class:"category-icon"},L={class:"category-name"},E={class:"category-count"},T={class:"category-actions"},I={class:"category-desc"},R={key:0,class:"category-content"},M=["onClick"],P={class:"prompt-title-area"},D=["checked","onChange"],z={class:"prompt-meta"},N=["value","disabled","onChange"],$=["title"],O=["title"],F={key:0,class:"prompt-content"},j={key:0,class:"prompt-description-full"},B=["onUpdate:modelValue","onInput","disabled"],X={class:"prompt-actions"},U=["onClick","disabled"],W=["onClick"],q=["onClick","disabled"],G=(0,a.pM)({__name:"PromptManagementPanel",setup(e){const n=(0,d.useCharacterStore)(),t=(0,u.useGameStateStore)(),G=(0,a.EW)(()=>"联机"===n.activeCharacterProfile?.模式),H=(0,a.EW)(()=>{const e=localStorage.getItem("dad_game_settings");if(e)try{return!0===JSON.parse(e).splitResponseGeneration}catch{return!1}return!1}),V=(0,a.EW)(()=>!1!==t.eventSystem?.配置?.启用随机事件),Q=(0,i.KR)({}),K=(0,i.KR)({}),Y=(0,i.KR)({}),J=(0,i.KR)(""),Z=(0,a.EW)(()=>{const e=J.value.trim().toLowerCase();if(!e)return Q.value;const n={};for(const[t,a]of Object.entries(Q.value)){const r=a.prompts.filter(n=>[n.key,n.name,n.description??""].join("\n").toLowerCase().includes(e));r.length>0&&(n[t]={info:a.info,prompts:r})}return n});async function ee(){Q.value=await s.e.loadByCategory({isOnlineMode:G.value,isSplitGeneration:H.value,isEventSystemEnabled:V.value});const e=Object.keys(Q.value)[0];e&&(Y.value[e]=!0)}function ne(){for(const e in Z.value)Y.value[e]=!0}function te(){for(const e in Z.value)Y.value[e]=!1;K.value={}}async function ae(){let e=0;for(const n in Q.value)for(const t of Q.value[n].prompts)t.modified&&(await s.e.save(t.key,t.content,t.enabled,t.weight),e++);e>0?l.o.success(`已保存 ${e} 项修改`):l.o.info("没有需要保存的修改")}async function re(){confirm("确定要重置全部提示词为默认值吗？此操作不可撤销。")&&(await s.e.resetAll(),await ee(),l.o.success("已重置全部提示词为默认值"))}async function oe(){const e=await s.e.exportAll();se((0,c.q3)("prompts",e),"prompts_all.json"),l.o.success("已导出全部提示词")}function ie(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.text(),t=JSON.parse(e),a=(0,c.ZT)(t),r="prompts"===a.type?a.payload:t,o=await s.e.importPrompts(r);await ee(),l.o.success(`成功导入 ${o} 个提示词`)}catch(e){l.o.error("导入失败，请检查文件格式")}},e.click()}function se(e,n){const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=n,r.click(),URL.revokeObjectURL(a)}return(0,a.sV)(async()=>{await ee()}),(0,a.wB)(J,()=>{if(J.value.trim())for(const e of Object.keys(Z.value))Y.value[e]=!0}),(e,n)=>((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("div",v,[n[12]||(n[12]=(0,a.Lk)("div",{class:"panel-title-compact"},[(0,a.Lk)("span",{class:"title-text"},"📝 提示词管理")],-1)),(0,a.Lk)("div",f,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>J.value=e),class:"search-input",type:"text",placeholder:"搜索提示词（名称 / 键名 / 描述）",disabled:0===Object.keys(Q.value).length},null,8,h),[[r.Jo,J.value]]),(0,a.Lk)("button",{class:"clear-btn",onClick:n[1]||(n[1]=e=>J.value=""),disabled:!J.value,title:"清空搜索"},"×",8,m)]),(0,a.Lk)("div",g,[(0,a.Lk)("button",{class:"action-btn-compact",onClick:ne,title:"全部展开"},n[6]||(n[6]=[(0,a.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("polyline",{points:"6 9 12 15 18 9"})],-1)])),(0,a.Lk)("button",{class:"action-btn-compact",onClick:te,title:"全部折叠"},n[7]||(n[7]=[(0,a.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("polyline",{points:"18 15 12 9 6 15"})],-1)])),(0,a.Lk)("button",{class:"action-btn-compact",onClick:oe,title:"导出全部"},n[8]||(n[8]=[(0,a.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,a.Lk)("polyline",{points:"7 10 12 15 17 10"}),(0,a.Lk)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])),(0,a.Lk)("button",{class:"action-btn-compact",onClick:ie,title:"导入",disabled:G.value},n[9]||(n[9]=[(0,a.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,a.Lk)("polyline",{points:"17 8 12 3 7 8"}),(0,a.Lk)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)]),8,b),(0,a.Lk)("button",{class:"action-btn-compact primary",onClick:ae,title:"保存全部",disabled:G.value},n[10]||(n[10]=[(0,a.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),(0,a.Lk)("polyline",{points:"17 21 17 13 7 13 7 21"}),(0,a.Lk)("polyline",{points:"7 3 7 8 15 8"})],-1)]),8,y),(0,a.Lk)("button",{class:"action-btn-compact danger",onClick:re,title:"重置全部",disabled:G.value},n[11]||(n[11]=[(0,a.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),(0,a.Lk)("path",{d:"M3 3v5h5"})],-1)]),8,x)])]),(0,a.Q3)(" 联机模式警告 "),G.value?((0,a.uX)(),(0,a.CE)("div",k,n[13]||(n[13]=[(0,a.Lk)("span",{class:"warning-icon"},"🔒",-1),(0,a.Lk)("span",{class:"warning-text"},"联机模式下提示词仅供查看，无法编辑",-1)]))):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",w,[0===Object.keys(Z.value).length?((0,a.uX)(),(0,a.CE)("div",_," 未找到匹配的提示词 ")):(0,a.Q3)("v-if",!0),(0,a.Q3)(" 分类显示 "),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Z.value,(e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"category-section"},[(0,a.Q3)(" 分类头部 "),(0,a.Lk)("div",{class:"category-header",onClick:e=>function(e){Y.value[e]=!Y.value[e]}(String(t))},[(0,a.Lk)("div",A,[(0,a.Lk)("span",S,(0,o.v_)(e.info.icon),1),(0,a.Lk)("span",L,(0,o.v_)(e.info.name),1),(0,a.Lk)("span",E,(0,o.v_)(e.prompts.length)+" 个提示词",1)]),(0,a.Lk)("div",T,[(0,a.Lk)("span",I,(0,o.v_)(e.info.description),1),((0,a.uX)(),(0,a.CE)("svg",{class:(0,o.C4)(["expand-icon",{expanded:Y.value[t]}]),width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},n[14]||(n[14]=[(0,a.Lk)("polyline",{points:"6 9 12 15 18 9"},null,-1)]),2))])],8,C),(0,a.Q3)(" 分类内容 "),Y.value[t]?((0,a.uX)(),(0,a.CE)("div",R,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.prompts,e=>{return(0,a.uX)(),(0,a.CE)("div",{key:e.key,class:"prompt-item"},[(0,a.Lk)("div",{class:"prompt-header",onClick:n=>{return t=e.key,void(K.value[t]=!K.value[t]);var t}},[(0,a.Lk)("div",P,[(0,a.Q3)(" 启用/禁用开关 "),(0,a.Lk)("label",{class:"toggle-switch",onClick:n[2]||(n[2]=(0,r.D$)(()=>{},["stop"]))},[(0,a.Lk)("input",{type:"checkbox",checked:e.enabled,onChange:n=>async function(e,n){for(const t in Q.value){const a=Q.value[t].prompts.find(n=>n.key===e);if(a){a.enabled=n;break}}await s.e.setEnabled(e,n),l.o.info(n?"已启用":"已禁用")}(e.key,n.target.checked)},null,40,D),n[15]||(n[15]=(0,a.Lk)("span",{class:"toggle-slider"},null,-1))]),(0,a.Q3)(" 序号已包含在name中，不再单独显示 "),(0,a.Lk)("span",{class:(0,o.C4)(["prompt-title",{disabled:!e.enabled}])},(0,o.v_)(e.name),3)]),(0,a.Lk)("div",z,[void 0!==e.weight?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"weight-editor",onClick:n[4]||(n[4]=(0,r.D$)(()=>{},["stop"]))},[n[16]||(n[16]=(0,a.Lk)("label",{class:"weight-label"},"W",-1)),(0,a.Lk)("input",{type:"number",class:(0,o.C4)(["weight-input",(i=e.weight,i>=9?"weight-high":i>=6?"weight-medium":"weight-low")]),value:e.weight,min:"1",max:"10",disabled:G.value,onChange:n=>async function(e,n){const t=Math.min(10,Math.max(1,Math.round(n)));for(const n in Q.value){const a=Q.value[n].prompts.find(n=>n.key===e);if(a){a.weight=t,await s.e.save(e,a.content,a.enabled,t),l.o.success(`权重已更新为 ${t}`);break}}}(e.key,Number(n.target.value)),onClick:n[3]||(n[3]=(0,r.D$)(()=>{},["stop"]))},null,42,N)])):(0,a.Q3)("v-if",!0),e.description?((0,a.uX)(),(0,a.CE)("span",{key:1,class:"prompt-desc",title:e.description},(0,o.v_)((t=e.description,t.length<=30?t:t.substring(0,30)+"...")),9,$)):(0,a.Q3)("v-if",!0),(0,a.Lk)("span",{class:"prompt-key",title:e.key,onClick:n[5]||(n[5]=(0,r.D$)(()=>{},["stop"]))},(0,o.v_)(e.key),9,O),(0,a.Lk)("span",{class:(0,o.C4)(["prompt-status",{modified:e.modified}])},(0,o.v_)(e.modified?"已修改":"默认"),3)])],8,M),K.value[e.key]?((0,a.uX)(),(0,a.CE)("div",F,[e.description?((0,a.uX)(),(0,a.CE)("div",j,(0,o.v_)(e.description),1)):(0,a.Q3)("v-if",!0),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":n=>e.content=n,onInput:n=>function(e){for(const n in Q.value){const t=Q.value[n].prompts.find(n=>n.key===e);if(t){t.modified=t.content!==t.default;break}}}(e.key),rows:"20",class:(0,o.C4)(["prompt-textarea",{"readonly-mode":G.value}]),disabled:G.value},null,42,B),[[r.Jo,e.content]]),(0,a.Lk)("div",X,[(0,a.Lk)("button",{class:"btn-small",onClick:n=>async function(e){for(const n in Q.value){const t=Q.value[n].prompts.find(n=>n.key===e);if(t){t.content=t.default,t.modified=!1,await s.e.reset(e),l.o.info(`已重置: ${t.name}`);break}}}(e.key),disabled:G.value},"重置为默认",8,U),(0,a.Lk)("button",{class:"btn-small",onClick:n=>function(e){for(const n in Q.value){const t=Q.value[n].prompts.find(n=>n.key===e);if(t){se((0,c.q3)("prompts",{[e]:t.content}),`prompt_${e}.json`);break}}}(e.key)},"导出此项",8,W),(0,a.Lk)("button",{class:"btn-small btn-primary",onClick:n=>async function(e){for(const n in Q.value){const t=Q.value[n].prompts.find(n=>n.key===e);if(t){await s.e.save(e,t.content,t.enabled,t.weight),l.o.success(`已保存: ${t.name}`);break}}}(e.key),disabled:G.value},"保存修改",8,q)])])):(0,a.Q3)("v-if",!0)]);var t,i}),128))])):(0,a.Q3)("v-if",!0)]))),128))])]))}});var H=t(5072),V=t.n(H),Q=t(7825),K=t.n(Q),Y=t(7659),J=t.n(Y),Z=t(5056),ee=t.n(Z),ne=t(540),te=t.n(ne),ae=t(1113),re=t.n(ae),oe=t(3338),ie={};ie.styleTagTransform=re(),ie.setAttributes=ee(),ie.insert=J().bind(null,"head"),ie.domAPI=K(),ie.insertStyleElement=te(),V()(oe.A,ie),oe.A&&oe.A.locals&&oe.A.locals;const se=(0,t(6262).A)(G,[["__scopeId","data-v-22f507ae"]])},9333:(e,n,t)=>{"use strict";t.d(n,{Em:()=>c,NX:()=>g,OW:()=>h,Qc:()=>f,Sj:()=>m,Uy:()=>v,verifyStoredToken:()=>d,w2:()=>u,yZ:()=>p});var a=t(4270),r=t(8546);const o=e=>{const n=e.trim();if(!n)return"网络连接失败或后端地址无效，请检查后端服务。";const t=n.toLowerCase();return t.includes("failed to fetch")||t.includes("networkerror")||t.includes("fetch failed")||t.includes("load failed")?"网络连接失败或后端地址无效，请检查后端服务。":t.includes("invalid url")?"后端地址无效，请检查配置后重试。":n},i=e=>{if(null==e)return null;if("string"==typeof e)return e;if("object"!=typeof e)return String(e);const n=e;return"detail"in n?(e=>{if("string"==typeof e)return e;if(null==e)return"服务器返回了未知错误。";if(Array.isArray(e)){const n=e.map(e=>{if(!e||"object"!=typeof e)return String(e);const n=e,t="string"==typeof n.msg?n.msg:void 0,a=Array.isArray(n.loc)?n.loc.filter(e=>"string"==typeof e||"number"==typeof e):void 0,r=a?.length?` (${a.join(".")})`:"";return t?`${t}${r}`:JSON.stringify(n)}).filter(Boolean);return n.length?n.join("；"):"请求参数不合法。"}return"object"==typeof e?JSON.stringify(e):String(e)})(n.detail):"string"==typeof n.message?n.message:JSON.stringify(n)},s=e=>e.includes("/api/v1/auth/token")||e.includes("/api/v1/auth/register")||e.includes("/api/v1/auth/me")||e.includes("/api/v1/admin/token"),l=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),Promise.resolve().then(t.bind(t,9969)).then(({default:e})=>{"/login"!==e.currentRoute.value?.path&&e.push("/login")})};async function c(e,n={}){const t=localStorage.getItem("access_token"),c=new Headers(n.headers||{});let d=!1;t&&c.append("Authorization",`Bearer ${t}`),!n.body||n.body instanceof FormData||c.has("Content-Type")||c.append("Content-Type","application/json");const u={...n,headers:c};try{if(!(0,r.isBackendConfigured)())throw new Error("未配置后端服务器");const n=(0,r.mh)(e),t=await fetch(n,u);if(204===t.status)return null;const c=await t.text();if(!t.ok){let n=`服务器错误 ${t.status}`;try{const e=JSON.parse(c);n=i(e)||n}catch(e){n=c.substring(0,100)||"无法解析服务器响应。"}if(n=o(n),s(e))throw new Error(n);throw 401===t.status?(n="登录已失效或未登录，请先登录后再试。",a.o.info(n),d=!0,l()):(a.o.error(n),d=!0),new Error(n)}try{return JSON.parse(c)}catch(e){throw new Error("解析服务器响应失败，返回的不是有效的JSON格式。")}}catch(n){const t=o(n instanceof Error?n.message:"网络连接失败或后端地址无效，请检查后端服务。");throw d||s(e)||a.o.error(t),new Error(t)}}async function d(){const e=localStorage.getItem("access_token");if(!(0,r.isBackendConfigured)())return!1;if(!e)return!1;try{const e=await c("/api/v1/auth/me",{method:"GET"});if(e&&e.user_name)return localStorage.setItem("username",e.user_name),!0;throw new Error("无效的用户数据")}catch(e){return!1}}async function u(){try{const e=await c.get("/api/v1/worlds/");return e?.items||[]}catch(e){return[]}}async function p(){try{const e=await c.get("/api/v1/talent_tiers/");return e?.items||[]}catch(e){return[]}}async function v(){try{const e=await c.get("/api/v1/origins/");return e?.items||[]}catch(e){return[]}}async function f(){try{const e=await c.get("/api/v1/talents/");return(e?.items||[]).map(e=>({id:e.id??0,name:e.name??"",description:e.description,talent_cost:e.talent_cost??0,rarity:e.rarity??0,tier_id:e.tier_id??e.tier?.id??null,tier:e.tier,source:e.source,effects:e.effects}))}catch(e){return[]}}async function h(e){return await c.post("/api/v1/characters/create",e)}async function m(e,n){return await c.put(`/api/v1/characters/${e}/save`,n)}async function g(e){return await c.get(`/api/v1/characters/${e}`)}c.get=(e,n={})=>c(e,{...n,method:"GET"}),c.post=(e,n,t={})=>c(e,{...t,method:"POST",body:void 0!==n?JSON.stringify(n):void 0}),c.put=(e,n,t={})=>c(e,{...t,method:"PUT",body:void 0!==n?JSON.stringify(n):void 0}),c.delete=(e,n={})=>c(e,{...n,method:"DELETE"})},9353:e=>{"use strict";var n=Object.prototype.toString,t=Math.max,a=function(e,n){for(var t=[],a=0;a<e.length;a+=1)t[a]=e[a];for(var r=0;r<n.length;r+=1)t[r+e.length]=n[r];return t};e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==n.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,i=function(e){for(var n=[],t=1,a=0;t<e.length;t+=1,a+=1)n[a]=e[t];return n}(arguments),s=t(0,r.length-i.length),l=[],c=0;c<s;c++)l[c]="$"+c;if(o=Function("binder","return function ("+function(e){for(var n="",t=0;t<e.length;t+=1)n+=e[t],t+1<e.length&&(n+=",");return n}(l)+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof o){var n=r.apply(this,a(i,arguments));return Object(n)===n?n:this}return r.apply(e,a(i,arguments))}),r.prototype){var d=function(){};d.prototype=r.prototype,o.prototype=new d,d.prototype=null}return o}},9383:e=>{"use strict";e.exports=Error},9396:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.login-container[data-v-85e1d8c6] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.login-panel[data-v-85e1d8c6] {\n  width: 100%;\n  max-width: 400px;\n  padding: 2.5rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 15px;\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n}\n.title[data-v-85e1d8c6] {\n  text-align: center;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  color: var(--color-accent);\n  margin-top: 0;\n  margin-bottom: 0.5rem;\n}\n.subtitle[data-v-85e1d8c6] {\n  text-align: center;\n  color: var(--color-text-secondary);\n  margin-bottom: 2rem;\n}\n.form-group[data-v-85e1d8c6] {\n  margin-bottom: 1.5rem;\n}\n.form-group label[data-v-85e1d8c6] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n}\n.form-group input[data-v-85e1d8c6] {\n  width: 100%;\n  padding: 0.8rem 1rem;\n  background: rgba(0,0,0,0.2);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text);\n  font-size: 1rem;\n  box-sizing: border-box;\n  transition: var(--transition-fast);\n}\n.form-group input[data-v-85e1d8c6]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n.email-input-row[data-v-85e1d8c6] {\n  display: flex;\n  gap: 0.5rem;\n}\n.email-input-row input[data-v-85e1d8c6] {\n  flex: 1;\n}\n.btn-small[data-v-85e1d8c6] {\n  padding: 0.8rem 1rem;\n  white-space: nowrap;\n  flex-shrink: 0;\n  min-width: 100px;\n}\n.turnstile-group[data-v-85e1d8c6] {\n  margin-top: 0.25rem;\n}\n.turnstile-container[data-v-85e1d8c6] {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 72px;\n}\n.error-message[data-v-85e1d8c6] {\n    color: var(--color-danger);\n    text-align: center;\n    margin-bottom: 1rem;\n    animation: fadeIn-85e1d8c6 0.3s ease;\n}\n.success-message[data-v-85e1d8c6] {\n    color: #7fb069;\n    text-align: center;\n    margin-bottom: 1rem;\n    animation: fadeIn-85e1d8c6 0.3s ease;\n}\n.form-actions[data-v-85e1d8c6] {\n    display: flex;\n    justify-content: space-between;\n    gap: 1rem;\n    margin-top: 2rem;\n}\n.form-footer[data-v-85e1d8c6] {\n    text-align: center;\n    margin-top: 1.5rem;\n    padding-top: 1.5rem;\n    border-top: 1px solid var(--color-border);\n}\n.link[data-v-85e1d8c6] {\n    color: var(--color-primary);\n    text-decoration: none;\n    transition: var(--transition-fast);\n}\n.link[data-v-85e1d8c6]:hover {\n    color: var(--color-primary-hover);\n    text-decoration: underline;\n}\n.btn[data-v-85e1d8c6] {\n  padding: 0.8rem 1.5rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.btn[data-v-85e1d8c6]:hover:not(:disabled) {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.btn[data-v-85e1d8c6]:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.btn-secondary[data-v-85e1d8c6] {\n  background: var(--color-surface);\n}\n@keyframes fadeIn-85e1d8c6 {\nfrom { opacity: 0; transform: translateY(-10px);\n}\nto { opacity: 1; transform: translateY(0);\n}\n}\n",""]);const s=i},9399:(e,n,t)=>{"use strict";t.d(n,{A:()=>p});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o),s=t(4417),l=t.n(s),c=new URL(t(2814),t.b),d=i()(r()),u=l()(c);d.push([e.id,`\n.workshop-container[data-v-7e1e6f52] {\n  width: 100%;\n  height: 100vh;\n  height: 100svh;\n  height: 100dvh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  padding-top: calc(16px + env(safe-area-inset-top));\n  padding-bottom: calc(16px + env(safe-area-inset-bottom));\n  box-sizing: border-box;\n  overflow: hidden;\n}\n.workshop-panel[data-v-7e1e6f52] {\n  width: 100%;\n  max-width: 960px;\n  max-height: calc(100vh - 32px);\n  max-height: calc(100svh - 32px);\n  max-height: calc(100dvh - 32px);\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  padding: 0;\n  color: var(--color-text);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  min-height: 0;\n}\n\n/* 顶部标题区域 - 层次感设计 */\n.header-section[data-v-7e1e6f52] {\n  flex: 0 0 auto;\n  position: relative;\n  padding: 1.25rem 1.5rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  background: linear-gradient(180deg,\n    rgba(147, 197, 253, 0.08) 0%,\n    rgba(147, 197, 253, 0.02) 50%,\n    transparent 100%\n  );\n}\n.header-bg[data-v-7e1e6f52] {\n  position: absolute;\n  inset: 0;\n  background: radial-gradient(ellipse 80% 50% at 50% 0%, rgba(147, 197, 253, 0.1) 0%, transparent 70%);\n  pointer-events: none;\n}\n.header-content[data-v-7e1e6f52] {\n  position: relative;\n  z-index: 1;\n}\n.title-row[data-v-7e1e6f52] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.title-group[data-v-7e1e6f52] {\n  display: flex;\n  align-items: center;\n  gap: 0.65rem;\n}\n.title-icon-wrapper[data-v-7e1e6f52] {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 10px;\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.2) 0%, rgba(147, 197, 253, 0.1) 100%);\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  color: var(--color-primary);\n}\n.title[data-v-7e1e6f52] {\n  margin: 0;\n  font-family: var(--font-family-serif);\n  font-size: 1.35rem;\n  font-weight: 700;\n  color: var(--color-text);\n  letter-spacing: -0.01em;\n}\n.auth-pill[data-v-7e1e6f52] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.35rem 0.65rem;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  user-select: none;\n  white-space: nowrap;\n  font-size: 0.8rem;\n}\n.auth-pill.ok[data-v-7e1e6f52] {\n  border-color: rgba(16, 185, 129, 0.4);\n  background: rgba(16, 185, 129, 0.08);\n  color: #10b981;\n}\n.auth-pill.warn[data-v-7e1e6f52] {\n  border-color: rgba(251, 191, 36, 0.4);\n  background: rgba(251, 191, 36, 0.08);\n  color: #f59e0b;\n}\n.pill-link[data-v-7e1e6f52] {\n  border: none;\n  background: transparent;\n  color: var(--color-primary);\n  cursor: pointer;\n  padding: 0.15rem 0.3rem;\n  font-size: 0.75rem;\n  display: flex;\n  align-items: center;\n  border-radius: 4px;\n  transition: background 0.15s;\n}\n.pill-link[data-v-7e1e6f52]:hover {\n  background: rgba(147, 197, 253, 0.15);\n}\n.subtitle[data-v-7e1e6f52] {\n  margin: 0.5rem 0 0;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n}\n.notice[data-v-7e1e6f52] {\n  margin: 0.35rem 0 0;\n  color: var(--color-text-muted);\n  font-size: 0.78rem;\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n}\n\n/* Tabs */\n.tabs[data-v-7e1e6f52] {\n  flex: 0 0 auto;\n  margin: 0.75rem 1.5rem 0;\n  display: flex;\n  gap: 0.35rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 4px;\n}\n.tab[data-v-7e1e6f52] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.4rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 7px;\n  border: 1px solid transparent;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.85rem;\n}\n.tab[data-v-7e1e6f52]:hover {\n  color: var(--color-text);\n  background: rgba(147, 197, 253, 0.05);\n}\n.tab.active[data-v-7e1e6f52] {\n  background: var(--color-surface);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: var(--color-primary);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n/* Content Area */\n.scroll-content[data-v-7e1e6f52] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 1.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.scroll-content[data-v-7e1e6f52]::-webkit-scrollbar {\n  width: 5px;\n}\n.scroll-content[data-v-7e1e6f52]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.scroll-content[data-v-7e1e6f52]::-webkit-scrollbar-thumb {\n  background: rgba(147, 197, 253, 0.25);\n  border-radius: 3px;\n}\n.scroll-content[data-v-7e1e6f52]::-webkit-scrollbar-thumb:hover {\n  background: rgba(147, 197, 253, 0.4);\n}\n\n/* Filters */\n.filters[data-v-7e1e6f52] {\n  margin-top: 0.75rem;\n  display: flex;\n  gap: 0.6rem;\n  align-items: center;\n  flex-wrap: wrap;\n}\n.filters > select.input[data-v-7e1e6f52] {\n  width: auto;\n  min-width: 120px;\n}\n.search-input-wrapper[data-v-7e1e6f52] {\n  flex: 1;\n  min-width: 180px;\n  position: relative;\n}\n.search-icon[data-v-7e1e6f52] {\n  position: absolute;\n  left: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  color: var(--color-text-muted);\n  pointer-events: none;\n}\n.search-input[data-v-7e1e6f52] {\n  padding-left: 2.2rem;\n}\n.page-size-select[data-v-7e1e6f52] {\n  width: auto;\n  min-width: 100px;\n}\n.btn-icon-only[data-v-7e1e6f52] {\n  padding: 0.55rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Manage Bar */\n.manage-bar[data-v-7e1e6f52] {\n  margin-top: 0.75rem;\n  padding: 0.6rem 0.9rem;\n  border-radius: 10px;\n  background: rgba(147, 197, 253, 0.06);\n  border: 1px solid rgba(147, 197, 253, 0.15);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n}\n.manage-title[data-v-7e1e6f52] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.85rem;\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n}\n.manage-meta[data-v-7e1e6f52] {\n  color: var(--color-text-muted);\n  font-size: 0.78rem;\n}\n\n/* Input */\n.input[data-v-7e1e6f52] {\n  width: 100%;\n  padding: 0.55rem 0.75rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text);\n  outline: none;\n  font-size: 0.85rem;\n  transition: border-color 0.15s;\n}\n.input[data-v-7e1e6f52]:focus {\n  border-color: var(--color-primary);\n}\nselect.input[data-v-7e1e6f52] {\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  background-image: url(${u});\n  background-repeat: no-repeat;\n  background-position: right 0.6rem center;\n  padding-right: 2rem;\n  cursor: pointer;\n}\nselect.input option[data-v-7e1e6f52] {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n.textarea[data-v-7e1e6f52] {\n  min-height: 80px;\n  resize: vertical;\n}\n\n/* Loading & Empty */\n.loading[data-v-7e1e6f52] {\n  margin-top: 2rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.6rem;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.empty[data-v-7e1e6f52] {\n  margin-top: 2rem;\n  padding: 2rem;\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.6rem;\n  color: var(--color-text-muted);\n}\n.empty-icon[data-v-7e1e6f52] {\n  opacity: 0.4;\n}\n.locked-icon[data-v-7e1e6f52] {\n  opacity: 0.5;\n  color: var(--color-text-muted);\n}\n\n/* Item List */\n.item-list[data-v-7e1e6f52] {\n  margin-top: 0.75rem;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n  gap: 0.75rem;\n  padding-bottom: 0.5rem;\n}\n\n/* Item Card */\n.item-card[data-v-7e1e6f52] {\n  padding: 0.85rem 1rem;\n  border-radius: 12px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-sizing: border-box;\n  min-height: 165px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.item-card[data-v-7e1e6f52]:hover {\n  border-color: rgba(147, 197, 253, 0.5);\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  transform: translateY(-2px);\n}\n.item-header[data-v-7e1e6f52] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.item-type-badge[data-v-7e1e6f52] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.3rem;\n  font-size: 0.68rem;\n  font-weight: 500;\n  color: var(--color-primary);\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  padding: 0.2rem 0.5rem;\n  border-radius: 999px;\n  background: rgba(147, 197, 253, 0.08);\n  white-space: nowrap;\n}\n.item-stats[data-v-7e1e6f52] {\n  display: flex;\n  gap: 0.35rem;\n}\n.stat-item[data-v-7e1e6f52] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.2rem;\n  font-size: 0.7rem;\n  padding: 0.15rem 0.4rem;\n  border-radius: 4px;\n  background: transparent;\n}\n.stat-item.downloads[data-v-7e1e6f52] {\n  color: #10b981;\n}\n.stat-value[data-v-7e1e6f52] {\n  font-weight: 600;\n}\n.item-title[data-v-7e1e6f52] {\n  font-weight: 600;\n  font-size: 0.95rem;\n  color: var(--color-text);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  line-height: 1.35;\n  margin-bottom: 0.35rem;\n  word-break: break-word;\n}\n.item-desc[data-v-7e1e6f52] {\n  color: var(--color-text-secondary);\n  font-size: 0.78rem;\n  line-height: 1.45;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  margin-bottom: 0.35rem;\n}\n.item-meta[data-v-7e1e6f52] {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 0.4rem 0.6rem;\n  font-size: 0.72rem;\n  margin-bottom: 0.35rem;\n}\n.meta-author[data-v-7e1e6f52] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  color: var(--color-text-muted);\n}\n.meta-version[data-v-7e1e6f52] {\n  color: var(--color-text-muted);\n  opacity: 0.7;\n  font-size: 0.68rem;\n}\n.tags[data-v-7e1e6f52] {\n  display: flex;\n  gap: 0.25rem;\n  flex-wrap: wrap;\n  overflow: hidden;\n  max-height: 1.4rem;\n  margin-bottom: 0.35rem;\n}\n.tag[data-v-7e1e6f52] {\n  font-size: 0.65rem;\n  padding: 0.1rem 0.35rem;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text-muted);\n  white-space: nowrap;\n}\n.item-actions[data-v-7e1e6f52] {\n  margin-top: auto;\n  padding-top: 0.5rem;\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.4rem;\n}\n\n/* Buttons */\n.btn[data-v-7e1e6f52] {\n  padding: 0.5rem 0.85rem;\n  border-radius: 7px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  font-size: 0.82rem;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.35rem;\n}\n.btn[data-v-7e1e6f52]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.btn[data-v-7e1e6f52]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-sm[data-v-7e1e6f52] {\n  padding: 0.35rem 0.65rem;\n  font-size: 0.78rem;\n}\n.btn-secondary[data-v-7e1e6f52] {\n  background: var(--color-surface);\n}\n.btn-primary[data-v-7e1e6f52] {\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.15) 0%, rgba(147, 197, 253, 0.08) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  color: var(--color-primary);\n}\n.btn-primary[data-v-7e1e6f52]:hover {\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.25) 0%, rgba(147, 197, 253, 0.15) 100%);\n  border-color: rgba(147, 197, 253, 0.5);\n}\n.btn.danger[data-v-7e1e6f52] {\n  border-color: rgba(239, 68, 68, 0.3);\n  background: rgba(239, 68, 68, 0.08);\n  color: #ef4444;\n}\n.btn.danger[data-v-7e1e6f52]:hover {\n  background: rgba(239, 68, 68, 0.15);\n}\n\n/* Pagination */\n.pagination[data-v-7e1e6f52] {\n  margin-top: 1rem;\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.page-meta[data-v-7e1e6f52] {\n  display: flex;\n  gap: 0.75rem;\n  color: var(--color-text-muted);\n  font-size: 0.8rem;\n}\n.page-controls[data-v-7e1e6f52] {\n  display: flex;\n  gap: 0.5rem;\n}\n\n/* Upload */\n.upload-locked[data-v-7e1e6f52] {\n  margin-top: 2rem;\n  padding: 2rem;\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n  text-align: center;\n}\n.upload-form[data-v-7e1e6f52] {\n  margin-top: 1rem;\n  display: grid;\n  gap: 0.8rem;\n}\n.form-row[data-v-7e1e6f52] {\n  display: grid;\n  grid-template-columns: 90px minmax(0, 1fr);\n  gap: 0.6rem;\n  align-items: start;\n}\n.label[data-v-7e1e6f52] {\n  color: var(--color-text);\n  font-weight: 600;\n  font-size: 0.82rem;\n  padding-top: 0.5rem;\n}\n.content-actions[data-v-7e1e6f52] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  align-items: center;\n}\n.file-btn[data-v-7e1e6f52] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.35rem;\n}\n.hint[data-v-7e1e6f52] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.3rem;\n  color: #10b981;\n  font-size: 0.8rem;\n}\n.actions[data-v-7e1e6f52] {\n  margin-top: 1rem;\n  display: flex;\n  justify-content: flex-start;\n  gap: 0.6rem;\n}\n.upload-actions[data-v-7e1e6f52] {\n  margin-top: 1.25rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n}\n\n/* Footer */\n.footer-actions[data-v-7e1e6f52] {\n  flex: 0 0 auto;\n  padding: 0.75rem 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.backend-locked[data-v-7e1e6f52] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n\n/* Modal */\n.modal-overlay[data-v-7e1e6f52] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1600;\n  padding: 16px;\n}\n.modal[data-v-7e1e6f52] {\n  width: min(640px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  border-radius: 14px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);\n}\n.detail-modal[data-v-7e1e6f52] {\n  width: min(520px, 100%);\n}\n.modal-header[data-v-7e1e6f52] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.9rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.05) 0%, transparent 100%);\n}\n.modal-header h3[data-v-7e1e6f52] {\n  margin: 0;\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.close-btn[data-v-7e1e6f52] {\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  width: 30px;\n  height: 30px;\n  border-radius: 8px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  transition: all 0.15s;\n}\n.close-btn[data-v-7e1e6f52]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-7e1e6f52] {\n  padding: 1rem;\n  overflow: auto;\n}\n.loading-body[data-v-7e1e6f52] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.6rem;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.modal-info[data-v-7e1e6f52] {\n  padding: 0.8rem 0.9rem;\n  border-radius: 10px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n}\n.modal-title[data-v-7e1e6f52] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.95rem;\n}\n.modal-sub[data-v-7e1e6f52] {\n  margin-top: 0.4rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.6rem;\n  color: var(--color-text-muted);\n  font-size: 0.8rem;\n}\n.modal-sub span[data-v-7e1e6f52] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n.modal-actions[data-v-7e1e6f52] {\n  margin-top: 0.9rem;\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.import-saves[data-v-7e1e6f52] {\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n}\n\n/* Detail Modal */\n.detail-content[data-v-7e1e6f52] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.7rem;\n}\n.detail-row[data-v-7e1e6f52] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n}\n.detail-label[data-v-7e1e6f52] {\n  flex: 0 0 70px;\n  color: var(--color-text-muted);\n  font-size: 0.8rem;\n}\n.detail-value[data-v-7e1e6f52] {\n  flex: 1;\n  color: var(--color-text);\n  font-size: 0.85rem;\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n}\n.downloads-value[data-v-7e1e6f52] {\n  color: #10b981;\n  font-weight: 600;\n}\n.detail-tags[data-v-7e1e6f52] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.3rem;\n}\n.desc-row[data-v-7e1e6f52] {\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.detail-desc[data-v-7e1e6f52] {\n  margin: 0;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  line-height: 1.5;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n/* Animation */\n.spin[data-v-7e1e6f52] {\n  animation: spin-7e1e6f52 1s linear infinite;\n}\n@keyframes spin-7e1e6f52 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n\n/* Media Queries */\n@media (max-height: 700px) {\n.header-section[data-v-7e1e6f52] {\n    padding: 1rem 1.25rem 0.75rem;\n}\n.title-icon-wrapper[data-v-7e1e6f52] {\n    width: 32px;\n    height: 32px;\n}\n.title[data-v-7e1e6f52] {\n    font-size: 1.2rem;\n}\n}\n@media (max-width: 768px) {\n.workshop-container[data-v-7e1e6f52] {\n    padding: 10px;\n    padding-top: calc(10px + env(safe-area-inset-top));\n    padding-bottom: calc(10px + env(safe-area-inset-bottom));\n}\n.header-section[data-v-7e1e6f52] {\n    padding: 1rem 1rem 0.75rem;\n}\n.tabs[data-v-7e1e6f52] {\n    margin: 0.6rem 1rem 0;\n}\n.scroll-content[data-v-7e1e6f52] {\n    padding: 0 1rem;\n}\n.footer-actions[data-v-7e1e6f52] {\n    padding: 0.6rem 1rem;\n}\n.filters[data-v-7e1e6f52] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.filters > select.input[data-v-7e1e6f52],\n  .page-size-select[data-v-7e1e6f52] {\n    width: 100%;\n}\n.search-input-wrapper[data-v-7e1e6f52] {\n    width: 100%;\n}\n.btn-icon-only[data-v-7e1e6f52] {\n    width: 100%;\n    justify-content: center;\n}\n.item-list[data-v-7e1e6f52] {\n    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n    gap: 0.6rem;\n}\n.item-card[data-v-7e1e6f52] {\n    min-height: 150px;\n    padding: 0.75rem 0.85rem;\n}\n.form-row[data-v-7e1e6f52] {\n    grid-template-columns: 1fr;\n    gap: 0.3rem;\n}\n.label[data-v-7e1e6f52] {\n    padding-top: 0;\n}\n.upload-actions[data-v-7e1e6f52] {\n    flex-direction: column-reverse;\n    gap: 0.5rem;\n}\n.upload-actions .btn[data-v-7e1e6f52] {\n    width: 100%;\n    justify-content: center;\n}\n}\n@media (max-width: 480px) {\n.workshop-container[data-v-7e1e6f52] {\n    padding: 8px;\n    padding-top: calc(8px + env(safe-area-inset-top));\n    padding-bottom: calc(8px + env(safe-area-inset-bottom));\n}\n.workshop-panel[data-v-7e1e6f52] {\n    border-radius: 12px;\n}\n.header-section[data-v-7e1e6f52] {\n    padding: 0.85rem 0.85rem 0.65rem;\n}\n.title-row[data-v-7e1e6f52] {\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.auth-pill[data-v-7e1e6f52] {\n    font-size: 0.72rem;\n    padding: 0.25rem 0.5rem;\n}\n.tabs[data-v-7e1e6f52] {\n    margin: 0.5rem 0.85rem 0;\n}\n.tab[data-v-7e1e6f52] {\n    padding: 0.4rem 0.5rem;\n    font-size: 0.78rem;\n}\n.tab span[data-v-7e1e6f52] {\n    display: none;\n}\n.scroll-content[data-v-7e1e6f52] {\n    padding: 0 0.85rem;\n}\n.footer-actions[data-v-7e1e6f52] {\n    padding: 0.5rem 0.85rem;\n}\n.item-list[data-v-7e1e6f52] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.item-card[data-v-7e1e6f52] {\n    min-height: auto;\n    padding: 0.7rem 0.8rem;\n}\n.item-card[data-v-7e1e6f52]:hover {\n    transform: none;\n}\n.item-title[data-v-7e1e6f52] {\n    font-size: 0.9rem;\n    -webkit-line-clamp: 2;\n}\n.item-desc[data-v-7e1e6f52] {\n    -webkit-line-clamp: 2;\n}\n}\n`,""]);const p=d},9409:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.online-travel-panel[data-v-2831c8c3] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n}\n.notice[data-v-2831c8c3] {\n  margin: 1rem;\n  padding: 1rem;\n  border-radius: 8px;\n  text-align: center;\n}\n.error-indicator[data-v-2831c8c3] { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.3);\n}\n.warning-indicator[data-v-2831c8c3] { background: rgba(245,158,11,0.1); color: #f59e0b; border: 1px solid rgba(245,158,11,0.3);\n}\n\n/* Tabs */\n.tabs-header[data-v-2831c8c3] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface);\n}\n.tabs-nav[data-v-2831c8c3] { display: flex; gap: 0.25rem;\n}\n.tab-btn[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.5rem 1rem;\n  border: none;\n  background: transparent;\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n  cursor: pointer;\n  border-radius: 6px;\n  transition: all 0.15s;\n}\n.tab-btn[data-v-2831c8c3]:hover { background: var(--color-background); color: var(--color-text);\n}\n.tab-btn.active[data-v-2831c8c3] { background: var(--color-primary); color: #fff;\n}\n.header-actions[data-v-2831c8c3] { display: flex; gap: 0.5rem;\n}\n.action-btn[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n  padding: 0.45rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.8rem;\n  cursor: pointer;\n  margin: 5px;\n  transition: all 0.15s;\n}\n.action-btn[data-v-2831c8c3]:hover { border-color: var(--color-primary);\n}\n.action-btn[data-v-2831c8c3]:disabled { opacity: 0.5; cursor: not-allowed;\n}\n.action-btn.primary[data-v-2831c8c3] { background: var(--color-primary); border-color: var(--color-primary); color: #fff;\n}\n.action-btn.sm[data-v-2831c8c3] { padding: 0.35rem 0.6rem; font-size: 0.75rem;\n}\n.tab-content[data-v-2831c8c3] { flex: 1; overflow-y: auto; padding: 1rem;\n}\n\n/* Travel Tab */\n.travel-layout[data-v-2831c8c3] {\n  display: grid;\n  grid-template-columns: 1fr 1.5fr;\n  gap: 1rem;\n  height: 100%;\n}\n\n/* 左侧世界列表面板 */\n.worlds-list-panel[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  overflow: hidden;\n  max-height: 600px;\n}\n.filter-bar[data-v-2831c8c3] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid var(--color-border);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.search-box[data-v-2831c8c3] {\n  flex: 1;\n}\n.search-input[data-v-2831c8c3] {\n  width: 100%;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.search-input[data-v-2831c8c3]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.filter-select[data-v-2831c8c3] {\n  padding: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  cursor: pointer;\n}\n.travel-points-bar[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid var(--color-border);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.points-icon[data-v-2831c8c3] {\n  color: var(--color-primary);\n}\n.points-label[data-v-2831c8c3] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.points-value[data-v-2831c8c3] {\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-primary);\n}\n.worlds-list[data-v-2831c8c3] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n.loading-state[data-v-2831c8c3],\n.empty-state[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-2831c8c3] {\n  opacity: 0.4;\n  margin-bottom: 1rem;\n}\n.world-card[data-v-2831c8c3] {\n  padding: 0.75rem;\n  margin-bottom: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-background);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.world-card[data-v-2831c8c3]:hover {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.world-card.selected[data-v-2831c8c3] {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n  box-shadow: 0 0 0 1px var(--color-primary);\n}\n.world-info[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.owner-name[data-v-2831c8c3] {\n  font-weight: 600;\n  font-size: 0.9375rem;\n  color: var(--color-text);\n}\n.world-meta[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.badge[data-v-2831c8c3] {\n  padding: 0.2rem 0.5rem;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 500;\n}\n.badge-public[data-v-2831c8c3] {\n  background: rgba(34, 197, 94, 0.15);\n  color: #22c55e;\n}\n.badge-hidden[data-v-2831c8c3] {\n  background: rgba(245, 158, 11, 0.15);\n  color: #f59e0b;\n}\n.badge-locked[data-v-2831c8c3] {\n  background: rgba(239, 68, 68, 0.15);\n  color: #ef4444;\n}\n.badge-online[data-v-2831c8c3] {\n  background: rgba(34, 197, 94, 0.15);\n  color: #22c55e;\n}\n.badge-offline[data-v-2831c8c3] {\n  background: rgba(107, 114, 128, 0.15);\n  color: #94a3b8;\n}\n.world-id[data-v-2831c8c3] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.inline-hint[data-v-2831c8c3] {\n  margin-top: 0.5rem;\n  font-size: 0.8rem;\n  line-height: 1.2;\n  color: var(--color-text-secondary);\n}\n.inline-hint.danger[data-v-2831c8c3] {\n  color: #ef4444;\n}\n.load-more-btn[data-v-2831c8c3] {\n  width: 100%;\n  padding: 0.75rem;\n  margin-top: 0.5rem;\n  border: 1px dashed var(--color-border);\n  border-radius: 6px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.load-more-btn[data-v-2831c8c3]:hover:not(:disabled) {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.load-more-btn[data-v-2831c8c3]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n/* 右侧穿越操作面板 */\n.travel-action-panel[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 1.25rem;\n  gap: 1rem;\n}\n.action-panel-header[data-v-2831c8c3] {\n  display: flex;\n  gap: 0.5rem;\n  padding-bottom: 0.75rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.panel-tab[data-v-2831c8c3] {\n  flex: 1;\n  padding: 0.6rem 0.75rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.15s;\n}\n.panel-tab.active[data-v-2831c8c3] {\n  background: rgba(var(--color-primary-rgb), 0.08);\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n  color: var(--color-text);\n}\n.panel-tab[data-v-2831c8c3]:hover:not(.active) {\n  border-color: var(--color-primary);\n  color: var(--color-text);\n}\n.action-panel-body[data-v-2831c8c3] {\n  flex: 1;\n  min-height: 0;\n}\n.selected-world-detail h3[data-v-2831c8c3] {\n  margin: 0 0 1rem 0;\n  font-size: 1.25rem;\n  color: var(--color-text);\n}\n.detail-info[data-v-2831c8c3] {\n  margin-bottom: 1.5rem;\n}\n.info-row[data-v-2831c8c3] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 0;\n  border-bottom: 1px solid var(--color-border);\n}\n.info-row[data-v-2831c8c3]:last-child {\n  border-bottom: none;\n}\n.info-label[data-v-2831c8c3] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-2831c8c3] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.invite-code-section[data-v-2831c8c3] {\n  margin-bottom: 1.5rem;\n}\n.invite-code-section label[data-v-2831c8c3] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.invite-code-input[data-v-2831c8c3] {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.invite-code-input[data-v-2831c8c3]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.invite-code-row[data-v-2831c8c3] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.invite-code-row .invite-code-input[data-v-2831c8c3] {\n  flex: 1;\n}\n.action-buttons[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.session-info-box[data-v-2831c8c3] {\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.session-info-standalone[data-v-2831c8c3] {\n  margin-bottom: 1rem;\n}\n\n/* 🔥 会话头部布局 */\n.session-header[data-v-2831c8c3] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n\n/* 🔥 心跳状态指示器 */\n.heartbeat-indicator[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n}\n.heartbeat-dot[data-v-2831c8c3] {\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  animation: heartbeat-pulse-2831c8c3 2s ease-in-out infinite;\n}\n.heartbeat-normal .heartbeat-dot[data-v-2831c8c3] {\n  background-color: #10b981;\n}\n.heartbeat-warning .heartbeat-dot[data-v-2831c8c3] {\n  background-color: #f59e0b;\n}\n.heartbeat-error .heartbeat-dot[data-v-2831c8c3] {\n  background-color: #ef4444;\n}\n.heartbeat-normal .heartbeat-text[data-v-2831c8c3] {\n  color: #10b981;\n}\n.heartbeat-warning .heartbeat-text[data-v-2831c8c3] {\n  color: #f59e0b;\n}\n.heartbeat-error .heartbeat-text[data-v-2831c8c3] {\n  color: #ef4444;\n}\n@keyframes heartbeat-pulse-2831c8c3 {\n0%, 100% {\n    opacity: 1;\n    transform: scale(1);\n}\n50% {\n    opacity: 0.6;\n    transform: scale(1.2);\n}\n}\n.session-label[data-v-2831c8c3] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.5rem;\n}\n.empty-selection[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 1rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-selection .empty-icon[data-v-2831c8c3] {\n  opacity: 0.3;\n  margin-bottom: 1rem;\n}\n.my-world-info[data-v-2831c8c3] {\n  padding: 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-background);\n  width: 100%;\n}\n.my-world-actions[data-v-2831c8c3] {\n  margin-top: 0.75rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n\n/* 离线代理提示词配置区域 */\n.offline-prompt-section[data-v-2831c8c3] {\n  margin-top: 1rem;\n  padding: 1rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  border-radius: 0.5rem;\n}\n.section-label[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.section-label .hint-text[data-v-2831c8c3] {\n  font-size: 0.75rem;\n  font-weight: 400;\n  color: var(--color-text-secondary);\n  font-style: italic;\n}\n.offline-prompt-textarea[data-v-2831c8c3] {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  font-family: inherit;\n  line-height: 1.5;\n  resize: vertical;\n  min-height: 80px;\n  background: white;\n  color: var(--color-text);\n  transition: border-color 0.2s ease;\n}\n.offline-prompt-textarea[data-v-2831c8c3]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.offline-prompt-textarea[data-v-2831c8c3]:disabled {\n  background: #f3f4f6;\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n.prompt-actions[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  margin-top: 0.75rem;\n}\n.unsaved-hint[data-v-2831c8c3] {\n  font-size: 0.75rem;\n  color: #f59e0b;\n  font-style: italic;\n}\n.info-title[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-weight: 600;\n  margin-bottom: 0.75rem;\n  color: var(--color-text);\n}\n.muted[data-v-2831c8c3] {\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n}\n\n/* Map Tab */\n.empty-state[data-v-2831c8c3] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-2831c8c3] { opacity: 0.4; margin-bottom: 1rem;\n}\n.map-layout[data-v-2831c8c3] { display: grid; grid-template-columns: 1.5fr 1fr; gap: 1rem; height: 100%;\n}\n.map-canvas[data-v-2831c8c3] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 0.5rem;\n}\n.map-canvas-v2[data-v-2831c8c3] {\n  padding: 0;\n  overflow: hidden;\n  min-height: 380px;\n}\n[data-v-2831c8c3] .game-map-panel {\n  height: 100%;\n}\n[data-v-2831c8c3] .game-map-panel .map-container {\n  height: 100%;\n}\n.poi-map[data-v-2831c8c3] { width: 100%; height: 350px;\n}\n.edge-line[data-v-2831c8c3] { stroke: var(--color-border); stroke-width: 2;\n}\n.node[data-v-2831c8c3] { cursor: pointer;\n}\n.node circle[data-v-2831c8c3] { fill: rgba(var(--color-primary-rgb),0.15); stroke: var(--color-primary); stroke-width: 2;\n}\n.node text[data-v-2831c8c3] { font-size: 11px; fill: var(--color-text);\n}\n.node.reachable circle[data-v-2831c8c3] { fill: rgba(34,197,94,0.15); stroke: #22c55e;\n}\n.node.active circle[data-v-2831c8c3] { fill: rgba(var(--color-accent-rgb),0.25); stroke: var(--color-accent);\n}\n.poi-sidebar[data-v-2831c8c3] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n}\n.current-loc[data-v-2831c8c3] { font-weight: 600; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--color-border);\n}\n.poi-list[data-v-2831c8c3] { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 0.4rem;\n}\n.poi-item[data-v-2831c8c3] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  cursor: pointer;\n  transition: all 0.15s;\n}\n.poi-item[data-v-2831c8c3]:hover:not(:disabled) { border-color: var(--color-primary);\n}\n.poi-item[data-v-2831c8c3]:disabled { opacity: 0.5; cursor: not-allowed;\n}\n.poi-item.active[data-v-2831c8c3] { background: rgba(var(--color-accent-rgb),0.1); border-color: var(--color-accent);\n}\n.poi-item.reachable[data-v-2831c8c3] { border-color: #22c55e;\n}\n.poi-name[data-v-2831c8c3] { font-weight: 500; font-size: 0.875rem;\n}\n.poi-meta[data-v-2831c8c3] { font-size: 0.75rem; color: var(--color-text-secondary);\n}\n.owner-loc[data-v-2831c8c3] { font-size: 0.8rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;\n}\n.report-preview[data-v-2831c8c3] { margin-top: 0.35rem; font-size: 0.8rem; color: var(--color-text-secondary);\n}\n\n/* Reports Tab */\n.reports-header[data-v-2831c8c3] { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;\n}\n.report-list[data-v-2831c8c3] { display: flex; flex-direction: column; gap: 0.5rem;\n}\n.report-item[data-v-2831c8c3] {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  font-size: 0.875rem;\n}\n.badge[data-v-2831c8c3] { padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 500;\n}\n.badge.unread[data-v-2831c8c3] { background: rgba(245,158,11,0.15); color: #f59e0b;\n}\n.badge.read[data-v-2831c8c3] { background: rgba(107,114,128,0.15); color: #6b7280;\n}\n.quick-session-list[data-v-2831c8c3] {\n  margin-top: 0.75rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  justify-content: center;\n}\n.log-list[data-v-2831c8c3] { display: flex; flex-direction: column; gap: 0.4rem;\n}\n.log-item[data-v-2831c8c3] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n  padding: 0.6rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface);\n  font-size: 0.875rem;\n}\n.log-time[data-v-2831c8c3] { color: var(--color-text-secondary); font-size: 0.8rem; white-space: nowrap;\n}\n.log-type[data-v-2831c8c3] { color: var(--color-text); font-weight: 600;\n}\n.log-meta[data-v-2831c8c3] { color: var(--color-text-secondary); font-size: 0.8rem;\n}\n.log-meta.note[data-v-2831c8c3] { flex-basis: 100%; white-space: pre-wrap; line-height: 1.4;\n}\n.muted[data-v-2831c8c3] { color: var(--color-text-secondary); font-size: 0.8rem;\n}\n@media (max-width: 768px) {\n.travel-layout[data-v-2831c8c3] {\n    grid-template-columns: 1fr;\n    gap: 0.75rem;\n}\n.worlds-list-panel[data-v-2831c8c3] {\n    max-height: 40vh;\n}\n.filter-bar[data-v-2831c8c3] {\n    flex-direction: column;\n    gap: 0.5rem;\n}\n.travel-action-panel[data-v-2831c8c3] {\n    padding: 1rem;\n}\n.map-layout[data-v-2831c8c3] {\n    grid-template-columns: 1fr;\n}\n.poi-map[data-v-2831c8c3] {\n    height: 250px;\n}\n}\n",""]);const s=i},9443:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n/* ========== 仙途主题变量 ========== */\n.character-details-wrapper[data-v-3e18d0f2] {\n  /* 主题变量映射 */\n  --xiantu-bg-deep: var(--color-background);\n  --xiantu-bg-base: var(--color-background);\n  --xiantu-bg-elevated: var(--color-surface);\n\n  --card-bg: var(--color-surface-transparent);\n  --card-bg-hover: var(--color-surface-light);\n\n  --border-color: var(--color-border);\n  --border-hover: var(--color-border-hover);\n  --border-active: rgba(var(--color-primary-rgb), 0.5);\n\n  --text-primary: var(--color-text);\n  --text-secondary: var(--color-text-secondary);\n  --text-muted: var(--color-text-muted);\n  --text-highlight: var(--color-white-soft);\n\n  --accent-primary: var(--color-primary);\n  --accent-primary-dim: rgba(var(--color-primary-rgb), 0.15);\n  --accent-primary-glow: rgba(var(--color-primary-rgb), 0.4);\n  --accent-primary-bright: var(--color-primary-hover);\n  --accent-cyan: var(--color-primary);\n\n  --accent-gold: var(--color-accent);\n  --accent-gold-dim: rgba(var(--color-accent-rgb), 0.15);\n\n  --accent-green: var(--color-success);\n  --accent-red: var(--color-error);\n  --accent-purple: var(--color-info);\n  --accent-blue: var(--color-info);\n  --accent-orange: var(--color-warning);\n\n  --radius-sm: 6px;\n  --radius-md: 10px;\n  --radius-lg: 14px;\n  --radius-xl: 18px;\n\n  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);\n  --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);\n}\n/* ========== 主容器 ========== */\n.character-details-wrapper[data-v-3e18d0f2] {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  background: var(--xiantu-bg-base);\n  padding: 16px;\n  position: relative;\n}\n\n/* 格子纹理背景 */\n.character-details-wrapper[data-v-3e18d0f2]::before {\n  content: \'\';\n  position: absolute;\n  inset: 0;\n  background-image:\n    linear-gradient(rgba(var(--color-primary-rgb), 0.02) 1px, transparent 1px),\n    linear-gradient(90deg, rgba(var(--color-primary-rgb), 0.02) 1px, transparent 1px);\n  background-size: 40px 40px;\n  pointer-events: none;\n  z-index: 0;\n}\n.character-details-wrapper[data-v-3e18d0f2] > * {\n  position: relative;\n  z-index: 1;\n}\n@media (min-width: 640px) {\n.character-details-wrapper[data-v-3e18d0f2] {\n    padding: 20px;\n}\n}\n@media (min-width: 1024px) {\n.character-details-wrapper[data-v-3e18d0f2] {\n    padding: 24px;\n}\n}\n\n/* ========== 自定义滚动条 ========== */\n.custom-scrollbar[data-v-3e18d0f2]::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n.custom-scrollbar[data-v-3e18d0f2]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.custom-scrollbar[data-v-3e18d0f2]::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, var(--accent-cyan), var(--accent-primary-bright));\n  border-radius: 3px;\n}\n.custom-scrollbar[data-v-3e18d0f2]::-webkit-scrollbar-thumb:hover {\n  background: var(--accent-cyan);\n}\n\n/* ========== 状态容器 ========== */\n.state-container[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 300px;\n  gap: 16px;\n  padding: 40px 20px;\n}\n.loading-spinner[data-v-3e18d0f2] {\n  width: 40px;\n  height: 40px;\n  border: 3px solid var(--border-color);\n  border-top-color: var(--accent-cyan);\n  border-radius: 50%;\n  animation: spin-3e18d0f2 1s linear infinite;\n}\n@keyframes spin-3e18d0f2 {\nto { transform: rotate(360deg);\n}\n}\n.state-text[data-v-3e18d0f2] {\n  color: var(--text-secondary);\n  font-size: 14px;\n}\n.error-icon-wrapper[data-v-3e18d0f2] {\n  color: var(--accent-red);\n  opacity: 0.8;\n}\n.retry-btn[data-v-3e18d0f2] {\n  padding: 10px 24px;\n  background: transparent;\n  border: 1px solid var(--border-color);\n  color: var(--accent-cyan);\n  border-radius: var(--radius-md);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.retry-btn[data-v-3e18d0f2]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-color: var(--border-hover);\n}\n\n/* ========== 玻璃面板基础样式 ========== */\n.glass-panel[data-v-3e18d0f2] {\n  background: var(--card-bg);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-lg);\n  backdrop-filter: blur(10px);\n  position: relative;\n}\n.glass-panel[data-v-3e18d0f2]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, rgba(var(--color-primary-rgb), 0.3), transparent);\n  border-radius: var(--radius-lg) var(--radius-lg) 0 0;\n}\n\n/* ========== 顶部角色卡片 ========== */\n.character-header-card[data-v-3e18d0f2] {\n  padding: 16px;\n  margin-bottom: 16px;\n}\n@media (min-width: 640px) {\n.character-header-card[data-v-3e18d0f2] {\n    padding: 20px;\n    margin-bottom: 20px;\n}\n}\n.header-bg-decoration[data-v-3e18d0f2] {\n  display: none;\n}\n.header-content[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n@media (min-width: 768px) {\n.header-content[data-v-3e18d0f2] {\n    flex-direction: row;\n    flex-wrap: wrap;\n    align-items: flex-start;\n    gap: 20px;\n}\n}\n@media (min-width: 1200px) {\n.header-content[data-v-3e18d0f2] {\n    flex-wrap: nowrap;\n    align-items: center;\n}\n}\n\n/* ========== 头像区域 ========== */\n.profile-section[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 14px;\n  flex-shrink: 0;\n}\n.avatar-container[data-v-3e18d0f2] {\n  position: relative;\n  flex-shrink: 0;\n}\n.avatar-circle[data-v-3e18d0f2] {\n  width: 56px;\n  height: 56px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.3);\n  transition: all 0.2s ease;\n}\n@media (min-width: 640px) {\n.avatar-circle[data-v-3e18d0f2] {\n    width: 64px;\n    height: 64px;\n}\n}\n.avatar-text[data-v-3e18d0f2] {\n  font-size: 22px;\n  font-weight: 700;\n  color: var(--accent-cyan);\n}\n@media (min-width: 640px) {\n.avatar-text[data-v-3e18d0f2] {\n    font-size: 26px;\n}\n}\n.realm-aura[data-v-3e18d0f2] {\n  display: none;\n}\n\n/* 觉醒阶段颜色变体 */\n.avatar-circle[data-realm="qi-refining"][data-v-3e18d0f2] {\n  background: rgba(var(--color-border-rgb), 0.1);\n  border-color: rgba(var(--color-border-rgb), 0.3);\n}\n.avatar-circle[data-realm="qi-refining"] .avatar-text[data-v-3e18d0f2] { color: var(--text-muted);\n}\n.avatar-circle[data-realm="foundation"][data-v-3e18d0f2] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n}\n.avatar-circle[data-realm="foundation"] .avatar-text[data-v-3e18d0f2] { color: var(--color-success);\n}\n.avatar-circle[data-realm="golden-core"][data-v-3e18d0f2] {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: rgba(var(--color-info-rgb), 0.3);\n}\n.avatar-circle[data-realm="golden-core"] .avatar-text[data-v-3e18d0f2] { color: var(--color-info);\n}\n.avatar-circle[data-realm="nascent-soul"][data-v-3e18d0f2] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.avatar-circle[data-realm="nascent-soul"] .avatar-text[data-v-3e18d0f2] { color: var(--color-primary);\n}\n.avatar-circle[data-realm="soul-formation"][data-v-3e18d0f2] {\n  background: rgba(var(--color-accent-rgb), 0.1);\n  border-color: rgba(var(--color-accent-rgb), 0.3);\n}\n.avatar-circle[data-realm="soul-formation"] .avatar-text[data-v-3e18d0f2] { color: var(--color-accent);\n}\n.avatar-circle[data-realm="void-refining"][data-v-3e18d0f2] {\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-color: rgba(var(--color-warning-rgb), 0.3);\n}\n.avatar-circle[data-realm="void-refining"] .avatar-text[data-v-3e18d0f2] { color: var(--color-warning);\n}\n.avatar-circle[data-realm="body-integration"][data-v-3e18d0f2] {\n  background: rgba(var(--color-error-rgb), 0.1);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n}\n.avatar-circle[data-realm="body-integration"] .avatar-text[data-v-3e18d0f2] { color: var(--color-error);\n}\n.avatar-circle[data-realm="tribulation"][data-v-3e18d0f2],\n.avatar-circle[data-realm="custom"][data-v-3e18d0f2] {\n  background: rgba(var(--color-accent-rgb), 0.1);\n  border-color: rgba(var(--color-accent-rgb), 0.3);\n}\n.avatar-circle[data-realm="tribulation"] .avatar-text[data-v-3e18d0f2],\n.avatar-circle[data-realm="custom"] .avatar-text[data-v-3e18d0f2] { color: var(--color-accent);\n}\n\n/* ========== 身份信息 ========== */\n.identity-info[data-v-3e18d0f2] {\n  min-width: 0;\n}\n.character-name[data-v-3e18d0f2] {\n  font-size: 20px;\n  font-weight: 700;\n  color: var(--text-primary);\n  margin: 0 0 8px 0;\n  line-height: 1.2;\n}\n@media (min-width: 640px) {\n.character-name[data-v-3e18d0f2] {\n    font-size: 24px;\n}\n}\n.text-gradient[data-v-3e18d0f2] {\n  background: linear-gradient(90deg, var(--accent-cyan), var(--accent-primary-bright));\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n.character-tags[data-v-3e18d0f2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  align-items: center;\n}\n.tag-badge[data-v-3e18d0f2] {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 3px 10px;\n  font-size: 12px;\n  border-radius: var(--radius-sm);\n  font-weight: 500;\n}\n.tag-badge.gender.male[data-v-3e18d0f2] {\n  background: rgba(var(--color-info-rgb), 0.15);\n  color: var(--color-info);\n  border: 1px solid rgba(var(--color-info-rgb), 0.3);\n}\n.tag-badge.gender.female[data-v-3e18d0f2] {\n  background: rgba(var(--color-accent-rgb), 0.15);\n  color: var(--color-accent);\n  border: 1px solid rgba(var(--color-accent-rgb), 0.3);\n}\n.meta-chip[data-v-3e18d0f2] {\n  display: inline-flex;\n  align-items: center;\n  padding: 3px 10px;\n  font-size: 12px;\n  background: rgba(var(--color-primary-rgb), 0.08);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  color: var(--text-secondary);\n  border-radius: var(--radius-sm);\n}\n.link-chip[data-v-3e18d0f2] {\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.link-chip[data-v-3e18d0f2]:hover {\n  background: rgba(var(--color-primary-rgb), 0.15);\n  border-color: rgba(var(--color-primary-rgb), 0.4);\n  color: var(--accent-primary);\n}\n\n/* ========== 核心数值区域 ========== */\n.stats-overview[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  width: 100%;\n}\n@media (min-width: 480px) {\n.stats-overview[data-v-3e18d0f2] {\n    flex-direction: row;\n    flex-wrap: wrap;\n}\n}\n@media (min-width: 768px) {\n.stats-overview[data-v-3e18d0f2] {\n    flex: 1;\n    min-width: 280px;\n}\n}\n.stat-mini-card[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n  min-width: 120px;\n  flex: 1 1 auto;\n}\n.icon-box[data-v-3e18d0f2] {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n.icon-box.realm[data-v-3e18d0f2] {\n  color: var(--accent-gold);\n}\n.icon-box.spirit[data-v-3e18d0f2] {\n  color: var(--accent-primary);\n}\n.icon-box.location[data-v-3e18d0f2] {\n  color: var(--accent-green);\n}\n.stat-info[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  min-width: 0;\n}\n.stat-info .label[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.stat-info .value[data-v-3e18d0f2] {\n  font-size: 13px;\n  font-weight: 600;\n  color: var(--text-primary);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.stat-info .value.wrap[data-v-3e18d0f2] {\n  white-space: normal;\n  word-break: break-all;\n  line-height: 1.3;\n}\n.stat-info .value.highlight[data-v-3e18d0f2] {\n  color: var(--accent-gold);\n}\n\n/* ========== 修为进度区域 ========== */\n.cultivation-block[data-v-3e18d0f2] {\n  flex-shrink: 0;\n  min-width: 180px;\n  max-width: 100%;\n}\n@media (min-width: 768px) {\n.cultivation-block[data-v-3e18d0f2] {\n    max-width: 240px;\n}\n}\n.animal-stage[data-v-3e18d0f2],\n.waiting-stage[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px 16px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n  color: var(--text-secondary);\n  font-size: 13px;\n}\n.floating-icon[data-v-3e18d0f2] {\n  color: var(--accent-green);\n}\n.progress-wrapper[data-v-3e18d0f2] {\n  padding: 12px 16px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n}\n.progress-top[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.progress-label[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-muted);\n}\n.progress-percent[data-v-3e18d0f2] {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--accent-primary);\n}\n.progress-track[data-v-3e18d0f2] {\n  height: 6px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.progress-fill[data-v-3e18d0f2] {\n  height: 100%;\n  background: linear-gradient(90deg, var(--accent-primary), var(--accent-primary-bright));\n  border-radius: 3px;\n  position: relative;\n}\n.flow-effect[data-v-3e18d0f2] {\n  display: none;\n}\n.progress-details[data-v-3e18d0f2] {\n  margin-top: 8px;\n  font-size: 11px;\n  color: var(--text-muted);\n  text-align: center;\n}\n\n/* ========== 标签页导航 ========== */\n.tabs-nav-wrapper[data-v-3e18d0f2] {\n  margin-bottom: 16px;\n  overflow-x: auto;\n  -webkit-overflow-scrolling: touch;\n}\n.tabs-nav-wrapper[data-v-3e18d0f2]::-webkit-scrollbar {\n  display: none;\n}\n.tabs-nav[data-v-3e18d0f2] {\n  display: flex;\n  gap: 4px;\n  padding: 4px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-lg);\n  min-width: max-content;\n}\n.nav-tab[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 10px 16px;\n  background: transparent;\n  border: none;\n  border-radius: var(--radius-md);\n  color: var(--text-muted);\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  position: relative;\n  white-space: nowrap;\n}\n.nav-tab[data-v-3e18d0f2]:hover {\n  color: var(--text-secondary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.nav-tab.active[data-v-3e18d0f2] {\n  color: var(--accent-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n}\n.active-indicator[data-v-3e18d0f2] {\n  display: none;\n}\n\n/* ========== 内容面板和网格 ========== */\n.tab-pane[data-v-3e18d0f2] {\n  animation: fadeIn-3e18d0f2 0.2s ease;\n}\n@keyframes fadeIn-3e18d0f2 {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n.pane-grid[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 16px;\n}\n@media (min-width: 768px) {\n.pane-grid[data-v-3e18d0f2] {\n    grid-template-columns: repeat(2, 1fr);\n}\n}\n.info-card[data-v-3e18d0f2] {\n  padding: 16px;\n}\n@media (min-width: 640px) {\n.info-card[data-v-3e18d0f2] {\n    padding: 20px;\n}\n}\n.info-card.full-width[data-v-3e18d0f2] {\n  grid-column: 1 / -1;\n}\n.card-header[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  margin-bottom: 16px;\n  padding-bottom: 12px;\n  border-bottom: 1px solid var(--border-color);\n}\n.card-header h3[data-v-3e18d0f2] {\n  font-size: 15px;\n  font-weight: 600;\n  color: var(--text-primary);\n  margin: 0;\n}\n.header-icon[data-v-3e18d0f2] {\n  color: var(--text-muted);\n  width: auto;\n  height: auto;\n  background: none;\n  border: none;\n  border-radius: 0;\n  font-size: inherit;\n}\n.header-icon.red[data-v-3e18d0f2] { color: var(--accent-red);\n}\n.header-icon.blue[data-v-3e18d0f2] { color: var(--accent-blue);\n}\n.header-icon.gold[data-v-3e18d0f2] { color: var(--accent-gold);\n}\n.header-icon.purple[data-v-3e18d0f2] { color: var(--accent-purple);\n}\n.header-icon.ink[data-v-3e18d0f2] { color: var(--text-secondary);\n}\n\n/* ========== 生命值条 ========== */\n.vitals-container[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.vital-row[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.vital-meta[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.vital-name[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-secondary);\n}\n.vital-nums[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-muted);\n  font-family: monospace;\n}\n.vital-nums .divider[data-v-3e18d0f2] {\n  opacity: 0.5;\n  margin: 0 2px;\n  background: transparent;\n}\n.vital-track[data-v-3e18d0f2] {\n  height: 6px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.vital-bar[data-v-3e18d0f2] {\n  height: 100%;\n  border-radius: 3px;\n  transition: width 0.3s ease;\n}\n.vital-bar.red-bar[data-v-3e18d0f2] { background: var(--accent-red);\n}\n.vital-bar.blue-bar[data-v-3e18d0f2] { background: var(--accent-blue);\n}\n.vital-bar.gold-bar[data-v-3e18d0f2] { background: var(--accent-gold);\n}\n.vital-bar.purple-bar[data-v-3e18d0f2] { background: var(--accent-purple);\n}\n.reputation-badge[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-sm);\n  margin-top: 4px;\n}\n.rep-label[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-muted);\n}\n.rep-value[data-v-3e18d0f2] {\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--accent-gold);\n}\n\n/* ========== 天赋灵根 ========== */\n.talent-layout[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 14px;\n}\n.spirit-root-banner[data-v-3e18d0f2] {\n  padding: 14px 16px;\n  border-radius: var(--radius-md);\n  position: relative;\n  overflow: hidden;\n}\n.spirit-root-banner.spirit-common[data-v-3e18d0f2] {\n  background: rgba(var(--color-border-rgb), 0.1);\n  border: 1px solid rgba(var(--color-border-rgb), 0.2);\n}\n.spirit-root-banner.spirit-earth[data-v-3e18d0f2] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.25);\n}\n.spirit-root-banner.spirit-divine[data-v-3e18d0f2] {\n  background: var(--accent-gold-dim);\n  border: 1px solid rgba(var(--color-accent-rgb), 0.3);\n}\n.banner-content[data-v-3e18d0f2] {\n  position: relative;\n  z-index: 1;\n}\n.root-type[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n  display: block;\n  margin-bottom: 4px;\n}\n.root-main[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.root-name[data-v-3e18d0f2] {\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--text-primary);\n}\n.root-grade.badge[data-v-3e18d0f2] {\n  font-size: 11px;\n  padding: 2px 8px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: var(--radius-sm);\n  color: var(--text-secondary);\n}\n.tap-hint[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n  margin-top: 6px;\n  display: block;\n}\n.banner-bg-icon[data-v-3e18d0f2] {\n  position: absolute;\n  right: 12px;\n  top: 50%;\n  transform: translateY(-50%);\n  opacity: 0.08;\n  color: var(--text-primary);\n}\n.banner-bg-icon svg[data-v-3e18d0f2] {\n  width: 48px;\n  height: 48px;\n}\n.clickable[data-v-3e18d0f2] {\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.clickable[data-v-3e18d0f2]:hover {\n  border-color: var(--border-hover);\n}\n\n/* ========== 天赋标签 ========== */\n.talents-grid[data-v-3e18d0f2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.talent-chip[data-v-3e18d0f2] {\n  padding: 6px 12px;\n  font-size: 12px;\n  border-radius: var(--radius-sm);\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  color: var(--text-secondary);\n}\n.talent-chip.tier-chip[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n.chip-label[data-v-3e18d0f2] {\n  color: var(--text-muted);\n}\n.chip-val.tier-text[data-v-3e18d0f2] {\n  color: var(--accent-primary);\n  font-weight: 500;\n}\n.talent-chip.trait-chip[data-v-3e18d0f2] {\n  color: var(--accent-purple);\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: rgba(var(--color-info-rgb), 0.2);\n}\n.talent-chip.empty[data-v-3e18d0f2] {\n  color: var(--text-muted);\n  font-style: italic;\n}\n\n/* ========== 属性属性 ========== */\n.attributes-wrapper[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.attr-group.final[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 10px;\n}\n@media (min-width: 640px) {\n.attr-group.final[data-v-3e18d0f2] {\n    grid-template-columns: repeat(6, 1fr);\n}\n}\n.attr-box[data-v-3e18d0f2] {\n  text-align: center;\n  padding: 12px 8px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n}\n.attr-box .attr-key[data-v-3e18d0f2] {\n  display: block;\n  font-size: 11px;\n  color: var(--text-muted);\n  margin-bottom: 4px;\n}\n.attr-box .attr-val[data-v-3e18d0f2] {\n  display: block;\n  font-size: 18px;\n  font-weight: 700;\n  color: var(--accent-primary);\n}\n.attr-divider[data-v-3e18d0f2] {\n  text-align: center;\n  position: relative;\n  padding: 8px 0;\n}\n.attr-divider[data-v-3e18d0f2]::before {\n  content: \'\';\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 50%;\n  height: 1px;\n}\n.attr-divider span[data-v-3e18d0f2] {\n  position: relative;\n  background: var(--card-bg);\n  padding: 0 12px;\n  font-size: 11px;\n  color: var(--text-muted);\n}\n.attr-breakdown[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 16px;\n}\n.breakdown-col[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.mini-attr[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  padding: 6px 10px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-sm);\n  font-size: 12px;\n}\n.mini-attr .k[data-v-3e18d0f2] {\n  color: var(--text-muted);\n}\n.mini-attr .v[data-v-3e18d0f2] {\n  color: var(--text-secondary);\n}\n.mini-attr.green .v[data-v-3e18d0f2] {\n  color: var(--accent-green);\n}\n\n/* ========== 功法卡片 ========== */\n.technique-container[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.technique-master-card[data-v-3e18d0f2] {\n  padding: 14px 16px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n}\n.tm-header[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n.tm-name[data-v-3e18d0f2] {\n  font-size: 15px;\n  font-weight: 600;\n  color: var(--text-primary);\n}\n.tm-badges[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.tm-badges .badge[data-v-3e18d0f2] {\n  font-size: 11px;\n  padding: 2px 8px;\n  background: var(--accent-gold-dim);\n  color: var(--accent-gold);\n  border-radius: var(--radius-sm);\n}\n.transition-icon[data-v-3e18d0f2] {\n  color: var(--text-muted);\n  transition: transform 0.2s ease;\n}\n.rotate-180[data-v-3e18d0f2] {\n  transform: rotate(180deg);\n}\n.tm-progress[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 12px;\n  color: var(--text-muted);\n}\n.tm-progress .bar-bg[data-v-3e18d0f2] {\n  flex: 1;\n  height: 4px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.tm-progress .bar-fg[data-v-3e18d0f2] {\n  height: 100%;\n  background: var(--accent-gold);\n  border-radius: 2px;\n}\n\n/* 功法详情面板 */\n.technique-detail-panel[data-v-3e18d0f2] {\n  padding: 14px;\n  background: var(--xiantu-bg-deep);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n}\n.detail-section[data-v-3e18d0f2] {\n  margin-bottom: 12px;\n}\n.detail-section[data-v-3e18d0f2]:last-child {\n  margin-bottom: 0;\n}\n.section-label[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n  margin-bottom: 6px;\n  text-transform: uppercase;\n}\n.desc-text[data-v-3e18d0f2] {\n  font-size: 13px;\n  color: var(--text-secondary);\n  line-height: 1.5;\n  margin: 0;\n}\n.effects-box[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.effect-row[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 12px;\n}\n.effect-icon[data-v-3e18d0f2] {\n  color: var(--accent-primary);\n}\n.effect-label[data-v-3e18d0f2] {\n  color: var(--text-muted);\n}\n.effect-value[data-v-3e18d0f2] {\n  color: var(--accent-green);\n  font-weight: 500;\n  margin-left: auto;\n}\n\n/* ========== 技能网格 ========== */\n.skills-grid-wrapper[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 280px;\n  overflow-y: auto;\n}\n.skill-card[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n}\n.skill-icon-placeholder[data-v-3e18d0f2] {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--accent-primary-dim);\n  border-radius: var(--radius-sm);\n  color: var(--accent-primary);\n  font-weight: 600;\n  font-size: 14px;\n  flex-shrink: 0;\n}\n.skill-info[data-v-3e18d0f2] {\n  flex: 1;\n  min-width: 0;\n}\n.skill-name[data-v-3e18d0f2] {\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--text-primary);\n}\n.skill-meta[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n}\n.skill-prof[data-v-3e18d0f2] {\n  font-size: 12px;\n  font-weight: 600;\n  color: var(--accent-primary);\n}\n\n/* ========== 三千大道 ========== */\n.toggle-header[data-v-3e18d0f2] {\n  cursor: pointer;\n}\n.toggle-header[data-v-3e18d0f2]:hover {\n  background: rgba(255, 255, 255, 0.02);\n}\n.flex-row[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n.header-actions[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-left: auto;\n}\n.text-mini[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n}\n.dao-grid[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 10px;\n}\n@media (min-width: 640px) {\n.dao-grid[data-v-3e18d0f2] {\n    grid-template-columns: repeat(4, 1fr);\n}\n}\n.dao-pill[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-md);\n}\n.dao-char[data-v-3e18d0f2] {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--accent-gold-dim);\n  border-radius: var(--radius-sm);\n  color: var(--accent-gold);\n  font-weight: 700;\n  font-size: 14px;\n  flex-shrink: 0;\n}\n.dao-content[data-v-3e18d0f2] {\n  flex: 1;\n  min-width: 0;\n}\n.dao-name[data-v-3e18d0f2] {\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--text-primary);\n  margin-bottom: 4px;\n}\n.dao-progress-mini[data-v-3e18d0f2] {\n  height: 3px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.dao-progress-mini .fill[data-v-3e18d0f2] {\n  height: 100%;\n  background: var(--accent-gold);\n  border-radius: 2px;\n}\n\n/* ========== 社交页面 ========== */\n.stat-row[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 12px;\n}\n.stat-item.big-num[data-v-3e18d0f2] {\n  text-align: center;\n  padding: 16px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-md);\n}\n.stat-item.big-num span[data-v-3e18d0f2] {\n  display: block;\n  font-size: 28px;\n  font-weight: 700;\n  color: var(--accent-primary);\n}\n.stat-item.big-num label[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-muted);\n  margin-top: 4px;\n  display: block;\n}\n.relationship-list[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 300px;\n  overflow-y: auto;\n}\n.relationship-row[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-md);\n}\n.rel-main[data-v-3e18d0f2] {\n  min-width: 0;\n}\n.rel-name[data-v-3e18d0f2] {\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--text-primary);\n}\n.rel-meta[data-v-3e18d0f2] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 11px;\n  color: var(--text-muted);\n  margin-top: 2px;\n}\n.rel-tag[data-v-3e18d0f2] {\n  padding: 1px 6px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 3px;\n}\n.rel-tag.special[data-v-3e18d0f2] {\n  background: var(--accent-gold-dim);\n  color: var(--accent-gold);\n}\n.rel-dot[data-v-3e18d0f2] {\n  opacity: 0.3;\n}\n.rel-fav[data-v-3e18d0f2] {\n  font-size: 14px;\n  font-weight: 600;\n  padding: 4px 10px;\n  border-radius: var(--radius-sm);\n}\n.rel-fav.fav-high[data-v-3e18d0f2] {\n  background: rgba(92, 232, 160, 0.15);\n  color: var(--accent-green);\n}\n.rel-fav.fav-mid[data-v-3e18d0f2] {\n  background: var(--accent-primary-dim);\n  color: var(--accent-primary);\n}\n.rel-fav.fav-neutral[data-v-3e18d0f2] {\n  background: rgba(255, 255, 255, 0.05);\n  color: var(--text-secondary);\n}\n.rel-fav.fav-low[data-v-3e18d0f2] {\n  background: rgba(232, 92, 108, 0.15);\n  color: var(--accent-red);\n}\n\n/* ========== 宗门信息 ========== */\n.sect-grid[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n}\n.kv[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  padding: 8px 10px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-sm);\n  font-size: 12px;\n}\n.kv .k[data-v-3e18d0f2] {\n  color: var(--text-muted);\n}\n.kv .v[data-v-3e18d0f2] {\n  color: var(--text-secondary);\n}\n.kv .v.highlight[data-v-3e18d0f2] {\n  color: var(--accent-gold);\n}\n\n/* ========== 物品页面 ========== */\n.inventory-stats-grid[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 12px;\n  margin-bottom: 16px;\n}\n.inv-stat[data-v-3e18d0f2] {\n  text-align: center;\n  padding: 14px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-md);\n}\n.inv-stat .num[data-v-3e18d0f2] {\n  display: block;\n  font-size: 24px;\n  font-weight: 700;\n  color: var(--accent-primary);\n}\n.inv-stat .num.gold-text[data-v-3e18d0f2] {\n  color: var(--accent-gold);\n}\n.inv-stat .lbl[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n  margin-top: 2px;\n  display: block;\n}\n.spirit-stones-grid[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n}\n@media (min-width: 480px) {\n.spirit-stones-grid[data-v-3e18d0f2] {\n    grid-template-columns: repeat(4, 1fr);\n}\n}\n.stone-kv[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  padding: 8px 10px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-sm);\n  font-size: 12px;\n}\n.stone-kv .k[data-v-3e18d0f2] {\n  color: var(--text-muted);\n}\n.stone-kv .v[data-v-3e18d0f2] {\n  color: var(--accent-gold);\n  font-weight: 500;\n}\n\n/* 物品列表 */\n.inventory-preview[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  max-height: 280px;\n  overflow-y: auto;\n}\n.inv-row[data-v-3e18d0f2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 12px;\n  background: var(--xiantu-bg-elevated);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-sm);\n}\n.inv-main[data-v-3e18d0f2] {\n  min-width: 0;\n}\n.inv-name[data-v-3e18d0f2] {\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--text-primary);\n}\n.inv-meta[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n}\n.inv-qty[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-secondary);\n  font-family: monospace;\n}\n\n/* 品质颜色 */\n.quality-legendary .inv-name[data-v-3e18d0f2] { color: #FF0000;\n}\n.quality-epic .inv-name[data-v-3e18d0f2] { color: #FFD700;\n}\n.quality-rare .inv-name[data-v-3e18d0f2] { color: #9932CC;\n}\n.quality-fine .inv-name[data-v-3e18d0f2] { color: #00CED1;\n}\n.quality-common .inv-name[data-v-3e18d0f2] { color: #FFFFFF;\n}\n.quality-rough .inv-name[data-v-3e18d0f2] { color: #808080;\n}\n.quality-broken .inv-name[data-v-3e18d0f2] { color: #666666;\n}\n\n/* ========== 空状态占位符 ========== */\n.empty-placeholder[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 32px 16px;\n  color: var(--text-muted);\n  text-align: center;\n}\n.empty-placeholder p[data-v-3e18d0f2] {\n  margin: 8px 0 0;\n  font-size: 13px;\n}\n.empty-placeholder.text-sm[data-v-3e18d0f2] {\n  padding: 20px 12px;\n}\n.empty-placeholder.text-sm p[data-v-3e18d0f2] {\n  font-size: 12px;\n}\n.count-badge[data-v-3e18d0f2] {\n  font-size: 11px;\n  padding: 2px 8px;\n  background: var(--accent-primary-dim);\n  color: var(--accent-primary);\n  border-radius: 10px;\n  margin-left: 6px;\n}\n\n/* ========== 弹窗样式 ========== */\n.modal-overlay[data-v-3e18d0f2] {\n  position: fixed;\n  inset: 0;\n  background: rgba(8, 12, 20, 0.85);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  z-index: 1000;\n}\n.modal-card[data-v-3e18d0f2] {\n  width: 100%;\n  max-width: 420px;\n  max-height: 80vh;\n  padding: 24px;\n  position: relative;\n}\n.close-float[data-v-3e18d0f2] {\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-sm);\n  color: var(--text-muted);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.close-float[data-v-3e18d0f2]:hover {\n  background: rgba(232, 92, 108, 0.1);\n  border-color: var(--accent-red);\n  color: var(--accent-red);\n}\n.modal-inner[data-v-3e18d0f2] {\n  padding-right: 24px;\n}\n.modal-title[data-v-3e18d0f2] {\n  font-size: 20px;\n  font-weight: 700;\n  color: var(--text-primary);\n  margin: 0 0 4px;\n}\n.modal-subtitle[data-v-3e18d0f2] {\n  font-size: 12px;\n  color: var(--text-muted);\n  margin: 0 0 16px;\n}\n.modal-body-scroller[data-v-3e18d0f2] {\n  max-height: 50vh;\n  overflow-y: auto;\n}\n\n/* 弹窗详情网格 */\n.detail-grid[data-v-3e18d0f2] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 10px;\n  margin-bottom: 14px;\n}\n.d-item[data-v-3e18d0f2] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-sm);\n}\n.d-item label[data-v-3e18d0f2] {\n  font-size: 11px;\n  color: var(--text-muted);\n}\n.d-item span[data-v-3e18d0f2] {\n  font-size: 14px;\n  font-weight: 500;\n  color: var(--text-primary);\n}\n.d-item span.highlight[data-v-3e18d0f2] {\n  color: var(--accent-green);\n}\n.tags-row[data-v-3e18d0f2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-bottom: 14px;\n}\n.tag-pill[data-v-3e18d0f2] {\n  padding: 4px 10px;\n  font-size: 12px;\n  background: var(--accent-primary-dim);\n  color: var(--accent-primary);\n  border-radius: var(--radius-sm);\n}\n.d-desc-box[data-v-3e18d0f2] {\n  padding: 12px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-md);\n  font-size: 13px;\n  color: var(--text-secondary);\n  line-height: 1.6;\n}\n\n/* 大进度条 */\n.progress-big[data-v-3e18d0f2] {\n  height: 24px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-md);\n  overflow: hidden;\n  position: relative;\n  margin-bottom: 14px;\n}\n.progress-big .fill[data-v-3e18d0f2] {\n  height: 100%;\n  background: linear-gradient(90deg, var(--accent-gold), var(--color-accent-hover));\n  border-radius: var(--radius-md);\n}\n.progress-big .text[data-v-3e18d0f2] {\n  position: absolute;\n  inset: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  font-weight: 600;\n  color: var(--text-primary);\n}\n.skill-stat-row[data-v-3e18d0f2] {\n  padding: 10px 12px;\n  background: var(--xiantu-bg-elevated);\n  border-radius: var(--radius-sm);\n  font-size: 13px;\n  color: var(--text-secondary);\n}\n\n/* ========== 过渡动画 ========== */\n.fade-enter-active[data-v-3e18d0f2],\n.fade-leave-active[data-v-3e18d0f2] {\n  transition: opacity 0.2s ease;\n}\n.fade-enter-from[data-v-3e18d0f2],\n.fade-leave-to[data-v-3e18d0f2] {\n  opacity: 0;\n}\n.slide-fade-enter-active[data-v-3e18d0f2],\n.slide-fade-leave-active[data-v-3e18d0f2] {\n  transition: all 0.2s ease;\n}\n.slide-fade-enter-from[data-v-3e18d0f2] {\n  opacity: 0;\n  transform: translateY(8px);\n}\n.slide-fade-leave-to[data-v-3e18d0f2] {\n  opacity: 0;\n  transform: translateY(-8px);\n}\n.expand-enter-active[data-v-3e18d0f2],\n.expand-leave-active[data-v-3e18d0f2] {\n  transition: all 0.2s ease;\n  overflow: hidden;\n}\n.expand-enter-from[data-v-3e18d0f2],\n.expand-leave-to[data-v-3e18d0f2] {\n  opacity: 0;\n  max-height: 0;\n}\n.modal-fade-enter-active[data-v-3e18d0f2],\n.modal-fade-leave-active[data-v-3e18d0f2] {\n  transition: opacity 0.2s ease;\n}\n.modal-fade-enter-from[data-v-3e18d0f2],\n.modal-fade-leave-to[data-v-3e18d0f2] {\n  opacity: 0;\n}\n',""]);const s=i},9525:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.video-background-container[data-v-2821712e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: -10;\n  pointer-events: none;\n  background-color: #1a1b26; /* 简单的暗色背景作为备用 */\n}\n.video-background[data-v-2821712e] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transform: translate(-50%, -50%);\n  z-index: -2;\n  filter: brightness(1.15) saturate(1.1);\n}\n.video-overlay[data-v-2821712e] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(10, 15, 24, 0);\n  z-index: -1;\n}\n",""]);const s=i},9531:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-3fadd167] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-3fadd167] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-3fadd167 0.3s ease-out;\n}\n@keyframes slideUp-3fadd167 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-3fadd167] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-3fadd167] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-3fadd167] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-3fadd167]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-3fadd167] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n\n/* Upload Area */\n.upload-area[data-v-3fadd167] {\n  border: 2px dashed var(--color-border);\n  border-radius: 12px;\n  padding: 2rem;\n  text-align: center;\n  transition: all 0.3s ease;\n  cursor: pointer;\n  background: var(--color-surface-light);\n}\n.upload-area[data-v-3fadd167]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.upload-area.drag-over[data-v-3fadd167] {\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n  transform: scale(1.02);\n}\n.file-input[data-v-3fadd167] {\n  display: none;\n}\n.upload-content[data-v-3fadd167] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n}\n.upload-icon[data-v-3fadd167] {\n  font-size: 3rem;\n  opacity: 0.6;\n}\n.upload-text[data-v-3fadd167] {\n  margin: 0;\n  color: var(--color-text);\n  font-size: 1rem;\n}\n.btn-select[data-v-3fadd167] {\n  padding: 0.6rem 1.5rem;\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.btn-select[data-v-3fadd167]:hover {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.upload-hint[data-v-3fadd167] {\n  margin: 0;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n\n/* File Info */\n.file-info[data-v-3fadd167] {\n  margin-top: 1rem;\n  padding: 1rem;\n  background: var(--color-surface-lighter);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.file-header[data-v-3fadd167] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.file-icon[data-v-3fadd167] {\n  font-size: 1.5rem;\n}\n.file-name[data-v-3fadd167] {\n  flex: 1;\n  font-weight: 500;\n  color: var(--color-text);\n  word-break: break-all;\n}\n.file-size[data-v-3fadd167] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.btn-remove[data-v-3fadd167] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 1.2rem;\n  padding: 0.25rem;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.btn-remove[data-v-3fadd167]:hover {\n  background-color: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n}\n\n/* Import Options */\n.import-options[data-v-3fadd167] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-top: 1.5rem;\n}\n.option-label[data-v-3fadd167] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.option-label[data-v-3fadd167]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.radio-input[data-v-3fadd167] {\n  margin-top: 0.2rem;\n  cursor: pointer;\n}\n.option-text[data-v-3fadd167] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  flex: 1;\n}\n.option-title[data-v-3fadd167] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.option-desc[data-v-3fadd167] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.option-desc.warning[data-v-3fadd167] {\n  color: var(--color-warning);\n}\n\n/* Import Result */\n.import-result[data-v-3fadd167] {\n  margin-top: 1.5rem;\n  padding: 1rem;\n  border-radius: 8px;\n  display: flex;\n  gap: 0.75rem;\n  align-items: flex-start;\n}\n.import-result.success[data-v-3fadd167] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border: 1px solid rgba(var(--color-success-rgb), 0.3);\n}\n.import-result.warning[data-v-3fadd167] {\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border: 1px solid rgba(var(--color-warning-rgb), 0.3);\n}\n.import-result.error[data-v-3fadd167] {\n  background: rgba(var(--color-danger-rgb), 0.1);\n  border: 1px solid rgba(var(--color-danger-rgb), 0.3);\n}\n.result-icon[data-v-3fadd167] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n}\n.result-content[data-v-3fadd167] {\n  flex: 1;\n}\n.result-message[data-v-3fadd167] {\n  margin: 0 0 0.5rem 0;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.result-details[data-v-3fadd167] {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n.detail-item[data-v-3fadd167] {\n  font-size: 0.85rem;\n  padding: 0.25rem 0.75rem;\n  border-radius: 12px;\n}\n.detail-item.success[data-v-3fadd167] {\n  background: rgba(var(--color-success-rgb), 0.2);\n  color: var(--color-success);\n}\n.detail-item.error[data-v-3fadd167] {\n  background: rgba(var(--color-danger-rgb), 0.2);\n  color: var(--color-danger);\n}\n.modal-footer[data-v-3fadd167] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-3fadd167] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-3fadd167] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-3fadd167]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-3fadd167] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-3fadd167]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-3fadd167]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-3fadd167] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-3fadd167] {\n    padding: 1rem;\n}\n.modal-title[data-v-3fadd167] {\n    font-size: 1.1rem;\n}\n.modal-content[data-v-3fadd167] {\n    padding: 1rem;\n}\n.upload-area[data-v-3fadd167] {\n    padding: 1.5rem;\n}\n.modal-footer[data-v-3fadd167] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-3fadd167] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},9538:e=>{"use strict";e.exports=ReferenceError},9574:(e,n,t)=>{"use strict";t.d(n,{Ce:()=>r});const a={凡人:5,觉醒期:10,掌控期:15,精通期:20,质变期:25,突破期:30,传说期:35};function r(e){if(!e)return 5;for(const[n,t]of Object.entries(a))if(e.includes(n))return t;return e.includes("练气")?5:e.includes("筑基")?10:e.includes("金丹")?15:e.includes("元婴")?20:e.includes("化神")?25:5}},9596:(e,n,t)=>{"use strict";t.d(n,{A:()=>d});var a=t(641);const r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,t)=>t?t.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},i=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim(),s=e=>""===e;var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const c=({name:e,iconNode:n,absoluteStrokeWidth:t,"absolute-stroke-width":c,strokeWidth:d,"stroke-width":u,size:p=l.width,color:v=l.stroke,...f},{slots:h})=>(0,a.h)("svg",{...l,...f,width:p,height:p,stroke:v,"stroke-width":s(t)||s(c)||!0===t||!0===c?24*Number(d||u||l["stroke-width"])/Number(p):d||u||l["stroke-width"],class:i("lucide",f.class,...e?[`lucide-${r(o(e))}-icon`,`lucide-${r(e)}`]:["lucide-icon"])},[...n.map(e=>(0,a.h)(...e)),...h.default?[h.default()]:[]]),d=(e,n)=>(t,{slots:r,attrs:o})=>(0,a.h)(c,{...o,...t,iconNode:n,name:e},r)},9612:e=>{"use strict";e.exports=Object},9675:e=>{"use strict";e.exports=TypeError},9785:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.right-sidebar[data-v-cdf5768e] {\n  width: 100%;\n  height: 100%;\n  padding: 10px 6px;\n  box-sizing: border-box;\n  font-family: var(--font-family-sans-serif);\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n  border-radius: 0;\n  position: relative;\n  isolation: isolate;\n  overflow: hidden;\n}\n.right-sidebar[data-v-cdf5768e]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background:\n    radial-gradient(ellipse 80% 50% at 90% 0%, rgba(var(--color-primary-rgb), 0.08), transparent),\n    radial-gradient(ellipse 60% 40% at 5% 5%, rgba(var(--color-accent-rgb), 0.06), transparent);\n  pointer-events: none;\n  z-index: 0;\n}\n.sidebar-header[data-v-cdf5768e],\n.sidebar-content[data-v-cdf5768e],\n.no-character[data-v-cdf5768e] {\n  position: relative;\n  z-index: 1;\n}\n.sidebar-header[data-v-cdf5768e] {\n  margin: 0 0 10px 0;\n  padding: 10px 8px;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.3);\n  background: transparent;\n}\n.sidebar-title[data-v-cdf5768e] {\n  margin: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  text-align: center;\n}\n.title-icon[data-v-cdf5768e] {\n  color: var(--color-primary);\n  flex-shrink: 0;\n}\n.title-badge[data-v-cdf5768e] {\n  display: inline-block;\n  padding: 2px 8px;\n  border-radius: 9999px;\n  background: var(--color-primary);\n  color: #fff;\n  font-weight: 600;\n  font-size: 12px;\n  letter-spacing: 0.2px;\n}\n\n/* 移除深色主题硬编码，使用CSS变量自动适配 */\n.sidebar-content[data-v-cdf5768e] {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n  padding-right: 2px;\n  min-width: 0;\n}\n.sidebar-content[data-v-cdf5768e]::-webkit-scrollbar {\n  width: 4px;\n}\n.sidebar-content[data-v-cdf5768e]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.sidebar-content[data-v-cdf5768e]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 2px;\n}\n[data-theme=\"dark\"] .sidebar-content[data-v-cdf5768e]::-webkit-scrollbar-thumb {\n  background: transparent;\n}\n\n/* 角色基本信息样式 */\n.character-info-section[data-v-cdf5768e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.86), rgba(var(--color-surface-rgb), 0.72));\n  border: 1px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 4px;\n  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);\n}\n.character-basic[data-v-cdf5768e] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n}\n.character-basic .detail-item[data-v-cdf5768e] {\n  background: var(--color-surface-hover);\n  border-radius: 6px;\n  padding: 8px;\n  font-size: 0.75rem;\n}\n.character-basic .detail-label[data-v-cdf5768e] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.character-basic .detail-value[data-v-cdf5768e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 角色状态区域样式 */\n.character-state-section[data-v-cdf5768e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.86), rgba(var(--color-surface-rgb), 0.72));\n  border: 1px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 4px;\n  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);\n}\n.character-states[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.state-item[data-v-cdf5768e] {\n  background: var(--color-surface-hover);\n  border-radius: 6px;\n  padding: 8px;\n}\n.state-label[data-v-cdf5768e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  margin-bottom: 4px;\n  display: block;\n}\n.state-content[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.state-text[data-v-cdf5768e] {\n  font-size: 0.7rem;\n  color: var(--color-text-muted);\n  text-align: center;\n}\n.progress-fill.cultivation[data-v-cdf5768e] {\n  background: linear-gradient(90deg, #8b5cf6, #a78bfa);\n}\n\n/* 觉醒阶段进度条 - 冲刺状态（90-99%）黄色 */\n.progress-fill.cultivation.realm-sprint[data-v-cdf5768e] {\n  background: linear-gradient(90deg, #f59e0b, #fbbf24);\n  box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);\n}\n\n/* 觉醒阶段进度条 - 突破状态（100%）红色 */\n.progress-fill.cultivation.realm-breakthrough[data-v-cdf5768e] {\n  background: linear-gradient(90deg, #ef4444, #f87171);\n  box-shadow: 0 0 12px rgba(239, 68, 68, 0.5);\n  animation: breakthrough-pulse-cdf5768e 1.5s ease-in-out infinite;\n}\n@keyframes breakthrough-pulse-cdf5768e {\n0%, 100% {\n    box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);\n}\n50% {\n    box-shadow: 0 0 16px rgba(239, 68, 68, 0.7);\n}\n}\n\n/* 进度文本颜色变化 */\n.progress-text.realm-sprint[data-v-cdf5768e] {\n  color: #f59e0b;\n  font-weight: 600;\n}\n.progress-text.realm-breakthrough[data-v-cdf5768e] {\n  color: #ef4444;\n  font-weight: 700;\n}\n\n/* 突破和冲刺提示 */\n.breakthrough-hint[data-v-cdf5768e] {\n  font-size: 0.6rem;\n  color: #ef4444;\n  font-weight: 700;\n  margin-left: 4px;\n  animation: hint-blink-cdf5768e 1s ease-in-out infinite;\n}\n.sprint-hint[data-v-cdf5768e] {\n  font-size: 0.6rem;\n  color: #f59e0b;\n  font-weight: 600;\n  margin-left: 4px;\n}\n@keyframes hint-blink-cdf5768e {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.5;\n}\n}\n\n/* 收缩区域通用样式 */\n.collapsible-section[data-v-cdf5768e] {\n  margin-bottom: 10px;\n  padding: 0;\n  background: rgba(var(--color-surface-rgb), 0.5);\n  border: 1px solid rgba(var(--color-border-rgb), 0.4);\n  border-radius: 10px;\n  backdrop-filter: blur(4px);\n}\n.section-header[data-v-cdf5768e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  cursor: pointer;\n  transition: background 0.2s ease;\n  border-radius: 10px 10px 0 0;\n}\n.section-header[data-v-cdf5768e]:hover {\n  background: rgba(var(--color-surface-rgb), 0.4);\n}\n.collapse-toggle[data-v-cdf5768e] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.collapse-toggle[data-v-cdf5768e]:hover {\n  color: var(--color-text);\n  background: var(--color-surface-hover);\n}\n.collapse-toggle svg[data-v-cdf5768e] {\n  transform: rotate(0deg);\n  transition: transform 0.2s ease;\n}\n.collapse-toggle.collapsed svg[data-v-cdf5768e] {\n  transform: rotate(-90deg);\n}\n.status-details[data-v-cdf5768e] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n  margin-top: 8px;\n}\n.current-status[data-v-cdf5768e] {\n  margin-top: 8px;\n  padding-top: 8px;\n  border-top: 1px solid var(--color-border);\n}\n.current-status .status-details[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  margin-top: 0;\n}\n.detail-item[data-v-cdf5768e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 6px;\n  padding: 6px 8px;\n  background: var(--color-surface-hover);\n  border-radius: 4px;\n  font-size: 0.75rem;\n}\n.detail-label[data-v-cdf5768e] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.detail-value[data-v-cdf5768e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 六维灵根区域样式 */\n.attributes-section[data-v-cdf5768e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: linear-gradient(160deg, rgba(var(--color-surface-rgb), 0.86), rgba(var(--color-surface-rgb), 0.72));\n  border: 1px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 4px;\n  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);\n}\n.attributes-grid[data-v-cdf5768e] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n  margin-bottom: 12px;\n}\n.attribute-item[data-v-cdf5768e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.attribute-item[data-v-cdf5768e]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.attr-info[data-v-cdf5768e] {\n  flex: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.attr-name[data-v-cdf5768e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.attr-value[data-v-cdf5768e] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  font-weight: 700;\n}\n.attr-quality[data-v-cdf5768e] {\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-weight: 600;\n  border: 1px solid;\n}\n\n/* 属性品质颜色 */\n.quality-purple .attr-quality[data-v-cdf5768e] {\n  background: #8b5cf6;\n  color: white;\n  border-color: #8b5cf6;\n}\n.quality-orange .attr-quality[data-v-cdf5768e] {\n  background: #f59e0b;\n  color: white;\n  border-color: #f59e0b;\n}\n.quality-blue .attr-quality[data-v-cdf5768e] {\n  background: #3b82f6;\n  color: white;\n  border-color: #3b82f6;\n}\n.quality-green .attr-quality[data-v-cdf5768e] {\n  background: #10b981;\n  color: white;\n  border-color: #10b981;\n}\n.quality-gray .attr-quality[data-v-cdf5768e] {\n  background: #6b7280;\n  color: white;\n  border-color: #6b7280;\n}\n\n/* 灵根和声望信息 */\n.spiritual-info[data-v-cdf5768e] {\n  border-top: 1px solid var(--color-border);\n  padding-top: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.info-row[data-v-cdf5768e] {\n  display: flex;\n}\n.info-item[data-v-cdf5768e] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 6px 8px;\n  background: var(--color-surface);\n  border-radius: 4px;\n  font-size: 0.75rem;\n}\n.info-label[data-v-cdf5768e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-icon[data-v-cdf5768e] {\n  flex-shrink: 0;\n}\n.info-icon.spiritual[data-v-cdf5768e] {\n  color: var(--color-accent);\n}\n.info-icon.reputation[data-v-cdf5768e] {\n  color: var(--color-warning);\n}\n.info-value[data-v-cdf5768e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 图标颜色 */\n.section-icon.attributes[data-v-cdf5768e] {\n  color: var(--color-accent);\n}\n\n/* 通用区块样式 */\n.ai-chat-section[data-v-cdf5768e],\n.info-section[data-v-cdf5768e],\n.cultivation-section[data-v-cdf5768e],\n.vitals-section[data-v-cdf5768e],\n.attributes-section[data-v-cdf5768e],\n.location-section[data-v-cdf5768e],\n.wealth-section[data-v-cdf5768e] {\n  margin-bottom: 10px;\n  padding: 10px;\n  background: rgba(var(--color-surface-rgb), 0.5);\n  border: 1px solid rgba(var(--color-border-rgb), 0.4);\n  border-radius: 10px;\n  backdrop-filter: blur(4px);\n}\n\n/* 天赋神通特定样式 */\n.talents-list[data-v-cdf5768e] {\n  padding: 0 12px 12px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n/* 空状态样式 */\n.empty-talents[data-v-cdf5768e],\n.empty-status[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  text-align: center;\n  gap: 0.5rem;\n}\n.empty-text[data-v-cdf5768e] {\n  color: var(--color-text-secondary);\n  font-size: 0.95rem;\n  font-weight: 500;\n  margin-bottom: 0.25rem;\n}\n\n\n/* 新的标签式状态效果样式 */\n.status-tags-container[data-v-cdf5768e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  padding: 12px;\n}\n.status-tag[data-v-cdf5768e] {\n  display: inline-flex;\n  align-items: center;\n  gap: 5px;\n  padding: 5px 8px;\n  border-radius: 16px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border: 1px solid;\n  white-space: nowrap;\n  max-width: 100%;\n  overflow: hidden;\n}\n.status-tag.buff[data-v-cdf5768e] {\n  background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.2), rgba(var(--color-success-rgb), 0.1));\n  border-color: rgba(var(--color-success-rgb), 0.4);\n  color: var(--color-success);\n}\n.status-tag.debuff[data-v-cdf5768e] {\n  background: linear-gradient(135deg, rgba(var(--color-error-rgb), 0.2), rgba(var(--color-error-rgb), 0.1));\n  border-color: rgba(var(--color-error-rgb), 0.4);\n  color: var(--color-danger);\n}\n.status-tag[data-v-cdf5768e]:hover {\n  transform: translateY(-1px);\n}\n.status-tag.buff[data-v-cdf5768e]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.25), rgba(var(--color-success-rgb), 0.15));\n  border-color: rgba(var(--color-success-rgb), 0.5);\n}\n.status-tag.debuff[data-v-cdf5768e]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-error-rgb), 0.25), rgba(var(--color-error-rgb), 0.15));\n  border-color: rgba(var(--color-error-rgb), 0.5);\n}\n.tag-icon[data-v-cdf5768e] {\n  font-size: 0.8rem;\n  flex-shrink: 0;\n}\n.tag-name[data-v-cdf5768e] {\n  font-weight: 600;\n  flex-shrink: 0;\n  min-width: 0;\n  max-width: 12rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.tag-intensity[data-v-cdf5768e] {\n  font-size: 0.65rem;\n  background: rgba(var(--color-warning-rgb), 0.8);\n  color: var(--color-text);\n  padding: 1px 4px;\n  border-radius: 8px;\n  font-weight: 600;\n  flex-shrink: 0;\n}\n.tag-time[data-v-cdf5768e] {\n  font-size: 0.65rem;\n  opacity: 0.8;\n  font-weight: 400;\n  flex-shrink: 0;\n}\n/* 标题样式 - 图标和文字在一行 */\n.section-title[data-v-cdf5768e] {\n  margin: 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding-bottom: 6px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.section-title span[data-v-cdf5768e] {\n  flex: 1;\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.section-icon[data-v-cdf5768e] {\n  color: var(--color-primary);\n  opacity: 0.8;\n  flex-shrink: 0;\n}\n.section-icon.gold[data-v-cdf5768e] {\n  color: var(--color-warning);\n}\n.vital-icon[data-v-cdf5768e] {\n  flex-shrink: 0;\n}\n.vital-icon.blood[data-v-cdf5768e] { color: var(--vital-health);\n}\n.vital-icon.mana[data-v-cdf5768e] { color: var(--vital-lingqi);\n}\n.vital-icon.spirit[data-v-cdf5768e] { color: var(--vital-spirit);\n}\n.vital-icon.lifespan[data-v-cdf5768e] { color: var(--vital-lifespan);\n}\n.vital-icon.reputation[data-v-cdf5768e] { color: var(--color-warning);\n}\n\n/* 声望显示样式 */\n.reputation-display[data-v-cdf5768e] {\n  margin-top: 8px;\n  border-top: 1px solid rgba(var(--color-border-rgb), 0.3);\n  padding-top: 8px;\n}\n.reputation-item[data-v-cdf5768e] {\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border-radius: 8px;\n  padding: 8px;\n  border: 1px solid rgba(var(--color-border-rgb), 0.3);\n  transition: all 0.2s ease;\n}\n.reputation-item[data-v-cdf5768e]:hover {\n  background: rgba(var(--color-surface-rgb), 0.8);\n}\n.reputation-info[data-v-cdf5768e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.reputation-label[data-v-cdf5768e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n.reputation-value[data-v-cdf5768e] {\n  font-size: 0.8rem;\n  font-weight: 600;\n  padding: 2px 6px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  transition: all 0.3s ease;\n}\n\n/* 声望等级配色 */\n.reputation-neutral[data-v-cdf5768e] {\n  color: var(--color-text-secondary);\n  background: rgba(128, 128, 128, 0.1);\n  border: 1px solid rgba(128, 128, 128, 0.3);\n}\n\n/* 正面声望 */\n.reputation-minor[data-v-cdf5768e] {\n  color: #10b981;\n  background: rgba(16, 185, 129, 0.1);\n  border: 1px solid rgba(16, 185, 129, 0.3);\n}\n.reputation-known[data-v-cdf5768e] {\n  color: #3b82f6;\n  background: rgba(59, 130, 246, 0.1);\n  border: 1px solid rgba(59, 130, 246, 0.3);\n}\n.reputation-notable[data-v-cdf5768e] {\n  color: #8b5cf6;\n  background: rgba(139, 92, 246, 0.1);\n  border: 1px solid rgba(139, 92, 246, 0.3);\n}\n.reputation-renowned[data-v-cdf5768e] {\n  color: #f59e0b;\n  background: rgba(245, 158, 11, 0.1);\n  border: 1px solid rgba(245, 158, 11, 0.3);\n}\n.reputation-famous[data-v-cdf5768e] {\n  color: #f97316;\n  background: rgba(249, 115, 22, 0.1);\n  border: 1px solid rgba(249, 115, 22, 0.3);\n}\n.reputation-legendary[data-v-cdf5768e] {\n  color: #dc2626;\n  background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(239, 68, 68, 0.1));\n  border: 1px solid rgba(220, 38, 38, 0.4);\n  box-shadow: 0 0 8px rgba(220, 38, 38, 0.3);\n}\n\n/* 负面声望（恶名） */\n.reputation-evil-minor[data-v-cdf5768e] {\n  color: #6b7280;\n  background: rgba(107, 114, 128, 0.1);\n  border: 1px solid rgba(107, 114, 128, 0.3);\n}\n.reputation-evil-low[data-v-cdf5768e] {\n  color: #ef4444;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n}\n.reputation-evil-medium[data-v-cdf5768e] {\n  color: #dc2626;\n  background: rgba(220, 38, 38, 0.1);\n  border: 1px solid rgba(220, 38, 38, 0.3);\n}\n.reputation-evil-high[data-v-cdf5768e] {\n  color: #991b1b;\n  background: rgba(153, 27, 27, 0.1);\n  border: 1px solid rgba(153, 27, 27, 0.3);\n}\n.reputation-evil-legendary[data-v-cdf5768e] {\n  color: #7f1d1d;\n  background: linear-gradient(135deg, rgba(127, 29, 29, 0.2), rgba(153, 27, 27, 0.1));\n  border: 1px solid rgba(127, 29, 29, 0.4);\n  box-shadow: 0 0 8px rgba(127, 29, 29, 0.4);\n}\n.reputation-number[data-v-cdf5768e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n}\n\n/* 点击提示样式 */\n.clickable[data-v-cdf5768e] {\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.clickable[data-v-cdf5768e]:hover {\n  transform: translateY(-1px);\n}\n.ability-section[data-v-cdf5768e] {\n  margin-bottom: 10px;\n}\n.ability-content[data-v-cdf5768e] {\n  padding: 0 12px 12px;\n}\n.ability-card[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.ability-header[data-v-cdf5768e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-weight: 600;\n}\n.ability-name[data-v-cdf5768e] {\n  font-size: 13px;\n}\n.ability-type[data-v-cdf5768e] {\n  font-size: 12px;\n  opacity: 0.7;\n}\n.ability-description[data-v-cdf5768e] {\n  font-size: 12px;\n  line-height: 1.5;\n}\n.ability-costs[data-v-cdf5768e] {\n  margin-top: 6px;\n}\n.costs-title[data-v-cdf5768e] {\n  font-size: 12px;\n  font-weight: 600;\n  margin-bottom: 4px;\n}\n.cost-list[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.cost-item[data-v-cdf5768e] {\n  display: flex;\n  gap: 8px;\n  font-size: 12px;\n  align-items: center;\n}\n.cost-resource[data-v-cdf5768e] {\n  font-weight: 600;\n}\n.cost-type[data-v-cdf5768e] {\n  opacity: 0.7;\n}\n.cost-value[data-v-cdf5768e] {\n}\n.cost-extra[data-v-cdf5768e] {\n  opacity: 0.6;\n  font-style: italic;\n}\n.empty-ability[data-v-cdf5768e] {\n  padding: 10px 12px;\n  font-size: 12px;\n  opacity: 0.8;\n}\n/* 天赋卡片样式 */\n.talent-card[data-v-cdf5768e] {\n  background: rgba(var(--color-accent-rgb), 0.08);\n  border: 1px solid rgba(var(--color-accent-rgb), 0.2);\n  border-left: 3px solid var(--color-accent);\n  border-radius: 8px;\n  padding: 12px;\n  transition: all 0.2s ease;\n  position: relative;\n}\n.talent-card[data-v-cdf5768e]:hover {\n  background: rgba(var(--color-accent-rgb), 0.12);\n  border-color: rgba(var(--color-accent-rgb), 0.3);\n  transform: translateX(3px);\n}\n.talent-header[data-v-cdf5768e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: relative;\n  z-index: 1;\n}\n.talent-name[data-v-cdf5768e] {\n  font-size: 0.9rem;\n  font-weight: 700;\n  color: var(--color-accent);\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n.talent-level[data-v-cdf5768e] {\n  font-size: 0.75rem;\n  color: var(--color-warning);\n  font-weight: 600;\n  background: linear-gradient(135deg, rgba(var(--color-warning-rgb), 0.2), rgba(var(--color-warning-rgb), 0.1));\n  padding: 4px 10px;\n  border-radius: 12px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.3);\n  backdrop-filter: blur(4px);\n}\n.talent-progress[data-v-cdf5768e] {\n  margin-top: 10px;\n  position: relative;\n  z-index: 1;\n}\n.progress-fill.talent[data-v-cdf5768e] {\n  background: linear-gradient(90deg, var(--color-accent), var(--color-accent-hover), rgba(var(--color-accent-rgb), 0.9));\n  box-shadow: 0 2px 8px rgba(var(--color-accent-rgb), 0.3);\n}\n\n/* 生命体征样式 */\n.vitals-list[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.vitals-list.compact[data-v-cdf5768e] {\n  flex-direction: row;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.vital-item[data-v-cdf5768e] {\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border-radius: 8px;\n  padding: 10px;\n  border: 1px solid rgba(var(--color-border-rgb), 0.3);\n  transition: all 0.2s ease;\n}\n.vital-item.compact[data-v-cdf5768e] {\n  padding: 6px 8px;\n}\n.vital-item[data-v-cdf5768e]:hover {\n  background: rgba(var(--color-surface-rgb), 0.8);\n}\n.vital-info[data-v-cdf5768e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.vital-name[data-v-cdf5768e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n.vital-text[data-v-cdf5768e] {\n  font-size: 0.75rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.progress-bar[data-v-cdf5768e] {\n  height: 6px;\n  background: var(--color-surface-light);\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n}\n.vital-item.compact .progress-bar[data-v-cdf5768e] {\n  display: none;\n}\n.progress-fill[data-v-cdf5768e] {\n  height: 100%;\n  border-radius: 3px;\n  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n}\n.progress-fill.health[data-v-cdf5768e] { background: var(--vital-health);\n}\n.progress-fill.mana[data-v-cdf5768e] { background: var(--vital-lingqi);\n}\n.progress-fill.spirit[data-v-cdf5768e] { background: var(--vital-spirit);\n}\n/* 寿元进度条统一紫色 */\n.progress-fill.lifespan[data-v-cdf5768e] { background: var(--vital-lifespan);\n}\n\n/* 修为状态样式 */\n.realm-display[data-v-cdf5768e] {\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border: 1px solid rgba(var(--color-border-rgb), 0.3);\n  border-radius: 8px;\n  padding: 10px;\n  margin-bottom: 8px;\n}\n.realm-info[data-v-cdf5768e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 8px;\n  flex-direction: column;\n  gap: 4px;\n}\n.realm-name[data-v-cdf5768e] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-accent);\n}\n.realm-breakthrough[data-v-cdf5768e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  line-height: 1.4;\n  opacity: 0.8;\n}\n.realm-level[data-v-cdf5768e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* 凡人觉醒阶段特殊样式 */\n.realm-mortal[data-v-cdf5768e] {\n  padding: 8px;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-radius: 4px;\n  text-align: center;\n  border: 1px dashed rgba(var(--color-primary-rgb), 0.3);\n}\n.mortal-text[data-v-cdf5768e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-style: italic;\n  opacity: 0.8;\n}\n.realm-progress[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.progress-text[data-v-cdf5768e] {\n  font-size: 0.65rem;\n  color: var(--color-text-muted);\n  text-align: center;\n}\n\n/* 状态效果样式 */\n.status-effects[data-v-cdf5768e] {\n  padding: 0 12px 12px;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.status-effect[data-v-cdf5768e] {\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 0.7rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 2px;\n}\n.status-effect.buff[data-v-cdf5768e] {\n  background: linear-gradient(135deg, #10b981, #059669);\n  color: white;\n  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);\n}\n.status-effect.debuff[data-v-cdf5768e] {\n  background: linear-gradient(135deg, #ef4444, #dc2626);\n  color: white;\n  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);\n}\n.status-effect[data-v-cdf5768e]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n}\n.effect-name[data-v-cdf5768e] {\n  font-size: 0.65rem;\n}\n.effect-time[data-v-cdf5768e] {\n  font-size: 0.6rem;\n  opacity: 0.8;\n}\n\n/* 无角色数据样式 */\n.no-character[data-v-cdf5768e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  gap: 10px;\n}\n.no-char-text[data-v-cdf5768e] {\n  font-size: 0.9rem;\n  color: var(--color-text-muted);\n  font-style: italic;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.right-sidebar[data-v-cdf5768e] {\n    padding: 12px;\n}\n.sidebar-title[data-v-cdf5768e] {\n    font-size: 0.9rem;\n}\n.section-title[data-v-cdf5768e] {\n    font-size: 0.8rem;\n}\n.vitals-list[data-v-cdf5768e] {\n    gap: 8px;\n}\n.vital-item[data-v-cdf5768e] {\n    padding: 6px;\n}\n.vital-name[data-v-cdf5768e] {\n    font-size: 0.7rem;\n}\n.vital-text[data-v-cdf5768e] {\n    font-size: 0.65rem;\n}\n.talent-card[data-v-cdf5768e] {\n    padding: 10px;\n}\n.talent-name[data-v-cdf5768e] {\n    font-size: 0.8rem;\n}\n.status-effect-card[data-v-cdf5768e] {\n    padding: 8px 10px;\n}\n.effect-name[data-v-cdf5768e] {\n    font-size: 0.75rem;\n}\n.status-tags-container[data-v-cdf5768e] {\n    gap: 6px;\n    padding: 8px;\n}\n.status-tag[data-v-cdf5768e] {\n    font-size: 0.7rem;\n    padding: 4px 8px;\n    gap: 4px;\n}\n.tag-intensity[data-v-cdf5768e] {\n    font-size: 0.6rem;\n    padding: 1px 3px;\n}\n.tag-time[data-v-cdf5768e] {\n    font-size: 0.6rem;\n}\n.detail-item[data-v-cdf5768e] {\n    padding: 5px 6px;\n    font-size: 0.7rem;\n}\n.attributes-grid[data-v-cdf5768e] {\n    gap: 6px;\n}\n.attribute-item[data-v-cdf5768e] {\n    padding: 6px;\n}\n.attr-name[data-v-cdf5768e] {\n    font-size: 0.7rem;\n}\n.attr-value[data-v-cdf5768e] {\n    font-size: 0.8rem;\n}\n.attr-quality[data-v-cdf5768e] {\n    font-size: 0.6rem;\n    padding: 1px 4px;\n}\n.info-item[data-v-cdf5768e] {\n    padding: 5px 6px;\n    font-size: 0.7rem;\n}\n.realm-name[data-v-cdf5768e] {\n    font-size: 0.8rem;\n}\n.progress-bar[data-v-cdf5768e] {\n    height: 5px;\n}\n}\n@media (max-width: 480px) {\n.right-sidebar[data-v-cdf5768e] {\n    padding: 8px;\n}\n.sidebar-header[data-v-cdf5768e] {\n    margin-bottom: 12px;\n    padding-bottom: 8px;\n}\n.vitals-section[data-v-cdf5768e],\n  .cultivation-section[data-v-cdf5768e],\n  .collapsible-section[data-v-cdf5768e] {\n    margin-bottom: 12px;\n    padding: 10px;\n}\n.attributes-section[data-v-cdf5768e] {\n    margin-bottom: 12px;\n    padding: 10px;\n}\n.attributes-grid[data-v-cdf5768e] {\n    gap: 4px;\n}\n.attribute-item[data-v-cdf5768e] {\n    padding: 5px;\n}\n.attr-name[data-v-cdf5768e] {\n    font-size: 0.65rem;\n}\n.attr-value[data-v-cdf5768e] {\n    font-size: 0.75rem;\n}\n.attr-quality[data-v-cdf5768e] {\n    font-size: 0.55rem;\n    padding: 1px 3px;\n}\n.status-details[data-v-cdf5768e] {\n    grid-template-columns: 1fr;\n}\n.talents-list[data-v-cdf5768e] {\n    padding: 0 12px 12px;\n}\n.status-effects[data-v-cdf5768e] {\n    padding: 0 12px 12px;\n}\n.status-tags-container[data-v-cdf5768e] {\n    gap: 4px;\n    padding: 6px;\n}\n.status-tag[data-v-cdf5768e] {\n    font-size: 0.65rem;\n    padding: 3px 6px;\n    gap: 3px;\n}\n.tag-intensity[data-v-cdf5768e] {\n    font-size: 0.55rem;\n    padding: 1px 2px;\n}\n.tag-time[data-v-cdf5768e] {\n    font-size: 0.55rem;\n}\n}\n\n/* 平板设备优化 */\n@media (min-width: 769px) and (max-width: 1024px) {\n.right-sidebar[data-v-cdf5768e] {\n    padding: 14px;\n}\n.vital-item[data-v-cdf5768e] {\n    padding: 7px;\n}\n.talent-card[data-v-cdf5768e] {\n    padding: 11px;\n}\n}\n\n/* 大屏幕优化 */\n@media (min-width: 1440px) {\n.right-sidebar[data-v-cdf5768e] {\n    padding: 20px;\n}\n.sidebar-title[data-v-cdf5768e] {\n    font-size: 1.1rem;\n}\n.section-title[data-v-cdf5768e] {\n    font-size: 0.9rem;\n}\n.vital-name[data-v-cdf5768e] {\n    font-size: 0.8rem;\n}\n.talent-name[data-v-cdf5768e] {\n    font-size: 0.9rem;\n}\n.effect-name[data-v-cdf5768e] {\n    font-size: 0.85rem;\n}\n.status-tags-container[data-v-cdf5768e] {\n    gap: 10px;\n    padding: 16px;\n}\n.status-tag[data-v-cdf5768e] {\n    font-size: 0.8rem;\n    padding: 8px 12px;\n}\n}\n\n/* 深色主题：使用CSS变量自动适配，无需额外覆盖 */\n",""]);const s=i},9880:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,'\n.header-title[data-v-947eced4]{\n  background: linear-gradient(135deg, #60a5fa 0%, #818cf8 50%, #a78bfa 100%);\n  -webkit-background-clip: text;\n  background-clip: text;\n  -webkit-text-fill-color: transparent;\n  filter: drop-shadow(0 0 8px rgba(96, 165, 250, 0.6)) drop-shadow(0 0 12px rgba(129, 140, 248, 0.4));\n  animation: glow-pulse-947eced4 3s ease-in-out infinite;\n}\n@keyframes glow-pulse-947eced4 {\n0%, 100% {\n    filter: drop-shadow(0 0 8px rgba(96, 165, 250, 0.6)) drop-shadow(0 0 12px rgba(129, 140, 248, 0.4));\n}\n50% {\n    filter: drop-shadow(0 0 12px rgba(96, 165, 250, 0.8)) drop-shadow(0 0 18px rgba(129, 140, 248, 0.5));\n}\n}\n/* 容器 - 可滚动 */\n.mode-selection-container[data-v-947eced4] {\n  width: 100%;\n  min-height: 100vh;\n  min-height: 100svh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  padding-top: calc(2rem + env(safe-area-inset-top));\n  padding-bottom: calc(2rem + env(safe-area-inset-bottom));\n  box-sizing: border-box;\n  overflow-y: auto;\n  overflow-x: hidden;\n  -webkit-overflow-scrolling: touch;\n}\n\n/* 主内容区 */\n.selection-content[data-v-947eced4] {\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.88) 0%, rgba(30, 41, 59, 0.85) 100%);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  border-radius: 24px;\n  padding: 2.5rem 3rem;\n  border: 1px solid rgba(147, 197, 253, 0.12);\n  box-shadow: 0 24px 48px -12px rgba(0, 0, 0, 0.5);\n  max-width: 820px;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n  position: relative;\n  max-height: none;\n  overflow: visible;\n}\n\n/* 版本号 - 青蓝色发光 */\n.version-tag[data-v-947eced4] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #67e8f9;\n  padding: 0.25rem 0.6rem;\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.12) 0%, rgba(56, 189, 248, 0.08) 100%);\n  border: 1px solid rgba(34, 211, 238, 0.35);\n  border-radius: 6px;\n  text-shadow: 0 0 8px rgba(34, 211, 238, 0.5);\n  box-shadow: 0 0 12px rgba(34, 211, 238, 0.15);\n  transition: all 0.3s ease;\n}\n.version-tag[data-v-947eced4]:hover {\n  color: #a5f3fc;\n  border-color: rgba(34, 211, 238, 0.5);\n  box-shadow: 0 0 16px rgba(34, 211, 238, 0.25);\n  text-shadow: 0 0 12px rgba(34, 211, 238, 0.7);\n}\n\n/* 右上角信息 */\n.top-info[data-v-947eced4] {\n  position: absolute;\n  top: 1.25rem;\n  right: 1.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n/* 状态指示器 */\n.status-indicator[data-v-947eced4] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.25rem 0.6rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n}\n.status-indicator.online[data-v-947eced4] {\n  background: rgba(34, 197, 94, 0.12);\n  border: 1px solid rgba(34, 197, 94, 0.3);\n  color: #4ade80;\n}\n.status-indicator.offline[data-v-947eced4] {\n  background: rgba(248, 113, 113, 0.1);\n  border: 1px solid rgba(248, 113, 113, 0.25);\n  color: #fca5a5;\n}\n.status-dot[data-v-947eced4] {\n  width: 5px;\n  height: 5px;\n  border-radius: 50%;\n  background: currentColor;\n}\n\n/* 标题区域 */\n.header-section[data-v-947eced4] {\n  text-align: center;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.5rem;\n}\n.main-title[data-v-947eced4] {\n  font-family: var(--font-family-serif);\n  font-size: 3.5rem;\n  font-weight: 400;\n  letter-spacing: 0.5em;\n  color: #f8fafc;\n  margin: 0;\n  text-shadow: 0 0 40px rgba(147, 197, 253, 0.3);\n}\n.sub-title[data-v-947eced4] {\n  padding: 0.5rem;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  letter-spacing: 0.15em;\n  margin: 0;\n}\n\n/* 道途选择 */\n.paths-section[data-v-947eced4] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.section-header[data-v-947eced4] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n}\n.section-header .line[data-v-947eced4] {\n  width: 60px;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, rgba(147, 197, 253, 0.4), transparent);\n}\n.section-header .text[data-v-947eced4] {\n  padding: 0.5rem;\n  font-family: var(--font-family-serif);\n  font-size: 1rem;\n  color: #64748b;\n  letter-spacing: 0.2em;\n}\n\n/* 卡片容器 */\n.gate-container[data-v-947eced4] {\n  padding: 0.5rem;\n  display: flex;\n  gap: 1.5rem;\n}\n\n/* 卡片 */\n.gate-card[data-v-947eced4] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  padding: 1.75rem 1.75rem;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 16px;\n  cursor: pointer;\n  position: relative;\n  transition: all 0.3s ease;\n  min-height: 120px;\n}\n.gate-card[data-v-947eced4]:hover {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(147, 197, 253, 0.2);\n  transform: translateY(-2px);\n}\n.gate-card.selected[data-v-947eced4] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.35);\n}\n.gate-card.disabled[data-v-947eced4] {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.gate-card.disabled[data-v-947eced4]:hover {\n  transform: none;\n  background: rgba(30, 41, 59, 0.5);\n  border-color: rgba(255, 255, 255, 0.06);\n}\n\n/* 卡片图标 */\n.gate-icon[data-v-947eced4] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #93c5fd;\n  flex-shrink: 0;\n  position: relative;\n  width: 72px;\n  height: 72px;\n}\n.icon-bg[data-v-947eced4] {\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);\n  border: 1px solid rgba(147, 197, 253, 0.15);\n  border-radius: 16px;\n}\n.gate-icon svg[data-v-947eced4] {\n  position: relative;\n  z-index: 1;\n}\n.gate-card:hover .gate-icon[data-v-947eced4],\n.gate-card.selected .gate-icon[data-v-947eced4] {\n  color: #bfdbfe;\n}\n.gate-card:hover .icon-bg[data-v-947eced4],\n.gate-card.selected .icon-bg[data-v-947eced4] {\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.15) 0%, rgba(59, 130, 246, 0.08) 100%);\n  border-color: rgba(147, 197, 253, 0.25);\n}\n\n/* 卡片信息 */\n.gate-info[data-v-947eced4] {\n  flex: 1;\n  min-width: 0;\n}\n.gate-title[data-v-947eced4] {\n  font-family: var(--font-family-serif);\n  font-size: 1.35rem;\n  font-weight: 400;\n  margin: 0 0 0.35rem 0;\n  color: #f1f5f9;\n  letter-spacing: 0.1em;\n}\n.gate-desc[data-v-947eced4] {\n  font-size: 0.9rem;\n  color: #94a3b8;\n  margin: 0 0 0.4rem 0;\n}\n.gate-detail[data-v-947eced4] {\n  font-size: 0.8rem;\n  color: #64748b;\n  margin: 0 0 0.75rem 0;\n  line-height: 1.4;\n}\n.gate-tags[data-v-947eced4] {\n  display: flex;\n  gap: 0.6rem;\n}\n.gate-tags span[data-v-947eced4] {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.6rem;\n  border-radius: 4px;\n}\n\n/* 本地存储 - 琥珀色 */\n.tag-local[data-v-947eced4] {\n  color: #fbbf24;\n  background: rgba(251, 191, 36, 0.12);\n  border: 1px solid rgba(251, 191, 36, 0.25);\n}\n\n/* 离线可用 - 青色 */\n.tag-offline[data-v-947eced4] {\n  color: #22d3d1;\n  background: rgba(34, 211, 209, 0.1);\n  border: 1px solid rgba(34, 211, 209, 0.25);\n}\n\n/* 云端同步 - 蓝色 */\n.tag-cloud[data-v-947eced4] {\n  color: #60a5fa;\n  background: rgba(96, 165, 250, 0.12);\n  border: 1px solid rgba(96, 165, 250, 0.25);\n}\n\n/* 数据安全 - 绿色 */\n.tag-secure[data-v-947eced4] {\n  color: #4ade80;\n  background: rgba(74, 222, 128, 0.1);\n  border: 1px solid rgba(74, 222, 128, 0.25);\n}\n\n/* 选中标记 */\n.check-mark[data-v-947eced4] {\n  position: absolute;\n  top: 0.75rem;\n  right: 0.75rem;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  background: rgba(34, 197, 94, 0.2);\n  border: 1px solid rgba(34, 197, 94, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #4ade80;\n}\n\n/* 禁用遮罩 */\n.disabled-mask[data-v-947eced4] {\n  position: absolute;\n  inset: 0;\n  background: rgba(15, 23, 42, 0.75);\n  backdrop-filter: blur(2px);\n  border-radius: 16px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 0.4rem;\n  color: #94a3b8;\n  font-size: 0.8rem;\n}\n\n/* 操作按钮区域 */\n.actions-section[data-v-947eced4] {\n  display: flex;\n  justify-content: center;\n  min-height: 52px;\n  padding-bottom: 0.5rem;\n}\n.action-group[data-v-947eced4] {\n  display: flex;\n  gap: 1rem;\n}\n\n/* 按钮基础 */\nbutton[data-v-947eced4] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.6rem;\n  font-family: var(--font-family-serif);\n  font-size: 1rem;\n  letter-spacing: 0.08em;\n  padding: 0.85rem 1.75rem;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: none;\n}\n.btn-primary[data-v-947eced4] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: #fff;\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n.btn-primary[data-v-947eced4]:hover {\n  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);\n  transform: translateY(-1px);\n}\n.btn-secondary[data-v-947eced4] {\n  background: rgba(51, 65, 85, 0.6);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  color: #cbd5e1;\n}\n.btn-secondary[data-v-947eced4]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.btn-ghost[data-v-947eced4] {\n  background: transparent;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  color: #94a3b8;\n}\n.btn-ghost[data-v-947eced4]:hover {\n  background: rgba(51, 65, 85, 0.4);\n  color: #e2e8f0;\n}\n\n/* 过渡动画 */\n.fade-up-enter-active[data-v-947eced4],\n.fade-up-leave-active[data-v-947eced4] {\n  transition: all 0.3s ease;\n}\n.fade-up-enter-from[data-v-947eced4],\n.fade-up-leave-to[data-v-947eced4] {\n  opacity: 0;\n  transform: translateY(8px);\n}\n\n/* 亮色主题 */\n[data-theme="light"] .selection-content[data-v-947eced4] {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.92) 100%);\n  border-color: rgba(59, 130, 246, 0.15);\n  box-shadow: 0 24px 48px -12px rgba(0, 0, 0, 0.12);\n}\n[data-theme="light"] .main-title[data-v-947eced4] {\n  color: #1e293b;\n  text-shadow: none;\n}\n[data-theme="light"] .sub-title[data-v-947eced4] {\n  color: #64748b;\n}\n[data-theme="light"] .gate-card[data-v-947eced4] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.06);\n}\n[data-theme="light"] .gate-card[data-v-947eced4]:hover,\n[data-theme="light"] .gate-card.selected[data-v-947eced4] {\n  background: rgba(239, 246, 255, 0.9);\n}\n[data-theme="light"] .gate-title[data-v-947eced4] {\n  color: #1e293b;\n}\n[data-theme="light"] .gate-icon[data-v-947eced4] {\n  color: #3b82f6;\n}\n[data-theme="light"] .icon-bg[data-v-947eced4] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(37, 99, 235, 0.04) 100%);\n  border-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .gate-detail[data-v-947eced4] {\n  color: #94a3b8;\n}\n[data-theme="light"] .btn-secondary[data-v-947eced4] {\n  background: rgba(248, 250, 252, 0.9);\n  border-color: rgba(0, 0, 0, 0.08);\n  color: #475569;\n}\n[data-theme="light"] .btn-ghost[data-v-947eced4] {\n  color: #64748b;\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .version-tag[data-v-947eced4] {\n  color: #0891b2;\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.15) 0%, rgba(56, 189, 248, 0.1) 100%);\n  border-color: rgba(34, 211, 238, 0.35);\n  text-shadow: none;\n  box-shadow: 0 0 8px rgba(34, 211, 238, 0.1);\n}\n\n/* 响应式 */\n@media (max-width: 768px) {\n.mode-selection-container[data-v-947eced4] {\n    padding: 0.75rem;\n    align-items: flex-start;\n    padding-top: calc(0.75rem + env(safe-area-inset-top));\n    padding-left: calc(0.75rem + env(safe-area-inset-left));\n    padding-right: calc(0.75rem + env(safe-area-inset-right));\n    min-height: 100vh;\n    min-height: 100svh;\n}\n.selection-content[data-v-947eced4] {\n    padding: 3.5rem 1rem 1.5rem;\n    gap: 1.25rem;\n    max-height: none;\n    min-height: auto;\n    width: 100%;\n    max-width: 100%;\n    box-sizing: border-box;\n    overflow: hidden;\n}\n.top-info[data-v-947eced4] {\n    position: static;\n    display: flex;\n    justify-content: center;\n    margin-bottom: 0.5rem;\n    gap: 0.5rem;\n}\n.header-section[data-v-947eced4] {\n    padding-top: 0;\n}\n.main-title[data-v-947eced4] {\n    font-size: 2.75rem;\n    letter-spacing: 0.2em;\n    margin-right: -0.2em;\n}\n.sub-title[data-v-947eced4] {\n    font-size: 0.85rem;\n    letter-spacing: 0.06em;\n}\n.gate-container[data-v-947eced4] {\n    flex-direction: column;\n    padding: 0;\n}\n.gate-card[data-v-947eced4] {\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n    padding: 0.75rem 0.75rem;\n    min-height: auto;\n    gap: 0.5rem;\n}\n.gate-icon[data-v-947eced4] {\n    width: 40px;\n    height: 40px;\n}\n.gate-icon svg[data-v-947eced4] {\n    width: 20px;\n    height: 20px;\n}\n.gate-info[data-v-947eced4] {\n    width: 100%;\n}\n.gate-title[data-v-947eced4] {\n    font-size: 1rem;\n    margin-bottom: 0.15rem;\n}\n.gate-desc[data-v-947eced4] {\n    font-size: 0.75rem;\n    margin-bottom: 0.25rem;\n}\n.gate-detail[data-v-947eced4] {\n    display: none;\n}\n.gate-tags[data-v-947eced4] {\n    justify-content: center;\n    flex-wrap: wrap;\n    gap: 0.3rem;\n}\n.gate-tags span[data-v-947eced4] {\n    white-space: nowrap;\n    font-size: 0.65rem;\n    padding: 0.15rem 0.4rem;\n}\n.section-header .line[data-v-947eced4] {\n    width: 30px;\n}\n.section-header .text[data-v-947eced4] {\n    font-size: 0.8rem;\n    letter-spacing: 0.1em;\n}\n.action-group[data-v-947eced4] {\n    flex-direction: column;\n    width: 100%;\n    gap: 0.5rem;\n}\nbutton[data-v-947eced4] {\n    width: 100%;\n    min-height: 38px;\n    font-size: 0.85rem;\n    padding: 0.5rem 0.75rem;\n}\n}\n@media (max-width: 480px) {\n.mode-selection-container[data-v-947eced4] {\n    padding: 0.5rem;\n    padding-top: calc(0.5rem + env(safe-area-inset-top));\n    padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));\n}\n.selection-content[data-v-947eced4] {\n    padding: 1rem 0.75rem;\n    gap: 1rem;\n    max-height: none;\n    width: 100%;\n}\n.top-info[data-v-947eced4] {\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.main-title[data-v-947eced4] {\n    font-size: 2.5rem;\n    letter-spacing: 0.15em;\n    margin-right: -0.15em;\n}\n.sub-title[data-v-947eced4] {\n    font-size: 0.8rem;\n}\n.gate-card[data-v-947eced4] {\n    padding: 0.6rem;\n    gap: 0.4rem;\n}\n.gate-title[data-v-947eced4] {\n    font-size: 0.95rem;\n}\n.gate-desc[data-v-947eced4] {\n    font-size: 0.7rem;\n}\nbutton[data-v-947eced4] {\n    padding: 0.45rem 0.6rem;\n    font-size: 0.8rem;\n    min-height: 36px;\n}\n.version-tag[data-v-947eced4],\n  .status-indicator[data-v-947eced4] {\n    font-size: 0.65rem;\n    padding: 0.15rem 0.4rem;\n}\n}\n',""]);const s=i},9957:(e,n,t)=>{"use strict";var a=Function.prototype.call,r=Object.prototype.hasOwnProperty,o=t(6743);e.exports=o.call(a,r)},9964:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(1601),r=t.n(a),o=t(6314),i=t.n(o)()(r());i.push([e.id,"\n.top-bar[data-v-4fdabcba] {\n  width: 100%;\n  height: 56px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 16px;\n  box-sizing: border-box;\n  background: var(--color-surface, #f8f9fa);\n  border-bottom: 1px solid var(--color-border, #e2e8f0);\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  flex-shrink: 0;\n  min-height: 56px;\n}\n.left-section[data-v-4fdabcba] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  flex: 1;\n}\n.game-title[data-v-4fdabcba] {\n  font-size: 1.2rem;\n  font-weight: 800;\n  color: var(--color-text);\n  margin: 0;\n  letter-spacing: 1px;\n  white-space: nowrap;\n}\n.title-xian[data-v-4fdabcba] {\n  color: var(--color-primary);\n  text-shadow: 0 0 12px rgba(var(--color-primary-rgb), 0.4);\n}\n.title-tu[data-v-4fdabcba] {\n  color: var(--color-text);\n}\n.character-quick-info[data-v-4fdabcba] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 4px 10px;\n  background: var(--color-surface-light);\n  border-radius: 14px;\n  border: 1px solid var(--color-border);\n}\n.character-name[data-v-4fdabcba] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.character-realm[data-v-4fdabcba] {\n  font-size: 0.75rem;\n  color: var(--color-accent);\n  font-weight: 500;\n  padding: 2px 6px;\n  background: var(--color-accent-light);\n  border-radius: 10px;\n}\n.center-section[data-v-4fdabcba] {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n}\n.location-time-info[data-v-4fdabcba] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 4px 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  white-space: nowrap;\n}\n.location-text[data-v-4fdabcba] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-success);\n}\n.region-level[data-v-4fdabcba] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 197, 253, 0.12) 100%);\n  border: 1px solid rgba(59, 130, 246, 0.25);\n  border-radius: 12px;\n  margin-left: 8px;\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n}\n.region-level[data-v-4fdabcba]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n.spirit-icon-wrapper[data-v-4fdabcba] {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 18px;\n  height: 18px;\n}\n.spirit-icon[data-v-4fdabcba] {\n  font-size: 0.9rem;\n  color: #3b82f6;\n  position: relative;\n  z-index: 2;\n  animation: spirit-pulse-4fdabcba 2s ease-in-out infinite;\n  filter: drop-shadow(0 0 3px rgba(59, 130, 246, 0.6));\n}\n.spirit-glow[data-v-4fdabcba] {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, transparent 70%);\n  border-radius: 50%;\n  animation: spirit-glow-pulse-4fdabcba 2s ease-in-out infinite;\n}\n.region-label[data-v-4fdabcba] {\n  font-size: 0.7rem;\n  font-weight: 600;\n  color: #1e40af;\n  letter-spacing: 0.5px;\n  text-transform: uppercase;\n}\n.region-value[data-v-4fdabcba] {\n  font-size: 0.85rem;\n  font-weight: 700;\n  color: #1e40af;\n  font-family: 'Courier New', monospace;\n  min-width: 24px;\n  text-align: right;\n}\n.region-level.level-green[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(74, 222, 128, 0.14) 100%);\n  border-color: rgba(34, 197, 94, 0.3);\n}\n.region-level.level-green .region-label[data-v-4fdabcba],\n.region-level.level-green .region-value[data-v-4fdabcba],\n.region-level.level-green .spirit-icon[data-v-4fdabcba] {\n  color: #15803d;\n}\n.region-level.level-yellow[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(234, 179, 8, 0.1) 0%, rgba(250, 204, 21, 0.14) 100%);\n  border-color: rgba(234, 179, 8, 0.3);\n}\n.region-level.level-yellow .region-label[data-v-4fdabcba],\n.region-level.level-yellow .region-value[data-v-4fdabcba],\n.region-level.level-yellow .spirit-icon[data-v-4fdabcba] {\n  color: #b45309;\n}\n.region-level.level-orange[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(251, 146, 60, 0.08) 0%, rgba(253, 186, 116, 0.12) 100%);\n  border-color: rgba(251, 146, 60, 0.25);\n}\n.region-level.level-orange .region-label[data-v-4fdabcba],\n.region-level.level-orange .region-value[data-v-4fdabcba],\n.region-level.level-orange .spirit-icon[data-v-4fdabcba] {\n  color: #c2410c;\n}\n.region-level.level-red[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(248, 113, 113, 0.12) 100%);\n  border-color: rgba(239, 68, 68, 0.25);\n}\n.region-level.level-red .region-label[data-v-4fdabcba],\n.region-level.level-red .region-value[data-v-4fdabcba],\n.region-level.level-red .spirit-icon[data-v-4fdabcba] {\n  color: #b91c1c;\n}\n.region-level.level-black[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(55, 65, 81, 0.12) 0%, rgba(17, 24, 39, 0.16) 100%);\n  border-color: rgba(17, 24, 39, 0.35);\n}\n.region-level.level-black .region-label[data-v-4fdabcba],\n.region-level.level-black .region-value[data-v-4fdabcba],\n.region-level.level-black .spirit-icon[data-v-4fdabcba] {\n  color: #111827;\n}\n\n/* 灵气浓度等级样式 */\n.spirit-density.density-very-high[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.12) 0%, rgba(192, 132, 252, 0.16) 100%);\n  border-color: rgba(168, 85, 247, 0.35);\n}\n.spirit-density.density-very-high .spirit-icon[data-v-4fdabcba],\n.spirit-density.density-very-high .spirit-label[data-v-4fdabcba],\n.spirit-density.density-very-high .spirit-value[data-v-4fdabcba] {\n  color: #7c3aed;\n}\n.spirit-density.density-very-high .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #7c3aed 0%, #a78bfa 100%);\n  box-shadow: 0 0 10px rgba(124, 58, 237, 0.8);\n}\n.spirit-density.density-very-high .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(168, 85, 247, 0.5) 0%, transparent 70%);\n}\n.spirit-density.density-high[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(74, 222, 128, 0.14) 100%);\n  border-color: rgba(34, 197, 94, 0.3);\n}\n.spirit-density.density-high .spirit-icon[data-v-4fdabcba],\n.spirit-density.density-high .spirit-label[data-v-4fdabcba],\n.spirit-density.density-high .spirit-value[data-v-4fdabcba] {\n  color: #15803d;\n}\n.spirit-density.density-high .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #22c55e 0%, #4ade80 100%);\n  box-shadow: 0 0 8px rgba(34, 197, 94, 0.7);\n}\n.spirit-density.density-high .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(34, 197, 94, 0.4) 0%, transparent 70%);\n}\n.spirit-density.density-medium[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 197, 253, 0.12) 100%);\n  border-color: rgba(59, 130, 246, 0.25);\n}\n.spirit-density.density-low[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(251, 146, 60, 0.08) 0%, rgba(253, 186, 116, 0.12) 100%);\n  border-color: rgba(251, 146, 60, 0.25);\n}\n.spirit-density.density-low .spirit-icon[data-v-4fdabcba],\n.spirit-density.density-low .spirit-label[data-v-4fdabcba],\n.spirit-density.density-low .spirit-value[data-v-4fdabcba] {\n  color: #c2410c;\n}\n.spirit-density.density-low .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #f97316 0%, #fb923c 100%);\n  box-shadow: 0 0 6px rgba(249, 115, 22, 0.6);\n}\n.spirit-density.density-low .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(251, 146, 60, 0.3) 0%, transparent 70%);\n}\n.spirit-density.density-very-low[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(248, 113, 113, 0.12) 100%);\n  border-color: rgba(239, 68, 68, 0.25);\n}\n.spirit-density.density-very-low .spirit-icon[data-v-4fdabcba],\n.spirit-density.density-very-low .spirit-label[data-v-4fdabcba],\n.spirit-density.density-very-low .spirit-value[data-v-4fdabcba] {\n  color: #b91c1c;\n}\n.spirit-density.density-very-low .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);\n  box-shadow: 0 0 6px rgba(220, 38, 38, 0.6);\n}\n.spirit-density.density-very-low .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(239, 68, 68, 0.3) 0%, transparent 70%);\n}\n@keyframes spirit-pulse-4fdabcba {\n0%, 100% {\n    opacity: 0.8;\n    transform: scale(1);\n}\n50% {\n    opacity: 1;\n    transform: scale(1.1);\n}\n}\n@keyframes spirit-glow-pulse-4fdabcba {\n0%, 100% {\n    opacity: 0.4;\n    transform: scale(0.9);\n}\n50% {\n    opacity: 0.7;\n    transform: scale(1.2);\n}\n}\n.separator[data-v-4fdabcba] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.time-value[data-v-4fdabcba] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  font-family: 'Courier New', monospace;\n}\n.right-section[data-v-4fdabcba] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex: 1;\n  justify-content: flex-end;\n}\n.fullscreen-btn[data-v-4fdabcba] {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 16px;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n}\n.fullscreen-btn[data-v-4fdabcba]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n  color: var(--color-text);\n}\n\n/* 手机端适配 */\n@media (max-width: 767px) {\n.top-bar[data-v-4fdabcba] {\n    padding: 0 8px;\n    height: 50px;\n    min-height: 50px;\n    flex-wrap: nowrap;\n    overflow-x: auto;\n    overflow-y: hidden;\n}\n.game-title[data-v-4fdabcba] {\n    font-size: 0.9rem;\n    white-space: nowrap;\n    writing-mode: horizontal-tb;\n}\n.character-quick-info[data-v-4fdabcba] {\n    gap: 4px;\n    padding: 2px 6px;\n    flex-shrink: 1;\n    min-width: 0;\n}\n.character-name[data-v-4fdabcba] {\n    font-size: 0.7rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 60px;\n}\n.character-realm[data-v-4fdabcba] {\n    font-size: 0.6rem;\n    padding: 1px 3px;\n    white-space: nowrap;\n}\n.center-section[data-v-4fdabcba] {\n    flex: 1;\n    min-width: 0;\n    overflow: hidden;\n}\n.location-time-info[data-v-4fdabcba] {\n    padding: 3px 6px;\n    gap: 4px;\n    flex-wrap: wrap;\n    justify-content: center;\n    max-width: 100%;\n}\n.location-text[data-v-4fdabcba] {\n    font-size: 0.7rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 80px;\n}\n.spirit-density[data-v-4fdabcba] {\n    padding: 3px 6px;\n    margin-left: 4px;\n    gap: 4px;\n}\n.spirit-icon-wrapper[data-v-4fdabcba] {\n    width: 14px;\n    height: 14px;\n}\n.spirit-icon[data-v-4fdabcba] {\n    font-size: 0.7rem;\n}\n.spirit-label[data-v-4fdabcba] {\n    font-size: 0.6rem;\n}\n.spirit-value[data-v-4fdabcba] {\n    font-size: 0.65rem;\n    min-width: 18px;\n}\n.spirit-bar[data-v-4fdabcba] {\n    height: 2px;\n}\n.separator[data-v-4fdabcba] {\n    font-size: 0.65rem;\n}\n.time-value[data-v-4fdabcba] {\n    font-size: 0.65rem;\n    white-space: nowrap;\n}\n.fullscreen-btn[data-v-4fdabcba] {\n    width: 26px;\n    height: 26px;\n    font-size: 14px;\n    flex-shrink: 0;\n}\n.left-section[data-v-4fdabcba] {\n    gap: 6px;\n    flex: 0 1 auto;\n    min-width: 0;\n}\n.right-section[data-v-4fdabcba] {\n    gap: 6px;\n    flex: 0 0 auto;\n}\n}\n\n/* 超小屏幕适配 */\n@media (max-width: 375px) {\n.top-bar[data-v-4fdabcba] {\n    padding: 0 4px;\n}\n.game-title[data-v-4fdabcba] {\n    font-size: 0.8rem;\n}\n.character-quick-info[data-v-4fdabcba] {\n    gap: 3px;\n    padding: 2px 4px;\n}\n.character-name[data-v-4fdabcba] {\n    font-size: 0.65rem;\n    max-width: 50px;\n}\n.location-text[data-v-4fdabcba] {\n    font-size: 0.65rem;\n    max-width: 60px;\n}\n.time-value[data-v-4fdabcba] {\n    font-size: 0.6rem;\n}\n}\n\n/* 平板适配 */\n@media (min-width: 641px) and (max-width: 1024px) {\n.top-bar[data-v-4fdabcba] {\n    padding: 0 16px;\n}\n.game-title[data-v-4fdabcba] {\n    font-size: 1.1rem;\n}\n.left-section[data-v-4fdabcba] {\n    gap: 12px;\n}\n.right-section[data-v-4fdabcba] {\n    gap: 10px;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .top-bar[data-v-4fdabcba] {\n  background: #1e293b;\n  border-bottom-color: #334155;\n}\n[data-theme='dark'] .game-title[data-v-4fdabcba] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .character-quick-info[data-v-4fdabcba] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme='dark'] .character-name[data-v-4fdabcba] {\n  color: #e2e8f0;\n}\n[data-theme='dark'] .character-realm[data-v-4fdabcba] {\n  background: rgba(167, 139, 250, 0.2);\n  color: #a78bfa;\n}\n[data-theme='dark'] .location-time-info[data-v-4fdabcba] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme='dark'] .location-text[data-v-4fdabcba] {\n  color: #34d399;\n}\n[data-theme='dark'] .region-level[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(96, 165, 250, 0.15) 0%, rgba(147, 197, 253, 0.2) 100%);\n  border-color: rgba(96, 165, 250, 0.3);\n}\n[data-theme='dark'] .region-level[data-v-4fdabcba]:hover {\n  box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);\n  border-color: rgba(96, 165, 250, 0.5);\n}\n[data-theme='dark'] .spirit-icon[data-v-4fdabcba] {\n  color: #60a5fa;\n  filter: drop-shadow(0 0 4px rgba(96, 165, 250, 0.7));\n}\n[data-theme='dark'] .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(96, 165, 250, 0.5) 0%, transparent 70%);\n}\n[data-theme='dark'] .region-label[data-v-4fdabcba] {\n  color: #93c5fd;\n}\n[data-theme='dark'] .region-value[data-v-4fdabcba] {\n  color: #dbeafe;\n}\n[data-theme='dark'] .region-level.level-green .region-label[data-v-4fdabcba],\n[data-theme='dark'] .region-level.level-green .region-value[data-v-4fdabcba] {\n  color: #4ade80;\n}\n[data-theme='dark'] .region-level.level-yellow .region-label[data-v-4fdabcba],\n[data-theme='dark'] .region-level.level-yellow .region-value[data-v-4fdabcba] {\n  color: #facc15;\n}\n[data-theme='dark'] .region-level.level-orange .region-label[data-v-4fdabcba],\n[data-theme='dark'] .region-level.level-orange .region-value[data-v-4fdabcba] {\n  color: #fb923c;\n}\n[data-theme='dark'] .region-level.level-red .region-label[data-v-4fdabcba],\n[data-theme='dark'] .region-level.level-red .region-value[data-v-4fdabcba] {\n  color: #f87171;\n}\n[data-theme='dark'] .region-level.level-black .region-label[data-v-4fdabcba],\n[data-theme='dark'] .region-level.level-black .region-value[data-v-4fdabcba] {\n  color: #e5e7eb;\n}\n\n/* Dark theme - density levels */\n[data-theme='dark'] .spirit-density.density-very-high[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(192, 132, 252, 0.15) 0%, rgba(216, 180, 254, 0.2) 100%);\n  border-color: rgba(192, 132, 252, 0.35);\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-icon[data-v-4fdabcba],\n[data-theme='dark'] .spirit-density.density-very-high .spirit-label[data-v-4fdabcba] {\n  color: #c084fc;\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-value[data-v-4fdabcba] {\n  color: #e9d5ff;\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #a78bfa 0%, #c084fc 100%);\n  box-shadow: 0 0 12px rgba(168, 85, 247, 0.9);\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(192, 132, 252, 0.6) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-density.density-high[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(74, 222, 128, 0.12) 0%, rgba(134, 239, 172, 0.18) 100%);\n  border-color: rgba(74, 222, 128, 0.3);\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-icon[data-v-4fdabcba],\n[data-theme='dark'] .spirit-density.density-high .spirit-label[data-v-4fdabcba] {\n  color: #4ade80;\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-value[data-v-4fdabcba] {\n  color: #d1fae5;\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #34d399 0%, #6ee7b7 100%);\n  box-shadow: 0 0 10px rgba(52, 211, 153, 0.8);\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(74, 222, 128, 0.5) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-density.density-low[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(251, 146, 60, 0.12) 0%, rgba(253, 186, 116, 0.18) 100%);\n  border-color: rgba(251, 146, 60, 0.3);\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-icon[data-v-4fdabcba],\n[data-theme='dark'] .spirit-density.density-low .spirit-label[data-v-4fdabcba] {\n  color: #fb923c;\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-value[data-v-4fdabcba] {\n  color: #fed7aa;\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #f97316 0%, #fb923c 100%);\n  box-shadow: 0 0 8px rgba(249, 115, 22, 0.7);\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(251, 146, 60, 0.4) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-density.density-very-low[data-v-4fdabcba] {\n  background: linear-gradient(135deg, rgba(248, 113, 113, 0.12) 0%, rgba(252, 165, 165, 0.18) 100%);\n  border-color: rgba(248, 113, 113, 0.3);\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-icon[data-v-4fdabcba],\n[data-theme='dark'] .spirit-density.density-very-low .spirit-label[data-v-4fdabcba] {\n  color: #f87171;\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-value[data-v-4fdabcba] {\n  color: #fecaca;\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-bar-fill[data-v-4fdabcba] {\n  background: linear-gradient(90deg, #ef4444 0%, #f87171 100%);\n  box-shadow: 0 0 8px rgba(239, 68, 68, 0.7);\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-glow[data-v-4fdabcba] {\n  background: radial-gradient(circle, rgba(248, 113, 113, 0.4) 0%, transparent 70%);\n}\n[data-theme='dark'] .separator[data-v-4fdabcba] {\n  color: #64748b;\n}\n[data-theme='dark'] .time-value[data-v-4fdabcba] {\n  color: #cbd5e1;\n}\n[data-theme='dark'] .fullscreen-btn[data-v-4fdabcba] {\n  background: transparent;\n  border-color: #475569;\n  color: #94a3b8;\n}\n[data-theme='dark'] .fullscreen-btn[data-v-4fdabcba]:hover {\n  background: #334155;\n  border-color: #64748b;\n  color: #e2e8f0;\n}\n",""]);const s=i},9969:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>aie});var a=t(4965),r=t(641),o=t(33),i=t(953),s=t(3751),l=t(876),c=t(602);const d="videos",u=(0,c.P2)("video-cache-db",1,{upgrade(e){e.objectStoreNames.contains(d)||e.createObjectStore(d)}}),p={class:"video-background-container"},v=(0,r.pM)({__name:"VideoBackground",props:{src:{default:"https://ddct.top/backgroundvedio.mp4"}},setup(e){const n=e,t=(0,i.KR)(),a=async e=>{if(!t.value)return;t.value.src.startsWith("blob:")&&URL.revokeObjectURL(t.value.src);try{const n=await async function(e){try{const n=await u;return await n.get(d,e)}catch(n){return void console.error(`[videoCache] Error getting video for key ${e}:`,n)}}(e);if(!t.value)return;if(n){const e=URL.createObjectURL(n);t.value.src=e}else{const n=await fetch(e);if(!n.ok)throw new Error(`网络响应错误: ${n.statusText}`);const a=await n.blob();if(!t.value)return;if(await async function(e,n){try{const t=(await u).transaction(d,"readwrite");await t.store.put(n,e),await t.done}catch(n){throw console.error(`[videoCache] Error setting video for key ${e}:`,n),n}}(e,a),!t.value)return;const r=URL.createObjectURL(a);t.value.src=r}t.value.load()}catch(n){if(!t.value)return;t.value.src=e,t.value.load()}if(!t.value)return;const n=async()=>{if(t.value)try{await t.value.play()}catch{const e=async()=>{if(t.value)try{await t.value.play(),document.removeEventListener("click",e),document.removeEventListener("keydown",e),document.removeEventListener("touchstart",e)}catch{}};document.addEventListener("click",e,{once:!0}),document.addEventListener("keydown",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}};t.value.readyState>=3?await n():t.value.addEventListener("canplay",n,{once:!0})};(0,r.sV)(async()=>{await a(n.src)}),(0,r.wB)(()=>n.src,async e=>{e&&await a(e)}),(0,r.hi)(()=>{t.value&&(t.value.pause(),t.value.src.startsWith("blob:")&&URL.revokeObjectURL(t.value.src))});const o=()=>{},s=()=>{},l=()=>{};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",p,[(0,r.Lk)("video",{ref_key:"videoRef",ref:t,autoplay:"",muted:"",loop:"",playsinline:"",class:"video-background",onLoadstart:o,onCanplaythrough:s,onError:l},null,544),n[0]||(n[0]=(0,r.Lk)("div",{class:"video-overlay"},null,-1))]))}});var f=t(5072),h=t.n(f),m=t(7825),g=t.n(m),b=t(7659),y=t.n(b),x=t(5056),k=t.n(x),w=t(540),_=t.n(w),C=t(1113),A=t.n(C),S=t(9525),L={};L.styleTagTransform=A(),L.setAttributes=k(),L.insert=y().bind(null,"head"),L.domAPI=g(),L.insertStyleElement=_(),h()(S.A,L),S.A&&S.A.locals&&S.A.locals;var E=t(6262);const T=(0,E.A)(v,[["__scopeId","data-v-2821712e"]]);var I=t(9596);const R=(0,I.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),M=(0,I.A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),P=(0,I.A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),D=(0,I.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),z=(0,I.A)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),N=(0,I.A)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var $=t(9173),O=t(8546),F=t(9333);const j={class:"mode-selection-container"},B={class:"selection-content"},X={class:"top-info"},U={class:"version-tag"},W={class:"header-section"},q={class:"main-title"},G={class:"header-title"},H={class:"sub-title"},V={class:"paths-section"},Q={class:"section-header"},K={class:"text"},Y={class:"gate-container"},J={class:"gate-icon"},Z={class:"gate-info"},ee={class:"gate-title"},ne={class:"gate-desc"},te={class:"gate-detail"},ae={class:"gate-tags"},re={class:"tag-local"},oe={class:"tag-offline"},ie={key:0,class:"check-mark"},se={class:"gate-icon"},le={class:"gate-info"},ce={class:"gate-title"},de={class:"gate-desc"},ue={class:"gate-detail"},pe={class:"gate-tags"},ve={class:"tag-cloud"},fe={class:"tag-secure"},he={key:0,class:"check-mark"},me={key:1,class:"disabled-mask"},ge={class:"actions-section"},be={key:0,class:"action-group"},ye=(0,r.pM)({__name:"ModeSelection",emits:["start-creation","show-character-list","go-to-login"],setup(e,{emit:n}){const t=(0,i.KR)(null),a=(0,i.KR)(!1),c=(0,i.KR)(null),{t:d}=(0,l.s)(),u=(0,r.EW)(()=>a.value?c.value??d("同步中"):"");(0,r.sV)(async()=>{if((0,O.isBackendConfigured)()){const e=await(0,O.d9)();e&&(a.value=!0,c.value=e)}});const p=n,v=(0,$.useUIStore)(),f=async e=>{"cloud"!==e||a.value?("cloud"===e&&localStorage.getItem("access_token")&&(await(0,F.verifyStoredToken)()||(localStorage.removeItem("access_token"),localStorage.removeItem("username"),console.log("[ModeSelection] Token 无效，已清除"))),t.value===e?t.value=null:t.value=e):v.showRetryDialog({title:d("联机未启用"),message:d('未配置后端服务器，无法使用联机共修与登录功能。请先选择"单机闯关"。'),confirmText:d("知道了"),cancelText:d("取消"),onConfirm:()=>{},onCancel:()=>{}})},h=async()=>{if(t.value){if("cloud"===t.value&&!await(0,F.verifyStoredToken)())return void v.showRetryDialog({title:d("请先登录"),message:d("联机共修需要先登录账号，是否前往登录？"),confirmText:d("前往登录"),cancelText:d("取消"),onConfirm:()=>{p("go-to-login")},onCancel:()=>{}});p("start-creation",t.value)}},m=async()=>{p("show-character-list")};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",j,[(0,r.bF)(T),(0,r.Lk)("div",B,[(0,r.Q3)(" 右上角信息 "),(0,r.Lk)("div",X,[(0,r.Lk)("div",{class:(0,o.C4)(["status-indicator",a.value?"online":"offline"])},[n[2]||(n[2]=(0,r.Lk)("span",{class:"status-dot"},null,-1)),(0,r.Lk)("span",null,(0,o.v_)(a.value?e.$t("已连接"):e.$t("离线")),1)],2),(0,r.Lk)("div",U,"V"+(0,o.v_)(u.value),1)]),(0,r.Q3)(" 标题区域 "),(0,r.Lk)("div",W,[(0,r.Lk)("h1",q,[(0,r.Lk)("span",G,(0,o.v_)(e.$t("仙")),1),(0,r.eW)(" "+(0,o.v_)(e.$t("途")),1)]),(0,r.Lk)("p",H,(0,o.v_)(e.$t("闲时坐看涛生灭，千秋不过酒一壶")),1)]),(0,r.Q3)(" 道途选择 "),(0,r.Lk)("div",V,[(0,r.Lk)("div",Q,[n[3]||(n[3]=(0,r.Lk)("span",{class:"line"},null,-1)),(0,r.Lk)("span",K,(0,o.v_)(e.$t("择一道途")),1),n[4]||(n[4]=(0,r.Lk)("span",{class:"line"},null,-1))]),(0,r.Lk)("div",Y,[(0,r.Q3)(" 单机模式 "),(0,r.Lk)("div",{class:(0,o.C4)(["gate-card",{selected:"single"===t.value}]),onClick:n[0]||(n[0]=e=>f("single"))},[(0,r.Lk)("div",J,[n[5]||(n[5]=(0,r.Lk)("div",{class:"icon-bg"},null,-1)),(0,r.bF)((0,i.R1)(R),{size:36,"stroke-width":1.5})]),(0,r.Lk)("div",Z,[(0,r.Lk)("h2",ee,(0,o.v_)(e.$t("独自修行")),1),(0,r.Lk)("p",ne,(0,o.v_)(e.$t("避世清修 · 心无旁骛")),1),(0,r.Lk)("p",te,(0,o.v_)(e.$t("独居洞府，专心修炼，所有进度本地存储")),1),(0,r.Lk)("div",ae,[(0,r.Lk)("span",re,(0,o.v_)(e.$t("本地存储")),1),(0,r.Lk)("span",oe,(0,o.v_)(e.$t("离线可用")),1)])]),"single"===t.value?((0,r.uX)(),(0,r.CE)("div",ie,[(0,r.bF)((0,i.R1)(M),{size:18})])):(0,r.Q3)("v-if",!0)],2),(0,r.Q3)(" 联机模式 "),(0,r.Lk)("div",{class:(0,o.C4)(["gate-card",{selected:"cloud"===t.value,disabled:!a.value}]),onClick:n[1]||(n[1]=e=>f("cloud"))},[(0,r.Lk)("div",se,[n[6]||(n[6]=(0,r.Lk)("div",{class:"icon-bg"},null,-1)),(0,r.bF)((0,i.R1)(P),{size:36,"stroke-width":1.5})]),(0,r.Lk)("div",le,[(0,r.Lk)("h2",ce,(0,o.v_)(e.$t("联机共修")),1),(0,r.Lk)("p",de,(0,o.v_)(a.value?e.$t("道友相伴 · 共证大道"):e.$t("仙门未启 · 暂不可入")),1),(0,r.Lk)("p",ue,(0,o.v_)(e.$t("云端存档，多端同步，与道友共闯仙途")),1),(0,r.Lk)("div",pe,[(0,r.Lk)("span",ve,(0,o.v_)(e.$t("云端同步")),1),(0,r.Lk)("span",fe,(0,o.v_)(e.$t("数据安全")),1)])]),"cloud"===t.value?((0,r.uX)(),(0,r.CE)("div",he,[(0,r.bF)((0,i.R1)(M),{size:18})])):(0,r.Q3)("v-if",!0),a.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",me,[(0,r.bF)((0,i.R1)(D),{size:20}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("未启用")),1)]))],2)])]),(0,r.Q3)(" 操作按钮 "),(0,r.Lk)("div",ge,[(0,r.bF)(s.eB,{name:"fade-up"},{default:(0,r.k6)(()=>[t.value?((0,r.uX)(),(0,r.CE)("div",be,[(0,r.Lk)("button",{class:"btn-primary",onClick:h},[(0,r.bF)((0,i.R1)(z),{size:18}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("初入仙途")),1)]),(0,r.Lk)("button",{class:"btn-secondary",onClick:m},[(0,r.bF)((0,i.R1)(N),{size:18}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("续前世因缘")),1)])])):(0,r.Q3)("v-if",!0)]),_:1}),t.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn-ghost",onClick:m},[(0,r.bF)((0,i.R1)(N),{size:18}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("续前世因缘")),1)]))])])]))}});var xe=t(9880),ke={};ke.styleTagTransform=A(),ke.setAttributes=k(),ke.insert=y().bind(null,"head"),ke.domAPI=g(),ke.insertStyleElement=_(),h()(xe.A,ke),xe.A&&xe.A.locals&&xe.A.locals;const we=(0,E.A)(ye,[["__scopeId","data-v-947eced4"]]);var _e=t(4270),Ce=t(1211);const Ae=["disabled","title"],Se={key:0,class:"sync-icon"},Le={key:1,class:"sync-icon"},Ee={key:2,class:"sync-icon"},Te={class:"sync-text"},Ie=(0,r.pM)({__name:"CloudDataSync",props:{size:{},variant:{}},emits:["syncCompleted","syncStarted"],setup(e,{emit:n}){const t=n,a=(0,Ce.N)(),s=(0,$.useUIStore)(),{t:c}=(0,l.s)(),d=(0,i.KR)(!1),u=(0,i.KR)(!1),p=(0,r.EW)(()=>!s.isBackendConfiguredComputed);async function v(){if(d.value||u.value)return void(u.value&&_e.o.info(c("云端数据已获取，无需重复操作")));d.value=!0,t("syncStarted");const e="cloud-sync-toast";_e.o.loading(c("正在获取云端数据..."),{id:e});try{const n=await a.fetchAllCloudData();n>0?(_e.o.success(c("同步成功！新增 {0} 项云端数据").replace("{0}",String(n)),{id:e}),u.value=!0):(_e.o.info(c("所有云端数据已是最新"),{id:e}),u.value=!0),t("syncCompleted",{success:!0,newItemsCount:n,message:c("同步成功")})}catch(n){console.error("[云端同步组件] 同步云端数据失败:",n);const a=n instanceof Error?n.message:c("同步失败");_e.o.error(c("同步失败: {0}").replace("{0}",a),{id:e}),t("syncCompleted",{success:!1,newItemsCount:0,message:a})}finally{d.value=!1}}return(e,n)=>((0,r.uX)(),(0,r.CE)("button",{onClick:v,class:(0,o.C4)(["cloud-sync-button",{synced:u.value,disabled:p.value}]),disabled:p.value||d.value,title:p.value?c("云端功能暂未开放"):d.value?c("正在同步云端数据..."):u.value?c("云端数据已获取"):c("获取云端数据")},[d.value?((0,r.uX)(),(0,r.CE)("span",Se,"⏳")):u.value?((0,r.uX)(),(0,r.CE)("span",Le,"✅")):((0,r.uX)(),(0,r.CE)("span",Ee,"☁️")),(0,r.Lk)("span",Te,(0,o.v_)(p.value?c("暂不可用"):d.value?c("同步中"):u.value?c("已获取"):c("获取云端")),1)],10,Ae))}});var Re=t(2858),Me={};Me.styleTagTransform=A(),Me.setAttributes=k(),Me.insert=y().bind(null,"head"),Me.domAPI=g(),Me.insertStyleElement=_(),h()(Re.A,Me),Re.A&&Re.A.locals&&Re.A.locals;const Pe=(0,E.A)(Ie,[["__scopeId","data-v-2e1fd9da"]]);var De=t(8651),ze=t(7527);const Ne={class:"data-clear-container"},$e={class:"clear-buttons"},Oe=["disabled"],Fe=(0,r.pM)({__name:"DataClearButtons",props:{variant:{},size:{}},emits:["dataCleared"],setup(e,{emit:n}){const t=n,a=(0,Ce.N)(),o=(0,$.useUIStore)(),i=(0,r.EW)(()=>{const e=Math.max(...ze.eQ.map(e=>e.id)),n=Math.max(...ze.VQ.map(e=>e.id)),t=Math.max(...ze.yM.map(e=>e.id)),r=Math.max(...ze.qS.map(e=>e.id));return a.creationData.worlds.some(n=>"cloud"===n.source||n.id>e)||a.creationData.talentTiers.some(e=>"cloud"===e.source||e.id>n)||a.creationData.origins.some(e=>"cloud"===e.source||e.id>t)||a.creationData.talents.some(e=>"cloud"===e.source||e.id>r)});async function s(){i.value&&o.showRetryDialog({title:"清除自定义数据",message:"确定要清除自定义数据吗？这将清除所有自定义和AI生成的数据，保留本地基础数据和云端数据。此操作不可撤销！",confirmText:"确认清除",cancelText:"取消",onConfirm:async()=>{const e=a.creationData.worlds.length,n=a.creationData.talentTiers.length,r=a.creationData.origins.length,o=a.creationData.talents.length,i=Math.max(...ze.eQ.map(e=>e.id)),s=Math.max(...ze.VQ.map(e=>e.id)),l=Math.max(...ze.yM.map(e=>e.id)),c=Math.max(...ze.qS.map(e=>e.id));a.creationData.worlds=a.creationData.worlds.filter(e=>"local"===e.source||e.id<=i),a.creationData.talentTiers=a.creationData.talentTiers.filter(e=>"local"===e.source||e.id<=s),a.creationData.origins=a.creationData.origins.filter(e=>"local"===e.source||e.id<=l),a.creationData.talents=a.creationData.talents.filter(e=>"local"===e.source||e.id<=c);const d=e-a.creationData.worlds.length+(n-a.creationData.talentTiers.length)+(r-a.creationData.origins.length)+(o-a.creationData.talents.length);a.resetCharacter(),await async function(){try{const e=(0,De.getTavernHelper)();if(!e)return void console.warn("酒馆助手不可用，跳过清理酒馆自定义数据");await e.deleteVariable("DAD_creationData",{type:"global"}),console.log("已清理酒馆全局变量 DAD_creationData");const n=await e.getVariables({type:"global"}),t=Object.keys(n).filter(e=>e.includes("DAD_")||e.includes("custom")||e.includes("自定义"));t.length>0&&(await Promise.all(t.map(n=>e.deleteVariable(n,{type:"global"}))),console.log(`已清理 ${t.length} 个自定义数据相关的酒馆变量:`,t))}catch(e){console.error("清理酒馆自定义数据时出错:",e)}}(),await a.persistCustomData(),_e.o.success(`已清除${d} 项自定义数据，保留本地基础数据和云端数据`),t("dataCleared","custom",d)},onCancel:()=>{}})}return(0,r.EW)(()=>a.creationData.worlds.some(e=>"cloud"===e.source)||a.creationData.talentTiers.some(e=>"cloud"===e.source)||a.creationData.origins.some(e=>"cloud"===e.source)||a.creationData.talents.some(e=>"cloud"===e.source)),(e,n)=>((0,r.uX)(),(0,r.CE)("div",Ne,[(0,r.Lk)("div",$e,[(0,r.Q3)(" 清除自定义数据（自定义+AI生成），保留本地基础+云端数据 "),(0,r.Lk)("button",{onClick:s,class:"clear-button custom",disabled:!i.value,title:"清除自定义和AI生成的数据"},n[0]||(n[0]=[(0,r.Lk)("span",{class:"clear-icon"},"🗑️",-1),(0,r.Lk)("span",{class:"clear-text"},"清除自定义",-1)]),8,Oe),(0,r.Q3)(" 清除云端数据，保留本地基础+自定义数据 "),(0,r.Q3)(" 🔥 暂时隐藏：后端未上线 "),(0,r.Q3)("v-if",!0)])]))}});var je=t(1224),Be={};Be.styleTagTransform=A(),Be.setAttributes=k(),Be.insert=y().bind(null,"head"),Be.domAPI=g(),Be.insertStyleElement=_(),h()(je.A,Be),je.A&&je.A.locals&&je.A.locals;const Xe=(0,E.A)(Fe,[["__scopeId","data-v-0a6d9200"]]),Ue={class:"modal-container"},We={class:"modal-content"},qe={class:"form-group"},Ge={class:"char-count"},He={class:"form-group"},Ve={class:"char-count"},Qe={key:0,class:"preset-preview"},Ke={class:"preview-tags"},Ye={key:0,class:"info-tag"},Je={key:1,class:"info-tag"},Ze={key:2,class:"info-tag"},en={key:3,class:"info-tag talent-tag"},nn={class:"preset-info"},tn={class:"info-item"},an={class:"info-value"},rn={class:"modal-footer"},on=["disabled"],sn={key:0},ln={key:1},cn=(0,r.pM)({__name:"PresetSaveModal",props:{visible:{type:Boolean},characterData:{}},emits:["close","submit"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)(""),c=(0,i.KR)(""),d=(0,i.KR)(""),u=(0,i.KR)(!1);let p=null;function v(){const e=new Date;d.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function f(){u.value||a("close")}function h(){l.value.trim()&&!u.value&&(u.value=!0,setTimeout(()=>{a("submit",{presetName:l.value.trim(),presetDescription:c.value.trim(),characterData:t.characterData}),u.value=!1},300))}return(0,r.sV)(()=>{v(),p=window.setInterval(v,1e3)}),(0,r.hi)(()=>{null!==p&&clearInterval(p)}),(0,r.wB)(()=>t.visible,e=>{e&&(l.value="",c.value="",v(),setTimeout(()=>{const e=document.querySelector(".form-input");e?.focus()},100))}),(e,n)=>e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(f,["self"])},[(0,r.Lk)("div",Ue,[(0,r.Q3)(" Header "),(0,r.Lk)("div",{class:"modal-header"},[n[2]||(n[2]=(0,r.Lk)("h2",{class:"modal-title"},"💾 保存预设",-1)),(0,r.Lk)("button",{class:"modal-close",onClick:f},"×")]),(0,r.Q3)(" Content "),(0,r.Lk)("div",We,[(0,r.Lk)("div",qe,[n[3]||(n[3]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)("预设名称 "),(0,r.Lk)("span",{class:"required"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),type:"text",class:"form-input",placeholder:"请输入预设名称（如：剑修预设、治愈系预设等）",onKeyup:(0,s.jR)(h,["enter"]),maxlength:"50",autofocus:""},null,544),[[s.Jo,l.value]]),(0,r.Lk)("div",Ge,(0,o.v_)(l.value.length)+"/50",1)]),(0,r.Lk)("div",He,[n[4]||(n[4]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)("预设描述 "),(0,r.Lk)("span",{class:"optional"},"（可选）")],-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[1]||(n[1]=e=>c.value=e),class:"form-textarea",placeholder:"输入此预设的描述信息...",maxlength:"200",rows:"4"},null,512),[[s.Jo,c.value]]),(0,r.Lk)("div",Ve,(0,o.v_)(c.value.length)+"/200",1)]),(0,r.Q3)(" 预设内容预览 "),e.characterData?((0,r.uX)(),(0,r.CE)("div",Qe,[n[5]||(n[5]=(0,r.Lk)("div",{class:"preview-header"},"📋 预设内容预览",-1)),(0,r.Lk)("div",Ke,[e.characterData.world?((0,r.uX)(),(0,r.CE)("span",Ye,(0,o.v_)(e.characterData.world.name),1)):(0,r.Q3)("v-if",!0),e.characterData.talentTier?((0,r.uX)(),(0,r.CE)("span",Je,(0,o.v_)(e.characterData.talentTier.name),1)):(0,r.Q3)("v-if",!0),e.characterData.origin?((0,r.uX)(),(0,r.CE)("span",Ze,(0,o.v_)(e.characterData.origin.name),1)):(0,r.Q3)("v-if",!0),e.characterData.talents&&e.characterData.talents.length>0?((0,r.uX)(),(0,r.CE)("span",en,(0,o.v_)(e.characterData.talents.length)+" 个天赋 ",1)):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",nn,[(0,r.Lk)("div",tn,[n[6]||(n[6]=(0,r.Lk)("span",{class:"info-label"},"📅 保存时间：",-1)),(0,r.Lk)("span",an,(0,o.v_)(d.value),1)])])]),(0,r.Q3)(" Footer "),(0,r.Lk)("div",rn,[(0,r.Lk)("button",{class:"btn btn-cancel",onClick:f},"取消"),(0,r.Lk)("button",{class:"btn btn-confirm",onClick:h,disabled:!l.value.trim()||u.value},[u.value?((0,r.uX)(),(0,r.CE)("span",sn,"💫 保存中...")):((0,r.uX)(),(0,r.CE)("span",ln,"✨ 保存预设"))],8,on)])])])):(0,r.Q3)("v-if",!0)}});var dn=t(8693),un={};un.styleTagTransform=A(),un.setAttributes=k(),un.insert=y().bind(null,"head"),un.domAPI=g(),un.insertStyleElement=_(),h()(dn.A,un),dn.A&&dn.A.locals&&dn.A.locals;const pn=(0,E.A)(cn,[["__scopeId","data-v-8054cec0"]]),vn=["disabled","title"],fn={key:0,class:"sync-icon"},hn={key:1,class:"sync-icon"},mn={key:2,class:"sync-icon"},gn={class:"sync-text"},bn=(0,r.pM)({__name:"StorePreSeting",props:{size:{},variant:{},currentStep:{},totalSteps:{},characterData:{}},emits:["storeCompleted","storeStarted"],setup(e,{emit:n}){const t=e,a=n,s=(0,i.KR)(!1),c=(0,i.KR)(!1),d=(0,i.KR)(!1),{t:u}=(0,l.s)(),p=(0,r.EW)(()=>void 0===t.currentStep||void 0===t.totalSteps||t.currentStep===t.totalSteps);function v(){s.value||c.value||!p.value?c.value?_e.o.info(u("预设已存储，无需重复操作")):p.value||_e.o.warning(u("请完成所有步骤后再保存预设")):(d.value=!0,a("storeStarted"))}async function f(e){s.value=!0,d.value=!1;const n={name:e.presetName,description:e.presetDescription,savedAt:(new Date).toISOString()};c.value=!0,a("storeCompleted",{success:!0,message:u("预设保存成功"),presetData:n}),s.value=!1}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("button",{onClick:v,class:(0,o.C4)(["cloud-sync-button",{synced:c.value}]),disabled:s.value||!p.value,title:p.value?s.value?u("正在存储预设..."):c.value?u("预设已存储"):u("保存当前选择为预设"):u("请完成所有步骤后再保存预设")},[s.value?((0,r.uX)(),(0,r.CE)("span",fn,"⏳")):c.value?((0,r.uX)(),(0,r.CE)("span",hn,"✅")):((0,r.uX)(),(0,r.CE)("span",mn,"💾")),(0,r.Lk)("span",gn,(0,o.v_)(s.value?u("存储中"):c.value?u("已存储"):u("存储预设")),1)],10,vn),(0,r.Q3)(" 预设保存对话框 "),(0,r.bF)(pn,{visible:d.value,"character-data":t.characterData,onClose:n[0]||(n[0]=e=>d.value=!1),onSubmit:f},null,8,["visible","character-data"])]))}});var yn=t(2497),xn={};xn.styleTagTransform=A(),xn.setAttributes=k(),xn.insert=y().bind(null,"head"),xn.domAPI=g(),xn.insertStyleElement=_(),h()(yn.A,xn),yn.A&&yn.A.locals&&yn.A.locals;const kn=(0,E.A)(bn,[["__scopeId","data-v-5cceb5b0"]]);var wn=t(5735);const _n={class:"modal-container"},Cn={class:"modal-content"},An={key:0,class:"loading-state"},Sn={key:1,class:"empty-state"},Ln={key:2},En={class:"export-options"},Tn={class:"option-label"},In={class:"option-text"},Rn={class:"option-desc"},Mn={class:"option-label"},Pn={key:0,class:"presets-list"},Dn={class:"list-header"},zn={class:"checkbox-label"},Nn=["checked"],$n={class:"selected-count"},On={class:"preset-items"},Fn=["value"],jn={class:"preset-info"},Bn={class:"preset-header"},Xn={class:"preset-name"},Un={class:"preset-date"},Wn={key:0,class:"preset-description"},qn={key:1,class:"preset-tags"},Gn={key:0,class:"info-tag name-tag"},Hn={key:1,class:"info-tag age-tag"},Vn={key:2,class:"info-tag"},Qn={key:3,class:"info-tag"},Kn={class:"export-info"},Yn={class:"info-item"},Jn={class:"info-value"},Zn={class:"info-item"},et={class:"info-value"},nt={class:"modal-footer"},tt=["disabled"],at={key:0},rt={key:1},ot=(0,r.pM)({__name:"PresetExportModal",props:{visible:{type:Boolean}},emits:["close","exported"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)([]),c=(0,i.KR)("all"),d=(0,i.KR)([]),u=(0,i.KR)(!1),p=(0,i.KR)(!1),v=(0,i.KR)("");let f=null;const h=(0,r.EW)(()=>l.value.length>0&&d.value.length===l.value.length),m=(0,r.EW)(()=>0!==l.value.length&&("all"===c.value||d.value.length>0));function g(){const e=new Date;v.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function b(e){const n=new Date(e),t=(new Date).getTime()-n.getTime(),a=Math.floor(t/864e5);return 0===a?"今天":1===a?"昨天":a<7?`${a}天前`:n.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}function y(){h.value?d.value=[]:d.value=l.value.map(e=>e.id)}function x(){return"all"===c.value?l.value.length:d.value.length}function k(){p.value||a("close")}async function w(){if(!m.value||p.value)return;p.value=!0;const e="export-preset-toast";_e.o.loading("正在导出预设...",{id:e});try{const n="all"===c.value?void 0:d.value;await(0,wn.VW)(n);const t=x();_e.o.success(`成功导出 ${t} 个预设！`,{id:e}),a("exported"),a("close")}catch(n){console.error("[预设导出对话框] 导出失败:",n);const t=n instanceof Error?n.message:"导出失败";_e.o.error(`导出失败: ${t}`,{id:e})}finally{p.value=!1}}return(0,r.sV)(()=>{g(),f=window.setInterval(g,1e3)}),(0,r.hi)(()=>{null!==f&&clearInterval(f)}),(0,r.wB)(()=>t.visible,async e=>{e&&(c.value="all",d.value=[],await async function(){u.value=!0;try{console.log("[预设导出对话框] 开始加载预设列表");const e=await(0,wn.Vd)();l.value=e,console.log("[预设导出对话框] 成功加载",l.value.length,"个预设")}catch(e){console.error("[预设导出对话框] 加载预设列表失败:",e),_e.o.error("加载预设列表失败"),l.value=[]}finally{u.value=!1}}())}),(e,n)=>e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(k,["self"])},[(0,r.Lk)("div",_n,[(0,r.Q3)(" Header "),(0,r.Lk)("div",{class:"modal-header"},[n[3]||(n[3]=(0,r.Lk)("h2",{class:"modal-title"},"📤 导出预设",-1)),(0,r.Lk)("button",{class:"modal-close",onClick:k},"×")]),(0,r.Q3)(" Content "),(0,r.Lk)("div",Cn,[u.value?((0,r.uX)(),(0,r.CE)("div",An,n[4]||(n[4]=[(0,r.Lk)("div",{class:"spinner"},null,-1),(0,r.Lk)("p",null,"正在加载预设列表...",-1)]))):0===l.value.length?((0,r.uX)(),(0,r.CE)("div",Sn,n[5]||(n[5]=[(0,r.Lk)("div",{class:"empty-icon"},"📭",-1),(0,r.Lk)("p",null,"暂无可导出的预设",-1),(0,r.Lk)("p",{class:"empty-hint"},"请先保存一些预设后再进行导出",-1)]))):((0,r.uX)(),(0,r.CE)("div",Ln,[(0,r.Q3)(" 导出模式选择 "),(0,r.Lk)("div",En,[(0,r.Lk)("label",Tn,[(0,r.bo)((0,r.Lk)("input",{type:"radio","onUpdate:modelValue":n[0]||(n[0]=e=>c.value=e),value:"all",class:"radio-input"},null,512),[[s.XL,c.value]]),(0,r.Lk)("span",In,[n[6]||(n[6]=(0,r.Lk)("span",{class:"option-title"},"导出全部预设",-1)),(0,r.Lk)("span",Rn,"导出所有 "+(0,o.v_)(l.value.length)+" 个预设",1)])]),(0,r.Lk)("label",Mn,[(0,r.bo)((0,r.Lk)("input",{type:"radio","onUpdate:modelValue":n[1]||(n[1]=e=>c.value=e),value:"selected",class:"radio-input"},null,512),[[s.XL,c.value]]),n[7]||(n[7]=(0,r.Lk)("span",{class:"option-text"},[(0,r.Lk)("span",{class:"option-title"},"导出选中预设"),(0,r.Lk)("span",{class:"option-desc"},"选择要导出的预设")],-1))])]),(0,r.Q3)(" 预设列表 (仅在选中模式下显示) "),"selected"===c.value?((0,r.uX)(),(0,r.CE)("div",Pn,[(0,r.Lk)("div",Dn,[(0,r.Lk)("label",zn,[(0,r.Lk)("input",{type:"checkbox",checked:h.value,onChange:y,class:"checkbox-input"},null,40,Nn),n[8]||(n[8]=(0,r.Lk)("span",null,"全选/取消全选",-1))]),(0,r.Lk)("span",$n,"已选择 "+(0,o.v_)(d.value.length)+" 个",1)]),(0,r.Lk)("div",On,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.value,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.id,class:(0,o.C4)(["preset-item",{selected:d.value.includes(e.id)}])},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":n[2]||(n[2]=e=>d.value=e),class:"checkbox-input"},null,8,Fn),[[s.lH,d.value]]),(0,r.Lk)("div",jn,[(0,r.Lk)("div",Bn,[(0,r.Lk)("h3",Xn,(0,o.v_)(e.name||"未命名预设"),1),(0,r.Lk)("span",Un,(0,o.v_)(b(e.savedAt)),1)]),e.description?((0,r.uX)(),(0,r.CE)("p",Wn,(0,o.v_)(e.description),1)):(0,r.Q3)("v-if",!0),e.data?((0,r.uX)(),(0,r.CE)("div",qn,[e.data.character_name?((0,r.uX)(),(0,r.CE)("span",Gn,(0,o.v_)(e.data.character_name),1)):(0,r.Q3)("v-if",!0),e.data.current_age?((0,r.uX)(),(0,r.CE)("span",Hn,(0,o.v_)(e.data.current_age)+"岁",1)):(0,r.Q3)("v-if",!0),e.data.world?((0,r.uX)(),(0,r.CE)("span",Vn,(0,o.v_)(e.data.world.name),1)):(0,r.Q3)("v-if",!0),e.data.talentTier?((0,r.uX)(),(0,r.CE)("span",Qn,(0,o.v_)(e.data.talentTier.name),1)):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)])],2))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 导出信息 "),(0,r.Lk)("div",Kn,[(0,r.Lk)("div",Yn,[n[9]||(n[9]=(0,r.Lk)("span",{class:"info-label"},"📦 导出数量：",-1)),(0,r.Lk)("span",Jn,(0,o.v_)(x())+" 个预设",1)]),n[11]||(n[11]=(0,r.Lk)("div",{class:"info-item"},[(0,r.Lk)("span",{class:"info-label"},"📄 文件格式："),(0,r.Lk)("span",{class:"info-value"},"JSON")],-1)),(0,r.Lk)("div",Zn,[n[10]||(n[10]=(0,r.Lk)("span",{class:"info-label"},"📅 导出时间：",-1)),(0,r.Lk)("span",et,(0,o.v_)(v.value),1)])])]))]),(0,r.Q3)(" Footer "),(0,r.Lk)("div",nt,[(0,r.Lk)("button",{class:"btn btn-cancel",onClick:k},"取消"),(0,r.Lk)("button",{class:"btn btn-confirm",onClick:w,disabled:!m.value||p.value},[p.value?((0,r.uX)(),(0,r.CE)("span",at,"⏳ 导出中...")):((0,r.uX)(),(0,r.CE)("span",rt,"📥 导出预设"))],8,tt)])])])):(0,r.Q3)("v-if",!0)}});var it=t(7457),st={};st.styleTagTransform=A(),st.setAttributes=k(),st.insert=y().bind(null,"head"),st.domAPI=g(),st.insertStyleElement=_(),h()(it.A,st),it.A&&it.A.locals&&it.A.locals;const lt=(0,E.A)(ot,[["__scopeId","data-v-3e075713"]]),ct={class:"modal-container"},dt={class:"modal-content"},ut={key:0,class:"file-info"},pt={class:"file-header"},vt={class:"file-name"},ft={class:"file-size"},ht={key:1,class:"import-options"},mt={class:"option-label"},gt={class:"option-label"},bt={class:"result-icon"},yt={class:"result-content"},xt={class:"result-message"},kt={key:0,class:"result-details"},wt={key:0,class:"detail-item success"},_t={key:1,class:"detail-item error"},Ct={class:"modal-footer"},At=["disabled"],St={key:0},Lt={key:1},Et=(0,r.pM)({__name:"PresetImportModal",props:{visible:{type:Boolean}},emits:["close","imported"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)(null),c=(0,i.KR)(null),d=(0,i.KR)("merge"),u=(0,i.KR)(!1),p=(0,i.KR)(!1),v=(0,i.KR)(null);function f(){l.value?.click()}function h(e){const n=e.target,t=n.files?.[0];t&&g(t)}function m(e){p.value=!1;const n=e.dataTransfer?.files[0];n&&g(n)}function g(e){e.name.endsWith(".json")||"application/json"===e.type?e.size>10485760?_e.o.error("文件大小超过限制（最大10MB）"):(c.value=e,v.value=null):_e.o.error("请选择JSON格式的文件")}function b(){c.value=null,v.value=null,l.value&&(l.value.value="")}function y(){u.value||a("close")}async function x(){if(!c.value||u.value)return;if("replace"===d.value&&!window.confirm("替换模式将删除所有现有预设！\n\n此操作不可撤销，确定要继续吗？"))return;u.value=!0;const e="import-preset-toast";_e.o.loading("正在导入预设...",{id:e});try{const n=await(0,wn.Ge)(c.value,d.value);console.log("[预设导入对话框] 导入完成:",n),n.success>0&&0===n.failed?(v.value={type:"success",message:`成功导入 ${n.success} 个预设！`,details:n},_e.o.success(`成功导入 ${n.success} 个预设！`,{id:e})):n.success>0&&n.failed>0?(v.value={type:"warning",message:"部分预设导入成功",details:n},_e.o.warning(`成功: ${n.success} 个，失败: ${n.failed} 个`,{id:e})):(v.value={type:"error",message:"预设导入失败",details:n},_e.o.error("预设导入失败",{id:e})),a("imported",n)}catch(n){console.error("[预设导入对话框] 导入失败:",n);const t=n instanceof Error?n.message:"导入失败";v.value={type:"error",message:`导入失败: ${t}`},_e.o.error(`导入失败: ${t}`,{id:e})}finally{u.value=!1}}return(0,r.wB)(()=>t.visible,e=>{e&&(c.value=null,d.value="merge",v.value=null,p.value=!1)}),(e,n)=>{return e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(y,["self"])},[(0,r.Lk)("div",ct,[(0,r.Q3)(" Header "),(0,r.Lk)("div",{class:"modal-header"},[n[4]||(n[4]=(0,r.Lk)("h2",{class:"modal-title"},"📥 导入预设",-1)),(0,r.Lk)("button",{class:"modal-close",onClick:y},"×")]),(0,r.Q3)(" Content "),(0,r.Lk)("div",dt,[(0,r.Q3)(" 文件选择区域 "),(0,r.Lk)("div",{class:(0,o.C4)(["upload-area",{"drag-over":p.value}]),onDrop:(0,s.D$)(m,["prevent"]),onDragover:n[0]||(n[0]=(0,s.D$)(e=>p.value=!0,["prevent"])),onDragleave:n[1]||(n[1]=(0,s.D$)(e=>p.value=!1,["prevent"]))},[(0,r.Lk)("input",{ref_key:"fileInputRef",ref:l,type:"file",accept:".json,application/json",onChange:h,class:"file-input"},null,544),(0,r.Lk)("div",{class:"upload-content"},[n[5]||(n[5]=(0,r.Lk)("div",{class:"upload-icon"},"📁",-1)),n[6]||(n[6]=(0,r.Lk)("p",{class:"upload-text"},"拖放JSON文件到此处，或点击选择文件",-1)),(0,r.Lk)("button",{class:"btn-select",onClick:f},"选择文件"),n[7]||(n[7]=(0,r.Lk)("p",{class:"upload-hint"},"仅支持通过本应用导出的预设JSON文件",-1))])],34),(0,r.Q3)(" 已选择文件信息 "),c.value?((0,r.uX)(),(0,r.CE)("div",ut,[(0,r.Lk)("div",pt,[n[8]||(n[8]=(0,r.Lk)("span",{class:"file-icon"},"📄",-1)),(0,r.Lk)("span",vt,(0,o.v_)(c.value.name),1),(0,r.Lk)("span",ft,(0,o.v_)((t=c.value.size,t<1024?`${t} B`:t<1048576?`${(t/1024).toFixed(2)} KB`:`${(t/1048576).toFixed(2)} MB`)),1),(0,r.Lk)("button",{class:"btn-remove",onClick:b},"×")])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 导入选项 "),c.value?((0,r.uX)(),(0,r.CE)("div",ht,[(0,r.Lk)("label",mt,[(0,r.bo)((0,r.Lk)("input",{type:"radio","onUpdate:modelValue":n[2]||(n[2]=e=>d.value=e),value:"merge",class:"radio-input"},null,512),[[s.XL,d.value]]),n[9]||(n[9]=(0,r.Lk)("span",{class:"option-text"},[(0,r.Lk)("span",{class:"option-title"},"合并模式"),(0,r.Lk)("span",{class:"option-desc"},"将导入的预设添加到现有预设中（推荐）")],-1))]),(0,r.Lk)("label",gt,[(0,r.bo)((0,r.Lk)("input",{type:"radio","onUpdate:modelValue":n[3]||(n[3]=e=>d.value=e),value:"replace",class:"radio-input"},null,512),[[s.XL,d.value]]),n[10]||(n[10]=(0,r.Lk)("span",{class:"option-text"},[(0,r.Lk)("span",{class:"option-title"},"替换模式"),(0,r.Lk)("span",{class:"option-desc warning"},"将清除所有现有预设，仅保留导入的预设")],-1))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 导入结果 "),v.value?((0,r.uX)(),(0,r.CE)("div",{key:2,class:(0,o.C4)(["import-result",v.value.type])},[(0,r.Lk)("div",bt,(0,o.v_)("success"===v.value.type?"✅":"warning"===v.value.type?"⚠️":"❌"),1),(0,r.Lk)("div",yt,[(0,r.Lk)("p",xt,(0,o.v_)(v.value.message),1),v.value.details?((0,r.uX)(),(0,r.CE)("div",kt,[v.value.details.success>0?((0,r.uX)(),(0,r.CE)("span",wt," 成功导入: "+(0,o.v_)(v.value.details.success)+" 个 ",1)):(0,r.Q3)("v-if",!0),v.value.details.failed>0?((0,r.uX)(),(0,r.CE)("span",_t," 导入失败: "+(0,o.v_)(v.value.details.failed)+" 个 ",1)):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)])],2)):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" Footer "),(0,r.Lk)("div",Ct,[(0,r.Lk)("button",{class:"btn btn-cancel",onClick:y},(0,o.v_)(v.value?"关闭":"取消"),1),v.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-confirm",onClick:x,disabled:!c.value||u.value},[u.value?((0,r.uX)(),(0,r.CE)("span",St,"⏳ 导入中...")):((0,r.uX)(),(0,r.CE)("span",Lt,"📤 开始导入"))],8,At))])])])):(0,r.Q3)("v-if",!0);var t}}});var Tt=t(9531),It={};It.styleTagTransform=A(),It.setAttributes=k(),It.insert=y().bind(null,"head"),It.domAPI=g(),It.insertStyleElement=_(),h()(Tt.A,It),Tt.A&&Tt.A.locals&&Tt.A.locals;const Rt=(0,E.A)(Et,[["__scopeId","data-v-3fadd167"]]),Mt={class:"modal-container"},Pt={class:"modal-header"},Dt={class:"title-section"},zt={key:0,class:"preset-count"},Nt={class:"header-actions"},$t={class:"modal-content"},Ot={key:0,class:"loading-state"},Ft={key:1,class:"empty-state"},jt={key:2,class:"presets-list"},Bt=["onClick"],Xt={class:"preset-header"},Ut={class:"preset-name"},Wt={class:"preset-actions"},qt={class:"preset-date"},Gt=["onClick"],Ht={key:0,class:"preset-description"},Vt={key:1,class:"preset-info"},Qt={key:0,class:"info-tag name-tag"},Kt={key:1,class:"info-tag age-tag"},Yt={key:2,class:"info-tag"},Jt={key:3,class:"info-tag"},Zt={key:4,class:"info-tag"},ea={class:"modal-footer"},na=["disabled"],ta={key:0},aa={key:1},ra=(0,r.pM)({__name:"PresetLoadModal",props:{visible:{type:Boolean}},emits:["close","select"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)([]),c=(0,i.KR)(null),d=(0,i.KR)(!1),u=(0,i.KR)(!1),p=(0,i.KR)(!1),v=(0,i.KR)(!1);async function f(){d.value=!0;try{console.log("[预设加载对话框] 开始加载预设列表");const e=await(0,wn.Vd)();l.value=e,console.log("[预设加载对话框] 成功加载",l.value.length,"个预设",l.value)}catch(e){console.error("[预设加载对话框] 加载预设列表失败:",e),_e.o.error("加载预设列表失败"),l.value=[]}finally{d.value=!1}}function h(e){const n=new Date(e),t=(new Date).getTime()-n.getTime(),a=Math.floor(t/864e5);return 0===a?"今天":1===a?"昨天":a<7?`${a}天前`:n.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}function m(){u.value||a("close")}function g(){c.value&&!u.value&&(u.value=!0,setTimeout(()=>{c.value&&a("select",c.value),u.value=!1},300))}function b(){console.log("[预设加载对话框] 预设已导出"),f()}async function y(e){console.log("[预设加载对话框] 预设导入完成:",e),await f()}return(0,r.wB)(()=>t.visible,async e=>{e&&(c.value=null,await f())}),(e,n)=>e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(m,["self"])},[(0,r.Lk)("div",Mt,[(0,r.Q3)(" Header "),(0,r.Lk)("div",Pt,[(0,r.Lk)("div",Dt,[n[4]||(n[4]=(0,r.Lk)("h2",{class:"modal-title"},"📂 加载预设",-1)),!d.value&&l.value.length>0?((0,r.uX)(),(0,r.CE)("span",zt,(0,o.v_)(l.value.length)+" 个",1)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Nt,[(0,r.Lk)("button",{class:"btn-action import",onClick:n[0]||(n[0]=e=>v.value=!0)},n[5]||(n[5]=[(0,r.Lk)("span",{class:"btn-icon"},"📥",-1),(0,r.Lk)("span",{class:"btn-text"},"导入",-1)])),(0,r.Lk)("button",{class:"btn-action export",onClick:n[1]||(n[1]=e=>p.value=!0)},n[6]||(n[6]=[(0,r.Lk)("span",{class:"btn-icon"},"📤",-1),(0,r.Lk)("span",{class:"btn-text"},"导出",-1)])),(0,r.Lk)("button",{class:"modal-close",onClick:m},"×")])]),(0,r.Q3)(" Content "),(0,r.Lk)("div",$t,[d.value?((0,r.uX)(),(0,r.CE)("div",Ot,n[7]||(n[7]=[(0,r.Lk)("div",{class:"spinner"},null,-1),(0,r.Lk)("p",null,"正在加载预设列表...",-1)]))):0===l.value.length?((0,r.uX)(),(0,r.CE)("div",Ft,n[8]||(n[8]=[(0,r.Lk)("div",{class:"empty-icon"},"📭",-1),(0,r.Lk)("p",null,"暂无保存的预设",-1),(0,r.Lk)("p",{class:"empty-hint"},"完成角色创建后,可以保存为预设以便快速开始新游戏",-1)]))):((0,r.uX)(),(0,r.CE)("div",jt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["preset-item",{selected:c.value?.id===e.id}]),onClick:n=>c.value=e},[(0,r.Lk)("div",Xt,[(0,r.Lk)("h3",Ut,(0,o.v_)(e.name||"未命名预设"),1),(0,r.Lk)("div",Wt,[(0,r.Lk)("span",qt,(0,o.v_)(h(e.savedAt)),1),(0,r.Lk)("button",{class:"btn-delete",onClick:(0,s.D$)(n=>async function(e){if(window.confirm("确定要删除这个预设吗？此操作不可撤销。"))try{await(0,wn.BC)(e),_e.o.success("预设已删除"),await f(),c.value?.id===e&&(c.value=null)}catch(e){console.error("[预设加载对话框] 删除预设失败:",e),_e.o.error("删除预设失败")}}(e.id),["stop"])},"×",8,Gt)])]),e.description?((0,r.uX)(),(0,r.CE)("p",Ht,(0,o.v_)(e.description),1)):(0,r.Q3)("v-if",!0),e.data?((0,r.uX)(),(0,r.CE)("div",Vt,[e.data.character_name?((0,r.uX)(),(0,r.CE)("span",Qt,(0,o.v_)(e.data.character_name),1)):(0,r.Q3)("v-if",!0),e.data.current_age?((0,r.uX)(),(0,r.CE)("span",Kt,(0,o.v_)(e.data.current_age)+"岁",1)):(0,r.Q3)("v-if",!0),e.data.world?((0,r.uX)(),(0,r.CE)("span",Yt,(0,o.v_)(e.data.world.name),1)):(0,r.Q3)("v-if",!0),e.data.talentTier?((0,r.uX)(),(0,r.CE)("span",Jt,(0,o.v_)(e.data.talentTier.name),1)):(0,r.Q3)("v-if",!0),e.data.origin?((0,r.uX)(),(0,r.CE)("span",Zt,(0,o.v_)(e.data.origin.name),1)):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)],10,Bt))),128))]))]),(0,r.Q3)(" Footer "),(0,r.Lk)("div",ea,[(0,r.Lk)("button",{class:"btn btn-cancel",onClick:m},"取消"),(0,r.Lk)("button",{class:"btn btn-confirm",onClick:g,disabled:!c.value||u.value},[u.value?((0,r.uX)(),(0,r.CE)("span",ta,"⏳ 加载中...")):((0,r.uX)(),(0,r.CE)("span",aa,"✨ 加载预设"))],8,na)])]),(0,r.Q3)(" 导出预设对话框 "),(0,r.bF)(lt,{visible:p.value,onClose:n[2]||(n[2]=e=>p.value=!1),onExported:b},null,8,["visible"]),(0,r.Q3)(" 导入预设对话框 "),(0,r.bF)(Rt,{visible:v.value,onClose:n[3]||(n[3]=e=>v.value=!1),onImported:y},null,8,["visible"])])):(0,r.Q3)("v-if",!0)}});var oa=t(6719),ia={};ia.styleTagTransform=A(),ia.setAttributes=k(),ia.insert=y().bind(null,"head"),ia.domAPI=g(),ia.insertStyleElement=_(),h()(oa.A,ia),oa.A&&oa.A.locals&&oa.A.locals;const sa=(0,E.A)(ra,[["__scopeId","data-v-6dbb57d9"]]),la=["disabled","title"],ca={key:0,class:"sync-icon"},da={key:1,class:"sync-icon"},ua={key:2,class:"sync-icon"},pa={class:"sync-text"},va=(0,r.pM)({__name:"LoadingPreSeting",props:{size:{},variant:{}},emits:["loadCompleted","loadStarted"],setup(e,{emit:n}){const t=n,a=(0,i.KR)(!1),s=(0,i.KR)(!1),l=(0,i.KR)(!1);function c(){a.value||s.value?s.value&&_e.o.info("预设已加载，无需重复操作"):(l.value=!0,t("loadStarted"))}async function d(e){a.value=!0,l.value=!1;const n="load-preset-toast";_e.o.loading("正在加载预设...",{id:n});try{console.log("[加载预设组件] 选中的预设:",e),await new Promise(e=>setTimeout(e,800)),_e.o.success(`预设「${e.name}」加载成功！`,{id:n}),s.value=!0,t("loadCompleted",{success:!0,message:"加载成功",presetData:e})}catch(e){console.error("[加载预设组件] 加载失败:",e);const a=e instanceof Error?e.message:"加载失败";_e.o.error(`加载失败: ${a}`,{id:n}),t("loadCompleted",{success:!1,message:a})}finally{a.value=!1}}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("button",{onClick:c,class:(0,o.C4)(["cloud-sync-button",{synced:s.value}]),disabled:a.value,title:a.value?"正在加载预设...":s.value?"预设已加载":"加载预设"},[a.value?((0,r.uX)(),(0,r.CE)("span",ca,"⏳")):s.value?((0,r.uX)(),(0,r.CE)("span",da,"✅")):((0,r.uX)(),(0,r.CE)("span",ua,"📂")),(0,r.Lk)("span",pa,(0,o.v_)(a.value?"加载中":s.value?"已加载":"加载预设"),1)],10,la),(0,r.Q3)(" 预设加载对话框 "),(0,r.bF)(sa,{visible:l.value,onClose:n[0]||(n[0]=e=>l.value=!1),onSelect:d},null,8,["visible"])]))}});var fa=t(8233),ha={};ha.styleTagTransform=A(),ha.setAttributes=k(),ha.insert=y().bind(null,"head"),ha.domAPI=g(),ha.insertStyleElement=_(),h()(fa.A,ha),fa.A&&fa.A.locals&&fa.A.locals;const ma=(0,E.A)(va,[["__scopeId","data-v-1f7f5d72"]]);var ga=t(4717),ba=t(1783),ya=t(9037);const xa={class:"modal-dialog"},ka={class:"modal-title"},wa={class:"form-fields"},_a=["for"],Ca=["id","onUpdate:modelValue","placeholder","type"],Aa=["id","onUpdate:modelValue","placeholder"],Sa=["id","onUpdate:modelValue"],La=["value"],Ea={class:"dynamic-list-container"},Ta={class:"list-header"},Ia=["onClick"],Ra={key:0,class:"list-items"},Ma={class:"item-inputs"},Pa=["onUpdate:modelValue"],Da=["value"],za=["onUpdate:modelValue","placeholder"],Na=["onUpdate:modelValue","placeholder"],$a=["onUpdate:modelValue","placeholder"],Oa=["onClick"],Fa={key:1,class:"empty-list"},ja={key:0,class:"error-messages"},Ba={class:"modal-actions"},Xa=(0,r.pM)({__name:"CustomCreationModal",props:{visible:{type:Boolean},title:{},fields:{},validationFn:{type:Function},initialData:{}},emits:["close","submit"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)({}),c=(0,i.KR)([]),d=(0,r.EW)(()=>t.fields.filter(e=>!e.condition||e.condition(l.value)));function u(){a("close")}function p(){c.value=[];const e=t.validationFn(l.value);e.valid?(a("submit",{...l.value}),u()):c.value=e.errors}return(0,r.wB)(()=>[t.fields,t.initialData],([e,n])=>{const t={};e.forEach(e=>{const a=n?.[e.key];"select"===e.type?t[e.key]=a??e.options?.[0]?.value??"":"dynamic-list"===e.type?t[e.key]=Array.isArray(a)?JSON.parse(JSON.stringify(a)):[]:t[e.key]=a??""}),l.value=t},{immediate:!0,deep:!0}),(e,n)=>((0,r.uX)(),(0,r.Wv)(s.eB,{name:"modal-fade"},{default:(0,r.k6)(()=>[e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(u,["self"])},[(0,r.Lk)("div",xa,[(0,r.Lk)("h2",ka,(0,o.v_)(e.title),1),(0,r.Lk)("div",wa,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.value,n=>((0,r.uX)(),(0,r.CE)("div",{key:n.key,class:"form-group"},[(0,r.Lk)("label",{for:n.key},(0,o.v_)(n.label),9,_a),"text"===n.type||"color"===n.type||"number"===n.type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:0,id:n.key,"onUpdate:modelValue":e=>l.value[n.key]=e,placeholder:n.placeholder,type:n.type},null,8,Ca)),[[s.hp,l.value[n.key]]]):"textarea"===n.type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("textarea",{key:1,id:n.key,"onUpdate:modelValue":e=>l.value[n.key]=e,placeholder:n.placeholder,rows:"5"},null,8,Aa)),[[s.Jo,l.value[n.key]]]):"select"===n.type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("select",{key:2,id:n.key,"onUpdate:modelValue":e=>l.value[n.key]=e},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.options,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.value,value:e.value},(0,o.v_)(e.label),9,La))),128))],8,Sa)),[[s.u1,l.value[n.key]]]):"dynamic-list"===n.type?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Q3)(" 动态列表字段 "),(0,r.Lk)("div",Ea,[(0,r.Lk)("div",Ta,[(0,r.Lk)("span",null,(0,o.v_)(n.label),1),(0,r.Lk)("button",{onClick:e=>function(e){const n=l.value[e.key];Array.isArray(n)||(l.value[e.key]=[]);const t={};e.columns.forEach(e=>{"select"===e.type&&e.options?t[e.key]=e.options[0]?.value||"":t[e.key]=""}),l.value[e.key].push(t)}(n),class:"add-btn",type:"button"},"+ "+(0,o.v_)(e.$t("添加")),9,Ia)]),Array.isArray(l.value[n.key])&&l.value[n.key].length>0?((0,r.uX)(),(0,r.CE)("div",Ra,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.value[n.key],(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"list-item"},[(0,r.Lk)("div",Ma,["select"===n.columns[0].type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("select",{key:0,"onUpdate:modelValue":t=>e[n.columns[0].key]=t,class:"item-input"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.columns[0].options,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.value,value:e.value},(0,o.v_)(e.label),9,Da))),128))],8,Pa)),[[s.u1,e[n.columns[0].key]]]):(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:1,"onUpdate:modelValue":t=>e[n.columns[0].key]=t,placeholder:n.columns[0].placeholder,class:"item-input"},null,8,za)),[[s.Jo,e[n.columns[0].key]]]),n.columns[1]?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:2,"onUpdate:modelValue":t=>e[n.columns[1].key]=t,placeholder:n.columns[1].placeholder,class:"item-input"},null,8,Na)),[[s.Jo,e[n.columns[1].key]]]):(0,r.Q3)("v-if",!0),n.columns[2]?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:3,"onUpdate:modelValue":t=>e[n.columns[2].key]=t,placeholder:n.columns[2].placeholder,class:"item-input",type:"number",step:"0.1"},null,8,$a)),[[s.Jo,e[n.columns[2].key]]]):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("button",{onClick:e=>function(e,n){const t=l.value[e.key];Array.isArray(t)&&t.splice(n,1)}(n,t),class:"remove-btn",type:"button"},"×",8,Oa)]))),128))])):((0,r.uX)(),(0,r.CE)("div",Fa,[(0,r.Lk)("span",null,(0,o.v_)(e.$t("暂无数据")),1)]))])],2112)):(0,r.Q3)("v-if",!0)]))),128))]),c.value.length?((0,r.uX)(),(0,r.CE)("div",ja,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.value,(e,n)=>((0,r.uX)(),(0,r.CE)("p",{key:n},"* "+(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",Ba,[(0,r.Lk)("button",{onClick:u,class:"btn btn-secondary"},(0,o.v_)(e.$t("关闭")),1),(0,r.Lk)("button",{onClick:p,class:"btn"},(0,o.v_)(e.$t("确认")),1)])])])):(0,r.Q3)("v-if",!0)]),_:1}))}});var Ua=t(5609),Wa={};Wa.styleTagTransform=A(),Wa.setAttributes=k(),Wa.insert=y().bind(null,"head"),Wa.domAPI=g(),Wa.insertStyleElement=_(),h()(Ua.A,Wa),Ua.A&&Ua.A.locals&&Ua.A.locals;const qa=(0,E.A)(Xa,[["__scopeId","data-v-6ec25edf"]]),Ga={class:"modal-content"},Ha={class:"modal-header"},Va={class:"modal-body"},Qa={class:"hint"},Ka=["placeholder","onKeydown"],Ya={class:"modal-footer"},Ja=["disabled"],Za=(0,r.pM)({__name:"AIPromptModal",props:{visible:{type:Boolean}},emits:["close","submit"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)("");function c(){a("close")}function d(){const e=l.value.trim();e&&(a("submit",e),c())}return(0,r.wB)(()=>t.visible,e=>{e&&(l.value="")}),(e,n)=>e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(c,["self"])},[(0,r.Lk)("div",Ga,[(0,r.Lk)("div",Ha,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("AI推演")),1),(0,r.Lk)("button",{class:"close-btn",onClick:c},"×")]),(0,r.Lk)("div",Va,[(0,r.Lk)("p",Qa,(0,o.v_)(e.$t("请描述你想生成什么内容：")),1),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),class:"prompt-input",placeholder:e.$t("例如：生成一个火属性的天赋，适合剑修..."),rows:"6",onKeydown:(0,s.jR)((0,s.D$)(d,["ctrl"]),["enter"])},null,40,Ka),[[s.Jo,l.value]])]),(0,r.Lk)("div",Ya,[(0,r.Lk)("button",{class:"cancel-btn",onClick:c},(0,o.v_)(e.$t("取消")),1),(0,r.Lk)("button",{class:"submit-btn",onClick:d,disabled:!l.value.trim()},(0,o.v_)(e.$t("开始推演")),9,Ja)])])])):(0,r.Q3)("v-if",!0)}});var er=t(625),nr={};nr.styleTagTransform=A(),nr.setAttributes=k(),nr.insert=y().bind(null,"head"),nr.domAPI=g(),nr.insertStyleElement=_(),h()(er.A,nr),er.A&&er.A.locals&&er.A.locals;const tr=(0,E.A)(Za,[["__scopeId","data-v-87e1862c"]]);var ar=t(236);const rr='**立即执行任务，输出JSON格式的数据。禁止输出确认消息或纯文本！**\n\n你是专业的世界观内容生成器，根据用户提供的主题生成对应风格的内容。\n\n【世界观核心理念】\n- 异能/变异体系是核心重点\n- 禁止出现末日起源的相关内容\n- 世界中的科技水平以现实世界21世纪初的科技水平相当，禁止出现恐怖机器人的相关内容\n- 严格按照用户的选择和世界设定来生成内容\n- 如果用户指定了特定风格（科幻、现代、赛博朋克等），必须完全遵循该风格\n- 不要预设固定的求生剧情方向，让用户自己决定故事走向\n\n【输出格式示例】\n```json\n{\n  "name": "示例名称",\n  "description": "示例描述",\n  "其他字段": "根据具体任务要求"\n}\n```\n\n【输出要求】\n1. 所有数值字段必须是数字类型（不要用字符串）\n2. 必须使用```json代码块包裹\n3. 不得添加任何额外的解释说明文字\n4. ❌ 禁止输出确认消息（如"法则已刻入天轨"、"明白了"、"收到"等）\n5. ❌ 禁止输出纯文本，必须是JSON格式\n',or=`${rr}\n\n【任务】生成世界设定\n\n【字段】name(2-6字)/description(200-400字)/era(5-10字)\n`,ir=`${rr}\n\n【任务】生成天赋等级\n\n【必填字段】\n- name: 天赋名称\n- description: 描述文字（50-150字）\n- total_points: 总点数（数字类型，范围10-50）\n- rarity: 稀有度（数字类型，范围1-5）\n- color: 颜色（十六进制格式）\n`,sr=`${rr}\n\n【任务】生成出身背景\n\n【字段要求】\n- name (字符串): 4-6字的出身名称\n- description (字符串): 100-300字的背景故事\n- talent_cost (数字): 0-10之间的整数\n- rarity (数字): 1-5之间的整数\n- attribute_modifiers (对象): 混沌纪元六维加成（力量/敏捷/体质/意志/魅力/幸运），总和不超过5点\n- effects (数组): 1-2个独特效果的文字描述\n\n【输出示例】\n\`\`\`json\n{\n  "name": "山野遗孤",\n  "description": "自幼流落山野，与野兽为伴，练就了一身野性与求生本能...",\n  "talent_cost": 2,\n  "rarity": 3,\n  "attribute_modifiers": {\n    "力量": 2,\n    "敏捷": -1,\n    "意志": 0,\n    "幸运": 1,\n    "魅力": -1,\n    "心性": 1\n  },\n  "effects": ["野性直觉：在野外环境中感知力提升", "兽语通晓：能与灵兽沟通"]\n}\n\`\`\`\n`,lr=`${rr}\n\n【任务】生成先天天赋\n\n【字段要求】\n- name (字符串): 4-6字的天赋名称\n- description (字符串): 30-100字的天赋描述\n\n【输出示例】\n\`\`\`json\n{\n  "name": "过目不忘",\n  "description": "天生记忆力超群，看过的引导术、图纸过目不忘，学习速度大幅提升"\n}\n\`\`\`\n`;var cr=t(758);const dr={class:"world-selection-container"},ur={key:0,class:"loading-state"},pr={key:1,class:"error-state"},vr={key:2,class:"world-layout"},fr={class:"left-panel"},hr={class:"top-actions-container"},mr={class:"action-name"},gr={class:"action-name"},br={class:"list-container"},yr={key:0,class:"no-worlds-message"},xr={class:"no-worlds-text"},kr={key:0,class:"no-worlds-hint"},wr=["onClick","onMouseover"],_r={class:"item-content"},Cr={class:"item-name"},Ar={key:0,class:"action-buttons"},Sr=["onClick","title"],Lr=["onClick","title"],Er={class:"details-container"},Tr={key:0,class:"world-details"},Ir={class:"details-header"},Rr={class:"details-title"},Mr=["title"],Pr={class:"btn-text"},Dr={class:"era"},zr={class:"map-options"},Nr={class:"map-options-header"},$r={class:"difficulty-section"},Or={class:"difficulty-label"},Fr={class:"difficulty-options"},jr=["value"],Br={class:"difficulty-name"},Xr={class:"difficulty-desc"},Ur={class:"continents-only-section"},Wr={class:"continents-only-toggle"},qr={class:"toggle-label"},Gr={class:"toggle-hint"},Hr={key:0,class:"config-warning"},Vr={class:"warning-text"},Qr={class:"warning-title"},Kr={class:"warning-desc"},Yr={class:"map-options-grid"},Jr={class:"option-item"},Zr={class:"option-label"},eo=["disabled"],no={class:"config-hint"},to={class:"option-item"},ao={class:"option-label"},ro=["disabled"],oo={class:"config-hint"},io={class:"option-item"},so={class:"option-label"},lo=["disabled"],co={class:"config-hint"},uo={class:"option-item"},po={class:"option-label"},vo=["title"],fo={class:"config-hint"},ho={class:"map-options-actions"},mo={class:"description-scroll"},go={key:1,class:"placeholder"},bo=(0,r.pM)({__name:"Step1_WorldSelection",emits:["ai-generate"],setup(e,{emit:n}){const t=n,a=(0,Ce.N)(),l=(0,i.KR)(null),c=(0,i.KR)(!1),d=(0,i.KR)(!1),u=(0,i.KR)(!1),p=(0,i.KR)(!1),v=(0,i.KR)(null),f=[{value:"简单",label:"简单",desc:"资源丰富，威胁较弱"},{value:"普通",label:"普通",desc:"资源与危险并存"},{value:"困难",label:"困难",desc:"资源稀缺，强敌环伺"},{value:"噩梦",label:"噩梦",desc:"九死一生，极限生存"}],h=(0,i.KR)((()=>{const e=a.worldGenerationConfig;return e&&e.majorFactionsCount?(console.log("[世界配置] 从store恢复已保存的配置:",e),{majorFactionsCount:e.majorFactionsCount,totalLocations:e.totalLocations,secretRealmsCount:e.secretRealmsCount,continentCount:e.continentCount,generateOnlyContinents:void 0===e.generateOnlyContinents||e.generateOnlyContinents}):(console.log("[世界配置] 使用默认配置"),{majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0})})());(0,r.wB)(h,e=>{a.setWorldGenerationConfig(e),console.log("[世界配置] 配置已更新并保存:",e)},{deep:!0});const m=(0,r.EW)(()=>{const e=a.creationData.worlds;if(console.log("【世界选择】所有世界数据:",e),console.log("【世界选择】当前模式:",a.isLocalCreation?"本地":"联机"),a.isLocalCreation){const n=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【世界选择】单机模式可用世界列表:",n),n}{const n=e.filter(e=>"cloud"===e.source);if(console.log("【世界选择】联机模式云端世界列表:",n),console.log("【世界选择】云端世界数量:",n.length),0===n.length){console.warn("【世界选择】警告：联机模式下没有云端世界数据，回退到本地数据！");const n=e.filter(e=>"local"===e.source);return console.log("【世界选择】回退使用本地世界:",n),n}return n}}),g=[{key:"name",label:"世界名称",type:"text",placeholder:"例如：九霄界"},{key:"era",label:"时代背景",type:"text",placeholder:"例如：仙道昌隆"},{key:"description",label:"世界描述",type:"textarea",placeholder:"描述这个世界的背景故事、进化体系特点等..."}];function b(e){const n={};return e.name?.trim()||(n.name="世界名称不可为空"),{valid:0===Object.keys(n).length,errors:Object.values(n)}}async function y(e){const n={id:Date.now(),name:e.name,era:e.era,description:e.description,source:"local"};try{a.addWorld(n),w(n),c.value=!1,_e.o.success(`自定义世界 "${n.name}" 已成功保存！`)}catch(e){console.error("保存自定义世界失败:",e),_e.o.error("保存自定义世界失败！")}}function x(){a.isLocalCreation?p.value=!0:t("ai-generate")}async function k(e){const n="ai-generate-world";_e.o.loading("天机推演中，请稍候...",{id:n});try{const t=await(0,ar.e)(e,or,!1,"world_generation");if(!t)return void _e.o.error("AI推演失败",{id:n});let r;console.log("【AI推演-世界】完整响应:",t);try{r=(0,cr.p_)(t)}catch(e){return console.error("【AI推演-世界】JSON解析失败:",e),void _e.o.error("AI推演结果格式错误，无法解析",{id:n})}if(!r.name)return void _e.o.error("AI推演结果缺少世界名称",{id:n});const o={id:Date.now(),name:r.name||r.名称||"未命名世界",era:r.era||r.时代背景||"",description:r.description||r.描述||r.世界描述||"",source:"local"};a.addWorld(o),w(o),p.value=!1,_e.o.success(`AI推演完成！世界 "${o.name}" 已生成`,{id:n})}catch(e){console.error("【AI推演-世界】失败:",e),_e.o.error(`AI推演失败: ${e.message}`,{id:n})}}function w(e){a.selectWorld(e.id),a.setWorldGenerationConfig(h.value)}function _(){const e=[3,4,5,6,7],n=[8,10,12,15,18],t=[3,4,5,6,8],r=[3,4,5,6];h.value={majorFactionsCount:e[Math.floor(Math.random()*e.length)],totalLocations:n[Math.floor(Math.random()*n.length)],secretRealmsCount:t[Math.floor(Math.random()*t.length)],continentCount:r[Math.floor(Math.random()*r.length)],generateOnlyContinents:h.value.generateOnlyContinents},a.setWorldGenerationConfig(h.value),_e.o.info("已随机生成世界配置")}function C(){h.value={majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0},a.setWorldGenerationConfig(h.value),_e.o.info("已重置为默认配置")}const A=(0,r.EW)(()=>h.value.majorFactionsCount>8||h.value.totalLocations>15||h.value.secretRealmsCount>10);async function S(e){if(!v.value)return;const n={name:e.name,era:e.era,description:e.description};try{a.updateWorld(v.value.id,n)?(u.value=!1,v.value=null,_e.o.success(`世界 "${n.name}" 已更新！`)):_e.o.error("更新世界失败！")}catch(e){console.error("更新世界失败:",e),_e.o.error("更新世界失败！")}}const L=(0,r.EW)(()=>v.value?{name:v.value.name,era:v.value.era,description:v.value.description}:{});return(e,n)=>((0,r.uX)(),(0,r.CE)("div",dr,[(0,i.R1)(a).isLoading?((0,r.uX)(),(0,r.CE)("div",ur,(0,o.v_)(e.$t("正在推演诸天万界...")),1)):(0,i.R1)(a).error?((0,r.uX)(),(0,r.CE)("div",pr,(0,o.v_)(e.$t("天机紊乱"))+"："+(0,o.v_)((0,i.R1)(a).error),1)):((0,r.uX)(),(0,r.CE)("div",vr,[(0,r.Q3)(" 左侧面板：世界列表 "),(0,r.Lk)("div",fr,[(0,r.Q3)(" 顶部功能按钮 "),(0,r.Lk)("div",hr,[(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:n[0]||(n[0]=e=>c.value=!0),class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",mr,(0,o.v_)(e.$t("自定义世界")),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:x,class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",gr,(0,o.v_)(e.$t("AI推演")),1)])]),(0,r.Lk)("div",br,[0===m.value.length?((0,r.uX)(),(0,r.CE)("div",yr,[n[11]||(n[11]=(0,r.Lk)("div",{class:"no-worlds-icon"},"🌌",-1)),(0,r.Lk)("div",xr,(0,o.v_)((0,i.R1)(a).isLocalCreation?e.$t("暂无本地世界数据"):e.$t("暂无云端世界数据")),1),(0,i.R1)(a).isLocalCreation?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",kr,(0,o.v_)(e.$t("请检查网络连接或联系管理员")),1))])):((0,r.uX)(!0),(0,r.CE)(r.FK,{key:1},(0,r.pI)(m.value,n=>((0,r.uX)(),(0,r.CE)("div",{key:n.id,class:(0,o.C4)(["list-item",{selected:(0,i.R1)(a).characterPayload.world_id===n.id}]),onClick:e=>w(n),onMouseover:e=>l.value=n},[(0,r.Lk)("div",_r,[(0,r.Lk)("span",Cr,(0,o.v_)(n.name),1)]),"cloud"===n.source&&(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("div",Ar,[(0,r.Lk)("button",{onClick:(0,s.D$)(e=>function(e){v.value=e,u.value=!0}(n),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.bF)((0,i.R1)(ga.A),{size:14})],8,Sr),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>async function(e){try{await a.removeWorld(e),console.log(`【世界选择】成功删除世界 ID: ${e}`)}catch(n){console.error(`【世界选择】删除世界失败 ID: ${e}`,n)}}(n.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.bF)((0,i.R1)(ba.A),{size:14})],8,Lr)])):(0,r.Q3)("v-if",!0)],42,wr))),128))])]),(0,r.Q3)(" 右侧面板：世界详情 + 地图生成选项 "),(0,r.Lk)("div",Er,[l.value?((0,r.uX)(),(0,r.CE)("div",Tr,[(0,r.Lk)("div",Ir,[(0,r.Lk)("h2",Rr,(0,o.v_)(l.value.name),1),(0,r.Lk)("button",{class:"map-settings-btn",onClick:n[1]||(n[1]=e=>d.value=!d.value),title:e.$t("地图生成选项")},[(0,r.bF)((0,i.R1)(ya.A),{size:16}),(0,r.Lk)("span",Pr,(0,o.v_)(e.$t("设置")),1)],8,Mr)]),(0,r.Lk)("p",Dr,"【"+(0,o.v_)(l.value.era||e.$t("时代未知"))+"】",1),(0,r.Q3)(" 地图生成选项（移入右侧详情内，避免整体高度溢出） "),(0,r.bo)((0,r.Lk)("div",zr,[(0,r.Lk)("div",Nr,(0,o.v_)(e.$t("世界规模配置")),1),(0,r.Q3)(" 生存难度选择 "),(0,r.Lk)("div",$r,[(0,r.Lk)("div",Or,(0,o.v_)(e.$t("生存难度")),1),(0,r.Lk)("div",Fr,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(f,e=>(0,r.Lk)("label",{key:e.value,class:(0,o.C4)(["difficulty-option",{selected:(0,i.R1)(a).gameDifficulty===e.value}])},[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":n[2]||(n[2]=e=>(0,i.R1)(a).gameDifficulty=e),class:"difficulty-radio"},null,8,jr),[[s.XL,(0,i.R1)(a).gameDifficulty]]),(0,r.Lk)("span",Br,(0,o.v_)(e.label),1),(0,r.Lk)("span",Xr,(0,o.v_)(e.desc),1)],2)),64))])]),(0,r.Q3)(" 仅生成大陆开关 "),(0,r.Lk)("div",Ur,[(0,r.Lk)("label",Wr,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=e=>h.value.generateOnlyContinents=e),class:"toggle-checkbox"},null,512),[[s.lH,h.value.generateOnlyContinents]]),(0,r.Lk)("span",qr,(0,o.v_)(e.$t("仅生成大陆（开局优化）")),1)]),(0,r.Lk)("div",Gr,(0,o.v_)(h.value.generateOnlyContinents?e.$t("开局只生成大陆，势力和地点可在游戏中动态生成，减少token消耗"):e.$t("开局生成完整世界（包括势力、地点和秘境）")),1)]),(0,r.Q3)(" 配置警告提示 "),A.value?((0,r.uX)(),(0,r.CE)("div",Hr,[n[12]||(n[12]=(0,r.Lk)("div",{class:"warning-icon"},"⚠️",-1)),(0,r.Lk)("div",Vr,[(0,r.Lk)("div",Qr,(0,o.v_)(e.$t("配置过高警告")),1),(0,r.Lk)("div",Kr,(0,o.v_)(e.$t("当前配置可能导致生成失败，建议调整至合理范围")),1)])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 核心游戏配置 "),(0,r.Lk)("div",Yr,[(0,r.Lk)("label",Jr,[(0,r.Lk)("span",Zr,(0,o.v_)(e.$t("主要势力")),1),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"1",max:"20",step:"1","onUpdate:modelValue":n[4]||(n[4]=e=>h.value.majorFactionsCount=e),class:(0,o.C4)({"config-risky":h.value.majorFactionsCount>8}),disabled:h.value.generateOnlyContinents},null,10,eo),[[s.Jo,h.value.majorFactionsCount,void 0,{number:!0}]]),(0,r.Lk)("span",no,(0,o.v_)(e.$t("推荐: 3-8")),1)]),(0,r.Lk)("label",to,[(0,r.Lk)("span",ao,(0,o.v_)(e.$t("地点总数")),1),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"5",max:"100",step:"1","onUpdate:modelValue":n[5]||(n[5]=e=>h.value.totalLocations=e),class:(0,o.C4)({"config-risky":h.value.totalLocations>15}),disabled:h.value.generateOnlyContinents},null,10,ro),[[s.Jo,h.value.totalLocations,void 0,{number:!0}]]),(0,r.Lk)("span",oo,(0,o.v_)(e.$t("推荐: 8-15")),1)]),(0,r.Lk)("label",io,[(0,r.Lk)("span",so,(0,o.v_)(e.$t("秘境数量")),1),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"0",max:"30",step:"1","onUpdate:modelValue":n[6]||(n[6]=e=>h.value.secretRealmsCount=e),class:(0,o.C4)({"config-risky":h.value.secretRealmsCount>10}),disabled:h.value.generateOnlyContinents},null,10,lo),[[s.Jo,h.value.secretRealmsCount,void 0,{number:!0}]]),(0,r.Lk)("span",co,(0,o.v_)(e.$t("推荐: 3-10")),1)]),(0,r.Lk)("label",uo,[(0,r.Lk)("span",po,(0,o.v_)(e.$t("大陆数量")),1),(0,r.bo)((0,r.Lk)("input",{type:"number",min:"3",max:"7",step:"1","onUpdate:modelValue":n[7]||(n[7]=e=>h.value.continentCount=e),title:e.$t("大陆数量决定世界的宏观格局，3-7片大陆形成不同的地缘政治结构")},null,8,vo),[[s.Jo,h.value.continentCount,void 0,{number:!0}]]),(0,r.Lk)("span",fo,(0,o.v_)(e.$t("范围: 3-7")),1)])]),(0,r.Lk)("div",ho,[(0,r.Lk)("button",{class:"opt-btn",onClick:_},(0,o.v_)(e.$t("随机")),1),(0,r.Lk)("button",{class:"opt-btn",onClick:C},(0,o.v_)(e.$t("重置")),1)])],512),[[s.aG,d.value]]),(0,r.bo)((0,r.Lk)("div",mo,[(0,r.Lk)("p",null,(0,o.v_)(l.value.description||e.$t("此界一片混沌，尚无描述。")),1)],512),[[s.aG,!d.value]])])):((0,r.uX)(),(0,r.CE)("div",go,(0,o.v_)(e.$t("请择一方大千世界，以定道基。")),1))])])),(0,r.bF)(qa,{visible:c.value,title:e.$t("自定义世界"),fields:g,validationFn:b,onClose:n[8]||(n[8]=e=>c.value=!1),onSubmit:y},null,8,["visible","title"]),(0,r.Q3)(" 编辑模态框 "),(0,r.bF)(qa,{visible:u.value,title:e.$t("编辑世界"),fields:g,validationFn:b,initialData:L.value,onClose:n[9]||(n[9]=e=>{u.value=!1,v.value=null}),onSubmit:S},null,8,["visible","title","initialData"]),(0,r.Q3)(" AI推演输入弹窗 "),(0,r.bF)(tr,{visible:p.value,onClose:n[10]||(n[10]=e=>p.value=!1),onSubmit:k},null,8,["visible"])]))}});var yo=t(5733),xo={};xo.styleTagTransform=A(),xo.setAttributes=k(),xo.insert=y().bind(null,"head"),xo.domAPI=g(),xo.insertStyleElement=_(),h()(yo.A,xo),yo.A&&yo.A.locals&&yo.A.locals;const ko=(0,E.A)(bo,[["__scopeId","data-v-62183c17"]]),wo={class:"talent-tier-selection"},_o={key:0,class:"loading-state"},Co={key:1,class:"error-state"},Ao={key:2,class:"tier-layout"},So={class:"tier-left-panel"},Lo={class:"top-actions-container"},Eo={class:"action-name"},To={class:"action-name"},Io={class:"tiers-list-container"},Ro=["onClick","onMouseover"],Mo={class:"item-content"},Po={class:"tier-name"},Do={class:"tier-points"},zo={key:0,class:"action-buttons"},No=["onClick","title"],$o=["onClick","title"],Oo={class:"tier-details-container"},Fo={key:0,class:"tier-details"},jo={class:"description-scroll"},Bo={class:"points-display"},Xo={key:1,class:"placeholder"},Uo=(0,r.pM)({__name:"Step2_TalentTierSelection",emits:["ai-generate"],setup(e,{emit:n}){const t=n,a=(0,Ce.N)(),l=(0,i.KR)(null),c=(0,i.KR)(!1),d=(0,i.KR)(!1),u=(0,i.KR)(!1),p=(0,i.KR)(null),v=(0,r.EW)(()=>{const e=a.creationData.talentTiers;if(console.log("【天资选择】所有天资数据:",e),console.log("【天资选择】当前模式:",a.isLocalCreation?"本地":"联机"),console.log("【天资选择】数据明细:",e.map(e=>({name:e.name,source:e.source,id:e.id}))),a.isLocalCreation){const n=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【天资选择】单机模式可用天资列表:",n),n.sort((e,n)=>e.total_points-n.total_points)}{const n=e.length>0?e:[];return console.log("【天资选择】联机模式天资列表:",n),console.log("【天资选择】联机模式天资数量:",n.length),0===n.length&&console.warn("【天资选择】警告：联机模式下没有找到任何天资数据！"),n.sort((e,n)=>e.total_points-n.total_points)}}),f=[{key:"name",label:"天资名称",type:"text",placeholder:"例如：凡人"},{key:"description",label:"天资描述",type:"textarea",placeholder:"描述此天资的特点..."},{key:"total_points",label:"剩余点数",type:"number",placeholder:"例如：20"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"color",label:"辉光颜色",type:"color",placeholder:"例如：#808080"}];function h(e){const n={};e.name?.trim()||(n.name="天资名称不可为空");const t=Number(e.total_points);(isNaN(t)||t<0)&&(n.total_points="剩余点数必须是非负数");const a=Number(e.rarity);return(isNaN(a)||a<1||a>10)&&(n.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(n).length,errors:Object.values(n)}}async function m(e){const n={id:Date.now(),name:e.name,description:e.description,total_points:parseInt(e.total_points,10)||10,rarity:parseInt(e.rarity,10)||1,color:e.color||"#808080"};try{a.addTalentTier(n),y(n),c.value=!1,_e.o.success(`自定义天资 "${n.name}" 已保存！`)}catch(e){console.error("保存自定义天资失败:",e),_e.o.error("保存自定义天资失败！")}}function g(){a.isLocalCreation?u.value=!0:t("ai-generate")}async function b(e){const n="ai-generate-talent-tier";_e.o.loading("系统推演中，请稍候...",{id:n});try{const t=await(0,ar.e)(e,ir,!1);if(!t)return void _e.o.error("AI推演失败",{id:n});let r;console.log("【AI推演-天资】完整响应:",t);try{r=(0,cr.p_)(t)}catch(e){return console.error("【AI推演-天资】JSON解析失败:",e),void _e.o.error("AI推演结果格式错误，无法解析",{id:n})}if(!r)return void _e.o.error("AI推演结果无效",{id:n});const o={id:Date.now(),name:r.name||r.名称||"未命名天资",description:r.description||r.描述||r.说明||"",total_points:r.total_points||r.总点数||r.点数||10,color:r.color||r.颜色||"#808080",rarity:r.rarity||r.稀有度||1,source:"local"};a.addTalentTier(o),y(o),u.value=!1,_e.o.success(`AI推演完成！天资 "${o.name}" 已生成`,{id:n})}catch(e){console.error("【AI推演-天资】失败:",e),_e.o.error(`AI推演失败: ${e.message}`,{id:n})}}function y(e){a.selectTalentTier(e.id)}function x(e){const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?`${parseInt(n[1],16)}, ${parseInt(n[2],16)}, ${parseInt(n[3],16)}`:"229, 192, 123"}async function k(e){if(!p.value)return;const n={name:e.name,description:e.description,total_points:parseInt(e.total_points,10)||10,rarity:parseInt(e.rarity,10)||1,color:e.color||"#808080"};try{a.updateTalentTier(p.value.id,n)?(d.value=!1,p.value=null,_e.o.success(`天资 "${n.name}" 已更新！`)):_e.o.error("更新天资失败！")}catch(e){console.error("更新天资失败:",e),_e.o.error("更新天资失败！")}}const w=(0,r.EW)(()=>p.value?{name:p.value.name,description:p.value.description,total_points:p.value.total_points.toString(),rarity:p.value.rarity?.toString()||"1",color:p.value.color}:{});return(e,n)=>((0,r.uX)(),(0,r.CE)("div",wo,[(0,i.R1)(a).isLoading?((0,r.uX)(),(0,r.CE)("div",_o,(0,o.v_)(e.$t("连接数据库，分析潜能...")),1)):(0,i.R1)(a).error?((0,r.uX)(),(0,r.CE)("div",Co,(0,o.v_)(e.$t("系统错误"))+"："+(0,o.v_)((0,i.R1)(a).error),1)):((0,r.uX)(),(0,r.CE)("div",Ao,[(0,r.Q3)(" 左侧面板：列表和操作按钮 "),(0,r.Lk)("div",So,[(0,r.Q3)(" 顶部功能按钮 "),(0,r.Lk)("div",Lo,[(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:n[0]||(n[0]=e=>c.value=!0),class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",Eo,(0,o.v_)(e.$t("自定义天资")),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:g,class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",To,(0,o.v_)(e.$t("AI推演")),1)])]),(0,r.Lk)("div",Io,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value,n=>((0,r.uX)(),(0,r.CE)("div",{key:n.id,class:(0,o.C4)(["tier-item",{selected:(0,i.R1)(a).characterPayload.talent_tier_id===n.id}]),style:(0,o.Tr)({"--tier-glow-color":n.color,"--tier-glow-color-rgb":x(n.color)}),onClick:e=>y(n),onMouseover:e=>l.value=n},[(0,r.Lk)("div",Mo,[(0,r.Lk)("span",Po,(0,o.v_)(n.name),1),(0,r.Lk)("span",Do,(0,o.v_)(n.total_points)+" "+(0,o.v_)(e.$t("点")),1)]),"cloud"===n.source&&(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("div",zo,[(0,r.Lk)("button",{onClick:(0,s.D$)(e=>function(e){p.value=e,d.value=!0}(n),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.bF)((0,i.R1)(ga.A),{size:14})],8,No),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>async function(e){console.log(`🔥 点击删除按钮，准备删除天资 ID: ${e}`);try{await a.removeTalentTier(e),console.log(`【天资选择】成功删除天资 ID: ${e}`)}catch(n){console.error(`【天资选择】删除天资失败 ID: ${e}`,n)}}(n.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.bF)((0,i.R1)(ba.A),{size:14})],8,$o)])):(0,r.Q3)("v-if",!0)],46,Ro))),128))])]),(0,r.Q3)(" 右侧详情 "),(0,r.Lk)("div",Oo,[l.value?((0,r.uX)(),(0,r.CE)("div",Fo,[(0,r.Lk)("h2",{style:(0,o.Tr)({color:l.value.color})},(0,o.v_)(l.value.name),5),(0,r.Lk)("div",jo,[(0,r.Lk)("p",null,(0,o.v_)(l.value.description),1)]),(0,r.Lk)("div",Bo,(0,o.v_)(e.$t("剩余点数"))+": "+(0,o.v_)(l.value.total_points),1)])):((0,r.uX)(),(0,r.CE)("div",Xo,(0,o.v_)(e.$t("请选择你的天资等级，这将决定你的起点。")),1))])])),(0,r.bF)(qa,{visible:c.value,title:e.$t("自定义天资"),fields:f,validationFn:h,onClose:n[1]||(n[1]=e=>c.value=!1),onSubmit:m},null,8,["visible","title"]),(0,r.Q3)(" 编辑模态框 "),(0,r.bF)(qa,{visible:d.value,title:e.$t("编辑天资"),fields:f,validationFn:h,initialData:w.value,onClose:n[2]||(n[2]=e=>{d.value=!1,p.value=null}),onSubmit:k},null,8,["visible","title","initialData"]),(0,r.Q3)(" AI推演输入弹窗 "),(0,r.bF)(tr,{visible:u.value,onClose:n[3]||(n[3]=e=>u.value=!1),onSubmit:b},null,8,["visible"])]))}});var Wo=t(2725),qo={};qo.styleTagTransform=A(),qo.setAttributes=k(),qo.insert=y().bind(null,"head"),qo.domAPI=g(),qo.insertStyleElement=_(),h()(Wo.A,qo),Wo.A&&Wo.A.locals&&Wo.A.locals;const Go=(0,E.A)(Uo,[["__scopeId","data-v-385b4f33"]]),Ho={class:"origin-selection-container"},Vo={key:0,class:"loading-state"},Qo={key:1,class:"error-state"},Ko={key:2,class:"origin-layout"},Yo={class:"origin-left-panel"},Jo={class:"top-actions-container"},Zo={class:"action-name"},ei={class:"action-name"},ni={class:"origin-list-container"},ti={class:"origin-name"},ai={class:"origin-cost"},ri=["onClick","onMouseover"],oi={class:"item-content"},ii={class:"origin-name"},si={class:"origin-cost"},li={key:0,class:"action-buttons"},ci=["onClick","title"],di=["onClick","title"],ui={class:"origin-details-container"},pi={key:0,class:"origin-details"},vi={class:"description-scroll"},fi={class:"cost-display"},hi={key:1,class:"placeholder"},mi=(0,r.pM)({__name:"Step3_OriginSelection",emits:["ai-generate"],setup(e,{emit:n}){const t=n,a=(0,Ce.N)(),l=(0,i.KR)(null),c=(0,i.KR)(!1),d=(0,i.KR)(!1),u=(0,i.KR)(!1),p=(0,i.KR)(null),v=(0,r.EW)(()=>{const e=a.creationData.origins;if(console.log("【出身选择】所有出身数据:",e),console.log("【出身选择】当前模式:",a.isLocalCreation?"本地":"联机"),a.isLocalCreation){const n=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【出身选择】单机模式可用出身列表:",n),n}{const n=e.filter(e=>"cloud"===e.source);return console.log("【出身选择】联机模式出身列表:",n),console.log("【出身选择】云端出身数量:",n.length),0===n.length&&(console.warn("【出身选择】警告：联机模式下没有找到云端出身数据！"),console.log("【出身选择】所有出身的source分布:",e.reduce((e,n)=>(e[n.source]=(e[n.source]||0)+1,e),{}))),n}}),f=[{key:"name",label:"出身名称",type:"text",placeholder:"例如：山野遗孤"},{key:"description",label:"出身描述",type:"textarea",placeholder:"描述此出身的背景故事和成长经历..."},{key:"talent_cost",label:"点数消耗",type:"number",placeholder:"选择此出身需要消耗的点数，可为负数表示奖励"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"attribute_modifiers",label:"属性修正",type:"dynamic-list",columns:[{key:"attribute",placeholder:"属性名称",type:"select",options:[{value:"力量",label:"力量"},{value:"敏捷",label:"敏捷"},{value:"体质",label:"体质"},{value:"意志",label:"意志"},{value:"魅力",label:"魅力"},{value:"幸运",label:"幸运"}]},{key:"value",placeholder:"修正值（可为负数）",type:"text"}]},{key:"background_effects",label:"背景效果",type:"dynamic-list",columns:[{key:"type",placeholder:"效果类型（如：技能、资源、关系）"},{key:"description",placeholder:"效果描述"}]}],h={力量:"strength",敏捷:"agility",体质:"constitution",意志:"willpower",魅力:"charm",幸运:"luck"},m={strength:"力量",agility:"敏捷",constitution:"体质",willpower:"意志",charm:"魅力",luck:"幸运"};function g(e){const n={};e.name?.trim()||(n.name="出身名称不可为空"),e.description?.trim()||(n.description="出身描述不可为空");const t=Number(e.talent_cost);void 0!==e.talent_cost&&""!==e.talent_cost&&isNaN(t)&&(n.talent_cost="点数消耗必须是数字");const a=Number(e.rarity);return void 0!==e.rarity&&""!==e.rarity&&(isNaN(a)||a<1||a>10)&&(n.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(n).length,errors:Object.values(n)}}async function b(e){const n={};Array.isArray(e.attribute_modifiers)&&e.attribute_modifiers.forEach(e=>{if(e.attribute&&e.value){const t=h[e.attribute]??e.attribute;n[t]=Number(e.value)||0}});const t=Array.isArray(e.background_effects)?e.background_effects.filter(e=>e.type&&e.description):[],r={id:Date.now(),name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,attribute_modifiers:n,background_effects:t,rarity:Number(e.rarity)||1,source:"local"};try{a.addOrigin(r),C(r),c.value=!1,_e.o.success(`自定义出身 "${r.name}" 已保存！`)}catch(e){console.error("保存自定义出身失败:",e),_e.o.error("保存自定义出身失败！")}}function y(){if(a.isLocalCreation){if(!a.selectedWorld)return void _e.o.error("请先选择一方大千世界，方可推演出身。");u.value=!0}else t("ai-generate")}async function x(e){const n="ai-generate-origin";_e.o.loading("系统推演中，请稍候...",{id:n});try{const t=await(0,ar.e)(e,sr,!1);if(!t)return void _e.o.error("AI推演失败",{id:n});let r;console.log("【AI推演-出身】完整响应:",t);try{r=(0,cr.p_)(t)}catch(e){return console.error("【AI推演-出身】JSON解析失败:",e),void _e.o.error("AI推演结果格式错误，无法解析",{id:n})}if(!r.name&&!r.名称)return void _e.o.error("AI推演结果缺少出身名称",{id:n});let o=r.talent_cost||r.天道点消耗||r.消耗天道点;null==o?(console.warn("【AI推演-出身】AI未返回点数消耗字段，使用默认值3"),_e.o.warning("AI未设置点数消耗，已自动设为3点",{id:n,duration:2e3}),o=3):(o=Number(o),isNaN(o)&&(console.warn("【AI推演-出身】点数消耗不是有效数字，使用默认值3"),o=3));const i={id:Date.now(),name:r.name||r.名称||"未命名出身",description:r.description||r.描述||r.说明||"",talent_cost:o,attribute_modifiers:(()=>{const e=r.attribute_modifiers||r.属性修正||{},n={};return e&&"object"==typeof e&&Object.entries(e).forEach(([e,t])=>{const a=h[e]??e,r=Number(t)||0;n[a]=r}),n})(),background_effects:r.background_effects||r.背景效果||[],rarity:r.rarity||r.稀有度||1,source:"local"};a.addOrigin(i),C(i),u.value=!1,_e.o.success(`AI推演完成！出身 "${i.name}" 已生成`,{id:n})}catch(e){console.error("【AI推演-出身】失败:",e),_e.o.error(`AI推演失败: ${e.message}`,{id:n})}}const k=e=>{if(a.characterPayload.origin_id===e.id)return!0;const n=a.selectedOrigin?.talent_cost??0;return a.remainingTalentPoints+n>=e.talent_cost};async function w(e){if(!p.value)return;const n={};Array.isArray(e.attribute_modifiers)&&e.attribute_modifiers.forEach(e=>{if(e.attribute&&e.value){const t=h[e.attribute]??e.attribute;n[t]=Number(e.value)||0}});const t=Array.isArray(e.background_effects)?e.background_effects.filter(e=>e.type&&e.description):[],r={name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,attribute_modifiers:n,background_effects:t};try{a.updateOrigin(p.value.id,r)?(d.value=!1,p.value=null,_e.o.success(`出身 "${r.name}" 已更新！`)):_e.o.error("更新出身失败！")}catch(e){console.error("更新出身失败:",e),_e.o.error("更新出身失败！")}}const _=(0,r.EW)(()=>{if(!p.value)return{};const e=p.value.attribute_modifiers?Object.entries(p.value.attribute_modifiers).map(([e,n])=>({attribute:m[e]??e,value:String(n)})):[];return{name:p.value.name,description:p.value.description,talent_cost:p.value.talent_cost.toString(),rarity:p.value.rarity.toString(),attribute_modifiers:e,background_effects:p.value.background_effects||[]}});function C(e){if(!k(e))return void _e.o.warning("点数不足，无法选择此出身。");const n=a.characterPayload.origin_id===e.id?null:e.id;a.selectOrigin(n)}function A(){a.selectOrigin(null)}const S=(0,r.EW)(()=>null===a.characterPayload.origin_id),L=((0,r.EW)(()=>S.value?"随机出身":a.selectedOrigin?.name||""),(0,r.EW)(()=>S.value?"世事无常，造化弄人。选择此项，你的出身将完全随机生成。是生于废墟豪门，或为荒野遗孤，皆在系统计算之中。":a.selectedOrigin?.description||"身世如谜，过往一片空白。"),(0,r.EW)(()=>S.value?0:a.selectedOrigin?.talent_cost||0),(0,r.EW)(()=>"random"===l.value?"随机出身":l.value&&"object"==typeof l.value?l.value.name:"")),E=(0,r.EW)(()=>"random"===l.value?"天道无常，造化弄人。选择此项，你的出身将完全随机生成。是生于帝王之家，或为山野遗孤，皆在天道一念之间。":l.value&&"object"==typeof l.value&&l.value.description||"身世如谜，过往一片空白。"),T=(0,r.EW)(()=>"random"===l.value?0:l.value&&"object"==typeof l.value&&l.value.talent_cost||0);return(e,n)=>((0,r.uX)(),(0,r.CE)("div",Ho,[(0,i.R1)(a).isLoading?((0,r.uX)(),(0,r.CE)("div",Vo,(0,o.v_)(e.$t("检索档案，探寻出身...")),1)):(0,i.R1)(a).error?((0,r.uX)(),(0,r.CE)("div",Qo,(0,o.v_)(e.$t("数据损坏"))+"："+(0,o.v_)((0,i.R1)(a).error),1)):((0,r.uX)(),(0,r.CE)("div",Ko,[(0,r.Q3)(" 左侧栏：列表和操作按钮 "),(0,r.Lk)("div",Yo,[(0,r.Q3)(" 顶部功能按钮 "),(0,r.Lk)("div",Jo,[(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:n[0]||(n[0]=e=>c.value=!0),class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",Zo,(0,o.v_)(e.$t("自定义出身")),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:y,class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",ei,(0,o.v_)(e.$t("AI推演")),1)])]),(0,r.Lk)("div",ni,[(0,r.Lk)("div",{class:(0,o.C4)(["origin-item",{selected:S.value}]),onClick:A,onMouseover:n[1]||(n[1]=e=>l.value="random")},[(0,r.Lk)("span",ti,(0,o.v_)(e.$t("随机出身")),1),(0,r.Lk)("span",ai,(0,o.v_)(e.$t("0 点")),1)],34),n[5]||(n[5]=(0,r.Lk)("div",{class:"divider"},null,-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value,n=>((0,r.uX)(),(0,r.CE)("div",{key:n.id,class:(0,o.C4)(["origin-item",{selected:(0,i.R1)(a).characterPayload.origin_id===n.id,disabled:!k(n)}]),onClick:e=>C(n),onMouseover:e=>l.value=n},[(0,r.Lk)("div",oi,[(0,r.Lk)("span",ii,(0,o.v_)(n.name),1),(0,r.Lk)("span",si,(0,o.v_)(n.talent_cost)+" "+(0,o.v_)(e.$t("点")),1)]),"cloud"===n.source&&(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("div",li,[(0,r.Lk)("button",{onClick:(0,s.D$)(e=>function(e){p.value=e,d.value=!0}(n),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.bF)((0,i.R1)(ga.A),{size:14})],8,ci),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>async function(e){try{await a.removeOrigin(e),console.log(`【出身选择】成功删除出身 ID: ${e}`)}catch(n){console.error(`【出身选择】删除出身失败 ID: ${e}`,n)}}(n.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.bF)((0,i.R1)(ba.A),{size:14})],8,di)])):(0,r.Q3)("v-if",!0)],42,ri))),128))])]),(0,r.Q3)(" 右侧详情 "),(0,r.Lk)("div",ui,[l.value?((0,r.uX)(),(0,r.CE)("div",pi,[(0,r.Lk)("h2",null,(0,o.v_)(L.value),1),(0,r.Lk)("div",vi,[(0,r.Lk)("p",null,(0,o.v_)(E.value),1)]),(0,r.Lk)("div",fi,(0,o.v_)(e.$t("消耗点数: {0}").replace("{0}",String(T.value))),1)])):((0,r.uX)(),(0,r.CE)("div",hi,(0,o.v_)(e.$t("请选择一处出身，或听天由命。")),1))])])),(0,r.bF)(qa,{visible:c.value,title:e.$t("自定义出身"),fields:f,validationFn:g,onClose:n[2]||(n[2]=e=>c.value=!1),onSubmit:b},null,8,["visible","title"]),(0,r.Q3)(" 编辑模态框 "),(0,r.bF)(qa,{visible:d.value,title:e.$t("编辑出身"),fields:f,validationFn:g,initialData:_.value,onClose:n[3]||(n[3]=e=>{d.value=!1,p.value=null}),onSubmit:w},null,8,["visible","title","initialData"]),(0,r.Q3)(" AI推演输入弹窗 "),(0,r.bF)(tr,{visible:u.value,onClose:n[4]||(n[4]=e=>u.value=!1),onSubmit:x},null,8,["visible"])]))}});var gi=t(287),bi={};bi.styleTagTransform=A(),bi.setAttributes=k(),bi.insert=y().bind(null,"head"),bi.domAPI=g(),bi.insertStyleElement=_(),h()(gi.A,bi),gi.A&&gi.A.locals&&gi.A.locals;const yi=(0,E.A)(mi,[["__scopeId","data-v-b7287234"]]),xi={class:"talent-selection-container"},ki={key:0,class:"loading-state"},wi={key:1,class:"error-state"},_i={key:2,class:"talent-layout"},Ci={class:"talent-left-panel"},Ai={class:"top-actions-container"},Si={class:"action-name"},Li={class:"action-name"},Ei={class:"talent-list-container"},Ti=["onClick","onMouseover"],Ii={class:"item-content"},Ri={class:"talent-name"},Mi={class:"talent-cost"},Pi={key:0,class:"action-buttons"},Di=["onClick","title"],zi=["onClick","title"],Ni={class:"talent-details-container"},$i={key:0,class:"talent-details"},Oi={class:"description-scroll"},Fi={key:1,class:"placeholder"},ji=(0,r.pM)({__name:"Step5_TalentSelection",emits:["ai-generate"],setup(e,{emit:n}){const t=n,a=(0,Ce.N)(),l=(0,i.KR)(null),c=(0,i.KR)(!1),d=(0,i.KR)(!1),u=(0,i.KR)(!1),p=(0,i.KR)(null),v=(0,r.EW)(()=>{const e=a.creationData.talents;if(console.log("【天赋选择】所有天赋数据:",e.length,"个"),console.log("【天赋选择】当前模式:",a.isLocalCreation?"本地":"联机"),a.isLocalCreation){const n=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【天赋选择】单机模式可用天赋数量:",n.length),n}{const n=e.length>0?e:[];return console.log("【天赋选择】联机模式天赋数量:",n.length),0===n.length&&console.warn("【天赋选择】警告：联机模式下没有找到任何天赋数据！"),n}}),f=[{key:"name",label:"天赋名称",type:"text",placeholder:"例如：道心天成"},{key:"description",label:"天赋描述",type:"textarea",placeholder:"描述此天赋的本质..."},{key:"talent_cost",label:"点数消耗",type:"number",placeholder:"例如：3"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"effects",label:"天赋效果",type:"dynamic-list",columns:[{key:"类型",placeholder:"效果类型",type:"select",options:[{value:"属性加成",label:"属性加成"},{value:"技能解锁",label:"技能解锁"},{value:"特殊能力",label:"特殊能力"},{value:"进化加成",label:"进化加成"}]},{key:"目标",placeholder:"目标（如：力量、意志）"},{key:"数值",placeholder:"数值（如：+2、+10%）"}]}];function h(e){const n={};e.name?.trim()||(n.name="天赋名称不可为空"),e.description?.trim()||(n.description="天赋描述不可为空");const t=Number(e.talent_cost);void 0===e.talent_cost||null===e.talent_cost||""===e.talent_cost||isNaN(t)?n.talent_cost="点数消耗必须填写":t<0&&(n.talent_cost="点数消耗不能为负数");const a=Number(e.rarity);return void 0!==e.rarity&&""!==e.rarity&&(isNaN(a)||a<1||a>10)&&(n.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(n).length,errors:Object.values(n)}}async function m(e){const n=Array.isArray(e.effects)?e.effects.filter(e=>e.类型&&e.数值).map(e=>({类型:e.类型,目标:e.目标||void 0,数值:Number(e.数值)||0})):[],t={id:Date.now(),name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,effects:n.length>0?n:void 0,source:"local"};try{a.addTalent(t),c.value=!1,_e.o.success(`自定义天赋 "${t.name}" 已保存！`)}catch(e){console.error("保存自定义天赋失败:",e),_e.o.error("保存自定义天赋失败！")}}const g=e=>a.characterPayload.selected_talent_ids.includes(e.id);function b(e){l.value=e,a.toggleTalent(e.id)}function y(){a.isLocalCreation?u.value=!0:t("ai-generate")}async function x(e){const n="ai-generate-talent";_e.o.loading("系统推演中，请稍候...",{id:n});try{const t=await(0,ar.e)(e,lr,!1);if(!t)return void _e.o.error("AI推演失败",{id:n});let r;console.log("【AI推演-天赋】完整响应:",t);try{r=(0,cr.p_)(t)}catch(e){return console.error("【AI推演-天赋】JSON解析失败:",e),void _e.o.error("AI推演结果格式错误，无法解析",{id:n})}if(!r.name&&!r.名称)return void _e.o.error("AI推演结果缺少天赋名称",{id:n});const o={id:Date.now(),name:r.name||r.名称||"未命名天赋",description:r.description||r.描述||r.说明||"",talent_cost:r.talent_cost||r.点数消耗||1,rarity:r.rarity||r.稀有度||1,source:"local"};a.addTalent(o),b(o),u.value=!1,_e.o.success(`AI推演完成！天赋 "${o.name}" 已生成`,{id:n})}catch(e){console.error("【AI推演-天赋】失败:",e),_e.o.error(`AI推演失败: ${e.message}`,{id:n})}}async function k(e){if(!p.value)return;const n=Array.isArray(e.effects)?e.effects.filter(e=>e.类型&&e.数值).map(e=>({类型:e.类型,目标:e.目标||void 0,数值:Number(e.数值)||0})):[],t={name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,effects:n.length>0?n:void 0};try{a.updateTalent(p.value.id,t)?(d.value=!1,p.value=null,_e.o.success(`天赋 "${t.name}" 已更新！`)):_e.o.error("更新天赋失败！")}catch(e){console.error("更新天赋失败:",e),_e.o.error("更新天赋失败！")}}const w=(0,r.EW)(()=>p.value?{name:p.value.name,description:p.value.description,talent_cost:p.value.talent_cost||0,rarity:p.value.rarity||1,effects:p.value.effects||[]}:{});return(e,n)=>((0,r.uX)(),(0,r.CE)("div",xi,[(0,i.R1)(a).isLoading?((0,r.uX)(),(0,r.CE)("div",ki,(0,o.v_)(e.$t("扫描基因库，搜寻潜能特性...")),1)):(0,i.R1)(a).error?((0,r.uX)(),(0,r.CE)("div",wi,(0,o.v_)(e.$t("系统错误"))+"："+(0,o.v_)((0,i.R1)(a).error),1)):((0,r.uX)(),(0,r.CE)("div",_i,[(0,r.Q3)(" 左侧面板：列表和操作按钮 "),(0,r.Lk)("div",Ci,[(0,r.Q3)(" 顶部功能按钮 "),(0,r.Lk)("div",Ai,[(0,i.R1)(a).isLocalCreation?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:n[0]||(n[0]=e=>c.value=!0),class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",Si,(0,o.v_)(e.$t("自定义天赋")),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:y,class:"action-item shimmer-on-hover"},[(0,r.Lk)("span",Li,(0,o.v_)(e.$t("AI推演")),1)])]),(0,r.Lk)("div",Ei,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value,n=>((0,r.uX)(),(0,r.CE)("div",{key:n.id,class:(0,o.C4)(["talent-item",{selected:g(n)}]),onClick:e=>b(n),onMouseover:e=>l.value=n},[(0,r.Lk)("div",Ii,[(0,r.Lk)("span",Ri,(0,o.v_)(n.name),1),(0,r.Lk)("span",Mi,(0,o.v_)(n.talent_cost||0)+(0,o.v_)(e.$t("点")),1)]),"cloud"!==n.source&&"local"!==n.source||!(0,i.R1)(a).isLocalCreation?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",Pi,[(0,r.Lk)("button",{onClick:(0,s.D$)(e=>function(e){p.value=e,d.value=!0}(n),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.bF)((0,i.R1)(ga.A),{size:14})],8,Di),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>async function(e){try{await a.removeTalent(e),console.log(`【天赋选择】成功删除天赋 ID: ${e}`)}catch(n){console.error(`【天赋选择】删除天赋失败 ID: ${e}`,n)}}(n.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.bF)((0,i.R1)(ba.A),{size:14})],8,zi)]))],42,Ti))),128))])]),(0,r.Lk)("div",Ni,[l.value?((0,r.uX)(),(0,r.CE)("div",$i,[(0,r.Lk)("h2",null,(0,o.v_)(l.value.name),1),(0,r.Lk)("div",Oi,[(0,r.Lk)("p",null,(0,o.v_)(l.value.description||e.$t("此天赋之玄妙，需自行领悟。")),1)])])):((0,r.uX)(),(0,r.CE)("div",Fi,(0,o.v_)(e.$t("请选择天赋。")),1))])])),(0,r.bF)(qa,{visible:c.value,title:e.$t("自定义天赋"),fields:f,validationFn:h,onClose:n[1]||(n[1]=e=>c.value=!1),onSubmit:m},null,8,["visible","title"]),(0,r.Q3)(" 编辑模态框 "),(0,r.bF)(qa,{visible:d.value,title:e.$t("编辑天赋"),fields:f,validationFn:h,initialData:w.value,onClose:n[2]||(n[2]=e=>{d.value=!1,p.value=null}),onSubmit:k},null,8,["visible","title","initialData"]),(0,r.Q3)(" AI推演输入弹窗 "),(0,r.bF)(tr,{visible:u.value,onClose:n[3]||(n[3]=e=>u.value=!1),onSubmit:x},null,8,["visible"])]))}});var Bi=t(4220),Xi={};Xi.styleTagTransform=A(),Xi.setAttributes=k(),Xi.insert=y().bind(null,"head"),Xi.domAPI=g(),Xi.insertStyleElement=_(),h()(Bi.A,Xi),Bi.A&&Bi.A.locals&&Bi.A.locals;const Ui=(0,E.A)(ji,[["__scopeId","data-v-29853d38"]]),Wi={class:"attribute-allocation-container"},qi={class:"header"},Gi={class:"points-display"},Hi={class:"attributes-list"},Vi={class:"attribute-info"},Qi={class:"attribute-name"},Ki={class:"attribute-desc"},Yi={class:"attribute-controls"},Ji=["onClick","disabled"],Zi={class:"attribute-value"},es=["onClick","disabled"],ns={class:"actions"},ts=10,as=(0,r.pM)({__name:"Step6_AttributeAllocation",setup(e){const n=(0,Ce.N)(),t={strength:"力量",agility:"敏捷",constitution:"体质",willpower:"意志",charm:"魅力",luck:"幸运"},a={strength:"提升近战伤害与搬运能力，影响格斗效率。",agility:"提升行动与操作速度，影响闪避与轻灵度。",constitution:"提升生命值上限与抗性，影响负重与承伤能力。",willpower:"提升理智与精神抗性，影响污染抗性与意志检定。",charm:"提升社交与招募能力，影响声望与互动效果。",luck:"提升事件成功率与掉落品质，影响机遇与随机判定。"};function s(){Object.keys(n.attributes).forEach(e=>{n.setAttribute(e,0)})}function l(){s();let e=n.remainingTalentPoints;const t=Object.keys(n.attributes);for(;e>0;){const a=t[Math.floor(Math.random()*t.length)],r=n.attributes[a];if(r<ts&&(n.setAttribute(a,r+1),e--),t.every(e=>n.attributes[e]>=ts))break}}function c(){s();const e=Math.max(0,n.remainingTalentPoints);if(e<=0)return;const t=Object.keys(n.attributes).length,a=Math.floor(e/t);let r=e%t;Object.keys(n.attributes).forEach(e=>{let t=a;r>0&&(t++,r--);const o=Math.min(0+t,ts);n.setAttribute(e,o)})}return(0,r.sV)(()=>{}),(e,d)=>((0,r.uX)(),(0,r.CE)("div",Wi,[(0,r.Lk)("div",qi,[(0,r.Lk)("h2",null,(0,o.v_)(e.$t("六维属性分配")),1),(0,r.Lk)("div",Gi,[(0,r.eW)((0,o.v_)(e.$t("剩余点数:"))+" ",1),(0,r.Lk)("span",{class:(0,o.C4)({negative:(0,i.R1)(n).remainingTalentPoints<0})},(0,o.v_)((0,i.R1)(n).remainingTalentPoints),3)])]),(0,r.Lk)("div",Hi,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,i.R1)(n).attributes,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:"attribute-item"},[(0,r.Lk)("div",Vi,[(0,r.Lk)("span",Qi,(0,o.v_)(t[s]),1),(0,r.Lk)("p",Ki,(0,o.v_)(a[s]),1)]),(0,r.Lk)("div",Yi,[(0,r.Lk)("button",{onClick:e=>function(e){n.attributes[e]>0&&n.setAttribute(e,n.attributes[e]-1)}(s),disabled:e<=0},"-",8,Ji),(0,r.Lk)("span",Zi,(0,o.v_)(e),1),(0,r.Lk)("button",{onClick:e=>function(e){n.remainingTalentPoints>0&&n.attributes[e]<ts&&n.setAttribute(e,n.attributes[e]+1)}(s),disabled:(0,i.R1)(n).remainingTalentPoints<=0||e>=ts,class:(0,o.C4)({disabled:(0,i.R1)(n).remainingTalentPoints<=0||e>=ts})}," + ",10,es)])]))),128))]),(0,r.Lk)("div",ns,[(0,r.Lk)("button",{onClick:s,class:"btn btn-secondary"},(0,o.v_)(e.$t("重置")),1),(0,r.Lk)("button",{onClick:l,class:"btn btn-warning"},(0,o.v_)(e.$t("🎲 随机")),1),(0,r.Lk)("button",{onClick:c,class:"btn btn-success"},(0,o.v_)(e.$t("⚖️ 均衡")),1)])]))}});var rs=t(5294),os={};os.styleTagTransform=A(),os.setAttributes=k(),os.insert=y().bind(null,"head"),os.domAPI=g(),os.insertStyleElement=_(),h()(rs.A,os),rs.A&&rs.A.locals&&rs.A.locals;const is=(0,E.A)(as,[["__scopeId","data-v-22da9d4e"]]),ss={class:"preview-container"},ls={class:"title"},cs={class:"subtitle"},ds={class:"preview-grid"},us={class:"preview-item name-item"},ps={for:"characterName"},vs=["placeholder"],fs={class:"name-hint"},hs={class:"preview-item race-item input-field"},ms={for:"characterRace"},gs=["placeholder"],bs={class:"preview-item gender-item"},ys={class:"gender-control"},xs={class:"gender-label"},ks={class:"gender-label"},ws={class:"gender-label"},_s={class:"preview-item age-item"},Cs={class:"age-control"},As=["disabled"],Ss={class:"age-unit"},Ls={class:"preview-item"},Es={class:"streaming-control"},Ts={class:"streaming-label"},Is={class:"streaming-label"},Rs={class:"streaming-hint"},Ms={class:"preview-item"},Ps={class:"generate-mode-control"},Ds={class:"generate-mode-label"},zs={class:"generate-mode-label"},Ns={class:"generate-mode-hint"},$s={class:"preview-item"},Os={class:"item-description"},Fs={class:"preview-item"},js={class:"item-description"},Bs={class:"preview-item"},Xs={class:"item-description"},Us={class:"preview-item talents-item"},Ws={key:0},qs={class:"item-description"},Gs={key:1},Hs={key:0,class:"preview-item attributes-item"},Vs={class:"preview-item cloud-info-item"},Qs={class:"cloud-info-text"},Ks=(0,r.pM)({__name:"Step7_Preview",props:{isLocalCreation:{type:Boolean}},setup(e){const n=(0,Ce.N)(),t=e;(0,r.sV)(async()=>{if(n.characterPayload.character_name&&"无名者"!==n.characterPayload.character_name&&""!==n.characterPayload.character_name.trim())return void console.log("[Step7_Preview] 已有角色名字，跳过获取:",n.characterPayload.character_name);let e=!1;try{const t="undefined"!=typeof window?window.TavernHelper:null;if(t){if(!e&&"function"==typeof t.substitudeMacros)try{const a=await t.substitudeMacros("{{user}}");console.log("[Step7_Preview] substitudeMacros {{user}} ->",a),a&&"{{user}}"!==a&&"string"==typeof a&&a.trim()&&(n.characterPayload.character_name=a.trim(),console.log("[Step7_Preview] ✅ 从酒馆宏获取用户名字:",a),e=!0)}catch(e){console.warn("[Step7_Preview] ⚠️ substitudeMacros 失败:",e)}if(!e&&"function"==typeof t.getVariables)try{const a=await t.getVariables({type:"global"}),r=a["persona.name"]||a.name||a.user_name||a.user;console.log("[Step7_Preview] 全局变量中的名字:",r),r&&"string"==typeof r&&r.trim()&&(n.characterPayload.character_name=r.trim(),console.log("[Step7_Preview] ✅ 从全局变量获取名字:",r),e=!0)}catch(e){console.warn("[Step7_Preview] ⚠️ getVariables 失败:",e)}if(!e&&"function"==typeof t.getCharData)try{const a=await t.getCharData();a?.name&&"string"==typeof a.name&&a.name.trim()&&(n.characterPayload.character_name=a.name.trim(),console.log("[Step7_Preview] ✅ 从角色数据获取名字:",a.name),e=!0)}catch(e){console.warn("[Step7_Preview] ⚠️ getCharData 失败:",e)}}else console.log("[Step7_Preview] 非酒馆模式，跳过名字获取")}catch(e){console.error("[Step7_Preview] ❌ 无法从酒馆获取Persona名字:",e)}e||(n.characterPayload.character_name="",console.log("[Step7_Preview] 📝 未获取到名字，请用户自行输入道号"))});const a=()=>{n.characterPayload.current_age++},l=()=>{n.characterPayload.current_age>0&&n.characterPayload.current_age--},c=()=>{n.characterPayload.current_age<0&&(n.characterPayload.current_age=0),n.characterPayload.current_age=Math.floor(n.characterPayload.current_age)};return(e,d)=>((0,r.uX)(),(0,r.CE)("div",ss,[(0,r.Lk)("h2",ls,(0,o.v_)(e.$t("最终预览")),1),(0,r.Lk)("p",cs,(0,o.v_)(e.$t("请确认你的选择，这是进入混沌纪元的最后一步。")),1),(0,r.Lk)("div",ds,[(0,r.Q3)(" Character Name "),(0,r.Lk)("div",us,[(0,r.Lk)("label",ps,(0,o.v_)(e.$t("代号:")),1),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"characterName",class:"named","onUpdate:modelValue":d[0]||(d[0]=e=>(0,i.R1)(n).characterPayload.character_name=e),placeholder:e.$t("请输入代号")},null,8,vs),[[s.Jo,(0,i.R1)(n).characterPayload.character_name]]),(0,r.Lk)("span",fs,(0,o.v_)(e.$t("可自定义修改")),1)]),(0,r.Q3)(" Character Race "),(0,r.Lk)("div",hs,[(0,r.Lk)("label",ms,(0,o.v_)(e.$t("种族:")),1),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"characterRace",class:"named","onUpdate:modelValue":d[1]||(d[1]=e=>(0,i.R1)(n).characterPayload.race=e),placeholder:e.$t("人族"),onMousedown:d[2]||(d[2]=(0,s.D$)(()=>{},["stop"])),onClick:d[3]||(d[3]=(0,s.D$)(()=>{},["stop"])),onSelect:d[4]||(d[4]=(0,s.D$)(()=>{},["stop"]))},null,40,gs),[[s.Jo,(0,i.R1)(n).characterPayload.race]])]),(0,r.Q3)(" Gender Selection "),(0,r.Lk)("div",bs,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("性别")),1),(0,r.Lk)("div",ys,[(0,r.Lk)("label",xs,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"gender",value:"男","onUpdate:modelValue":d[5]||(d[5]=e=>(0,i.R1)(n).characterPayload.gender=e)},null,512),[[s.XL,(0,i.R1)(n).characterPayload.gender]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("男")),1)]),(0,r.Lk)("label",ks,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"gender",value:"女","onUpdate:modelValue":d[6]||(d[6]=e=>(0,i.R1)(n).characterPayload.gender=e)},null,512),[[s.XL,(0,i.R1)(n).characterPayload.gender]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("女")),1)]),(0,r.Lk)("label",ws,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"gender",value:"双性","onUpdate:modelValue":d[7]||(d[7]=e=>(0,i.R1)(n).characterPayload.gender=e)},null,512),[[s.XL,(0,i.R1)(n).characterPayload.gender]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("双性")),1)])])]),(0,r.Q3)(" Birth Age "),(0,r.Lk)("div",_s,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("初始年龄")),1),(0,r.Lk)("div",Cs,[(0,r.Lk)("button",{type:"button",onClick:l,disabled:(0,i.R1)(n).characterPayload.current_age<=0,class:"age-btn"},"-",8,As),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":d[8]||(d[8]=e=>(0,i.R1)(n).characterPayload.current_age=e),class:"age-input",min:"0",onInput:c},null,544),[[s.Jo,(0,i.R1)(n).characterPayload.current_age,void 0,{number:!0}]]),(0,r.Lk)("span",Ss,(0,o.v_)(e.$t("岁")),1),(0,r.Lk)("button",{type:"button",onClick:a,class:"age-btn"},"+")])]),(0,r.Q3)(" Start Mode (Streaming / Non-Streaming) "),(0,r.Lk)("div",Ls,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("开局模式")),1),(0,r.Lk)("div",Es,[(0,r.Lk)("label",Ts,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"startMode",value:!0,"onUpdate:modelValue":d[9]||(d[9]=e=>(0,i.R1)(n).useStreamingStart=e)},null,512),[[s.XL,(0,i.R1)(n).useStreamingStart]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("流式开局")),1)]),(0,r.Lk)("label",Is,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"startMode",value:!1,"onUpdate:modelValue":d[10]||(d[10]=e=>(0,i.R1)(n).useStreamingStart=e)},null,512),[[s.XL,(0,i.R1)(n).useStreamingStart]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("非流式开局")),1)])]),(0,r.Lk)("p",Rs,(0,o.v_)((0,i.R1)(n).useStreamingStart?e.$t("流式开局：更快，可能被中断"):e.$t("非流式开局：一次性生成完整内容，更稳定可靠")),1)]),(0,r.Q3)(" Split Response Generation "),(0,r.Lk)("div",Ms,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("生成方式")),1),(0,r.Lk)("div",Ps,[(0,r.Lk)("label",Ds,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"splitMode",value:!0,"onUpdate:modelValue":d[11]||(d[11]=e=>(0,i.R1)(n).splitResponseGeneration=e)},null,512),[[s.XL,(0,i.R1)(n).splitResponseGeneration]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("分步生成")),1)]),(0,r.Lk)("label",zs,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"splitMode",value:!1,"onUpdate:modelValue":d[12]||(d[12]=e=>(0,i.R1)(n).splitResponseGeneration=e)},null,512),[[s.XL,(0,i.R1)(n).splitResponseGeneration]]),(0,r.Lk)("span",null,(0,o.v_)(e.$t("一次性生成")),1)])]),(0,r.Lk)("p",Ns,(0,o.v_)((0,i.R1)(n).splitResponseGeneration?e.$t("分步生成：分步调用AI，提高开局稳定性（推荐）"):e.$t("一次性生成：一次性生成所有内容，速度更快但可能不稳定")),1)]),(0,r.Q3)(" World "),(0,r.Lk)("div",$s,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("所选世界")),1),(0,r.Lk)("h4",null,(0,o.v_)((0,i.R1)(n).selectedWorld?.name||e.$t("未选择")),1),(0,r.Lk)("p",Os,(0,o.v_)((0,i.R1)(n).selectedWorld?.description||e.$t("暂无描述")),1)]),(0,r.Q3)(" Talent Tier "),(0,r.Lk)("div",Fs,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("天资")),1),(0,r.Lk)("h4",{style:(0,o.Tr)({color:(0,i.R1)(n).selectedTalentTier?.color||"inherit"})},(0,o.v_)((0,i.R1)(n).selectedTalentTier?.name||e.$t("未选择")),5),(0,r.Lk)("p",js,(0,o.v_)((0,i.R1)(n).selectedTalentTier?.description||e.$t("暂无描述")),1)]),(0,r.Q3)(" Origin "),(0,r.Lk)("div",Bs,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("出身")),1),(0,r.Lk)("h4",null,(0,o.v_)((0,i.R1)(n).selectedOrigin?.name||e.$t("随机出身")),1),(0,r.Lk)("p",Xs,(0,o.v_)((0,i.R1)(n).selectedOrigin?.description||e.$t("暂无描述")),1)]),(0,r.Q3)(" Talents "),(0,r.Lk)("div",Us,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("天赋")),1),(0,i.R1)(n).selectedTalents.length?((0,r.uX)(),(0,r.CE)("ul",Ws,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,i.R1)(n).selectedTalents,e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id},[(0,r.Lk)("strong",null,(0,o.v_)(e.name),1),(0,r.Lk)("p",qs,(0,o.v_)(e.description),1)]))),128))])):((0,r.uX)(),(0,r.CE)("p",Gs,(0,o.v_)(e.$t("未选择任何天赋")),1))]),(0,r.Q3)(" Attributes "),t.isLocalCreation?((0,r.uX)(),(0,r.CE)("div",Hs,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("六维属性")),1),(0,r.Lk)("ul",null,[(0,r.Lk)("li",null,(0,o.v_)(e.$t("力量"))+": "+(0,o.v_)((0,i.R1)(n).attributes.strength),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("敏捷"))+": "+(0,o.v_)((0,i.R1)(n).attributes.agility),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("体质"))+": "+(0,o.v_)((0,i.R1)(n).attributes.constitution),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("意志"))+": "+(0,o.v_)((0,i.R1)(n).attributes.willpower),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("魅力"))+": "+(0,o.v_)((0,i.R1)(n).attributes.charm),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("幸运"))+": "+(0,o.v_)((0,i.R1)(n).attributes.luck),1)])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" Cloud Mode Placeholder "),(0,r.Lk)("div",Vs,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("系统分配")),1),(0,r.Lk)("p",Qs,(0,o.v_)(e.$t("联机模式下，角色的初始命格将由所选世界的系统法则在云端生成，以确保公平与平衡。")),1)])],2112))])]))}});var Ys=t(9263),Js={};Js.styleTagTransform=A(),Js.setAttributes=k(),Js.insert=y().bind(null,"head"),Js.domAPI=g(),Js.insertStyleElement=_(),h()(Ys.A,Js),Ys.A&&Ys.A.locals&&Ys.A.locals;const Zs=(0,E.A)(Ks,[["__scopeId","data-v-6db98732"]]),el={class:"modal-dialog"},nl={key:0,class:"step-content"},tl={class:"modal-title"},al={class:"modal-subtitle"},rl={class:"form-group"},ol=["placeholder"],il={key:0,class:"error-message"},sl={class:"form-actions"},ll=["disabled"],cl={class:"step-content"},dl={class:"modal-title"},ul={class:"modal-subtitle"},pl={class:"prompt-section"},vl={class:"prompt-label"},fl=["placeholder","onKeyup"],hl={class:"char-count"},ml={key:0,class:"suggested-prompts"},gl={class:"suggestions-title"},bl={class:"suggestions-grid"},yl=["onClick"],xl={class:"form-actions"},kl=(0,r.pM)({__name:"RedemptionCodeModal",props:{visible:{type:Boolean},title:{},type:{}},emits:["close","submit"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)(""),c=(0,i.KR)(""),d=(0,i.KR)(""),u=(0,i.KR)(null),p=(0,i.KR)("code"),v=(0,i.KR)(!1),f=()=>({world:["混沌废土，异种入侵","赛博都市，霓虹闪烁","地下避难所，资源匮乏","荒野求生，适者生存"],talent_tier:["天生枪感，射击天才","机械亲和，改造天赋","数据解析，黑客高手","基因完美，肉身无双"],origin:["废墟拾荒者的后代","避难所的精英战士","被流放的变异实验体","旧时代文明的守护者"],spirit_root:["雷电系变异潜质","罕见的时间感知","混沌系全能潜质","多重变异的杂合潜质"],talent:["透视物质的义眼","预知危险的直觉","超速再生的自愈力","操控机械的电子脑"]}[t.type||"world"]||[]);(0,r.wB)(()=>t.visible,e=>{e&&(h(),(0,r.dY)(()=>{u.value?.focus()}))});const h=()=>{d.value="",l.value="",c.value="",p.value="code",v.value=!1},m=()=>{h(),a("close")},g=()=>{p.value="code",d.value=""},b=async()=>{if(l.value.trim()){v.value=!0,d.value="";try{await new Promise(e=>setTimeout(e,500)),p.value="prompt"}catch{d.value="兑换码验证失败，请检查后重试。"}finally{v.value=!1}}else d.value="兑换码不可为空。"},y=()=>{a("submit",{code:l.value.trim(),prompt:c.value.trim()||void 0}),h()};return(e,n)=>e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(m,["self"])},[(0,r.Lk)("div",el,[(0,r.Q3)(" 第一步：输入兑换码 "),"code"===p.value?((0,r.uX)(),(0,r.CE)("div",nl,[(0,r.Lk)("h2",tl,(0,o.v_)(e.title),1),(0,r.Lk)("p",al,(0,o.v_)(e.$t("请输入兑换码以接引天机进行AI推演。")),1),(0,r.Lk)("form",{onSubmit:(0,s.D$)(b,["prevent"])},[(0,r.Lk)("div",rl,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),type:"text",placeholder:e.$t("请输入兑换码"),class:"code-input",ref_key:"inputRef",ref:u},null,8,ol),[[s.Jo,l.value]])]),d.value?((0,r.uX)(),(0,r.CE)("div",il,(0,o.v_)(d.value),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",sl,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:m},(0,o.v_)(e.$t("取消")),1),(0,r.Lk)("button",{type:"submit",class:"btn",disabled:!l.value.trim()||v.value},(0,o.v_)(v.value?e.$t("验证中..."):e.$t("下一步")),9,ll)])],32)])):"prompt"===p.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 第二步：输入提示词 "),(0,r.Lk)("div",cl,[(0,r.Lk)("h2",dl,(0,o.v_)(e.$t("自定义AI推演")),1),(0,r.Lk)("p",ul,(0,o.v_)({world:"描述你希望的世界风格、时代背景或特色设定（可含对话，使用中文引号“”，每句仅一对）",talent_tier:"描述你希望的天资类型、特点或能力倾向（可含对话，使用中文引号“”，每句仅一对）",origin:"描述你希望的出身背景、家族或成长环境（可含对话，使用中文引号“”，每句仅一对）",spirit_root:"描述你希望的异能潜质、变异方向或觉醒倾向（可含对话，使用中文引号“”，每句仅一对）",talent:"描述你希望的天赋能力、特殊技能或异能（可含对话，使用中文引号“”，每句仅一对）"}[t.type||"world"]||"请输入自定义提示词"),1),(0,r.Lk)("div",pl,[(0,r.Lk)("label",vl,(0,o.v_)(e.$t("提示词 (可选)")),1),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[1]||(n[1]=e=>c.value=e),class:"prompt-input",placeholder:{world:"例如：混沌纪元废土世界，异兽横行，科技与变异并存...",talent_tier:"例如：擅长机械改造的天才，拥有超强的感知能力...",origin:"例如：避难所的幸存者，身负寻找解药的使命...",spirit_root:"例如：罕见的精神系变异潜质，天生感知...",talent:"例如：能够操控金属的磁力异能..."}[t.type||"world"]||"请输入提示词...",rows:"4",maxlength:"500",onKeyup:(0,s.jR)((0,s.D$)(y,["ctrl"]),["enter"])},null,40,fl),[[s.Jo,c.value]]),(0,r.Lk)("div",hl,(0,o.v_)(c.value.length)+"/500",1)]),f().length>0?((0,r.uX)(),(0,r.CE)("div",ml,[(0,r.Lk)("h4",gl,(0,o.v_)(e.$t("建议提示词")),1),(0,r.Lk)("div",bl,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(f(),e=>((0,r.uX)(),(0,r.CE)("button",{key:e,class:"suggestion-button",onClick:n=>c.value=e},(0,o.v_)(e),9,yl))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",xl,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:g},(0,o.v_)(e.$t("返回")),1),(0,r.Lk)("button",{type:"button",class:"btn",onClick:y},(0,o.v_)(e.$t("开始推演")),1)])])],2112)):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0)}});var wl=t(1300),_l={};_l.styleTagTransform=A(),_l.setAttributes=k(),_l.insert=y().bind(null,"head"),_l.domAPI=g(),_l.insertStyleElement=_(),h()(wl.A,_l),wl.A&&wl.A.locals&&wl.A.locals;const Cl=(0,E.A)(kl,[["__scopeId","data-v-e7c874a6"]]),Al={class:"creation-container"},Sl={class:"creation-scroll"},Ll={class:"header-container"},El={class:"header-top"},Tl={class:"mode-indicator"},Il={key:0,class:"cloud-sync-container"},Rl={class:"progress-steps"},Ml={class:"step-circle"},Pl={class:"step-label"},Dl={class:"step-content"},zl={class:"navigation-buttons"},Nl={class:"points-display"},$l={key:0,class:"destiny-points"},Ol={class:"points-label"},Fl=["disabled"],jl=(0,r.pM)({__name:"CharacterCreation",props:{onBack:{type:Function}},emits:["creation-complete"],setup(e,{expose:n,emit:a}){const c=e,d=a,u=(0,Ce.N)(),{t:p}=(0,l.s)(),v=(0,i.KR)(!1),f=(0,i.KR)("world");function h(e){if("男"===e||"女"===e||"其他"===e)return e}function m(){f.value={1:"world",2:"talent_tier",3:"origin",4:"talent"}[u.currentStep]||"world",u.isLocalCreation||(v.value=!0)}(0,r.sV)(async()=>{console.log("【角色创建】当前模式:",u.isLocalCreation?"单机":"联机"),await u.initializeStore(u.isLocalCreation?"single":"cloud");const e=u.creationData.worlds.length,n=u.creationData.talents.length;console.log("【角色创建】当前数据量:"),console.log("- 总世界数量:",e),console.log("- 总天赋数量:",n),!u.isLocalCreation&&(e<=3||n<=5)&&(console.log("【角色创建】联机模式下数据量不足，尝试获取云端数据..."),await u.fetchAllCloudData(),console.log("【角色创建】云端数据获取完成，最终数据量:"),console.log("- 总世界数量:",u.creationData.worlds.length),console.log("- 总天赋数量:",u.creationData.talents.length));try{const e=await(0,De.getCurrentCharacterName)();e?(console.log("【角色创建】成功获取酒馆角色卡名字:",e),u.characterPayload.character_name=e):(console.log("【角色创建】无法获取酒馆角色卡名字，使用默认值"),u.characterPayload.character_name=u.isLocalCreation?"无名者":"修士")}catch(e){console.error("【角色创建】获取角色名字时出错:",e),u.characterPayload.character_name=u.isLocalCreation?"无名者":"修士"}}),(0,r.hi)(()=>{u.resetOnExit()}),n({handleAIGenerateClick:m});const g=(0,r.EW)(()=>[p("世界选择"),p("天资评估"),p("出身背景"),p("天赋选择"),p("属性分配"),p("最终预览")]),b=(0,r.EW)(()=>({character_name:u.characterPayload.character_name,gender:u.characterPayload.gender,race:u.characterPayload.race,current_age:u.characterPayload.current_age,world:u.selectedWorld,talentTier:u.selectedTalentTier,origin:u.selectedOrigin,talents:u.selectedTalents,baseAttributes:{strength:u.characterPayload.strength,agility:u.characterPayload.agility,constitution:u.characterPayload.constitution,willpower:u.characterPayload.willpower,charm:u.characterPayload.charm,luck:u.characterPayload.luck}})),y=()=>{u.currentStep>1?u.prevStep():c.onBack()},x=(0,r.EW)(()=>{const e=u.currentStep,n=u.totalSteps,t=u.selectedWorld,a=u.selectedTalentTier,r=u.remainingTalentPoints,o=u.isCreating;return console.log("[DEBUG] 按钮状态检查 - 当前步骤:",e,"/",n),console.log("[DEBUG] 按钮状态检查 - isCreating:",o),console.log("[DEBUG] 按钮状态检查 - 选中的世界:",t?.name),console.log("[DEBUG] 按钮状态检查 - 选中的天资:",a?.name),console.log("[DEBUG] 按钮状态检查 - 剩余天赋点:",r),1!==e||t?2!==e||a?(console.log("[DEBUG] 按钮状态：启用"),!1):(console.log("[DEBUG] 按钮被禁用：第2步未选择天资"),!0):(console.log("[DEBUG] 按钮被禁用：第1步未选择世界"),!0)}),k=(0,i.KR)(null),w=(0,i.KR)(null),_=(0,i.KR)(null),C=(0,i.KR)(null);async function A(e){if(!localStorage.getItem("access_token"))return _e.o.error("身份凭证缺失，请先登录再使用信物。"),void(v.value=!1);!e.code||e.code.trim().length<6?_e.o.error("请输入有效的仙缘信物！"):(v.value=!1,await async function(e,n){let a="";switch(u.currentStep){case 1:a="world";break;case 2:a="talent_tier";break;case 3:a="origin";break;case 4:a="talent";break;default:return void _e.o.error("当前步骤不支持AI生成！")}u.startCreation();const r=`cloud-ai-generate-${a}`,o=n?"基于你的心愿推演玄妙...":"天机推演中...";_e.o.loading(o,{id:r});try{_e.o.loading("正在验证仙缘信物...",{id:r});try{await(0,F.Em)(`/api/v1/redemption/validate/${e}`,{method:"POST"})}catch(e){const n=e instanceof Error?e.message:"仙缘信物验证失败";return _e.o.error(n,{id:r}),void u.resetCreationState()}_e.o.loading("已连接天机阁，正在推演...",{id:r});const o={world:"世界背景",talent_tier:"天资等级",origin:"出身背景",talent:"天赋"}[a]||a,i=n||`请为修仙游戏生成一个${o}选项，包含name、description等字段，返回JSON格式`,{aiService:s}=await Promise.resolve().then(t.bind(t,7445)),l=await s.generate({ordered_prompts:[{role:"system",content:`你是一个修仙游戏内容生成器。请根据用户要求生成${o}内容，返回有效的JSON对象。`},{role:"user",content:i}],usageType:"main"});if(!l)return _e.o.error("天机阁未能推演出结果",{id:r}),void u.resetCreationState();let c;try{const e=l.match(/\{[\s\S]*\}/);if(!e)throw new Error("未找到有效JSON");c=JSON.parse(e[0])}catch{return _e.o.error("天机推演结果格式异常",{id:r}),void u.resetCreationState()}_e.o.loading("正在记录天机...",{id:r});const d=await(0,F.Em)("/api/v1/ai/save",{method:"POST",body:JSON.stringify({code:e,type:a,content:c})});d?(_e.o.success(`天机已定！${d.message}`,{id:r}),await u.fetchAllCloudData()):_e.o.error("记录天机失败",{id:r})}catch(e){const n=e instanceof Error?e.message:"未知错误";n.includes("兑换码")||n.includes("信物")?_e.o.error(n,{id:r}):n.includes("登录")?_e.o.error("身份验证失败，请重新登录！",{id:r}):_e.o.error("天机紊乱："+n,{id:r})}finally{u.resetCreationState(),setTimeout(()=>_e.o.hide(r),3e3)}}(e.code,e.prompt))}async function S(){if(console.log("[DEBUG] createCharacter 开始执行"),console.log("[DEBUG] store.isCreating:",u.isCreating),u.isCreating)console.warn("[CharacterCreation.vue] 角色创建已在进行中，忽略重复请求");else{if(console.log("[CharacterCreation.vue] createCharacter() called."),console.log("[DEBUG] 开始数据校验"),console.log("[DEBUG] 角色名:",u.characterPayload.character_name),console.log("[DEBUG] 选中的世界:",u.selectedWorld),console.log("[DEBUG] 选中的天资:",u.selectedTalentTier),console.log("[DEBUG] 选中的出身:",u.selectedOrigin),u.characterPayload.character_name||(console.log("[DEBUG] 角色名为空，使用默认值"),u.characterPayload.character_name="修士"),!u.selectedWorld||!u.selectedTalentTier)return console.log("[DEBUG] 验证失败：缺少必需选择项"),console.log("[DEBUG] selectedWorld:",u.selectedWorld),console.log("[DEBUG] selectedTalentTier:",u.selectedTalentTier),void _e.o.error("创建数据不完整，请检查世界和天资选择！");if(console.log("[DEBUG] selectedOrigin:",u.selectedOrigin,"(可为空，表示随机出生)"),u.startCreation(),!u.isLocalCreation){if(!(0,O.isBackendConfigured)())return _e.o.error("联机模式需要先配置后端服务器地址"),void u.resetCreationState();if(!await(0,F.verifyStoredToken)())return _e.o.error("联机模式需要先登录"),void u.resetCreationState()}console.log("[DEBUG] 数据校验通过，开始创建角色");try{u.characterPayload.character_name,u.characterPayload.gender,u.characterPayload.race,u.selectedWorld,u.selectedTalentTier,u.selectedOrigin,u.selectedTalents,u.characterPayload.strength,u.characterPayload.agility,u.characterPayload.constitution,u.characterPayload.willpower,u.characterPayload.charm,u.characterPayload.luck;const e={charId:`char_${Date.now()}`,characterName:u.characterPayload.character_name,world:u.selectedWorld,talentTier:u.selectedTalentTier,origin:u.selectedOrigin,talents:u.selectedTalents,baseAttributes:{strength:u.characterPayload.strength,agility:u.characterPayload.agility,constitution:u.characterPayload.constitution,willpower:u.characterPayload.willpower,charm:u.characterPayload.charm,luck:u.characterPayload.luck},mode:u.isLocalCreation?"单机":"联机",age:u.characterPayload.current_age,gender:u.characterPayload.gender,race:u.characterPayload.race};console.log("🔥 [角色创建] 当前选择的开局年龄:",u.characterPayload.current_age),console.log("🔥 [角色创建] 当前选择的种族:",u.characterPayload.race),console.log("发射creation-complete事件，载荷:",e),d("creation-complete",e)}catch(e){console.error("创建角色时发生严重错误:",e),u.failCreation(e instanceof Error?e.message:"未知错误"),d("creation-complete",{error:e})}}}function L(e){console.log("[角色创建] 云端同步完成:",e),e.success&&e.newItemsCount>0&&_e.o.success(`已更新 ${e.newItemsCount} 项云端数据`)}function E(e,n){console.log("[角色创建] 数据清除完成:",{type:e,count:n}),n>0&&u.resetCharacter()}async function I(e){if(console.log("[角色创建] 存储预设完成:",e),e.success&&e.presetData)try{const{savePreset:n}=await Promise.resolve().then(t.bind(t,5735)),a={name:"string"==typeof e.presetData.name?e.presetData.name:"未命名预设",description:"string"==typeof e.presetData.description?e.presetData.description:"",data:{character_name:u.characterPayload.character_name,gender:h(u.characterPayload.gender),race:u.characterPayload.race,current_age:u.characterPayload.current_age,world:u.selectedWorld??null,talentTier:u.selectedTalentTier??null,origin:u.selectedOrigin??null,talents:u.selectedTalents??[],baseAttributes:{strength:u.characterPayload.strength,agility:u.characterPayload.agility,constitution:u.characterPayload.constitution,willpower:u.characterPayload.willpower,charm:u.characterPayload.charm,luck:u.characterPayload.luck}}},r=await n(a);console.log("[角色创建] 预设已保存到 IndexedDB, ID:",r),_e.o.success("预设保存成功！")}catch(e){console.error("[角色创建] 保存预设到 IndexedDB 失败:",e),_e.o.error("预设保存失败")}}async function R(e){if(console.log("[角色创建] 加载预设完成:",e),e.success){if(!e.presetData)return console.warn("[角色创建] 预设数据为空"),void _e.o.error("预设数据无效");console.log("[角色创建] 准备使用预设数据创建角色:",e.presetData);try{const n=e.presetData.data,t=u.creationData.worlds.find(e=>e.name===n.world?.name),a=u.creationData.talentTiers.find(e=>e.name===n.talentTier?.name),o=u.creationData.origins.find(e=>e.name===n.origin?.name),i=t?t.id:"",s=a?a.id:"",l=n.talents&&Array.isArray(n.talents)?n.talents.map(e=>u.creationData.talents.find(n=>n.name===e.name)?.id).filter(e=>void 0!==e):[],c={...u.characterPayload,character_name:n.character_name||"无名者",gender:n.gender||"男",race:n.race||"人族",current_age:n.current_age??16,world_id:i,talent_tier_id:s,origin_id:o?o.id:null,selected_talent_ids:l,strength:n.baseAttributes?.strength??0,agility:n.baseAttributes?.agility??0,constitution:n.baseAttributes?.constitution??0,willpower:n.baseAttributes?.willpower??0,charm:n.baseAttributes?.charm??0,luck:n.baseAttributes?.luck??0};if(u.characterPayload=c,console.log("[角色创建] 预设数据已原子性恢复, 新的Payload:",c),await(0,r.dY)(),!u.selectedWorld||!u.selectedTalentTier)return console.error("[角色创建] 预设恢复后检查失败，核心数据缺失。"),_e.o.error("预设数据不完整或已失效，请重新选择。"),void(u.currentStep=1);u.currentStep=u.totalSteps,await(0,r.dY)(),console.log("[角色创建] 预设数据恢复且校验通过，执行创建..."),await S()}catch(e){console.error("[角色创建] 使用预设数据失败:",e),_e.o.error("预设数据处理失败")}}else _e.o.error(e.message)}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",Al,[(0,r.bF)(T),(0,r.Lk)("div",Sl,[(0,r.Q3)(" 进度条 "),(0,r.Lk)("div",Ll,[(0,r.Lk)("div",El,[(0,r.Q3)(" 左侧：模式指示 "),(0,r.Lk)("div",Tl,(0,o.v_)((0,i.R1)(u).isLocalCreation?e.$t("单机模式"):e.$t("联机模式")),1),(0,r.Q3)(" 右侧：云端同步按钮（仅单机模式显示） "),(0,i.R1)(u).isLocalCreation?((0,r.uX)(),(0,r.CE)("div",Il,[(0,r.bF)(Pe,{onSyncCompleted:L,variant:"compact",size:"small"}),(0,r.bF)(kn,{variant:"compact",size:"small","current-step":(0,i.R1)(u).currentStep,"total-steps":(0,i.R1)(u).totalSteps,"character-data":b.value,onStoreCompleted:I},null,8,["current-step","total-steps","character-data"]),(0,r.bF)(ma,{variant:"compact",size:"small",onLoadCompleted:R}),(0,r.bF)(Xe,{variant:"horizontal",size:"small",onDataCleared:E})])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Rl,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,i.R1)(u).totalSteps,e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:(0,o.C4)(["step",{active:(0,i.R1)(u).currentStep>=e}])},[(0,r.Lk)("div",Ml,(0,o.v_)(e),1),(0,r.Lk)("div",Pl,(0,o.v_)(g.value[e-1]),1)],2))),128))])]),(0,r.Q3)(" 内容区域 "),(0,r.Lk)("div",Dl,[(0,r.bF)(s.eB,{name:"fade-step",mode:"out-in"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)("div",{key:(0,i.R1)(u).currentStep,class:"step-wrapper"},[1===(0,i.R1)(u).currentStep?((0,r.uX)(),(0,r.Wv)(ko,{key:0,ref_key:"step1Ref",ref:k,onAiGenerate:m},null,512)):2===(0,i.R1)(u).currentStep?((0,r.uX)(),(0,r.Wv)(Go,{key:1,ref_key:"step2Ref",ref:w,onAiGenerate:m},null,512)):3===(0,i.R1)(u).currentStep?((0,r.uX)(),(0,r.Wv)(yi,{key:2,ref_key:"step3Ref",ref:_,onAiGenerate:m},null,512)):4===(0,i.R1)(u).currentStep?((0,r.uX)(),(0,r.Wv)(Ui,{key:3,ref_key:"step5Ref",ref:C,onAiGenerate:m},null,512)):5===(0,i.R1)(u).currentStep?((0,r.uX)(),(0,r.Wv)(is,{key:4})):6===(0,i.R1)(u).currentStep?((0,r.uX)(),(0,r.Wv)(Zs,{key:5,"is-local-creation":(0,i.R1)(u).isLocalCreation},null,8,["is-local-creation"])):(0,r.Q3)("v-if",!0)]))]),_:1})]),(0,r.Q3)(" 导航 "),(0,r.Lk)("div",zl,[(0,r.Lk)("button",{onClick:(0,s.D$)(y,["prevent"]),type:"button",class:"btn btn-secondary"},(0,o.v_)(1===(0,i.R1)(u).currentStep?e.$t("返回道途"):e.$t("上一步")),1),(0,r.Q3)(" 剩余点数显示 "),(0,r.Lk)("div",Nl,[(0,i.R1)(u).currentStep>=3&&(0,i.R1)(u).currentStep<=7?((0,r.uX)(),(0,r.CE)("div",$l,[(0,r.Lk)("span",Ol,(0,o.v_)(e.$t("剩余点数"))+":",1),(0,r.Lk)("span",{class:(0,o.C4)(["points-value",{low:(0,i.R1)(u).remainingTalentPoints<0}])},(0,o.v_)((0,i.R1)(u).remainingTalentPoints),3)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("button",{type:"button",onClick:n[0]||(n[0]=(0,s.D$)(e=>{console.log("[DEBUG] 开启仙途按钮被点击!"),async function(e){console.log("[DEBUG] handleNext 被调用，当前步骤:",u.currentStep,"总步骤:",u.totalSteps),e&&(e.preventDefault(),e.stopPropagation(),console.log("[DEBUG] 事件已阻止默认行为")),u.currentStep<u.totalSteps?(console.log("[DEBUG] 执行下一步"),u.nextStep()):(console.log("[DEBUG] 最后一步，准备创建角色"),await S())}(e)},["prevent"])),disabled:(0,i.R1)(u).isCreating||x.value||(0,i.R1)(u).currentStep===(0,i.R1)(u).totalSteps&&(0,i.R1)(u).remainingTalentPoints<0,class:(0,o.C4)(["btn",{"btn-complete":(0,i.R1)(u).currentStep===(0,i.R1)(u).totalSteps,disabled:(0,i.R1)(u).isCreating||x.value||(0,i.R1)(u).currentStep===(0,i.R1)(u).totalSteps&&(0,i.R1)(u).remainingTalentPoints<0}])},(0,o.v_)((0,i.R1)(u).currentStep===(0,i.R1)(u).totalSteps?e.$t("完成创建"):e.$t("下一步")),11,Fl)])]),(0,r.Q3)(" 仙缘信物按钮 - 只在联机模式下点击AI推演时显示 "),(0,r.bF)(Cl,{visible:v.value,type:f.value,title:"使用仙缘信物",onClose:n[1]||(n[1]=e=>v.value=!1),onSubmit:A},null,8,["visible","type"]),(0,r.Q3)(" AI生成等待由全局toast处理 ")]))}});var Bl=t(6796),Xl={};Xl.styleTagTransform=A(),Xl.setAttributes=k(),Xl.insert=y().bind(null,"head"),Xl.domAPI=g(),Xl.insertStyleElement=_(),h()(Bl.A,Xl),Bl.A&&Bl.A.locals&&Bl.A.locals;var Ul=t(4190),Wl={};Wl.styleTagTransform=A(),Wl.setAttributes=k(),Wl.insert=y().bind(null,"head"),Wl.domAPI=g(),Wl.insertStyleElement=_(),h()(Ul.A,Wl),Ul.A&&Ul.A.locals&&Ul.A.locals;const ql=(0,E.A)(jl,[["__scopeId","data-v-2e07bf78"]]);function Gl(e){if(window.turnstile)try{window.turnstile.reset(e??void 0)}catch(e){}}function Hl(e){if(window.turnstile&&e)try{window.turnstile.remove?.(e)}catch(e){}}const Vl={class:"login-container"},Ql={class:"login-panel"},Kl={class:"title"},Yl={key:0,class:"subtitle"},Jl={key:1,class:"subtitle"},Zl={class:"form-group"},ec={for:"username"},nc=["placeholder"],tc={class:"form-group"},ac={for:"password"},rc=["placeholder"],oc={key:0,class:"form-group"},ic={for:"confirmPassword"},sc=["placeholder"],lc={class:"form-group"},cc={for:"email"},dc={class:"email-input-row"},uc=["placeholder"],pc=["disabled"],vc={class:"form-group"},fc={for:"emailCode"},hc=["placeholder"],mc={key:2,class:"form-group turnstile-group"},gc={key:3,class:"success-message"},bc={class:"form-actions"},yc=["disabled"],xc={class:"btn-text"},kc={class:"form-footer"},wc={key:3,class:"form-actions"},_c=(0,r.pM)({__name:"LoginView",emits:["loggedIn","back"],setup(e,{emit:n}){const t=n,a=(0,i.KR)(""),l=(0,i.KR)(""),c=(0,i.KR)(""),d=(0,i.KR)(""),u=(0,i.KR)(""),p=(0,i.KR)(!1),v=(0,i.KR)(null),f=(0,i.KR)(null),h=(0,i.KR)(!1),m=(0,i.KR)((0,O.isBackendConfigured)()),g=(0,i.KR)(!1),b=(0,i.KR)(""),y=(0,i.KR)(!1),x=(0,i.KR)(null),k=(0,i.KR)(null),w=(0,i.KR)(""),_=(0,i.KR)(!1),C=(0,i.KR)(0);let A=null;const S=()=>{h.value=!h.value,v.value=null,f.value=null,l.value="",c.value="",d.value="",u.value="",w.value="",g.value&&Gl(k.value)},L=async()=>{if(d.value)if(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(d.value)){_.value=!0,v.value=null;try{const e=await(0,F.Em)("/api/v1/auth/send-email-code",{method:"POST",body:JSON.stringify({email:d.value,purpose:"register"})});e.success?(_e.o.success("验证码已发送，请查收邮件"),C.value=60,A=setInterval(()=>{C.value--,C.value<=0&&A&&(clearInterval(A),A=null)},1e3)):v.value=e.message||"发送失败"}catch(e){v.value=e.detail||e.message||"发送验证码失败"}finally{_.value=!1}}else v.value="邮箱格式不正确";else v.value="请先输入邮箱"},E=async()=>{if(g.value&&b.value&&x.value)if(await async function(e=8e3){if("undefined"==typeof window)return!1;if(window.turnstile)return!0;const n="undefined"==typeof window?null:(window.turnstileCallbacks||(window.turnstileCallbacks=[]),window.turnstileCallbacks);return!!n&&await new Promise(t=>{let a=!1;const r=e=>{a||(a=!0,t(e))},o=setTimeout(()=>r(!!window.turnstile),e);n.push(()=>{clearTimeout(o),r(!!window.turnstile)})})}())try{Hl(k.value),k.value=function(e,n){if(!window.turnstile)throw new Error("Turnstile SDK not loaded");return window.turnstile.render(e,{sitekey:n.siteKey??"0x4AAAAAACKKIZGhHxLokv-j",theme:n.theme??"auto",callback:e=>n.onSuccess("string"==typeof e?e:""),"error-callback":()=>n.onError?.(),"expired-callback":()=>n.onExpired?.()})}(x.value,{siteKey:b.value,theme:"dark"===document.documentElement.getAttribute("data-theme")?"dark":"light",onSuccess:e=>{w.value=e,v.value=null},onExpired:()=>{w.value=""},onError:()=>{w.value="",v.value="无效域。如果此问题仍然存在，请与站点管理员联系。"}})}catch(e){console.error("[Turnstile] render failed:",e),v.value="人机验证组件渲染失败，请刷新页面后重试"}else v.value="人机验证组件加载失败，请检查网络或刷新页面后重试"};return(0,r.wB)(g,e=>{e&&b.value&&setTimeout(()=>{E()},100)}),(0,r.sV)(async()=>{m.value&&await(async()=>{try{const e=await(0,F.Em)("/api/v1/auth/security-settings");g.value=e.turnstile_enabled,b.value=e.turnstile_site_key||"",y.value=e.email_verification_enabled}catch(e){console.warn("[Security] 获取配置失败:",e),g.value=!1,y.value=!1}})()}),(0,r.xo)(()=>{Hl(k.value),A&&clearInterval(A)}),(e,n)=>((0,r.uX)(),(0,r.CE)("div",Vl,[(0,r.Lk)("div",Ql,[(0,r.Lk)("h2",Kl,(0,o.v_)(h.value?e.$t("初入道门"):e.$t("登入洞天")),1),m.value?((0,r.uX)(),(0,r.CE)("p",Yl,(0,o.v_)(h.value?e.$t("注册新道号，踏入修仙之路。"):e.$t("验证道友身份，以便同步云端天机。")),1)):((0,r.uX)(),(0,r.CE)("p",Jl,"未配置后端服务器，登录/注册不可用")),m.value?((0,r.uX)(),(0,r.CE)("form",{key:2,onSubmit:n[6]||(n[6]=(0,s.D$)(e=>h.value?(async()=>{if(!p.value)if(m.value)if(l.value===c.value){if(y.value){if(!d.value)return void(v.value="请输入邮箱");if(!u.value)return void(v.value="请输入邮箱验证码")}if(g.value&&!w.value)return v.value="请先完成人机验证",void _e.o.error(v.value);p.value=!0,v.value=null,f.value=null;try{const e={user_name:a.value,password:l.value};y.value&&(e.email=d.value,e.email_code=u.value),g.value&&w.value&&(e.turnstile_token=w.value),await(0,F.Em)("/api/v1/auth/register",{method:"POST",body:JSON.stringify(e)}),_e.o.success("道号注册成功，欢迎踏入修仙之路！"),f.value="注册成功！请登录您的道号",h.value=!1,w.value="",g.value&&Gl(k.value)}catch(e){let n="一个未知的错误发生了";"object"==typeof e&&null!==e&&("detail"in e&&"string"==typeof e.detail?n=e.detail:"message"in e&&"string"==typeof e.message&&(n=e.message)),v.value=n,_e.o.error(n)}finally{p.value=!1,w.value="",g.value&&Gl(k.value)}}else v.value="两次输入的令牌不一致！";else _e.o.info("未配置后端服务器，注册不可用")})():(async()=>{if(!p.value)if(m.value){if(g.value&&!w.value)return v.value="请先完成人机验证",void _e.o.error(v.value);p.value=!0,v.value=null,f.value=null;try{const e={username:a.value,password:l.value};g.value&&w.value&&(e.turnstile_token=w.value);const n=await(0,F.Em)("/api/v1/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});localStorage.setItem("access_token",n.access_token),localStorage.setItem("username",a.value),_e.o.success("登入成功，天机已连通！"),t("loggedIn")}catch(e){let n="一个未知的错误发生了";"object"==typeof e&&null!==e&&("detail"in e&&"string"==typeof e.detail?n=e.detail:"message"in e&&"string"==typeof e.message&&(n=e.message)),v.value=n,_e.o.error(n)}finally{p.value=!1,w.value="",g.value&&Gl(k.value)}}else _e.o.info("未配置后端服务器，登录不可用")})(),["prevent"]))},[(0,r.Lk)("div",Zl,[(0,r.Lk)("label",ec,(0,o.v_)(e.$t("道号")),1),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":n[0]||(n[0]=e=>a.value=e),placeholder:e.$t("请输入您的道号"),required:""},null,8,nc),[[s.Jo,a.value]])]),(0,r.Lk)("div",tc,[(0,r.Lk)("label",ac,(0,o.v_)(e.$t("令牌")),1),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":n[1]||(n[1]=e=>l.value=e),placeholder:e.$t("请输入您的身份令牌"),required:""},null,8,rc),[[s.Jo,l.value]])]),h.value?((0,r.uX)(),(0,r.CE)("div",oc,[(0,r.Lk)("label",ic,(0,o.v_)(e.$t("确认令牌")),1),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":n[2]||(n[2]=e=>c.value=e),placeholder:e.$t("请再次输入令牌"),required:""},null,8,sc),[[s.Jo,c.value]])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 邮箱验证（仅注册且启用时显示） "),h.value&&y.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",lc,[(0,r.Lk)("label",cc,(0,o.v_)(e.$t("邮箱")),1),(0,r.Lk)("div",dc,[(0,r.bo)((0,r.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":n[3]||(n[3]=e=>d.value=e),placeholder:e.$t("请输入您的邮箱"),required:""},null,8,uc),[[s.Jo,d.value]]),(0,r.Lk)("button",{type:"button",class:"btn btn-small",onClick:L,disabled:_.value||C.value>0},(0,o.v_)(C.value>0?`${C.value}s`:_.value?"发送中...":"发送验证码"),9,pc)])]),(0,r.Lk)("div",vc,[(0,r.Lk)("label",fc,(0,o.v_)(e.$t("验证码")),1),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"emailCode","onUpdate:modelValue":n[4]||(n[4]=e=>u.value=e),placeholder:e.$t("请输入邮箱验证码"),required:""},null,8,hc),[[s.Jo,u.value]])])],64)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" Turnstile 人机验证 "),g.value?((0,r.uX)(),(0,r.CE)("div",mc,[(0,r.Lk)("div",{ref_key:"turnstileContainer",ref:x,class:"turnstile-container"},null,512)])):(0,r.Q3)("v-if",!0),f.value?((0,r.uX)(),(0,r.CE)("div",gc,(0,o.v_)(f.value),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",bc,[(0,r.Lk)("button",{type:"button",onClick:n[5]||(n[5]=e=>t("back")),class:"btn btn-secondary"},(0,o.v_)(e.$t("返回")),1),(0,r.Lk)("button",{type:"submit",class:(0,o.C4)(["btn",{"is-loading":p.value}]),disabled:p.value},[(0,r.Lk)("span",xc,(0,o.v_)(h.value?e.$t("注册"):e.$t("登入")),1)],10,yc)]),(0,r.Lk)("div",kc,[(0,r.Lk)("a",{href:"#",onClick:(0,s.D$)(S,["prevent"]),class:"link"},(0,o.v_)(h.value?e.$t("已有道号？立即登入"):e.$t("初来乍到？注册道号")),1)])],32)):((0,r.uX)(),(0,r.CE)("div",wc,[(0,r.Lk)("button",{type:"button",onClick:n[7]||(n[7]=e=>t("back")),class:"btn btn-secondary"},(0,o.v_)(e.$t("返回")),1)]))])]))}});var Cc=t(9396),Ac={};Ac.styleTagTransform=A(),Ac.setAttributes=k(),Ac.insert=y().bind(null,"head"),Ac.domAPI=g(),Ac.insertStyleElement=_(),h()(Cc.A,Ac),Cc.A&&Cc.A.locals&&Cc.A.locals;const Sc=(0,E.A)(_c,[["__scopeId","data-v-85e1d8c6"]]);var Lc=t(4459),Ec=t(8220),Tc=t(7760),Ic=t(4530),Rc=t(6988),Mc=t(8381),Pc=t(7677);const Dc=(0,I.A)("circle-play",[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var zc=t(7271);const Nc=(0,I.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),$c=(0,I.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Oc=(0,I.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var Fc=t(8684),jc=t(5976);const Bc=(0,I.A)("server-off",[["path",{d:"M7 2h13a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-5",key:"bt2siv"}],["path",{d:"M10 10 2.5 2.5C2 2 2 2.5 2 5v3a2 2 0 0 0 2 2h6z",key:"1hjrv1"}],["path",{d:"M22 17v-1a2 2 0 0 0-2-2h-1",key:"1iynyr"}],["path",{d:"M4 14a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16.5l1-.5.5.5-8-8H4z",key:"161ggg"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Xc=(0,I.A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Uc=(0,I.A)("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var Wc=t(5365);const qc=(0,I.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),Gc=(0,I.A)("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Hc=(0,I.A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);var Vc=t(3528),Qc=t(7754);const Kc=(0,I.A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Yc=(0,I.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var Jc=t(9992);const Zc=(0,I.A)("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var ed=t(6494);const nd=(0,I.A)("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),td=(0,I.A)("import",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m8 11 4 4 4-4",key:"1dohi6"}],["path",{d:"M8 5H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4",key:"1ywtjm"}]]),ad={class:"workshop-container"},rd={class:"workshop-panel"},od={class:"header-section"},id={class:"header-content"},sd={class:"title-row"},ld={class:"title-group"},cd={class:"title-icon-wrapper"},dd={key:3},ud={key:4},pd={key:5},vd={key:1,class:"auth-pill warn"},fd={class:"notice"},hd={key:0,class:"backend-locked"},md={class:"actions"},gd={class:"tabs"},bd={key:0,class:"browse scroll-content"},yd={class:"filters"},xd={class:"search-input-wrapper"},kd=["placeholder"],wd=["value"],_d=["disabled"],Cd={key:0,class:"manage-bar"},Ad={class:"manage-title"},Sd={class:"manage-meta"},Ld={key:1,class:"loading"},Ed={key:2,class:"empty"},Td={key:3,class:"item-list"},Id=["onClick"],Rd={class:"item-header"},Md={class:"item-type-badge"},Pd={class:"item-stats"},Dd=["title"],zd={class:"stat-value"},Nd=["title"],$d={key:0,class:"item-desc"},Od={class:"item-meta"},Fd=["title"],jd={key:0,class:"meta-version"},Bd={key:1,class:"tags"},Xd=["onClick"],Ud=["onClick"],Wd={key:4,class:"pagination"},qd={class:"page-meta"},Gd={class:"page-controls"},Hd=["disabled"],Vd=["disabled"],Qd={key:1,class:"upload scroll-content"},Kd={key:0,class:"upload-locked"},Yd={class:"actions"},Jd={key:1,class:"upload-form"},Zd={class:"form-row"},eu={class:"form-row"},nu={class:"form-row"},tu={class:"form-row"},au={class:"form-row"},ru={class:"content-actions"},ou={class:"file-btn btn btn-secondary"},iu={key:2,class:"hint"},su={class:"actions upload-actions"},lu=["disabled"],cu={key:2,class:"footer-actions"},du={class:"modal detail-modal"},uu={class:"modal-header"},pu={class:"modal-body"},vu={class:"detail-content"},fu={class:"detail-row"},hu={class:"detail-value"},mu={class:"item-type-badge"},gu={class:"detail-row"},bu={class:"detail-value"},yu={class:"detail-row"},xu={class:"detail-value downloads-value"},ku={key:0,class:"detail-row"},wu={class:"detail-value"},_u={key:1,class:"detail-row"},Cu={class:"detail-tags"},Au={key:2,class:"detail-row desc-row"},Su={class:"detail-desc"},Lu={class:"modal-actions"},Eu={class:"modal"},Tu={class:"modal-header"},Iu={key:0,class:"modal-body loading-body"},Ru={key:1,class:"modal-body"},Mu={class:"modal-info"},Pu={class:"modal-title"},Du={class:"modal-sub"},zu={key:0},Nu={key:1},$u={key:2},Ou={class:"modal-actions"},Fu={key:0,class:"import-saves"},ju={class:"form-row"},Bu=["value"],Xu=["disabled"],Uu=(0,r.pM)({__name:"WorkshopView",setup(e){const n=(0,a.rd)(),t=(0,Ec.useCharacterStore)(),l=(0,i.KR)((0,O.isBackendConfigured)()),c=(0,i.KR)(null),d=(0,r.EW)(()=>l.value?c.value??"":""),u=(0,r.EW)(()=>d.value||"未知版本"),p=(0,i.KR)("checking"),v=(0,i.KR)("browse"),f=(0,i.KR)(1),h=(0,i.KR)(12),m=(0,i.KR)(0),g=[8,12,20,30],b=(0,r.EW)(()=>"mine"===v.value?"mine":"browse"),y=(0,r.EW)(()=>Math.max(1,Math.ceil(m.value/h.value))),x=(0,r.EW)(()=>"mine"===v.value),k=(0,r.EW)(()=>"upload"!==v.value),w={settings:"设置",prompts:"提示词",saves:"单机存档",start_config:"开局配置"},_={settings:ya.A,prompts:Mc.A,saves:Pc.A,start_config:Dc},C=(0,i.KR)({open:!1,item:null}),A=()=>{C.value.open=!1,C.value.item=null},S=()=>{C.value.item&&(G(C.value.item.id),A())},L=async()=>{if(l.value){p.value="checking";try{const e=await(0,F.verifyStoredToken)();p.value=e?"authed":"unauthed"}catch{p.value="unauthed"}}else p.value="unauthed"};(0,r.sV)(async()=>{if(!l.value)return;const e=await(0,O.d9)();e&&(c.value=e),L(),j()});const E=()=>{n.push("/")},I=()=>{l.value?n.push("/login"):_e.o.info("未配置后端服务器，登录不可用")},M=e=>{"mine"!==e||"authed"===p.value?v.value=e:I()},P=(0,i.KR)(""),z=(0,i.KR)(""),N=(0,i.KR)([]),$=(0,i.KR)(!1),j=async()=>{if(!l.value)return N.value=[],void(m.value=0);if("mine"!==b.value||"authed"===p.value){$.value=!0;try{const e="mine"===b.value?await async function(e){const n=new URLSearchParams;e.type&&n.set("type",e.type),e.q&&n.set("q",e.q),e.page&&n.set("page",String(e.page)),e.pageSize&&n.set("page_size",String(e.pageSize));const t=n.toString();return F.Em.get("/api/v1/workshop/my-items"+(t?`?${t}`:""))}({type:P.value,q:z.value,page:f.value,pageSize:h.value}):await async function(e){const n=new URLSearchParams;e.type&&n.set("type",e.type),e.q&&n.set("q",e.q),e.page&&n.set("page",String(e.page)),e.pageSize&&n.set("page_size",String(e.pageSize));const t=n.toString();return F.Em.get("/api/v1/workshop/items"+(t?`?${t}`:""))}({type:P.value,q:z.value,page:f.value,pageSize:h.value});N.value=e.items||[],m.value=e.total||0}catch{N.value=[],m.value=0}finally{$.value=!1}}else I()},B=()=>{f.value>1&&(f.value-=1)},X=()=>{f.value<y.value&&(f.value+=1)};(0,r.wB)(v,()=>{f.value=1,k.value&&j()}),(0,r.wB)(f,()=>{k.value&&j()}),(0,r.wB)(h,()=>{f.value=1,k.value&&j()}),(0,r.wB)(P,()=>{f.value=1,k.value&&j()});const U=(0,i.KR)({open:!1,loading:!1,item:null,payload:null}),W=(0,i.KR)(""),q=()=>{U.value.open=!1,U.value.loading=!1,U.value.item=null,U.value.payload=null,W.value=""},G=async e=>{U.value.open=!0,U.value.loading=!0,U.value.item=null,U.value.payload=null;try{const n=await async function(e){return F.Em.post(`/api/v1/workshop/items/${e}/download`,{})}(e);U.value.item=n.item,U.value.payload=n.payload}catch{q()}finally{U.value.loading=!1}},H=()=>{if(!U.value.item)return;const e=U.value.payload,n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(t);const r=(new Date).toISOString().split("T")[0];a.download=`仙途-工坊-${U.value.item.type}-${r}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)},V=()=>{const e=U.value.payload,n=(0,Tc.ZT)(e);let t=null;if("settings"===n.type?t=n.payload:e?.settings?t=e.settings:null===n.type&&"object"==typeof n.payload&&(t=n.payload),t&&"object"==typeof t)try{const e={...(()=>{try{const e=localStorage.getItem("dad_game_settings");return e?JSON.parse(e):{}}catch{return{}}})(),...t};localStorage.setItem("dad_game_settings",JSON.stringify(e)),_e.o.success("已导入本地设置（刷新页面后生效）"),q()}catch(e){console.error("导入设置失败:",e),_e.o.error("导入设置失败，请重试")}else _e.o.error("设置内容格式不正确")},Q=async()=>{const e=U.value.payload,n=(0,Tc.ZT)(e);let t=null;if("prompts"===n.type?t=n.payload:"object"!=typeof e||Array.isArray(e)||(t=e),t&&"object"==typeof t)try{const e=await Lc.e.importPrompts(t);_e.o.success(`已导入 ${e} 条提示词（刷新页面后生效）`),q()}catch(e){console.error("导入提示词失败:",e),_e.o.error("导入提示词失败，请重试")}else _e.o.error("提示词内容格式不正确")},K=()=>{const e=U.value.payload,n=(0,Tc.ZT)(e);let t=null;if("start_config"===n.type?t=n.payload:"object"!=typeof e||Array.isArray(e)||(t=e),t&&"object"==typeof t)try{localStorage.setItem("dad_start_config",JSON.stringify(t)),_e.o.success("已应用到本地开局配置（重新打开开局页面生效）"),q()}catch(e){console.error("导入开局配置失败:",e),_e.o.error("导入开局配置失败，请重试")}else _e.o.error("开局配置格式不正确")},Y=(0,r.EW)(()=>(t.allCharacterProfiles||[]).filter(e=>"单机"===e?.模式).map(e=>({角色ID:e.角色ID,name:e?.角色?.名字||e.角色ID}))),J=async()=>{if(!W.value)return;const e=U.value.payload,n=(0,Tc.ZT)(e),a="saves"===n.type&&Array.isArray(n.payload?.saves)?n.payload.saves:"character"===n.type&&Array.isArray(n.payload?.存档列表)?n.payload.存档列表:null;if(a){for(const e of a)await t.importSave(W.value,e);_e.o.success(`已导入 ${a.length} 个存档到本地单机角色`)}else _e.o.error("存档内容格式不正确")},Z=(0,i.KR)("settings"),ee=(0,i.KR)(""),ne=(0,i.KR)(""),te=(0,i.KR)(""),ae=(0,i.KR)(null),re=(0,i.KR)(""),oe=(0,i.KR)(!1),ie=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.text();ae.value=JSON.parse(e),re.value=`已读取：${n.name}`,ee.value||(ee.value=n.name.replace(/\.json$/i,""))}catch{ae.value=null,re.value="",_e.o.error("读取文件失败，请确认是有效的 JSON")}finally{e.target.value=""}},se=()=>{try{const e=localStorage.getItem("dad_game_settings");if(!e)return void _e.o.info("本地还没有设置数据");const n=JSON.parse(e);ae.value={settings:n,exportInfo:{timestamp:(new Date).toISOString(),version:u.value,gameVersion:`仙途 v${u.value}`}},re.value="已从本地读取 dad_game_settings",ee.value||(ee.value=`设置-${u.value}`)}catch{_e.o.error("读取本地设置失败")}},le=async()=>{try{const e=await Lc.e.exportAll();ae.value=e,re.value="已从本地导出提示词",ee.value||(ee.value=`提示词-${u.value}`)}catch{_e.o.error("导出本地提示词失败")}},ce=async()=>{if("authed"!==p.value)return void _e.o.info("上传前需要先完成账号验证");const e=ee.value.trim();if(e)if(ae.value){oe.value=!0;try{const t=(()=>{const e=ae.value,n=(0,Tc.ZT)(e);if("settings"===Z.value){const t="settings"===n.type?n.payload:e?.settings??e;if(!t||"object"!=typeof t)throw new Error("设置内容格式不正确");return{bundleType:"settings",bundle:(0,Tc.q3)("settings",t,{appVersion:u.value})}}if("prompts"===Z.value){const t="prompts"===n.type?n.payload:e;if(!t||"object"!=typeof t)throw new Error("提示词内容格式不正确");return{bundleType:"prompts",bundle:(0,Tc.q3)("prompts",t,{appVersion:u.value})}}if("start_config"===Z.value){const t="start_config"===n.type?n.payload:e;if(!t||"object"!=typeof t)throw new Error("开局配置格式不正确");return{bundleType:"start_config",bundle:(0,Tc.q3)("start_config",t,{appVersion:u.value})}}if("saves"===Z.value){const t="character"===n.type?"character":"saves",a="saves"===n.type&&Array.isArray(n.payload?.saves)?n.payload.saves:"character"===n.type&&Array.isArray(n.payload?.存档列表)?n.payload.存档列表:"saves"===e?.type&&Array.isArray(e.saves)?e.saves:"character"===e?.type&&Array.isArray(e.character?.存档列表)?e.character.存档列表:null;if(!a)throw new Error("单机存档必须使用游戏导出的存档或角色文件");const r=a.map(e=>{const n=e?.存档数据;if(!n)throw new Error(`存档「${e?.存档名??"未知"}」缺少存档数据`);const t=(0,Ic.ru)(n)?n:(0,Ic.jj)(n).migrated,a=(0,Rc.$)(t);if(!a.isValid)throw new Error(`存档「${e?.存档名??"未知"}」校验失败：${a.errors[0]||"未知原因"}`);return{...e,存档数据:t}});if("character"===t){const t={角色ID:e?.角色ID??n.payload?.角色ID,角色信息:JSON.parse(JSON.stringify(e?.角色信息??n.payload?.角色信息??{})),存档列表:r};return{bundleType:"character",bundle:(0,Tc.q3)("character",t,{appVersion:u.value})}}const o={characterId:e?.characterId??n.payload?.characterId,characterName:e?.characterName??n.payload?.characterName,saves:r};return{bundleType:"saves",bundle:(0,Tc.q3)("saves",o,{appVersion:u.value})}}throw new Error("不支持的上传类型")})();await async function(e){return F.Em.post("/api/v1/workshop/items",e)}({type:Z.value,title:e,description:ne.value.trim()||void 0,tags:(n=te.value,n.split(",").map(e=>e.trim()).filter(Boolean).slice(0,12)),payload:t.bundle,game_version:`仙途 v${u.value}`,data_version:"1"}),_e.o.success("上传成功"),ee.value="",ne.value="",te.value="",ae.value=null,re.value="",v.value="browse",f.value=1,await j()}catch{}finally{oe.value=!1}var n}else _e.o.error("请先选择/生成要上传的内容");else _e.o.error("请填写标题")};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",ad,[(0,r.bF)(T),(0,r.Lk)("div",rd,[(0,r.Q3)(" 顶部标题区域 - 增加层次感 "),(0,r.Lk)("div",od,[n[18]||(n[18]=(0,r.Lk)("div",{class:"header-bg"},null,-1)),(0,r.Lk)("div",id,[(0,r.Lk)("div",sd,[(0,r.Lk)("div",ld,[(0,r.Lk)("div",cd,[(0,r.bF)((0,i.R1)(zc.A),{size:20})]),n[12]||(n[12]=(0,r.Lk)("h2",{class:"title"},"创意工坊",-1))]),l.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,o.C4)(["auth-pill",{ok:"authed"===p.value,warn:"authed"!==p.value}])},["authed"===p.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(Nc),{key:0,size:14})):"unauthed"===p.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)($c),{key:1,size:14})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(Oc),{key:2,size:14,class:"spin"})),"checking"===p.value?((0,r.uX)(),(0,r.CE)("span",dd,"检测中")):"authed"===p.value?((0,r.uX)(),(0,r.CE)("span",ud,"已验证")):((0,r.uX)(),(0,r.CE)("span",pd,"未验证")),"authed"!==p.value?((0,r.uX)(),(0,r.CE)("button",{key:6,class:"pill-link",onClick:I},"去验证")):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{class:"pill-link",onClick:L},[(0,r.bF)((0,i.R1)(Fc.A),{size:12})])],2)):((0,r.uX)(),(0,r.CE)("div",vd,[(0,r.bF)((0,i.R1)($c),{size:14}),n[13]||(n[13]=(0,r.Lk)("span",null,"未配置后端",-1))]))]),n[17]||(n[17]=(0,r.Lk)("p",{class:"subtitle"},"分享设置、提示词、开局配置、存档",-1)),(0,r.Lk)("p",fd,[(0,r.bF)((0,i.R1)(jc.A),{size:12}),n[14]||(n[14]=(0,r.eW)(" 工坊内容仅对",-1)),n[15]||(n[15]=(0,r.Lk)("strong",null,"单机本地",-1)),n[16]||(n[16]=(0,r.eW)("生效，联机模式由后端控制 ",-1))])])]),l.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",gd,[(0,r.Lk)("button",{class:(0,o.C4)(["tab",{active:"browse"===v.value}]),onClick:n[0]||(n[0]=e=>M("browse"))},[(0,r.bF)((0,i.R1)(Uc),{size:16}),n[21]||(n[21]=(0,r.Lk)("span",null,"浏览",-1))],2),(0,r.Lk)("button",{class:(0,o.C4)(["tab",{active:"mine"===v.value}]),onClick:n[1]||(n[1]=e=>M("mine"))},[(0,r.bF)((0,i.R1)(R),{size:16}),n[22]||(n[22]=(0,r.Lk)("span",null,"我的发布",-1))],2),(0,r.Lk)("button",{class:(0,o.C4)(["tab",{active:"upload"===v.value}]),onClick:n[2]||(n[2]=e=>M("upload"))},[(0,r.bF)((0,i.R1)(Wc.A),{size:16}),n[23]||(n[23]=(0,r.Lk)("span",null,"上传",-1))],2)]),"upload"!==v.value?((0,r.uX)(),(0,r.CE)("div",bd,[(0,r.Lk)("div",yd,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":n[3]||(n[3]=e=>P.value=e),class:"input"},n[24]||(n[24]=[(0,r.Fv)('<option value="" data-v-7e1e6f52>全部类型</option><option value="settings" data-v-7e1e6f52>设置</option><option value="prompts" data-v-7e1e6f52>提示词</option><option value="saves" data-v-7e1e6f52>单机存档</option><option value="start_config" data-v-7e1e6f52>开局配置</option>',5)]),512),[[s.u1,P.value]]),(0,r.Lk)("div",xd,[(0,r.bF)((0,i.R1)(qc),{size:14,class:"search-icon"}),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>z.value=e),class:"input search-input",placeholder:x.value?"搜索标题 / 说明":"搜索标题 / 作者 / 说明"},null,8,kd),[[s.Jo,z.value]])]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":n[5]||(n[5]=e=>h.value=e),class:"input page-size-select"},[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(g,e=>(0,r.Lk)("option",{key:e,value:e}," 每页 "+(0,o.v_)(e)+" 个 ",9,wd)),64))],512),[[s.u1,h.value,void 0,{number:!0}]]),(0,r.Lk)("button",{class:"btn btn-icon-only",onClick:j,disabled:$.value,title:"刷新"},[(0,r.bF)((0,i.R1)(Fc.A),{size:16,class:(0,o.C4)({spin:$.value})},null,8,["class"])],8,_d)]),x.value?((0,r.uX)(),(0,r.CE)("div",Cd,[(0,r.Lk)("div",Ad,[(0,r.bF)((0,i.R1)(Gc),{size:16}),n[25]||(n[25]=(0,r.eW)(" 我的发布管理 ",-1))]),(0,r.Lk)("div",Sd,"仅显示自己发布的内容 · 共 "+(0,o.v_)(m.value)+" 条",1)])):(0,r.Q3)("v-if",!0),$.value?((0,r.uX)(),(0,r.CE)("div",Ld,[(0,r.bF)((0,i.R1)(Oc),{size:24,class:"spin"}),n[26]||(n[26]=(0,r.Lk)("span",null,"加载中…",-1))])):0===N.value.length?((0,r.uX)(),(0,r.CE)("div",Ed,[(0,r.bF)((0,i.R1)(Hc),{size:40,class:"empty-icon"}),n[27]||(n[27]=(0,r.Lk)("p",null,"暂无内容",-1))])):((0,r.uX)(),(0,r.CE)("div",Td,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(N.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"item-card",onClick:n=>(e=>{C.value.open=!0,C.value.item=e})(e)},[(0,r.Lk)("div",Rd,[(0,r.Lk)("div",Md,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(_[e.type]),{size:12})),(0,r.eW)(" "+(0,o.v_)(w[e.type]||e.type),1)]),(0,r.Lk)("div",Pd,[(0,r.Lk)("span",{class:"stat-item downloads",title:`${e.downloads} 次下载`},[(0,r.bF)((0,i.R1)(Vc.A),{size:11}),(0,r.Lk)("span",zd,(0,o.v_)(e.downloads),1)],8,Dd)])]),(0,r.Lk)("div",{class:"item-title",title:e.title},(0,o.v_)(e.title),9,Nd),e.description?((0,r.uX)(),(0,r.CE)("div",$d,(0,o.v_)(e.description),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",Od,[(0,r.Lk)("span",{class:"meta-author",title:e.author_name},[(0,r.bF)((0,i.R1)(Qc.A),{size:12}),(0,r.eW)(" "+(0,o.v_)(e.author_name),1)],8,Fd),e.game_version?((0,r.uX)(),(0,r.CE)("span",jd,(0,o.v_)(e.game_version),1)):(0,r.Q3)("v-if",!0)]),e.tags?.length?((0,r.uX)(),(0,r.CE)("div",Bd,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.tags,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",{class:"item-actions",onClick:n[6]||(n[6]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("button",{class:"btn btn-sm btn-primary",onClick:n=>G(e.id)},[(0,r.bF)((0,i.R1)(Vc.A),{size:14}),n[28]||(n[28]=(0,r.eW)(" 下载 ",-1))],8,Xd),x.value?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-sm danger",onClick:n=>(async e=>{if("authed"===p.value){if(window.confirm(`确定删除「${e.title}」吗？删除后将无法恢复。`))try{await async function(e){return F.Em.delete(`/api/v1/workshop/items/${e}`)}(e.id),_e.o.success("已删除"),await j()}catch{}}else I()})(e)},[(0,r.bF)((0,i.R1)(ba.A),{size:14}),n[29]||(n[29]=(0,r.eW)(" 删除 ",-1))],8,Ud)):(0,r.Q3)("v-if",!0)])],8,Id))),128))])),y.value>1?((0,r.uX)(),(0,r.CE)("div",Wd,[(0,r.Lk)("div",qd,[(0,r.Lk)("span",null,"共 "+(0,o.v_)(m.value)+" 条",1),(0,r.Lk)("span",null,"第 "+(0,o.v_)(f.value)+" / "+(0,o.v_)(y.value)+" 页",1)]),(0,r.Lk)("div",Gd,[(0,r.Lk)("button",{class:"btn btn-secondary btn-sm",onClick:B,disabled:f.value<=1},[(0,r.bF)((0,i.R1)(Kc),{size:16}),n[30]||(n[30]=(0,r.eW)(" 上一页 ",-1))],8,Hd),(0,r.Lk)("button",{class:"btn btn-sm",onClick:X,disabled:f.value>=y.value},[n[31]||(n[31]=(0,r.eW)(" 下一页 ",-1)),(0,r.bF)((0,i.R1)(Yc),{size:16})],8,Vd)])])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",Qd,["authed"!==p.value?((0,r.uX)(),(0,r.CE)("div",Kd,[(0,r.bF)((0,i.R1)(D),{size:32,class:"locked-icon"}),n[33]||(n[33]=(0,r.Lk)("p",null,"上传需要先完成账号验证（用于标识作者与权限控制）",-1)),(0,r.Lk)("div",Yd,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:I},"去验证"),(0,r.Lk)("button",{class:"btn",onClick:L},[(0,r.bF)((0,i.R1)(Fc.A),{size:14}),n[32]||(n[32]=(0,r.eW)(" 刷新 ",-1))])])])):((0,r.uX)(),(0,r.CE)("div",Jd,[(0,r.Lk)("div",Zd,[n[35]||(n[35]=(0,r.Lk)("label",{class:"label"},"类型",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":n[7]||(n[7]=e=>Z.value=e),class:"input"},n[34]||(n[34]=[(0,r.Lk)("option",{value:"settings"},"设置",-1),(0,r.Lk)("option",{value:"prompts"},"提示词",-1),(0,r.Lk)("option",{value:"saves"},"单机存档",-1),(0,r.Lk)("option",{value:"start_config"},"开局配置",-1)]),512),[[s.u1,Z.value]])]),(0,r.Lk)("div",eu,[n[36]||(n[36]=(0,r.Lk)("label",{class:"label"},"标题",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[8]||(n[8]=e=>ee.value=e),class:"input",placeholder:"给这个分享起个名字"},null,512),[[s.Jo,ee.value]])]),(0,r.Lk)("div",nu,[n[37]||(n[37]=(0,r.Lk)("label",{class:"label"},"说明",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[9]||(n[9]=e=>ne.value=e),class:"input textarea",placeholder:"可选：写点说明（支持 2000 字以内）"},null,512),[[s.Jo,ne.value]])]),(0,r.Lk)("div",tu,[n[38]||(n[38]=(0,r.Lk)("label",{class:"label"},"标签",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[10]||(n[10]=e=>te.value=e),class:"input",placeholder:"可选：用逗号分隔，如：新手,爽文,慢热"},null,512),[[s.Jo,te.value]])]),(0,r.Lk)("div",au,[n[42]||(n[42]=(0,r.Lk)("label",{class:"label"},"内容",-1)),(0,r.Lk)("div",ru,["settings"===Z.value?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-secondary",onClick:se},[(0,r.bF)((0,i.R1)(ya.A),{size:14}),n[39]||(n[39]=(0,r.eW)(" 从本地读取设置 ",-1))])):(0,r.Q3)("v-if",!0),"prompts"===Z.value?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn btn-secondary",onClick:le},[(0,r.bF)((0,i.R1)(Jc.A),{size:14}),n[40]||(n[40]=(0,r.eW)(" 从本地导出提示词 ",-1))])):(0,r.Q3)("v-if",!0),(0,r.Lk)("label",ou,[(0,r.bF)((0,i.R1)(Zc),{size:14}),n[41]||(n[41]=(0,r.eW)(" 选择 JSON 文件 ",-1)),(0,r.Lk)("input",{type:"file",accept:".json,application/json",onChange:ie,hidden:""},null,32)]),re.value?((0,r.uX)(),(0,r.CE)("span",iu,[(0,r.bF)((0,i.R1)(Nc),{size:12}),(0,r.eW)(" "+(0,o.v_)(re.value),1)])):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",su,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:E},[(0,r.bF)((0,i.R1)(Xc),{size:16}),n[43]||(n[43]=(0,r.eW)(" 返回 ",-1))]),(0,r.Lk)("button",{class:"btn btn-primary",onClick:ce,disabled:oe.value},[oe.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(Oc),{key:1,size:16,class:"spin"})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(Wc.A),{key:0,size:16})),(0,r.eW)(" "+(0,o.v_)(oe.value?"上传中…":"上传到工坊"),1)],8,lu)])]))]))],64)):((0,r.uX)(),(0,r.CE)("div",hd,[(0,r.bF)((0,i.R1)(Bc),{size:48,class:"locked-icon"}),n[20]||(n[20]=(0,r.Lk)("p",null,"未配置后端服务器，创意工坊不可用",-1)),(0,r.Lk)("div",md,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:E},[(0,r.bF)((0,i.R1)(Xc),{size:16}),n[19]||(n[19]=(0,r.eW)(" 返回 ",-1))])])])),(0,r.Q3)(" 底部返回按钮 "),l.value&&"upload"!==v.value?((0,r.uX)(),(0,r.CE)("div",cu,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:E},[(0,r.bF)((0,i.R1)(Xc),{size:16}),n[44]||(n[44]=(0,r.eW)(" 返回 ",-1))])])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 详情弹窗 "),C.value.open?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(A,["self"])},[(0,r.Lk)("div",du,[(0,r.Lk)("div",uu,[(0,r.Lk)("h3",null,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(_[C.value.item?.type||"settings"]),{size:18})),(0,r.eW)(" "+(0,o.v_)(C.value.item?.title),1)]),(0,r.Lk)("button",{class:"close-btn",onClick:A},[(0,r.bF)((0,i.R1)(ed.A),{size:18})])]),(0,r.Lk)("div",pu,[(0,r.Lk)("div",vu,[(0,r.Lk)("div",fu,[n[45]||(n[45]=(0,r.Lk)("span",{class:"detail-label"},"类型",-1)),(0,r.Lk)("span",hu,[(0,r.Lk)("span",mu,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(_[C.value.item?.type||"settings"]),{size:12})),(0,r.eW)(" "+(0,o.v_)(w[C.value.item?.type||""]),1)])])]),(0,r.Lk)("div",gu,[n[46]||(n[46]=(0,r.Lk)("span",{class:"detail-label"},"作者",-1)),(0,r.Lk)("span",bu,[(0,r.bF)((0,i.R1)(Qc.A),{size:14}),(0,r.eW)(" "+(0,o.v_)(C.value.item?.author_name),1)])]),(0,r.Lk)("div",yu,[n[47]||(n[47]=(0,r.Lk)("span",{class:"detail-label"},"下载次数",-1)),(0,r.Lk)("span",xu,[(0,r.bF)((0,i.R1)(Vc.A),{size:14}),(0,r.eW)(" "+(0,o.v_)(C.value.item?.downloads),1)])]),C.value.item?.game_version?((0,r.uX)(),(0,r.CE)("div",ku,[n[48]||(n[48]=(0,r.Lk)("span",{class:"detail-label"},"游戏版本",-1)),(0,r.Lk)("span",wu,(0,o.v_)(C.value.item?.game_version),1)])):(0,r.Q3)("v-if",!0),C.value.item?.tags?.length?((0,r.uX)(),(0,r.CE)("div",_u,[n[49]||(n[49]=(0,r.Lk)("span",{class:"detail-label"},"标签",-1)),(0,r.Lk)("div",Cu,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(C.value.item?.tags,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"tag"},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("v-if",!0),C.value.item?.description?((0,r.uX)(),(0,r.CE)("div",Au,[n[50]||(n[50]=(0,r.Lk)("span",{class:"detail-label"},"说明",-1)),(0,r.Lk)("p",Su,(0,o.v_)(C.value.item?.description),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Lu,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:A},"关闭"),(0,r.Lk)("button",{class:"btn btn-primary",onClick:S},[(0,r.bF)((0,i.R1)(Vc.A),{size:16}),n[51]||(n[51]=(0,r.eW)(" 下载 ",-1))])])])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 下载/导入弹窗 "),U.value.open?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"modal-overlay",onClick:(0,s.D$)(q,["self"])},[(0,r.Lk)("div",Eu,[(0,r.Lk)("div",Tu,[(0,r.Lk)("h3",null,[(0,r.bF)((0,i.R1)(Vc.A),{size:18}),n[52]||(n[52]=(0,r.eW)(" 下载内容 ",-1))]),(0,r.Lk)("button",{class:"close-btn",onClick:q},[(0,r.bF)((0,i.R1)(ed.A),{size:18})])]),U.value.loading?((0,r.uX)(),(0,r.CE)("div",Iu,[(0,r.bF)((0,i.R1)(Oc),{size:24,class:"spin"}),n[53]||(n[53]=(0,r.Lk)("span",null,"加载中…",-1))])):((0,r.uX)(),(0,r.CE)("div",Ru,[(0,r.Lk)("div",Mu,[(0,r.Lk)("div",Pu,(0,o.v_)(U.value.item?.title),1),(0,r.Lk)("div",Du,[U.value.item?((0,r.uX)(),(0,r.CE)("span",zu,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(_[U.value.item.type]),{size:12})),(0,r.eW)(" "+(0,o.v_)(w[U.value.item.type]||U.value.item.type),1)])):(0,r.Q3)("v-if",!0),U.value.item?.author_name?((0,r.uX)(),(0,r.CE)("span",Nu,[(0,r.bF)((0,i.R1)(Qc.A),{size:12}),(0,r.eW)(" "+(0,o.v_)(U.value.item.author_name),1)])):(0,r.Q3)("v-if",!0),U.value.item?.game_version?((0,r.uX)(),(0,r.CE)("span",$u,(0,o.v_)(U.value.item.game_version),1)):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",Ou,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:H},[(0,r.bF)((0,i.R1)(nd),{size:16}),n[54]||(n[54]=(0,r.eW)(" 下载为文件 ",-1))]),"settings"===U.value.item?.type?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-primary",onClick:V},[(0,r.bF)((0,i.R1)(td),{size:16}),n[55]||(n[55]=(0,r.eW)(" 导入到本地设置 ",-1))])):(0,r.Q3)("v-if",!0),"prompts"===U.value.item?.type?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn btn-primary",onClick:Q},[(0,r.bF)((0,i.R1)(td),{size:16}),n[56]||(n[56]=(0,r.eW)(" 导入到本地提示词 ",-1))])):(0,r.Q3)("v-if",!0),"start_config"===U.value.item?.type?((0,r.uX)(),(0,r.CE)("button",{key:2,class:"btn btn-primary",onClick:K},[(0,r.bF)((0,i.R1)(td),{size:16}),n[57]||(n[57]=(0,r.eW)(" 应用到开局配置 ",-1))])):(0,r.Q3)("v-if",!0)]),"saves"===U.value.item?.type?((0,r.uX)(),(0,r.CE)("div",Fu,[(0,r.Lk)("div",ju,[n[59]||(n[59]=(0,r.Lk)("label",{class:"label"},"导入到单机角色",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":n[11]||(n[11]=e=>W.value=e),class:"input"},[n[58]||(n[58]=(0,r.Lk)("option",{value:""},"请选择角色",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Y.value,e=>((0,r.uX)(),(0,r.CE)("option",{key:e.角色ID,value:e.角色ID},(0,o.v_)(e.name),9,Bu))),128))],512),[[s.u1,W.value]])]),(0,r.Lk)("button",{class:"btn btn-primary",disabled:!W.value,onClick:J},[(0,r.bF)((0,i.R1)(td),{size:16}),n[60]||(n[60]=(0,r.eW)(" 导入存档 ",-1))],8,Xu)])):(0,r.Q3)("v-if",!0)]))])])):(0,r.Q3)("v-if",!0)]))}});var Wu=t(9399),qu={};qu.styleTagTransform=A(),qu.setAttributes=k(),qu.insert=y().bind(null,"head"),qu.domAPI=g(),qu.insertStyleElement=_(),h()(Wu.A,qu),Wu.A&&Wu.A.locals&&Wu.A.locals;const Gu=(0,E.A)(Uu,[["__scopeId","data-v-7e1e6f52"]]);var Hu=t(1184);const Vu=(0,I.A)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]);var Qu=t(2794);const Ku=(0,I.A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Yu=(0,I.A)("scroll",[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),Ju=(0,I.A)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),Zu=(0,I.A)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),ep=(0,I.A)("hammer",[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9",key:"1hayfq"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"15ts47"}]]),np=(0,I.A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),tp=(0,I.A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),ap=(0,I.A)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),rp=(0,I.A)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),op=(0,I.A)("swords",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]]),ip=(0,I.A)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var sp=t(1412),lp=t(4091);const cp=(0,I.A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),dp=(0,I.A)("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);var up=t(8133);const pp=(0,I.A)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),vp=(0,I.A)("users-round",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]),fp=new class{listeners=new Map;on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(n)}off(e,n){this.listeners.get(e)?.delete(n)}async emit(e,n){const t=Array.from(this.listeners.get(e)||[]);for(const e of t)await e(n)}};var hp=t(628);const mp=(0,I.A)("maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),gp=(0,I.A)("minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);function bp(e){if(!e)return"凡人";if("string"==typeof e)return e;const n=e.名称||e.name||"凡人",t=e.阶段||e.stage||"";return"凡人"===n||"Mortal"===n?"凡人":t?`${n}·${t}`:n}var yp=t(1040),xp=t(2456);const kp={class:"top-bar"},wp={class:"left-section"},_p={key:0,class:"game-title"},Cp={key:1,class:"game-title"},Ap={key:2,class:"character-quick-info"},Sp={class:"character-name"},Lp={class:"character-realm"},Ep={class:"center-section"},Tp={class:"location-time-info"},Ip={class:"location-text"},Rp=["title"],Mp={class:"region-label"},Pp={class:"region-value"},Dp={class:"time-value"},zp={class:"right-section"},Np=(0,r.pM)({__name:"TopBar",setup(e){const{t:n}=(0,l.s)(),t=(0,Hu.useGameStateStore)(),a=(0,i.KR)(!1),s=(0,r.EW)(()=>{try{return t.character?.名字||""}catch(e){return console.error("[TopBar] Error getting characterName:",e),""}}),c=(0,r.EW)(()=>{try{return bp(t.character?.觉醒阶段)}catch(e){return console.error("[TopBar] Error getting characterRealm:",e),n("凡人")}}),d=(0,r.EW)(()=>{try{return t.location?.描述||n("初始地")}catch(e){return console.error("[TopBar] Error getting currentLocation:",e),n("初始地")}}),u=(0,r.EW)(()=>{try{const e=t.location?.区域等级;if(e&&"string"==typeof e&&e.length>0)return e;const n=t.location?.灵气浓度,a="number"==typeof n?n:"string"==typeof n?Number.parseFloat(n):0;return a>=81?"黑区":a>=61?"红区":a>=41?"橙区":a>=21?"黄区":a>0?"绿区":""}catch(e){return""}}),p=(0,r.EW)(()=>{const e=u.value;return"黑区"===e?"level-black":"红区"===e?"level-red":"橙区"===e?"level-orange":"黄区"===e?"level-yellow":"绿区"===e?"level-green":""}),v=(0,r.EW)(()=>{const e=u.value;return"黑区"===e?n("禁区 - 极高威胁"):"红区"===e?n("高危 - 谨慎停留"):"橙区"===e?n("中高风险 - 需护卫"):"黄区"===e?n("中等风险 - 注意安全"):"绿区"===e?n("低风险 - 安全探索"):""}),f=(0,r.EW)(()=>{try{const e=t.gameTime;if(e){const t=(0,xp.l)(e),a=String(t.分钟??0).padStart(2,"0"),r=String(t.小时??0).padStart(2,"0"),o=String(t.月??1).padStart(2,"0"),i=String(t.日??1).padStart(2,"0");return`${n("纪元")}${t.年}${n("年")}${o}${n("月")}${i}${n("日")} ${r}:${a}`}return`${n("纪元")}${n("元年")}1${n("月")}1${n("日")} 00:00`}catch(e){return console.error("[TopBar] Error getting gameTime:",e),`${n("纪元")}${n("元年")}1${n("月")}1${n("日")} 00:00`}}),h=()=>{(0,yp.Kn)()?(0,yp.Eh)().catch(e=>{console.error((0,yp.zp)(e))}):(0,yp.lh)(document.documentElement).catch(e=>{console.error((0,yp.zp)(e))})};return(0,r.sV)(()=>{console.log("[TopBar] Component mounted");const e=()=>{a.value=!!(0,yp.Kn)()};document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e)}),(e,t)=>((0,r.uX)(),(0,r.CE)("div",kp,[(0,r.Lk)("div",wp,["混沌纪元"===(0,i.R1)(n)("混沌纪元")?((0,r.uX)(),(0,r.CE)("h1",_p,t[0]||(t[0]=[(0,r.Lk)("span",{class:"title-xian"},"混",-1),(0,r.Lk)("span",{class:"title-tu"},"沌纪元",-1)]))):((0,r.uX)(),(0,r.CE)("h1",Cp,(0,o.v_)((0,i.R1)(n)("混沌纪元")),1)),s.value?((0,r.uX)(),(0,r.CE)("div",Ap,[(0,r.Lk)("span",Sp,(0,o.v_)(s.value),1),(0,r.Lk)("span",Lp,(0,o.v_)(c.value),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Ep,[(0,r.Lk)("div",Tp,[(0,r.Lk)("span",Ip,(0,o.v_)(d.value),1),u.value?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,o.C4)(["region-level",p.value]),title:v.value},[t[1]||(t[1]=(0,r.Lk)("span",{class:"spirit-icon-wrapper"},[(0,r.Lk)("span",{class:"spirit-icon"},"✧"),(0,r.Lk)("span",{class:"spirit-glow"})],-1)),(0,r.Lk)("span",Mp,(0,o.v_)((0,i.R1)(n)("区域等级")),1),(0,r.Lk)("span",Pp,(0,o.v_)(u.value),1)],10,Rp)):(0,r.Q3)("v-if",!0),t[2]||(t[2]=(0,r.Lk)("span",{class:"separator"},"|",-1)),(0,r.Lk)("span",Dp,(0,o.v_)(f.value),1)])]),(0,r.Lk)("div",zp,[(0,r.Lk)("button",{onClick:h,class:"fullscreen-btn"},[a.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(gp),{key:1,size:16})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(mp),{key:0,size:16}))])])]))}});var $p=t(9964),Op={};Op.styleTagTransform=A(),Op.setAttributes=k(),Op.insert=y().bind(null,"head"),Op.domAPI=g(),Op.insertStyleElement=_(),h()($p.A,Op),$p.A&&$p.A.locals&&$p.A.locals;const Fp=(0,E.A)(Np,[["__scopeId","data-v-4fdabcba"]]),jp=(0,I.A)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),Bp=(0,I.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Xp=(0,I.A)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),Up=(0,I.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var Wp=t(5726);const qp={class:"sidebar-header"},Gp={class:"sidebar-title"},Hp={class:"real-time"},Vp={class:"sidebar-content"},Qp={class:"function-section"},Kp={class:"section-title"},Yp={class:"function-group"},Jp={class:"btn-icon"},Zp={class:"btn-content"},ev={class:"btn-text"},nv={class:"btn-desc"},tv={class:"btn-icon"},av={class:"btn-content"},rv={class:"btn-text"},ov={class:"btn-desc"},iv={class:"function-section"},sv={class:"section-title"},lv={class:"function-group"},cv={class:"btn-icon"},dv={class:"btn-content"},uv={class:"btn-text"},pv={class:"btn-desc"},vv={class:"function-section"},fv={class:"section-title"},hv={class:"function-group"},mv={class:"btn-icon"},gv={class:"btn-content"},bv={class:"btn-text"},yv={class:"btn-desc"},xv={class:"btn-icon"},kv={class:"btn-content"},wv={class:"btn-text"},_v={class:"btn-desc"},Cv={class:"btn-icon"},Av={class:"btn-content"},Sv={class:"btn-text"},Lv={class:"btn-desc"},Ev={class:"btn-icon"},Tv={class:"btn-content"},Iv={class:"btn-text"},Rv={class:"btn-desc"},Mv={class:"function-section"},Pv={class:"section-title"},Dv={class:"function-group"},zv={class:"btn-icon"},Nv={class:"btn-content"},$v={class:"btn-text"},Ov={class:"btn-desc"},Fv={class:"btn-icon"},jv={class:"btn-content"},Bv={class:"btn-text"},Xv={class:"btn-desc"},Uv={class:"btn-icon"},Wv={class:"btn-content"},qv={class:"btn-text"},Gv={class:"btn-desc"},Hv={class:"system-section"},Vv={class:"section-title"},Qv={class:"function-group"},Kv=["disabled"],Yv={class:"btn-icon"},Jv={class:"btn-content"},Zv={class:"btn-text"},ef={class:"btn-desc"},nf={class:"btn-icon"},tf={class:"btn-content"},af={class:"btn-text"},rf={class:"btn-desc"},of={class:"btn-icon"},sf={class:"btn-content"},lf={class:"btn-text"},cf={class:"btn-desc"},df={class:"btn-icon"},uf={class:"btn-content"},pf={class:"btn-text"},vf={class:"btn-desc"},ff={class:"btn-icon"},hf={class:"btn-content"},mf={class:"btn-text"},gf={class:"btn-desc"},bf={class:"btn-icon"},yf={class:"btn-content"},xf={class:"btn-text"},kf={class:"btn-desc"},wf={class:"btn-icon"},_f={class:"btn-content"},Cf={class:"btn-text"},Af={class:"btn-desc"},Sf={class:"btn-icon"},Lf={class:"btn-content"},Ef={class:"btn-text"},Tf={class:"btn-desc"},If={class:"sidebar-footer"},Rf={class:"app-version"},Mf={class:"footer-links"},Pf={class:"sponsor-modal"},Df={class:"sponsor-modal-header"},zf=(0,r.pM)({__name:"LeftSidebar",setup(e){const n=(0,a.rd)(),c=(0,Ec.useCharacterStore)(),d=(0,$.useUIStore)(),{t:u,currentLanguage:p}=(0,l.s)(),v=(0,i.KR)(!1),f=(0,i.KR)(!1),h=(0,i.KR)(null),m=(0,r.EW)(()=>v.value?h.value??"同步中":""),g=(0,i.KR)("");let b=null;const y=()=>{const e=new Date,n=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0"),i=e.getSeconds().toString().padStart(2,"0");g.value=`${n}-${t}-${a} ${r}:${o}:${i}`};(0,r.sV)(async()=>{if(y(),b=window.setInterval(y,1e3),(0,O.isBackendConfigured)()){const e=await(0,O.d9)();e&&(v.value=!0,h.value=e)}}),(0,r.hi)(()=>{b&&clearInterval(b)});const x=(0,r.EW)(()=>c.activeCharacterProfile),k=(0,r.EW)(()=>"联机"===x.value?.模式),w=(0,r.EW)(()=>"true"===localStorage.getItem("is_admin")),_=async()=>{n.push("/game/save")},C=()=>{n.push("/game/inventory")},A=()=>{n.push("/game/character-details")},S=()=>{n.push("/game/events")},L=()=>{n.push("/game/mutants")},E=()=>{n.push("/game/sect")},T=()=>{n.push("/game/relationships")},I=()=>{n.push("/game/crafting")},M=()=>{n.push("/game/memory")},D=()=>{n.push("/game/world-map")},z=()=>{n.push("/game/travel")},N=()=>{n.push("/game/prompts")},F=()=>{n.push("/game/settings")},j=()=>{n.push("/game/api-management")},B=()=>{n.push("/game/module-mapping")},X=()=>{n.push("/game/game-variables")},U=()=>{n.push("/game/backend-admin")},W=()=>{d.showRetryDialog({title:u("返回道途"),message:u("您想如何退出当前游戏？"),confirmText:u("保存并退出"),cancelText:u("取消"),neutralText:u("不保存直接退出"),onConfirm:async()=>{console.log("[返回道途] 用户选择保存并退出...");try{const{useGameStateStore:e}=await Promise.resolve().then(t.bind(t,1184)),n=e();await n.saveBeforeExit(),_e.o.success(u("游戏已保存"))}catch(e){console.error("[返回道途] 保存游戏失败:",e),_e.o.error(u("游戏保存失败，但仍会继续退出。"))}await q()},onNeutral:async()=>{console.log("[返回道途] 用户选择不保存直接退出..."),_e.o.info(u("游戏进度未保存")),await q()},onCancel:()=>{console.log("[返回道途] 用户取消操作")}})},q=async()=>{console.log("[返回道途] 准备返回主菜单"),c.rootState.当前激活存档=null,await c.commitMetadataToStorage(),console.log("[返回道途] 已重置激活存档状态"),d.stopLoading(),await n.push("/"),console.log("[返回道途] 已跳转至主菜单")};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",{class:(0,o.C4)(["left-sidebar",{"lang-en":"en"===(0,i.R1)(p)}])},[(0,r.Lk)("div",qp,[(0,r.Lk)("h3",Gp,[(0,r.bF)((0,i.R1)(jp),{size:20,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(u)("游戏功能")),1)]),(0,r.Lk)("div",Hp,[(0,r.bF)((0,i.R1)(Bp),{size:14,class:"time-icon"}),(0,r.Lk)("span",null,(0,o.v_)(g.value),1)])]),(0,r.Lk)("div",Vp,[(0,r.Q3)(" 角色信息区 "),(0,r.Lk)("div",Qp,[(0,r.Lk)("div",Kp,(0,o.v_)((0,i.R1)(u)("角色信息")),1),(0,r.Lk)("div",Yp,[(0,r.Lk)("button",{class:"function-btn primary",onClick:A},[(0,r.Lk)("div",Jp,[(0,r.bF)((0,i.R1)(R),{size:18})]),(0,r.Lk)("div",Zp,[(0,r.Lk)("span",ev,(0,o.v_)((0,i.R1)(u)("人物属性")),1),(0,r.Lk)("span",nv,(0,o.v_)((0,i.R1)(u)("觉醒阶段状态")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn primary",onClick:C},[(0,r.Lk)("div",tv,[(0,r.bF)((0,i.R1)(Hc),{size:18})]),(0,r.Lk)("div",av,[(0,r.Lk)("span",rv,(0,o.v_)((0,i.R1)(u)("背包物品")),1),(0,r.Lk)("span",ov,(0,o.v_)((0,i.R1)(u)("管理道具装备")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})])])]),(0,r.Q3)(" 进化系统区 "),(0,r.Lk)("div",iv,[(0,r.Lk)("div",sv,(0,o.v_)((0,i.R1)(u)("进化系统")),1),(0,r.Lk)("div",lv,[(0,r.Q3)(" 功法技能入口已移除 "),(0,r.Lk)("button",{class:"function-btn cultivation",onClick:I},[(0,r.Lk)("div",cv,[(0,r.bF)((0,i.R1)(ep),{size:18})]),(0,r.Lk)("div",dv,[(0,r.Lk)("span",uv,(0,o.v_)((0,i.R1)(u)("工坊制造")),1),(0,r.Lk)("span",pv,(0,o.v_)((0,i.R1)(u)("装备制造与合成")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})])])]),(0,r.Q3)(" 事件与探索区 "),(0,r.Lk)("div",vv,[(0,r.Lk)("div",fv,(0,o.v_)((0,i.R1)(u)("事件探索")),1),(0,r.Lk)("div",hv,[(0,r.Lk)("button",{class:"function-btn quest",onClick:S},[(0,r.Lk)("div",mv,[(0,r.bF)((0,i.R1)(Zu),{size:18})]),(0,r.Lk)("div",gv,[(0,r.Lk)("span",bv,(0,o.v_)((0,i.R1)(u)("世界事件")),1),(0,r.Lk)("span",yv,(0,o.v_)((0,i.R1)(u)("世界变革与危机")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn quest",onClick:L},[(0,r.Lk)("div",xv,[(0,r.bF)((0,i.R1)(Zu),{size:18})]),(0,r.Lk)("div",kv,[(0,r.Lk)("span",wv,(0,o.v_)((0,i.R1)(u)("突变生物")),1),(0,r.Lk)("span",_v,(0,o.v_)((0,i.R1)(u)("废土生物图鉴")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn quest",onClick:D},[(0,r.Lk)("div",Cv,[(0,r.bF)((0,i.R1)(Ju),{size:18})]),(0,r.Lk)("div",Av,[(0,r.Lk)("span",Sv,(0,o.v_)((0,i.R1)(u)("世界地图")),1),(0,r.Lk)("span",Lv,(0,o.v_)((0,i.R1)(u)("探索天下各地")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),k.value?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"function-btn quest",onClick:z},[(0,r.Lk)("div",Ev,[(0,r.bF)((0,i.R1)(lp.A),{size:18})]),(0,r.Lk)("div",Tv,[(0,r.Lk)("span",Iv,(0,o.v_)((0,i.R1)(u)("穿越")),1),(0,r.Lk)("span",Rv,(0,o.v_)((0,i.R1)(u)("进入他人世界")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})])):(0,r.Q3)("v-if",!0)])]),(0,r.Q3)(" 社交势力区 "),(0,r.Lk)("div",Mv,[(0,r.Lk)("div",Pv,(0,o.v_)((0,i.R1)(u)("社交势力")),1),(0,r.Lk)("div",Dv,[(0,r.Lk)("button",{class:"function-btn secondary",onClick:T},[(0,r.Lk)("div",zv,[(0,r.bF)((0,i.R1)(P),{size:18})]),(0,r.Lk)("div",Nv,[(0,r.Lk)("span",$v,(0,o.v_)((0,i.R1)(u)("人物关系")),1),(0,r.Lk)("span",Ov,(0,o.v_)((0,i.R1)(u)("人脉交际管理")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn secondary",onClick:E},[(0,r.Lk)("div",Fv,[(0,r.bF)((0,i.R1)(np),{size:18})]),(0,r.Lk)("div",jv,[(0,r.Lk)("span",Bv,(0,o.v_)((0,i.R1)(u)("势力")),1),(0,r.Lk)("span",Xv,(0,o.v_)((0,i.R1)(u)("势力事务管理")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn secondary",onClick:M},[(0,r.Lk)("div",Uv,[(0,r.bF)((0,i.R1)(Vu),{size:18})]),(0,r.Lk)("div",Wv,[(0,r.Lk)("span",qv,(0,o.v_)((0,i.R1)(u)("记忆")),1),(0,r.Lk)("span",Gv,(0,o.v_)((0,i.R1)(u)("重要事件回顾")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})])])]),n[3]||(n[3]=(0,r.Lk)("div",{class:"divider"},null,-1)),(0,r.Q3)(" 系统功能区 "),(0,r.Lk)("div",Hv,[(0,r.Lk)("div",Vv,(0,o.v_)((0,i.R1)(u)("系统功能")),1),(0,r.Lk)("div",Qv,[(0,r.Lk)("button",{class:"function-btn system",onClick:_,disabled:!x.value},[(0,r.Lk)("div",Yv,[(0,r.bF)((0,i.R1)(Pc.A),{size:18})]),(0,r.Lk)("div",Jv,[(0,r.Lk)("span",Zv,(0,o.v_)((0,i.R1)(u)("保存游戏")),1),(0,r.Lk)("span",ef,(0,o.v_)((0,i.R1)(u)("保存当前进度")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})],8,Kv),k.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"function-btn system",onClick:X},[(0,r.Lk)("div",nf,[(0,r.bF)((0,i.R1)(ip),{size:18})]),(0,r.Lk)("div",tf,[(0,r.Lk)("span",af,(0,o.v_)((0,i.R1)(u)("游戏变量")),1),(0,r.Lk)("span",rf,(0,o.v_)((0,i.R1)(u)("查看游戏数据")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})])),(0,r.Lk)("button",{class:"function-btn system",onClick:N},[(0,r.Lk)("div",of,[(0,r.bF)((0,i.R1)(Jc.A),{size:18})]),(0,r.Lk)("div",sf,[(0,r.Lk)("span",lf,(0,o.v_)((0,i.R1)(u)("提示词管理")),1),(0,r.Lk)("span",cf,(0,o.v_)((0,i.R1)(u)("自定义提示词")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn system",onClick:j},[(0,r.Lk)("div",df,[(0,r.bF)((0,i.R1)(sp.A),{size:18})]),(0,r.Lk)("div",uf,[(0,r.Lk)("span",pf,(0,o.v_)((0,i.R1)(u)("API管理")),1),(0,r.Lk)("span",vf,(0,o.v_)((0,i.R1)(u)("多API配置")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn system",onClick:B},[(0,r.Lk)("div",ff,[(0,r.bF)((0,i.R1)(Xp),{size:18})]),(0,r.Lk)("div",hf,[(0,r.Lk)("span",mf,(0,o.v_)((0,i.R1)(u)("模块自定义")),1),(0,r.Lk)("span",gf,(0,o.v_)((0,i.R1)(u)("自定义修仙模块")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),(0,r.Lk)("button",{class:"function-btn system",onClick:F},[(0,r.Lk)("div",bf,[(0,r.bF)((0,i.R1)(ya.A),{size:18})]),(0,r.Lk)("div",yf,[(0,r.Lk)("span",xf,(0,o.v_)((0,i.R1)(u)("系统设置")),1),(0,r.Lk)("span",kf,(0,o.v_)((0,i.R1)(u)("偏好设置")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})]),w.value?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"function-btn admin",onClick:U},[(0,r.Lk)("div",wf,[(0,r.bF)((0,i.R1)(cp),{size:18})]),(0,r.Lk)("div",_f,[(0,r.Lk)("span",Cf,(0,o.v_)((0,i.R1)(u)("管理员后台")),1),(0,r.Lk)("span",Af,(0,o.v_)((0,i.R1)(u)("管理员控制台")),1)]),(0,r.bF)((0,i.R1)(Yc),{size:14,class:"btn-arrow"})])):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{class:"function-btn exit-btn no-arrow",onClick:W},[(0,r.Lk)("div",Sf,[(0,r.bF)((0,i.R1)(Up),{size:18})]),(0,r.Lk)("div",Lf,[(0,r.Lk)("span",Ef,(0,o.v_)((0,i.R1)(u)("返回道途")),1),(0,r.Lk)("span",Tf,(0,o.v_)((0,i.R1)(u)("退出当前游戏")),1)])])])])]),(0,r.Q3)(" 版本号显示 "),(0,r.Lk)("div",If,[(0,r.Lk)("span",Rf,"V"+(0,o.v_)(m.value),1),(0,r.Lk)("div",Mf,[n[4]||(n[4]=(0,r.Lk)("a",{href:"https://github.com/qianye60/XianTu",target:"_blank",class:"footer-link github",title:"GitHub"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"currentColor"},[(0,r.Lk)("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})])],-1)),(0,r.Lk)("button",{type:"button",class:"footer-link sponsor",title:"赞助支持",onClick:n[0]||(n[0]=e=>f.value=!0)},[(0,r.bF)((0,i.R1)(Wp.A),{size:14})])])]),((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[f.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"sponsor-modal-overlay",onClick:n[2]||(n[2]=(0,s.D$)(e=>f.value=!1,["self"]))},[(0,r.Lk)("div",Pf,[(0,r.Lk)("div",Df,[n[5]||(n[5]=(0,r.Lk)("h3",null,"赞助支持（自愿）",-1)),(0,r.Lk)("button",{class:"sponsor-close",onClick:n[1]||(n[1]=e=>f.value=!1)},"×")]),n[6]||(n[6]=(0,r.Lk)("div",{class:"sponsor-modal-body"},[(0,r.Lk)("div",{class:"sponsor-qr"},[(0,r.Lk)("img",{src:"https://ddct.top/zhifubao.jpg",alt:"支付宝赞助二维码",loading:"lazy"}),(0,r.Lk)("span",null,"支付宝")]),(0,r.Lk)("div",{class:"sponsor-qr"},[(0,r.Lk)("img",{src:"https://ddct.top/weixing.jpg",alt:"微信赞助二维码",loading:"lazy"}),(0,r.Lk)("span",null,"微信")])],-1))])])):(0,r.Q3)("v-if",!0)]))],2))}});var Nf=t(5815),$f={};$f.styleTagTransform=A(),$f.setAttributes=k(),$f.insert=y().bind(null,"head"),$f.domAPI=g(),$f.insertStyleElement=_(),h()(Nf.A,$f),Nf.A&&Nf.A.locals&&Nf.A.locals;const Of=(0,E.A)(zf,[["__scopeId","data-v-216cae6e"]]),Ff=(0,I.A)("droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),jf=(0,I.A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var Bf=t(8275);const Xf={class:"status-detail-card"},Uf={class:"type-icon"},Wf={class:"type-text"},qf={class:"card-body"},Gf={class:"details-grid"},Hf={key:0,class:"detail-item"},Vf={class:"item-value source"},Qf={key:1,class:"detail-item"},Kf={class:"item-value strength"},Yf={class:"strength-value"},Jf={class:"strength-bar"},Zf={key:2,class:"detail-item"},eh={class:"item-value duration"},nh={key:3,class:"detail-item"},th={class:"item-value time"},ah=(0,r.pM)({__name:"StatusDetailCard",props:{effect:{}},setup(e){const n=e,t=(0,r.EW)(()=>"buff"===String(n.effect.类型).toLowerCase()),a=(0,r.EW)(()=>{const e=n.effect.强度||0;return e>=80?"极强":e>=60?"强":e>=40?"中等":e>=20?"一般":"轻微"}),i=(0,r.EW)(()=>{const e=n.effect.强度||0;return e>=80?"#ef4444":e>=60?"#f59e0b":e>=40?"#3b82f6":e>=20?"#10b981":"#6b7280"}),s=(0,r.EW)(()=>{const e=n.effect.持续时间分钟;if(null==e)return"";if(99999===e)return"永久";if(e>=1440)return`${Math.floor(e/1440)}天`;if(e>=60){const n=Math.floor(e/60),t=e%60;return t>0?`${n}时${t}分`:`${n}时`}return`${e}分钟`});return(e,n)=>{return(0,r.uX)(),(0,r.CE)("div",Xf,[(0,r.Lk)("div",{class:(0,o.C4)(["card-header",t.value?"buff":"debuff"])},[(0,r.Lk)("span",Uf,(0,o.v_)(t.value?"+":"-"),1),(0,r.Lk)("span",Wf,(0,o.v_)(t.value?"增益状态":"负面状态"),1)],2),(0,r.Lk)("div",qf,[(0,r.Lk)("div",{class:(0,o.C4)(["description",t.value?"buff-border":"debuff-border"])},(0,o.v_)(e.effect.状态描述||`${e.effect.状态名称}状态生效中`),3),(0,r.Lk)("div",Gf,[e.effect.来源?((0,r.uX)(),(0,r.CE)("div",Hf,[n[0]||(n[0]=(0,r.Lk)("div",{class:"item-label"},"来源",-1)),(0,r.Lk)("div",Vf,(0,o.v_)(e.effect.来源),1)])):(0,r.Q3)("v-if",!0),e.effect.强度?((0,r.uX)(),(0,r.CE)("div",Qf,[n[1]||(n[1]=(0,r.Lk)("div",{class:"item-label"},"效果强度",-1)),(0,r.Lk)("div",Kf,[(0,r.Lk)("span",{class:"strength-text",style:(0,o.Tr)({color:i.value})},(0,o.v_)(a.value),5),(0,r.Lk)("span",Yf,"("+(0,o.v_)(e.effect.强度)+"/100)",1)]),(0,r.Lk)("div",Jf,[(0,r.Lk)("div",{class:"bar-fill",style:(0,o.Tr)({width:`${Math.min(e.effect.强度,100)}%`,backgroundColor:i.value})},null,4)])])):(0,r.Q3)("v-if",!0),s.value?((0,r.uX)(),(0,r.CE)("div",Zf,[n[2]||(n[2]=(0,r.Lk)("div",{class:"item-label"},"持续时间",-1)),(0,r.Lk)("div",eh,(0,o.v_)(s.value),1)])):(0,r.Q3)("v-if",!0),e.effect.生成时间?((0,r.uX)(),(0,r.CE)("div",nh,[n[3]||(n[3]=(0,r.Lk)("div",{class:"item-label"},"生成时间",-1)),(0,r.Lk)("div",th,(0,o.v_)((l=e.effect.生成时间,l?`${l.年}年${l.月}月${l.日}日 ${String(l.小时).padStart(2,"0")}:${String(l.分钟).padStart(2,"0")}`:"")),1)])):(0,r.Q3)("v-if",!0)])])]);var l}}});var rh=t(7807),oh={};oh.styleTagTransform=A(),oh.setAttributes=k(),oh.insert=y().bind(null,"head"),oh.domAPI=g(),oh.insertStyleElement=_(),h()(rh.A,oh),rh.A&&rh.A.locals&&rh.A.locals;const ih=(0,E.A)(ah,[["__scopeId","data-v-627cf7f9"]]);var sh=t(6939),lh=t(6728),ch=t(3943);const dh={class:"right-sidebar"},uh={class:"sidebar-header"},ph={class:"sidebar-title"},vh={key:0,class:"sidebar-content"},fh={class:"vitals-section"},hh={class:"section-title"},mh={class:"vitals-list"},gh={class:"vital-item"},bh={class:"vital-info"},yh={class:"vital-name"},xh={class:"vital-text"},kh={class:"progress-bar"},wh={class:"vital-item"},_h={class:"vital-info"},Ch={class:"vital-name"},Ah={class:"vital-text"},Sh={class:"progress-bar"},Lh={class:"vital-item"},Eh={class:"vital-info"},Th={class:"vital-name"},Ih={class:"vital-text"},Rh={class:"progress-bar"},Mh={class:"vital-item"},Ph={class:"vital-info"},Dh={class:"vital-name"},zh={class:"vital-text"},Nh={class:"progress-bar"},$h={class:"vital-item"},Oh={class:"vital-info"},Fh={class:"vital-name"},jh={class:"vital-text"},Bh={class:"progress-bar"},Xh={class:"vitals-section"},Uh={class:"section-title"},Wh={class:"vitals-list compact"},qh={class:"vital-item compact"},Gh={class:"vital-info"},Hh={class:"vital-name"},Vh={class:"vital-text"},Qh={class:"vital-item compact"},Kh={class:"vital-info"},Yh={class:"vital-name"},Jh={class:"vital-text"},Zh={class:"vital-item compact"},em={class:"vital-info"},nm={class:"vital-name"},tm={class:"vital-text"},am={class:"vital-item compact"},rm={class:"vital-info"},om={class:"vital-name"},im={class:"vital-text"},sm={class:"collapsible-section ability-section"},lm={class:"section-title"},cm={class:"ability-content"},dm={key:0,class:"ability-card"},um={class:"ability-header"},pm={class:"ability-name"},vm={class:"ability-type"},fm={class:"ability-description"},hm={key:0,class:"ability-costs"},mm={class:"costs-title"},gm={class:"cost-list"},bm={class:"cost-item"},ym={class:"cost-resource"},xm={class:"ability-actions"},km={key:1,class:"empty-ability"},wm={class:"empty-text"},_m={class:"cultivation-section"},Cm={class:"section-title"},Am={class:"realm-display"},Sm={class:"realm-info"},Lm={class:"realm-name"},Em={class:"reputation-display"},Tm={class:"reputation-item"},Im={class:"reputation-info"},Rm={class:"reputation-label"},Mm={class:"collapsible-section talents-section"},Pm={class:"section-title"},Dm={class:"talents-list"},zm=["onClick"],Nm={class:"talent-header"},$m={class:"talent-name"},Om={key:0,class:"empty-talents"},Fm={class:"empty-text"},jm={class:"collapsible-section status-section"},Bm={class:"section-title"},Xm={class:"status-effects"},Um={key:0,class:"empty-status"},Wm={class:"empty-text"},qm={key:1,class:"status-tags-container"},Gm=["onClick","title"],Hm={class:"tag-icon"},Vm={class:"tag-name"},Qm={key:0,class:"tag-intensity"},Km={key:1,class:"tag-time"},Ym={class:"no-character"},Jm={class:"no-char-text"},Zm=(0,r.pM)({__name:"RightSidebar",setup(e){const{t:n}=(0,l.s)(),t=(0,Hu.useGameStateStore)(),a=(0,$.useUIStore)(),c=(0,r.EW)(()=>t.isGameLoaded&&!!t.character),d=(0,r.EW)(()=>t.character),u=(0,r.EW)(()=>t.attributes),p=(0,r.EW)(()=>{const e=t.effects||[],n=t.gameTime;return e.filter(e=>{if(!e||"object"!=typeof e||!("状态名称"in e))return!1;if(!n)return!0;try{return!(0,ch.Bj)(e,n)}catch{return!0}})}),v=(0,r.EW)(()=>{const e=d.value?.出生日期,n=t.gameTime;return e&&n?(0,sh.R5)(e,n):t.attributes?.寿命?.当前||0}),f=(0,i.KR)(!1),h=(0,i.KR)(!1),m=(0,i.KR)(!1),g=(0,r.EW)(()=>{try{const e=t.getCurrentSaveData(),n=e?(0,lh.Ew)(e):{STR:0,AGI:0,CON:0,WIL:0,CHA:0,LCK:0},a=x.value,r=e?.角色?.装备||{},o=e?.角色?.背包||{},i=(0,lh.FY)(r,o),s=(0,lh.Nz)(n,a,{equipmentDerivedBonuses:i}),l=t.attributes||(e?.角色?.属性??{}),c=(e,n)=>{const t="number"==typeof e?e:Number(e??0),a="number"==typeof n?n:Number(n??0);return Number.isFinite(t)?!Number.isFinite(a)||a<=0?Math.max(0,t):Math.max(0,Math.min(t,a)):0};return{生命值:{当前:c(l?.生命值?.当前,s.HP.上限),上限:s.HP.上限},精神力:{当前:c(l?.精神力?.当前,s.SP.上限),上限:s.SP.上限},体力:{当前:c(l?.体力?.当前,s.ST.上限),上限:s.ST.上限},理智值:{当前:c(l?.理智值?.当前,s.SAN.上限),上限:s.SAN.上限}}}catch{return{生命值:{当前:0,上限:0},精神力:{当前:0,上限:0},体力:{当前:0,上限:0},理智值:{当前:0,上限:0}}}}),b=e=>{const n=g.value[e];return n?.当前&&n?.上限?Math.round(n.当前/n.上限*100):0},y=()=>{const e=t.attributes?.寿命?.上限;return e?Math.round(v.value/e*100):0},x=(0,r.EW)(()=>{const e=d.value?.觉醒阶段;return"string"==typeof e&&e.trim()?e:"凡人"}),k=(0,r.EW)(()=>{try{const e=t.getCurrentSaveData(),n=e?(0,lh.Ew)(e):{STR:0,AGI:0,CON:0,WIL:0,CHA:0,LCK:0},a=x.value;return(0,lh._p)(n,a,{})}catch{return{physAtk:0,specAtk:0,physDef:0,specDef:0}}}),w=(0,r.EW)(()=>{const e=d.value;if(!e)return null;const n=e?.异能名称,t=e?.异能类型,a=e?.异能描述,r=e?.异能代价;return n||t||a||r?{name:n,type:t,description:a,costText:r}:null}),_=async()=>{const e=w.value;if(!e||!e.name)return;const n=t.toSaveData();n&&((0,ch.uJ)(n,e.name,{类型:"buff",持续时间分钟:60,状态描述:e.description||"异能效果",来源:"异能",属性加成:{意志:2}}),t.loadFromSaveData(n))},C=()=>{const e=u.value?.声望;if(null==e)return"籍籍无名";const n=Number(e);return n<0?n<=-5e3?`恶名昭彰 (${n})`:n<=-1e3?`臭名远扬 (${n})`:n<=-500?`声名狼藉 (${n})`:n<=-100?`恶名在外 (${n})`:`小有恶名 (${n})`:n>=1e4?`传说人物 (${n})`:n>=5e3?`名满天下 (${n})`:n>=3e3?`威震四方 (${n})`:n>=1e3?`名动一方 (${n})`:n>=500?`声名远播 (${n})`:n>=100?`小有名气 (${n})`:"籍籍无名"},A=()=>{const e=u.value?.声望;if(null==e)return"reputation-neutral";const n=Number(e);return n<0?n<=-5e3?"reputation-evil-legendary":n<=-1e3?"reputation-evil-high":n<=-500?"reputation-evil-medium":n<=-100?"reputation-evil-low":"reputation-evil-minor":n>=1e4?"reputation-legendary":n>=5e3?"reputation-famous":n>=3e3?"reputation-renowned":n>=1e3?"reputation-notable":n>=500?"reputation-known":n>=100?"reputation-minor":"reputation-neutral"};return(e,l)=>((0,r.uX)(),(0,r.CE)("div",dh,[(0,r.Lk)("div",uh,[(0,r.Lk)("h3",ph,[(0,r.bF)((0,i.R1)(R),{size:18,class:"title-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("角色状态")),1)])]),c.value&&d.value?((0,r.uX)(),(0,r.CE)("div",vh,[(0,r.Q3)(" 核心数值 "),(0,r.Lk)("div",fh,[(0,r.Lk)("h3",hh,[(0,r.bF)((0,i.R1)(Wp.A),{size:14,class:"section-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("核心数值")),1)]),(0,r.Lk)("div",mh,[(0,r.Lk)("div",gh,[(0,r.Lk)("div",bh,[(0,r.Lk)("span",yh,[(0,r.bF)((0,i.R1)(Ff),{size:12,class:"vital-icon blood"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("生命值")),1)]),(0,r.Lk)("span",xh,(0,o.v_)(g.value.生命值?.当前)+" / "+(0,o.v_)(g.value.生命值?.上限),1)]),(0,r.Lk)("div",kh,[(0,r.Lk)("div",{class:"progress-fill health",style:(0,o.Tr)({width:b("生命值")+"%"})},null,4)])]),(0,r.Lk)("div",wh,[(0,r.Lk)("div",_h,[(0,r.Lk)("span",Ch,[(0,r.bF)((0,i.R1)(z),{size:12,class:"vital-icon mana"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("精神力")),1)]),(0,r.Lk)("span",Ah,(0,o.v_)(g.value.精神力?.当前)+" / "+(0,o.v_)(g.value.精神力?.上限),1)]),(0,r.Lk)("div",Sh,[(0,r.Lk)("div",{class:"progress-fill mana",style:(0,o.Tr)({width:b("精神力")+"%"})},null,4)])]),(0,r.Lk)("div",Lh,[(0,r.Lk)("div",Eh,[(0,r.Lk)("span",Th,[(0,r.bF)((0,i.R1)(Vu),{size:12,class:"vital-icon spirit"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("体力")),1)]),(0,r.Lk)("span",Ih,(0,o.v_)(g.value.体力?.当前)+" / "+(0,o.v_)(g.value.体力?.上限),1)]),(0,r.Lk)("div",Rh,[(0,r.Lk)("div",{class:"progress-fill spirit",style:(0,o.Tr)({width:b("体力")+"%"})},null,4)])]),(0,r.Lk)("div",Mh,[(0,r.Lk)("div",Ph,[(0,r.Lk)("span",Dh,[(0,r.bF)((0,i.R1)(Vu),{size:12,class:"vital-icon spirit"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("理智值")),1)]),(0,r.Lk)("span",zh,(0,o.v_)(g.value.理智值?.当前)+" / "+(0,o.v_)(g.value.理智值?.上限),1)]),(0,r.Lk)("div",Nh,[(0,r.Lk)("div",{class:"progress-fill spirit",style:(0,o.Tr)({width:b("理智值")+"%"})},null,4)])]),(0,r.Lk)("div",$h,[(0,r.Lk)("div",Oh,[(0,r.Lk)("span",Fh,[(0,r.bF)((0,i.R1)(Bp),{size:12,class:"vital-icon lifespan"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("寿命")),1)]),(0,r.Lk)("span",jh,(0,o.v_)(v.value)+" / "+(0,o.v_)(u.value?.寿命?.上限),1)]),(0,r.Lk)("div",Bh,[(0,r.Lk)("div",{class:"progress-fill lifespan",style:(0,o.Tr)({width:y()+"%"})},null,4)])])])]),(0,r.Q3)(" 攻防数值 "),(0,r.Lk)("div",Xh,[(0,r.Lk)("h3",Uh,[(0,r.bF)((0,i.R1)(Ku),{size:14,class:"section-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("攻防数值")),1)]),(0,r.Lk)("div",Wh,[(0,r.Lk)("div",qh,[(0,r.Lk)("div",Gh,[(0,r.Lk)("span",Hh,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("物理攻")),1)]),(0,r.Lk)("span",Vh,(0,o.v_)(k.value.physAtk),1)])]),(0,r.Lk)("div",Qh,[(0,r.Lk)("div",Kh,[(0,r.Lk)("span",Yh,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("特殊攻")),1)]),(0,r.Lk)("span",Jh,(0,o.v_)(k.value.specAtk),1)])]),(0,r.Lk)("div",Zh,[(0,r.Lk)("div",em,[(0,r.Lk)("span",nm,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("物理防")),1)]),(0,r.Lk)("span",tm,(0,o.v_)(k.value.physDef),1)])]),(0,r.Lk)("div",am,[(0,r.Lk)("div",rm,[(0,r.Lk)("span",om,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("特殊防")),1)]),(0,r.Lk)("span",im,(0,o.v_)(k.value.specDef),1)])])])]),(0,r.Lk)("div",sm,[(0,r.Lk)("div",{class:"section-header",onClick:l[0]||(l[0]=e=>m.value=!m.value)},[(0,r.Lk)("h3",lm,[(0,r.bF)((0,i.R1)(z),{size:14,class:"section-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("当前异能")),1)]),(0,r.Lk)("button",{class:(0,o.C4)(["collapse-toggle",{collapsed:m.value}])},l[3]||(l[3]=[(0,r.Lk)("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"currentColor"},[(0,r.Lk)("path",{d:"M8 10l4-4H4l4 4z"})],-1)]),2)]),(0,r.bo)((0,r.Lk)("div",cm,[w.value?((0,r.uX)(),(0,r.CE)("div",dm,[(0,r.Lk)("div",um,[(0,r.Lk)("span",pm,(0,o.v_)(w.value.name),1),(0,r.Lk)("span",vm,(0,o.v_)(w.value.type),1)]),(0,r.Lk)("div",fm,(0,o.v_)(w.value.description),1),w.value.costText?((0,r.uX)(),(0,r.CE)("div",hm,[(0,r.Lk)("div",mm,(0,o.v_)((0,i.R1)(n)("异能代价")),1),(0,r.Lk)("div",gm,[(0,r.Lk)("div",bm,[(0,r.Lk)("span",ym,(0,o.v_)(w.value.costText),1)])])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",xm,[(0,r.Lk)("button",{class:"collapse-toggle",onClick:_},(0,o.v_)((0,i.R1)(n)("施展异能")),1)])])):((0,r.uX)(),(0,r.CE)("div",km,[(0,r.Lk)("div",wm,(0,o.v_)((0,i.R1)(n)("暂无异能")),1)]))],512),[[s.aG,!m.value]])]),(0,r.Q3)(" 觉醒阶段 "),(0,r.Lk)("div",_m,[(0,r.Lk)("h3",Cm,[(0,r.bF)((0,i.R1)(jf),{size:14,class:"section-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("觉醒阶段")),1)]),(0,r.Lk)("div",Am,[(0,r.Lk)("div",Sm,[(0,r.Lk)("span",Lm,(0,o.v_)(x.value),1)])]),(0,r.Q3)(" 声望显示 "),(0,r.Lk)("div",Em,[(0,r.Lk)("div",Tm,[(0,r.Lk)("div",Im,[(0,r.Lk)("span",Rm,[(0,r.bF)((0,i.R1)(jf),{size:12,class:"vital-icon reputation"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("声望")),1)]),(0,r.Lk)("span",{class:(0,o.C4)(["reputation-value",A()])},(0,o.v_)(C()),3)])])])]),(0,r.Q3)(" 天赋特性 "),(0,r.Lk)("div",Mm,[(0,r.Lk)("div",{class:"section-header",onClick:l[1]||(l[1]=e=>f.value=!f.value)},[(0,r.Lk)("h3",Pm,[(0,r.bF)((0,i.R1)(jf),{size:14,class:"section-icon gold"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("天赋特性")),1)]),(0,r.Lk)("button",{class:(0,o.C4)(["collapse-toggle",{collapsed:f.value}])},l[4]||(l[4]=[(0,r.Lk)("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"currentColor"},[(0,r.Lk)("path",{d:"M8 10l4-4H4l4 4z"})],-1)]),2)]),(0,r.bo)((0,r.Lk)("div",Dm,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.value.天赋,e=>((0,r.uX)(),(0,r.CE)("div",{key:"string"==typeof e?e:e.name,class:"talent-card clickable",onClick:n=>(e=>{const n=d.value,t=n?.天赋?.find(n=>n.name===e),r=ze.qS.find(n=>n.name===e),o=(t?{description:t.description||"自定义天赋"}:r?{description:r.description||""}:{description:`天赋《${e}》的详细描述暂未开放，请期待后续更新。`}).description;a.showDetailModal({title:e,content:o})})("string"==typeof e?e:e.name)},[(0,r.Lk)("div",Nm,[(0,r.Lk)("span",$m,(0,o.v_)("string"==typeof e?e:e.name),1)])],8,zm))),128)),(0,r.Q3)(" 空状态显示 "),d.value.天赋&&0!==d.value.天赋.length?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",Om,[(0,r.Lk)("div",Fm,(0,o.v_)((0,i.R1)(n)("暂无天赋")),1)]))],512),[[s.aG,!f.value]])]),(0,r.Q3)(" 状态效果 "),(0,r.Lk)("div",jm,[(0,r.Lk)("div",{class:"section-header",onClick:l[2]||(l[2]=e=>h.value=!h.value)},[(0,r.Lk)("h3",Bm,[(0,r.bF)((0,i.R1)(Ku),{size:14,class:"section-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("状态效果")),1)]),(0,r.Lk)("button",{class:(0,o.C4)(["collapse-toggle",{collapsed:h.value}])},l[5]||(l[5]=[(0,r.Lk)("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"currentColor"},[(0,r.Lk)("path",{d:"M8 10l4-4H4l4 4z"})],-1)]),2)]),(0,r.bo)((0,r.Lk)("div",Xm,[0===p.value.length?((0,r.uX)(),(0,r.CE)("div",Um,[(0,r.Lk)("span",Wm,(0,o.v_)((0,i.R1)(n)("清净无为")),1)])):((0,r.uX)(),(0,r.CE)("div",qm,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(p.value,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:e.状态名称||`effect-${s}`,class:(0,o.C4)(["status-tag clickable",["buff"===String(e.类型||"").toLowerCase()?"buff":"debuff"]]),onClick:n=>(e=>{e&&e.状态名称?a.showDetailModal({title:e.状态名称,component:ih,props:{effect:e}}):console.warn("[RightSidebar] 状态效果数据异常，无法显示详情",e)})(e),title:`${e.状态名称||"未知状态"}${e.状态描述?`\n${e.状态描述}`:""}${e.强度?`\n强度: ${e.强度}`:""}${(0,i.R1)(t).gameTime?`\n${(0,i.R1)(ch.QS)((0,i.R1)(ch.E0)(e,(0,i.R1)(t).gameTime))}`:""}`},[(0,r.Lk)("span",Hm,(0,o.v_)("buff"===String(e.类型||"").toLowerCase()?(0,i.R1)(n)("增"):(0,i.R1)(n)("减")),1),(0,r.Lk)("span",Vm,(0,o.v_)(e.状态名称||"未知状态"),1),e.强度?((0,r.uX)(),(0,r.CE)("span",Qm,(0,o.v_)(e.强度),1)):(0,r.Q3)("v-if",!0),(0,i.R1)(t).gameTime?((0,r.uX)(),(0,r.CE)("span",Km,(0,o.v_)((0,i.R1)(ch.QS)((0,i.R1)(ch.E0)(e,(0,i.R1)(t).gameTime))),1)):(0,r.Q3)("v-if",!0)],10,Gm))),128))]))],512),[[s.aG,!h.value]])])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 无角色数据 "),(0,r.Lk)("div",Ym,[(0,r.Lk)("div",Jm,(0,o.v_)((0,i.R1)(n)("请选择角色进入混沌纪元")),1)])],2112)),(0,r.Q3)(" 详情模态框 "),(0,r.bF)(Bf.A)]))}});var eg=t(9785),ng={};ng.styleTagTransform=A(),ng.setAttributes=k(),ng.insert=y().bind(null,"head"),ng.domAPI=g(),ng.insertStyleElement=_(),h()(eg.A,ng),eg.A&&eg.A.locals&&eg.A.locals;const tg=(0,E.A)(Zm,[["__scopeId","data-v-cdf5768e"]]),ag={class:"hexagon-chart-container"},rg=["width","height","viewBox"],og=["transform"],ig=["points"],sg=["x2","y2"],lg=["points"],cg=["cx","cy"],dg=["x","y","text-anchor","dominant-baseline"],ug=["x","y","text-anchor","dominant-baseline"],pg=(0,r.pM)({__name:"HexagonChart",props:{stats:{},size:{default:160},maxValue:{default:10}},setup(e){const{t:n}=(0,l.s)(),t=e,a=(0,r.EW)(()=>t.size/2),i=(0,r.EW)(()=>t.size/2*.7),s=["strength","agility","constitution","willpower","charm","luck"],c={strength:n("力量"),agility:n("敏捷"),constitution:n("体质"),willpower:n("意志"),charm:n("魅力"),luck:n("幸运")},d=(e=1)=>{const n=[];for(let t=0;t<6;t++){const a=Math.PI/2+Math.PI/3*t,r=Math.cos(a)*i.value*e,o=-Math.sin(a)*i.value*e;n.push(`${r.toFixed(2)},${o.toFixed(2)}`)}return n.join(" ")},u=(0,r.EW)(()=>s.map((e,n)=>{const a=t.stats[e]??0,r=Math.max(0,Math.min(1,a/t.maxValue)),o=Math.PI/2+Math.PI/3*n,s=i.value*r+(0===r?4:0);return{value:a,x:Math.cos(o)*s,y:-Math.sin(o)*s}})),p=(0,r.EW)(()=>{const e=[];return s.forEach((n,a)=>{const r=t.stats[n]??0,o=Math.max(0,Math.min(1,r/t.maxValue)),s=Math.PI/2+Math.PI/3*a,l=Math.cos(s)*i.value*o,c=-Math.sin(s)*i.value*o;e.push(`${l.toFixed(2)},${c.toFixed(2)}`)}),e.join(" ")}),v=(0,r.EW)(()=>{const e=[];for(let n=0;n<6;n++){const t=Math.PI/2+Math.PI/3*n;e.push({x:Math.cos(t)*i.value,y:-Math.sin(t)*i.value})}return e}),f=(0,r.EW)(()=>{const e=1.25*i.value;return s.map((n,t)=>{const a=Math.PI/2+Math.PI/3*t;return{key:n,name:c[n],x:Math.cos(a)*e,y:-Math.sin(a)*e}})}),h=(e,n=!1)=>0===e||3===e?"middle":1===e||2===e?n?"end":"start":n?"start":"end",m=(e,n=!1)=>0===e?n?"hanging":"alphabetic":3===e?n?"alphabetic":"hanging":"middle";return(e,n)=>((0,r.uX)(),(0,r.CE)("div",ag,[((0,r.uX)(),(0,r.CE)("svg",{width:e.size,height:e.size,viewBox:`0 0 ${e.size} ${e.size}`},[(0,r.Q3)(" 定义渐变 "),n[0]||(n[0]=(0,r.Fv)('<defs data-v-f62e2650><linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-f62e2650><stop offset="0%" stop-color="rgba(255, 215, 0, 0.3)" data-v-f62e2650></stop><stop offset="50%" stop-color="rgba(218, 165, 32, 0.25)" data-v-f62e2650></stop><stop offset="100%" stop-color="rgba(255, 223, 0, 0.2)" data-v-f62e2650></stop></linearGradient><linearGradient id="darkGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-f62e2650><stop offset="0%" stop-color="rgba(100, 181, 246, 0.3)" data-v-f62e2650></stop><stop offset="100%" stop-color="rgba(100, 181, 246, 0.1)" data-v-f62e2650></stop></linearGradient></defs>',1)),(0,r.Lk)("g",{transform:`translate(${a.value}, ${a.value})`},[(0,r.Q3)(" Hexagon Grid Lines "),((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(5,e=>(0,r.Lk)("polygon",{key:`grid-${e}`,points:d(e/5),class:"grid-line"},null,8,ig)),64)),(0,r.Q3)(" Radial Lines "),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value,(e,n)=>((0,r.uX)(),(0,r.CE)("line",{key:`axis-${n}`,x1:"0",y1:"0",x2:e.x,y2:e.y,class:"grid-line"},null,8,sg))),128)),(0,r.Q3)(" Data Polygon "),(0,r.Lk)("polygon",{points:p.value,class:"data-polygon"},null,8,lg),(0,r.Q3)(" Data Points & Numeric Values "),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value,(e,n)=>((0,r.uX)(),(0,r.CE)("g",{key:`data-point-${n}`},[(0,r.Lk)("circle",{cx:e.x,cy:e.y,r:"3",class:"data-point"},null,8,cg),(0,r.Lk)("text",{x:e.x,y:e.y,class:"data-value-text","text-anchor":h(n,!0),"dominant-baseline":m(n,!0)},(0,o.v_)(e.value),9,dg)]))),128)),(0,r.Q3)(" Stat Labels "),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(f.value,(e,n)=>((0,r.uX)(),(0,r.CE)("text",{key:e.key,x:e.x,y:e.y,class:"label-text","text-anchor":h(n),"dominant-baseline":m(n)},(0,o.v_)(e.name),9,ug))),128))],8,og)],8,rg))]))}});var vg=t(416),fg={};fg.styleTagTransform=A(),fg.setAttributes=k(),fg.insert=y().bind(null,"head"),fg.domAPI=g(),fg.insertStyleElement=_(),h()(vg.A,fg),vg.A&&vg.A.locals&&vg.A.locals;const hg=(0,E.A)(pg,[["__scopeId","data-v-f62e2650"]]),mg=(0,I.A)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),gg=(0,I.A)("arrow-down-to-line",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]),bg=(0,I.A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),yg={class:"legacy-modal"},xg={class:"legacy-modal-header"},kg={class:"title"},wg={class:"legacy-modal-body"},_g={class:"hint"},Cg={class:"file-row"},Ag={key:0,class:"file-name"},Sg={key:1,class:"file-name muted"},Lg={key:0,class:"result"},Eg={class:"summary-grid"},Tg={class:"kv"},Ig={class:"v"},Rg={class:"kv"},Mg={class:"v"},Pg={class:"kv"},Dg={class:"v"},zg={class:"kv"},Ng={class:"v"},$g={key:0,class:"details"},Og={class:"chips"},Fg={key:1,class:"details"},jg={class:"errors"},Bg={class:"details"},Xg={class:"json-preview"},Ug={class:"legacy-modal-actions"},Wg=["disabled"],qg=["disabled"],Gg=["disabled"],Hg=(0,r.pM)({__name:"LegacySaveMigrationModal",props:{open:{type:Boolean},targetCharId:{},targetCharName:{},standalone:{type:Boolean}},emits:["close","imported","character-created"],setup(e,{emit:n}){const t=e,a=n,l=(0,Ec.useCharacterStore)(),c=(0,i.KR)(null),d=(0,i.KR)(""),u=(0,i.KR)(null),p=(0,i.KR)(null),v=(0,i.KR)(null),f=(0,i.KR)(null),h=(0,r.EW)(()=>{if(!p.value)return null;const e=(0,Tc.ZT)(p.value);return e.isBundle?{schema:"dad.bundle",type:e.type}:p.value}),m=(0,r.EW)(()=>{if(!t.targetCharId)return!1;const e=l.rootState.角色列表?.[t.targetCharId];return!(!e||"单机"!==e.模式)&&Array.isArray(v.value)&&v.value.length>0}),g=(0,r.EW)(()=>!(!t.standalone||!f.value||"character"!==f.value.exportType||!Array.isArray(v.value)||0===v.value.length||u.value?.hasFatalErrors)),b=()=>{c.value?.click()},y=async e=>{const n=e.target.files?.[0];if(n)try{d.value=n.name,u.value=null,p.value=null,v.value=null,f.value=null;const e=await n.text(),t=(e=>{const n=(0,Tc.ZT)(e);if("saves"===n.type&&Array.isArray(n.payload?.saves))return{label:"存档包",exportType:"saves",exportPayloadBase:{...n.payload||{}},saves:n.payload.saves};if("character"===n.type&&Array.isArray(n.payload?.存档列表))return{label:"角色包",exportType:"character",exportPayloadBase:{...n.payload||{}},saves:n.payload.存档列表};if(e&&"object"==typeof e&&e.存档数据)return{label:"单个存档",exportType:"saves",exportPayloadBase:{},saves:[e]};if(e&&"object"==typeof e&&((0,Ic.WI)(e).needsMigration||(0,Ic.ru)(e)))return{label:"存档数据",exportType:"saves",exportPayloadBase:{},saves:[{存档名:"转换存档",存档数据:e}]};throw new Error("无法识别文件类型：请使用本游戏导出的存档/角色文件，或直接选择存档数据 JSON")})(JSON.parse(e));f.value=t,(e=>{const n=[],t=[],a=new Set;let r=0,o=0;const i=(new Date).toISOString(),s=e.saves.map((e,n)=>{const s=e?.存档数据??e,l=(0,Ic.WI)(s);l.needsMigration&&r++,l.legacyKeysFound.forEach(e=>a.add(e));let c=s;try{c=(0,Ic.ru)(s)?s:(0,Ic.jj)(s).migrated;const a=(0,Rc.$)(c);a.isValid||(o++,t.push(`第 ${n+1} 个存档「${e?.存档名??"未命名"}」校验警告：${a.errors[0]||"未知原因"}`))}catch(a){t.push(`第 ${n+1} 个存档「${e?.存档名??"未命名"}」迁移失败，将使用原始格式`),console.warn("[旧存档转化] 迁移失败:",a)}const d=String(e?.存档名??`导入存档_${n+1}`);return{...e,存档名:d,保存时间:e?.保存时间??i,最后保存时间:e?.最后保存时间??e?.保存时间??i,存档数据:c}});u.value={typeLabel:e.label,totalSaves:e.saves.length,needsMigration:r,invalidSaves:o,legacyKeys:Array.from(a).sort((e,n)=>e.localeCompare(n,"zh")),errors:[...n,...t],hasFatalErrors:n.length>0},v.value=s,"character"===e.exportType?p.value=(0,Tc.q3)("character",{...e.exportPayloadBase||{},存档列表:s},{exportedAt:i}):p.value=(0,Tc.q3)("saves",{...e.exportPayloadBase||{},saves:s},{exportedAt:i})})(t);const a=u.value;a?.hasFatalErrors?_e.o.error("检测到致命错误，无法导入"):a&&a.errors.length?_e.o.warning("检测到一些兼容性问题（可继续导入）"):a&&(a.needsMigration??0)>0?_e.o.success("旧存档已转换为当前格式（未写入本地，需手动下载/导入）"):_e.o.info("文件已是当前格式（可直接下载或导入）")}catch(e){const n=e instanceof Error?e.message:"未知错误";u.value={typeLabel:"未知",totalSaves:0,needsMigration:0,invalidSaves:0,legacyKeys:[],errors:[n],hasFatalErrors:!0},f.value=null,_e.o.error(`读取/解析失败：${n}`)}finally{c.value&&(c.value.value="")}},x=()=>{if(!p.value)return;const e=new Blob([JSON.stringify(p.value,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(e);const t=(new Date).toISOString().split("T")[0];n.download=`仙途-旧存档转化-${t}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(n.href),_e.o.success("已下载转换后的文件")},k=async()=>{if(!t.targetCharId)return;if(!v.value?.length)return;const e=t.targetCharName||t.targetCharId;try{for(const e of v.value)await l.importSave(t.targetCharId,e);_e.o.success(`已导入 ${v.value.length} 个存档到角色「${e}」`),a("imported",v.value.length)}catch(e){_e.o.error(`导入失败：${e instanceof Error?e.message:"未知错误"}`)}},w=async()=>{if(f.value&&"character"===f.value.exportType)if(v.value?.length)try{const e=f.value.exportPayloadBase,n=e?.角色信息||e,t=JSON.parse(JSON.stringify(n||{}));if(!t.角色&&t.角色基础信息&&(t.角色=t.角色基础信息,delete t.角色基础信息),!t?.角色)return void _e.o.error("角色数据不完整，无法创建");t.存档列表={},t._导入存档列表=v.value;const r=await l.importCharacter(t);r?a("character-created",r):_e.o.error("角色创建失败")}catch(e){_e.o.error(`创建角色失败：${e instanceof Error?e.message:"未知错误"}`)}else _e.o.error("没有可用的存档数据");else _e.o.error("当前文件不是角色包，无法创建新角色")};return(e,n)=>e.open?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"legacy-modal-overlay",onClick:n[2]||(n[2]=(0,s.D$)(e=>a("close"),["self"]))},[(0,r.Lk)("div",yg,[(0,r.Lk)("div",xg,[(0,r.Lk)("div",kg,[(0,r.bF)((0,i.R1)(mg),{size:18}),n[3]||(n[3]=(0,r.Lk)("span",null,"旧存档转化",-1))]),(0,r.Lk)("button",{class:"icon-btn",onClick:n[0]||(n[0]=e=>a("close")),title:"关闭"},[(0,r.bF)((0,i.R1)(ed.A),{size:18})])]),(0,r.Lk)("div",wg,[(0,r.Lk)("p",_g,[n[4]||(n[4]=(0,r.eW)(" 选择旧存档/旧导出文件后，会先检测并转换为当前格式，再进行校验。 ",-1)),e.standalone?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.eW)(" 如果是角色包文件，可以直接创建新角色。 ")],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.eW)(" 你可以下载转换后的文件，或导入到当前选中单机角色。 ")],64))]),(0,r.Lk)("div",Cg,[(0,r.Lk)("button",{class:"btn",onClick:b},[(0,r.bF)((0,i.R1)(Wc.A),{size:16}),n[5]||(n[5]=(0,r.eW)(" 选择 JSON 文件 ",-1))]),d.value?((0,r.uX)(),(0,r.CE)("span",Ag,(0,o.v_)(d.value),1)):((0,r.uX)(),(0,r.CE)("span",Sg,"未选择文件"))]),u.value?((0,r.uX)(),(0,r.CE)("div",Lg,[(0,r.Lk)("div",Eg,[(0,r.Lk)("div",Tg,[n[6]||(n[6]=(0,r.Lk)("span",{class:"k"},"识别类型",-1)),(0,r.Lk)("span",Ig,(0,o.v_)(u.value.typeLabel),1)]),(0,r.Lk)("div",Rg,[n[7]||(n[7]=(0,r.Lk)("span",{class:"k"},"存档数量",-1)),(0,r.Lk)("span",Mg,(0,o.v_)(u.value.totalSaves),1)]),(0,r.Lk)("div",Pg,[n[8]||(n[8]=(0,r.Lk)("span",{class:"k"},"需要转换",-1)),(0,r.Lk)("span",Dg,(0,o.v_)(u.value.needsMigration),1)]),(0,r.Lk)("div",zg,[n[9]||(n[9]=(0,r.Lk)("span",{class:"k"},"校验失败",-1)),(0,r.Lk)("span",Ng,(0,o.v_)(u.value.invalidSaves),1)])]),u.value.legacyKeys.length?((0,r.uX)(),(0,r.CE)("details",$g,[n[10]||(n[10]=(0,r.Lk)("summary",null,"检测到的旧 key（合并展示）",-1)),(0,r.Lk)("div",Og,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value.legacyKeys,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"chip"},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("v-if",!0),u.value.errors.length?((0,r.uX)(),(0,r.CE)("details",Fg,[n[11]||(n[11]=(0,r.Lk)("summary",null,"转换/校验问题",-1)),(0,r.Lk)("ul",jg,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value.errors,(e,n)=>((0,r.uX)(),(0,r.CE)("li",{key:n},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("details",Bg,[n[12]||(n[12]=(0,r.Lk)("summary",null,"转换后的导出结构",-1)),(0,r.Lk)("pre",Xg,(0,o.v_)(JSON.stringify(h.value,null,2)),1)])])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Ug,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:n[1]||(n[1]=e=>a("close"))},"关闭"),(0,r.Lk)("button",{class:"btn",disabled:!p.value||u.value?.hasFatalErrors,onClick:x},[(0,r.bF)((0,i.R1)(Vc.A),{size:16}),n[13]||(n[13]=(0,r.eW)(" 转换并下载 ",-1))],8,Wg),m.value?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn",disabled:!v.value||u.value?.hasFatalErrors,onClick:k},[(0,r.bF)((0,i.R1)(gg),{size:16}),n[14]||(n[14]=(0,r.eW)(" 导入到当前角色 ",-1))],8,qg)):(0,r.Q3)("v-if",!0),g.value?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn btn-primary",disabled:u.value?.hasFatalErrors,onClick:w},[(0,r.bF)((0,i.R1)(bg),{size:16}),n[15]||(n[15]=(0,r.eW)(" 创建新角色 ",-1))],8,Gg)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("input",{ref_key:"fileInput",ref:c,type:"file",accept:".json,application/json",hidden:"",onChange:y},null,544)])])):(0,r.Q3)("v-if",!0)}});var Vg=t(8664),Qg={};Qg.styleTagTransform=A(),Qg.setAttributes=k(),Qg.insert=y().bind(null,"head"),Qg.domAPI=g(),Qg.insertStyleElement=_(),h()(Vg.A,Qg),Vg.A&&Vg.A.locals&&Vg.A.locals;const Kg=(0,E.A)(Hg,[["__scopeId","data-v-372dd904"]]);t(4511);const Yg={class:"dialog-title"},Jg={class:"dialog-message"},Zg=["placeholder"],eb={class:"dialog-actions"},nb={key:0,class:"fullscreen-header"},tb={class:"fullscreen-title"},ab={class:"mobile-header"},rb={class:"menu-text"},ob={class:"mobile-title"},ib={key:0,class:"selected-info"},sb={key:2,class:"empty-state"},lb={class:"empty-icon"},cb={class:"empty-actions"},db={class:"management-layout"},ub={class:"grid-container"},pb={class:"grid-header-left"},vb={class:"header-title-group"},fb={class:"character-count"},hb=["title"],mb=["title"],gb={class:"grid-header-right"},bb={class:"header-left-content"},yb={key:0,class:"selected-char-info"},xb={key:0,class:"save-actions-buttons"},kb=["title"],wb=["disabled"],_b={class:"characters-grid"},Cb=["onClick"],Ab={class:"card-header"},Sb={class:"avatar-text"},Lb={class:"char-info"},Eb={class:"name-row"},Tb={class:"char-name"},Ib={class:"char-meta"},Rb={class:"world"},Mb={class:"talent"},Pb={class:"save-count"},Db={class:"count"},zb={class:"label"},Nb={class:"card-actions"},$b=["onClick"],Ob=["onClick"],Fb=["onClick"],jb={class:"grid-content-right saves-panel"},Bb={key:0,class:"no-selection"},Xb={class:"no-selection-icon"},Ub={class:"loading-saves"},Wb={class:"saves-container"},qb={class:"saves-section"},Gb={key:0,class:"manual-saves-section"},Hb={class:"manual-saves-header"},Vb={class:"save-info-text"},Qb={class:"manual-saves-grid"},Kb=["onClick"],Yb={key:0,class:"save-data"},Jb={class:"save-header"},Zb={class:"save-name"},ey={class:"save-actions"},ny=["onClick","title"],ty=["onClick","title","disabled"],ay=["onClick","disabled","title"],ry={class:"save-badges"},oy={class:"realm-badge"},iy={class:"age-badge"},sy={class:"save-stats"},ly={class:"stat-grid"},cy={class:"stat"},dy={class:"value"},uy={class:"stat"},py={class:"value"},vy={class:"stat"},fy={class:"value"},hy={class:"stat"},my={class:"value"},gy={class:"stat"},by={class:"value"},yy={class:"save-footer"},xy={class:"location"},ky={class:"save-time"},wy={key:1,class:"save-empty"},_y={class:"empty-text"},Cy={class:"empty-desc"},Ay={class:"online-saves-container"},Sy={key:0,class:"login-prompt"},Ly={class:"loading-saves"},Ey={key:2,class:"online-save-card"},Ty={class:"save-data"},Iy={class:"save-header"},Ry={class:"save-name"},My={class:"save-badges"},Py={class:"realm-badge"},Dy={class:"age-badge"},zy={class:"save-stats"},Ny={class:"stat-grid"},$y={class:"stat"},Oy={class:"value"},Fy={class:"stat"},jy={class:"value"},By={class:"stat"},Xy={class:"value"},Uy={class:"stat"},Wy={class:"value"},qy={class:"stat"},Gy={class:"value"},Hy={class:"save-footer"},Vy={class:"location"},Qy={class:"sync-info"},Ky={class:"online-actions"},Yy={key:0,class:"btn-sync"},Jy={class:"online-save-card"},Zy={class:"save-empty"},ex={class:"empty-text"},nx={class:"empty-hint"},tx={class:"modal-header"},ax={key:0,class:"modal-content"},rx={class:"details-grid"},ox={class:"detail-section"},ix={class:"detail-items"},sx={class:"detail-item"},lx={class:"label"},cx={class:"value"},dx={class:"detail-item"},ux={class:"label"},px={class:"value"},vx={class:"detail-item"},fx={class:"label"},hx={class:"value"},mx={class:"detail-item"},gx={class:"label"},bx={class:"value"},yx={class:"detail-item"},xx={class:"label"},kx={class:"value"},wx={class:"detail-section"},_x={class:"attributes-display"},Cx={class:"detail-section"},Ax={class:"talents-list"},Sx={key:0,class:"talent-items"},Lx=["title"],Ex={key:1,class:"no-talents"},Tx=(0,r.pM)({__name:"CharacterManagement",props:{fullscreen:{type:Boolean,default:!1}},emits:["back","login","close","character-selected"],setup(e,{emit:n}){const l=e,c=n,d=(0,r.EW)(()=>l.fullscreen),u=(0,a.rd)(),p=(0,Ec.useCharacterStore)(),v=(0,i.KR)(!0),f=(0,i.KR)(null),h=(0,i.KR)(!1),m=(0,i.KR)(null),g=(0,i.KR)(null),b=(0,i.KR)(null),y=(0,i.KR)(!1),x=(0,i.KR)(!1),k=(0,i.KR)(!1),w=(0,i.KR)("character"),_=(0,i.KR)(!1),C=(0,i.KR)(!1),A=(0,i.KR)(window.innerWidth),S=()=>{A.value=window.innerWidth,A.value>768?y.value=!0:A.value<=480&&(y.value=!1)},L=()=>{$.value?"单机"===$.value.模式?(C.value=!1,_.value=!0):_e.o.error("联机角色不支持旧存档转化/导入"):_e.o.info("请先选择一个单机角色")},E=()=>{C.value=!0,_.value=!0},I=()=>{_.value=!1,C.value=!1},R=async()=>{f.value&&await X(f.value)},M=async e=>{I(),_e.o.success("旧版本角色已成功导入"),await X(e)};(0,r.sV)(async()=>{window.addEventListener("resize",S),S();const e=Object.keys(p.rootState.角色列表);for(const n of e)try{await p.loadCharacterSaves(n)}catch(e){console.warn(`[CharacterManagement] 预加载角色 ${n} 存档失败:`,e)}const n=e[0];n&&X(n)}),(0,r.hi)(()=>{window.removeEventListener("resize",S)});const P=(0,i.KR)({show:!1,type:"alert",title:"",message:"",inputValue:"",placeholder:"",onConfirm:()=>{},onCancel:()=>{}}),D=(0,r.EW)(()=>Object.keys(p.rootState.角色列表).length),z=(0,r.EW)(()=>{const e=p.rootState.角色列表,n=Object.entries(e);return n.length>0&&console.log("[CharacterManagement] 第一个角色的数据结构:",JSON.stringify(n[0][1],null,2).substring(0,500)),n.filter(([,e])=>!(!e?.角色?.名字&&!e?.角色?.身份?.名字))}),$=(0,r.EW)(()=>f.value?p.rootState.角色列表[f.value]:null),j=(0,r.EW)(()=>A.value<=768),B=()=>{y.value=!y.value},X=async e=>{if(f.value!==e){f.value=e,k.value=!0;try{await p.loadCharacterSaves(e)}catch(e){console.error("[CharacterManagement] 加载存档数据失败:",e)}finally{k.value=!1}j.value&&(y.value=!1)}},U=e=>"单机"===e.模式?Object.entries(e.存档列表||{}).filter(([e,n])=>"上次对话"!==e&&n.存档数据).length:e.存档列表?.["云端修行"]?.存档数据?1:0,W=()=>{h.value=!1,m.value=null},q=async(e,n,t)=>{console.log("选择存档:",e,n,t);const a=p.rootState.角色列表[e];if("联机"===a?.模式&&(0,O.isBackendConfigured)()&&!await(0,F.verifyStoredToken)())return _e.o.warning("联机模式需要登录，正在跳转..."),void u.push("/login");if(t){console.log("加载存档...");const t=await p.loadGame(e,n);console.log("加载结果:",t),t?(console.log("跳转到游戏界面..."),l.fullscreen?c("character-selected",a):u.push("/game")):console.error("存档加载失败")}else{const t="上次对话"===n;ae(t?"创建新存档":"开启新征程",t?`是否在【${n}】位置创建新的存档开始游戏？`:`是否在存档位 "${n}" 开始一段新的修行？`,async()=>{console.log("确认创建新存档...");const t=await p.loadGame(e,n);console.log("新存档加载结果:",t),t&&(console.log("跳转到游戏界面..."),l.fullscreen?c("character-selected",a):u.push("/game"))})}},G=(e,n)=>{if(!e||"联机"===e.模式)return!1;if("上次对话"===n||"时间点存档"===n)return!1;const t=e.存档列表||{},a=Object.entries(t).filter(([e,n])=>"上次对话"!==e&&"时间点存档"!==e&&n.存档数据).length,r=t[n];return!(r?.存档数据&&a<=1)},H=(e,n)=>"上次对话"===n?"上次对话存档不可删除（用于回滚）":"时间点存档"===n?"时间点存档不可删除（定时自动覆盖）":G(e,n)?"删除存档":"无法删除：至少需要保留一个手动存档",V=()=>{c("back")},Q=()=>{l.fullscreen?c("close"):V()},K=()=>{c("login")},Y=e=>{if(!e||"object"!=typeof e)return null;try{const n=e;return(0,Ic.ru)(n)?n:(0,Ic.jj)(n).migrated}catch(e){return console.warn("[CharacterManagement] 存档格式转换失败（旧版存档兼容性问题）:",e),null}},J=e=>"string"==typeof e?e||"凡人":bp(e),Z=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){const n=e;return String(n["名称"]||n.name||"未知天赋")}return"未知天赋"},ee=e=>{if("string"==typeof e)return`天赋《${e}》`;if(e&&"object"==typeof e){const n=e,t=n["描述"]||n.description||"",a=Z(e);return t?String(t):`天赋《${a}》`}return"未知天赋"},ne=e=>e?"string"==typeof e?e:"object"==typeof e&&null!==e&&(e.名称||e.name||e.名字)||"未知":"未知",te=(e,n,t)=>{P.value={show:!0,type:"alert",title:e,message:n,inputValue:"",placeholder:"",onConfirm:()=>{t&&t(),ie()},onCancel:ie}},ae=(e,n,t,a)=>{P.value={show:!0,type:"confirm",title:e,message:n,inputValue:"",placeholder:"",onConfirm:()=>{t(),ie()},onCancel:()=>{a&&a(),ie()}}},re=()=>{"prompt"===P.value.type?P.value.onConfirm(P.value.inputValue):P.value.onConfirm()},oe=()=>{P.value.onCancel(),ie()},ie=()=>{P.value.show=!1},se=()=>{$.value?(w.value="saves",b.value?.click()):_e.o.error("请先选择一个角色以导入存档")},le=()=>{w.value="character",b.value?.click()},ce=async e=>{const n=e.target.files?.[0];if(!n)return;const t=()=>{b.value&&(b.value.value="")};try{const e=await n.text(),a=JSON.parse(e),r=(0,Tc.ZT)(a);if("saves"===w.value){const e="saves"===r.type&&Array.isArray(r.payload?.saves)?r.payload.saves:"character"===r.type&&Array.isArray(r.payload?.存档列表)?r.payload.存档列表:null;if(!e)throw new Error("无效的存档文件格式，请使用本游戏导出的存档文件");if(0===e.length)throw new Error("文件中没有找到有效的存档数据");if(!f.value||!$.value)return _e.o.error("请先选择一个角色以导入存档"),void t();const n=f.value,a=$.value.角色.名字;ae("导入存档",`确定要将 ${e.length} 个存档导入到角色 "${a}" 吗？同名存档将被覆盖。`,async()=>{x.value=!0;try{for(const t of e)await p.importSave(n,t);_e.o.success(`成功为角色 "${a}" 导入 ${e.length} 个存档`),await X(n)}catch(e){console.error("导入存档失败",e),_e.o.error("导入存档失败: "+e.message)}finally{x.value=!1,t()}},t)}else if("character"===w.value){if("character"!==r.type||!r.payload?.角色信息)throw new Error("无效的角色文件格式，请使用本游戏导出的角色文件");const e=r.payload.角色信息,n=e?.角色?.名字||"未知角色";e.存档列表={},Array.isArray(r.payload?.存档列表)&&(e._导入存档列表=r.payload.存档列表),ae("导入角色",`确定要导入角色 "${n}" 吗？`,async()=>{x.value=!0;try{await p.importCharacter(e),_e.o.success(`成功导入角色 "${n}"`)}catch(e){console.error("导入角色失败",e),_e.o.error("导入角色失败: "+e.message)}finally{x.value=!1,t()}},t)}}catch(e){console.error("处理导入文件失败",e),_e.o.error("处理导入文件失败: "+e.message),t()}};return(e,n)=>{return(0,r.uX)(),(0,r.CE)("div",{class:(0,o.C4)(["character-management-panel",{fullscreen:d.value}])},[d.value?((0,r.uX)(),(0,r.Wv)(T,{key:0})):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 自定义对话框 "),P.value.show?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"dialog-overlay",onClick:oe},[(0,r.Lk)("div",{class:"dialog-box",onClick:n[1]||(n[1]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("h3",Yg,(0,o.v_)(P.value.title),1),(0,r.Lk)("p",Jg,(0,o.v_)(P.value.message),1),"prompt"===P.value.type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:0,"onUpdate:modelValue":n[0]||(n[0]=e=>P.value.inputValue=e),placeholder:P.value.placeholder,class:"dialog-input",ref_key:"promptInput",ref:g},null,8,Zg)),[[s.Jo,P.value.inputValue]]):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",eb,["alert"!==P.value.type?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:oe,class:"btn-dialog-cancel"},(0,o.v_)(e.$t("取消")),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:re,class:"btn-dialog-confirm"},(0,o.v_)(e.$t("确认")),1)])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 主体区域 "),(0,r.Lk)("main",{class:(0,o.C4)(["main-content",{"fullscreen-content":d.value}])},[(0,r.Lk)("input",{ref_key:"fileInput",ref:b,type:"file",accept:".json",onChange:ce,style:{display:"none"}},null,544),(0,r.bF)(Kg,{open:_.value,targetCharId:C.value?null:f.value,targetCharName:C.value?void 0:$.value?.角色?.名字,standalone:C.value,onClose:I,onImported:R,onCharacterCreated:M},null,8,["open","targetCharId","targetCharName","standalone"]),(0,r.Q3)(" 返回按钮 - 仅在全屏模式显示 "),d.value?((0,r.uX)(),(0,r.CE)("div",nb,[(0,r.Lk)("button",{onClick:Q,class:"fullscreen-back-btn"},[(0,r.bF)((0,i.R1)(Xc),{size:20}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("返回道途")),1)]),(0,r.Lk)("div",tb,[(0,r.Lk)("h1",null,(0,o.v_)(e.$t("续前世因缘")),1),(0,r.Lk)("p",null,(0,o.v_)(e.$t("择一法身，入道重修")),1)])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 移动端头部导航 "),(0,r.Lk)("div",ab,[(0,r.Lk)("button",{class:(0,o.C4)(["mobile-menu-btn",{active:y.value}]),onClick:B},[n[6]||(n[6]=(0,r.Lk)("div",{class:"hamburger"},[(0,r.Lk)("span"),(0,r.Lk)("span"),(0,r.Lk)("span")],-1)),(0,r.Lk)("span",rb,(0,o.v_)(e.$t("角色列表")),1)],2),(0,r.Lk)("div",ob,[(0,r.Lk)("h2",null,(0,o.v_)(e.$t("角色管理")),1),$.value?.角色?.名字?((0,r.uX)(),(0,r.CE)("div",ib,(0,o.v_)($.value.角色.名字)+" - "+(0,o.v_)($.value.模式)+(0,o.v_)(e.$t("模式")),1)):(0,r.Q3)("v-if",!0)])]),(0,r.Q3)(" 遮罩层 "),y.value&&j.value?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"panel-overlay",onClick:n[2]||(n[2]=e=>y.value=!1)})):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 无角色提示 "),0===Object.keys((0,i.R1)(p).rootState.角色列表).length?((0,r.uX)(),(0,r.CE)("div",sb,[(0,r.Lk)("div",lb,[(0,r.bF)((0,i.R1)(jf),{size:32})]),(0,r.Lk)("h2",null,(0,o.v_)(e.$t("道途未启")),1),(0,r.Lk)("p",null,(0,o.v_)(e.$t("尚未创建任何法身，请返回道途开启修仙之旅")),1),(0,r.Lk)("div",cb,[(0,r.Lk)("button",{onClick:V,class:"btn-create"},(0,o.v_)(e.$t("踏入仙途")),1),(0,r.Lk)("button",{onClick:le,class:"btn-import"},(0,o.v_)(e.$t("导入角色")),1)])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Q3)(" 角色管理界面 "),(0,r.Lk)("div",db,[(0,r.Q3)(" 3行2列网格容器 "),(0,r.Lk)("div",ub,[(0,r.Q3)(" 第1行：标题栏 "),(0,r.Lk)("div",pb,[(0,r.Lk)("div",vb,[(0,r.Lk)("h2",null,(0,o.v_)(e.$t("角色列表")),1),(0,r.Lk)("div",fb,(0,o.v_)(D.value)+" "+(0,o.v_)(e.$t("个角色")),1)]),(0,r.Lk)("button",{onClick:le,class:"btn-header-action import",title:e.$t("导入角色")},[(0,r.bF)((0,i.R1)(Wc.A),{size:16}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("导入")),1)],8,hb),(0,r.Lk)("button",{onClick:E,class:"btn-header-action migrate",title:e.$t("导入旧版本角色")},[(0,r.bF)((0,i.R1)(mg),{size:16}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("旧版本")),1)],8,mb)]),(0,r.Lk)("div",gb,[(0,r.Lk)("div",bb,[(0,r.Lk)("h2",null,(0,o.v_)(e.$t("存档管理")),1),$.value?.角色?.名字?((0,r.uX)(),(0,r.CE)("div",yb,(0,o.v_)($.value.角色.名字)+" - "+(0,o.v_)($.value.模式)+(0,o.v_)(e.$t("模式")),1)):(0,r.Q3)("v-if",!0)]),$.value?((0,r.uX)(),(0,r.CE)("div",xb,[(0,r.Lk)("button",{onClick:se,class:"btn-save-action import",title:e.$t("向选中角色导入存档")},[(0,r.bF)((0,i.R1)(Wc.A),{size:18}),(0,r.Lk)("span",null,(0,o.v_)(e.$t("导入存档")),1)],8,kb),(0,r.Lk)("button",{onClick:L,class:"btn-save-action migrate",disabled:"单机"!==$.value.模式,title:"旧存档转化（单机）"},[(0,r.bF)((0,i.R1)(mg),{size:18}),n[7]||(n[7]=(0,r.Lk)("span",null,"旧存档转化",-1))],8,wb)])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 第2行：主要内容区 "),(0,r.Lk)("section",{class:(0,o.C4)(["grid-content-left characters-panel",{"is-open":y.value}])},[(0,r.Lk)("div",_b,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(z.value,([n,a])=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:(0,o.C4)(["character-card",{active:f.value===String(n),"single-mode":"单机"===a.模式,"online-mode":"联机"===a.模式}]),onClick:e=>X(String(n))},[(0,r.Q3)(" 卡片头部 "),(0,r.Lk)("div",Ab,[(0,r.Lk)("div",{class:(0,o.C4)(["char-avatar",a.模式])},[(0,r.Lk)("span",Sb,(0,o.v_)(a.角色.名字[0]),1)],2),(0,r.Lk)("div",Lb,[(0,r.Lk)("div",Eb,[(0,r.Lk)("h3",Tb,(0,o.v_)(a.角色.名字),1),(0,r.Lk)("span",{class:(0,o.C4)(["mode-badge","联机"===a.模式?"online":"single"])},(0,o.v_)(a.模式===e.$t("单机")?e.$t("单机"):e.$t("联机")),3)]),(0,r.Lk)("div",Ib,[(0,r.Lk)("span",Rb,(0,o.v_)(a.角色.世界.name),1),(0,r.Lk)("span",Mb,(0,o.v_)(ne(a.角色.天资.name)),1)])]),(0,r.Lk)("div",Pb,[(0,r.Lk)("span",Db,(0,o.v_)(U(a)),1),(0,r.Lk)("span",zb,(0,o.v_)(e.$t("存档管理")),1)])]),(0,r.Q3)(" 卡片底部操作 "),(0,r.Lk)("div",Nb,[(0,r.Lk)("button",{onClick:(0,s.D$)(e=>(e=>{m.value=p.rootState.角色列表[e],h.value=!0})(String(n)),["stop"]),class:"btn-details"},(0,o.v_)(e.$t("详情")),9,$b),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>(async e=>{x.value=!0;try{const n=p.rootState.角色列表[e];if(!n)return _e.o.error("角色不存在"),void(x.value=!1);const{loadSaveData:a}=await Promise.resolve().then(t.bind(t,5099)),r=Object.values(n.存档列表||{}).filter(e=>"上次对话"!==e.存档名),o=(await Promise.all(r.map(async n=>{const t=n.id||n.存档名,r=await a(e,t);if(!r)return console.warn(`[角色导出] 存档「${n.存档名}」数据为空，跳过`),null;const o=r;return{...n,存档数据:o}})).then(e=>e.filter(Boolean))).map(e=>{if(!e)throw new Error("存档数据为空，无法导出");const n=e.存档数据;if(!n)throw new Error(`存档「${e.存档名}」缺少存档数据，无法导出`);let t=n;try{const a=(0,Ic.ru)(n)?n:(0,Ic.jj)(n).migrated,r=(0,Rc.$)(a);r.isValid||console.warn(`[角色导出] 存档「${e.存档名}」校验警告：${r.errors[0]||"未知原因"}`),t=a}catch(n){console.warn(`[角色导出] 存档「${e.存档名}」迁移失败，使用原始数据:`,n)}return{...e,存档数据:t}}),i=(0,Tc.q3)("character",{角色ID:e,角色信息:JSON.parse(JSON.stringify(n)),存档列表:o}),s=JSON.stringify(i,null,2),l=new Blob([s],{type:"application/json"});console.log("[角色导出] 数据大小:",(s.length/1024).toFixed(2),"KB");const c=document.createElement("a");c.href=URL.createObjectURL(l);const d=n.角色?.名字||"未命名角色";c.download=`仙途-角色-${d}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(c.href)},100),_e.o.success(`已导出角色: ${d} (含 ${o.length} 个存档)`)}catch(e){console.error("导出角色失败",e),_e.o.error("导出角色失败: "+(e instanceof Error?e.message:"未知错误"))}finally{x.value=!1}})(String(n)),["stop"]),class:"btn-export"},(0,o.v_)(e.$t("导出")),9,Ob),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>(e=>{const n=p.rootState.角色列表[e]?.角色.名字;ae("删除角色",`确定要彻底删除角色"${n}"及其所有修行记录吗？此操作不可恢复。`,async()=>{f.value===e&&(f.value=null),await p.deleteCharacter(e)})})(String(n)),["stop"]),class:"btn-delete"},(0,o.v_)(e.$t("删除")),9,Fb)])],10,Cb))),128))])],2),(0,r.Q3)(" 右侧：存档详情 "),(0,r.Lk)("section",jb,[(0,r.Q3)(" 未选择角色 "),$.value?k.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 正在加载存档 "),(0,r.Lk)("div",Ub,[n[8]||(n[8]=(0,r.Lk)("div",{class:"loading-spinner"},null,-1)),(0,r.Lk)("p",null,(0,o.v_)(e.$t("正在加载存档...")),1)])],2112)):"单机"===$.value.模式?((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[(0,r.Q3)(" 单机模式存档 "),(0,r.Lk)("div",Wb,[(0,r.Lk)("div",qb,[(0,r.Q3)(" 手动存档区 - 仅单机模式显示 "),"单机"===$.value.模式?((0,r.uX)(),(0,r.CE)("div",Gb,[(0,r.Lk)("div",Hb,[(0,r.Lk)("h3",null,(0,o.v_)(e.$t("手动存档")),1),(0,r.Lk)("div",Vb,[(0,r.Lk)("span",null,(0,o.v_)(e.$t("存档通过游戏内保存功能创建")),1)])]),(0,r.Lk)("div",Qb,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((l=$.value,l?.存档列表?l.存档列表:{}),(a,l)=>{return(0,r.uX)(),(0,r.CE)("div",{key:l,class:(0,o.C4)(["save-card manual-save",{"has-data":a.存档数据,"auto-save":"上次对话"===l||"时间点存档"===l}]),onClick:e=>a.存档数据&&q(f.value,String(l),!0),style:(0,o.Tr)({cursor:a.存档数据?"pointer":"default"})},[a.存档数据?((0,r.uX)(),(0,r.CE)("div",Yb,[(0,r.Lk)("div",Jb,[(0,r.Lk)("h4",Zb,["上次对话"===l?((0,r.uX)(),(0,r.Wv)((0,i.R1)(N),{key:0,size:16,class:"save-icon last-save-icon"})):"时间点存档"===l?((0,r.uX)(),(0,r.Wv)((0,i.R1)(Bp),{key:1,size:16,class:"save-icon time-save-icon"})):(0,r.Q3)("v-if",!0),(0,r.eW)(" "+(0,o.v_)(a.存档名||l),1)]),(0,r.Lk)("div",ey,[(0,r.Lk)("button",{onClick:(0,s.D$)(e=>(async(e,n,a)=>{x.value=!0;try{const{loadSaveData:r}=await Promise.resolve().then(t.bind(t,5099)),o=await r(e,n);if(!o)return _e.o.error("无法加载存档数据"),void(x.value=!1);let i=o,s="";try{const e=(0,Ic.ru)(o)?o:(0,Ic.jj)(o).migrated,n=(0,Rc.$)(e);n.isValid||(s=`存档格式校验有警告：${n.errors[0]||"未知问题"}`,console.warn("[导出存档]",s)),i=e}catch(e){s="旧版存档格式，将导出原始数据",console.warn("[导出存档] 迁移失败，导出原始数据:",e)}const l=(0,Tc.q3)("saves",{characterId:e,characterName:$.value?.角色?.名字,saves:[{...a,存档名:n,存档数据:i}]}),c=JSON.stringify(l,null,2),d=new Blob([c],{type:"application/json"}),u=document.createElement("a");u.href=URL.createObjectURL(d);const p=a.存档名||n;u.download=`仙途-${p}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),setTimeout(()=>{document.body.removeChild(u),URL.revokeObjectURL(u.href)},100),_e.o.success(`已导出存档: ${p}`)}catch(e){console.error("导出存档失败",e),_e.o.error("导出存档失败: "+(e instanceof Error?e.message:"未知错误"))}finally{x.value=!1}})(f.value,String(l),a),["stop"]),class:"btn-export-save",title:e.$t("导出此存档")},(0,o.v_)(e.$t("导")),9,ny),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>((e,n)=>{const t=p.rootState.角色列表[e]?.存档列表?.[n],a=t?.存档名||n;((e,n,t="",a="",o,i)=>{P.value={show:!0,type:"prompt",title:e,message:n,inputValue:t,placeholder:a,onConfirm:e=>{o(e||""),ie()},onCancel:()=>{i&&i(),ie()}},(0,r.dY)(()=>{g.value?.focus()})})("重命名存档","请输入新的存档名称：",a,"",async t=>{if(t&&t.trim()&&t.trim()!==a){const a=t.trim(),r=p.rootState.角色列表[e]?.存档列表;if(r&&a!==n&&r[a])return void te("重命名失败","存档名称已存在，请使用其他名称。");await p.renameSave(e,n,a)}})})(f.value,String(l)),["stop"]),class:"btn-edit-save",title:e.$t("重命名"),disabled:"上次对话"===l||"时间点存档"===l},(0,o.v_)(e.$t("编")),9,ty),(0,r.Lk)("button",{onClick:(0,s.D$)(e=>((e,n)=>{const t=p.rootState.角色列表[e],a=t?.角色.名字,r="上次对话"===n?"上次对话存档":n;G(t,n)?ae("删除存档",`确定要删除角色"${a}"的"${r}"吗？此操作不可恢复。`,()=>{p.deleteSave(e,n)}):te("无法删除存档","无法删除该存档：角色至少需要保留一个存档。如需删除，请先创建其他存档或删除整个角色。")})(f.value,String(l)),["stop"]),class:(0,o.C4)(["btn-delete-save",{disabled:!G($.value,String(l))}]),disabled:!G($.value,String(l)),title:H($.value,String(l))},(0,o.v_)(e.$t("删")),11,ay)])]),(0,r.Lk)("div",ry,[(0,r.Lk)("span",oy,(0,o.v_)(J(Y(a.存档数据)?.角色?.属性?.觉醒阶段)),1),(0,r.Lk)("span",iy,(0,o.v_)(Y(a.存档数据)?.角色?.属性?.寿命?.当前??18)+"岁",1)]),(0,r.Lk)("div",sy,[(0,r.Lk)("div",ly,[(0,r.Lk)("div",cy,[n[9]||(n[9]=(0,r.Lk)("span",{class:"label"},"生命值",-1)),(0,r.Lk)("span",dy,(0,o.v_)(Y(a.存档数据)?.角色?.属性?.生命值?.当前??0)+"/"+(0,o.v_)(Y(a.存档数据)?.角色?.属性?.生命值?.上限??0),1)]),(0,r.Lk)("div",uy,[n[10]||(n[10]=(0,r.Lk)("span",{class:"label"},"精神力",-1)),(0,r.Lk)("span",py,(0,o.v_)(Y(a.存档数据)?.角色?.属性?.精神力?.当前??0)+"/"+(0,o.v_)(Y(a.存档数据)?.角色?.属性?.精神力?.上限??0),1)]),(0,r.Lk)("div",vy,[n[11]||(n[11]=(0,r.Lk)("span",{class:"label"},"理智值",-1)),(0,r.Lk)("span",fy,(0,o.v_)(Y(a.存档数据)?.角色?.属性?.理智值?.当前??0)+"/"+(0,o.v_)(Y(a.存档数据)?.角色?.属性?.理智值?.上限??0),1)]),(0,r.Lk)("div",hy,[n[12]||(n[12]=(0,r.Lk)("span",{class:"label"},"体力",-1)),(0,r.Lk)("span",my,(0,o.v_)(Y(a.存档数据)?.角色?.属性?.体力?.当前??0)+"/"+(0,o.v_)(Y(a.存档数据)?.角色?.属性?.体力?.上限??0),1)]),(0,r.Lk)("div",gy,[n[13]||(n[13]=(0,r.Lk)("span",{class:"label"},"声望",-1)),(0,r.Lk)("span",by,(0,o.v_)(Y(a.存档数据)?.角色?.属性?.声望??0),1)])])]),(0,r.Lk)("div",yy,[(0,r.Lk)("span",xy,(0,o.v_)(Y(a.存档数据)?.角色?.位置?.描述||"初始地"),1),(0,r.Lk)("span",ky,(0,o.v_)((c=a.保存时间,c?new Date(c).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未保存")),1)])])):((0,r.uX)(),(0,r.CE)("div",wy,[n[14]||(n[14]=(0,r.Lk)("div",{class:"empty-slot-icon"},"📁",-1)),(0,r.Lk)("span",_y,(0,o.v_)(e.$t("空存档槽")),1),(0,r.Lk)("span",Cy,(0,o.v_)(e.$t("通过游戏内保存创建")),1)]))],14,Kb);var c}),128))])])):(0,r.Q3)("v-if",!0)])])],2112)):"联机"===$.value.模式?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Q3)(" 联机模式存档 "),(0,r.Lk)("div",Ay,[v.value?k.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 加载中状态 "),(0,r.Lk)("div",Ly,[n[16]||(n[16]=(0,r.Lk)("div",{class:"loading-spinner"},"⏳",-1)),(0,r.Lk)("span",null,(0,o.v_)(e.$t("正在加载云端存档...")),1)])],2112)):$.value.存档列表?.["云端修行"]?.存档数据?((0,r.uX)(),(0,r.CE)("div",Ey,[(0,r.Lk)("div",Ty,[(0,r.Lk)("div",Iy,[(0,r.Lk)("h4",Ry,(0,o.v_)(e.$t("云端存档")),1),(0,r.Lk)("div",My,[(0,r.Lk)("span",Py,(0,o.v_)(J(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.觉醒阶段)),1),(0,r.Lk)("span",Dy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.寿命?.当前??18)+"岁",1)])]),(0,r.Lk)("div",zy,[(0,r.Lk)("div",Ny,[(0,r.Lk)("div",$y,[n[17]||(n[17]=(0,r.Lk)("span",{class:"label"},"生命值",-1)),(0,r.Lk)("span",Oy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.生命值?.当前??0)+"/"+(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.生命值?.上限??0),1)]),(0,r.Lk)("div",Fy,[n[18]||(n[18]=(0,r.Lk)("span",{class:"label"},"精神力",-1)),(0,r.Lk)("span",jy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.精神力?.当前??0)+"/"+(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.精神力?.上限??0),1)]),(0,r.Lk)("div",By,[n[19]||(n[19]=(0,r.Lk)("span",{class:"label"},"理智",-1)),(0,r.Lk)("span",Xy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.理智值?.当前??0)+"/"+(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.理智值?.上限??0),1)]),(0,r.Lk)("div",Uy,[n[20]||(n[20]=(0,r.Lk)("span",{class:"label"},"体力",-1)),(0,r.Lk)("span",Wy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.体力?.当前??0)+"/"+(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.体力?.上限??0),1)]),(0,r.Lk)("div",qy,[n[21]||(n[21]=(0,r.Lk)("span",{class:"label"},"声望",-1)),(0,r.Lk)("span",Gy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.属性?.声望??0),1)])])]),(0,r.Lk)("div",Hy,[(0,r.Lk)("span",Vy,(0,o.v_)(Y($.value.存档列表["云端修行"].存档数据)?.角色?.位置?.描述||"初始地"),1),(0,r.Lk)("div",Qy,[(0,r.Lk)("span",{class:(0,o.C4)(["sync-status",{synced:!$.value.存档列表["云端修行"].云端同步信息?.需要同步}])},(0,o.v_)($.value.存档列表["云端修行"].云端同步信息?.需要同步?e.$t("待同步"):e.$t("已同步")),3)])]),(0,r.Lk)("div",Ky,[(0,r.Lk)("button",{onClick:n[3]||(n[3]=e=>q(f.value,"云端修行",!0)),class:"btn-play"},(0,o.v_)(e.$t("进入游戏")),1),$.value.存档列表["云端修行"]?.云端同步信息?.需要同步?((0,r.uX)(),(0,r.CE)("button",Yy,(0,o.v_)(e.$t("同步云端")),1)):(0,r.Q3)("v-if",!0)])])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Q3)(" 没有存档数据：显示开始游戏 "),(0,r.Lk)("div",Jy,[(0,r.Lk)("div",Zy,[n[22]||(n[22]=(0,r.Lk)("div",{class:"empty-slot-icon"},"☁️",-1)),(0,r.Lk)("span",ex,(0,o.v_)(e.$t("尚未开始修行")),1),(0,r.Lk)("p",nx,(0,o.v_)(e.$t("开始您的联机修仙之旅，存档将自动同步到云端")),1),(0,r.Lk)("button",{onClick:n[4]||(n[4]=e=>q(f.value,"云端修行",!1)),class:"btn-start"},(0,o.v_)(e.$t("开始游戏")),1)])])],2112)):((0,r.uX)(),(0,r.CE)("div",Sy,[n[15]||(n[15]=(0,r.Lk)("div",{class:"login-icon"},"🔐",-1)),(0,r.Lk)("h3",null,(0,o.v_)(e.$t("需要登录")),1),(0,r.Lk)("p",null,(0,o.v_)(e.$t("请先登录以管理联机角色存档")),1),(0,r.Lk)("button",{onClick:K,class:"btn-login"},(0,o.v_)(e.$t("登入道籍")),1)]))])],2112)):(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",Bb,[(0,r.Lk)("div",Xb,[(0,r.bF)((0,i.R1)(mg),{size:30})]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("请选择左侧角色查看存档详情")),1)]))]),(0,r.Q3)(" 第3行：底部信息栏（可选） "),n[23]||(n[23]=(0,r.Lk)("div",{class:"grid-footer-left"},[(0,r.Q3)(" 预留底部区域 ")],-1)),n[24]||(n[24]=(0,r.Lk)("div",{class:"grid-footer-right"},[(0,r.Q3)(" 预留底部区域 ")],-1))])])],2112))],2),(0,r.Q3)(" 角色详情弹窗 "),h.value?((0,r.uX)(),(0,r.CE)("div",{key:2,class:"modal-overlay",onClick:W},[(0,r.Lk)("div",{class:"details-modal",onClick:n[5]||(n[5]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",tx,[(0,r.Lk)("h3",null,(0,o.v_)(m.value?.角色?.名字)+" - "+(0,o.v_)(e.$t("详情")),1),(0,r.Lk)("button",{onClick:W,class:"btn-close"},"×")]),m.value?((0,r.uX)(),(0,r.CE)("div",ax,[(0,r.Lk)("div",rx,[(0,r.Lk)("div",ox,[(0,r.Lk)("h4",null,(0,o.v_)(e.$t("基础信息")),1),(0,r.Lk)("div",ix,[(0,r.Lk)("div",sx,[(0,r.Lk)("span",lx,(0,o.v_)(e.$t("道号")),1),(0,r.Lk)("span",cx,(0,o.v_)(m.value.角色.名字),1)]),(0,r.Lk)("div",dx,[(0,r.Lk)("span",ux,(0,o.v_)(e.$t("世界")),1),(0,r.Lk)("span",px,(0,o.v_)(ne(m.value.角色.世界)),1)]),(0,r.Lk)("div",vx,[(0,r.Lk)("span",fx,(0,o.v_)(e.$t("天资")),1),(0,r.Lk)("span",hx,(0,o.v_)(ne(m.value.角色.天资)),1)]),(0,r.Lk)("div",mx,[(0,r.Lk)("span",gx,(0,o.v_)(e.$t("出身")),1),(0,r.Lk)("span",bx,(0,o.v_)(ne(m.value.角色.出生)),1)]),(0,r.Lk)("div",yx,[(0,r.Lk)("span",xx,(0,o.v_)(e.$t("模式")),1),(0,r.Lk)("span",kx,(0,o.v_)(m.value.模式),1)])])]),(0,r.Lk)("div",wx,[(0,r.Lk)("h4",null,(0,o.v_)(e.$t("先天属性")),1),(0,r.Lk)("div",_x,[m.value.角色.先天属性?((0,r.uX)(),(0,r.Wv)(hg,{key:0,stats:(a=m.value.角色.先天属性,{strength:a["力量"]||0,agility:a["敏捷"]||0,constitution:a["体质"]||0,willpower:a["意志"]||0,charm:a["魅力"]||0,luck:a["幸运"]||0}),size:150,maxValue:10},null,8,["stats"])):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",Cx,[(0,r.Lk)("h4",null,(0,o.v_)(e.$t("天赋神通")),1),(0,r.Lk)("div",Ax,[m.value.角色.天赋?.length?((0,r.uX)(),(0,r.CE)("div",Sx,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value.角色.天赋,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:n,class:"talent-tag",title:ee(e)},(0,o.v_)(Z(e)),9,Lx))),128))])):((0,r.uX)(),(0,r.CE)("span",Ex,(0,o.v_)(e.$t("暂无天赋")),1))])])])])):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0)],2);var a,l}}});var Ix=t(5777),Rx={};Rx.styleTagTransform=A(),Rx.setAttributes=k(),Rx.insert=y().bind(null,"head"),Rx.domAPI=g(),Rx.insertStyleElement=_(),h()(Ix.A,Rx),Ix.A&&Ix.A.locals&&Ix.A.locals;const Mx=(0,E.A)(Tx,[["__scopeId","data-v-579f7e28"]]),Px={key:0,class:"error-boundary"},Dx={class:"error-container"},zx={class:"error-message"},Nx={key:0,class:"error-details"},$x={class:"error-actions"},Ox=(0,r.pM)({__name:"ErrorBoundary",setup(e){const n=(0,a.rd)(),t=(0,i.KR)(!1),s=(0,i.KR)(""),l=(0,i.KR)(""),c=(0,i.KR)(!1);(0,r.qG)((e,n,a)=>(console.error("[错误边界] 捕获到错误:",e),console.error("[错误边界] 组件信息:",a),t.value=!0,s.value=e.message||"未知错误",l.value=`\n错误: ${e.name}: ${e.message}\n堆栈: ${e.stack||"无堆栈信息"}\n组件: ${a}\n  `.trim(),!1));const d=()=>{t.value=!1,s.value="",l.value="",c.value=!1,n.go(0)},u=()=>{t.value=!1,n.back()},p=()=>{c.value=!c.value};return(e,n)=>t.value?((0,r.uX)(),(0,r.CE)("div",Px,[(0,r.Lk)("div",Dx,[n[0]||(n[0]=(0,r.Lk)("div",{class:"error-icon"},"⚠️",-1)),(0,r.Lk)("h2",null,(0,o.v_)(e.$t("道法受阻")),1),(0,r.Lk)("p",zx,(0,o.v_)(s.value),1),c.value?((0,r.uX)(),(0,r.CE)("div",Nx,[(0,r.Lk)("pre",null,(0,o.v_)(l.value),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",$x,[(0,r.Lk)("button",{onClick:d,class:"btn-retry"},(0,o.v_)(e.$t("重试")),1),(0,r.Lk)("button",{onClick:u,class:"btn-back"},(0,o.v_)(e.$t("返回")),1),(0,r.Lk)("button",{onClick:p,class:"btn-details"},(0,o.v_)(c.value?e.$t("隐藏详情"):e.$t("查看详情")),1)])])])):(0,r.RG)(e.$slots,"default",{key:1})}});var Fx=t(5674),jx={};jx.styleTagTransform=A(),jx.setAttributes=k(),jx.insert=y().bind(null,"head"),jx.domAPI=g(),jx.insertStyleElement=_(),h()(Fx.A,jx),Fx.A&&Fx.A.locals&&Fx.A.locals;const Bx=(0,E.A)(Ox,[["__scopeId","data-v-7ca07f60"]]);var Xx=t(5099);const Ux={class:"sect-migration"},Wx={class:"migration-header"},qx={key:0,class:"migration-reasons"},Gx={class:"migration-meta"},Hx={class:"meta-item"},Vx={class:"value"},Qx={class:"meta-item"},Kx={class:"value"},Yx={class:"meta-item"},Jx={class:"value"},Zx={class:"migration-actions"},ek=["disabled"],nk=["disabled"],tk=(0,r.pM)({__name:"SectMigrationModal",props:{reasons:{},fromVersion:{},toVersion:{}},setup(e){const n=e,t=(0,Ec.useCharacterStore)(),a=(0,Hu.useGameStateStore)(),s=(0,$.useUIStore)(),l=(0,i.KR)(!1),c=(0,r.EW)(()=>n.toVersion??hp.BE),d=(0,r.EW)(()=>n.reasons?.length?n.reasons:["检测到旧版势力字段"]),u=(0,r.EW)(()=>{const e=a.sectMemberInfo?.势力名称,n=a.sectSystem?.当前势力??void 0;return e||n||"未加入势力"}),p=(0,r.EW)(()=>{const e=a.sectSystem;return e?.势力档案?Object.keys(e.势力档案).length:a.worldInfo?.势力信息?.length||0}),v=(0,r.EW)(()=>t.activeCharacterProfile?.模式||"未知"),f=async()=>{if(!l.value){l.value=!0;try{const e=a.getCurrentSaveData();if(!e)return void _e.o.error("未找到存档数据，无法迁移");await(async e=>{const n=t.rootState.当前激活存档,a=t.activeCharacterProfile;if(!n||!a)return void _e.o.warning("无法创建备份：未找到激活存档");const r=`势力迁移备份-${(()=>{const e=new Date,n=e=>String(e).padStart(2,"0");return`${e.getFullYear()}${n(e.getMonth()+1)}${n(e.getDate())}-${n(e.getHours())}${n(e.getMinutes())}${n(e.getSeconds())}`})()}`;if("单机"===a.模式)return void await t.saveAsNewSlot(r);await Xx.saveSaveData(n.角色ID,r,e);const o="sect_migration_backups",i={角色ID:n.角色ID,存档槽位:r,时间:(new Date).toISOString()},s=JSON.parse(localStorage.getItem(o)||"[]");s.push(i),localStorage.setItem(o,JSON.stringify(s.slice(-20))),_e.o.success(`已创建本地备份：${r}`)})(e);const n=(0,hp._4)(e);a.loadFromSaveData(n),await t.saveCurrentGame(),_e.o.success("势力存档迁移完成"),s.hideDetailModal()}catch(e){_e.o.error(`势力存档迁移失败：${e instanceof Error?e.message:"未知错误"}`)}finally{l.value=!1}}},h=()=>{s.hideDetailModal()};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",Ux,[(0,r.Lk)("div",Wx,[n[0]||(n[0]=(0,r.Lk)("h4",null,"检测到旧版势力存档",-1)),(0,r.Lk)("p",null,"将把势力数据升级到 V"+(0,o.v_)(c.value)+"，只写入 V3 路径（不再保留旧字段）。",1)]),d.value.length?((0,r.uX)(),(0,r.CE)("div",qx,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:"reason-item"},[n[1]||(n[1]=(0,r.Lk)("span",{class:"dot"},null,-1)),(0,r.Lk)("span",null,(0,o.v_)(e),1)]))),128))])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",Gx,[(0,r.Lk)("div",Hx,[n[2]||(n[2]=(0,r.Lk)("span",{class:"label"},"当前势力",-1)),(0,r.Lk)("span",Vx,(0,o.v_)(u.value),1)]),(0,r.Lk)("div",Qx,[n[3]||(n[3]=(0,r.Lk)("span",{class:"label"},"势力数量",-1)),(0,r.Lk)("span",Kx,(0,o.v_)(p.value),1)]),(0,r.Lk)("div",Yx,[n[4]||(n[4]=(0,r.Lk)("span",{class:"label"},"存档模式",-1)),(0,r.Lk)("span",Jx,(0,o.v_)(v.value),1)])]),(0,r.Lk)("div",Zx,[(0,r.Lk)("button",{class:"primary",disabled:l.value,onClick:f},(0,o.v_)(l.value?"正在迁移...":"创建备份并迁移"),9,ek),(0,r.Lk)("button",{class:"secondary",disabled:l.value,onClick:h}," 稍后再说 ",8,nk)]),n[5]||(n[5]=(0,r.Lk)("p",{class:"migration-hint"}," 迁移前会自动备份：单机模式生成新存档槽，联机模式写入本地备份记录。 ",-1))]))}});var ak=t(2598),rk={};rk.styleTagTransform=A(),rk.setAttributes=k(),rk.insert=y().bind(null,"head"),rk.domAPI=g(),rk.insertStyleElement=_(),h()(ak.A,rk),ak.A&&ak.A.locals&&ak.A.locals;const ok=(0,E.A)(tk,[["__scopeId","data-v-64eb4168"]]),ik={class:"game-view"},sk={class:"sidebar-wrapper"},lk={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ck=["points"],dk={class:"main-content"},uk={key:0,class:"panel-overlay"},pk={class:"panel-header compact","aria-label":"功能面板导航"},vk=["title","aria-label"],fk={class:"panel-title-compact"},hk={class:"title-text"},mk={class:"panel-actions"},gk=["title","onClick","aria-label"],bk={class:"panel-content compact"},yk={class:"panel-shell"},xk={key:2,class:"panel-overlay"},kk={class:"panel-header"},wk={class:"panel-title"},_k=["title"],Ck={class:"panel-content"},Ak={class:"panel-shell"},Sk={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Lk=["points"],Ek={class:"sidebar-wrapper"},Tk={class:"data-loading"},Ik={class:"loading-content"},Rk={class:"loading-title"},Mk={class:"loading-message"},Pk={class:"loading-steps"},Dk={class:"loading-step"},zk={class:"step-text"},Nk={class:"loading-step"},$k={class:"step-text"},Ok={class:"loading-step active"},Fk={class:"step-text"},jk={class:"loading-hint"},Bk=(0,r.pM)({__name:"GameView",setup(e){const n=(0,Ec.useCharacterStore)(),t=(0,Hu.useGameStateStore)(),l=(0,$.useUIStore)(),c=(0,a.rd)(),d=(0,a.lq)(),u=(0,i.KR)(!1),p=(0,i.KR)(!1),v=(0,i.KR)(!1),f=()=>{v.value=window.innerWidth<=768,v.value&&(u.value=!0,p.value=!0)},h=()=>{u.value=!0,p.value=!0},m=(0,i.KR)(null),g=new Set(["Inventory","CharacterDetails","Memory","Relationships","Cultivation","Techniques","ThousandDao","Settings","Save","WorldMap","Events","Crafting","Sect","SectOverview","SectMembers","SectManagement","SectLibrary","SectTasks","SectContribution","SectWar","GameVariables","Prompts","APIManagement","Travel","BackendAdminPanel"]),b=new Set(["Settings","Prompts","APIManagement","BackendAdminPanel"]),y=new Set(["Memory","Relationships","Cultivation","Techniques","ThousandDao","Settings","Save","Sect","SectOverview","SectMembers","SectManagement","SectLibrary","SectTasks","SectContribution","SectWar"]),x={Inventory:{title:"背包物品",icon:Hc},CharacterDetails:{title:"人物详情",icon:R},Memory:{title:"记忆中心",icon:Vu},Relationships:{title:"人物关系",icon:P},Cultivation:{title:"修炼系统",icon:Qu.A},Techniques:{title:"修炼功法",icon:Ku},ThousandDao:{title:"三千大道",icon:Yu},Settings:{title:"系统设置",icon:ya.A},Save:{title:"保存游戏",icon:Pc.A},WorldMap:{title:"世界地图",icon:Ju},Events:{title:"世界事件",icon:Zu},Crafting:{title:"炼制工坊",icon:ep},Sect:{title:"势力系统",icon:np},SectOverview:{title:"势力概览",icon:np},SectMembers:{title:"势力成员",icon:P},SectManagement:{title:"势力管理",icon:tp},SectLibrary:{title:"势力档案",icon:Qu.A},SectTasks:{title:"势力任务",icon:ap},SectContribution:{title:"贡献兑换",icon:rp},SectWar:{title:"势力战争",icon:op},GameVariables:{title:"游戏变量",icon:ip},Prompts:{title:"提示词管理",icon:Jc.A},APIManagement:{title:"API管理",icon:sp.A},Travel:{title:"联机穿越",icon:lp.A},BackendAdminPanel:{title:"仙官后台",icon:cp}},k=(0,r.EW)(()=>g.has(String(d.name))),w=(0,r.EW)(()=>{const e=String(d.name),n=x[e];return n?.title||"功能面板"}),_=(0,r.EW)(()=>{const e=String(d.name),n=x[e];return n?.icon||dp}),C=()=>{"GameMain"!==d.name&&c.push("/game")},A={Memory:[{key:"refresh",title:"刷新",icon:Fc.A,action:"refresh"},{key:"test",title:"测试转化",icon:up.A,action:"test"},{key:"clear",title:"清理",icon:ba.A,action:"clear"}],Events:[{key:"refresh",title:"刷新",icon:Fc.A,action:"refresh"}],Save:[{key:"refresh",title:"刷新",icon:Fc.A,action:"refresh"},{key:"save",title:"快速存档",icon:Pc.A,action:"save"}],ThousandDao:[{key:"refresh",title:"刷新",icon:Fc.A,action:"refresh"}],GameVariables:[{key:"refresh",title:"刷新数据",icon:Fc.A,action:"refresh"},{key:"export",title:"导出JSON",icon:Pc.A,action:"export"},{key:"stats",title:"数据统计",icon:pp,action:"stats"}]},S=(0,r.EW)(()=>{const e=String(d.name);return(A[e]||[]).map(e=>({key:e.key,title:e.title,icon:e.icon,onClick:()=>fp.emit(e.action)}))}),L=(0,r.EW)(()=>{const e=String(d.name);return!!b.has(e)||!!n.activeCharacterProfile});return(0,r.sV)(async()=>{(()=>{try{const e=localStorage.getItem("dad_game_settings");if(e){const n=JSON.parse(e);if(n.uiScale){const e=n.uiScale/100;document.documentElement.style.setProperty("--ui-scale",e.toString())}if(n.fontSize){const e={small:"0.875rem",medium:"1rem",large:"1.125rem"}[n.fontSize]||"1rem";document.documentElement.style.setProperty("--base-font-size",e)}if(n.theme){let e=n.theme;"auto"===n.theme&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme",e)}}}catch(e){console.error("[GameView] 应用设置失败:",e)}})(),f(),window.addEventListener("resize",f)}),(0,r.xo)(()=>{window.removeEventListener("resize",f)}),(0,r.wB)(()=>[t.isGameLoaded,n.rootState.当前激活存档?.角色ID,n.rootState.当前激活存档?.存档槽位],([e])=>{e?(()=>{if(!t.isGameLoaded)return;const e=(()=>{const e=n.rootState.当前激活存档;return e?`${e.角色ID}::${e.存档槽位}`:null})();if(!e||m.value===e)return;const a=t.getCurrentSaveData(),r=(0,hp.xF)(a);r.needed&&(m.value=e,l.showDetailModal({title:"宗门存档迁移",component:ok,props:{reasons:r.reasons,fromVersion:r.fromVersion,toVersion:r.toVersion}}))})():m.value=null},{immediate:!0}),(0,r.wB)(k,e=>{if(e){const e=String(d.name);v.value&&(u.value=!0),y.has(e)&&(p.value=!0)}}),(e,n)=>{const t=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",ik,[(0,r.Q3)(" 顶部栏 "),(0,r.bF)(Fp),(0,r.Q3)(" 主要内容区域 "),L.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,o.C4)(["game-content",{"panel-mode":k.value}])},[(0,r.Q3)(" 左侧功能栏 "),(0,r.Lk)("div",{class:(0,o.C4)(["left-sidebar",{collapsed:u.value}])},[(0,r.Lk)("div",sk,[(0,r.bF)(Of)])],2),(0,r.Q3)(" Mobile Overlay "),!v.value||u.value&&p.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",{key:0,class:"mobile-sidebar-overlay",onClick:h})),(0,r.Q3)(" 左侧收缩按钮 "),(0,r.Lk)("button",{class:(0,o.C4)(["collapse-btn left",{collapsed:u.value}]),onClick:n[0]||(n[0]=e=>u.value=!u.value)},[((0,r.uX)(),(0,r.CE)("svg",lk,[(0,r.Lk)("polyline",{points:u.value?"9,18 15,12 9,6":"15,18 9,12 15,6"},null,8,ck)]))],2),(0,r.Q3)(" 主游戏区域 "),(0,r.Lk)("div",dk,[(0,r.Q3)(" 功能面板覆盖层 "),k.value?((0,r.uX)(),(0,r.CE)("div",uk,[(0,r.Lk)("div",pk,[(0,r.Lk)("button",{class:"back-btn",onClick:C,title:e.$t("返回"),"aria-label":e.$t("返回")},n[3]||(n[3]=[(0,r.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.Lk)("polyline",{points:"15 18 9 12 15 6"})],-1)]),8,vk),(0,r.Lk)("div",fk,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(_.value),{size:16,class:"panel-title-icon"})),(0,r.Lk)("span",hk,(0,o.v_)(w.value),1)]),(0,r.Lk)("div",mk,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(S.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.key,class:"action-btn-compact",title:e.title,onClick:e.onClick,"aria-label":e.title},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:14}))],8,gk))),128))])]),(0,r.Lk)("div",bk,[(0,r.Lk)("div",yk,[(0,r.bF)(t,null,{default:(0,r.k6)(({Component:e})=>[((0,r.uX)(),(0,r.Wv)(r.PR,null,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e)))],1024))]),_:1})])])])):(0,i.R1)(l).showCharacterManagement?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 正常路由视图 "),(0,r.bF)(t,null,{default:(0,r.k6)(({Component:e})=>[((0,r.uX)(),(0,r.Wv)(r.PR,null,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e)))],1024))]),_:1})],2112)),(0,r.Q3)(" 角色管理面板 "),(0,i.R1)(l).showCharacterManagement?((0,r.uX)(),(0,r.CE)("div",xk,[(0,r.Lk)("div",kk,[(0,r.Lk)("h2",wk,[(0,r.bF)((0,i.R1)(vp),{size:20,class:"panel-title-icon"}),(0,r.eW)(" "+(0,o.v_)(e.$t("角色管理")),1)]),(0,r.Lk)("button",{class:"panel-close-btn",onClick:n[1]||(n[1]=e=>(0,i.R1)(l).closeCharacterManagement()),title:e.$t("关闭")},[(0,r.bF)((0,i.R1)(ed.A),{size:20})],8,_k)]),(0,r.Lk)("div",Ck,[(0,r.Lk)("div",Ak,[(0,r.bF)(Mx,{onBack:(0,i.R1)(l).closeCharacterManagement},null,8,["onBack"])])])])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 右侧收缩按钮 "),(0,r.Lk)("button",{class:(0,o.C4)(["collapse-btn right",{collapsed:p.value}]),onClick:n[2]||(n[2]=e=>p.value=!p.value)},[((0,r.uX)(),(0,r.CE)("svg",Sk,[(0,r.Lk)("polyline",{points:p.value?"15,18 9,12 15,6":"9,18 15,12 9,6"},null,8,Lk)]))],2),(0,r.Q3)(" 右侧区域: 角色信息栏 "),(0,r.bo)((0,r.Lk)("div",{class:(0,o.C4)(["right-panel-area",{collapsed:p.value}])},[(0,r.Lk)("div",Ek,[(0,r.bF)(Bx,null,{default:(0,r.k6)(()=>[(0,r.bF)(tg)]),_:1})])],2),[[s.aG,!k.value]])],2)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 数据未就绪时的提示 "),(0,r.Lk)("div",Tk,[(0,r.Lk)("div",Ik,[n[7]||(n[7]=(0,r.Lk)("div",{class:"loading-spinner-wrapper"},[(0,r.Lk)("div",{class:"loading-spinner"}),(0,r.Lk)("div",{class:"spinner-glow"})],-1)),(0,r.Lk)("h2",Rk,(0,o.v_)(e.$t("道法自然，天地初开")),1),(0,r.Lk)("p",Mk,(0,o.v_)(e.$t("正在加载修仙世界...")),1),(0,r.Lk)("div",Pk,[(0,r.Lk)("div",Dk,[n[4]||(n[4]=(0,r.Lk)("span",{class:"step-icon"},"✓",-1)),(0,r.Lk)("span",zk,(0,o.v_)(e.$t("连接天道")),1)]),(0,r.Lk)("div",Nk,[n[5]||(n[5]=(0,r.Lk)("span",{class:"step-icon"},"✓",-1)),(0,r.Lk)("span",$k,(0,o.v_)(e.$t("加载角色数据")),1)]),(0,r.Lk)("div",Ok,[n[6]||(n[6]=(0,r.Lk)("span",{class:"step-icon"},"○",-1)),(0,r.Lk)("span",Fk,(0,o.v_)(e.$t("读取存档信息")),1)])]),(0,r.Lk)("p",jk,(0,o.v_)(e.$t("提示：请在左侧菜单选择角色并加载存档")),1)])])],2112))])}}});var Xk=t(4961),Uk={};Uk.styleTagTransform=A(),Uk.setAttributes=k(),Uk.insert=y().bind(null,"head"),Uk.domAPI=g(),Uk.insertStyleElement=_(),h()(Xk.A,Uk),Xk.A&&Xk.A.locals&&Xk.A.locals;const Wk=(0,E.A)(Bk,[["__scopeId","data-v-5bc506f3"]]),qk={class:"account-container"},Gk={class:"account-panel"},Hk={class:"header"},Vk={class:"title-row"},Qk={key:0,class:"backend-locked"},Kk={key:0,class:"loading"},Yk={key:1,class:"sections"},Jk=["open"],Zk={class:"section-title"},ew={class:"section-body"},nw={key:0,class:"info-list"},tw={class:"info-label"},aw={class:"info-value"},rw={key:1,class:"info-empty"},ow=(0,r.pM)({__name:"AccountCenter",setup(e){const n=(0,a.rd)(),t=(0,i.KR)((0,O.isBackendConfigured)()),s=(0,i.KR)(!1),l=(0,i.KR)(null),c=(0,r.EW)(()=>!!l.value),d=e=>{if(!e)return"-";const n=new Date(e);return Number.isNaN(n.getTime())?e:n.toLocaleString()},u=(0,r.EW)(()=>[{title:"账号信息",open:!0,items:l.value?[{label:"道号",value:l.value.user_name},{label:"账号ID",value:String(l.value.id)},{label:"注册时间",value:d(l.value.created_at)}]:[],emptyText:"未获取到账号信息"}]),p=()=>{n.push("/")},v=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),l.value=null,_e.o.info("已退出登录"),n.push("/login")};return(0,r.sV)(async()=>{if(t.value)if(localStorage.getItem("access_token")){s.value=!0;try{l.value=await F.Em.get("/api/v1/auth/me")}catch(e){l.value=null,n.push("/login")}finally{s.value=!1}}else n.push("/login")}),(e,n)=>((0,r.uX)(),(0,r.CE)("div",qk,[(0,r.bF)(T),(0,r.Lk)("div",Gk,[(0,r.Lk)("div",Hk,[(0,r.Lk)("div",Vk,[n[0]||(n[0]=(0,r.Lk)("h2",{class:"title"},"账号中心",-1)),(0,r.Lk)("span",{class:(0,o.C4)(["status",{ok:c.value,warn:!c.value}])},(0,o.v_)(c.value?"已登录":"未登录"),3)]),n[1]||(n[1]=(0,r.Lk)("p",{class:"subtitle"},"集中管理账号信息",-1))]),t.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[s.value?((0,r.uX)(),(0,r.CE)("div",Kk,"加载中…")):((0,r.uX)(),(0,r.CE)("div",Yk,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value,e=>((0,r.uX)(),(0,r.CE)("details",{key:e.title,class:"section",open:e.open},[(0,r.Lk)("summary",Zk,(0,o.v_)(e.title),1),(0,r.Lk)("div",ew,[e.items.length?((0,r.uX)(),(0,r.CE)("div",nw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.items,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.label,class:"info-row"},[(0,r.Lk)("span",tw,(0,o.v_)(e.label),1),(0,r.Lk)("span",aw,(0,o.v_)(e.value),1)]))),128))])):((0,r.uX)(),(0,r.CE)("div",rw,(0,o.v_)(e.emptyText||"暂无信息"),1))])],8,Jk))),128))])),(0,r.Lk)("div",{class:"actions"},[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:p},"返回"),(0,r.Lk)("button",{class:"btn danger",onClick:v},"退出登录")])],64)):((0,r.uX)(),(0,r.CE)("div",Qk,[n[2]||(n[2]=(0,r.Lk)("p",null,"未配置后端服务器，账号中心不可用。",-1)),(0,r.Lk)("div",{class:"actions"},[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:p},"返回")])]))])]))}});var iw=t(22),sw={};sw.styleTagTransform=A(),sw.setAttributes=k(),sw.insert=y().bind(null,"head"),sw.domAPI=g(),sw.insertStyleElement=_(),h()(iw.A,sw),iw.A&&iw.A.locals&&iw.A.locals;const lw=(0,E.A)(ow,[["__scopeId","data-v-5ebbff06"]]),cw=(0,I.A)("brain-circuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]),dw=(0,I.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var uw=t(5517);const pw=(0,I.A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),vw=(0,t(810).nY)("actionQueue",()=>{const e=(0,i.KR)([]),n=()=>{console.log("[操作队列] 清空操作队列，共",e.value.length,"个操作"),e.value=[],a()},t=()=>0===e.value.length?"":`\n\n【玩家最近操作】\n在本轮对话前，玩家进行了以下操作：\n${e.value.map(e=>{switch(e.type){case"cultivate":return"大道"===e.itemType?`感悟了《${e.itemName}》大道`:`修炼了《${e.itemName}》功法`;case"equip":return`装备了《${e.itemName}》${e.itemType||"法宝"}`;case"use":return e.description||`使用了《${e.itemName}》`;case"unequip":return`卸下了《${e.itemName}》装备`;case"discard":return`丢弃了《${e.itemName}》`;case"npc_trade":return`尝试与 ${e.npcName} 交易 ${e.itemName}`;case"npc_request":return`向 ${e.npcName} 索要 ${e.itemName}`;case"npc_steal":return`尝试从 ${e.npcName} 身上偷取 ${e.itemName}`;case"npc_memory_summarize":return`你开始整理关于 ${e.npcName} 的记忆碎片，试图从最旧的 ${e.count||10} 条记忆中总结出关键信息。`;default:return e.description}}).map(e=>`• ${e}`).join("\n")}\n\n⚠️ **重要提醒**：请优先基于这些玩家操作来生成回应！先处理和反映这些具体动作的结果，然后再回应用户输入的文本内容。这些操作具有更高的优先级，应该在叙事中得到明确体现。`,a=()=>{try{localStorage.setItem("dao_action_queue",JSON.stringify(e.value))}catch(e){console.warn("[操作队列] 保存到localStorage失败:",e)}};return(()=>{try{const n=localStorage.getItem("dao_action_queue");if(n){const t=JSON.parse(n),a=Date.now()-36e5;e.value=t.filter(e=>e.timestamp>a),console.log("[操作队列] 从存储加载",e.value.length,"个操作")}}catch(e){console.warn("[操作队列] 从localStorage加载失败:",e)}})(),{pendingActions:e,addAction:n=>{const t={...n,id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};"equip"===t.type?e.value=e.value.filter(e=>!("unequip"===e.type&&e.itemName===t.itemName)):"unequip"===t.type&&(e.value=e.value.filter(e=>!("equip"===e.type&&e.itemName===t.itemName))),"cultivate"===t.type&&(e.value=e.value.filter(e=>"cultivate"!==e.type)),"comprehend"===t.type&&(e.value=e.value.filter(e=>"comprehend"!==e.type));const r=e.value.findIndex(e=>e.type===n.type&&e.itemName===n.itemName);-1!==r?e.value[r]=t:e.value.push(t),console.log("[操作队列] 添加操作:",t),a()},removeAction:n=>{const t=e.value.findIndex(e=>e.id===n);if(-1!==t){const n=e.value.splice(t,1)[0];return console.log("[操作队列] 移除操作:",n),a(),n}return null},clearActions:n,getActionPrompt:t,consumeActions:()=>{const e=t();return e&&n(),e}}}),fw=new class{listeners=new Map;on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(n)}off(e,n){this.listeners.get(e)?.delete(n)}async emit(e,n){const t=Array.from(this.listeners.get(e)||[]);for(const e of t)await e(n)}};function hw(e,n=!0){return fw.emit("send",{text:e,focus:n})}class mw{static instance=null;undoActions=[];storageKey="dao_undo_actions";constructor(){this.loadUndoHistoryFromStorage()}static getInstance(){return this.instance||(this.instance=new mw),this.instance}getEquipmentSlotItemId(e){if(!e)return null;if("string"==typeof e)return e;if("object"==typeof e&&null!==e&&"物品ID"in e){const n=e.物品ID;return"string"==typeof n?n:null}return null}ensureEquipmentSlots(e){const n={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},t=e;t.角色||(t.角色={});const a=t.角色.装备??n,r={...n};for(let e=1;e<=6;e++){const n=`装备${e}`;r[n]=this.getEquipmentSlotItemId(a?.[n])??null}return t.角色.装备=r,r}ensureRoleBackpack(e){const n=e;return n.角色||(n.角色={}),n.角色.背包||(n.角色.背包={物品:{},突变结晶:{下级:0,中级:0,上级:0,顶级:0}}),n.角色.背包.物品||(n.角色.背包.物品={}),n.角色.背包.突变结晶||(n.角色.背包.突变结晶={下级:0,中级:0,上级:0,顶级:0}),n.角色.背包}ensureRoleCultivation(e){const n=e;return n.角色||(n.角色={}),n.角色.修炼||(n.角色.修炼={修炼功法:null,修炼状态:{模式:"未修炼"}}),n.角色.修炼}async equipItem(e){const n=vw();try{const a=(0,Hu.useGameStateStore)(),r=a.toSaveData();if(!r)return _e.o.error("存档数据不存在，无法装备"),!1;const o=this.ensureEquipmentSlots(r),i=this.ensureRoleBackpack(r).物品;if(!i||"object"!=typeof i)return _e.o.error("背包数据异常"),!1;const s=i[e.物品ID];if(s&&!0===s.已装备)return _e.o.info(`《${e.名称}》已经装备在身上了`),!1;this.removeConflictingActions(e.物品ID,"unequip");let l=null,c=null;for(let e=1;e<=6;e++){const n=`装备${e}`,t=o[n];if(!t||null===t){l=n;break}}if(!l){l="装备1";const e=o[l];e&&(c=i[e]||null,c&&(i[e]={...c,已装备:!1}))}o[l]=e.物品ID,s&&(i[e.物品ID]={...s,已装备:!0}),console.log("装备操作完成:",{槽位:l,物品:e,装备栏状态:o});const{applyEquipmentBonus:d}=await Promise.resolve().then(t.bind(t,651));d(r,e.物品ID),a.loadFromSaveData(r),await a.saveGame();const u={type:"equip",itemId:e.物品ID,itemName:e.名称,restoreData:{originalSlot:null,replacedItem:c}};return this.undoActions.push(u),this.saveUndoHistoryToStorage(),n.addAction({type:"equip",itemName:e.名称,itemType:e.类型,description:c?`装备了《${e.名称}》，替换了《${c.名称}》`:`装备了《${e.名称}》`}),!0}catch(e){return console.error("装备物品失败:",e),_e.o.error("装备失败"),!1}}async unequipItem(e){const n=vw();try{const a=(0,Hu.useGameStateStore)(),r=a.toSaveData();if(!r)return _e.o.error("装备栏数据不存在"),!1;const o=this.ensureEquipmentSlots(r),i=this.ensureRoleBackpack(r).物品;if(!i||"object"!=typeof i)return _e.o.error("背包数据异常"),!1;const s=i[e.物品ID];if(!s||!0!==s.已装备){_e.o.info(`《${e.名称}》未装备，无法卸下`);let n=!1;for(let t=1;t<=6;t++){const a=`装备${t}`;o[a]===e.物品ID&&(o[a]=null,n=!0)}return n&&(a.loadFromSaveData(r),await a.saveGame()),!1}this.removeConflictingActions(e.物品ID,"equip");let l=null;for(let n=1;n<=6;n++){const t=`装备${n}`;if(o[t]===e.物品ID){l=t;break}}if(!l){_e.o.error("装备栏中未找到该装备，数据可能不一致");const n=this.ensureRoleBackpack(r);return n?.物品?.[e.物品ID]&&(n.物品[e.物品ID].已装备=!1),a.loadFromSaveData(r),await a.saveGame(),!0}o[l]=null,s?(i[e.物品ID]={...s,已装备:!1},console.log("卸下装备完成:",{物品:e.名称,物品ID:e.物品ID,清空槽位:l,已装备状态:!1})):console.warn("背包中未找到物品:",e.物品ID);const{removeEquipmentBonus:c}=await Promise.resolve().then(t.bind(t,651));c(r,e.物品ID),a.loadFromSaveData(r),await a.saveGame();const d={type:"unequip",itemId:e.物品ID,itemName:e.名称,restoreData:{originalSlot:l}};return this.undoActions.push(d),this.saveUndoHistoryToStorage(),n.addAction({type:"unequip",itemName:e.名称,itemType:e.类型,description:`卸下了《${e.名称}》`}),!0}catch(e){return console.error("卸下装备失败:",e),_e.o.error("卸下失败"),!1}}async useItem(e,n=1){const t=vw();try{const a=(0,Hu.useGameStateStore)(),r=a.toSaveData();if(!r)return _e.o.error("存档数据不存在"),!1;const o=this.ensureRoleBackpack(r),i=o?.物品?.[e.物品ID];if(!i||i.数量<n)return _e.o.error("物品数量不足"),!1;const s=i.数量,l=JSON.parse(JSON.stringify(i));i.数量===n?delete o.物品[e.物品ID]:i.数量-=n,a.updateInventory({物品:o.物品}),await a.saveGame();const c={type:"use",itemId:e.物品ID,itemName:e.名称,quantity:n,restoreData:{originalQuantity:s},itemData:l};this.undoActions.push(c),this.saveUndoHistoryToStorage();const d=["物品","突变结晶"].includes(e.类型)&&"使用效果"in e?e.使用效果:e.描述||"无特殊效果";return t.addAction({type:"use",itemName:e.名称,itemType:e.类型,description:`使用了 ${n} 个《${e.名称}》（效果：${d}）`}),!0}catch(e){return console.error("使用物品失败:",e),_e.o.error("使用失败"),!1}}async cultivateItem(e){return _e.o.error("修炼系统已移除"),!1}async stopCultivation(e){return _e.o.error("修炼系统已移除"),!1}async undoLastAction(){if(0===this.undoActions.length)return _e.o.info("未找到可撤回的动作记录，可能已清空或刷新后丢失"),!1;const e=this.undoActions.pop();this.saveUndoHistoryToStorage();const n=vw();try{const t=(0,Hu.useGameStateStore)().toSaveData();if(!t)return _e.o.error("存档数据不存在"),!1;switch(e.type){case"equip":await this.undoEquip(e,t);break;case"unequip":await this.undoUnequip(e,t);break;case"use":await this.undoUse(e,t)}const a=n.pendingActions;for(let t=a.length-1;t>=0;t--)if(a[t].itemName===e.itemName&&a[t].type===e.type){n.removeAction(a[t].id);break}return!0}catch(e){return console.error("撤回动作失败:",e),_e.o.error("撤回失败"),!1}}async undoByItemName(e,n){if(0===this.undoActions.length)return _e.o.info("未找到可撤回的动作记录，可能已清空或刷新后丢失"),!1;let t=-1;for(let a=this.undoActions.length-1;a>=0;a--){const r=this.undoActions[a];if(r.type===e&&r.itemName===n){t=a;break}}if(-1===t)return _e.o.info("未找到该动作的撤回记录"),!1;const a=this.undoActions.splice(t,1)[0];this.saveUndoHistoryToStorage();try{const t=(0,Hu.useGameStateStore)(),r=t.toSaveData();if(!r)return _e.o.error("当前存档不存在，无法撤回"),!1;switch(a.type){case"equip":await this.undoEquip(a,r);break;case"unequip":await this.undoUnequip(a,r);break;case"use":await this.undoUse(a,r)}const o=vw(),i=o.pendingActions;for(let t=i.length-1;t>=0;t--)if(i[t].itemName===n&&i[t].type===e){o.removeAction(i[t].id);break}return t.loadFromSaveData(r),await t.saveGame(),!0}catch(e){return console.error("按名称撤回失败:",e),_e.o.error("撤回失败"),!1}}async undoEquip(e,n){const a=this.ensureEquipmentSlots(n),r=this.ensureRoleBackpack(n).物品;for(let o=1;o<=6;o++){const i=`装备${o}`;if(a[i]===e.itemId){const{removeEquipmentBonus:o}=await Promise.resolve().then(t.bind(t,651));if(o(n,e.itemId),a[i]=null,r?.[e.itemId]){const n=r[e.itemId];r[e.itemId]={...n,已装备:!1}}if(e.restoreData?.replacedItem){const{applyEquipmentBonus:o}=await Promise.resolve().then(t.bind(t,651));if(o(n,e.restoreData.replacedItem.物品ID),a[i]=e.restoreData.replacedItem.物品ID,r?.[e.restoreData.replacedItem.物品ID]){const n=r[e.restoreData.replacedItem.物品ID];r[e.restoreData.replacedItem.物品ID]={...n,已装备:!0}}}break}}}removeUndoAction(e,n){const t=this.undoActions.findIndex(t=>t.type===e&&t.itemName===n);-1!==t&&(this.undoActions.splice(t,1),this.saveUndoHistoryToStorage(),console.log("[撤销历史] 移除了一个已抵消的动作:",{type:e,itemName:n}))}async undoUnequip(e,n){if(!e.restoreData?.originalSlot)return;const a=e.restoreData.originalSlot;this.ensureEquipmentSlots(n)[a]=e.itemId;const r=this.ensureRoleBackpack(n).物品;if(r?.[e.itemId]){const n=r[e.itemId];r[e.itemId]={...n,已装备:!0}}const{applyEquipmentBonus:o}=await Promise.resolve().then(t.bind(t,651));o(n,e.itemId)}async undoUse(e,n){e.itemData?this.ensureRoleBackpack(n).物品[e.itemId]=JSON.parse(JSON.stringify(e.itemData)):_e.o.warning("物品已完全消失，且无备份数据，无法恢复")}async undoCultivate(e,n){}clearUndoHistory(){this.undoActions=[],this.saveUndoHistoryToStorage()}getUndoActionsCount(){return this.undoActions.length}removeConflictingActions(e,n){const t=vw(),a=t.pendingActions.filter(t=>t.itemName&&t.type===n&&this.findItemByName(t.itemName)?.物品ID===e);a.forEach(e=>{t.removeAction(e.id)}),this.undoActions=this.undoActions.filter(t=>!(t.itemId===e&&t.type===n)),this.saveUndoHistoryToStorage(),a.length>0&&_e.o.info("已移除冲突的操作")}findItemByName(e){const n=(0,Hu.useGameStateStore)().toSaveData();if(!n)return null;const t=this.ensureEquipmentSlots(n),a=this.ensureRoleBackpack(n).物品;if(a)for(const n of Object.values(a))if(n&&"object"==typeof n&&n.名称===e)return n;for(let n=1;n<=6;n++){const r=t[`装备${n}`];if(!r)continue;const o=a?.[r];if(o&&o.名称===e)return o}return null}async syncEquipmentToTavern(e){console.warn("[装备同步] syncEquipmentToTavern 已废弃，新架构中数据由 gameStateStore 统一管理")}async syncInventoryToTavern(e){console.warn("[背包同步] syncInventoryToTavern 已废弃，新架构中数据由 gameStateStore 统一管理")}saveUndoHistoryToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.undoActions))}catch(e){console.warn("[撤回历史] 保存失败:",e)}}loadUndoHistoryFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const n=JSON.parse(e);Array.isArray(n)&&(this.undoActions=n)}}catch(e){console.warn("[撤回历史] 加载失败:",e)}}}var gw=t(6589),bw=t(7445),yw=t(9207);const xw={class:"formatted-text"},kw={class:"card-icon"},ww={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},_w={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Cw={key:2,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Aw={class:"card-content"},Sw={class:"card-header"},Lw={class:"header-right"},Ew={class:"judgement-badge"},Tw={class:"card-body"},Iw={class:"stat-info"},Rw={class:"stat-value lucky-value"},Mw={key:1,class:"stat-item"},Pw={class:"stat-info"},Dw={class:"stat-value"},zw={key:2,class:"stat-item difficulty-item"},Nw={class:"stat-info"},$w={class:"stat-value"},Ow={key:3,class:"stat-item"},Fw={class:"stat-info"},jw={class:"stat-value"},Bw={key:4,class:"stat-item"},Xw={class:"stat-info"},Uw={class:"stat-value"},Ww={key:5,class:"details-list"},qw={class:"detail-label"},Gw={class:"detail-value"},Hw={key:0,class:"detail-source"},Vw={class:"help-modal-header"},Qw={class:"help-modal-content"},Kw={class:"help-section"},Yw={class:"formula-box"},Jw={class:"note"},Zw={class:"help-section"},e_={class:"formula-note"},n_={class:"result-list"},t_={class:"result-item perfect"},a_={class:"result-label"},r_={class:"result-desc"},o_={class:"result-item great-success"},i_={class:"result-label"},s_={class:"result-desc"},l_={class:"result-item success"},c_={class:"result-label"},d_={class:"result-desc"},u_={class:"result-item failure"},p_={class:"result-label"},v_={class:"result-desc"},f_={class:"result-item critical-failure"},h_={class:"result-label"},m_={class:"result-desc"},g_={class:"help-section"},b_={class:"judgement-types"},y_={class:"type-item"},x_={class:"type-name"},k_={class:"type-attrs"},w_={class:"type-item"},__={class:"type-name"},C_={class:"type-attrs"},A_={class:"type-item"},S_={class:"type-name"},L_={class:"type-attrs"},E_={class:"type-item"},T_={class:"type-name"},I_={class:"type-attrs"},R_={class:"type-item"},M_={class:"type-name"},P_={class:"type-attrs"},D_={class:"help-section"},z_={class:"attributes-desc"},N_={class:"attr-card"},$_={class:"attr-header"},O_={class:"attr-name"},F_={class:"attr-card"},j_={class:"attr-header"},B_={class:"attr-name"},X_={class:"attr-card"},U_={class:"attr-header"},W_={class:"attr-name"},q_={class:"attr-card"},G_={class:"attr-header"},H_={class:"attr-name"},V_={class:"attr-card"},Q_={class:"attr-header"},K_={class:"attr-name"},Y_={class:"attr-card"},J_={class:"attr-header"},Z_={class:"attr-name"},eC={class:"help-section"},nC={class:"tips-list"},tC=(0,r.pM)({__name:"FormattedText",props:{text:{}},setup(e){const n=(0,i.KR)(!1),t=()=>{n.value=!0},a=()=>{n.value=!1},l=e=>{if(!e)return null;const n=e.match(/[+-]?\d+(?:\.\d+)?/);return n?Number(n[0]):null},c=e=>{const n=e.match(/^([^:：]+)[:：](.+)$/);return n?{key:n[1].trim(),value:n[2].trim()}:null},d=new Set(["系统提示","系统判定","系统","状态变化","状态结算"]),u=e=>{const n=e.trim();if(!n)return null;const t=c(n);if(t&&d.has(t.key))return{title:t.key,result:"提示",dice:"",attribute:"",details:[`内容:${t.value}`]};const a=n.split(/[，,]/).map(e=>e.trim()).filter(Boolean);if(0===a.length)return null;const r=c(a[0]);if(!r)return{title:"系统提示",result:"提示",dice:"",attribute:"",details:[`内容:${n}`]};const o={title:r.key,result:r.value,dice:"",attribute:"",details:[]};for(let e=1;e<a.length;e++){const n=c(a[e]);if(!n){o.details?.push(`备注:${a[e]}`);continue}const t=n.key,r=n.value;t&&r&&(t.includes("难度")?o.difficulty=r:t.includes("判定值")||t.includes("最终值")||t.includes("总值")?o.finalValue=r:t.includes("幸运")?o.lucky=r:t.includes("加成")?o.bonus=r:t.includes("造成伤害")?o.damage=r:t.includes("剩余生命值")?o.remainingHp=r:t.includes("骰点")||t.includes("骰子")?o.dice=r:o.details?.push(`${t}:${r}`))}const i=l(o.finalValue),s=l(o.difficulty);if(null!==i&&null!==s){const e=(u=i)>=(p=s)+30?"完美":u>=p+15?"大成功":u>=p?"成功":u<p-15?"大失败":"失败";e&&e!==o.result&&(o.details=o.details||[],o.details.push(`结果校验:${o.result}→${e}`),o.result=e)}var u,p;return o},p=e,v=(e,n)=>{let t=0;for(;t<e.length;){const a=e.indexOf("**",t);let r=e.indexOf("*",t);-1!==r&&"*"===e[r+1]&&(r=e.indexOf("*",r+2));let o=-1,i=null;if(-1!==a&&(-1===r||a<r)?(o=a,i="bold"):-1!==r&&(o=r,i="italic"),-1===o){t<e.length&&n.push({type:"normal",content:e.slice(t)});break}if(o>t&&n.push({type:"normal",content:e.slice(t,o)}),"bold"===i){const a=e.indexOf("**",o+2);if(-1===a){n.push({type:"normal",content:e.slice(o)});break}n.push({type:"bold",content:e.slice(o+2,a)}),t=a+2}else if("italic"===i){const a=e.indexOf("*",o+1);if(-1===a||"*"===e[a+1]){n.push({type:"normal",content:e.slice(o)});break}n.push({type:"italic",content:e.slice(o+1,a)}),t=a+1}}},f=(0,r.EW)(()=>{const e=[],n=p.text||"";if(!n.trim())return[{type:"normal",content:n}];let t=0;const a=(e=>{const n=e.split("\n"),t=[];for(let e=0;e<n.length;e++){const a=n[e],r=a.trim();if("系统提示"===r||"系统判定"===r)continue;const o=r.match(/^系统提示[:：]\s*(.+)$/);if(o){t.push(`〔系统提示：${o[1].trim()}〕`);continue}const i=r.match(/^系统判定[:：]\s*(.+)$/);if(i)t.push(`〔系统判定：${i[1].trim()}〕`);else{if("【当前状态】"===r){const a=[];let r=e+1;for(;r<n.length;r++){const e=n[r].trim();if(!e)break;const t=e[0];if("【"===t||"〔"===t||"〖"===t||"`"===t||'"'===t||"“"===t||"「"===t)break;if(a.push(e),a.length>=8){r++;break}}a.length>0&&(t.push(`〔状态变化：${a.join("；")}〕`),e=r-1);continue}t.push(a)}}return t.join("\n")})(n.replace(/\\\\/g,"\n").replace(/\\n/g,"\n").replace(/\r\n/g,"\n").replace(/\r/g,"\n"));for(;t<a.length;){const n=[],r=a.indexOf("【",t);if(-1!==r){const e=a.indexOf("】",r+1);-1!==e&&n.push({start:r,end:e+1,type:"environment",contentStart:r+1,contentEnd:e})}const o=a.indexOf("``",t);if(-1!==o){const e=a.indexOf("``",o+2);-1!==e&&n.push({start:o,end:e+2,type:"psychology",contentStart:o+2,contentEnd:e})}const i=a.indexOf("`",t);if(-1!==i&&!a.startsWith("``",i)){const e=a.indexOf("`",i+1);-1!==e&&n.push({start:i,end:e+1,type:"psychology",contentStart:i+1,contentEnd:e})}const s=a.indexOf('"',t);if(-1!==s){const e=a.indexOf('"',s+1);-1!==e&&n.push({start:s,end:e+1,type:"dialogue",contentStart:s+1,contentEnd:e})}const l=a.indexOf("“",t);if(-1!==l){const e=a.indexOf("”",l+1);-1!==e&&n.push({start:l,end:e+1,type:"quote",contentStart:l,contentEnd:e+1})}const c=a.indexOf("「",t);if(-1!==c){const e=a.indexOf("」",c+1);-1!==e&&n.push({start:c,end:e+1,type:"dialogue",contentStart:c,contentEnd:e+1})}const d=a.indexOf("〔",t);if(-1!==d){const e=a.indexOf("〕",d+1);-1!==e&&n.push({start:d,end:e+1,type:"judgement",contentStart:d+1,contentEnd:e,wrapStart:"〔",wrapEnd:"〕"})}const p=a.indexOf("〖",t);if(-1!==p){const e=a.indexOf("〗",p+1);-1!==e&&n.push({start:p,end:e+1,type:"judgement",contentStart:p+1,contentEnd:e,wrapStart:"〖",wrapEnd:"〗"})}const f=n.filter(e=>e.start>=t&&e.contentStart<e.contentEnd).sort((e,n)=>e.start-n.start);if(0===f.length){t<a.length&&v(a.slice(t),e);break}const h=f[0];if(h.start>t){const n=a.slice(t,h.start);n&&v(n,e)}const m=a.slice(h.contentStart,h.contentEnd);if(m.trim())if("judgement"===h.type){const n=u(m);if(n)e.push({type:"judgement-card",content:n});else{const n=h.wrapStart??"〔",t=h.wrapEnd??"〕";e.push({type:"normal",content:`${n}${m}${t}`})}}else e.push({type:h.type,content:a.slice(h.start,h.end)});t=h.end}return e.length>0?e:[{type:"normal",content:n}]}),h=e=>["成功","大成功","完美","通过"].includes(e),m=e=>["失败","大失败","失败惨重","未通过"].includes(e),g=e=>e.split(":")[0]+":",b=e=>{const n=e.split(":");if(n.length<2)return"";const t=n[1],a=t.match(/^([+-]?\d+)/);return a?a[1]:t.split("(")[0].trim()},y=e=>{const n=e.split(":");if(n.length<2)return"";const t=n[1].match(/\(([^)]+)\)/);return t?`(${t[1]})`:""};return(e,i)=>((0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",xw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(f.value,(e,n)=>{return(0,r.uX)(),(0,r.CE)(r.FK,{key:n},["judgement-card"!==e.type?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,o.C4)((c=e.type,{"text-environment":"environment"===c,"text-psychology":"psychology"===c,"text-dialogue":"dialogue"===c,"text-quote":"quote"===c,"text-bold":"bold"===c,"text-italic":"italic"===c,"text-normal":"normal"===c}))},(0,o.v_)(e.content),3)):(l=e.content,"object"==typeof l&&null!==l&&"title"in l?((0,r.uX)(),(0,r.CE)("div",{key:1,class:(0,o.C4)(["judgement-card",{"is-success":h(e.content.result),"is-failure":m(e.content.result),"is-great-success":e.content.result?.includes("大成功"),"is-great-failure":e.content.result?.includes("大失败")}])},[(0,r.Lk)("div",kw,[h(e.content.result)?((0,r.uX)(),(0,r.CE)("svg",ww,i[1]||(i[1]=[(0,r.Lk)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),(0,r.Lk)("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)]))):m(e.content.result)?((0,r.uX)(),(0,r.CE)("svg",_w,i[2]||(i[2]=[(0,r.Lk)("circle",{cx:"12",cy:"12",r:"10"},null,-1),(0,r.Lk)("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),(0,r.Lk)("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)]))):((0,r.uX)(),(0,r.CE)("svg",Cw,i[3]||(i[3]=[(0,r.Lk)("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},null,-1),(0,r.Lk)("line",{x1:"12",y1:"9",x2:"12",y2:"13"},null,-1),(0,r.Lk)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"},null,-1)])))]),(0,r.Lk)("div",Aw,[(0,r.Lk)("div",Sw,[(0,r.Lk)("span",{class:(0,o.C4)(["judgement-title",(a=e.content.result,a?.includes("完美")?"title-perfect":a?.includes("大成功")?"title-great-success":a?.includes("成功")||a?.includes("通过")?"title-success":a?.includes("大失败")||a?.includes("失败惨重")?"title-great-failure":a?.includes("失败")||a?.includes("未通过")?"title-failure":"")])},(0,o.v_)(e.content.title),3),(0,r.Lk)("div",Lw,[(0,r.Lk)("span",Ew,(0,o.v_)(e.content.result),1),(0,r.Lk)("button",{class:"help-btn",onClick:(0,s.D$)(t,["stop"]),title:"查看判定规则"},i[4]||(i[4]=[(0,r.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,r.Lk)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.Lk)("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),(0,r.Lk)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})],-1)]))])]),(0,r.Lk)("div",Tw,[e.content.lucky?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,o.C4)(["stat-item lucky-item",{"lucky-positive":parseInt(e.content.lucky)>=0,"lucky-negative":parseInt(e.content.lucky)<0}])},[i[6]||(i[6]=(0,r.Lk)("span",{class:"stat-icon"},"🍀",-1)),(0,r.Lk)("div",Iw,[i[5]||(i[5]=(0,r.Lk)("span",{class:"stat-label"},"幸运",-1)),(0,r.Lk)("span",Rw,(0,o.v_)(e.content.lucky),1)])],2)):(0,r.Q3)("v-if",!0),e.content.finalValue?((0,r.uX)(),(0,r.CE)("div",Mw,[i[8]||(i[8]=(0,r.Lk)("span",{class:"stat-icon"},"✨",-1)),(0,r.Lk)("div",Pw,[i[7]||(i[7]=(0,r.Lk)("span",{class:"stat-label"},"判定值",-1)),(0,r.Lk)("span",Dw,(0,o.v_)(e.content.finalValue),1)])])):(0,r.Q3)("v-if",!0),e.content.difficulty?((0,r.uX)(),(0,r.CE)("div",zw,[i[10]||(i[10]=(0,r.Lk)("span",{class:"stat-icon"},"🎯",-1)),(0,r.Lk)("div",Nw,[i[9]||(i[9]=(0,r.Lk)("span",{class:"stat-label"},"难度",-1)),(0,r.Lk)("span",$w,(0,o.v_)(e.content.difficulty),1)])])):(0,r.Q3)("v-if",!0),e.content.damage?((0,r.uX)(),(0,r.CE)("div",Ow,[i[12]||(i[12]=(0,r.Lk)("span",{class:"stat-icon"},"⚔️",-1)),(0,r.Lk)("div",Fw,[i[11]||(i[11]=(0,r.Lk)("span",{class:"stat-label"},"伤害",-1)),(0,r.Lk)("span",jw,(0,o.v_)(e.content.damage),1)])])):(0,r.Q3)("v-if",!0),e.content.remainingHp?((0,r.uX)(),(0,r.CE)("div",Bw,[i[14]||(i[14]=(0,r.Lk)("span",{class:"stat-icon"},"❤️",-1)),(0,r.Lk)("div",Xw,[i[13]||(i[13]=(0,r.Lk)("span",{class:"stat-label"},"剩余生命值",-1)),(0,r.Lk)("span",Uw,(0,o.v_)(e.content.remainingHp),1)])])):(0,r.Q3)("v-if",!0),e.content.details&&e.content.details.length>0?((0,r.uX)(),(0,r.CE)("div",Ww,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.content.details,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{class:"detail-item",key:n},[(0,r.Lk)("span",qw,(0,o.v_)(g(e)),1),(0,r.Lk)("span",Gw,(0,o.v_)(b(e)),1),y(e)?((0,r.uX)(),(0,r.CE)("span",Hw,(0,o.v_)(y(e)),1)):(0,r.Q3)("v-if",!0)]))),128))])):(0,r.Q3)("v-if",!0)])])],2)):(0,r.Q3)("v-if",!0))],64);var a,l,c}),128))]),(0,r.Q3)(" 判定规则帮助弹窗 "),((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[n.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"help-modal-overlay",onClick:a},[(0,r.Lk)("div",{class:"help-modal",onClick:i[0]||(i[0]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",Vw,[(0,r.Lk)("h3",null,"🍀 "+(0,o.v_)(e.$t("判定规则说明")),1),(0,r.Lk)("button",{class:"close-btn",onClick:a},i[15]||(i[15]=[(0,r.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,r.Lk)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,r.Lk)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),(0,r.Lk)("div",Qw,[(0,r.Lk)("div",Kw,[(0,r.Lk)("h4",null,"📊 "+(0,o.v_)(e.$t("判定计算公式"))+" (v7.0)",1),(0,r.Lk)("div",Yw,[(0,r.Lk)("strong",null,(0,o.v_)(e.$t("最终判定值")),1),(0,r.eW)(" = "+(0,o.v_)(e.$t("基础值"))+" + "+(0,o.v_)(e.$t("幸运点"))+" + "+(0,o.v_)(e.$t("环境修正"))+" + "+(0,o.v_)(e.$t("状态修正")),1)]),(0,r.Lk)("ol",null,[(0,r.Lk)("li",null,[(0,r.Lk)("strong",null,(0,o.v_)(e.$t("基础值")),1),(0,r.eW)("："+(0,o.v_)(e.$t("先天属性加权 + 觉醒阶段加成 + 技艺加成")),1)]),(0,r.Lk)("li",null,[(0,r.Lk)("strong",null,(0,o.v_)(e.$t("幸运点")),1),(0,r.eW)("："+(0,o.v_)(e.$t("基于幸运的随机波动（约-10到+15）"))+" ",1),(0,r.Lk)("span",Jw,"("+(0,o.v_)(e.$t("幸运越高，期望值和上限越高"))+")",1)]),(0,r.Lk)("li",null,[(0,r.Lk)("strong",null,(0,o.v_)(e.$t("环境修正")),1),(0,r.eW)("："+(0,o.v_)(e.$t("能量浓度影响（异能/探索/战斗），探索社交不受影响")),1)]),(0,r.Lk)("li",null,[(0,r.Lk)("strong",null,(0,o.v_)(e.$t("状态修正")),1),(0,r.eW)("："+(0,o.v_)(e.$t("生命状态（重伤/虚弱）及 Buff/Debuff 影响")),1)])])]),(0,r.Lk)("div",Zw,[(0,r.Lk)("h4",null,"🎯 "+(0,o.v_)(e.$t("判定结果")),1),(0,r.Lk)("div",e_,[(0,r.Lk)("strong",null,(0,o.v_)(e.$t("判定规则")),1),(0,r.eW)(": "+(0,o.v_)(e.$t("判定值与难度对比，完全基于属性、觉醒阶段和加成")),1)]),(0,r.Lk)("div",n_,[(0,r.Lk)("div",t_,[(0,r.Lk)("span",a_,(0,o.v_)(e.$t("完美")),1),(0,r.Lk)("span",r_,(0,o.v_)(e.$t("判定值 ≥ 难度+30")),1)]),(0,r.Lk)("div",o_,[(0,r.Lk)("span",i_,(0,o.v_)(e.$t("大成功")),1),(0,r.Lk)("span",s_,(0,o.v_)(e.$t("判定值 ≥ 难度+15，超额完成")),1)]),(0,r.Lk)("div",l_,[(0,r.Lk)("span",c_,(0,o.v_)(e.$t("成功")),1),(0,r.Lk)("span",d_,(0,o.v_)(e.$t("判定值 ≥ 难度，达成目标")),1)]),(0,r.Lk)("div",u_,[(0,r.Lk)("span",p_,(0,o.v_)(e.$t("失败")),1),(0,r.Lk)("span",v_,(0,o.v_)(e.$t("判定值 < 难度，未达成")),1)]),(0,r.Lk)("div",f_,[(0,r.Lk)("span",h_,(0,o.v_)(e.$t("大失败")),1),(0,r.Lk)("span",m_,(0,o.v_)(e.$t("判定值远低于难度（难度-15以下）")),1)])])]),(0,r.Lk)("div",g_,[(0,r.Lk)("h4",null,"⚔️ "+(0,o.v_)(e.$t("判定类型与属性配比")),1),(0,r.Lk)("div",b_,[(0,r.Lk)("div",y_,[(0,r.Lk)("span",x_,(0,o.v_)(e.$t("战斗判定")),1),(0,r.Lk)("span",k_,(0,o.v_)(e.$t("力量50% + 敏捷30% + 气运20%")),1)]),(0,r.Lk)("div",w_,[(0,r.Lk)("span",__,(0,o.v_)(e.$t("异能判定")),1),(0,r.Lk)("span",C_,(0,o.v_)(e.$t("意志50% + 敏捷30% + 体质20%")),1)]),(0,r.Lk)("div",A_,[(0,r.Lk)("span",S_,(0,o.v_)(e.$t("技艺判定")),1),(0,r.Lk)("span",L_,(0,o.v_)(e.$t("意志50% + 力量30% + 敏捷20%")),1)]),(0,r.Lk)("div",E_,[(0,r.Lk)("span",T_,(0,o.v_)(e.$t("社交判定")),1),(0,r.Lk)("span",I_,(0,o.v_)(e.$t("魅力50% + 意志30% + 体质20%")),1)]),(0,r.Lk)("div",R_,[(0,r.Lk)("span",M_,(0,o.v_)(e.$t("探索判定")),1),(0,r.Lk)("span",P_,(0,o.v_)(e.$t("幸运50% + 敏捷30% + 意志20%")),1)])])]),(0,r.Lk)("div",D_,[(0,r.Lk)("h4",null,"📖 "+(0,o.v_)(e.$t("属性说明")),1),(0,r.Lk)("div",z_,[(0,r.Lk)("div",N_,[(0,r.Lk)("div",$_,[i[16]||(i[16]=(0,r.Lk)("span",{class:"attr-icon"},"💪",-1)),(0,r.Lk)("span",O_,(0,o.v_)(e.$t("力量")),1)]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("决定生命值上限、恢复速度、寿命上限。影响肉体强化、抗打击能力。")),1)]),(0,r.Lk)("div",F_,[(0,r.Lk)("div",j_,[i[17]||(i[17]=(0,r.Lk)("span",{class:"attr-icon"},"✨",-1)),(0,r.Lk)("span",B_,(0,o.v_)(e.$t("敏捷")),1)]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("决定能量上限、吸收效率。影响异能释放速度、反应能力。")),1)]),(0,r.Lk)("div",X_,[(0,r.Lk)("div",U_,[i[18]||(i[18]=(0,r.Lk)("span",{class:"attr-icon"},"🧠",-1)),(0,r.Lk)("span",W_,(0,o.v_)(e.$t("意志")),1)]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("决定精神值上限、学习效率。影响异能掌控、技能掌握速度。")),1)]),(0,r.Lk)("div",q_,[(0,r.Lk)("div",G_,[i[19]||(i[19]=(0,r.Lk)("span",{class:"attr-icon"},"🍀",-1)),(0,r.Lk)("span",H_,(0,o.v_)(e.$t("幸运")),1)]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("决定各种概率、物品掉落品质。影响稀有物资获取、意外之喜。")),1)]),(0,r.Lk)("div",V_,[(0,r.Lk)("div",Q_,[i[20]||(i[20]=(0,r.Lk)("span",{class:"attr-icon"},"🌺",-1)),(0,r.Lk)("span",K_,(0,o.v_)(e.$t("魅力")),1)]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("决定初始好感度、社交加成。影响NPC互动、势力声望获取。")),1)]),(0,r.Lk)("div",Y_,[(0,r.Lk)("div",J_,[i[21]||(i[21]=(0,r.Lk)("span",{class:"attr-icon"},"🧬",-1)),(0,r.Lk)("span",Z_,(0,o.v_)(e.$t("体质")),1)]),(0,r.Lk)("p",null,(0,o.v_)(e.$t("决定身体抗性、承载力。影响基因崩溃抵抗、副作用承受。")),1)])])]),(0,r.Lk)("div",eC,[(0,r.Lk)("h4",null,"💡 "+(0,o.v_)(e.$t("提升判定成功率")),1),(0,r.Lk)("ul",nC,[(0,r.Lk)("li",null,(0,o.v_)(e.$t("先天属性：天赋决定上限，无法改变但影响最大")),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("提升阶段：觉醒阶段越高，判定基础加成越大（觉醒期+5，掌控期+12...）")),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("强化后天：后天属性可提升，但权重仅20%")),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("掌握异能：高阶异能和技能熟练度提供显著加成")),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("装备道具：合适的装备能大幅提升判定值")),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("状态效果：buff增强判定，注意避免debuff")),1),(0,r.Lk)("li",null,(0,o.v_)(e.$t("阶位压制：高阶段对低阶段有明显优势，但不是绝对")),1)])])])])])):(0,r.Q3)("v-if",!0)]))],64))}});var aC=t(728),rC={};rC.styleTagTransform=A(),rC.setAttributes=k(),rC.insert=y().bind(null,"head"),rC.domAPI=g(),rC.insertStyleElement=_(),h()(aC.A,rC),aC.A&&aC.A.locals&&aC.A.locals;const oC=(0,E.A)(tC,[["__scopeId","data-v-b97c9eb8"]]),iC={class:"main-game-panel"},sC={key:0,class:"memory-section"},lC={class:"memory-title"},cC={key:0,class:"memory-dropdown"},dC={class:"memory-content"},uC={key:0,class:"no-memory"},pC={class:"current-narrative"},vC={key:0,class:"ai-processing-indicator"},fC={class:"streaming-meta"},hC={class:"narrative-time"},mC={class:"streaming-indicator"},gC={class:"streaming-text"},bC=["title"],yC={key:1,class:"thinking-section"},xC={class:"thinking-title"},kC={key:0,class:"thinking-badge streaming"},wC={key:1,class:"thinking-badge completed"},_C={key:0,class:"thinking-content"},CC={key:2,class:"streaming-narrative-content"},AC={class:"streaming-text"},SC={class:"narrative-content"},LC={class:"narrative-meta"},EC={class:"narrative-time"},TC={class:"meta-buttons"},IC=["title"],RC=["title"],MC=["title"],PC=["disabled","title"],DC={class:"update-count"},zC={class:"narrative-text"},NC={key:0,class:"action-options"},$C=["onClick"],OC={key:4,class:"empty-narrative"},FC={class:"input-section"},jC={key:0,class:"action-queue-display"},BC={class:"queue-header"},XC={class:"queue-title"},UC=["title"],WC={class:"queue-actions"},qC={class:"action-text"},GC={class:"action-controls"},HC=["onClick","title"],VC={class:"input-wrapper"},QC={class:"input-container"},KC={key:0,class:"image-preview-container"},YC=["src","alt"],JC=["onClick","title"],ZC=["placeholder","disabled"],eA=["disabled"],nA={class:"action-modal"},tA={class:"modal-header"},aA={class:"action-grid"},rA=["onClick"],oA={class:"action-icon"},iA={class:"action-text"},sA={class:"action-config-modal"},lA={class:"config-header"},cA={class:"config-content"},dA={class:"action-description"},uA={key:0,class:"config-section"},pA={class:"config-label"},vA={class:"time-selector"},fA=["onClick"],hA={class:"time-custom"},mA={key:1,class:"config-section"},gA={class:"config-label"},bA={class:"action-options"},yA=["name","value"],xA={class:"config-actions"},kA="__mainGamePanel_eventListenersRegistered__",wA="__mainGamePanel_eventHandlers__",_A=(0,r.pM)({__name:"MainGamePanel",setup(e,{expose:n}){const t=(0,r.EW)(()=>re.value?.stateChanges?.changes||[]),c=(0,r.EW)({get:()=>U.userInputText,set:e=>{U.userInputText=e}}),d=(0,i.KR)(!1),u=(0,r.EW)(()=>U.isAIProcessing),p=(0,r.EW)(()=>U.streamingContent),v=(0,r.EW)(()=>U.currentGenerationId),f=(0,r.EW)(()=>U.streamingContent.length),h=(0,r.EW)(()=>U.thinkingContent),m=(0,r.EW)(()=>U.isThinkingPhase),g=(0,r.EW)(()=>U.thinkingExpanded),b=(0,i.KR)(""),y=(0,i.KR)({inThinking:!1,buffer:""}),x=e=>{if(!e)return;const n=y.value;for(n.buffer+=e;n.buffer.length>0;)if(n.inThinking){const e=n.buffer.indexOf("</thinking>");if(-1===e){if(n.buffer.length>11&&!n.buffer.includes("<"))U.appendThinkingContent(n.buffer),n.buffer="";else if(n.buffer.length>100){const e=n.buffer.lastIndexOf("<");e>0?(U.appendThinkingContent(n.buffer.substring(0,e)),n.buffer=n.buffer.substring(e)):(U.appendThinkingContent(n.buffer),n.buffer="")}break}e>0&&U.appendThinkingContent(n.buffer.substring(0,e)),n.buffer=n.buffer.substring(e+11),n.inThinking=!1,U.endThinkingPhase()}else{const e=n.buffer.indexOf("<thinking>");if(-1===e){if(n.buffer.length>10&&!n.buffer.includes("<"))U.appendStreamingContent(n.buffer),n.buffer="";else if(n.buffer.length>50){const e=n.buffer.lastIndexOf("<");e>0?(U.appendStreamingContent(n.buffer.substring(0,e)),n.buffer=n.buffer.substring(e)):(U.appendStreamingContent(n.buffer),n.buffer="")}break}e>0&&U.appendStreamingContent(n.buffer.substring(0,e)),n.buffer=n.buffer.substring(e+10),n.inThinking=!0,U.isThinkingPhase=!0}},k=()=>{U.thinkingContent&&(b.value=U.thinkingContent),y.value={inThinking:!1,buffer:""},U.clearThinkingContent(),U.clearStreamingContent()},w=(0,i.KR)(),_=(0,i.KR)(),C=(0,i.KR)(!1),A=(0,i.KR)(!1),S=(0,i.KR)(!0),L=async({text:e,focus:n})=>{U.userInputText=e,!1!==n&&(await(0,r.dY)(),w.value?.focus())},E=async({text:e,focus:n})=>{U.isAIProcessing?_e.o.warning(F("AI正在生成中，请稍后再试")):(U.userInputText=e,!1!==n&&(await(0,r.dY)(),w.value?.focus()),await(0,r.dY)(),Ae())},T=()=>{C.value=!C.value},I=()=>{"true"===sessionStorage.getItem("ai-processing-state")&&(U.setAIProcessing(!0),console.log("[状态恢复] 恢复AI处理状态"))},R=()=>{U.isAIProcessing?(sessionStorage.setItem("ai-processing-state","true"),sessionStorage.setItem("ai-processing-timestamp",Date.now().toString())):(sessionStorage.removeItem("ai-processing-state"),sessionStorage.removeItem("ai-processing-timestamp"))},M=()=>{console.log("[强制重置] 清除AI处理状态和会话存储"),bw.aiService.cancelAllRequests(),W+=1,U.resetStreamingState(),J.value=null,ke.value="",R(),_e.o.info(F("AI处理状态已重置"))},P=(0,i.KR)(!1),D=(0,i.KR)(null),z=(0,i.KR)(1),N=(0,i.KR)(1),O=(0,i.KR)(""),{t:F}=(0,l.s)(),j=(0,a.rd)(),B=(0,Ec.useCharacterStore)(),X=vw(),U=(0,$.useUIStore)();let W=0;const q=(0,Hu.useGameStateStore)(),G=(()=>{const e=window;return"function"==typeof e.eventOn&&!!e.TavernHelper})(),H=mw.getInstance(),V=gw.J,Q=(0,r.EW)(()=>{const e=q.onlineState;return"联机"===e?.模式&&!!e?.房间ID}),K=(0,r.EW)(()=>{if(!Q.value)return"";const e=q.onlineState,n=e?.房间ID?String(e.房间ID):"",t=e?.穿越目标?.主人用户名?String(e.穿越目标.主人用户名):"",a=null!=e?.穿越目标?.世界ID?String(e.穿越目标.世界ID):"",r=["联机穿越中"];return t&&r.push(`目标：${t}`),a&&r.push(`世界#${a}`),n&&r.push(`会话#${n}`),r.join(" · ")}),Y=()=>{j.push("/game/events")},J=(0,i.KR)(null),Z=(0,r.EW)({get:()=>U.useStreaming,set:e=>{U.useStreaming=e}}),ee=window;ee[kA]||(ee[kA]=!1),ee[wA]||(ee[wA]={});const ne=(0,i.KR)([]),te=(0,i.KR)(),ae=e=>{const n=e.target;if(n.files&&n.files.length>0){const e=Array.from(n.files);ne.value.push(...e),console.log("[图片上传] 已选择图片:",e.length,"张"),_e.o.success(`已选择 ${e.length} 张图片`)}},re=(0,r.EW)(()=>{const e=q.narrativeHistory,n=q.memory?.短期记忆,t=Se();let a="";if(n&&n.length>0?a=n[n.length-1].replace(/^【.*?】\s*/,""):e&&e.length>0&&(a=e[e.length-1].content.replace(/^【.*?】\s*/,"")),e&&e.length>0){const n=e[e.length-1];return{type:n.type||"narrative",content:a||"...",time:t,stateChanges:n.stateChanges||{changes:[]},actionOptions:n.actionOptions||[]}}return{type:"system",content:a||"开局生成失败，请检查API上下文长度是否足够，是否使用支持流式的API，然后返回主页重新开始生成。",time:t,stateChanges:{changes:[]},actionOptions:[]}}),oe=((0,i.KR)(!1),(0,i.KR)(!1),(0,i.KR)(""),(0,i.KR)(!1),(0,i.KR)(null)),ie=(0,i.KR)(5),se=(0,i.KR)(25),le=(0,i.KR)(8);n({updateMemorySettings:(e,n)=>{void 0!==e&&e>0&&(ie.value=e),void 0!==n&&n>0&&(se.value=n),(()=>{try{const e=localStorage.getItem("memory-settings"),n={...e?JSON.parse(e):{},shortTermLimit:ie.value,midTermTrigger:se.value,midTermKeep:le.value};localStorage.setItem("memory-settings",JSON.stringify(n)),console.log("[记忆设置] 已保存配置:",n)}catch(e){console.warn("[记忆设置] 保存配置失败:",e)}})(),console.log("[记忆设置] 配置已更新:",{短期记忆上限:ie.value,中期记忆上限:se.value})},getMemorySettings:()=>({maxShortTerm:ie.value,maxMidTerm:se.value})});const ce=(0,r.EW)(()=>!!q.character),de=(0,r.EW)(()=>{const e=B.activeCharacterProfile;if(!e||"单机"!==e.模式)return!1;const n=e.存档列表?.["上次对话"];return null!=n?.保存时间}),ue=async()=>{de.value?U.showRetryDialog({title:"回滚确认",message:"确定要回滚到上次对话前的状态吗？当前进度将被替换。",confirmText:"确认回滚",cancelText:"取消",onConfirm:async()=>{try{await B.rollbackToLastConversation(),_e.o.success("已回滚到上次对话前的状态")}catch(e){console.error("回滚失败:",e),_e.o.error(`回滚失败: ${e instanceof Error?e.message:"未知错误"}`)}},onCancel:()=>{}}):_e.o.warning("没有可回滚的存档")},pe=(0,r.EW)(()=>{const e=[];return fe.value.forEach(n=>{e.push(...n.actions)}),e}),ve=(0,i.KR)([{label:"1天",value:1},{label:"3天",value:3},{label:"7天",value:7},{label:"30天",value:30}]),fe=(0,i.KR)([{name:"进化",icon:"",actions:[{name:"基础进化",icon:"⚡",type:"cultivation",description:"进行异能训练或体能强化，稳步提升觉醒阶段。",timeRequired:!0},{name:"炼体",icon:"Shield",iconComponent:cp,type:"cultivation",description:"通过高强度训练与药剂辅助，增强体魄与防御能力。",timeRequired:!0},{name:"冥想",icon:"BrainCircuit",iconComponent:cw,type:"cultivation",description:"进行专注与精神控制训练，提升专注度与能力掌握。",timeRequired:!0}]},{name:"探索",icon:"",actions:[{name:"野外探索",icon:"",type:"exploration",description:"前往野外探索，寻找机缘",options:[{key:"nearby",label:"附近区域"},{key:"far",label:"远方区域"},{key:"dangerous",label:"危险区域"}]},{name:"城镇逛街",icon:"",type:"exploration",description:"在城镇中闲逛，了解信息",options:[{key:"market",label:"集市"},{key:"tavern",label:"酒楼"},{key:"shop",label:"商铺"}]}]},{name:"交流",icon:"",actions:[{name:"拜访朋友",icon:"",type:"social",description:"拜访认识的朋友",options:[{key:"random",label:"随机拜访"},{key:"close",label:"亲密朋友"}]},{name:"结交新友",icon:"",type:"social",description:"主动结交新的朋友"}]},{name:"其他",icon:"",actions:[{name:"休息",icon:"",type:"other",description:"好好休息，恢复精神",timeRequired:!0},{name:"查看状态",icon:"",type:"other",description:"查看当前的详细状态"}]}]);G||(fe.value=fe.value.map(e=>({...e,actions:e.actions.map(e=>{const n=e.options?.filter(e=>"tavern"!==e.key);return n?{...e,options:n}:e})})));const he=()=>{P.value=!1},me=()=>{D.value=null,z.value=1,N.value=1,O.value=""},ge=()=>{if(!D.value)return;let e=D.value.name;if(D.value.timeRequired&&(e+=`（${N.value>0?N.value:z.value}天）`),O.value&&D.value.options){const n=D.value.options.find(e=>e.key===O.value);n&&(e+=`（${n.label}）`)}c.value=e,me(),(0,r.dY)(()=>{w.value?.focus()})},be=(0,r.EW)(()=>{const e=q.memory?.短期记忆;return e&&e.length>0?e.slice():[]}),ye=e=>{const n=[];if(!e)return n.push("AI响应为空"),{isValid:!1,errors:n};const t=e;return t.text&&"string"==typeof t.text||n.push("缺少有效的text字段"),t.mid_term_memory&&"string"==typeof t.mid_term_memory?0===t.mid_term_memory.trim().length&&n.push("mid_term_memory字段不能为空"):n.push("缺少必要的mid_term_memory字段（中期记忆总结）"),t.tavern_commands&&(Array.isArray(t.tavern_commands)?t.tavern_commands.forEach((e,n)=>{const t=e;e&&"object"==typeof e?t.action&&t.key||console.warn(`[AI响应校验] tavern_commands[${n}]缺少必要字段(action/key)`):console.warn(`[AI响应校验] tavern_commands[${n}]不是有效对象`)}):n.push("tavern_commands字段必须是数组")),{isValid:0===n.length,errors:n}},xe=e=>{if(!e)return!1;if(e instanceof DOMException&&"AbortError"===e.name)return!0;const n=e instanceof Error?e.message:String(e);return/请求已取消|abort|aborted|canceled|cancelled/i.test(n)},ke=(0,i.KR)(""),we=e=>!!e.type&&(!["npc_trade","npc_request","npc_steal"].includes(e.type)&&["equip","unequip","use"].includes(e.type)),Ce=async()=>{X.clearActions(),_e.o.success("操作记录已清空")},Ae=async()=>{if(!c.value.trim())return;if(u.value)return void _e.o.warning("AI正在处理中，请稍等...");if(!ce.value)return void _e.o.error("请先选择或创建角色");const e=q.toSaveData();if(e){if(void 0!==e.角色?.属性?.生命值?.当前&&e.角色.属性.生命值.当前<=0)return void _e.o.error("角色已死亡，生命值耗尽。无法继续游戏，请重新开始或复活角色。");const n=e.角色?.身份?.出生日期,t=e.元数据?.时间,a=e.角色?.属性?.寿元上限;if(n&&t&&"number"==typeof a&&(0,sh.R5)(n,t)>=a)return void _e.o.error("角色已死亡，寿元耗尽。无法继续游戏，请重新开始或复活角色。")}if(q.conversationAutoSaveEnabled)try{await B.saveToSlot("上次对话"),console.log("[上次对话] 已在发送消息前备份当前状态")}catch(e){console.warn("[上次对话] 备份失败（非致命）:",e)}const n=c.value.trim();console.log("[前端] 用户输入 inputText.value:",c.value),console.log("[前端] 处理后 userMessage:",n);const t=X.getActionPrompt();console.log("[前端] 动作队列 actionQueueText:",t);let a="";a=n?`<行动趋向>${t?`${n}\n\n${t}`:n}</行动趋向>\n`:t?`<行动趋向>${t}</行动趋向>\n`:"",console.log("[前端] 最终发送 finalUserMessage:",a),t&&X.clearActions(),(0,r.dY)(()=>{Ee()});const o=W;U.setAIProcessing(!0),R(),U.setStreamingContent(""),ke.value="",J.value=1;let i=null,s=!1;try{const e=B.activeCharacterProfile;if(!e)throw new Error("角色数据缺失");try{const n={onProgressUpdate:e=>{console.log("[AI进度]",e)},useStreaming:Z.value,shouldAbort:()=>!U.isAIProcessing||W!==o};G||(console.log("[网页版流式] 设置 onStreamChunk 回调"),k(),n.onStreamChunk=e=>{Z.value&&e&&(console.log("[网页版流式] 收到chunk:",e.length,"字符"),x(e))});const t=`gen_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;if(U.setCurrentGenerationId(t),n.generation_id=t,ne.value.length>0&&(n.image=ne.value,console.log("[图片上传] 将发送",ne.value.length,"张图片")),i=await V.processPlayerAction(a,e,n),!U.isAIProcessing||W!==o)return console.log("[AI响应处理] 已重置，忽略本次响应"),void(i=null);if(i){const n=ye(i);if(!n.isValid){console.warn("[AI响应验证] 结构验证失败:",n.errors),_e.o.warning("AI响应格式不正确，正在重试...");const t=await(async(e,n,t,a=2)=>{console.log("[AI响应重试] 开始重试，之前的错误:",t);const r=W;for(let o=1;o<=a;o++)try{if(!U.isAIProcessing||W!==r)return console.log("[AI响应重试] 已中止：检测到重置状态"),null;console.log(`[AI响应重试] 第${o}次尝试`),U.setStreamingContent(""),ke.value="";const a=`gen_retry_${o}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;U.setCurrentGenerationId(a);const i=`${e}\n\n## 输出格式（必须严格遵守）\n\n**重要：以下3个字段都是必需的，缺一不可！**\n\n{\n  "text": "Narrative text(中文简体，字数越多越好1000-3000，往用户趋向去尝试行动)",\n  "mid_term_memory": "Brief summary",\n  "tavern_commands": [{"action": "Action", "key": "key.path", "value": Value/List}]\n}\n\n下面为tavern_commands的行动命令类型\n\n# Action Types\n\n| Action | Purpose | Example |\n|--------|---------|---------|\n| set | Replace/Set | Update state |\n| add | Increase/Decrease | Change numerical values |\n| push | Add to array | Record history |\n| delete | Remove field | Clear data |\n| pull | Remove from array | Remove array element |\n\n---\n\n\n上次响应的问题：${t.join(", ")}\n请修正这些问题并确保结构正确。`,s={onProgressUpdate:e=>{console.log("[AI重试进度]",e)},useStreaming:Z.value,shouldAbort:()=>!U.isAIProcessing||W!==r,generation_id:a};G||(console.log("[网页版流式-重试] 设置 onStreamChunk 回调"),k(),s.onStreamChunk=e=>{Z.value&&e&&(console.log("[网页版流式-重试] 收到chunk:",e.length,"字符"),x(e))});const l=await V.processPlayerAction(i,n,s);if(!U.isAIProcessing||W!==r)return console.log("[AI响应重试] 已中止：检测到重置状态"),null;if(l){const e=ye(l);if(e.isValid)return console.log(`[AI响应重试] 第${o}次尝试成功`),l;console.warn(`[AI响应重试] 第${o}次尝试验证失败:`,e.errors),t=e.errors}}catch(e){if(xe(e)||!U.isAIProcessing||W!==r)return console.log("[AI响应重试] 已取消，停止重试"),null;console.error(`[AI响应重试] 第${o}次尝试出错:`,e)}return console.error("[AI响应重试] 所有重试尝试都失败了"),null})(a,e,n.errors);if(!U.isAIProcessing||W!==o)return console.log("[AI响应处理] 已重置，停止重试结果处理"),void(i=null);if(!t)throw new Error("AI响应格式错误，且多次重试失败");i=t,console.log("[AI响应验证] 重试成功")}}console.log("[流式输出] AI响应处理开始");let r="";const s=i;if(console.log("[AI响应处理] 开始处理AI响应文本"),console.log("[AI响应处理] aiResponse:",i),console.log("[AI响应处理] streamingContent:",p.value),s?.text&&"string"==typeof s.text?(r=s.text,console.log("[AI响应处理] 使用 gmResponse.text 作为最终文本，长度:",r.length)):p.value?(r=(0,yw.A)(p.value),console.log("[AI响应处理] 使用 streamingContent 提取后作为最终文本，长度:",r.length)):console.warn("[AI响应处理] 未找到任何有效的文本内容"),console.log("[AI响应处理] 最终文本内容预览:",r.substring(0,100)+"..."),r?(console.log("[AI响应处理] 文本处理完成，记忆已由 AIBidirectionalSystem 处理"),oe.value=s?.text||null,re.value&&console.log("[AI响应处理] 已更新UI显示")):(oe.value=null,console.error("[AI响应处理] 没有找到有效的文本内容")),i&&i.stateChanges){U.clearCurrentMessageStateChanges(),console.log("[日志清空] 收到新响应，已清空上一条消息的状态变更日志");const e=i.stateChanges&&"object"==typeof i.stateChanges&&"changes"in i.stateChanges?i.stateChanges:{changes:[]};console.log("[状态更新] AI指令已执行，状态变更数量:",e.changes.length),i.stateChanges&&(U.setCurrentMessageStateChanges(i.stateChanges),console.log("[日志面板] State changes received and stored in memory:",i.stateChanges));const n=q.toSaveData();if(n){void 0!==n.属性?.生命值?.当前&&n.属性.生命值.当前<=0&&_e.o.error("角色已死亡，生命值耗尽");const e=n.角色?.身份?.出生日期,t=n.元数据?.时间,a=n.属性?.寿元上限;e&&t&&"number"==typeof a&&(0,sh.R5)(e,t)>=a&&_e.o.error("角色已死亡，寿元耗尽")}}else i&&console.log("[日志面板] No state changes received in this response.")}catch(e){if(xe(e)||!U.isAIProcessing||W!==o)return console.log("[AI处理失败] 已取消，停止后续处理"),void(i=null);console.error("[AI处理失败]",e),s=!0;const n=e instanceof Error?e.message:"未知错误";_e.o.error(`AI处理失败: ${n}`),U.setAIProcessing(!1),J.value=null,U.setStreamingContent(""),ke.value="",U.setCurrentGenerationId(null),R(),i=null}i&&i.system_messages&&Array.isArray(i.system_messages)&&i.system_messages.length,!s&&i&&(_e.o.success("天机重现"),ne.value=[],te.value&&(te.value.value="")),s||(console.log("[AI响应处理] 处理完成，清除AI处理状态"),U.setAIProcessing(!1),J.value=null,U.setCurrentGenerationId(null),U.resetStreamingState(),ke.value="",R())}catch(e){if(xe(e)||!U.isAIProcessing||W!==o)return void console.log("[AI交互] 已取消，停止处理");console.error("[AI交互] 处理失败:",e),s=!0;const n=e instanceof Error?e.message:"未知错误";_e.o.error(`请求失败: ${n}`),U.setAIProcessing(!1),J.value=null,U.setStreamingContent(""),ke.value="",U.setCurrentGenerationId(null),R()}finally{if(u.value&&(console.warn("[AI响应处理] finally块：状态未清除，强制清除（兜底）"),U.setAIProcessing(!1),J.value=null,U.resetStreamingState(),ke.value="",U.setCurrentGenerationId(null),R()),i)try{console.log("[AI响应处理] 最终统一存档..."),await B.saveCurrentGame();const e=B.activeSaveSlot;e&&_e.o.success(`存档【${e.存档名}】已保存`),console.log("[AI响应处理] 最终统一存档完成")}catch(e){console.error("[AI响应处理] 最终统一存档失败:",e),_e.o.error("游戏存档失败，请尝试手动保存")}}},Se=()=>{const e=new Date;return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},Le=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ae())},Ee=()=>{const e=w.value;if(e){const n=36.16;e.style.height=`${n}px`;const t=e.scrollHeight,a=120;if(t>n){const n=Math.min(t,a);e.style.height=`${n}px`}e.style.overflowY=t>a?"auto":"hidden"}},Te=()=>{(0,r.dY)(()=>{Ee()})},Ie=async()=>{console.log("[主面板] 为当前存档初始化面板 (新逻辑)...");try{if(ce.value){const e=q.memory?.短期记忆;if(console.log("[主面板-调试] 存档数据检查:",{有游戏数据:q.isGameLoaded,有叙事历史:!!q.narrativeHistory,叙事历史长度:q.narrativeHistory?.length||0,有短期记忆:!!e,短期记忆长度:e?.length||0,当前显示内容:re.value?.content?.substring(0,50)+"..."}),q.narrativeHistory&&q.narrativeHistory.length>0){const n=q.narrativeHistory[q.narrativeHistory.length-1];n.stateChanges&&(U.setCurrentMessageStateChanges(n.stateChanges),console.log("[主面板] ✅ 已同步指令日志到最新叙事",{变更数量:n.stateChanges.changes?.length||0})),e&&0!==e.length||n.content&&(q.addToShortTermMemory(n.content),console.log("[主面板] ✅ 已从叙事历史同步内容到短期记忆"))}else e&&e.length>0?console.log("[主面板] ⚠️ 从短期记忆加载（无叙事历史）"):console.log("[主面板] 未找到叙事记录，显示欢迎信息");await Pe()}(0,r.dY)(()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)})}catch(e){console.error("[主面板] 初始化存档数据失败:",e)}};(0,r.wB)(()=>B.rootState.当前激活存档,async(e,n)=>{e&&e!==n&&(console.log(`[主面板] 存档已切换: 从 ${n||"无"} 到 ${e}`),console.log("[主面板] 检测到存档切换，正在重置面板状态..."),X.clearActions(),c.value="",oe.value=null,U.setAIProcessing(!1),R(),await Ie())}),(0,r.sV)(async()=>{try{if((async()=>{try{const e=localStorage.getItem("memory-settings");if(e){const n=JSON.parse(e),t="number"==typeof n.shortTermLimit?n.shortTermLimit:n.maxShortTerm,a="number"==typeof n.midTermTrigger?n.midTermTrigger:n.maxMidTerm;t&&(ie.value=t),a&&(se.value=a),n.midTermKeep&&(le.value=n.midTermKeep),console.log("[记忆设置] 已从localStorage加载配置:",{短期记忆上限:ie.value,中期记忆触发阈值:se.value,中期记忆保留数量:le.value})}}catch(e){console.warn("[记忆设置] 加载配置失败，使用默认值:",e)}})(),I(),await Me(),(0,r.dY)(Ee),await Ie(),fp.on("memory-settings-updated",e=>{if(console.log("[记忆设置] 接收到配置更新事件:",e),e&&"object"==typeof e){const n=e;"number"==typeof n.shortTermLimit&&(ie.value=n.shortTermLimit,console.log(`[记忆设置] 短期记忆上限已更新为: ${ie.value}`)),"number"==typeof n.midTermTrigger&&(se.value=n.midTermTrigger,console.log(`[记忆设置] 中期记忆触发阈值已更新为: ${se.value}`)),"number"==typeof n.midTermKeep&&(le.value=n.midTermKeep,console.log(`[记忆设置] 中期记忆保留数量已更新为: ${le.value}`))}}),fw.on("prefill",L),fw.on("send",E),G)if((0,gw.f)()){console.log("[主面板] 注册酒馆事件监听");const e=window.eventOn,n=window.TavernHelper,t=Boolean(ee[kA]);if(e&&n&&"function"==typeof e&&!t){const t=n.iframe_events,a=ee[wA],r=e=>{const n=v.value;return!(!n||!e)&&(e===n||e.startsWith(n+"_step"))};a.onGenerationStarted=e=>{if(r(e)){const n=v.value;if(n&&e.startsWith(`${n}_step2`))return;U.setStreamingContent(""),ke.value="",console.log("[流式输出] GENERATION_STARTED - 已重置状态")}},a.onStreamToken=(e,n)=>{if(r(n)&&Z.value&&e){const t=v.value;if(t&&n.startsWith(`${t}_step2`))return;ke.value+=e,U.setStreamingContent(ke.value)}},a.onGenerationEnded=e=>{r(e)&&console.log("[流式输出] GENERATION_ENDED 事件触发，清除AI处理状态")},e(t.GENERATION_STARTED,a.onGenerationStarted),e(t.STREAM_TOKEN_RECEIVED_INCREMENTALLY,a.onStreamToken),e(t.GENERATION_ENDED,a.onGenerationEnded),ee[kA]=!0,console.log("[主面板] ✅ 流式事件监听器已注册（全局唯一）")}else t&&console.log("[主面板] ⏭️ 跳过事件监听器注册（全局已注册）");console.log("[主面板] ✅ 事件监听器注册完成")}else console.warn("[主面板] ⚠️ 酒馆助手不可用，事件监听未注册")}catch(e){console.error("[主面板] 首次挂载失败:",e)}}),(0,r.n)(()=>{console.log("[主面板] 组件激活，恢复AI处理状态"),I()}),(0,r.hi)(()=>{if(console.log("[主面板] 组件卸载，清理事件监听器"),fw.off("prefill",L),fw.off("send",E),G)try{const e=window.eventOff,n=window.TavernHelper,t=Boolean(ee[kA]);if(e&&n&&"function"==typeof e&&t){const t=n.iframe_events,a=ee[wA];a.onGenerationStarted&&e(t.GENERATION_STARTED,a.onGenerationStarted),a.onStreamToken&&e(t.STREAM_TOKEN_RECEIVED_INCREMENTALLY,a.onStreamToken),a.onGenerationEnded&&e(t.GENERATION_ENDED,a.onGenerationEnded),ee[kA]=!1,ee[wA]={},console.log("[主面板] ✅ 事件监听器已清理（全局）")}}catch(e){console.warn("[主面板] ⚠️ 清理事件监听器失败:",e)}});const Re=()=>{if(!_.value)return;const e=_.value,n=e.scrollHeight-e.scrollTop-e.clientHeight;A.value=n>100};(0,r.wB)(p,()=>{A.value||p.value&&_.value&&(0,r.dY)(()=>{_.value.scrollTop=_.value.scrollHeight})}),(0,r.wB)(u,(e,n)=>{e&&!n&&(A.value=!1)}),(0,r.wB)(()=>q.narrativeHistory,e=>{if(e&&e.length>0){const n=e[e.length-1];n.stateChanges?(U.setCurrentMessageStateChanges(n.stateChanges),console.log("[主面板] ✅ 已更新指令日志",{变更数量:n.stateChanges.changes?.length||0,前3条:n.stateChanges.changes?.slice(0,3).map(e=>e.key)||[]})):console.warn("[主面板] ⚠️ 最新叙事没有状态变更记录")}},{deep:!0});const Me=async()=>{try{console.log("[主面板] 初始化系统连接..."),console.log("[主面板] 系统连接初始化完成")}catch(e){console.error("[主面板] 系统连接初始化失败:",e)}},Pe=async()=>{try{if(!B.activeCharacterProfile)return;console.log("[主面板] 游戏状态同步完成")}catch(e){console.error("[主面板] 游戏状态同步失败:",e)}};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",iC,[(0,r.Q3)(" 短期记忆区域 "),S.value?((0,r.uX)(),(0,r.CE)("div",sC,[(0,r.Lk)("div",{class:"memory-header",onClick:T},[(0,r.Lk)("span",lC,(0,o.v_)((0,i.R1)(F)("短期记忆")),1),C.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(dw),{key:0,size:16,class:"memory-icon"})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(Yc),{key:1,size:16,class:"memory-icon"}))]),(0,r.Q3)(" 下拉悬浮的记忆内容 "),(0,r.bF)(s.eB,{name:"memory-dropdown"},{default:(0,r.k6)(()=>[C.value?((0,r.uX)(),(0,r.CE)("div",cC,[(0,r.Lk)("div",dC,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(be.value,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"memory-item"},(0,o.v_)(e),1))),128)),0===be.value.length?((0,r.uX)(),(0,r.CE)("div",uC,(0,o.v_)((0,i.R1)(F)("脑海中一片清净，尚未留下修行痕迹...")),1)):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0)]),_:1})])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 文本显示区域 - 当前AI回复 "),(0,r.Lk)("div",{class:"content-area",ref_key:"contentAreaRef",ref:_,onScroll:Re},[(0,r.Q3)(" 左侧：当前叙述 "),(0,r.Lk)("div",pC,[(0,r.Q3)(" AI生成状态指示器（生成时显示在顶部） "),u.value?((0,r.uX)(),(0,r.CE)("div",vC,[(0,r.Lk)("div",fC,[(0,r.Lk)("span",hC,(0,o.v_)(Se()),1),(0,r.Lk)("div",mC,[n[7]||(n[7]=(0,r.Lk)("span",{class:"streaming-dot"},null,-1)),(0,r.Lk)("span",gC,(0,o.v_)(p.value?`${f.value} ${(0,i.R1)(F)("字")}`:(0,i.R1)(F)("天道感应中...")),1)]),(0,r.Q3)(" 重置按钮 - 右侧 "),(0,r.Lk)("button",{onClick:M,class:"reset-state-btn",title:(0,i.R1)(F)("如果长时间无响应，点击此处重置状态")},[(0,r.bF)((0,i.R1)(uw.A),{size:16})],8,bC)])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 思维链显示区域（可折叠）- 生成中和完成后都显示 "),h.value||b.value?((0,r.uX)(),(0,r.CE)("div",yC,[(0,r.Lk)("div",{class:"thinking-header",onClick:n[0]||(n[0]=e=>(0,i.R1)(U).toggleThinkingExpanded())},[(0,r.bF)((0,i.R1)(cw),{size:16,class:"thinking-icon"}),(0,r.Lk)("span",xC,(0,o.v_)((0,i.R1)(F)("思维过程")),1),m.value?((0,r.uX)(),(0,r.CE)("span",kC,(0,o.v_)((0,i.R1)(F)("思考中...")),1)):h.value||b.value?((0,r.uX)(),(0,r.CE)("span",wC,(0,o.v_)((0,i.R1)(F)("已完成")),1)):(0,r.Q3)("v-if",!0),g.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(dw),{key:2,size:16,class:"expand-icon"})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(Yc),{key:3,size:16,class:"expand-icon"}))]),(0,r.bF)(s.eB,{name:"thinking-expand"},{default:(0,r.k6)(()=>[g.value?((0,r.uX)(),(0,r.CE)("div",_C,[(0,r.bF)(oC,{text:h.value||b.value},null,8,["text"])])):(0,r.Q3)("v-if",!0)]),_:1})])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 流式输出内容（生成时实时显示，优先级最高） "),u.value&&p.value?((0,r.uX)(),(0,r.CE)("div",CC,[(0,r.Lk)("div",AC,[(0,r.bF)(oC,{text:p.value},null,8,["text"])])])):re.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Q3)(" 上一次的叙述内容（非生成时显示） "),(0,r.Lk)("div",SC,[(0,r.Lk)("div",LC,[(0,r.Lk)("span",EC,(0,o.v_)(re.value.time),1),(0,r.Lk)("div",TC,[(0,r.Q3)(" 回滚按钮 "),de.value?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:ue,class:"header-action-btn rollback-btn",title:(0,i.R1)(F)("回滚到上次对话前的状态")},[(0,r.bF)((0,i.R1)(uw.A),{size:20})],8,IC)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:Y,class:"header-action-btn event-btn",title:(0,i.R1)(F)("世界事件")},[(0,r.bF)((0,i.R1)(Zu),{size:20})],8,RC),Q.value?((0,r.uX)(),(0,r.CE)("span",{key:1,class:"traveling-badge",title:K.value},"穿越中",8,MC)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 命令日志按钮 "),(0,r.Lk)("button",{onClick:n[1]||(n[1]=e=>{var n;(n=re.value.stateChanges)&&n.changes&&0!==n.changes.length?U.openStateChangeViewer(n):_e.o.info("本次对话无变更记录")}),class:(0,o.C4)(["variable-updates-toggle",{disabled:0===t.value.length}]),disabled:0===t.value.length,title:t.value.length>0?(0,i.R1)(F)("查看本次对话的变更日志"):(0,i.R1)(F)("本次对话无变更记录")},[(0,r.bF)((0,i.R1)(Mc.A),{size:16}),(0,r.Lk)("span",DC,(0,o.v_)(t.value.length),1)],10,PC)])]),(0,r.Lk)("div",zC,[(0,r.bF)(oC,{text:re.value.content},null,8,["text"])]),(0,r.Q3)(" 行动选项 "),(0,i.R1)(U).enableActionOptions&&re.value.actionOptions?.length?((0,r.uX)(),(0,r.CE)("div",NC,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(re.value.actionOptions,(e,n)=>((0,r.uX)(),(0,r.CE)("button",{key:n,onClick:n=>(e=>{c.value=e})(e),class:"action-option-btn"},(0,o.v_)(e),9,$C))),128))])):(0,r.Q3)("v-if",!0)])],2112)):((0,r.uX)(),(0,r.CE)("div",OC,(0,o.v_)((0,i.R1)(F)("静待天机变化...")),1))])],544),(0,r.Q3)(" 输入区域 "),(0,r.Lk)("div",FC,[(0,r.Q3)(" 动作队列显示区域 "),(0,i.R1)(X).pendingActions.length>0?((0,r.uX)(),(0,r.CE)("div",jC,[(0,r.Lk)("div",BC,[(0,r.Lk)("span",XC,(0,o.v_)((0,i.R1)(F)("最近操作")),1),(0,r.Lk)("button",{onClick:Ce,class:"clear-queue-btn",title:(0,i.R1)(F)("清空记录")},n[8]||(n[8]=[(0,r.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.Lk)("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]),8,UC)]),(0,r.Lk)("div",WC,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,i.R1)(X).pendingActions,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"queue-action-item"},[(0,r.Lk)("span",qC,(0,o.v_)(e.description),1),(0,r.Lk)("div",GC,[(0,r.Lk)("button",{onClick:e=>(async e=>{if(e>=0&&e<X.pendingActions.length){const n=X.pendingActions[e],t=["npc_trade","npc_request","npc_steal"];if(n.type&&t.includes(n.type))return X.removeAction(n.id),void _e.o.success("已移除NPC交互动作");if(n.type&&["equip","unequip","use"].includes(n.type)&&n.itemName&&await H.undoByItemName(n.type,n.itemName))return void _e.o.success("已撤回并恢复");X.removeAction(n.id),_e.o.success("已移除动作")}})(n),class:"remove-action-btn",title:we(e)?(0,i.R1)(F)("撤回并恢复"):(0,i.R1)(F)("删除此动作")}," × ",8,HC)])]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",VC,[(0,r.Q3)(" 隐藏的文件选择器 "),(0,r.Lk)("input",{type:"file",ref_key:"imageInputRef",ref:te,onChange:ae,multiple:"",accept:"image/*",style:{display:"none"}},null,544),(0,r.Q3)(" 图片上传按钮 - 已禁用 "),(0,r.Q3)("v-if",!0),(0,r.Q3)(" 快捷行动按钮 - 已禁用 "),(0,r.Q3)("v-if",!0),(0,r.Lk)("div",QC,[(0,r.Q3)(" 图片预览区域 "),ne.value.length>0?((0,r.uX)(),(0,r.CE)("div",KC,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ne.value,(e,t)=>{return(0,r.uX)(),(0,r.CE)("div",{key:t,class:"image-preview-item"},[(0,r.Lk)("img",{src:(a=e,URL.createObjectURL(a)),alt:e.name},null,8,YC),(0,r.Lk)("button",{onClick:e=>(e=>{ne.value.splice(e,1),_e.o.info("已移除图片")})(t),class:"remove-image-btn",title:(0,i.R1)(F)("移除图片")},n[10]||(n[10]=[(0,r.Lk)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.Lk)("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]),8,JC)]);var a}),128))])):(0,r.Q3)("v-if",!0),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>c.value=e),onFocus:n[3]||(n[3]=e=>d.value=!0),onBlur:n[4]||(n[4]=e=>d.value=!1),onKeydown:Le,onInput:Te,placeholder:ce.value?(0,i.R1)(F)("请输入您的选择或行动..."):(0,i.R1)(F)("请先选择角色..."),class:"game-input",ref_key:"inputRef",ref:w,rows:"1",wrap:"soft",disabled:!ce.value||u.value},null,40,ZC),[[s.Jo,c.value]])]),(0,r.Lk)("button",{onClick:Ae,disabled:!c.value.trim()||u.value||!ce.value,class:"send-button"},[u.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(Oc),{key:0,size:16,class:"animate-spin"})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(pw),{key:1,size:16}))],8,eA)]),(0,r.Q3)(" 行动选择弹窗 "),P.value?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"action-modal-overlay",onClick:(0,s.D$)(he,["self"])},[(0,r.Lk)("div",nA,[(0,r.Lk)("div",tA,[(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(F)("快捷行动")),1),(0,r.Lk)("button",{onClick:he,class:"close-btn"},n[11]||(n[11]=[(0,r.Lk)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.Lk)("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]))]),(0,r.Lk)("div",aA,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(pe.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.name,onClick:n=>(e=>{D.value=e,P.value=!1,z.value=1,N.value=1,O.value="",e.timeRequired||e.options||ge()})(e),class:(0,o.C4)(["quick-action-btn",e.type])},[(0,r.Lk)("div",oA,(0,o.v_)(e.icon),1),(0,r.Lk)("div",iA,(0,o.v_)(e.name),1)],10,rA))),128))])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 行动配置弹窗 "),D.value?((0,r.uX)(),(0,r.CE)("div",{key:2,class:"action-config-overlay",onClick:(0,s.D$)(me,["self"])},[(0,r.Lk)("div",sA,[(0,r.Lk)("div",lA,[(0,r.Lk)("h3",null,(0,o.v_)(D.value.icon)+" "+(0,o.v_)(D.value.name),1),(0,r.Lk)("button",{onClick:me,class:"close-btn"},"×")]),(0,r.Lk)("div",cA,[(0,r.Lk)("p",dA,(0,o.v_)(D.value.description),1),(0,r.Q3)(" 时间配置 "),D.value.timeRequired?((0,r.uX)(),(0,r.CE)("div",uA,[(0,r.Lk)("label",pA,(0,o.v_)((0,i.R1)(F)("进化时间")),1),(0,r.Lk)("div",vA,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ve.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.value,onClick:n=>z.value=e.value,class:(0,o.C4)(["time-btn",{active:z.value===e.value}])},(0,o.v_)(e.label),11,fA))),128))]),(0,r.Lk)("div",hA,[(0,r.Lk)("label",null,(0,o.v_)((0,i.R1)(F)("自定义：")),1),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>N.value=e),type:"number",min:"1",max:"365",class:"time-input"},null,512),[[s.Jo,N.value,void 0,{number:!0}]]),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(F)("天")),1)])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 其他配置选项 "),D.value.options?((0,r.uX)(),(0,r.CE)("div",mA,[(0,r.Lk)("label",gA,(0,o.v_)((0,i.R1)(F)("选项")),1),(0,r.Lk)("div",bA,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(D.value.options,e=>((0,r.uX)(),(0,r.CE)("label",{key:e.key,class:"option-item"},[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"option-"+D.value.name,value:e.key,"onUpdate:modelValue":n[6]||(n[6]=e=>O.value=e)},null,8,yA),[[s.XL,O.value]]),(0,r.Lk)("span",null,(0,o.v_)(e.label),1)]))),128))])])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",xA,[(0,r.Lk)("button",{onClick:me,class:"cancel-btn"},(0,o.v_)((0,i.R1)(F)("取消")),1),(0,r.Lk)("button",{onClick:ge,class:"confirm-btn"},(0,o.v_)((0,i.R1)(F)("确认")),1)])])])):(0,r.Q3)("v-if",!0)])]))}});var CA=t(6347),AA={};AA.styleTagTransform=A(),AA.setAttributes=k(),AA.insert=y().bind(null,"head"),AA.domAPI=g(),AA.insertStyleElement=_(),h()(CA.A,AA),CA.A&&CA.A.locals&&CA.A.locals;const SA=(0,E.A)(_A,[["__scopeId","data-v-6724586e"]]),LA=(0,I.A)("chevrons-left",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),EA=(0,I.A)("chevrons-right",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);var TA=t(3302),IA=t(5184),RA=t(100);const MA={class:"memory-center-panel game-panel"},PA={class:"filter-section"},DA={class:"filter-tabs"},zA=["onClick"],NA={class:"tab-icon"},$A={class:"tab-name"},OA={class:"tab-count"},FA=["title"],jA={key:0,class:"export-section"},BA=["title"],XA={class:"export-hint"},UA={key:1,class:"settings-section"},WA={class:"settings-header"},qA={class:"settings-title"},GA={class:"header-actions"},HA=["title"],VA={class:"settings-content"},QA={class:"setting-item"},KA={class:"setting-label"},YA={class:"setting-hint"},JA={class:"setting-item"},ZA={class:"setting-label"},eS={class:"setting-hint"},nS={class:"setting-item"},tS={class:"setting-label"},aS={class:"setting-hint"},rS={class:"setting-item"},oS={class:"setting-label"},iS={class:"setting-hint"},sS={class:"setting-item"},lS={class:"setting-label"},cS=["placeholder"],dS={class:"setting-hint"},uS={class:"setting-item"},pS={class:"setting-label"},vS=["placeholder"],fS={class:"setting-hint"},hS={class:"settings-actions"},mS={class:"manual-summary-section"},gS={class:"summary-info"},bS={class:"info-text"},yS={class:"info-hint"},xS=["disabled","title"],kS={key:2,class:"panel-content"},wS={class:"vector-toolbar"},_S={class:"vector-status"},CS={class:"status-text"},AS={class:"vector-actions"},SS=["disabled","title"],LS=["disabled"],ES=["disabled"],TS={key:0,class:"loading-state"},IS={class:"loading-text"},RS={key:1,class:"empty-state"},MS={class:"empty-text"},PS={key:2,class:"empty-state"},DS=["disabled"],zS={key:3,class:"vector-content"},NS={key:0,class:"vector-stats"},$S={class:"stats-item"},OS={class:"stats-value"},FS={key:0,class:"stats-item"},jS={class:"stats-value"},BS={key:0},XS={key:1,class:"pagination-controls"},US={class:"pagination-info"},WS={class:"pagination-buttons"},qS=["disabled"],GS=["disabled"],HS=["disabled"],VS=["disabled"],QS={class:"pagination-jump"},KS=["max"],YS={class:"vector-list"},JS={class:"vector-card-header"},ZS={class:"vector-badges"},eL={class:"vector-badge"},nL={class:"vector-badge secondary"},tL={class:"vector-time"},aL={key:0,class:"vector-tags"},rL={class:"vector-text"},oL={key:0,class:"loading-state"},iL={class:"loading-text"},sL={key:1,class:"empty-state"},lL={class:"empty-text"},cL={key:2},dL={key:0,class:"pagination-controls"},uL={class:"pagination-info"},pL={class:"pagination-buttons"},vL=["disabled","title"],fL=["disabled","title"],hL=["disabled","title"],mL=["disabled","title"],gL={class:"pagination-jump"},bL=["placeholder","max"],yL={class:"memory-list"},xL={class:"memory-header"},kL={class:"memory-actions"},wL=["onClick","title"],_L={class:"memory-time"},CL={class:"memory-content"},AL={key:0,class:"structured-memory"},SL={key:0,class:"memory-title"},LL={key:0,class:"memory-section-group"},EL={class:"memory-section"},TL={class:"memory-icon"},IL={class:"memory-section-title"},RL={key:1,class:"memory-item"},ML={key:1,class:"memory-section-group"},PL={class:"memory-section"},DL={class:"memory-section-title"},zL={key:1,class:"memory-item"},NL={key:1,class:"simple-memory"},$L={key:1,class:"pagination-controls bottom"},OL={class:"pagination-info"},FL={class:"pagination-buttons"},jL=["disabled"],BL=["disabled"],XL=["disabled"],UL=["disabled"],WL=(0,r.pM)({__name:"MemoryCenterPanel",setup(e){const n=(0,Ec.useCharacterStore)(),t=(0,Hu.useGameStateStore)(),a=(0,RA.useAPIManagementStore)(),{t:c}=(0,l.s)(),d=(0,i.KR)(!1),u=(0,i.KR)("all"),p=(0,i.KR)(!1),v=(0,i.KR)(1),f=(0,i.KR)(10),h=(0,i.KR)(""),m=(0,i.KR)({shortTermLimit:5,midTermTrigger:25,midTermKeep:8,autoSummaryEnabled:!0,midTermFormat:"",longTermFormat:"",useRawMode:!0,useStreaming:!0}),g=(0,i.KR)([]),b=(0,i.KR)([]),y=(0,i.KR)([]),x=(0,i.KR)([]),k=(0,i.KR)(null),w=(0,i.KR)(!1),_=(0,i.KR)(""),C=(0,i.KR)(!1),A=(0,i.KR)({done:0,total:0}),S=(0,r.EW)(()=>{const e=IA.vectorMemoryService.getConfig().enabled,n=a.isFunctionEnabled("embedding");return e&&n}),L=(0,r.EW)(()=>IA.vectorMemoryService.getEmbeddingStatus()),E=(0,r.EW)(()=>k.value?.total??x.value.length),T=(0,r.EW)(()=>Math.ceil(E.value/f.value)||1),I=(0,r.EW)(()=>{const e=(v.value-1)*f.value,n=e+f.value;return x.value.slice(e,n)}),R=(0,r.EW)(()=>{if(C.value){const{done:e,total:n}=A.value;return"正在向量化长期记忆..."+(n>0?`（${e}/${n}）`:"")}return"正在读取向量库..."}),M=(0,r.EW)(()=>[...y.value,...b.value,...g.value].sort((e,n)=>new Date(n.time).getTime()-new Date(e.time).getTime())),P=(0,r.EW)(()=>[{key:"all",name:c("全部"),icon:"🧠"},{key:"short",name:c("短期"),icon:"⚡"},{key:"medium",name:c("中期"),icon:"💭"},{key:"long",name:c("长期"),icon:"💾"},{key:"vector",name:"向量库",icon:"🧬"}]),D=(0,r.EW)(()=>{if("all"===u.value)return M.value;switch(u.value){case"short":return g.value;case"medium":return b.value;case"long":return y.value;default:return M.value}}),z=(0,r.EW)(()=>Math.ceil(D.value.length/f.value)||1),N=(0,r.EW)(()=>{const e=(v.value-1)*f.value,n=e+f.value;return D.value.slice(e,n)}),O=(0,r.EW)(()=>g.value.length+b.value.length+y.value.length),F=e=>{if("all"===e)return O.value;switch(e){case"short":return g.value.length;case"medium":return b.value.length;case"long":return y.value.length;case"vector":return E.value;default:return 0}},j=()=>{if("all"===u.value)return c("心如明镜，尚未记录任何修行感悟");const e=P.value.find(e=>e.key===u.value);return c("暂无{type}记忆",{type:e?.name})},B=e=>({short:c("短期记忆"),medium:c("中期记忆"),long:c("长期记忆")}[e]||c("未知")),X=e=>{const n=new Date(e);return`${n.getMonth()+1}/${n.getDate()} ${n.getHours()}:${n.getMinutes().toString().padStart(2,"0")}`},U=async()=>{try{t.memory||(TA.Yz.warn("记忆中心","gameStateStore.memory 不存在，无法保存记忆"),t.memory={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),t.memory.短期记忆=g.value.map(e=>e.content),t.memory.中期记忆=b.value.map(e=>e.content),t.memory.长期记忆=y.value.map(e=>e.content),await n.saveCurrentGame(),TA.Yz.log("记忆中心","记忆数据已保存到存档")}catch(e){throw TA.Yz.error("记忆中心","保存记忆数据到存档失败:",e),e}},W=async()=>{if(!w.value){w.value=!0,_.value="";try{const[e,n]=await Promise.all([IA.vectorMemoryService.getAllMemories(),IA.vectorMemoryService.getStats()]);x.value=[...e].sort((e,n)=>n.timestamp-e.timestamp),k.value=n}catch(e){const n=e instanceof Error?e.message:String(e||"");_.value=n?`向量库读取失败：${n}`:"向量库读取失败"}finally{w.value=!1}}},q=()=>"vector"===u.value?T.value:z.value,G=e=>{const n=q();e>=1&&e<=n&&(v.value=e)},H=()=>{v.value=1},V=()=>{v.value=q()},Q=()=>{const e=parseInt(h.value),n=q();!isNaN(e)&&e>=1&&e<=n?(v.value=e,h.value=""):_e.o.warning(`请输入 1-${n} 之间的页码`)},K=(0,$.useUIStore)(),Y=async()=>{if(w.value||C.value)return;if(0===y.value.length)return void _e.o.warning("当前没有长期记忆可转化");const e=y.value.length;K.showRetryDialog({title:"一键转化长期记忆",message:`将清空当前向量库，并把 ${e} 条长期记忆转化为向量（优先使用Embedding；未配置则回退本地向量）。此操作可能产生 Embedding API 调用与费用。`,confirmText:"开始转化",cancelText:"取消",onConfirm:async()=>{w.value=!0,C.value=!0,A.value={done:0,total:e};try{const e=y.value.map(e=>e.content).filter(Boolean),n=await IA.vectorMemoryService.rebuildFromLongTermMemories(e,{batchSize:24,onProgress:(e,n)=>{A.value={done:e,total:n}}});_e.o.success("embedding"===n.vectorType?`转化完成：${n.imported} 条（Embedding: ${n.embeddingModel||"unknown"}）`:`转化完成：${n.imported} 条（本地向量）`)}catch(e){const n=e instanceof Error?e.message:String(e||"");_e.o.error(n?`转化失败：${n}`:"转化失败")}finally{C.value=!1,w.value=!1,A.value={done:0,total:0},await W()}},onCancel:()=>{}})},J=async()=>{K.showRetryDialog({title:"清空向量库",message:"确定要清空向量库吗？此操作不可撤销。",confirmText:"确认清空",cancelText:"取消",onConfirm:async()=>{try{await IA.vectorMemoryService.clear(),await W(),_e.o.success("向量库已清空")}catch(e){const n=e instanceof Error?e.message:String(e||"");_e.o.error(n?`清空失败：${n}`:"清空失败")}},onCancel:()=>{}})},Z=async()=>{try{TA.Yz.log("记忆中心","开始加载记忆数据");const e=[],n=[],a=[],r=t.memory;r?(TA.Yz.log("记忆中心","从存档数据加载记忆:",Object.keys(r)),Array.isArray(r.短期记忆)&&r.短期记忆.forEach((n,t)=>{if(n&&"string"==typeof n){const a={type:"short",content:n,time:X(Date.now()-3e5*t),importance:5};e.push(a)}}),Array.isArray(r.中期记忆)&&r.中期记忆.forEach((e,t)=>{if(e&&"string"==typeof e){const a={type:"medium",content:e,time:X(Date.now()-36e5*t),importance:7};n.push(a)}}),Array.isArray(r.长期记忆)?(TA.Yz.log("记忆中心",`发现长期记忆数组，长度: ${r.长期记忆.length}`),TA.Yz.log("记忆中心","长期记忆原始数据:",r.长期记忆),r.长期记忆.forEach((e,n)=>{if(e&&"string"==typeof e){const t={type:"long",content:e,time:X(Date.now()-864e5*n),importance:9};a.push(t),TA.Yz.log("记忆中心",`加载长期记忆 #${n}:`,e.substring(0,50))}})):TA.Yz.warn("记忆中心","长期记忆不是数组或不存在:",r.长期记忆),TA.Yz.log("记忆中心",`记忆加载完成: 短期${e.length}, 中期${n.length}, 长期${a.length}`)):TA.Yz.warn("记忆中心","未找到存档记忆数据"),g.value=e,b.value=n,y.value=a;const o=e.length+n.length+a.length;TA.Yz.log("记忆中心",`记忆加载完成：总计 ${o} 条记忆`)}catch(e){TA.Yz.error("记忆中心","加载记忆数据失败",e),_e.o.error("加载记忆数据失败")}},ee=async()=>{try{localStorage.setItem("memory-settings",JSON.stringify(m.value)),fp.emit("memory-settings-updated",m.value),_e.o.success("记忆系统配置已保存"),TA.Yz.log("记忆中心","配置已保存:",m.value)}catch(e){TA.Yz.error("记忆中心","保存配置失败:",e),_e.o.error("保存配置失败")}},ne=()=>{m.value={shortTermLimit:5,midTermTrigger:20,midTermKeep:8,autoSummaryEnabled:!0,midTermFormat:"",longTermFormat:"",useRawMode:!0,useStreaming:!0},_e.o.success("配置已重置为默认值")},te=async()=>{const e=m.value.midTermKeep+5;b.value.length<e?_e.o.warning(c("insufficientMemoriesForSummary",{minRequired:e})):await gw.J.triggerMemorySummary({useRawMode:m.value.useRawMode,useStreaming:m.value.useStreaming})},ae=()=>{try{const e=t.character?.名字||c("修仙者"),n=t.worldInfo?.世界名称||c("修仙世界"),a=t.narrativeHistory||[];if(0===a.length)return void _e.o.warning(c("没有叙事历史可导出"));let r=c("novelTitle",{characterName:e})+"\n\n";r+=`${c("世界档案")}: ${n}\n`,r+=`${c("导出时间")}: ${(new Date).toLocaleString("zh-CN")}\n`,r+=`${c("总段落数")}: ${a.length}\n`,r+=`\n${"=".repeat(60)}\n\n`,a.forEach((e,n)=>{const t="user"===e.type||"player"===e.type,a=e.content.replace(/【.*?】/g,"").trim();r+=t?`${c("我说")}: "${a}"\n`:`${a}\n`,r+=`${"─".repeat(50)}\n\n`,(n+1)%10==0&&(r+=`\n${"═".repeat(50)}\n`,r+=`${c("第")} ${Math.floor((n+1)/10)}\n`,r+=`${"═".repeat(50)}\n\n`)});const o=new Blob([r],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`${e}_修仙历程_${Date.now()}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),_e.o.success(c("narrativeHistoryExported",{count:a.length}))}catch(e){console.error("[记忆中心] 导出失败:",e),_e.o.error(c("导出失败，请查看控制台"))}};(0,r.sV)(async()=>{await Z(),await(async()=>{try{const e=localStorage.getItem("memory-settings");if(e){const n=JSON.parse(e);return m.value={...m.value,...n},void TA.Yz.log("记忆中心","已从localStorage加载配置",n)}TA.Yz.log("记忆中心","未找到配置，使用默认值")}catch(e){TA.Yz.error("记忆中心","加载记忆配置失败:",e)}})();try{k.value=await IA.vectorMemoryService.getStats()}catch{}fp.on("refresh",async()=>{d.value=!0;try{await Z()}finally{d.value=!1}}),fp.on("test",()=>{((e,n,t=5,a)=>{const r={type:e,content:n,time:X(Date.now()),importance:t,parsedContent:a};switch(e){case"short":g.value.push(r);break;case"medium":b.value.push(r);break;case"long":y.value.push(r)}(()=>{let e=!1;if(g.value.length>=3){TA.Yz.log("记忆中心","短期记忆达到上限，开始转化为中期记忆");const n=g.value.shift();if(n){const t={...n,type:"medium",time:c("convertedAt",{time:X(Date.now())}),isConverted:!0};b.value.push(t),e=!0}}if(b.value.length>=25)if(TA.Yz.log("记忆中心","中期记忆达到上限，准备转化为长期记忆"),m.value.autoSummaryEnabled)TA.Yz.log("记忆中心","自动总结已启用，将在后台触发AI总结"),gw.J.triggerMemorySummary({useRawMode:m.value.useRawMode,useStreaming:m.value.useStreaming}).catch(e=>{TA.Yz.error("记忆中心","自动总结失败:",e)});else{const n=b.value.shift();if(n){const t={...n,type:"long",time:c("archivedAt",{time:X(Date.now())}),importance:Math.max(n.importance||5,7),isConverted:!0};y.value.push(t),e=!0}}if(y.value.length>50){y.value.sort((e,n)=>(n.importance||5)-(e.importance||5));const e=y.value.splice(50);TA.Yz.log("记忆中心",`长期记忆超限，移除${e.length}条低重要性记忆`)}e&&_e.o.success(c("记忆已重新整理，旧记忆已转化"))})()})("short","【测试记忆】用于检验转化与渲染。")}),fp.on("clear",async()=>{await(async()=>{K.showRetryDialog({title:c("清空记忆"),message:"确定要清空所有记忆吗？此操作不可撤销。",confirmText:c("确认清空"),cancelText:c("取消"),onConfirm:async()=>{try{g.value=[],b.value=[],y.value=[],t.memory&&(t.memory.短期记忆=[],t.memory.中期记忆=[],t.memory.长期记忆=[]),await n.saveCurrentGame(),_e.o.success("记忆已清空")}catch(e){console.error("[记忆中心] 清理记忆失败:",e),_e.o.error(c("清空记忆失败，请重试"))}},onCancel:()=>{}})})()})});const re=async()=>{try{const e={content:`测试中期记忆 ${Date.now()} - 这是一条用于测试的中期记忆记录。`,time:X(Date.now()),type:"medium",isConverted:!1,isSummarized:!1,parsedContent:{影响:"测试",sections:{}}};b.value.push(e),await U(),_e.o.success(c("testMemoryAdded",{count:b.value.length})),TA.Yz.log("记忆中心","添加测试中期记忆成功",e)}catch(e){TA.Yz.error("记忆中心","添加测试记忆失败",e),_e.o.error(c("添加测试记忆失败"))}};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",MA,[(0,r.Q3)(" 记忆类型筛选 "),(0,r.Lk)("div",PA,[(0,r.Lk)("div",DA,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(P.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.key,class:(0,o.C4)(["filter-tab",{active:u.value===e.key}]),onClick:n=>(async e=>{u.value=e,v.value=1,h.value="","vector"===e&&await W()})(e.key)},[(0,r.Lk)("span",NA,(0,o.v_)(e.icon),1),(0,r.Lk)("span",$A,(0,o.v_)((0,i.R1)(c)(e.name)),1),(0,r.Lk)("span",OA,(0,o.v_)(F(e.key)),1)],10,zA))),128)),(0,r.Lk)("button",{class:(0,o.C4)(["settings-toggle-btn",{active:p.value}]),onClick:n[0]||(n[0]=e=>p.value=!p.value),title:(0,i.R1)(c)("记忆系统设置")},[(0,r.bF)((0,i.R1)(ya.A),{size:16})],10,FA)])]),(0,r.Q3)(" 导出工具 "),p.value||"vector"===u.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",jA,[(0,r.Lk)("button",{class:"export-btn-main",onClick:ae,title:(0,i.R1)(c)("将完整的游戏对话历史（基于叙事历史）导出为小说格式，方便阅读和分享。")},(0,o.v_)((0,i.R1)(c)("📖 导出为小说")),9,BA),(0,r.Lk)("div",XA,(0,o.v_)((0,i.R1)(c)("将完整的游戏对话历史（基于叙事历史）导出为小说格式，方便阅读和分享。")),1)])),(0,r.Q3)(" 记忆系统设置 "),p.value?((0,r.uX)(),(0,r.CE)("div",UA,[(0,r.Lk)("div",WA,[(0,r.Lk)("span",qA,"⚙️ "+(0,o.v_)((0,i.R1)(c)("记忆系统配置")),1),(0,r.Lk)("div",GA,[(0,r.Lk)("button",{class:"test-btn",onClick:re,title:(0,i.R1)(c)("添加测试中期记忆")}," 🧪 "+(0,o.v_)((0,i.R1)(c)("测试")),9,HA),(0,r.Lk)("button",{class:"settings-close-btn",onClick:n[1]||(n[1]=e=>p.value=!1)},"✕")])]),(0,r.Lk)("div",VA,[(0,r.Lk)("div",QA,[(0,r.Lk)("label",KA,(0,o.v_)((0,i.R1)(c)("短期记忆上限（条）：")),1),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[2]||(n[2]=e=>m.value.shortTermLimit=e),min:"3",max:"10",class:"setting-input"},null,512),[[s.Jo,m.value.shortTermLimit,void 0,{number:!0}]]),(0,r.Lk)("span",YA,(0,o.v_)((0,i.R1)(c)("默认"))+": 3",1)]),(0,r.Lk)("div",JA,[(0,r.Lk)("label",ZA,(0,o.v_)((0,i.R1)(c)("中期记忆转化阈值（条）：")),1),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[3]||(n[3]=e=>m.value.midTermTrigger=e),min:"10",max:"50",class:"setting-input"},null,512),[[s.Jo,m.value.midTermTrigger,void 0,{number:!0}]]),(0,r.Lk)("span",eS,(0,o.v_)((0,i.R1)(c)("中期记忆达到此数量时，转化为长期记忆。默认：25")),1)]),(0,r.Lk)("div",nS,[(0,r.Lk)("label",tS,(0,o.v_)((0,i.R1)(c)("中期记忆保留数量（条）：")),1),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[4]||(n[4]=e=>m.value.midTermKeep=e),min:"5",max:"15",class:"setting-input"},null,512),[[s.Jo,m.value.midTermKeep,void 0,{number:!0}]]),(0,r.Lk)("span",aS,(0,o.v_)((0,i.R1)(c)("转化为长期记忆时，保留最新的这么多条中期记忆。默认：8")),1)]),(0,r.Lk)("div",rS,[(0,r.Lk)("label",oS,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=e=>m.value.autoSummaryEnabled=e),class:"setting-checkbox"},null,512),[[s.lH,m.value.autoSummaryEnabled]]),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(c)("启用自动记忆转化")),1)]),(0,r.Lk)("span",iS,(0,o.v_)((0,i.R1)(c)("启用后，自动将中期记忆转化为长期记忆。禁用则不转化。")),1)]),(0,r.Lk)("div",sS,[(0,r.Lk)("label",lS,(0,o.v_)((0,i.R1)(c)("自定义中期记忆格式：")),1),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[6]||(n[6]=e=>m.value.midTermFormat=e),class:"setting-textarea",placeholder:(0,i.R1)(c)("留空使用默认格式。可自定义AI提示词来控制记忆的生成格式..."),rows:"4"},null,8,cS),[[s.Jo,m.value.midTermFormat]]),(0,r.Lk)("span",dS,(0,o.v_)((0,i.R1)(c)("自定义中期记忆的AI提示词格式。留空使用系统默认。")),1)]),(0,r.Lk)("div",uS,[(0,r.Lk)("label",pS,(0,o.v_)((0,i.R1)(c)("自定义长期记忆格式：")),1),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[7]||(n[7]=e=>m.value.longTermFormat=e),class:"setting-textarea",placeholder:(0,i.R1)(c)("留空使用默认格式。可自定义AI提示词来控制记忆的生成格式..."),rows:"4"},null,8,vS),[[s.Jo,m.value.longTermFormat]]),(0,r.Lk)("span",fS,(0,o.v_)((0,i.R1)(c)("自定义长期记忆的AI提示词格式。留空使用系统默认。")),1)]),(0,r.Lk)("div",hS,[(0,r.Lk)("button",{class:"action-btn success",onClick:ee}," 💾 "+(0,o.v_)((0,i.R1)(c)("保存配置")),1),(0,r.Lk)("button",{class:"action-btn info",onClick:ne},(0,o.v_)((0,i.R1)(c)("重置为默认")),1)]),(0,r.Q3)(" 手动总结触发 "),(0,r.Lk)("div",mS,[(0,r.Lk)("div",gS,[(0,r.Lk)("span",bS,(0,o.v_)((0,i.R1)(c)("当前中期记忆："))+" "+(0,o.v_)(b.value.length)+" "+(0,o.v_)((0,i.R1)(c)("条")),1),(0,r.Lk)("span",yS,(0,o.v_)((0,i.R1)(c)("达到{count}条时将自动触发总结",{count:m.value.midTermTrigger})),1)]),(0,r.Lk)("button",{class:"action-btn warning",onClick:te,disabled:b.value.length<m.value.midTermKeep+5,title:b.value.length<m.value.midTermKeep+5?(0,i.R1)(c)("manualSummaryRequirement",{count:m.value.midTermKeep+5}):(0,i.R1)(c)("手动触发AI总结")}," 📝 "+(0,o.v_)((0,i.R1)(c)("手动总结中期记忆")),9,xS)])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 记忆列表 "),p.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",kS,["vector"===u.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("div",wS,[(0,r.Lk)("div",_S,[(0,r.Lk)("span",{class:(0,o.C4)(["status-dot",{enabled:S.value}])},null,2),(0,r.Lk)("span",CS,(0,o.v_)(S.value?"向量检索已启用":"向量检索未启用（不会参与AI检索）"),1),(0,r.Lk)("div",{class:(0,o.C4)(["status-subtext",{warning:!L.value.available}])},[L.value.available?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.eW)(" Embedding："+(0,o.v_)(L.value.provider)+"/"+(0,o.v_)(L.value.model),1)],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.eW)((0,o.v_)(L.value.reason),1)],64))],2)]),(0,r.Lk)("div",AS,[(0,r.Lk)("button",{class:"action-btn info",onClick:Y,disabled:w.value||C.value||0===y.value.length,title:0===y.value.length?"当前没有长期记忆可转化":"清空并重新生成向量库（优先使用Embedding）"}," 一键转化长期记忆 ",8,SS),(0,r.Lk)("button",{class:"action-btn info",onClick:W,disabled:w.value},"刷新",8,LS),(0,r.Lk)("button",{class:"action-btn warning",onClick:J,disabled:w.value||0===E.value},"清空向量库",8,ES)])]),w.value?((0,r.uX)(),(0,r.CE)("div",TS,[n[16]||(n[16]=(0,r.Lk)("div",{class:"loading-spinner"},"⏳",-1)),(0,r.Lk)("div",IS,(0,o.v_)(R.value),1)])):_.value?((0,r.uX)(),(0,r.CE)("div",RS,[n[17]||(n[17]=(0,r.Lk)("div",{class:"empty-icon"},"⚠️",-1)),(0,r.Lk)("div",MS,(0,o.v_)(_.value),1)])):0===E.value?((0,r.uX)(),(0,r.CE)("div",PS,[n[18]||(n[18]=(0,r.Lk)("div",{class:"empty-icon"},"🧬",-1)),n[19]||(n[19]=(0,r.Lk)("div",{class:"empty-text"},"向量库为空",-1)),(0,r.Lk)("button",{class:"action-btn info",onClick:Y,disabled:C.value||0===y.value.length}," 一键转化长期记忆 ",8,DS)])):((0,r.uX)(),(0,r.CE)("div",zS,[k.value?((0,r.uX)(),(0,r.CE)("div",NS,[(0,r.Lk)("div",$S,[n[20]||(n[20]=(0,r.Lk)("span",{class:"stats-label"},"总数",-1)),(0,r.Lk)("span",OS,(0,o.v_)(k.value.total),1)]),Object.keys(k.value.byCategory).length?((0,r.uX)(),(0,r.CE)("div",FS,[n[21]||(n[21]=(0,r.Lk)("span",{class:"stats-label"},"分类",-1)),(0,r.Lk)("span",jS,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Object.entries(k.value.byCategory),(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:e[0],class:"stats-chip"},[(0,r.eW)((0,o.v_)(e[0])+": "+(0,o.v_)(e[1]),1),n<Object.keys(k.value.byCategory).length-1?((0,r.uX)(),(0,r.CE)("span",BS," · ")):(0,r.Q3)("v-if",!0)]))),128))])])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),E.value>f.value?((0,r.uX)(),(0,r.CE)("div",XS,[(0,r.Lk)("div",US,"第 "+(0,o.v_)(v.value)+" / "+(0,o.v_)(T.value)+" 页，共 "+(0,o.v_)(E.value)+" 条",1),(0,r.Lk)("div",WS,[(0,r.Lk)("button",{class:"page-btn",onClick:H,disabled:1===v.value},[(0,r.bF)((0,i.R1)(LA),{size:16})],8,qS),(0,r.Lk)("button",{class:"page-btn",onClick:n[8]||(n[8]=e=>G(v.value-1)),disabled:1===v.value},[(0,r.bF)((0,i.R1)(Kc),{size:16})],8,GS),(0,r.Lk)("button",{class:"page-btn",onClick:n[9]||(n[9]=e=>G(v.value+1)),disabled:v.value===T.value},[(0,r.bF)((0,i.R1)(Yc),{size:16})],8,HS),(0,r.Lk)("button",{class:"page-btn",onClick:V,disabled:v.value===T.value},[(0,r.bF)((0,i.R1)(EA),{size:16})],8,VS)]),(0,r.Lk)("div",QS,[(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[10]||(n[10]=e=>h.value=e),placeholder:"页",class:"jump-input",onKeyup:(0,s.jR)(Q,["enter"]),min:"1",max:T.value},null,40,KS),[[s.Jo,h.value]]),(0,r.Lk)("button",{class:"jump-btn",onClick:Q},"跳转")])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",YS,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(I.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"vector-card"},[(0,r.Lk)("div",JS,[(0,r.Lk)("div",ZS,[(0,r.Lk)("span",eL,(0,o.v_)(e.category),1),(0,r.Lk)("span",nL,"重要: "+(0,o.v_)(e.importance),1)]),(0,r.Lk)("div",tL,(0,o.v_)(X(e.timestamp)),1)]),e.tags?.length?((0,r.uX)(),(0,r.CE)("div",aL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.tags,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"vector-tag"},"#"+(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",rL,(0,o.v_)(e.content),1)]))),128))])]))],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[d.value?((0,r.uX)(),(0,r.CE)("div",oL,[n[22]||(n[22]=(0,r.Lk)("div",{class:"loading-spinner"},"⏳",-1)),(0,r.Lk)("div",iL,(0,o.v_)((0,i.R1)(c)("正在读取记忆...")),1)])):0===N.value.length?((0,r.uX)(),(0,r.CE)("div",sL,[n[23]||(n[23]=(0,r.Lk)("div",{class:"empty-icon"},"🧠",-1)),(0,r.Lk)("div",lL,(0,o.v_)(j()),1)])):((0,r.uX)(),(0,r.CE)("div",cL,[(0,r.Q3)(" 分页控制 "),D.value.length>f.value?((0,r.uX)(),(0,r.CE)("div",dL,[(0,r.Lk)("div",uL,(0,o.v_)((0,i.R1)(c)("第 {currentPage} / {totalPages} 页，共 {total} 条记忆",{currentPage:v.value,totalPages:z.value,total:D.value.length})),1),(0,r.Lk)("div",pL,[(0,r.Lk)("button",{class:"page-btn",onClick:H,disabled:1===v.value,title:(0,i.R1)(c)("首页")},[(0,r.bF)((0,i.R1)(LA),{size:16})],8,vL),(0,r.Lk)("button",{class:"page-btn",onClick:n[11]||(n[11]=e=>G(v.value-1)),disabled:1===v.value,title:(0,i.R1)(c)("上一页")},[(0,r.bF)((0,i.R1)(Kc),{size:16})],8,fL),(0,r.Lk)("button",{class:"page-btn",onClick:n[12]||(n[12]=e=>G(v.value+1)),disabled:v.value===z.value,title:(0,i.R1)(c)("下一页")},[(0,r.bF)((0,i.R1)(Yc),{size:16})],8,hL),(0,r.Lk)("button",{class:"page-btn",onClick:V,disabled:v.value===z.value,title:(0,i.R1)(c)("末页")},[(0,r.bF)((0,i.R1)(EA),{size:16})],8,mL)]),(0,r.Lk)("div",gL,[(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[13]||(n[13]=e=>h.value=e),placeholder:(0,i.R1)(c)("页"),class:"jump-input",onKeyup:(0,s.jR)(Q,["enter"]),min:"1",max:z.value},null,40,bL),[[s.Jo,h.value]]),(0,r.Lk)("button",{class:"jump-btn",onClick:Q},(0,o.v_)((0,i.R1)(c)("跳转")),1)])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",yL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(N.value,(e,t)=>{return(0,r.uX)(),(0,r.CE)("div",{key:t,class:(0,o.C4)(["memory-card",`memory-${e.type}`])},[(0,r.Lk)("div",xL,[(0,r.Lk)("div",{class:(0,o.C4)(["memory-type-badge",`badge-${e.type}`])},(0,o.v_)((a=e.type,{short:"⚡",medium:"💭",long:"💾"}[a]||"🧠"))+" "+(0,o.v_)(B(e.type)),3),(0,r.Lk)("div",kL,[(0,r.Lk)("button",{class:"delete-memory-btn",onClick:(0,s.D$)(n=>(async e=>{K.showRetryDialog({title:c("删除记忆"),message:c("confirmDeleteMemory",{type:B(e.type),content:e.content.substring(0,50)}),confirmText:c("删除"),cancelText:c("取消"),onConfirm:async()=>{try{let n=-1;switch(e.type){case"short":n=g.value.findIndex(n=>n===e),-1!==n&&g.value.splice(n,1);break;case"medium":n=b.value.findIndex(n=>n===e),-1!==n&&b.value.splice(n,1);break;case"long":n=y.value.findIndex(n=>n===e),-1!==n&&y.value.splice(n,1)}if(-1===n)return void _e.o.error(c("未找到要删除的记忆"));await U(),TA.Yz.log("记忆中心",`✅ 已删除${B(e.type)}并同步到存档`),_e.o.success(c("memoryDeleted",{type:B(e.type)}))}catch(e){TA.Yz.error("记忆中心","删除记忆失败:",e);const n=e instanceof Error?e.message:"未知错误";_e.o.error(c("deleteFailed",{error:n}))}},onCancel:()=>{}})})(e),["stop"]),title:(0,i.R1)(c)("删除此记忆")}," 🗑️ ",8,wL),(0,r.Lk)("div",_L,(0,o.v_)(e.time),1)])]),(0,r.Lk)("div",CL,[e.parsedContent&&e.parsedContent.format?((0,r.uX)(),(0,r.CE)("div",AL,[e.parsedContent.title?((0,r.uX)(),(0,r.CE)("div",SL," 【"+(0,o.v_)(e.parsedContent.title)+"】 ",1)):(0,r.Q3)("v-if",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.parsedContent.format.sections,n=>((0,r.uX)(),(0,r.CE)(r.FK,{key:n.key},[e.parsedContent.sections&&e.parsedContent.sections[n.key]?((0,r.uX)(),(0,r.CE)("div",LL,[(0,r.Lk)("div",EL,[(0,r.Lk)("span",TL,(0,o.v_)(n.icon),1),(0,r.Lk)("span",IL,(0,o.v_)(n.title),1)]),(0,r.Q3)(" 确保只在数组时才遍历，字符串直接显示 "),Array.isArray(e.parsedContent.sections[n.key])?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(e.parsedContent.sections[n.key],e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:"memory-item"},(0,o.v_)(e),1))),128)):((0,r.uX)(),(0,r.CE)("div",RL,(0,o.v_)(e.parsedContent.sections[n.key]),1))])):(0,r.Q3)("v-if",!0)],64))),128)),(0,r.Q3)(" 未识别的通用内容 "),e.parsedContent.sections.general?((0,r.uX)(),(0,r.CE)("div",ML,[(0,r.Lk)("div",PL,[n[24]||(n[24]=(0,r.Lk)("span",{class:"memory-icon"},"📝",-1)),(0,r.Lk)("span",DL,(0,o.v_)((0,i.R1)(c)("其他记录")),1)]),(0,r.Q3)(" 确保只在数组时才遍历，字符串直接显示 "),Array.isArray(e.parsedContent.sections.general)?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(e.parsedContent.sections.general,e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:"memory-item"},(0,o.v_)(e),1))),128)):((0,r.uX)(),(0,r.CE)("div",zL,(0,o.v_)(e.parsedContent.sections.general),1))])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",NL,(0,o.v_)(e.content),1))])],2);var a}),128))]),(0,r.Q3)(" 底部分页控制 "),D.value.length>f.value?((0,r.uX)(),(0,r.CE)("div",$L,[(0,r.Lk)("div",OL,(0,o.v_)((0,i.R1)(c)("页"))+" "+(0,o.v_)(v.value)+" / "+(0,o.v_)(z.value),1),(0,r.Lk)("div",FL,[(0,r.Lk)("button",{class:"page-btn",onClick:H,disabled:1===v.value},[(0,r.bF)((0,i.R1)(LA),{size:16})],8,jL),(0,r.Lk)("button",{class:"page-btn",onClick:n[14]||(n[14]=e=>G(v.value-1)),disabled:1===v.value},[(0,r.bF)((0,i.R1)(Kc),{size:16})],8,BL),(0,r.Lk)("button",{class:"page-btn",onClick:n[15]||(n[15]=e=>G(v.value+1)),disabled:v.value===z.value},[(0,r.bF)((0,i.R1)(Yc),{size:16})],8,XL),(0,r.Lk)("button",{class:"page-btn",onClick:V,disabled:v.value===z.value},[(0,r.bF)((0,i.R1)(EA),{size:16})],8,UL)])])):(0,r.Q3)("v-if",!0)]))],64))]))]))}});var qL=t(6392),GL={};GL.styleTagTransform=A(),GL.setAttributes=k(),GL.insert=y().bind(null,"head"),GL.domAPI=g(),GL.insertStyleElement=_(),h()(qL.A,GL),qL.A&&qL.A.locals&&qL.A.locals;const HL=(0,E.A)(WL,[["__scopeId","data-v-629034e8"]]),VL=(0,I.A)("file-question-mark",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]),QL=(0,I.A)("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),KL=(0,I.A)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),YL=(0,I.A)("flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),JL=(0,I.A)("stamp",[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]]);var ZL=t(6585);const eE={class:"body-stats-panel"},nE={key:0,class:"privacy-notice"},tE={key:1,class:"empty-stats"},aE={class:"empty-icon"},rE={class:"sub-text"},oE={key:2,class:"stats-container"},iE={class:"stat-section lifespan-section"},sE={class:"section-title"},lE={key:0,class:"lifespan-display"},cE={class:"lifespan-info"},dE={class:"lifespan-current"},uE={class:"lifespan-max"},pE={class:"lifespan-unit"},vE={class:"lifespan-bar"},fE={class:"lifespan-hint"},hE={key:1,class:"empty-hint"},mE={class:"stat-section"},gE={class:"section-title"},bE={key:0,class:"stats-grid"},yE={key:0,class:"stat-card"},xE={class:"label"},kE={class:"value"},wE={key:1,class:"stat-card"},_E={class:"label"},CE={class:"value"},AE={key:2,class:"stat-card"},SE={class:"label"},LE={class:"value"},EE={key:1,class:"empty-hint"},TE={key:2,class:"tags-container"},IE={class:"stat-section"},RE={class:"section-title"},ME={key:0,class:"measurements-display"},PE={class:"measurement-item"},DE={class:"measure-circle"},zE={class:"measure-val"},NE={class:"measure-label"},$E={class:"measurement-item"},OE={class:"measure-circle"},FE={class:"measure-val"},jE={class:"measure-label"},BE={class:"measurement-item"},XE={class:"measure-circle"},UE={class:"measure-val"},WE={class:"measure-label"},qE={key:1,class:"empty-hint"},GE={key:2,class:"cup-display"},HE={class:"cup-label"},VE={class:"cup-value"},QE={class:"stat-section"},KE={class:"section-title"},YE={key:0,class:"description-list"},JE={key:0,class:"desc-item"},ZE={class:"desc-label"},eT={class:"desc-content"},nT={key:1,class:"desc-item"},tT={class:"desc-label"},aT={class:"desc-content"},rT={key:2,class:"desc-item"},oT={class:"desc-label"},iT={class:"desc-content"},sT={key:1,class:"empty-hint"},lT={class:"stat-section"},cT={class:"section-title"},dT={key:0},uT={key:0,class:"sensitive-points"},pT={class:"sub-title"},vT={class:"points-list"},fT={key:1,class:"development-list"},hT={class:"dev-header"},mT={class:"dev-name"},gT={class:"dev-val"},bT={class:"dev-bar"},yT={key:1,class:"empty-hint"},xT={class:"stat-section"},kT={class:"section-title"},wT={key:0,class:"markings-list"},_T={key:1,class:"empty-hint"},CT=(0,r.pM)({__name:"BodyStatsPanel",props:{bodyStats:{},lifespan:{}},setup(e){const n=e,{t}=(0,l.s)(),a=e=>"string"==typeof e&&e.trim().length>0&&"待AI生成"!==e,s=(0,r.EW)(()=>{if(!n.bodyStats||"object"!=typeof n.bodyStats)return null;const e=n.bodyStats,t=n=>"number"==typeof e[n]&&!Number.isNaN(e[n]),r=e["三围"],o=(()=>{if(!r||"object"!=typeof r)return!1;const e=r;return"number"==typeof e.胸围&&"number"==typeof e.腰围&&"number"==typeof e.臀围})();return t("身高")||t("体重")||o||a(e["胸部描述"])||a(e["私处描述"])||a(e["生殖器描述"])||Array.isArray(e["外观特征"])&&e["外观特征"].length>0||Array.isArray(e["敏感点"])&&e["敏感点"].length>0||e["开发度"]&&"object"==typeof e["开发度"]&&Object.keys(e["开发度"]).length>0||Array.isArray(e["纹身与印记"])&&e["纹身与印记"].length>0?e:null}),c=(0,i.KR)(!0),d=()=>{c.value=(0,ZL.rW)().nsfwMode};(0,r.sV)(d),(0,r.n)(d);const u=(0,r.EW)(()=>{const e=c.value?t("成人内容：开启"):t("成人内容：关闭");return`${t("私密档案")} · ${e}`}),p=(0,r.EW)(()=>{if(!s.value)return!1;const e=s.value;return Array.isArray(e.敏感点)&&e.敏感点.length>0||e.开发度&&"object"==typeof e.开发度&&Object.keys(e.开发度).length>0}),v=(0,r.EW)(()=>{const e=s.value;if(!e?.开发度||"object"!=typeof e.开发度)return[];const n=Object.entries(e.开发度).map(([e,n])=>({name:e,value:"number"==typeof n?n:Number(n)})).filter(e=>Number.isFinite(e.value)).map(e=>({...e,value:Math.max(0,Math.min(100,Math.round(e.value)))}));return n}),f=(0,r.EW)(()=>!!s.value&&("number"==typeof s.value.身高||"number"==typeof s.value.体重||"number"==typeof s.value.体脂率)),h=(0,r.EW)(()=>{const e=s.value;return!!e?.三围&&"number"==typeof e.三围.胸围&&"number"==typeof e.三围.腰围&&"number"==typeof e.三围.臀围}),m=(0,r.EW)(()=>{const e=s.value;return!!e&&(a(e.胸部描述)||a(e.私处描述)||a(e.生殖器描述))}),g=(0,r.EW)(()=>c.value),b=(0,r.EW)(()=>n.lifespan?Math.min(100,Math.round(n.lifespan.current/n.lifespan.max*100)):0);return(e,n)=>((0,r.uX)(),(0,r.CE)("div",eE,[g.value?((0,r.uX)(),(0,r.CE)("div",nE,[(0,r.bF)((0,i.R1)(D),{size:14}),(0,r.Lk)("span",null,(0,o.v_)(u.value),1)])):(0,r.Q3)("v-if",!0),s.value?((0,r.uX)(),(0,r.CE)("div",oE,[(0,r.Q3)(" 寿元状态 "),(0,r.Lk)("div",iE,[(0,r.Lk)("h3",sE,[(0,r.bF)((0,i.R1)(Bp),{size:18,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(t)("寿元")),1)]),e.lifespan?((0,r.uX)(),(0,r.CE)("div",lE,[(0,r.Lk)("div",cE,[(0,r.Lk)("span",dE,(0,o.v_)(e.lifespan.current),1),n[0]||(n[0]=(0,r.Lk)("span",{class:"lifespan-divider"},"/",-1)),(0,r.Lk)("span",uE,(0,o.v_)(e.lifespan.max),1),(0,r.Lk)("span",pE,(0,o.v_)((0,i.R1)(t)("岁")),1)]),(0,r.Lk)("div",vE,[(0,r.Lk)("div",{class:(0,o.C4)(["lifespan-fill",{warning:b.value>70,danger:b.value>90}]),style:(0,o.Tr)({width:b.value+"%"})},null,6)]),(0,r.Lk)("div",fE,(0,o.v_)((0,i.R1)(t)("剩余"))+" "+(0,o.v_)(e.lifespan.max-e.lifespan.current)+" "+(0,o.v_)((0,i.R1)(t)("年")),1)])):((0,r.uX)(),(0,r.CE)("div",hE,(0,o.v_)((0,i.R1)(t)("寿元数据未生成")),1))]),(0,r.Q3)(" 基础体格 "),(0,r.Lk)("div",mE,[(0,r.Lk)("h3",gE,[(0,r.bF)((0,i.R1)(QL),{size:18,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(t)("基础体格")),1)]),f.value?((0,r.uX)(),(0,r.CE)("div",bE,["number"==typeof s.value.身高?((0,r.uX)(),(0,r.CE)("div",yE,[(0,r.Lk)("span",xE,(0,o.v_)((0,i.R1)(t)("身高")),1),(0,r.Lk)("span",kE,[(0,r.eW)((0,o.v_)(s.value.身高)+" ",1),n[1]||(n[1]=(0,r.Lk)("span",{class:"unit"},"cm",-1))])])):(0,r.Q3)("v-if",!0),"number"==typeof s.value.体重?((0,r.uX)(),(0,r.CE)("div",wE,[(0,r.Lk)("span",_E,(0,o.v_)((0,i.R1)(t)("体重")),1),(0,r.Lk)("span",CE,[(0,r.eW)((0,o.v_)(s.value.体重)+" ",1),n[2]||(n[2]=(0,r.Lk)("span",{class:"unit"},"kg",-1))])])):(0,r.Q3)("v-if",!0),"number"==typeof s.value.体脂率?((0,r.uX)(),(0,r.CE)("div",AE,[(0,r.Lk)("span",SE,(0,o.v_)((0,i.R1)(t)("体脂率")),1),(0,r.Lk)("span",LE,[(0,r.eW)((0,o.v_)(s.value.体脂率)+" ",1),n[3]||(n[3]=(0,r.Lk)("span",{class:"unit"},"%",-1))])])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",EE,(0,o.v_)((0,i.R1)(t)("体格数据未生成")),1)),Array.isArray(s.value.外观特征)&&s.value.外观特征.length?((0,r.uX)(),(0,r.CE)("div",TE,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value.外观特征,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"feature-tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 三围数据 "),(0,r.Lk)("div",IE,[(0,r.Lk)("h3",RE,[(0,r.bF)((0,i.R1)(KL),{size:18,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(t)("身材数据")),1)]),h.value?((0,r.uX)(),(0,r.CE)("div",ME,[(0,r.Lk)("div",PE,[(0,r.Lk)("div",DE,[(0,r.Lk)("span",zE,(0,o.v_)(s.value.三围?.胸围),1),(0,r.Lk)("span",NE,(0,o.v_)((0,i.R1)(t)("胸围")),1)])]),n[4]||(n[4]=(0,r.Lk)("div",{class:"measurement-divider"},"-",-1)),(0,r.Lk)("div",$E,[(0,r.Lk)("div",OE,[(0,r.Lk)("span",FE,(0,o.v_)(s.value.三围?.腰围),1),(0,r.Lk)("span",jE,(0,o.v_)((0,i.R1)(t)("腰围")),1)])]),n[5]||(n[5]=(0,r.Lk)("div",{class:"measurement-divider"},"-",-1)),(0,r.Lk)("div",BE,[(0,r.Lk)("div",XE,[(0,r.Lk)("span",UE,(0,o.v_)(s.value.三围?.臀围),1),(0,r.Lk)("span",WE,(0,o.v_)((0,i.R1)(t)("臀围")),1)])])])):((0,r.uX)(),(0,r.CE)("div",qE,(0,o.v_)((0,i.R1)(t)("身材数据未生成")),1)),a(s.value.罩杯)?((0,r.uX)(),(0,r.CE)("div",GE,[(0,r.Lk)("span",HE,(0,o.v_)((0,i.R1)(t)("罩杯")),1),(0,r.Lk)("span",VE,(0,o.v_)(s.value.罩杯),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 详细描述 "),(0,r.Lk)("div",QE,[(0,r.Lk)("h3",KE,[(0,r.bF)((0,i.R1)(Jc.A),{size:18,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(t)("详细特征")),1)]),m.value?((0,r.uX)(),(0,r.CE)("div",YE,[a(s.value.胸部描述)?((0,r.uX)(),(0,r.CE)("div",JE,[(0,r.Lk)("span",ZE,(0,o.v_)((0,i.R1)(t)("胸部")),1),(0,r.Lk)("p",eT,(0,o.v_)(s.value.胸部描述),1)])):(0,r.Q3)("v-if",!0),a(s.value.私处描述)?((0,r.uX)(),(0,r.CE)("div",nT,[(0,r.Lk)("span",tT,(0,o.v_)((0,i.R1)(t)("私处")),1),(0,r.Lk)("p",aT,(0,o.v_)(s.value.私处描述),1)])):(0,r.Q3)("v-if",!0),a(s.value.生殖器描述)?((0,r.uX)(),(0,r.CE)("div",rT,[(0,r.Lk)("span",oT,(0,o.v_)((0,i.R1)(t)("生殖器")),1),(0,r.Lk)("p",iT,(0,o.v_)(s.value.生殖器描述),1)])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",sT,(0,o.v_)((0,i.R1)(t)("详细特征未生成")),1))]),(0,r.Q3)(" 敏感点与开发 "),(0,r.Lk)("div",lT,[(0,r.Lk)("h3",cT,[(0,r.bF)((0,i.R1)(YL),{size:18,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(t)("敏感与开发")),1)]),p.value?((0,r.uX)(),(0,r.CE)("div",dT,[Array.isArray(s.value.敏感点)&&s.value.敏感点.length?((0,r.uX)(),(0,r.CE)("div",uT,[(0,r.Lk)("span",pT,(0,o.v_)((0,i.R1)(t)("敏感点"))+":",1),(0,r.Lk)("div",vT,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value.敏感点,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"point-tag"},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("v-if",!0),v.value.length?((0,r.uX)(),(0,r.CE)("div",fT,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.name,class:"dev-item"},[(0,r.Lk)("div",hT,[(0,r.Lk)("span",mT,(0,o.v_)(e.name),1),(0,r.Lk)("span",gT,(0,o.v_)(e.value)+"%",1)]),(0,r.Lk)("div",bT,[(0,r.Lk)("div",{class:"dev-fill",style:(0,o.Tr)({width:e.value+"%"})},null,4)])]))),128))])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",yT,(0,o.v_)((0,i.R1)(t)("敏感数据未生成")),1))]),(0,r.Q3)(" 纹身与印记 "),(0,r.Lk)("div",xT,[(0,r.Lk)("h3",kT,[(0,r.bF)((0,i.R1)(JL),{size:18,class:"title-icon"}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(t)("纹身与印记")),1)]),Array.isArray(s.value.纹身与印记)&&s.value.纹身与印记.length?((0,r.uX)(),(0,r.CE)("ul",wT,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value.纹身与印记,e=>((0,r.uX)(),(0,r.CE)("li",{key:e,class:"marking-item"},(0,o.v_)(e),1))),128))])):((0,r.uX)(),(0,r.CE)("div",_T,(0,o.v_)((0,i.R1)(t)("暂无纹身与印记")),1))])])):((0,r.uX)(),(0,r.CE)("div",tE,[(0,r.Lk)("div",aE,[(0,r.bF)((0,i.R1)(VL),{size:32})]),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(t)("暂无详细身体数据")),1),(0,r.Lk)("p",rE,(0,o.v_)((0,i.R1)(t)("请在设置中完善角色设定")),1)]))]))}});var AT=t(6260),ST={};ST.styleTagTransform=A(),ST.setAttributes=k(),ST.insert=y().bind(null,"head"),ST.domAPI=g(),ST.insertStyleElement=_(),h()(AT.A,ST),AT.A&&AT.A.locals&&AT.A.locals;const LT=(0,E.A)(CT,[["__scopeId","data-v-1bbcf5ca"]]),ET=(0,I.A)("handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]),TT=(0,I.A)("backpack",[["path",{d:"M4 10a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z",key:"1ol0lm"}],["path",{d:"M8 10h8",key:"c7uz4u"}],["path",{d:"M8 18h8",key:"1no2b1"}],["path",{d:"M8 22v-6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v6",key:"1fr6do"}],["path",{d:"M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2",key:"donm21"}]]),IT=(0,I.A)("mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]),RT=(0,I.A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),MT={class:"character-details-wrapper custom-scrollbar"},PT={key:0,class:"state-container loading"},DT={class:"state-text"},zT={key:1,class:"state-container error"},NT={class:"error-icon-wrapper"},$T={class:"state-text"},OT={key:2,class:"character-details-content"},FT={class:"character-header-card glass-panel"},jT={class:"header-content"},BT={class:"profile-section"},XT={class:"avatar-container"},UT=["data-realm"],WT={class:"avatar-text"},qT={class:"identity-info"},GT={class:"character-name text-gradient"},HT={class:"character-tags"},VT={class:"meta-chip"},QT={class:"meta-chip"},KT={class:"stats-overview"},YT={class:"stat-mini-card"},JT={class:"icon-box realm"},ZT={class:"stat-info"},eI={class:"label"},nI={class:"value highlight"},tI={key:0,class:"stat-mini-card"},aI={class:"icon-box location"},rI={class:"stat-info"},oI={class:"label"},iI=["title"],sI={class:"tabs-nav-wrapper"},lI={class:"tabs-nav"},cI=["onClick"],dI={key:0,class:"active-indicator"},uI={key:0,class:"tab-pane"},pI={class:"pane-grid"},vI={class:"info-card glass-panel"},fI={class:"card-header"},hI={class:"vitals-container"},mI={class:"vital-meta"},gI={class:"vital-name"},bI={class:"vital-nums"},yI={class:"vital-track"},xI={class:"reputation-badge"},kI={class:"rep-label"},wI={class:"rep-value"},_I={class:"info-card glass-panel"},CI={class:"card-header"},AI={class:"talent-layout"},SI={class:"talents-grid"},LI={class:"talent-chip tier-chip"},EI={class:"chip-label"},TI={class:"chip-val tier-text"},II=["title"],RI={key:1,class:"talent-chip empty"},MI={class:"info-card glass-panel full-width"},PI={class:"card-header"},DI={class:"attributes-wrapper"},zI={class:"attr-group final"},NI={class:"attr-key"},$I={class:"attr-val"},OI={class:"attr-divider"},FI={class:"attr-breakdown"},jI={class:"breakdown-col"},BI={class:"k"},XI={class:"v"},UI={class:"breakdown-col"},WI={class:"k"},qI={class:"v"},GI={key:1,class:"tab-pane"},HI={class:"pane-grid"},VI={class:"info-card glass-panel"},QI={class:"card-header"},KI={class:"stat-row"},YI={class:"stat-item big-num"},JI={class:"stat-item big-num"},ZI={class:"info-card glass-panel"},eR={class:"card-header"},nR={class:"relationship-list custom-scrollbar"},tR={class:"rel-main"},aR={class:"rel-name"},rR={class:"rel-meta"},oR={class:"rel-tag"},iR={key:0,class:"rel-tag special"},sR={class:"rel-realm"},lR={key:0,class:"empty-placeholder text-sm"},cR={key:0,class:"info-card glass-panel"},dR={class:"card-header"},uR={class:"sect-grid"},pR={class:"kv"},vR={class:"k"},fR={class:"v"},hR={class:"kv"},mR={class:"k"},gR={class:"v"},bR={class:"kv"},yR={class:"k"},xR={class:"v"},kR={class:"kv"},wR={class:"k"},_R={class:"v highlight"},CR={key:2,class:"tab-pane"},AR={class:"pane-grid"},SR={class:"info-card glass-panel"},LR={class:"card-header"},ER={class:"inventory-stats-grid"},TR={class:"inv-stat"},IR={class:"num"},RR={class:"lbl"},MR={class:"inv-stat"},PR={class:"num gold-text"},DR={class:"lbl"},zR={class:"spirit-stones-grid"},NR={class:"stone-kv"},$R={class:"k"},OR={class:"v"},FR={class:"stone-kv"},jR={class:"k"},BR={class:"v"},XR={class:"stone-kv"},UR={class:"k"},WR={class:"v"},qR={class:"stone-kv"},GR={class:"k"},HR={class:"v"},VR={class:"info-card glass-panel"},QR={class:"card-header"},KR={class:"inventory-preview custom-scrollbar"},YR={class:"inv-main"},JR={class:"inv-name"},ZR={class:"inv-meta"},eM={class:"inv-qty"},nM={key:0,class:"empty-placeholder text-sm"},tM={key:3,class:"tab-pane"},aM={class:"info-card glass-panel"},rM={key:0,class:"modal-inner"},oM={class:"modal-title"},iM={class:"modal-subtitle"},sM={class:"d-desc-box"},lM=(0,r.pM)({__name:"CharacterDetailsPanel",setup(e){const{t:n}=(0,l.s)(),t=(0,Ec.useCharacterStore)(),a=(0,Hu.useGameStateStore)(),c=(0,i.KR)(!1),d=(0,r.EW)(()=>c.value||!a.isGameLoaded),u=(0,r.EW)(()=>a.toSaveData()),p=(0,r.EW)(()=>a.character),v=(0,r.EW)(()=>a.attributes),f=(0,r.EW)(()=>a.location),h=(0,r.EW)(()=>a.sectMemberInfo),m=(0,r.EW)(()=>a.body||null),g=(0,r.EW)(()=>a.gameTime),b=(0,r.EW)(()=>a.inventory),y=(0,r.EW)(()=>a.relationships),x=(0,i.KR)("character"),k=(0,i.KR)(!1),w=((0,i.KR)(!1),(0,i.KR)(null)),_=(0,r.EW)(()=>{const e=[{id:"character",label:"角色",icon:P},{id:"social",label:"社交",icon:ET},{id:"inventory",label:"物品",icon:TT}];return U.value&&e.push({id:"body",label:"法身",icon:Wp.A}),e}),C=(0,r.EW)(()=>(p.value?.名字||"").slice(0,1)||"?"),A=(0,r.EW)(()=>{const e=p.value?.出生日期,n=g.value;return e&&n?(0,sh.R5)(e,n):0}),S=(0,r.EW)(()=>{try{const e=a.toSaveData(),t=e?(0,lh.Ew)(e):{STR:0,AGI:0,CON:0,WIL:0,CHA:0,LCK:0},r=Q.value,o=e?.角色?.装备||{},i=e?.角色?.背包||{},s=(0,lh.FY)(o,i),l=(0,lh.Nz)(t,r,{equipmentDerivedBonuses:s}),c=v.value?.寿命?.上限??v.value?.属性?.寿命?.上限??0,d=v.value||(e?.角色?.属性??{}),u=(e,n)=>{const t="number"==typeof e?e:Number(e??0),a="number"==typeof n?n:Number(n??0);return Number.isFinite(t)?!Number.isFinite(a)||a<=0?Math.max(0,t):Math.max(0,Math.min(t,a)):0};return[{label:n("生命值"),current:u(d?.生命值?.当前,l.HP.上限),max:Number(l.HP.上限)||0,color:"red-bar"},{label:n("精神力"),current:u(d?.精神力?.当前,l.SP.上限),max:Number(l.SP.上限)||0,color:"blue-bar"},{label:n("体力"),current:u(d?.体力?.当前,l.ST.上限),max:Number(l.ST.上限)||0,color:"gold-bar"},{label:n("理智值"),current:u(d?.理智值?.当前,l.SAN.上限),max:Number(l.SAN.上限)||0,color:"ink-bar"},{label:n("寿命"),current:Number(A.value)||0,max:Number(c)||0,color:"purple-bar"}]}catch{return[{label:n("生命值"),current:0,max:0,color:"red-bar"},{label:n("精神力"),current:0,max:0,color:"blue-bar"},{label:n("体力"),current:0,max:0,color:"gold-bar"},{label:n("理智值"),current:0,max:0,color:"ink-bar"},{label:n("寿命"),current:Number(A.value)||0,max:0,color:"purple-bar"}]}}),L=(0,r.EW)(()=>{const e=p.value,n=e?.先天属性;return t=n,{力量:Number(t?.力量??0),敏捷:Number(t?.敏捷??0),体质:Number(t?.体质??0),意志:Number(t?.意志??0),魅力:Number(t?.魅力??0),幸运:Number(t?.幸运??0)};var t}),E=(0,r.EW)(()=>{if(!u.value)return null;const e=(0,lh.Ew)(u.value);return{力量:e.STR,敏捷:e.AGI,体质:e.CON,意志:e.WIL,魅力:e.CHA,幸运:e.LCK}}),T=(0,r.EW)(()=>E.value??L.value),I=(0,r.EW)(()=>{const e=E.value,n=L.value;return e?{力量:Number(e.力量)-Number(n.力量),敏捷:Number(e.敏捷)-Number(n.敏捷),体质:Number(e.体质)-Number(n.体质),意志:Number(e.意志)-Number(n.意志),魅力:Number(e.魅力)-Number(n.魅力),幸运:Number(e.幸运)-Number(n.幸运)}:{力量:0,敏捷:0,体质:0,意志:0,魅力:0,幸运:0}}),R=e=>{const n="number"==typeof e?e:Number(e??0);return isNaN(n)||0===n?"0":n>0?`+${n}`:String(n)},M=(0,r.EW)(()=>{const e=b.value?.物品;return e?Object.keys(e).length:0}),D=e=>{const n=b.value?.突变结晶;return n?n[e]??0:0},N=(0,r.EW)(()=>D("下级")+100*D("中级")+1e4*D("上级")+1e6*D("顶级")),$=(0,r.EW)(()=>{const e=b.value?.物品;if(!e)return[];const n={传说:1,史诗:2,稀有:3,精良:4,普通:5,粗糙:6,破损:7};return Object.values(e).filter(e=>!!e&&"object"==typeof e).sort((e,t)=>{const a=n[e.品质?.quality??"普通"]??99,r=n[t.品质?.quality??"普通"]??99;if(a!==r)return a-r;const o=String(e.类型||""),i=String(t.类型||"");return o!==i?o.localeCompare(i,"zh-Hans-CN"):String(e.名称||"").localeCompare(String(t.名称||""),"zh-Hans-CN")}).slice(0,12)}),O=(0,r.EW)(()=>{const e=y.value||{};return Object.values(e)}),F=(0,r.EW)(()=>O.value.length),j=(0,r.EW)(()=>{if(0===O.value.length)return 0;const e=O.value.reduce((e,n)=>e+n.好感度,0);return Math.round(e/O.value.length)}),B=(0,r.EW)(()=>[...O.value].sort((e,n)=>n.好感度-e.好感度).slice(0,10)),X=e=>{const n=e?.扩展;return Boolean(n?.specialNpcId||n?.specialNpc)},U=(0,r.EW)(()=>(e=>{if(!e||"object"!=typeof e)return!1;const n=e,t=e=>"number"==typeof n[e]&&!Number.isNaN(n[e]),a=e=>"string"==typeof n[e]&&n[e].trim().length>0&&"待AI生成"!==n[e],r=n["三围"],o=(()=>{if(!r||"object"!=typeof r)return!1;const e=r;return"number"==typeof e.胸围&&"number"==typeof e.腰围&&"number"==typeof e.臀围})();return t("身高")||t("体重")||t("体脂率")||o||a("肤色")||a("发色")||a("瞳色")||a("胸部描述")||a("私处描述")||a("生殖器描述")||Array.isArray(n["敏感点"])&&n["敏感点"].length>0||Array.isArray(n["纹身与印记"])&&n["纹身与印记"].length>0})(m.value)?m.value:null),W=(0,r.EW)(()=>{const e=v.value?.寿命;if(!e)return;const n=A.value,t=e.上限;return"number"!=typeof n||"number"!=typeof t||t<=0?void 0:{current:n,max:t}}),q=async()=>{c.value=!0;try{const e=t.rootState.当前激活存档;if(e?.角色ID&&e?.存档槽位)return void await t.loadGame(e.角色ID,e.存档槽位);await t.reloadFromStorage()}finally{c.value=!1}},G=e=>{if(!e)return n("未知");if("string"==typeof e)return e;const t=e;return String(t.name??t.名称??n("未知"))},H=()=>{const e=w.value;if(!e)return null;if("string"==typeof e)return{name:e,description:n("此身来处，尘缘未了。")};const t=e;return{name:String(t.name??t.名称??n("未知")),description:String(t.description??t.描述??n("此身来处，尘缘未了。"))}},V=e=>{if("string"==typeof e&&e.trim())return e;if(e&&"object"==typeof e){const n=e.名称??e.name;if("string"==typeof n&&n.trim())return n}return n("凡人")},Q=(0,r.EW)(()=>{const e=p.value?.觉醒阶段;return"string"==typeof e&&e.trim()?e:n("凡人")}),K=e=>e&&Array.isArray(e)?e.map(e=>({name:e.名称||e.name||"",description:e.描述||e.description||""})):[],Y=e=>{if(!e?.品质)return"quality-common";const n="string"==typeof e.品质?e.品质:e.品质.quality;return`quality-${{传说:"legendary",史诗:"epic",稀有:"rare",精良:"fine",普通:"common",粗糙:"rough",破损:"broken"}[String(n||"普通").trim()]??"common"}`},J=()=>{k.value=!1};return(e,t)=>((0,r.uX)(),(0,r.CE)("div",MT,[(0,r.Q3)(" 加载状态 "),(0,r.bF)(s.eB,{name:"fade",mode:"out-in"},{default:(0,r.k6)(()=>{return[d.value?((0,r.uX)(),(0,r.CE)("div",PT,[t[2]||(t[2]=(0,r.Lk)("div",{class:"loading-spinner"},null,-1)),(0,r.Lk)("p",DT,(0,o.v_)((0,i.R1)(n)("感悟天地灵气中...")),1)])):p.value&&u.value?p.value?((0,r.uX)(),(0,r.CE)("div",OT,[(0,r.Q3)(" 顶部角色信息卡片 "),(0,r.Lk)("div",FT,[t[4]||(t[4]=(0,r.Lk)("div",{class:"header-bg-decoration"},null,-1)),(0,r.Lk)("div",jT,[(0,r.Q3)(" 左侧：头像身份 "),(0,r.Lk)("div",BT,[(0,r.Lk)("div",XT,[(0,r.Lk)("div",{class:"avatar-circle","data-realm":(e=Q.value,e?e.includes("凡人")||"凡人"===e?"mortal":"custom":"mortal")},[(0,r.Lk)("span",WT,(0,o.v_)(C.value),1)],8,UT),(0,r.Q3)(" 觉醒阶段光环特效 "),t[3]||(t[3]=(0,r.Lk)("div",{class:"realm-aura"},null,-1))]),(0,r.Lk)("div",qT,[(0,r.Lk)("h1",GT,(0,o.v_)(p.value.名字),1),(0,r.Lk)("div",HT,[p.value.性别?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,o.C4)(["tag-badge gender","男"===p.value.性别?"male":"female"])},(0,o.v_)("男"===p.value.性别?"♂":"♀")+" "+(0,o.v_)((0,i.R1)(n)(p.value.性别)),3)):(0,r.Q3)("v-if",!0),(0,r.Lk)("span",VT,(0,o.v_)((0,i.R1)(n)(p.value.种族||"人族")),1),(0,r.Lk)("span",QT,(0,o.v_)(A.value)+" "+(0,o.v_)((0,i.R1)(n)("岁")),1),(0,r.Lk)("button",{type:"button",class:"meta-chip link-chip",onClick:t[0]||(t[0]=e=>{return n=p.value.出生,w.value=n??null,void(k.value=!0);var n})},(0,o.v_)(G(p.value.出生)),1)])])]),(0,r.Q3)(" 中间：核心数值 "),(0,r.Lk)("div",KT,[(0,r.Lk)("div",YT,[(0,r.Lk)("div",JT,[(0,r.bF)((0,i.R1)(IT),{size:18})]),(0,r.Lk)("div",ZT,[(0,r.Lk)("span",eI,(0,o.v_)((0,i.R1)(n)("觉醒阶段")),1),(0,r.Lk)("span",nI,(0,o.v_)(Q.value),1)])]),f.value?.描述?((0,r.uX)(),(0,r.CE)("div",tI,[(0,r.Lk)("div",aI,[(0,r.bF)((0,i.R1)(RT),{size:18})]),(0,r.Lk)("div",rI,[(0,r.Lk)("span",oI,(0,o.v_)((0,i.R1)(n)("所在")),1),(0,r.Lk)("span",{class:"value wrap",title:f.value.描述},(0,o.v_)(f.value.描述),9,iI)])])):(0,r.Q3)("v-if",!0)])])]),(0,r.Q3)(" 标签页导航 "),(0,r.Lk)("div",sI,[(0,r.Lk)("div",lI,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.id,onClick:n=>x.value=e.id,class:(0,o.C4)(["nav-tab",{active:x.value===e.id}])},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:16})),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)(e.label)),1),x.value===e.id?((0,r.uX)(),(0,r.CE)("div",dI)):(0,r.Q3)("v-if",!0)],10,cI))),128))])]),(0,r.Q3)(" 内容区域 (带过渡动画) "),(0,r.bF)(s.eB,{name:"slide-fade",mode:"out-in"},{default:(0,r.k6)(()=>{return["character"===x.value?((0,r.uX)(),(0,r.CE)("div",uI,[(0,r.Lk)("div",pI,[(0,r.Q3)(" 基本信息 "),(0,r.Lk)("section",vI,[(0,r.Lk)("div",fI,[(0,r.bF)((0,i.R1)(Wp.A),{size:20,class:"header-icon red"}),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("📋 基本信息")),1)]),(0,r.Lk)("div",hI,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(S.value,e=>{return(0,r.uX)(),(0,r.CE)("div",{class:"vital-row",key:e.label},[(0,r.Lk)("div",mI,[(0,r.Lk)("span",gI,(0,o.v_)(e.label),1),(0,r.Lk)("span",bI,[(0,r.eW)((0,o.v_)(e.current)+" ",1),t[5]||(t[5]=(0,r.Lk)("span",{class:"divider"},"/",-1)),(0,r.eW)(" "+(0,o.v_)(e.max),1)])]),(0,r.Lk)("div",yI,[(0,r.Lk)("div",{class:(0,o.C4)(["vital-bar",e.color]),style:(0,o.Tr)({width:(n=e.current,a=e.max,(a&&0!==a?Math.min(100,Math.round(n/a*100)):0)+"%")})},null,6)])]);var n,a}),128)),(0,r.Q3)(" 声望独立行 "),(0,r.Lk)("div",xI,[(0,r.Lk)("span",kI,(0,o.v_)((0,i.R1)(n)("声望")),1),(0,r.Lk)("span",wI,(0,o.v_)(v.value?.声望||(0,i.R1)(n)("籍籍无名")),1)])])]),(0,r.Q3)(" 天赋灵根 "),(0,r.Lk)("section",_I,[(0,r.Lk)("div",CI,[(0,r.bF)((0,i.R1)(Ku),{size:20,class:"header-icon purple"}),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("天赋资质")),1)]),(0,r.Lk)("div",AI,[(0,r.Q3)(" 天赋列表 "),(0,r.Lk)("div",SI,[(0,r.Lk)("div",LI,[(0,r.Lk)("span",EI,(0,o.v_)((0,i.R1)(n)("天资")),1),(0,r.Lk)("span",TI,(0,o.v_)((e=p.value.天资,n(e?"string"==typeof e?e:"object"==typeof e&&"name"in e?e.name:"普通":"普通"))),1)]),K(p.value.天赋)?.length?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(K(p.value.天赋),e=>((0,r.uX)(),(0,r.CE)("div",{key:e.name,class:"talent-chip trait-chip",title:e.description},(0,o.v_)(e.name),9,II))),128)):((0,r.uX)(),(0,r.CE)("div",RI,(0,o.v_)((0,i.R1)(n)("无特殊天赋")),1))])])]),(0,r.Q3)(" 六维属性 "),(0,r.Lk)("section",MI,[(0,r.Lk)("div",PI,[(0,r.bF)((0,i.R1)(pp),{size:20,class:"header-icon blue"}),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("六维属性")),1)]),(0,r.Lk)("div",DI,[(0,r.Q3)(" 最终属性 "),(0,r.Lk)("div",zI,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(T.value,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"attr-box big"},[(0,r.Lk)("span",NI,(0,o.v_)((0,i.R1)(n)(String(t))),1),(0,r.Lk)("span",$I,(0,o.v_)(e),1)]))),128))]),(0,r.Q3)(" 详情分割线 "),(0,r.Lk)("div",OI,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("基础"))+" / "+(0,o.v_)((0,i.R1)(n)("增益")),1)]),(0,r.Lk)("div",FI,[(0,r.Lk)("div",jI,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.value,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"mini-attr"},[(0,r.Lk)("span",BI,(0,o.v_)((0,i.R1)(n)(String(t))),1),(0,r.Lk)("span",XI,(0,o.v_)(e),1)]))),128))]),(0,r.Lk)("div",UI,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(I.value,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"mini-attr green"},[(0,r.Lk)("span",WI,(0,o.v_)((0,i.R1)(n)(String(t))),1),(0,r.Lk)("span",qI,(0,o.v_)(R(e)),1)]))),128))])])])])])])):"social"===x.value?((0,r.uX)(),(0,r.CE)("div",GI,[(0,r.Lk)("div",HI,[(0,r.Lk)("section",VI,[(0,r.Lk)("div",QI,[(0,r.bF)((0,i.R1)(P),{size:20,class:"header-icon"}),t[6]||(t[6]=(0,r.eW)()),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("人际关系")),1)]),(0,r.Lk)("div",KI,[(0,r.Lk)("div",YI,[(0,r.Lk)("span",null,(0,o.v_)(F.value),1),(0,r.Lk)("label",null,(0,o.v_)((0,i.R1)(n)("结识之人")),1)]),(0,r.Lk)("div",JI,[(0,r.Lk)("span",null,(0,o.v_)(j.value),1),(0,r.Lk)("label",null,(0,o.v_)((0,i.R1)(n)("人心所向")),1)])])]),(0,r.Lk)("section",ZI,[(0,r.Lk)("div",eR,[(0,r.bF)((0,i.R1)(ET),{size:20,class:"header-icon"}),t[7]||(t[7]=(0,r.eW)()),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("结缘录")),1)]),(0,r.Lk)("div",nR,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(B.value,e=>{return(0,r.uX)(),(0,r.CE)("div",{key:e.名字,class:"relationship-row"},[(0,r.Lk)("div",tR,[(0,r.Lk)("div",aR,(0,o.v_)(e.名字),1),(0,r.Lk)("div",rR,[(0,r.Lk)("span",oR,(0,o.v_)(e.与玩家关系||(0,i.R1)(n)("陌生人")),1),X(e)?((0,r.uX)(),(0,r.CE)("span",iR,(0,o.v_)((0,i.R1)(n)("特殊")),1)):(0,r.Q3)("v-if",!0),t[8]||(t[8]=(0,r.Lk)("span",{class:"rel-dot"},"·",-1)),(0,r.Lk)("span",sR,(0,o.v_)(V(e.觉醒阶段)),1)])]),(0,r.Lk)("div",{class:(0,o.C4)(["rel-fav",(a=e.好感度,a>=60?"fav-high":a>=20?"fav-mid":a<=-20?"fav-low":"fav-neutral")])},(0,o.v_)(e.好感度),3)]);var a}),128)),0===B.value.length?((0,r.uX)(),(0,r.CE)("div",lR,[(0,r.bF)((0,i.R1)(P),{size:36,opacity:"0.5"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(n)("尚未结识他人")),1)])):(0,r.Q3)("v-if",!0)])]),h.value?((0,r.uX)(),(0,r.CE)("section",cR,[(0,r.Lk)("div",dR,[(0,r.bF)((0,i.R1)(IT),{size:20,class:"header-icon"}),t[9]||(t[9]=(0,r.eW)()),(0,r.Lk)("h3",null,(0,o.v_)(h.value.势力名称),1)]),(0,r.Lk)("div",uR,[(0,r.Lk)("div",pR,[(0,r.Lk)("span",vR,(0,o.v_)((0,i.R1)(n)("职位")),1),(0,r.Lk)("span",fR,(0,o.v_)(h.value.职位),1)]),(0,r.Lk)("div",hR,[(0,r.Lk)("span",mR,(0,o.v_)((0,i.R1)(n)("关系")),1),(0,r.Lk)("span",gR,(0,o.v_)(h.value.关系),1)]),(0,r.Lk)("div",bR,[(0,r.Lk)("span",yR,(0,o.v_)((0,i.R1)(n)("贡献")),1),(0,r.Lk)("span",xR,(0,o.v_)(h.value.贡献),1)]),(0,r.Lk)("div",kR,[(0,r.Lk)("span",wR,(0,o.v_)((0,i.R1)(n)("声望")),1),(0,r.Lk)("span",_R,(0,o.v_)(h.value.声望),1)])])])):(0,r.Q3)("v-if",!0)])])):"inventory"===x.value?((0,r.uX)(),(0,r.CE)("div",CR,[(0,r.Lk)("div",AR,[(0,r.Lk)("section",SR,[(0,r.Lk)("div",LR,[(0,r.bF)((0,i.R1)(TT),{size:20,class:"header-icon"}),t[10]||(t[10]=(0,r.eW)()),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("储物袋")),1)]),(0,r.Lk)("div",ER,[(0,r.Lk)("div",TR,[(0,r.Lk)("span",IR,(0,o.v_)(M.value),1),(0,r.Lk)("span",RR,(0,o.v_)((0,i.R1)(n)("物品")),1)]),(0,r.Lk)("div",MR,[(0,r.Lk)("span",PR,(0,o.v_)(N.value),1),(0,r.Lk)("span",DR,(0,o.v_)((0,i.R1)(n)("结晶折算")),1)])]),(0,r.Lk)("div",zR,[(0,r.Lk)("div",NR,[(0,r.Lk)("span",$R,(0,o.v_)((0,i.R1)(n)("下级结晶")),1),(0,r.Lk)("span",OR,(0,o.v_)(D("下级")),1)]),(0,r.Lk)("div",FR,[(0,r.Lk)("span",jR,(0,o.v_)((0,i.R1)(n)("中级结晶")),1),(0,r.Lk)("span",BR,(0,o.v_)(D("中级")),1)]),(0,r.Lk)("div",XR,[(0,r.Lk)("span",UR,(0,o.v_)((0,i.R1)(n)("上级结晶")),1),(0,r.Lk)("span",WR,(0,o.v_)(D("上级")),1)]),(0,r.Lk)("div",qR,[(0,r.Lk)("span",GR,(0,o.v_)((0,i.R1)(n)("顶级结晶")),1),(0,r.Lk)("span",HR,(0,o.v_)(D("顶级")),1)])])]),(0,r.Lk)("section",VR,[(0,r.Lk)("div",QR,[(0,r.bF)((0,i.R1)(z),{size:20,class:"header-icon gold"}),t[11]||(t[11]=(0,r.eW)()),(0,r.Lk)("h3",null,(0,o.v_)((0,i.R1)(n)("物品一览")),1)]),(0,r.Lk)("div",KR,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)($.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.物品ID,class:(0,o.C4)(["inv-row",Y(e)])},[(0,r.Lk)("div",YR,[(0,r.Lk)("div",JR,(0,o.v_)(e.名称),1),(0,r.Lk)("div",ZR,(0,o.v_)((0,i.R1)(n)(e.类型)),1)]),(0,r.Lk)("div",eM,"×"+(0,o.v_)(e.数量),1)],2))),128)),0===$.value.length?((0,r.uX)(),(0,r.CE)("div",nM,[(0,r.bF)((0,i.R1)(TT),{size:36,opacity:"0.5"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(n)("储物袋空空如也")),1)])):(0,r.Q3)("v-if",!0)])])])])):"body"===x.value&&U.value?((0,r.uX)(),(0,r.CE)("div",tM,[(0,r.Lk)("div",aM,[(0,r.bF)(LT,{"body-stats":U.value||void 0,lifespan:W.value},null,8,["body-stats","lifespan"])])])):(0,r.Q3)("v-if",!0)];var e}),_:1})])):(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",zT,[(0,r.Lk)("div",NT,[(0,r.bF)((0,i.R1)($c),{size:48})]),(0,r.Lk)("p",$T,(0,o.v_)((0,i.R1)(n)("无法探知角色数据")),1),(0,r.Lk)("button",{class:"retry-btn",onClick:q},[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("重新探查")),1)])]))];var e}),_:1}),(0,r.Q3)(" 弹窗组件复用 (样式优化) "),(0,r.bF)(s.eB,{name:"modal-fade"},{default:(0,r.k6)(()=>[k.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:J},[(0,r.Q3)(" 具体的弹窗内容，保持逻辑不变，只应用新样式类 "),(0,r.Lk)("div",{class:"modal-card glass-panel",onClick:t[1]||(t[1]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Q3)(" ... 内容插槽, 这里使用简化的示例，实际项目中保留原v-if逻辑 ... "),(0,r.Lk)("button",{class:"close-float",onClick:J},[(0,r.bF)((0,i.R1)(ed.A))]),(0,r.Q3)(" 出身详情 "),k.value?((0,r.uX)(),(0,r.CE)("div",rM,[(0,r.Lk)("h2",oM,(0,o.v_)(H()?.name),1),(0,r.Lk)("p",iM,(0,o.v_)((0,i.R1)(n)("出身")),1),(0,r.Lk)("div",sM,(0,o.v_)(H()?.description),1)])):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0)]),_:1})]))}});var cM=t(9443),dM={};dM.styleTagTransform=A(),dM.setAttributes=k(),dM.insert=y().bind(null,"head"),dM.domAPI=g(),dM.insertStyleElement=_(),h()(cM.A,dM),cM.A&&cM.A.locals&&cM.A.locals;const uM=(0,E.A)(lM,[["__scopeId","data-v-3e18d0f2"]]),pM=(0,I.A)("sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),vM=(0,I.A)("gem",[["path",{d:"M10.5 3 8 9l4 13 4-13-2.5-6",key:"b3dvk1"}],["path",{d:"M17 3a2 2 0 0 1 1.6.8l3 4a2 2 0 0 1 .013 2.382l-7.99 10.986a2 2 0 0 1-3.247 0l-7.99-10.986A2 2 0 0 1 2.4 7.8l2.998-3.997A2 2 0 0 1 7 3z",key:"7w4byz"}],["path",{d:"M2 9h20",key:"16fsjt"}]]),fM=(0,I.A)("hand-coins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]]),hM=(0,I.A)("badge-dollar-sign",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]),mM=(0,I.A)("square-dashed",[["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M9 3h1",key:"1yesri"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M21 14v1",key:"169vum"}]]),gM={class:"modal-header"},bM={class:"modal-body"},yM={class:"item-info"},xM={class:"item-icon"},kM={class:"item-details"},wM={class:"item-name"},_M={class:"item-type"},CM={class:"available-quantity"},AM={key:0,class:"item-description"},SM={class:"quantity-selector"},LM={for:"quantity"},EM={class:"quantity-controls"},TM=["disabled"],IM=["max"],RM=["disabled"],MM={class:"quantity-shortcuts"},PM=["onClick","disabled"],DM={class:"modal-footer"},zM=["disabled"],NM=(0,r.pM)({__name:"QuantitySelectModal",props:{visible:{type:Boolean},item:{},title:{},actionLabel:{},actionType:{},confirmText:{},description:{}},emits:["close","confirm"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)(1),c=(0,r.EW)(()=>{const e=t.item?.数量||1;return[{label:"1个",value:1},{label:"5个",value:5},{label:"10个",value:10},{label:"全部",value:e}].filter(n=>n.value<=e)});function d(){l.value<(t.item?.数量||1)&&l.value++}function u(){l.value>1&&l.value--}function p(){l.value>0&&l.value<=(t.item?.数量||1)&&a("confirm",l.value)}function v(){a("close")}return(0,r.wB)(()=>t.item,e=>{e&&(l.value=1)}),(e,n)=>{return e.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"quantity-modal-overlay",onClick:v},[(0,r.Lk)("div",{class:"quantity-modal",onClick:n[3]||(n[3]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",gM,[(0,r.Lk)("h3",null,(0,o.v_)(e.title||"选择数量"),1),(0,r.Lk)("button",{class:"close-btn",onClick:n[0]||(n[0]=n=>e.$emit("close"))},[n[4]||(n[4]=(0,r.Lk)("span",null,"关闭",-1)),(0,r.bF)((0,i.R1)(ed.A),{size:16})])]),(0,r.Lk)("div",bM,[(0,r.Lk)("div",yM,[(0,r.Lk)("div",xM,(0,o.v_)((a=e.item?.类型,{装备:"⚔️",功法:"📜",药剂:"💊",材料:"💎",其他:"📦"}[a||"其他"]||"📦")),1),(0,r.Lk)("div",kM,[(0,r.Lk)("div",wM,(0,o.v_)(e.item?.名称),1),(0,r.Lk)("div",_M,(0,o.v_)(e.item?.类型),1),(0,r.Lk)("div",CM,"可用数量："+(0,o.v_)(e.item?.数量||0),1),e.description?((0,r.uX)(),(0,r.CE)("div",AM,(0,o.v_)(e.description),1)):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",SM,[(0,r.Lk)("label",LM,(0,o.v_)(e.actionLabel||"选择数量")+"：",1),(0,r.Lk)("div",EM,[(0,r.Lk)("button",{class:"quantity-btn",onClick:u,disabled:l.value<=1}," - ",8,TM),(0,r.bo)((0,r.Lk)("input",{id:"quantity","onUpdate:modelValue":n[1]||(n[1]=e=>l.value=e),type:"number",min:1,max:e.item?.数量||1,class:"quantity-input"},null,8,IM),[[s.Jo,l.value,void 0,{number:!0}]]),(0,r.Lk)("button",{class:"quantity-btn",onClick:d,disabled:l.value>=(e.item?.数量||1)}," + ",8,RM)])]),(0,r.Lk)("div",MM,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.value,n=>((0,r.uX)(),(0,r.CE)("button",{key:n.value,class:"preset-btn",onClick:e=>{return a=n.value,void(l.value=Math.min(a,t.item?.数量||1));var a},disabled:n.value>(e.item?.数量||1)},(0,o.v_)(n.label),9,PM))),128))])]),(0,r.Lk)("div",DM,[(0,r.Lk)("button",{class:"cancel-btn",onClick:n[2]||(n[2]=n=>e.$emit("close"))},"取消"),(0,r.Lk)("button",{class:(0,o.C4)(["confirm-btn","discard"===e.actionType?"discard-confirm":""]),onClick:p,disabled:l.value<=0},(0,o.v_)(e.confirmText||"确定"),11,zM)])])])):(0,r.Q3)("v-if",!0);var a}}});var $M=t(7630),OM={};OM.styleTagTransform=A(),OM.setAttributes=k(),OM.insert=y().bind(null,"head"),OM.domAPI=g(),OM.insertStyleElement=_(),h()($M.A,OM),$M.A&&$M.A.locals&&$M.A.locals;const FM=(0,E.A)(NM,[["__scopeId","data-v-5d734c3e"]]);var jM=t(1267);const BM={class:"inventory-content"},XM={class:"tabs-header"},UM={class:"tabs-nav"},WM=["onClick"],qM={key:0,class:"tools-section"},GM={class:"search-box"},HM=["placeholder"],VM={class:"filter-buttons"},QM={value:"all"},KM=["value"],YM={value:"default"},JM={value:"quality"},ZM={value:"name"},eP=["disabled","title"],nP={class:"tab-content"},tP={key:0,class:"items-tab"},aP={class:"confirm-header"},rP={class:"confirm-content"},oP={class:"confirm-actions"},iP={class:"modal-header"},sP={class:"modal-content"},lP={class:"item-type-text"},cP={class:"modal-info"},dP={class:"modal-meta"},uP={class:"modal-description"},pP={key:0,class:"modal-attributes"},vP={class:"attribute-text"},fP={key:1,class:"modal-attributes"},hP={class:"attribute-text"},mP={class:"modal-actions"},gP=["disabled"],bP={class:"items-grid"},yP={key:0,class:"grid-placeholder"},xP={key:1,class:"grid-placeholder"},kP={key:0},wP={key:1},_P={key:2},CP={key:3},AP={key:4},SP={key:5,class:"filter-tip"},LP=["onClick"],EP={class:"item-top-section"},TP={class:"item-type-icon"},IP={key:0,class:"item-quantity-display"},RP={class:"item-name-section"},MP=["title"],PP={class:"item-bottom-section"},DP={class:"item-type-label"},zP={key:2,class:"item-details-sidebar"},NP={key:0,class:"details-content"},$P={class:"details-header"},OP={class:"item-type-text-large"},FP={class:"details-title-area"},jP={class:"details-meta"},BP={class:"details-body"},XP={class:"details-description"},UP={key:0,class:"details-attributes"},WP={class:"attribute-text"},qP={key:1,class:"details-attributes"},GP={class:"attribute-text"},HP={class:"details-actions"},VP=["disabled"],QP={key:1,class:"details-placeholder"},KP={key:1,class:"equipment-tab"},YP={class:"equipment-showcase"},JP={class:"equipment-overview"},ZP={class:"overview-header"},eD={class:"overview-title"},nD={class:"overview-stats"},tD={class:"stat-item"},aD={class:"stat-value"},rD={class:"equipment-slots-grid"},oD={class:"slot-title-bar"},iD={class:"slot-position"},sD={class:"position-icon"},lD={class:"position-name"},cD=["disabled","onClick","title"],dD={key:0,class:"equipped-content"},uD={class:"equipped-icon-area"},pD={class:"icon-inner"},vD={class:"equipped-info"},fD={class:"equipped-grade"},hD={key:0,class:"equipped-desc"},mD={class:"equipped-effects"},gD={key:0,class:"effect-section"},bD={class:"effect-content"},yD={key:1,class:"effect-section special"},xD={class:"effect-content"},kD={class:"empty-slot-content"},wD={class:"empty-slot-icon"},_D={key:2,class:"currency-tab"},CD={class:"currency-summary"},AD={class:"summary-value"},SD={class:"summary-unit"},LD={key:0,class:"summary-hint"},ED={class:"currency-grid"},TD={class:"currency-card-top"},ID={class:"currency-info"},RD={class:"currency-amount"},MD={class:"currency-label"},PD={class:"currency-sub"},DD=["title","onClick"],zD={key:0,class:"currency-exchange"},ND=["onClick","disabled","title"],$D=["onClick","disabled","title"],OD=(0,r.pM)({__name:"InventoryPanel",setup(e){const{t:n}=(0,l.s)(),a=(0,Ec.useCharacterStore)(),c=(0,Hu.useGameStateStore)(),d=vw(),u=mw.getInstance(),p=(0,i.KR)(!1),v=(0,i.KR)(!1),f=(0,i.KR)(null),h=(0,i.KR)(""),m=(0,i.KR)("all"),g=(0,i.KR)("default"),b=(0,i.KR)("items"),y=(0,i.KR)(!1),x=(0,i.KR)(""),k=(0,i.KR)(""),w=(0,i.KR)(!1),_=(0,i.KR)(null),C=(0,i.KR)(""),A=(0,i.KR)(""),S=(0,i.KR)("use"),L=(0,i.KR)(""),E=(0,i.KR)(""),T=(0,i.KR)(null),I=(0,i.KR)(!1),R=(0,i.KR)(null),M=(0,i.KR)(!1),P=((0,i.KR)(!1),(0,r.EW)(()=>window.innerWidth<=768)),D=(0,r.EW)(()=>[{id:"items",label:"背包物品",icon:Hc},{id:"equipment",label:"法宝装备",icon:pM},{id:"currency",label:"财产管理",icon:vM}]),z=(0,r.EW)(()=>{const e=c.equipment,t=["装备1","装备2","装备3","装备4","装备5","装备6"];return e?t.map(t=>{const a=e[t];let r=null;const o="string"==typeof a?a:"object"==typeof a&&null!==a&&"物品ID"in a?String(a.物品ID||""):"";if(o){const e=(c.inventory?.物品||{})[o];r=e&&"object"==typeof e?e:{物品ID:o,名称:"object"==typeof a&&null!==a&&"名称"in a?String(a.名称||o):o,类型:"装备",品质:{quality:"破损",grade:1},描述:"装备数据缺失",数量:1,已装备:!0}}else r=null;return{name:n(t),slotKey:t,item:r}}):t.map(e=>({name:n(e),slotKey:e,item:null}))}),N=(0,r.EW)(()=>{const e=c.inventory?.物品||{};return Object.entries(e).filter(([e,n])=>!e.startsWith("_")&&n&&"object"==typeof n).map(([,e])=>{const n=e;return{...n,物品ID:String(n.物品ID||""),名称:String(n.名称||""),类型:String(n.类型||"其他"),品质:n.品质||{quality:"普通",grade:1},描述:String(n.描述||""),数量:Number(n.数量||1)}}).filter(e=>e.名称&&e.类型)}),$=(0,r.EW)(()=>["装备","物品","突变结晶","药剂","材料","其他","all"]),O={破损:1,粗糙:2,普通:3,精良:4,稀有:5,史诗:6,传说:7},F=(0,r.EW)(()=>{let e=[...N.value];const n=["装备","物品","突变结晶","药剂","材料","其他"];if(e=e.map(e=>{const t=n.includes(e.类型)?e.类型:"物品";let a=e.品质;return a&&"object"==typeof a?(a.quality&&"string"==typeof a.quality||(a.quality="破损"),void 0===a.grade||null===a.grade?a.grade=1:"string"==typeof a.grade||("number"!=typeof a.grade||a.grade<0||a.grade>10)&&(a.grade=1)):a={quality:"破损",grade:1},{...e,类型:t,品质:a}}),h.value&&(e=e.filter(e=>e.名称.includes(h.value))),"all"!==m.value&&(e=e.filter(e=>e.类型===m.value)),"quality"===g.value){const n=e=>O[String(e??"普通")]||0;e.sort((e,t)=>n(t.品质?.quality)-n(e.品质?.quality))}else"name"===g.value&&e.sort((e,n)=>e.名称.localeCompare(n.名称));return e}),j=e=>{if(!e||"object"!=typeof e)return"无特殊属性";const n=[];for(const[t,a]of Object.entries(e))if(null!=a)if("object"!=typeof a||Array.isArray(a))n.push(`${t}+${a}`);else{const e=Object.entries(a).filter(([,e])=>"number"==typeof e||"string"==typeof e).map(([e,n])=>`${e}+${n}`).join("、");e&&n.push(`${t}(${e})`)}return n.length?n.join("、"):"无特殊属性"},B=(0,r.EW)(()=>z.value.filter(e=>e.item).length),X=["破损","粗糙","普通","精良","稀有","史诗","传说","凡","黄","玄","地","天","仙","神"],U=e=>"string"==typeof e?e:0===e?"破损":e>=1&&e<=3?"粗糙":e>=4&&e<=6?"普通":e>=7&&e<=9?"精良":10===e?"完美":"未知",W=e=>"string"==typeof e?"grade-custom":0===e?"grade-broken":e>=1&&e<=3?"grade-rough":e>=4&&e<=6?"grade-common":e>=7&&e<=9?"grade-rare":10===e?"grade-legend":"grade-unknown",q=async e=>{if(e){if(TA.Yz.log(n("背包面板"),n("使用物品"),e.名称),e.数量>1){_.value=e,C.value=n("使用物品"),A.value=n("使用数量"),S.value="use",L.value=n("确定使用");const t=["药剂","材料","其他","物品","突变结晶"];return E.value=(t.includes(e.类型)&&"使用效果"in e?e.使用效果:"")||n("暂无特殊效果"),T.value=n=>G(e,n),void(w.value=!0)}await G(e,1)}},G=async(e,t)=>{try{if(!["药剂","材料","其他","物品","突变结晶"].includes(e.类型))return void _e.o.error(n("该物品无法直接使用"));await u.useItem(e,t),P.value&&(I.value=!1),f.value=null,TA.Yz.log(n("背包面板"),n("使用物品成功"),e.名称)}catch(e){TA.Yz.error(n("背包面板"),n("使用物品失败"),e),_e.o.error(n("使用物品失败"))}},H=async e=>{T.value&&await T.value(e),V()},V=()=>{w.value=!1,_.value=null,C.value="",A.value="",S.value="use",L.value="",E.value="",T.value=null},Q=async e=>{if(!e)return;if(e.数量>1){const t=e.品质?.quality||"破损",a="破损"===t?"":`【${n(t)}】`;return _.value=e,C.value=n("丢弃物品"),A.value=n("丢弃数量"),S.value="discard",L.value=n("确定丢弃"),E.value=`${a}${e.名称} - ${n("此操作不可撤销！")}`,T.value=n=>K(e,n),void(w.value=!0)}const t=e.品质?.quality||"破损",a="破损"===t?"":`【${n(t)}】`;x.value=n("丢弃物品"),k.value=n("确定要丢弃 {0}{1} 吗？\n\n此操作不可撤销！").replace("{0}",a).replace("{1}",e.名称),R.value=async()=>{await K(e,1)},y.value=!0},K=async(e,t)=>{TA.Yz.log(n("背包面板"),n("丢弃物品"),{物品名称:e.名称,数量:t});try{if(t>=e.数量)await(async e=>{const t=c.inventory?.物品;if(!t||"object"!=typeof t)throw new Error(n("背包数据不存在或格式不正确"));delete t[e.物品ID],await a.saveCurrentGame(),TA.Yz.log(n("背包面板"),n("物品移除成功"),e.名称),f.value?.物品ID===e.物品ID&&(f.value=null),P.value&&(I.value=!1)})(e),_e.o.success(n("已丢弃《{0}》").replace("{0}",e.名称));else{const r={...e,数量:e.数量-t};await(async e=>{const t=c.inventory?.物品;if(!t||"object"!=typeof t)throw new Error(n("背包数据不存在或格式不正确"));if(!t[e.物品ID])throw new Error(n("尝试更新一个不存在于背包的物品: {0}").replace("{0}",e.名称));t[e.物品ID]=e,await a.saveCurrentGame(),TA.Yz.log(n("背包面板"),n("物品更新成功"),e.名称),f.value?.物品ID===e.物品ID&&(f.value=e)})(r),_e.o.success(n("已丢弃 {0} 个《{1}》").replace("{0}",t.toString()).replace("{1}",e.名称))}P.value&&(I.value=!1),f.value=null}catch(e){TA.Yz.error(n("背包面板"),n("丢弃失败"),e),_e.o.error(n("丢弃物品失败"))}},Y=async e=>{if(e&&!M.value)if("装备"===e.类型){M.value=!0;try{J(e)?await u.unequipItem(e):await u.equipItem(e)}catch(e){console.error("装备切换失败:",e),_e.o.error(n("装备操作失败，请稍后重试"))}finally{M.value=!1}}else _e.o.error(n("只有装备才能穿戴"))},J=e=>{if(!e||!e.物品ID)return!1;const n=c.inventory?.物品;if(!n)return!1;const t=n[e.物品ID];return!!t&&!0===t.已装备},Z=(e,n="border")=>{if(!e)return"";const{value:t,isCustom:a}=(e=>{const n=String(e||"").trim();if(!n)return{value:"未知",isCustom:!1};const t=n.endsWith("阶")?n.slice(0,-1):n;return t.includes("传说")?{value:"传说",isCustom:!1}:t.includes("史诗")?{value:"史诗",isCustom:!1}:t.includes("稀有")?{value:"稀有",isCustom:!1}:t.includes("精良")?{value:"精良",isCustom:!1}:t.includes("普通")?{value:"普通",isCustom:!1}:t.includes("粗糙")?{value:"粗糙",isCustom:!1}:t.includes("破损")?{value:"破损",isCustom:!1}:X.includes(t)?{value:t,isCustom:!1}:{value:t,isCustom:!0}})(e.品质?.quality);return"未知"===t?"":a?"glow"===n?"q-custom-glow":`${n}-quality-custom`:"glow"===n?`q-${t}-glow`:`${n}-quality-${t}`},ee=()=>{R.value&&R.value(),y.value=!1},ne=()=>{I.value=!1},te=(e,n,t)=>Math.max(n,Math.min(t,e)),ae=e=>{const n="number"==typeof e&&Number.isFinite(e)?e:0;return Math.abs(n)>=1e12?n.toExponential(2):Math.abs(n)>=1e6?n.toLocaleString(void 0,{maximumFractionDigits:0}):n.toLocaleString(void 0,{maximumFractionDigits:4})},re=(0,i.KR)(null);(0,r.wB)(()=>c.inventory,e=>{if(e&&"object"==typeof e&&re.value!==e){try{(0,jM.Fp)(e)}catch(e){console.warn("[背包面板] 货币系统规范化失败（将继续使用原数据）",e)}re.value=e}},{immediate:!0});const oe=()=>{const e=c.inventory;return e?(e.货币&&"object"==typeof e.货币&&!Array.isArray(e.货币)||(e.货币={}),e.货币设置&&"object"==typeof e.货币设置&&!Array.isArray(e.货币设置)||(e.货币设置={禁用币种:[],基准币种:jM.ms}),Array.isArray(e.货币设置.禁用币种)||(e.货币设置.禁用币种=[]),"string"==typeof e.货币设置.基准币种&&e.货币设置.基准币种.trim()||(e.货币设置.基准币种=jM.ms),e):null},ie={Gem:vM,Coins:rp,HandCoins:fM,BadgeDollarSign:hM},se=(0,r.EW)(()=>c.location?.描述||"全局"),le=e=>{const n=c.worldInfo,t=se.value,a=n?.经济?.地区波动?.[t]?.货币波动?.[e]??n?.经济?.货币波动?.[e]??1,r="number"==typeof a&&Number.isFinite(a)?a:1;return te(r,.6,1.6)},ce=(e,n)=>{const t=c.worldInfo;if(!t)return;t.经济&&"object"==typeof t.经济&&!Array.isArray(t.经济)||(t.经济={}),t.经济.地区波动&&"object"==typeof t.经济.地区波动&&!Array.isArray(t.经济.地区波动)||(t.经济.地区波动={});const a=se.value;t.经济.地区波动[a]&&"object"==typeof t.经济.地区波动[a]||(t.经济.地区波动[a]={货币波动:{}}),t.经济.地区波动[a].货币波动&&"object"==typeof t.经济.地区波动[a].货币波动||(t.经济.地区波动[a].货币波动={}),t.经济.地区波动[a].货币波动[e]=te(n,.6,1.6)},de=(0,r.EW)(()=>{const e=c.inventory,n=e?.货币&&"object"==typeof e.货币?e.货币:{},t=e?.货币设置?.基准币种,a="string"==typeof t&&t.trim()?t.trim():jM.ms;return n&&a in n?a:n&&jM.ms in n?jM.ms:(n?Object.keys(n)[0]:"")||jM.ms}),ue=(0,r.EW)(()=>{const e=c.inventory,n=e?.货币,t=de.value,a=n?.[t]?.名称;return"string"==typeof a&&a.trim()?a.trim():t}),pe=(0,r.EW)(()=>{const e=c.inventory,n=e?.货币&&"object"==typeof e.货币?e.货币:{},t=de.value,a=("number"==typeof n?.[t]?.价值&&Number.isFinite(n[t].价值)?n[t].价值:1)*le(t)||1;let r=0;for(const e of Object.values(n)){if(!e||"object"!=typeof e)continue;const n="number"==typeof e.数量&&Number.isFinite(e.数量)?e.数量:0,t="number"==typeof e.价值&&Number.isFinite(e.价值)?e.价值:0,o="string"==typeof e.币种&&e.币种.trim()?e.币种.trim():"";r+=n*t*(o?le(o):1)/a}return r}),ve=(0,r.EW)(()=>{const e=se.value;if(!e)return"";const n=le("突变结晶_下级");return 1===n?`当前地区：${e}（汇率平稳）`:`当前地区：${e}（汇率波动系数：${n.toFixed(3)}）`}),fe=(0,r.EW)(()=>{const e=c.inventory,n=e?.货币&&"object"==typeof e.货币?e.货币:{},t=["突变结晶_下级","突变结晶_中级","突变结晶_上级","突变结晶_顶级"],a=new Set(Object.keys(n)),r=Array.from(a).filter(e=>!t.includes(e)).sort((e,n)=>e.localeCompare(n,"zh-Hans-CN")),o=[...t,...r].filter(e=>n[e]),i=de.value,s=("number"==typeof n?.[i]?.价值&&Number.isFinite(n[i].价值)?n[i].价值:1)*le(i)||1;return o.map(e=>{const t=n[e]||{},a="string"==typeof t.名称&&t.名称.trim()?t.名称.trim():e,r="number"==typeof t.数量&&Number.isFinite(t.数量)?t.数量:0,o="number"==typeof t.价值&&Number.isFinite(t.价值)?t.价值:jM.Ef[e]?.价值??0,i="string"==typeof t.图标&&t.图标.trim()?t.图标.trim():jM.Ef[e]?.图标,l=i&&ie[i]||rp,c=((e,n,t)=>n*t*le(e)/s)(e,r,o),d=`≈ ${ae(c)} ${ue.value}`,u=e.startsWith("突变结晶_")?"突变结晶_顶级"===e?"grade-legend":"突变结晶_上级"===e?"grade-epic":"突变结晶_中级"===e?"grade-rare":"grade-common":"grade-money",p=(e=>{const t={突变结晶_下级:{up:"突变结晶_中级"},突变结晶_中级:{up:"突变结晶_上级",down:"突变结晶_下级"},突变结晶_上级:{up:"突变结晶_顶级",down:"突变结晶_中级"},突变结晶_顶级:{down:"突变结晶_上级"}}[e];if(!t)return{};const a=le(e),r=n[e]||jM.Ef[e],o=r?.价值||1,i={};if(t.up){const r=le(t.up),s=n[t.up]||jM.Ef[t.up],l=(s?.价值||1)/o,c=r/a,d=Math.max(1,Math.ceil(l*c*1.02));i.exchangeUp={cost:d,title:`兑换：${d} ${n[e]?.名称??e} → 1 ${n[t.up]?.名称??t.up}（基准比例 1:${l}，波动系数比值：${c.toFixed(3)}）`}}if(t.down){const r=le(t.down),s=n[t.down]||jM.Ef[t.down],l=o/(s?.价值||1),c=r/a,d=Math.max(1,Math.floor(l/c*.98));i.exchangeDown={yield:d,title:`分解：1 ${n[e]?.名称??e} → ${d} ${n[t.down]?.名称??t.down}（基准比例 1:${l}，波动系数比值：${c.toFixed(3)}）`}}return i})(e);return{id:e,label:a,subLabel:d,amount:r,valueDegree:o,colorClass:u,icon:l,canDelete:!0,...p}})}),he=async(e,n)=>{const t=oe();if(!t)return;const r=t.货币;if(!r||"object"!=typeof r)return;const o={突变结晶_下级:{up:"突变结晶_中级"},突变结晶_中级:{up:"突变结晶_上级",down:"突变结晶_下级"},突变结晶_上级:{up:"突变结晶_顶级",down:"突变结晶_中级"},突变结晶_顶级:{down:"突变结晶_上级"}}[e];if(!o)return;const i=le(e),s=r[e]||jM.Ef[e],l=s?.价值||1,c=e=>{if(!r[e]||"object"!=typeof r[e]){const n=jM.Ef[e];r[e]=n?{...n,数量:0}:{币种:e,名称:e,数量:0,价值:0,图标:"Coins"}}"number"==typeof r[e].数量&&Number.isFinite(r[e].数量)||(r[e].数量=0)};c(e);const d=r[e].数量;if("up"===n&&o.up){c(o.up);const n=le(o.up),t=r[o.up]||jM.Ef[o.up],a=(t?.价值||1)/l,s=n/i,u=Math.max(1,Math.ceil(a*s*1.02));if(d<u)return;r[e].数量=d-u,r[o.up].数量=r[o.up].数量+1,ce(o.up,n*(1+te(u/5e4,0,.01))),ce(e,i*(1-te(u/8e4,0,.006)))}if("down"===n&&o.down){if(d<1)return;c(o.down);const n=le(o.down),t=r[o.down]||jM.Ef[o.down],a=l/(t?.价值||1),s=n/i,u=Math.max(1,Math.floor(a/s*.98));r[e].数量=d-1,r[o.down].数量=r[o.down].数量+u,ce(o.down,n*(1+te(u/8e4,0,.01))),ce(e,i*(1-te(u/12e4,0,.006)))}(0,jM.A6)(t),await a.saveCurrentGame()},me=async()=>{if(!v.value){v.value=!0;try{TA.Yz.log(n("背包面板"),n("手动刷新环境数据")),await a.reloadFromStorage()}catch(e){TA.Yz.error(n("背包面板"),n("刷新数据失败"),e)}finally{v.value=!1}}};return(e,l)=>((0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Q3)(" 移除容器，让内容直接填充GameView提供的panel-content区域 "),(0,r.Lk)("div",BM,[(0,r.Q3)(" 标签页导航 "),(0,r.Lk)("div",XM,[(0,r.Lk)("div",UM,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(D.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.id,class:(0,o.C4)(["tab-btn",{active:b.value===e.id}]),onClick:n=>b.value=e.id},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:16})),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)(e.label)),1)],10,WM))),128))]),(0,r.Q3)(" 搜索和筛选区域 "),"items"===b.value?((0,r.uX)(),(0,r.CE)("div",qM,[(0,r.Lk)("div",GM,[(0,r.bF)((0,i.R1)(qc),{size:16,class:"search-icon"}),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=e=>h.value=e),placeholder:P.value?(0,i.R1)(n)("搜索..."):(0,i.R1)(n)("搜索物品...")},null,8,HM),[[s.Jo,h.value]])]),(0,r.Lk)("div",VM,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>m.value=e),class:"filter-select"},[(0,r.Lk)("option",QM,(0,o.v_)((0,i.R1)(n)("全部物品")),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)($.value,e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e},(0,o.v_)((0,i.R1)(n)(e)),9,KM))),128))],512),[[s.u1,m.value]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>g.value=e),class:"filter-select"},[(0,r.Lk)("option",YM,(0,o.v_)((0,i.R1)(n)("默认排序")),1),(0,r.Lk)("option",JM,(0,o.v_)((0,i.R1)(n)("品质排序")),1),(0,r.Lk)("option",ZM,(0,o.v_)((0,i.R1)(n)("名称排序")),1)],512),[[s.u1,g.value]]),(0,r.Lk)("button",{class:"refresh-btn",onClick:me,disabled:v.value,title:(0,i.R1)(n)("从环境同步最新数据")},[(0,r.bF)((0,i.R1)(uw.A),{size:16,class:(0,o.C4)({spinning:v.value})},null,8,["class"])],8,eP)])])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 标签内容 "),(0,r.Lk)("div",nP,[(0,r.Q3)(" 物品标签 "),"items"===b.value?((0,r.uX)(),(0,r.CE)("div",tP,[(0,r.Q3)(" 自定义确认弹窗 "),y.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"custom-confirm-overlay",onClick:l[6]||(l[6]=e=>y.value=!1)},[(0,r.Lk)("div",{class:"custom-confirm-modal",onClick:l[5]||(l[5]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",aP,[(0,r.Lk)("h3",null,(0,o.v_)(x.value),1),(0,r.Lk)("button",{class:"confirm-close-btn",onClick:l[3]||(l[3]=e=>y.value=!1)},[(0,r.bF)((0,i.R1)(ed.A),{size:20})])]),(0,r.Lk)("div",rP,[(0,r.Lk)("p",null,(0,o.v_)(k.value),1)]),(0,r.Lk)("div",oP,[(0,r.Lk)("button",{class:"confirm-btn cancel-btn",onClick:l[4]||(l[4]=e=>y.value=!1)},(0,o.v_)((0,i.R1)(n)("取消")),1),(0,r.Lk)("button",{class:"confirm-btn confirm-btn",onClick:ee},(0,o.v_)((0,i.R1)(n)("确定")),1)])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 移动端：模态框详情 "),I.value&&P.value?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"item-modal-overlay",onClick:ne},[(0,r.Lk)("div",{class:"item-modal",onClick:l[11]||(l[11]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",iP,[(0,r.Lk)("h3",{class:(0,o.C4)(Z(f.value,"text"))},(0,o.v_)(f.value?.名称),3),(0,r.Lk)("button",{class:"modal-close-btn",onClick:ne},[(0,r.bF)((0,i.R1)(ed.A),{size:20})])]),(0,r.Lk)("div",sP,[(0,r.Lk)("div",{class:(0,o.C4)(["modal-icon-simple",Z(f.value)])},[(0,r.Lk)("div",lP,(0,o.v_)(f.value?.类型),1)],2),(0,r.Lk)("div",cP,[(0,r.Lk)("div",dP,[(0,r.eW)((0,o.v_)((0,i.R1)(n)(f.value?.类型??"未知"))+" / "+(0,o.v_)(f.value?.品质?.quality?(0,i.R1)(n)(f.value.品质.quality):(0,i.R1)(n)("未知"))+" ",1),void 0!==f.value?.品质?.grade?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,o.C4)(["grade-display",W(f.value.品质.grade)])},(0,o.v_)((0,i.R1)(n)(U(f.value.品质.grade)))+"("+(0,o.v_)(f.value.品质.grade)+") ",3)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("p",uP,(0,o.v_)(f.value?.描述),1),"装备"===f.value?.类型&&f.value?.装备增幅?((0,r.uX)(),(0,r.CE)("div",pP,[(0,r.Lk)("h4",null,(0,o.v_)((0,i.R1)(n)("装备增幅:")),1),(0,r.Lk)("div",vP,(0,o.v_)("string"==typeof f.value.装备增幅?f.value.装备增幅:j(f.value.装备增幅)),1)])):(0,r.Q3)("v-if",!0),"装备"===f.value?.类型&&f.value?.特殊效果?((0,r.uX)(),(0,r.CE)("div",fP,[(0,r.Lk)("h4",null,(0,o.v_)((0,i.R1)(n)("特殊效果:")),1),(0,r.Lk)("div",hP,(0,o.v_)("string"==typeof f.value.特殊效果?f.value.特殊效果:j(f.value.特殊效果)),1)])):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",mP,[(0,r.Q3)(" 装备：装备和丢弃 "),"装备"===f.value?.类型?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("button",{class:(0,o.C4)(["action-btn",J(f.value)?"unequip-btn":"equip-btn"]),disabled:M.value,onClick:l[7]||(l[7]=e=>Y(f.value))},(0,o.v_)(J(f.value)?(0,i.R1)(n)("卸下"):(0,i.R1)(n)("装备")),11,gP),(0,r.Lk)("button",{class:"action-btn discard-btn",onClick:l[8]||(l[8]=e=>Q(f.value))},(0,o.v_)((0,i.R1)(n)("丢弃")),1)],64)):f.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 其他物品：使用和丢弃 "),(0,r.Lk)("button",{class:"action-btn use-btn",onClick:l[9]||(l[9]=e=>q(f.value))},(0,o.v_)((0,i.R1)(n)("使用")),1),(0,r.Lk)("button",{class:"action-btn discard-btn",onClick:l[10]||(l[10]=e=>Q(f.value))},(0,o.v_)((0,i.R1)(n)("丢弃")),1)],64)):(0,r.Q3)("v-if",!0)])])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",bP,[p.value?((0,r.uX)(),(0,r.CE)("div",yP,[l[16]||(l[16]=(0,r.Lk)("div",{class:"loading-spinner"},null,-1)),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(n)("加载中...")),1)])):0===F.value.length?((0,r.uX)(),(0,r.CE)("div",xP,[(0,r.bF)((0,i.R1)(mM),{size:48}),"all"===m.value?((0,r.uX)(),(0,r.CE)("p",kP,(0,o.v_)((0,i.R1)(n)("空空如也")),1)):"装备"===m.value?((0,r.uX)(),(0,r.CE)("p",wP,(0,o.v_)((0,i.R1)(n)("暂无装备")),1)):"功法"===m.value?((0,r.uX)(),(0,r.CE)("p",_P,(0,o.v_)((0,i.R1)(n)("暂无功法")),1)):"其他"===m.value?((0,r.uX)(),(0,r.CE)("p",CP,(0,o.v_)((0,i.R1)(n)("暂无其他物品")),1)):((0,r.uX)(),(0,r.CE)("p",AP,(0,o.v_)((0,i.R1)(n)("暂无{0}").replace("{0}",(0,i.R1)(n)(m.value))),1)),"all"!==m.value?((0,r.uX)(),(0,r.CE)("span",SP,(0,o.v_)((0,i.R1)(n)("可以试试搜索其他分类")),1)):(0,r.Q3)("v-if",!0)])):((0,r.uX)(!0),(0,r.CE)(r.FK,{key:2},(0,r.pI)(F.value,e=>{return(0,r.uX)(),(0,r.CE)("div",{key:e.物品ID,class:(0,o.C4)(["item-card",Z(e,"card")]),onClick:n=>(e=>{f.value=e,P.value&&(I.value=!0)})(e)},[(0,r.Q3)(" 物品图标和品质 "),(0,r.Lk)("div",EP,[(0,r.Lk)("div",{class:(0,o.C4)(["item-icon-area",Z(e,"border")])},[(0,r.Lk)("div",TP,(0,o.v_)((t=e.类型,{装备:"E",功法:"T",物品:"I",突变结晶:"C"}[t]||"I")),1),(0,r.Lk)("div",{class:(0,o.C4)(["item-quality-badge",Z(e,"text")])},(0,o.v_)(e.品质?.quality?(0,i.R1)(n)(e.品质.quality):(0,i.R1)(n)("未知")),3)],2)]),(0,r.Q3)(" 数量显示 "),e.数量>1?((0,r.uX)(),(0,r.CE)("div",IP,"×"+(0,o.v_)(e.数量),1)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 物品名称 "),(0,r.Lk)("div",RP,[(0,r.Lk)("div",{class:"item-name",title:e.名称},(0,o.v_)(e.名称),9,MP)]),(0,r.Q3)(" 底部信息：类型和品级 "),(0,r.Lk)("div",PP,[(0,r.Lk)("div",DP,(0,o.v_)((0,i.R1)(n)(e.类型)),1),void 0!==e.品质?.grade?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,o.C4)(["item-grade-info",W(e.品质.grade)])},(0,o.v_)((0,i.R1)(n)(U(e.品质.grade)))+"("+(0,o.v_)(e.品质.grade)+") ",3)):(0,r.Q3)("v-if",!0)])],10,LP);var t}),128))]),(0,r.Q3)(" 桌面端物品详情侧边栏 "),P.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",zP,[f.value?((0,r.uX)(),(0,r.CE)("div",NP,[(0,r.Lk)("div",$P,[(0,r.Lk)("div",{class:(0,o.C4)(["details-icon-large",Z(f.value)])},[(0,r.Lk)("div",OP,(0,o.v_)(f.value.类型),1)],2),(0,r.Lk)("div",FP,[(0,r.Lk)("h3",null,(0,o.v_)(f.value.名称),1),(0,r.Lk)("div",jP,[(0,r.eW)((0,o.v_)((0,i.R1)(n)(f.value.类型))+" / "+(0,o.v_)(f.value.品质?.quality?(0,i.R1)(n)(f.value.品质.quality):(0,i.R1)(n)("未知"))+" ",1),void 0!==f.value.品质?.grade?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,o.C4)(["grade-display",W(f.value.品质.grade)])},(0,o.v_)((0,i.R1)(n)(U(f.value.品质.grade)))+"("+(0,o.v_)(f.value.品质.grade)+") ",3)):(0,r.Q3)("v-if",!0)])])]),(0,r.Lk)("div",BP,[(0,r.Lk)("p",XP,(0,o.v_)(f.value.描述),1),(0,r.Q3)(" 装备装备增幅 "),"装备"===f.value.类型&&f.value.装备增幅?((0,r.uX)(),(0,r.CE)("div",UP,[(0,r.Lk)("h4",null,(0,o.v_)((0,i.R1)(n)("装备增幅:")),1),(0,r.Lk)("div",WP,(0,o.v_)("string"==typeof f.value.装备增幅?f.value.装备增幅:j(f.value.装备增幅)),1)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 装备特殊效果 "),"装备"===f.value.类型&&f.value.特殊效果?((0,r.uX)(),(0,r.CE)("div",qP,[(0,r.Lk)("h4",null,(0,o.v_)((0,i.R1)(n)("特殊效果:")),1),(0,r.Lk)("div",GP,(0,o.v_)("string"==typeof f.value.特殊效果?f.value.特殊效果:j(f.value.特殊效果)),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",HP,[(0,r.Q3)(" 装备：装备和丢弃 "),"装备"===f.value?.类型?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("button",{class:(0,o.C4)(["action-btn",J(f.value)?"unequip-btn":"equip-btn"]),disabled:M.value,onClick:l[12]||(l[12]=e=>Y(f.value))},(0,o.v_)(J(f.value)?(0,i.R1)(n)("卸下"):(0,i.R1)(n)("装备")),11,VP),(0,r.Lk)("button",{class:"action-btn discard-btn",onClick:l[13]||(l[13]=e=>Q(f.value))},(0,o.v_)((0,i.R1)(n)("丢弃")),1)],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 其他物品：使用和丢弃 "),(0,r.Lk)("button",{class:"action-btn use-btn",onClick:l[14]||(l[14]=e=>q(f.value))},(0,o.v_)((0,i.R1)(n)("使用")),1),(0,r.Lk)("button",{class:"action-btn discard-btn",onClick:l[15]||(l[15]=e=>Q(f.value))},(0,o.v_)((0,i.R1)(n)("丢弃")),1)],64))])])):((0,r.uX)(),(0,r.CE)("div",QP,[(0,r.bF)((0,i.R1)(mM),{size:48}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(n)("选择物品查看详情")),1)]))]))])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 装备标签 "),"equipment"===b.value?((0,r.uX)(),(0,r.CE)("div",KP,[(0,r.Lk)("div",YP,[(0,r.Q3)(" 装备总览卡片 "),(0,r.Lk)("div",JP,[(0,r.Lk)("div",ZP,[(0,r.Lk)("div",eD,[(0,r.bF)((0,i.R1)(pM),{size:20,class:"title-icon"}),l[17]||(l[17]=(0,r.Lk)("span",null,"法宝装备",-1))]),(0,r.Lk)("div",nD,[(0,r.Lk)("div",tD,[l[18]||(l[18]=(0,r.Lk)("span",{class:"stat-label"},"已装备",-1)),(0,r.Lk)("span",aD,(0,o.v_)(B.value)+"/"+(0,o.v_)(z.value.length),1)])])])]),(0,r.Q3)(" 装备槽位网格 "),(0,r.Lk)("div",rD,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(z.value,(e,a)=>{return(0,r.uX)(),(0,r.CE)("div",{key:a,class:(0,o.C4)(["equipment-slot-card",[e.item?"equipped":"empty",e.item?Z(e.item,"card"):""]])},[(0,r.Q3)(" 槽位标题栏 "),(0,r.Lk)("div",oD,[(0,r.Lk)("div",iD,[(0,r.Lk)("div",sD,(0,o.v_)((s=e.name,{装备1:"⚔️",装备2:"🛡️",装备3:"👑",装备4:"💍",装备5:"📿",装备6:"🔮"}[s]||"⚡")),1),(0,r.Lk)("span",lD,(0,o.v_)(e.name),1)]),e.item?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"slot-unequip-btn",disabled:M.value,onClick:a=>(async e=>{if(M.value)return;if(!e.item)return;M.value=!0;const a=e.item;TA.Yz.log(n("背包面板"),n("卸下装备"),a.名称);try{if(!c.equipment)return void _e.o.error(n("装备栏数据不存在"));if(!c.inventory?.物品)return void _e.o.error(n("背包数据不存在"));const r=c.toSaveData();if(!r)return void _e.o.error(n("存档数据不存在"));const o=r;o.角色||(o.角色={}),o.角色.装备||(o.角色.装备={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null});const i=e.slotKey;o.角色.装备[i]=null,o.角色?.背包?.物品?.[a.物品ID]&&(o.角色.背包.物品[a.物品ID].已装备=!1);const{removeEquipmentBonus:s}=await Promise.resolve().then(t.bind(t,651));s(r,a.物品ID),c.loadFromSaveData(r),await c.saveGame(),d.addAction({type:"unequip",itemName:a.名称,itemType:a.类型,description:n("卸下了《{0}》装备").replace("{0}",a.名称)}),_e.o.success(n("已卸下《{0}》").replace("{0}",a.名称)),TA.Yz.log(n("背包面板"),n("装备卸下成功"),a.名称)}catch(e){TA.Yz.error(n("背包面板"),n("卸下装备失败"),e),_e.o.error(n("卸下装备失败"))}finally{M.value=!1}})(e),title:(0,i.R1)(n)("卸下装备")},[(0,r.bF)((0,i.R1)(ed.A),{size:14})],8,cD)):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 已装备内容 "),e.item?((0,r.uX)(),(0,r.CE)("div",dD,[(0,r.Q3)(" 装备图标区 "),(0,r.Lk)("div",uD,[(0,r.Lk)("div",{class:(0,o.C4)(["icon-glow",Z(e.item,"glow")])},null,2),(0,r.Lk)("div",{class:(0,o.C4)(["icon-frame",Z(e.item,"border")])},[(0,r.Lk)("div",pD,[(0,r.bF)((0,i.R1)(pM),{size:32,class:(0,o.C4)(Z(e.item,"text"))},null,8,["class"])])],2),(0,r.Lk)("div",{class:(0,o.C4)(["quality-badge",Z(e.item,"badge")])},(0,o.v_)(e.item.品质?.quality?(0,i.R1)(n)(e.item.品质.quality):"？"),3)]),(0,r.Q3)(" 装备信息区 "),(0,r.Lk)("div",vD,[(0,r.Lk)("div",{class:(0,o.C4)(["equipped-name",Z(e.item,"text")])},(0,o.v_)(e.item.名称),3),(0,r.Lk)("div",fD,[void 0!==e.item.品质?.grade?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,o.C4)(["grade-badge",W(e.item.品质.grade)])},(0,o.v_)((0,i.R1)(n)(U(e.item.品质.grade)))+" ("+(0,o.v_)(e.item.品质.grade)+") ",3)):(0,r.Q3)("v-if",!0)]),e.item.描述?((0,r.uX)(),(0,r.CE)("div",hD,(0,o.v_)(e.item.描述),1)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 装备效果 "),(0,r.Lk)("div",mD,["装备"===e.item.类型&&e.item.装备增幅?((0,r.uX)(),(0,r.CE)("div",gD,[l[19]||(l[19]=(0,r.Lk)("div",{class:"effect-label"},[(0,r.Lk)("div",{class:"effect-dot"}),(0,r.Lk)("span",null,"增幅效果")],-1)),(0,r.Lk)("div",bD,(0,o.v_)("string"==typeof e.item.装备增幅?e.item.装备增幅:j(e.item.装备增幅)),1)])):(0,r.Q3)("v-if",!0),"装备"===e.item.类型&&e.item.特殊效果?((0,r.uX)(),(0,r.CE)("div",yD,[l[20]||(l[20]=(0,r.Lk)("div",{class:"effect-label"},[(0,r.Lk)("div",{class:"effect-dot special"}),(0,r.Lk)("span",null,"特殊效果")],-1)),(0,r.Lk)("div",xD,(0,o.v_)("string"==typeof e.item.特殊效果?e.item.特殊效果:j(e.item.特殊效果)),1)])):(0,r.Q3)("v-if",!0)])])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 空槽位内容 "),(0,r.Lk)("div",kD,[(0,r.Lk)("div",wD,[(0,r.bF)((0,i.R1)(Hc),{size:40})]),l[21]||(l[21]=(0,r.Lk)("div",{class:"empty-slot-text"},[(0,r.Lk)("div",{class:"empty-main"},"空槽位"),(0,r.Lk)("div",{class:"empty-hint"},"可装备法宝")],-1))])],2112))],2);var s}),128))])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 财产管理标签 "),"currency"===b.value?((0,r.uX)(),(0,r.CE)("div",_D,[(0,r.Lk)("div",CD,[l[22]||(l[22]=(0,r.Lk)("div",{class:"summary-title"},"总价值",-1)),(0,r.Lk)("div",AD,[(0,r.eW)((0,o.v_)(ae(pe.value))+" ",1),(0,r.Lk)("span",SD,(0,o.v_)(ue.value),1)]),ve.value?((0,r.uX)(),(0,r.CE)("div",LD,(0,o.v_)(ve.value),1)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",ED,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(fe.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["currency-card",e.colorClass])},[(0,r.Lk)("div",TD,[(0,r.Lk)("div",{class:(0,o.C4)(["currency-icon",`icon-${e.colorClass}`])},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:P.value?32:40},null,8,["size"]))],2),(0,r.Lk)("div",ID,[(0,r.Lk)("div",RD,(0,o.v_)(ae(e.amount)),1),(0,r.Lk)("div",MD,(0,o.v_)(e.label),1),(0,r.Lk)("div",PD,(0,o.v_)(e.subLabel),1)]),e.canDelete?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"currency-delete-btn",title:(0,i.R1)(n)("删除"),onClick:n=>{return t=e.id,x.value="删除币种",k.value=`确定删除币种「${t}」并清空其数量吗？（可在后续剧情/AI再次创建）`,R.value=async()=>{const e=oe();if(e){if(e.货币&&"object"==typeof e.货币&&delete e.货币[t],e.货币设置||(e.货币设置={禁用币种:[],基准币种:jM.ms}),Array.isArray(e.货币设置.禁用币种)||(e.货币设置.禁用币种=[]),e.货币设置.禁用币种.includes(t)||e.货币设置.禁用币种.push(t),e.货币设置.基准币种===t){const n=e.货币?Object.keys(e.货币):[];e.货币设置.基准币种=n.includes(jM.ms)?jM.ms:n[0]||jM.ms}(0,jM.A6)(e),await a.saveCurrentGame(),_e.o.success("币种已删除")}},void(y.value=!0);var t}},[(0,r.bF)((0,i.R1)(ba.A),{size:16})],8,DD)):(0,r.Q3)("v-if",!0)]),e.exchangeUp||e.exchangeDown?((0,r.uX)(),(0,r.CE)("div",zD,[e.exchangeUp?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"exchange-btn",onClick:n=>he(e.id,"up"),disabled:e.exchangeUp&&e.amount<e.exchangeUp.cost,title:e.exchangeUp?e.exchangeUp.title:""},(0,o.v_)((0,i.R1)(n)("↑ 兑换")),9,ND)):(0,r.Q3)("v-if",!0),e.exchangeDown?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"exchange-btn down",onClick:n=>he(e.id,"down"),disabled:e.amount<1,title:e.exchangeDown?e.exchangeDown.title:""},(0,o.v_)((0,i.R1)(n)("↓ 分解")),9,$D)):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)],2))),128))])])):(0,r.Q3)("v-if",!0)])]),(0,r.Q3)(" 数量选择弹窗 "),(0,r.bF)(FM,{visible:w.value,item:_.value,title:C.value,"action-label":A.value,"action-type":S.value,"confirm-text":L.value,description:E.value,onClose:V,onConfirm:H},null,8,["visible","item","title","action-label","action-type","confirm-text","description"])],64))}});var FD=t(6750),jD={};jD.styleTagTransform=A(),jD.setAttributes=k(),jD.insert=y().bind(null,"head"),jD.domAPI=g(),jD.insertStyleElement=_(),h()(FD.A,jD),FD.A&&FD.A.locals&&FD.A.locals;const BD=(0,E.A)(OD,[["__scopeId","data-v-73d16fe1"]]),XD=(0,I.A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),UD=(0,I.A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),WD=(0,I.A)("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),qD=e=>"",GD=e=>"string"==typeof e?e:"";var HD=t(2543);const VD={class:"relationship-network-panel"},QD={class:"panel-content"},KD={class:"view-mode-tabs"},YD={key:0,class:"view-hint"},JD={class:"graph-edge-count"},ZD={key:0,class:"inferred-badge"},ez={class:"relationship-list"},nz={class:"list-header"},tz={class:"search-bar"},az={class:"list-content"},rz={key:0,class:"loading-state"},oz={key:1,class:"empty-state"},iz={class:"empty-text"},sz={key:0,class:"empty-hint"},lz={key:1,class:"empty-hint"},cz={key:2,class:"person-list"},dz=["onClick"],uz={class:"person-avatar"},pz={class:"avatar-text"},vz={class:"person-info"},fz={class:"person-name"},hz={class:"person-meta"},mz={class:"relationship-type"},gz=["onClick","title"],bz=["onClick"],yz={key:0,class:"person-realm"},xz={class:"realm-value"},kz={class:"intimacy-info"},wz={class:"intimacy-bar"},_z={class:"intimacy-value"},Cz={class:"relationship-detail"},Az={class:"detail-header"},Sz={class:"detail-avatar"},Lz={class:"avatar-text"},Ez={class:"detail-info"},Tz={class:"name-and-actions"},Iz={class:"detail-name"},Rz={class:"action-buttons"},Mz={class:"detail-badges"},Pz={class:"relationship-badge"},Dz={class:"race-badge"},zz={key:0,class:"faction-badge"},Nz={class:"detail-body"},$z={class:"detail-tabs"},Oz=["onClick"],Fz={class:"tab-content"},jz={class:"tab-panel"},Bz={class:"detail-section"},Xz={class:"info-grid-responsive"},Uz={class:"info-item-row"},Wz={class:"info-value"},qz={class:"info-item-row"},Gz={class:"info-value"},Hz={class:"info-item-row"},Vz={class:"info-value"},Qz={key:0,class:"info-item-row"},Kz={class:"info-value"},Yz={key:1,class:"info-item-row"},Jz={class:"info-value"},Zz={key:0,class:"detail-section"},eN={class:"npc-vitals-container"},nN={class:"npc-vital-row"},tN={class:"npc-vital-meta"},aN={class:"npc-vital-nums"},rN={class:"npc-vital-track"},oN={class:"npc-vital-row"},iN={class:"npc-vital-meta"},sN={class:"npc-vital-nums"},lN={class:"npc-vital-track"},cN={class:"npc-vital-row"},dN={class:"npc-vital-meta"},uN={class:"npc-vital-nums"},pN={class:"npc-vital-track"},vN={class:"npc-vital-row"},fN={class:"npc-vital-meta"},hN={class:"npc-vital-nums"},mN={class:"npc-vital-track"},gN={class:"npc-vital-row"},bN={class:"npc-vital-meta"},yN={class:"npc-vital-nums"},xN={class:"npc-vital-track"},kN={key:1,class:"detail-section"},wN={class:"attributes-grid"},_N={class:"attribute-item"},CN={class:"attr-value"},AN={class:"attribute-item"},SN={class:"attr-value"},LN={class:"attribute-item"},EN={class:"attr-value"},TN={class:"attribute-item"},IN={class:"attr-value"},RN={key:2,class:"detail-section"},MN={key:0,class:"appearance-description"},PN={class:"description-text"},DN={key:1,class:"talents-grid",style:{"margin-top":"1rem"}},zN={key:3,class:"detail-section"},NN={key:0},$N={class:"talents-grid"},ON=["onClick"],FN={key:1,style:{"margin-top":"1rem"}},jN={class:"attributes-grid"},BN={class:"attribute-item"},XN={class:"attr-value"},UN={class:"attribute-item"},WN={class:"attr-value"},qN={class:"attribute-item"},GN={class:"attr-value"},HN={class:"attribute-item"},VN={class:"attr-value"},QN={class:"attribute-item"},KN={class:"attr-value"},YN={class:"attribute-item"},JN={class:"attr-value"},ZN={key:4,class:"detail-section"},e$={class:"npc-memories-list"},n$={class:"npc-memory-content"},t$={class:"detail-section personality-section"},a$={class:"personality-bottomlines"},r$={key:0,class:"bottomline-tags"},o$={key:1,class:"bottomline-empty"},i$={class:"tab-panel"},s$={class:"detail-section highlight-section"},l$={class:"realtime-status"},c$={class:"status-item"},d$={class:"status-content"},u$={class:"status-text"},p$={class:"status-item"},v$={class:"status-content"},f$={class:"status-text"},h$={class:"tab-panel"},m$={class:"detail-section"},g$={key:0,class:"ability-card"},b$={class:"ability-header"},y$={class:"ability-name"},x$={class:"ability-type"},k$={class:"ability-content"},w$={class:"ability-desc"},_$={key:0,class:"ability-cost"},C$={class:"cost-value"},A$={key:1,class:"empty-state"},S$={class:"tab-panel"},L$={class:"detail-section nsfw-section"},E$={key:0,class:"bottomline-empty"},T$={key:1},I$={class:"nsfw-subsection"},R$={class:"info-grid-responsive"},M$={class:"info-item-row"},P$={class:"info-label"},D$={class:"info-value"},z$={class:"info-item-row"},N$={class:"info-label"},$$={class:"info-value"},O$={class:"info-item-row"},F$={class:"info-value"},j$={class:"info-item-row"},B$={class:"info-value"},X$={class:"info-item-row"},U$={class:"info-value"},W$={class:"info-item-row"},q$={class:"info-value"},G$={class:"info-item-row"},H$={class:"info-value"},V$={class:"info-item-row"},Q$={class:"info-value"},K$={class:"info-item-row"},Y$={class:"info-value"},J$={key:0,class:"first-time-info"},Z$={class:"development-bars",style:{"margin-top":"0.75rem"}},eO={class:"dev-bar-item"},nO={class:"dev-bar-header"},tO={class:"dev-value"},aO={class:"dev-bar-track"},rO={key:1,class:"last-time-info"},oO={class:"last-time-value"},iO={key:0,class:"nsfw-subsection"},sO={class:"info-grid-responsive"},lO={key:0,class:"info-item-row"},cO={class:"info-value"},dO={key:1,class:"info-item-row"},uO={class:"info-value"},pO={key:2,class:"info-item-row"},vO={class:"info-value"},fO={key:0,class:"fluid-status"},hO={key:1,class:"nsfw-subsection"},mO={key:0,class:"bottomline-tags"},gO={key:1,class:"bottomline-tags",style:{"margin-top":"0.5rem"}},bO={key:2,class:"bottomline-tags",style:{"margin-top":"0.5rem"}},yO={key:3,class:"bottomline-tags",style:{"margin-top":"0.5rem"}},xO={key:2,class:"nsfw-subsection"},kO={class:"subsection-title"},wO={class:"pregnancy-info"},_O={key:0,class:"pregnancy-active"},CO={class:"pregnancy-details"},AO={key:0},SO={key:1},LO={key:1,class:"pregnancy-inactive"},EO={key:2,class:"pregnancy-inactive"},TO={key:0,class:"info-grid-responsive",style:{"margin-top":"0.5rem"}},IO={key:0,class:"info-item-row"},RO={class:"info-value"},MO={key:3,class:"nsfw-subsection"},PO={class:"bottomline-tags partner-list"},DO={key:4,class:"nsfw-subsection"},zO={class:"body-parts-list"},NO={class:"part-header"},$O={class:"part-name"},OO={key:0,class:"part-mark"},FO={key:0,class:"part-description"},jO={key:1,class:"part-description"},BO={key:2,class:"part-description"},XO={key:3,class:"part-description"},UO={class:"part-stats"},WO={class:"part-stat"},qO={class:"stat-bar-mini"},GO={class:"stat-value"},HO={class:"part-stat"},VO={class:"stat-bar-mini"},QO={class:"stat-value"},KO={key:2,class:"bottomline-empty"},YO={class:"tab-panel"},JO={key:0,class:"detail-section"},ZO={class:"memory-header"},eF={class:"memory-actions-header"},nF={class:"memory-count"},tF={class:"memory-controls-group"},aF={key:0,class:"summarize-controls"},rF=["max"],oF=["disabled"],iF={class:"memory-list"},sF={class:"memory-content"},lF={key:0,class:"memory-time"},cF={class:"memory-event"},dF={class:"memory-actions"},uF=["onClick"],pF=["onClick"],vF={key:0,class:"memory-pagination"},fF=["disabled"],hF={class:"pagination-controls"},mF={class:"pagination-info"},gF={class:"jump-to-page"},bF=["max"],yF=["disabled"],xF={key:1,class:"detail-section memory-summary-section"},kF={class:"memory-summary-list"},wF={class:"summary-text"},_F={key:2,class:"detail-section"},CF={class:"empty-state-small"},AF={class:"tab-panel"},SF={class:"detail-section"},LF={key:0,class:"spirit-stones-grid"},EF={class:"spirit-stone-item"},TF={class:"spirit-stone-item"},IF={class:"spirit-stone-item"},RF={class:"spirit-stone-item"},MF={class:"npc-inventory",style:{"margin-top":"1rem"}},PF={key:0,class:"npc-items-grid"},DF={class:"item-header"},zF={class:"item-name"},NF={class:"item-type"},$F={key:0,class:"item-quality"},OF={class:"quality-text"},FF={key:1,class:"item-quantity"},jF={key:2,class:"item-description"},BF={class:"item-actions"},XF=["onClick"],UF=["onClick"],WF=["onClick"],qF={key:1,class:"empty-inventory"},GF={class:"tab-panel"},HF={class:"detail-section"},VF={class:"raw-data-container"},QF={key:1,class:"no-selection"},KF={key:1,class:"relationship-graph"},YF=["transform"],JF=["x1","y1","x2","y2"],ZF=["transform","onClick"],ej=["r"],nj=["y"],tj="玩家",aj=(0,r.pM)({__name:"RelationshipNetworkPanel",setup(e){function n(e){const n="number"==typeof e&&Number.isFinite(e)?e:0;return Math.max(0,Math.min(100,n))}function a(e){if("string"!=typeof e)return null;return e.trim()||null}function c(e){const n=e=>{const n=new Set;return e.filter(e=>!n.has(e)&&(n.add(e),!0))};if(Array.isArray(e))return n(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean));const t=a(e);return t?/[、,，;；\n]/.test(t)?n(t.split(/[、,，;；\n]/).map(e=>e.trim()).filter(Boolean)):[t]:[]}const d=(0,Hu.useGameStateStore)(),{t:u}=(0,l.s)(),p=(0,r.EW)(()=>d.getCurrentSaveData()),v=vw(),f=(0,$.useUIStore)(),h=(0,Ec.useCharacterStore)(),m=(0,i.KR)(!1),g=(0,i.KR)(null),b=(0,i.KR)(""),y=(0,i.KR)(!1),x=(0,i.KR)("list"),k=(0,i.KR)(null),w=(0,i.KR)(1),_=(0,i.KR)({x:0,y:0}),C=(0,i.KR)(!1),A=(0,i.KR)({x:0,y:0,tx:0,ty:0}),S=(e,n,t)=>Math.max(n,Math.min(t,e)),L=(0,r.EW)(()=>`translate(${_.value.x} ${_.value.y}) scale(${w.value})`),E=(0,r.EW)(()=>{const e=p.value,n=e?.角色?.身份?.名字||e?.角色?.名字;return"string"==typeof n&&n.trim()?n.trim():"玩家"}),T=(0,r.EW)(()=>{const e=p.value?.社交?.关系矩阵?.edges;return Array.isArray(e)?e.filter(e=>e&&"object"==typeof e).map(e=>({from:String(e.from??"").trim(),to:String(e.to??"").trim(),relation:"string"==typeof e.relation?e.relation:void 0,score:"number"==typeof e.score&&Number.isFinite(e.score)?e.score:void 0,tags:Array.isArray(e.tags)?e.tags.filter(e=>"string"==typeof e&&e.trim()):void 0,updatedAt:"string"==typeof e.updatedAt?e.updatedAt:void 0})).filter(e=>e.from&&e.to):[]}),I=(0,r.EW)(()=>{const e=He.value;if(e.length<3)return[];const n=e=>{const n=a(e?.属性?.觉醒阶段)??"";return n?"凡人"===n?0:10:0},t=new Set(e.map(e=>e.名字).filter(e=>"string"==typeof e&&e.trim())),r=[],o=new Set,i=(e,n,a,i,s)=>{const l=e.trim(),c=n.trim();if(!l||!c||l===c)return;if(!t.has(l)||!t.has(c))return;const d=((e,n)=>`${e<n?e:n}::${e<n?n:e}`)(l,c);o.has(d)||(o.add(d),r.push({from:l,to:c,relation:a,score:i,tags:s}))},s=new Map;for(const n of e){const e=a(n?.势力归属)??"";if(!e)continue;const t=s.get(e)??[];t.push(n),s.set(e,t)}for(const[e,t]of s.entries()){if(t.length<2)continue;const a=[...t].sort((e,t)=>n(t)-n(e)||e.名字.localeCompare(t.名字))[0];for(const n of t)n.名字!==a.名字&&i(a.名字,n.名字,"同门",25,["auto","同势力",e])}const l=Array.from(t);for(const n of e){const e=Array.isArray(n?.记忆)?n.记忆:[];if(0===e.length)continue;const t=e.filter(e=>"string"==typeof e).join("\n");if(t)for(const e of l)e!==n.名字&&t.includes(e)&&i(n.名字,e,"旧识",10,["auto","记忆相关"])}return r.slice(0,200)}),R=(0,r.EW)(()=>T.value.length>0?T.value:I.value),M=(0,r.EW)(()=>0===T.value.length&&I.value.length>0),P=(0,r.EW)(()=>{const e=He.value.map(e=>({from:tj,to:e.名字,relation:e.与玩家关系||"相识",score:"number"==typeof e.好感度?e.好感度:0})),n=R.value.map(e=>({...e,from:"玩家"===e.from||e.from===E.value?tj:e.from,to:"玩家"===e.to||e.to===E.value?tj:e.to})).filter(e=>e.from!==e.to),t=new Set,a=[];for(const r of[...e,...n]){const e=r.from.trim(),n=r.to.trim();if(!e||!n)continue;const[o,i]=e<n?[e,n]:[n,e],s=`${o}::${i}`;t.has(s)||(t.add(s),a.push({...r,from:e,to:n}))}return a}),D=(0,r.EW)(()=>{const e=new Set;e.add(tj);for(const n of He.value)e.add(n.名字);for(const n of R.value)n.from&&e.add("玩家"===n.from||n.from===E.value?tj:n.from),n.to&&e.add("玩家"===n.to||n.to===E.value?tj:n.to);const n=Array.from(e).filter(e=>e!==tj),t=S(200+8*n.length,220,260),a=[];return a.push({id:tj,label:E.value,kind:"player",x:450,y:300}),n.forEach((e,r)=>{const o=2*Math.PI*r/Math.max(1,n.length)-Math.PI/2,i=450+Math.cos(o)*t,s=300+Math.sin(o)*t,l=He.value.some(n=>n.名字===e);a.push({id:e,label:e,kind:l?"npc":"extra",x:i,y:s})}),a}),z=(0,r.EW)(()=>{const e={};for(const n of D.value)e[n.id]=n;return e}),N=e=>{const n="number"==typeof e.score?e.score:0;if(n>=60)return"rgba(236, 72, 153, 0.55)";if(n>=20)return"rgba(34, 197, 94, 0.55)";if(n<=-40)return"rgba(239, 68, 68, 0.55)";if(n<0)return"rgba(245, 158, 11, 0.55)";const t=String(e.relation??"");return t.includes("仇")||t.includes("敌")?"rgba(239, 68, 68, 0.55)":"rgba(107, 114, 128, 0.45)"},O=e=>{const n="number"==typeof e.score?Math.abs(e.score):0;return`${S(1.2+n/30,1.2,5)}`},F=e=>{const n=k.value;if(!n)return null;const t=n.getBoundingClientRect();return t.width&&t.height?{x:(e.clientX-t.left)/t.width*900,y:(e.clientY-t.top)/t.height*600}:null},j=e=>{const n=F(e);if(!n)return;const t=w.value,a=S(t*Math.exp(.001*-e.deltaY),.35,3);if(a===t)return;const r=(n.x-_.value.x)/t,o=(n.y-_.value.y)/t;w.value=a,_.value.x=n.x-r*a,_.value.y=n.y-o*a},B=e=>{if(e.target?.closest(".graph-node"))return;const n=F(e);n&&(C.value=!0,A.value={x:n.x,y:n.y,tx:_.value.x,ty:_.value.y},k.value?.setPointerCapture?.(e.pointerId))},X=e=>{if(!C.value)return;const n=F(e);n&&(_.value.x=A.value.tx+(n.x-A.value.x),_.value.y=A.value.ty+(n.y-A.value.y))},U=e=>{if(C.value){C.value=!1;try{k.value?.releasePointerCapture?.(e.pointerId)}catch{}}},W=(0,r.EW)(()=>(e=>{if("string"!=typeof e)return"unknown";const n=e.trim();return n?"男"===n||"male"===n.toLowerCase()||n.includes("男")?"male":"女"===n||"female"===n.toLowerCase()||n.includes("女")?"female":"unknown":"unknown"})(g.value?.性别)),q=(0,r.EW)(()=>"male"===W.value),G=(0,r.EW)(()=>"female"===W.value),H=(0,r.EW)(()=>g.value?.私密信息??null),V=e=>{const n="number"==typeof e?.三围?.胸围?e.三围.胸围:null,t="number"==typeof e?.三围?.腰围?e.三围.腰围:null,a="number"==typeof e?.三围?.臀围?e.三围.臀围:null;if(null===n&&null===t&&null===a)return"—";const r=e=>null===e?"--":String(e);return`${r(n)}/${r(t)}/${r(a)} cm`},Q=(0,r.EW)(()=>{const e=H.value?.是否为处女;return"boolean"!=typeof e?"—":e?q.value?u("处男"):G.value?u("处女"):"处子":q.value?"非处男":u("非处")}),K=(0,r.EW)(()=>{const e=a(H.value?.性经验等级);if(e)return e;const n="number"==typeof H.value?.性交总次数?H.value.性交总次数:null;return null===n?"":n<=0?"无经验":n<=2?"初体验":n<=8?"有经验":n<=20?"熟练":n<=60?"丰富":"资深"}),Y=(0,r.EW)(()=>a(H.value?.亲密节奏)??""),J=(0,r.EW)(()=>a(H.value?.亲密需求)??""),Z=(0,r.EW)(()=>a(H.value?.安全偏好)??""),ee=(0,r.EW)(()=>a(H.value?.避孕措施)??""),ne=(0,r.EW)(()=>c(H.value?.亲密偏好)),te=(0,r.EW)(()=>c(H.value?.禁忌清单)),ae=(0,r.EW)(()=>a(H.value?.最近一次性行为时间)??""),re=(0,r.EW)(()=>c(H.value?.性癖好)),oe=(0,r.EW)(()=>c(H.value?.特殊体质)),ie=(0,r.EW)(()=>{const e="number"==typeof H.value?.性交总次数?H.value.性交总次数:null;if(null!==e)return e<=0;const n=a(H.value?.最近一次性行为时间);return!!n&&/无|未有|暂无|没有/.test(n)}),se=(0,r.EW)(()=>{const e=H.value?.生育状态;return e?"string"==typeof e?{当前状态:e}:"object"==typeof e?e:null:null}),le=(0,r.EW)(()=>{const e=se.value;if(!e)return null;const n=e.是否可孕;if("boolean"==typeof n)return n;if("string"==typeof n){if(/[是可]/.test(n))return!0;if(/[否不]/.test(n))return!1}return null}),ce=(0,r.EW)(()=>a(se.value?.当前状态)??""),de=(0,r.EW)(()=>{const e=se.value,n=e?.妊娠月数??e?.怀孕月数??e?.妊娠状态?.怀孕月数;return"number"==typeof n&&Number.isFinite(n)?n:null}),ue=(0,r.EW)(()=>a(se.value?.预计分娩时间)??""),pe=(0,r.EW)(()=>{const e=se.value;if(!e)return!1;if("boolean"==typeof e?.妊娠状态?.是否怀孕)return e.妊娠状态.是否怀孕;const n=a(e?.当前状态);return!(!n||!/怀孕|妊娠/.test(n)||/未怀孕|未妊娠|未孕|不怀孕/.test(n))||null!==de.value}),ve=(0,i.KR)(!1),fe=(0,r.EW)(()=>c(H.value?.性伴侣名单)),he=(0,r.EW)(()=>ve.value?fe.value:fe.value.slice(0,10)),me=(0,i.KR)(!1),ge=(0,r.EW)(()=>{return e=function(e){if(Array.isArray(e)){const n=e.filter(e=>"object"==typeof e&&null!==e),t=new Set;return n.filter((e,n)=>{const r=a(e.部位名称)??`__index_${n}`;return!t.has(r)&&(t.add(r),!0)})}if("object"==typeof e&&null!==e){const n=Object.values(e).filter(e=>"object"==typeof e&&null!==e),t=new Set;return n.filter((e,n)=>{const r=a(e.部位名称)??`__index_${n}`;return!t.has(r)&&(t.add(r),!0)})}return[]}(H.value?.身体部位),"male"===(n=W.value)?e.filter(e=>{return n=String(e.部位名称??""),!/(小穴|阴道|子宫|宫颈|阴蒂|卵巢)/.test(n);var n}):"female"===n?e.filter(e=>{return n=String(e.部位名称??""),!/(阳具|阴茎|龟头|前列腺|精囊|睾丸)/.test(n);var n}):e;var e,n}),be=(0,r.EW)(()=>me.value?ge.value:ge.value.slice(0,6)),ye=(0,r.EW)(()=>{try{const e=localStorage.getItem("dad_game_settings");return!e||!1!==JSON.parse(e).enableNsfwMode}catch{return!0}}),xe=(0,i.KR)("basic"),ke=(0,r.EW)(()=>{const e=[{id:"basic",label:"基本信息",icon:"📋"},{id:"status",label:"实时状态",icon:"💭"}];return g.value?.异能名称&&e.push({id:"ability",label:"异能",icon:"⚡"}),ye.value&&e.push({id:"nsfw",label:"私密信息",icon:"🔞"}),e.push({id:"memory",label:"记忆档案",icon:"📝"}),e.push({id:"inventory",label:"背包",icon:"🎒"}),e.push({id:"raw",label:"原始数据(JSON)",icon:"🔧"}),e}),we=(0,i.KR)(!1),_e=(0,i.KR)(10),Ce=(0,i.KR)(5),Ae=(0,i.KR)(1),Se=(0,i.KR)(null),Le=(0,r.EW)(()=>{if(!g.value?.记忆?.length)return[];const e=g.value.记忆,n=(Ae.value-1)*Ce.value,t=n+Ce.value;return e.slice(n,t)}),Ee=(0,r.EW)(()=>g.value?.记忆?.length?Math.ceil(g.value.记忆.length/Ce.value):0),Te=e=>{e>=1&&e<=Ee.value&&(Ae.value=e)},Ie=()=>{Se.value&&Se.value>=1&&Se.value<=Ee.value&&(Ae.value=Se.value,Se.value=null)},Re=()=>{Ae.value=1},Me=e=>{const n=e?.觉醒阶段??e?.属性?.觉醒阶段??e?.觉醒阶段;if("string"==typeof n&&n.trim())return n;if(n&&"object"==typeof n){const e=n.名称??n.name;if("string"==typeof e&&e.trim())return e}return"未知"},Pe=e=>e?"string"==typeof e?e:"object"==typeof e&&(e.描述||e.description||e.名称||e.name)||"未知":"未知",De=e=>"number"==typeof e&&Number.isFinite(e)?e:null,ze=(0,r.EW)(()=>{if(!g.value)return null;const e=g.value,n=Me(e),t={先天属性:{力量:Number(e.先天属性?.力量??0),敏捷:Number(e.先天属性?.敏捷??0),体质:Number(e.先天属性?.体质??0),意志:Number(e.先天属性?.意志??0),魅力:Number(e.先天属性?.魅力??0),幸运:Number(e.先天属性?.幸运??0)},天赋:Array.isArray(e?.天赋)?e.天赋:[],觉醒阶段:n},a=e?.背包&&"object"==typeof e.背包?e.背包:{突变结晶:{下级:0,中级:0,上级:0,顶级:0},物品:{}},r=(()=>{const n=e?.装备;if(n&&"object"==typeof n)return n;const t={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},r=a?.物品??{};let o=1;for(const[e,n]of Object.entries(r)){if(o>6)break;const a=n;"装备"===a?.类型&&!0===a?.已装备&&(t[`装备${o}`]=e,o++)}return t})(),o=e?.效果&&Array.isArray(e.效果)?e.效果:[],i={角色:{身份:t,背包:a,装备:r,效果:o},元数据:{时间:d.gameTime}},s=(0,lh.Ew)(i);return{...(0,lh.Nz)(s,n,{}),...(0,lh._p)(s,n,{})}}),Ne=(e,n)=>{const t=e?.属性?.[n]??e?.[n];let a=null;"number"==typeof t?a=t:t&&"object"==typeof t&&(a=De(t.当前??t.current));let r=null,o=null;return ze.value&&("生命值"===n?(r=ze.value.HP.上限,o=ze.value.HP.当前):"精神力"===n?(r=ze.value.SP.上限,o=ze.value.SP.当前):"理智值"===n?(r=ze.value.SAN.上限,o=ze.value.SAN.当前):"体力"===n&&(r=ze.value.ST.上限,o=ze.value.ST.当前)),null===r&&(t&&"object"==typeof t?r=De(t.上限??t.max):"number"==typeof t&&(r=t)),null===a&&(null!==o?a=o:null!==r&&(a=r)),null!==a&&null!==r&&a>r&&(a=r),{current:a,max:r}},$e=(e,n)=>{const{current:t,max:a}=Ne(e,n);return null===t&&null===a?"--":null===t?`--/${a}`:null===a?`${t}/--`:`${t}/${a}`},Oe=e=>De(e?.属性?.寿元上限??e?.寿元上限??e?.寿命?.上限),Fe=e=>{const n=n=>{const t=Ne(e,n);return null!==t.current||null!==t.max};return!!ze.value||n("生命值")||n("精神力")||n("理智值")||n("体力")||null!==Oe(e)},je=e=>e.记忆&&Array.isArray(e.记忆)?e.记忆.slice(-3).reverse().map(e=>"string"==typeof e?e:"object"==typeof e&&e.事件?e.事件:"").filter(e=>e.length>0):[],Be=e=>{const n=p.value?.元数据?.时间;if(!e||!e.出生日期||!n)return"未知";const t=Number(e.出生日期.年??0),a=Number(e.出生日期.月??1),r=Number(e.出生日期.日??1),o=Number(n.年??0),i=Number(n.月??1),s=Number(n.日??1);if(t>o||t===o&&a>i||t===o&&a===i&&r>s)return"未知";let l=o-t;return i>a||i===a&&s>=r||(l-=1),l>=1?`${l}岁`:"1岁以内"},Xe=e=>{if(!e)return null;const n=Be(e);if(!n||"未知"===n)return null;const t=n.match(/\d+/);if(!t)return null;const a=Number(t[0]);return Number.isFinite(a)?a:null},Ue=e=>{const n=Xe(e),t=Oe(e);return null===n&&null===t?"--":null===n?`--/${t}`:null===t?`${n}/--`:`${n}/${t}`},We=(e,n)=>{const{current:t,max:a}=Ne(e,n);return null===t||null===a||0===a?0:Math.min(100,Math.round(t/a*100))},qe=e=>{const n=Xe(e),t=Oe(e);return null===n||null===t||0===t?0:Math.min(100,Math.round(n/t*100))},Ge=(0,r.EW)(()=>{const e=p.value?.社交?.关系;if(!e||"object"!=typeof e)return{total:0,valid:0,invalid:0,list:[]};const n=Object.entries(e).filter(([e])=>!e.startsWith("_")),t=n.length,a=[];let r=0;for(const[e,t]of n){if(!t||"object"!=typeof t){r+=1;continue}const n=t,o="string"==typeof n.名字?n.名字.trim():"",i="string"==typeof e?e.trim():"",s=o||i;s?a.push({...n,名字:s}):r+=1}return{total:t,valid:a.length,invalid:r,list:a}}),He=(0,r.EW)(()=>{const e=Ge.value.list,n=E.value;return e.filter(e=>e.名字!==n)}),Ve=(0,r.EW)(()=>{let e=[...He.value];if(b.value.trim()){const n=b.value.toLowerCase();e=e.filter(e=>e.名字.toLowerCase().includes(n)||(e.与玩家关系||"").toLowerCase().includes(n))}return e.sort((e,n)=>(n.好感度||0)-(e.好感度||0))}),Qe=e=>`intimacy-${(e=>{const n=e||0;return n>=80?"high":n>=60?"good":n>=40?"medium":n>=20?"low":n>=0?"neutral":n>=-20?"dislike":n>=-40?"hostile":"enemy"})(e)}`,Ke=e=>{const n=g.value?.名字!==e.名字;e&&e.记忆总结&&("string"==typeof e.记忆总结?e.记忆总结=[e.记忆总结]:Array.isArray(e.记忆总结)||(e.记忆总结=[])),g.value=g.value?.名字===e.名字?null:e,n&&g.value&&(Re(),xe.value="basic"),g.value?y.value=!0:y.value=!1};(0,r.wB)(g,e=>{e&&(Re(),Je())}),(0,r.wB)(ze,()=>{Je()}),(0,r.sV)(async()=>{console.log("[人脉系统] 人物关系面板已载入，开始同步数据"),m.value=!0;try{Ve.value.length>0&&(g.value=Ve.value[0])}catch(e){console.error("[人脉系统] 同步数据失败:",e),f.showToast("人脉数据同步失败",{type:"error"})}finally{m.value=!1}});const Ye=e=>{const n=p.value?.社交?.关系;return n&&Object.keys(n).find(t=>n[t]?.名字===e)||null},Je=()=>{const e=g.value;if(!e||!ze.value)return;const n=Ye(e.名字);if(!n||!d.relationships?.[n])return;const t=ze.value,a=d.relationships[n].属性||{},r=e=>e&&"object"==typeof e?{当前:"number"==typeof e.当前?e.当前:null,上限:"number"==typeof e.上限?e.上限:null}:{当前:null,上限:null},o=r(a.生命值),i=r(a.精神力),s=r(a.体力),l=r(a.理智值),c=t.HP.上限,u=t.SP.上限,p=t.ST.上限,v=t.SAN.上限,f=null!=o.当前?Math.min(o.当前,c):t.HP.当前,h=null!=i.当前?Math.min(i.当前,u):t.SP.当前,m=null!=s.当前?Math.min(s.当前,p):t.ST.当前,b=null!=l.当前?Math.min(l.当前,v):t.SAN.当前,y={...a||{},生命值:{当前:f,上限:c},精神力:{当前:h,上限:u},体力:{当前:m,上限:p},理智值:{当前:b,上限:v},寿命上限:"number"==typeof a?.寿命上限?a.寿命上限:a?.寿命?.上限??0,物理攻击力:t.physAtk,物理防御力:t.physDef,特殊攻击力:t.specAtk,特殊防御力:t.specDef};(o.上限!==c||i.上限!==u||s.上限!==p||l.上限!==v||o.当前!==f||i.当前!==h||s.当前!==m||l.当前!==b||a?.物理攻击力!==y.物理攻击力||a?.物理防御力!==y.物理防御力||a?.特殊攻击力!==y.特殊攻击力||a?.特殊防御力!==y.特殊防御力)&&(d.updateRelationship(n,{属性:y}),g.value={...d.relationships?.[n]})},Ze=e=>{const n=e.背包?.物品;return!!n&&Object.keys(n).length>0},en=e=>e.实时关注||!1,nn=async()=>{if(!g.value)return;const e=g.value.名字;we.value=!0;try{const n=g.value.记忆||[];if(n.length<3)return void f.showToast("至少需要3条记忆才能进行总结",{type:"warning"});const a=Math.min(Math.max(3,_e.value||10),n.length),r=n.slice(0,a),o=n.slice(a),i=r.map((e,n)=>`${n+1}. ${e}`).join("\n"),s=function(e){if(!e)return{};const n=(0,HD.cloneDeep)(e);return n.系统?.历史?.叙事&&delete n.系统.历史.叙事,n.社交?.记忆&&(delete n.社交.记忆.短期记忆,delete n.社交.记忆.隐式中期记忆),n}(d.toSaveData()),l=JSON.stringify(s,null,2),c=`这是一个纯粹的文本总结任务，不是游戏对话。请严格按照以下记忆内容进行总结，不要编造新内容。\n\n【待总结的记忆内容】：\n${i}\n\n现在请严格根据上述记忆内容进行总结，不要偏离。游戏存档数据仅供参考，帮助你理解背景。`;f.showToast("正在调用AI总结记忆...",{type:"info"});const u=(await Promise.resolve().then(t.bind(t,8651))).getTavernHelper();if(!u)throw new Error("TavernHelper 未初始化");let p,v,h=!0,m=!1;try{const e=localStorage.getItem("memory-settings");if(e){const n=JSON.parse(e);h=!1!==n.useRawMode,m=!0===n.useStreaming}}catch(e){console.warn("[NPC记忆总结] 读取配置失败，使用默认值:",e)}if(console.log(`[NPC记忆总结] ${e} - 模式: ${h?"Raw模式（纯净总结）":"标准模式（推荐）"}, 传输: ${m?"流式":"非流式"}`),h){const n=await u.generateRaw({ordered_prompts:[{role:"system",content:`你是${e}的记忆总结助手。这是一个纯文本总结任务，不是游戏对话或故事续写。`},{role:"system",content:`【游戏存档数据】（供参考）：\n${l}`},{role:"system",content:"【关键约束】：\n1. 这不是游戏推进，不要生成新剧情\n2. 这不是对话任务，不要生成角色对话\n3. 只总结用户提供的记忆内容，不要编造\n4. 必须严格基于原文，不要添加原文没有的内容"},{role:"system",content:'【输出格式】：\n```json\n{"text": "总结内容"}\n```'},{role:"system",content:`【总结要求】：\n- 第一人称"我"（${e}的视角）\n- 150-250字\n- 连贯的现代修仙小说叙述风格\n- 仅输出JSON，不要thinking/commands/options`},{role:"system",content:"【必须保留】：\n- 原文中的人名（特别是玩家名字）\n- 原文中的地名\n- 原文中的事件\n- 原文中的物品交换\n- 原文中的情感变化"},{role:"system",content:"【必须忽略】：\n- 对话内容\n- 详细情绪描写\n- 过程细节"},{role:"system",content:'【示例】：\n原文："青云峰遇千夜。他帮我击退魔修。我很感激。他送我聚气丹。我们成为朋友。三天后藏经阁再遇。他求教剑法。我教他基础剑诀。"\n正确："三日前我在青云峰遇到了千夜，当时有魔修来袭，千夜出手相助，我才得以脱险。我很感激他的恩德，于是我们结为道友。千夜还赠予我一枚聚气丹，我们的情谊更加深厚。后来在藏经阁重逢，千夜向我求教剑法，我便传授了他基础剑诀。"\n错误："我继续修炼，又遇到了新的机缘..."（❌ 编造了原文没有的内容）'},{role:"system",content:"【重要提醒】：\n- 不要把这当成游戏对话\n- 不要推进故事\n- 不要编造新内容\n- 严格基于用户提供的记忆进行总结"},{role:"user",content:c},{role:"user",content:["Continue.","Proceed.","Next.","Go on.","Resume."][Math.floor(5*Math.random())]},{role:"assistant",content:"</input>"}],should_stream:m,usageType:"memory_summary"});p=String(n)}else{const n=`你是${e}的记忆总结助手。这是一个纯文本总结任务，不是游戏对话或故事续写。\n\n【游戏存档数据】（供参考）：\n${l}\n\n【关键约束】：\n1. 这不是游戏推进，不要生成新剧情\n2. 这不是对话任务，不要生成角色对话\n3. 只总结用户提供的记忆内容，不要编造\n4. 必须严格基于原文，不要添加原文没有的内容\n\n【输出格式】：\n\`\`\`json\n{"text": "总结内容"}\n\`\`\`\n\n【总结要求】：\n- 第一人称"我"（${e}的视角）\n- 150-250字\n- 连贯的现代修仙小说叙述风格\n- 仅输出JSON，不要thinking/commands/options\n\n【必须保留】：\n- 原文中的人名（特别是玩家名字）\n- 原文中的地名\n- 原文中的事件\n- 原文中的物品交换\n- 原文中的情感变化\n\n【必须忽略】：\n- 对话内容\n- 详细情绪描写\n- 过程细节\n\n【示例】：\n原文："青云峰遇千夜。他帮我击退魔修。我很感激。他送我聚气丹。我们成为朋友。三天后藏经阁再遇。他求教剑法。我教他基础剑诀。"\n正确："三日前我在青云峰遇到了千夜，当时有魔修来袭，千夜出手相助，我才得以脱险。我很感激他的恩德，于是我们结为道友。千夜还赠予我一枚聚气丹，我们的情谊更加深厚。后来在藏经阁重逢，千夜向我求教剑法，我便传授了他基础剑诀。"\n错误："我继续修炼，又遇到了新的机缘..."（❌ 编造了原文没有的内容）\n\n【重要提醒】：\n- 不要把这当成游戏对话\n- 不要推进故事\n- 不要编造新内容\n- 严格基于用户提供的记忆进行总结`,t=await u.generate({user_input:c,should_stream:m,generation_id:`npc_memory_summary_${e}_${Date.now()}`,usageType:"memory_summary",injects:[{content:n,role:"system",depth:4,position:"in_chat"},{content:"</input>",role:"assistant",depth:0,position:"in_chat"}]});p=String(t)}const b=String(p).replace(/<\/input>/g,"").trim(),y=b.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(y?.[1]){const e=y[1].trim();try{v=JSON.parse(e).text?.trim()||""}catch{const n=e.match(/"text"\s*:\s*"([\s\S]*?)"\s*[},]/);if(n?.[1])try{v=JSON.parse('"'+n[1].replace(/"/g,'\\"')+'"').trim()}catch{v=n[1].trim()}else v=e}}else try{v=JSON.parse(b).text?.trim()||""}catch{v=b.trim()}if(!v||0===v.length)throw new Error("AI返回了空的总结结果");const x=d.getCurrentSaveData(),k=x?.社交?.关系;if(!k)throw new Error("社交.关系 数据不存在");const w=Object.keys(k).find(n=>k[n]?.名字===e);if(!w)throw new Error(`找不到名为 ${e} 的人物`);const _=k[w];_.记忆总结||(_.记忆总结=[]),_.记忆总结.push(v.trim()),_.记忆=o,d.relationships&&d.relationships[w]&&(d.relationships[w]={..._}),await d.saveGame(),g.value?.名字===e&&(g.value={..._}),f.showToast(`✅ 已成功总结 ${a} 条记忆`,{type:"success"})}catch(e){const n=e instanceof Error?e.message:"未知错误";f.showToast(`总结失败: ${n}`,{type:"error"}),console.error("[RelationshipNetworkPanel] 记忆总结失败:",e)}finally{we.value=!1}},tn=()=>{if(g.value)try{const e=g.value.名字,n={人物名称:e,导出时间:(new Date).toLocaleString("zh-CN"),详细记忆:g.value.记忆||[],记忆总结:g.value.记忆总结||[],记忆总数:(g.value.记忆?.length||0)+(g.value.记忆总结?.length||0)},t=new Blob([JSON.stringify(n,null,2)],{type:"application/json;charset=utf-8"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`${e}_记忆_${Date.now()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),f.showToast(`✅ 已下载 ${e} 的记忆`,{type:"success"})}catch(e){console.error("[下载记忆] 失败:",e),f.showToast("下载记忆失败",{type:"error"})}else f.showToast("未选择人物",{type:"warning"})},an=()=>{if(g.value)try{const e=g.value.名字,n={导出信息:{人物名称:e,导出时间:(new Date).toLocaleString("zh-CN"),数据版本:"1.0"},人物数据:g.value},t=new Blob([JSON.stringify(n,null,2)],{type:"application/json;charset=utf-8"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`${e}_完整数据_${Date.now()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),f.showToast(`✅ 已下载 ${e} 的完整数据`,{type:"success"})}catch(e){console.error("[下载人物数据] 失败:",e),f.showToast("下载人物数据失败",{type:"error"})}else f.showToast("未选择人物",{type:"warning"})},rn=async()=>{if(g.value)try{const e=g.value,n=e.名字,a=(await Promise.resolve().then(t.bind(t,8651))).getTavernHelper();if(!a)return void f.showToast("世界书助手未初始化或不可用",{type:"error"});const r=await a.getLorebooks(),o="仙途_人物";r.includes(o)||await a.createLorebook(o);let i=`# ${n}\n\n`;if(i+="**基础档案**\n",i+=`- 性别：${e.性别||"未知"}\n`,i+=`- 种族：${e.种族||"未知"}\n`,e.出生日期){const n=e.出生日期;i+=`- 出生日期：${n.年}年${n.月}月${n.日}日\n`}if(i+=`- 觉醒阶段：${Me(e)}\n`,e.势力归属&&(i+=`- 势力：${e.势力归属}\n`),e.出生&&(i+=`- 出生地：${Pe(e.出生)}\n`),e.当前位置?.描述&&(i+=`- 当前位置：${e.当前位置.描述}\n`),i+="\n**外貌与性格**\n",i+=`${e.外貌描述||e.外貌||"未描述"}\n`,e.性格特征&&Array.isArray(e.性格特征)&&e.性格特征.length>0?i+=`\n**性格特征**\n${e.性格特征.map(e=>`- ${e}`).join("\n")}\n`:e.性格&&(i+=`\n**性格特点**\n${e.性格}\n`),e.天赋&&Array.isArray(e.天赋)&&e.天赋.length>0&&(i+=`\n**天赋能力**\n${e.天赋.map(e=>`- ${on(e)}${sn(e)?": "+sn(e):""}`).join("\n")}\n`),e.先天属性&&(i+="\n**先天属性**\n",i+=`- 力量：${e.先天属性.力量||0}\n`,i+=`- 敏捷：${e.先天属性.敏捷||0}\n`,i+=`- 体质：${e.先天属性.体质||0}\n`,i+=`- 意志：${e.先天属性.意志||0}\n`,i+=`- 魅力：${e.先天属性.魅力||0}\n`,i+=`- 幸运：${e.先天属性.幸运||0}\n`),e.人格底线&&Array.isArray(e.人格底线)&&e.人格底线.length>0?i+=`\n**人格底线**\n${e.人格底线.map(e=>`- ${e}`).join("\n")}\n`:e.人格底线&&"string"==typeof e.人格底线&&(i+=`\n**人格底线**\n${e.人格底线}\n`),i+="\n**当前状态（实时）**\n",e.当前外貌状态&&(i+=`- 外貌状态：${e.当前外貌状态}\n`),e.当前内心想法&&(i+=`- 内心想法：${e.当前内心想法}\n`),e.背包?.物品&&Object.keys(e.背包.物品).length>0&&(i+="\n**背包物品**\n",Object.values(e.背包.物品).forEach(e=>{i+=`- ${e.名称}`,e.数量>1&&(i+=` x${e.数量}`),e.描述&&(i+=`：${e.描述}`),i+="\n"})),e.背包?.突变结晶){const n=e.背包.突变结晶;(n.下级||0)+(n.中级||0)+(n.上级||0)+(n.顶级||0)>0&&(i+="\n**突变结晶**\n",n.下级&&(i+=`- 下级：${n.下级}\n`),n.中级&&(i+=`- 中级：${n.中级}\n`),n.上级&&(i+=`- 上级：${n.上级}\n`),n.顶级&&(i+=`- 顶级：${n.顶级}\n`))}i+="\n**与玩家关系**\n",i+=`- 关系：${e.与玩家关系||"相识"}\n`,i+=`- 好感度：${e.好感度||0}\n`,e.实时关注&&(i+="- 实时关注：已启用（AI会主动更新此人物状态）\n");const s={name:n,enabled:!0,strategy:{type:"selective",keys:[n,e.种族||"",e.势力归属||""].filter(Boolean),keys_secondary:{logic:"and_any",keys:[]},scan_depth:"same_as_global"},position:{type:"after_character_definition",role:"system",depth:4,order:100},content:i,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{来源:"仙途",导出时间:(new Date).toLocaleString("zh-CN"),人物ID:n}};await a.createLorebookEntries(o,[s]),f.showToast(`✅ 已将 ${n} 添加到世界书「${o}」`,{type:"success"})}catch(e){console.error("[导出世界书] 失败:",e);const n=e instanceof Error?e.message:"未知错误";f.showToast(`导出世界书失败: ${n}`,{type:"error"})}else f.showToast("未选择人物",{type:"warning"})},on=e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e){const n=e;return String(n["名称"]||n.name||"未知天赋")}return"未知天赋"},sn=e=>{if("string"==typeof e)return"";if("object"==typeof e&&null!==e){const n=e;return String(n["描述"]||n.description||"")}return""},ln=e=>{e&&f.showRetryDialog({title:"删除人物",message:`你确定要从这个世界中永久删除【${e.名字}】吗？此操作无法撤销，所有与该人物相关的数据都将消失。`,confirmText:"确认删除",cancelText:"取消",onConfirm:async()=>{const n=e.名字,t=g.value?.名字===n;t&&(g.value=null,y.value=!1);try{await h.deleteNpc(n)}catch(e){const a=e instanceof Error?e.message:"未知错误";if(f.showToast(`删除失败: ${a}`,{type:"error"}),console.error("删除NPC失败:",e),t){const e=He.value.find(e=>e.名字===n);e&&(g.value=e,y.value=!0)}}},onCancel:()=>{}})};return(e,t)=>((0,r.uX)(),(0,r.CE)("div",VD,[(0,r.Lk)("div",QD,[(0,r.Lk)("div",KD,[(0,r.Lk)("button",{class:(0,o.C4)(["view-tab",{active:"list"===x.value}]),onClick:t[0]||(t[0]=e=>x.value="list")},"列表",2),(0,r.Lk)("button",{class:(0,o.C4)(["view-tab",{active:"graph"===x.value}]),onClick:t[1]||(t[1]=e=>x.value="graph")},"关系网",2),"graph"===x.value?((0,r.uX)(),(0,r.CE)("span",YD,[t[14]||(t[14]=(0,r.eW)(" 滚轮缩放，拖拽平移，点击节点进入详情 ",-1)),(0,r.Lk)("span",JD,"边 "+(0,o.v_)(R.value.length),1),M.value?((0,r.uX)(),(0,r.CE)("span",ZD,"推断")):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 人物关系列表 "),"list"===x.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,o.C4)(["relationships-container",{"details-active":y.value}])},[(0,r.Q3)(" 左侧：人物列表 "),(0,r.Lk)("div",ez,[(0,r.Lk)("div",nz,[t[15]||(t[15]=(0,r.Lk)("h3",{class:"panel-title"},"人物关系",-1)),(0,r.Lk)("div",tz,[(0,r.bF)((0,i.R1)(qc),{size:16}),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>b.value=e),placeholder:"搜索人物...",class:"search-input"},null,512),[[s.Jo,b.value]])])]),(0,r.Lk)("div",az,[m.value?((0,r.uX)(),(0,r.CE)("div",rz,[(0,r.bF)((0,i.R1)(Oc),{size:32,class:"animate-spin"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(u)("正在读取人际关系...")),1)])):0===Ve.value.length?((0,r.uX)(),(0,r.CE)("div",oz,[(0,r.bF)((0,i.R1)(vp),{size:48,class:"empty-icon"}),(0,r.Lk)("p",iz,(0,o.v_)(Ge.value.total>0?"人物关系数据不完整或未能解析":(0,i.R1)(u)("尚未建立人际关系")),1),Ge.value.total>0?((0,r.uX)(),(0,r.CE)("p",sz," 已检测到 "+(0,o.v_)(Ge.value.total)+" 条关系记录，但有效NPC为 0；建议继续进行一回合以触发数据修复，或在「调试信息」里执行同步/强制刷新。 ",1)):((0,r.uX)(),(0,r.CE)("p",lz,(0,o.v_)((0,i.R1)(u)("在游戏中与更多人物互动建立关系")),1))])):((0,r.uX)(),(0,r.CE)("div",cz,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Ve.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.名字,class:(0,o.C4)(["person-card",{selected:g.value?.名字===e.名字}]),onClick:n=>Ke(e)},[(0,r.Lk)("div",uz,[(0,r.Lk)("span",pz,(0,o.v_)(e.名字.charAt(0)),1)]),(0,r.Lk)("div",vz,[(0,r.Lk)("div",fz,(0,o.v_)(e.名字),1),(0,r.Lk)("div",hz,[(0,r.Lk)("span",mz,(0,o.v_)(e.与玩家关系||"相识"),1),(0,r.Lk)("div",{class:"card-actions",onClick:t[3]||(t[3]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("button",{class:"attention-toggle",onClick:(0,s.D$)(n=>(async e=>{console.log("[关注按钮] 点击了关注按钮，人物:",e.名字);const n=e.名字;try{const e=d.relationships;if(!e)return void f.showToast("人物关系数据不存在",{type:"error"});const t=Object.keys(e).find(t=>e[t]?.名字===n);if(!t)return void f.showToast(`找不到名为 ${n} 的人物`,{type:"error"});const a=e[t],r=!a.实时关注;a.实时关注=r,console.log("[关注按钮] 切换状态:",r,"保存前的数据:",a.实时关注),await d.saveGame(),console.log("[关注按钮] 保存完成"),f.showToast(r?`已关注 ${n}`:`已取消关注 ${n}`,{type:"success"}),g.value?.名字===n&&(g.value={...e[t]})}catch(e){const n=e instanceof Error?e.message:"未知错误";f.showToast(`操作失败: ${n}`,{type:"error"}),console.error("[关注按钮] 错误:",e)}})(e),["stop"]),title:en(e)?"取消关注":"添加关注"},[en(e)?((0,r.uX)(),(0,r.Wv)((0,i.R1)(XD),{key:0,size:14,class:"attention-icon active"})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(UD),{key:1,size:14,class:"attention-icon inactive"}))],8,gz),(0,r.Lk)("button",{onClick:(0,s.D$)(n=>ln(e),["stop"]),class:"delete-btn-card",title:"删除人物"},[(0,r.bF)((0,i.R1)(ba.A),{size:14})],8,bz)])]),"未知"!==Me(e)?((0,r.uX)(),(0,r.CE)("div",yz,[t[16]||(t[16]=(0,r.Lk)("span",{class:"realm-label"},"觉醒阶段:",-1)),(0,r.Lk)("span",xz,(0,o.v_)(Me(e)),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",kz,[(0,r.Lk)("div",wz,[(0,r.Lk)("div",{class:(0,o.C4)(["intimacy-fill",Qe(e.好感度)]),style:(0,o.Tr)({width:Math.max(5,Math.abs(e.好感度||0))+"%"})},null,6)]),(0,r.Lk)("span",_z,(0,o.v_)(e.好感度||0),1)])]),(0,r.bF)((0,i.R1)(Yc),{size:16,class:"arrow-icon"})],10,dz))),128))]))])]),(0,r.Q3)(" 右侧：人物详情 "),(0,r.Lk)("div",Cz,[g.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Q3)(" 详情头部 "),(0,r.Lk)("div",Az,[(0,r.Lk)("button",{onClick:t[4]||(t[4]=e=>y.value=!1),class:"back-to-list-btn"},[(0,r.bF)((0,i.R1)(Xc),{size:20})]),(0,r.Lk)("div",Sz,[(0,r.Lk)("span",Lz,(0,o.v_)(g.value.名字.charAt(0)),1)]),(0,r.Lk)("div",Ez,[(0,r.Lk)("div",Tz,[(0,r.Lk)("h3",Iz,(0,o.v_)(g.value.名字),1),(0,r.Lk)("div",Rz,[(0,r.Lk)("button",{onClick:an,class:"action-btn download-btn",title:"下载完整人物数据"},[(0,r.bF)((0,i.R1)(Vc.A),{size:16})]),(0,r.Lk)("button",{onClick:rn,class:"action-btn export-btn",title:"导出到世界书（不含记忆）"},[(0,r.bF)((0,i.R1)(Qu.A),{size:16})]),g.value?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[5]||(t[5]=(0,s.D$)(e=>ln(g.value),["stop"])),class:"delete-npc-btn",title:"删除此人物"},[(0,r.bF)((0,i.R1)(ba.A),{size:16})])):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",Mz,[(0,r.Lk)("span",Pz,(0,o.v_)(g.value.与玩家关系||"相识"),1),(0,r.Lk)("span",{class:(0,o.C4)(["intimacy-badge",Qe(g.value.好感度)])}," 好感 "+(0,o.v_)(g.value.好感度||0),3),(0,r.Lk)("span",Dz,(0,o.v_)(g.value.种族||"人族"),1),g.value.势力归属?((0,r.uX)(),(0,r.CE)("span",zz,(0,o.v_)(g.value.势力归属),1)):(0,r.Q3)("v-if",!0)])])]),(0,r.Q3)(" 详情主体 "),(0,r.Lk)("div",Nz,[(0,r.Q3)(" 选项卡导航 "),(0,r.Lk)("div",$z,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ke.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.id,class:(0,o.C4)(["tab-btn",{active:xe.value===e.id}]),onClick:n=>xe.value=e.id},(0,o.v_)(e.icon)+" "+(0,o.v_)(e.label),11,Oz))),128))]),(0,r.Q3)(" 选项卡内容 "),(0,r.Lk)("div",Fz,[(0,r.Q3)(" Tab 1: 基本信息 "),(0,r.bo)((0,r.Lk)("div",jz,[(0,r.Q3)(" 基础档案 "),(0,r.Lk)("div",Bz,[t[22]||(t[22]=(0,r.Lk)("h5",{class:"section-title"},"📋 基本信息",-1)),(0,r.Lk)("div",Xz,[(0,r.Lk)("div",Uz,[t[17]||(t[17]=(0,r.Lk)("span",{class:"info-label"},"觉醒阶段",-1)),(0,r.Lk)("span",Wz,(0,o.v_)(Me(g.value)),1)]),(0,r.Lk)("div",qz,[t[18]||(t[18]=(0,r.Lk)("span",{class:"info-label"},"性别",-1)),(0,r.Lk)("span",Gz,(0,o.v_)(g.value.性别||"未知"),1)]),(0,r.Lk)("div",Hz,[t[19]||(t[19]=(0,r.Lk)("span",{class:"info-label"},"年龄",-1)),(0,r.Lk)("span",Vz,(0,o.v_)(Be(g.value)),1)]),g.value.当前位置?((0,r.uX)(),(0,r.CE)("div",Qz,[t[20]||(t[20]=(0,r.Lk)("span",{class:"info-label"},"位置",-1)),(0,r.Lk)("span",Kz,(0,o.v_)(g.value.当前位置.描述),1)])):(0,r.Q3)("v-if",!0),g.value.出生?((0,r.uX)(),(0,r.CE)("div",Yz,[t[21]||(t[21]=(0,r.Lk)("span",{class:"info-label"},"出生",-1)),(0,r.Lk)("span",Jz,(0,o.v_)(Pe(g.value.出生)),1)])):(0,r.Q3)("v-if",!0)])]),(0,r.Q3)(" 核心数值 "),Fe(g.value)?((0,r.uX)(),(0,r.CE)("div",Zz,[t[28]||(t[28]=(0,r.Lk)("h5",{class:"section-title"},"核心数值",-1)),(0,r.Lk)("div",eN,[(0,r.Lk)("div",nN,[(0,r.Lk)("div",tN,[t[23]||(t[23]=(0,r.Lk)("span",{class:"npc-vital-name"},"生命值",-1)),(0,r.Lk)("span",aN,(0,o.v_)($e(g.value,"生命值")),1)]),(0,r.Lk)("div",rN,[(0,r.Lk)("div",{class:"npc-vital-bar red-bar",style:(0,o.Tr)({width:We(g.value,"生命值")+"%"})},null,4)])]),(0,r.Lk)("div",oN,[(0,r.Lk)("div",iN,[t[24]||(t[24]=(0,r.Lk)("span",{class:"npc-vital-name"},"精神力",-1)),(0,r.Lk)("span",sN,(0,o.v_)($e(g.value,"精神力")),1)]),(0,r.Lk)("div",lN,[(0,r.Lk)("div",{class:"npc-vital-bar blue-bar",style:(0,o.Tr)({width:We(g.value,"精神力")+"%"})},null,4)])]),(0,r.Lk)("div",cN,[(0,r.Lk)("div",dN,[t[25]||(t[25]=(0,r.Lk)("span",{class:"npc-vital-name"},"理智值",-1)),(0,r.Lk)("span",uN,(0,o.v_)($e(g.value,"理智值")),1)]),(0,r.Lk)("div",pN,[(0,r.Lk)("div",{class:"npc-vital-bar gold-bar",style:(0,o.Tr)({width:We(g.value,"理智值")+"%"})},null,4)])]),(0,r.Lk)("div",vN,[(0,r.Lk)("div",fN,[t[26]||(t[26]=(0,r.Lk)("span",{class:"npc-vital-name"},"体力",-1)),(0,r.Lk)("span",hN,(0,o.v_)($e(g.value,"体力")),1)]),(0,r.Lk)("div",mN,[(0,r.Lk)("div",{class:"npc-vital-bar green-bar",style:(0,o.Tr)({width:We(g.value,"体力")+"%"})},null,4)])]),(0,r.Lk)("div",gN,[(0,r.Lk)("div",bN,[t[27]||(t[27]=(0,r.Lk)("span",{class:"npc-vital-name"},"寿元",-1)),(0,r.Lk)("span",yN,(0,o.v_)(Ue(g.value)),1)]),(0,r.Lk)("div",xN,[(0,r.Lk)("div",{class:"npc-vital-bar purple-bar",style:(0,o.Tr)({width:qe(g.value)+"%"})},null,4)])])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 战斗属性 "),ze.value?((0,r.uX)(),(0,r.CE)("div",kN,[t[33]||(t[33]=(0,r.Lk)("h5",{class:"section-title"},"战斗属性",-1)),(0,r.Lk)("div",wN,[(0,r.Lk)("div",_N,[t[29]||(t[29]=(0,r.Lk)("span",{class:"attr-label"},"物理攻击",-1)),(0,r.Lk)("span",CN,(0,o.v_)(ze.value.physAtk),1)]),(0,r.Lk)("div",AN,[t[30]||(t[30]=(0,r.Lk)("span",{class:"attr-label"},"特殊攻击",-1)),(0,r.Lk)("span",SN,(0,o.v_)(ze.value.specAtk),1)]),(0,r.Lk)("div",LN,[t[31]||(t[31]=(0,r.Lk)("span",{class:"attr-label"},"物理防御",-1)),(0,r.Lk)("span",EN,(0,o.v_)(ze.value.physDef),1)]),(0,r.Lk)("div",TN,[t[32]||(t[32]=(0,r.Lk)("span",{class:"attr-label"},"特殊防御",-1)),(0,r.Lk)("span",IN,(0,o.v_)(ze.value.specDef),1)])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 外貌与性格 "),g.value.外貌描述||g.value.性格特征?.length?((0,r.uX)(),(0,r.CE)("div",RN,[t[34]||(t[34]=(0,r.Lk)("h5",{class:"section-title"},"外貌与性格",-1)),g.value.外貌描述?((0,r.uX)(),(0,r.CE)("div",MN,[(0,r.Lk)("p",PN,(0,o.v_)(g.value.外貌描述),1)])):(0,r.Q3)("v-if",!0),g.value.性格特征?.length?((0,r.uX)(),(0,r.CE)("div",DN,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value.性格特征,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"talent-tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 天赋与属性 "),g.value.天赋?.length||g.value.先天属性?((0,r.uX)(),(0,r.CE)("div",zN,[t[43]||(t[43]=(0,r.Lk)("h5",{class:"section-title"},"天赋与属性",-1)),g.value.天赋?.length?((0,r.uX)(),(0,r.CE)("div",NN,[t[35]||(t[35]=(0,r.Lk)("h6",{class:"subsection-title"},"天赋能力",-1)),(0,r.Lk)("div",$N,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value.天赋,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:n,class:"talent-tag",onClick:n=>(e=>{const n=on(e),t=sn(e);t&&f.showDetailModal({title:n,content:t})})(e),style:{cursor:"pointer"}},(0,o.v_)(on(e)),9,ON))),128))])])):(0,r.Q3)("v-if",!0),g.value.先天属性?((0,r.uX)(),(0,r.CE)("div",FN,[t[42]||(t[42]=(0,r.Lk)("h6",{class:"subsection-title"},"先天属性",-1)),(0,r.Lk)("div",jN,[(0,r.Lk)("div",BN,[t[36]||(t[36]=(0,r.Lk)("span",{class:"attr-label"},"力量",-1)),(0,r.Lk)("span",XN,(0,o.v_)(g.value.先天属性.力量||0),1)]),(0,r.Lk)("div",UN,[t[37]||(t[37]=(0,r.Lk)("span",{class:"attr-label"},"敏捷",-1)),(0,r.Lk)("span",WN,(0,o.v_)(g.value.先天属性.敏捷||0),1)]),(0,r.Lk)("div",qN,[t[38]||(t[38]=(0,r.Lk)("span",{class:"attr-label"},"体质",-1)),(0,r.Lk)("span",GN,(0,o.v_)(g.value.先天属性.体质||0),1)]),(0,r.Lk)("div",HN,[t[39]||(t[39]=(0,r.Lk)("span",{class:"attr-label"},"意志",-1)),(0,r.Lk)("span",VN,(0,o.v_)(g.value.先天属性.意志||0),1)]),(0,r.Lk)("div",QN,[t[40]||(t[40]=(0,r.Lk)("span",{class:"attr-label"},"魅力",-1)),(0,r.Lk)("span",KN,(0,o.v_)(g.value.先天属性.魅力||0),1)]),(0,r.Lk)("div",YN,[t[41]||(t[41]=(0,r.Lk)("span",{class:"attr-label"},"幸运",-1)),(0,r.Lk)("span",JN,(0,o.v_)(g.value.先天属性.幸运||0),1)])])])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 最近记忆 "),je(g.value).length>0?((0,r.uX)(),(0,r.CE)("div",ZN,[t[44]||(t[44]=(0,r.Lk)("h5",{class:"section-title"},"📝 最近记忆",-1)),(0,r.Lk)("div",e$,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(je(g.value),(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"npc-memory-item"},[(0,r.Lk)("div",n$,(0,o.v_)(e),1)]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 人格底线（所有NPC都有）"),(0,r.Lk)("div",t$,[t[45]||(t[45]=(0,r.Lk)("h5",{class:"section-title"},"⚠️ 人格底线",-1)),(0,r.Lk)("div",a$,[g.value.人格底线?.length?((0,r.uX)(),(0,r.CE)("div",r$,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value.人格底线,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:n,class:"bottomline-tag"},(0,o.v_)(e),1))),128))])):((0,r.uX)(),(0,r.CE)("div",o$,"未记录人格底线"))]),t[46]||(t[46]=(0,r.Lk)("div",{class:"bottomline-warning"},[(0,r.Lk)("span",{class:"warning-icon"},"⚡"),(0,r.Lk)("span",{class:"warning-text"},"触犯人格底线将导致好感度断崖式下跌（-30 ~ -60），关系破裂且极难修复")],-1))])],512),[[s.aG,"basic"===xe.value]]),(0,r.Q3)(" Tab 2: 实时状态 "),(0,r.bo)((0,r.Lk)("div",i$,[(0,r.Lk)("div",s$,[t[51]||(t[51]=(0,r.Lk)("h5",{class:"section-title"},"💭 当前状态（实时）",-1)),(0,r.Lk)("div",l$,[(0,r.Lk)("div",c$,[t[48]||(t[48]=(0,r.Lk)("span",{class:"status-icon"},"😶",-1)),(0,r.Lk)("div",d$,[t[47]||(t[47]=(0,r.Lk)("div",{class:"status-label"},"外貌状态",-1)),(0,r.Lk)("div",u$,(0,o.v_)(g.value.当前外貌状态||"神态自然，衣衫整洁"),1)])]),(0,r.Lk)("div",p$,[t[50]||(t[50]=(0,r.Lk)("span",{class:"status-icon"},"💭",-1)),(0,r.Lk)("div",v$,[t[49]||(t[49]=(0,r.Lk)("div",{class:"status-label"},"内心想法",-1)),(0,r.Lk)("div",f$,(0,o.v_)(g.value.当前内心想法||"心如止水，平静无波"),1)])])])])],512),[[s.aG,"status"===xe.value]]),(0,r.Q3)(" Tab: 异能 "),(0,r.bo)((0,r.Lk)("div",h$,[(0,r.Lk)("div",m$,[t[53]||(t[53]=(0,r.Lk)("h5",{class:"section-title"},"异能详情",-1)),g.value.异能名称?((0,r.uX)(),(0,r.CE)("div",g$,[(0,r.Lk)("div",b$,[(0,r.Lk)("span",y$,(0,o.v_)(g.value.异能名称),1),(0,r.Lk)("span",x$,(0,o.v_)(g.value.异能类型||"未知类型"),1)]),(0,r.Lk)("div",k$,[(0,r.Lk)("div",w$,(0,o.v_)(g.value.异能描述||"暂无描述"),1),g.value.异能代价?((0,r.uX)(),(0,r.CE)("div",_$,[t[52]||(t[52]=(0,r.Lk)("span",{class:"cost-label"},"代价:",-1)),(0,r.Lk)("span",C$,(0,o.v_)(g.value.异能代价),1)])):(0,r.Q3)("v-if",!0)])])):((0,r.uX)(),(0,r.CE)("div",A$,"此人尚未觉醒异能"))])],512),[[s.aG,"ability"===xe.value]]),(0,r.Q3)(" Tab: 私密信息 "),(0,r.bo)((0,r.Lk)("div",S$,[(0,r.Lk)("div",L$,[t[75]||(t[75]=(0,r.Lk)("h5",{class:"section-title"},"🔞 私密信息",-1)),ye.value?H.value?((0,r.uX)(),(0,r.CE)("div",T$,[(0,r.Q3)(" 概览 "),(0,r.Lk)("div",I$,[t[63]||(t[63]=(0,r.Lk)("h6",{class:"subsection-title"},"概览",-1)),(0,r.Lk)("div",R$,[(0,r.Lk)("div",M$,[(0,r.Lk)("span",P$,(0,o.v_)((0,i.R1)(u)("贞洁")),1),(0,r.Lk)("span",D$,(0,o.v_)(Q.value),1)]),(0,r.Lk)("div",z$,[(0,r.Lk)("span",N$,(0,o.v_)((0,i.R1)(u)("性别")),1),(0,r.Lk)("span",$$,(0,o.v_)(g.value?.性别?(0,i.R1)(u)(g.value.性别):"—"),1)]),(0,r.Lk)("div",O$,[t[54]||(t[54]=(0,r.Lk)("span",{class:"info-label"},"三围",-1)),(0,r.Lk)("span",F$,(0,o.v_)(V(H.value)),1)]),(0,r.Lk)("div",j$,[t[55]||(t[55]=(0,r.Lk)("span",{class:"info-label"},"性格倾向",-1)),(0,r.Lk)("span",B$,(0,o.v_)(H.value.性格倾向||"无"),1)]),(0,r.Lk)("div",X$,[t[56]||(t[56]=(0,r.Lk)("span",{class:"info-label"},"性取向",-1)),(0,r.Lk)("span",U$,(0,o.v_)(H.value.性取向||"无"),1)]),(0,r.Lk)("div",W$,[t[57]||(t[57]=(0,r.Lk)("span",{class:"info-label"},"性经验等级",-1)),(0,r.Lk)("span",q$,(0,o.v_)(K.value||"无"),1)]),(0,r.Lk)("div",G$,[t[58]||(t[58]=(0,r.Lk)("span",{class:"info-label"},"当前性状态",-1)),(0,r.Lk)("span",H$,(0,o.v_)(H.value.当前性状态||"无"),1)]),(0,r.Lk)("div",V$,[t[59]||(t[59]=(0,r.Lk)("span",{class:"info-label"},"体液分泌状态",-1)),(0,r.Lk)("span",Q$,[(0,r.Lk)("span",{class:(0,o.C4)(["status-badge",`status-${H.value.体液分泌状态||"正常"}`])},(0,o.v_)(H.value.体液分泌状态||"正常"),3)])]),(0,r.Lk)("div",K$,[t[60]||(t[60]=(0,r.Lk)("span",{class:"info-label"},"性交总次数",-1)),(0,r.Lk)("span",Y$,(0,o.v_)(H.value.性交总次数??0),1)])]),ie.value?((0,r.uX)(),(0,r.CE)("div",J$," 尚未有亲密记录 ")):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",Z$,[(0,r.Lk)("div",eO,[(0,r.Lk)("div",nO,[t[61]||(t[61]=(0,r.Lk)("span",{class:"dev-label"},"性渴望程度",-1)),(0,r.Lk)("span",tO,(0,o.v_)(H.value.性渴望程度??0)+"/100",1)]),(0,r.Lk)("div",aO,[(0,r.Lk)("div",{class:"dev-bar-fill desire-fill",style:(0,o.Tr)({width:`${n(H.value.性渴望程度)}%`})},null,4)])])]),ae.value?((0,r.uX)(),(0,r.CE)("div",rO,[t[62]||(t[62]=(0,r.Lk)("span",{class:"last-time-label"},"最近一次：",-1)),(0,r.Lk)("span",oO,(0,o.v_)(ae.value),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 亲密画像 "),Y.value||J.value||Z.value||ee.value?((0,r.uX)(),(0,r.CE)("div",iO,[t[67]||(t[67]=(0,r.Lk)("h6",{class:"subsection-title"},"亲密画像",-1)),(0,r.Lk)("div",sO,[Y.value?((0,r.uX)(),(0,r.CE)("div",lO,[t[64]||(t[64]=(0,r.Lk)("span",{class:"info-label"},"亲密节奏",-1)),(0,r.Lk)("span",cO,(0,o.v_)(Y.value),1)])):(0,r.Q3)("v-if",!0),Z.value?((0,r.uX)(),(0,r.CE)("div",dO,[t[65]||(t[65]=(0,r.Lk)("span",{class:"info-label"},"安全偏好",-1)),(0,r.Lk)("span",uO,(0,o.v_)(Z.value),1)])):(0,r.Q3)("v-if",!0),ee.value?((0,r.uX)(),(0,r.CE)("div",pO,[t[66]||(t[66]=(0,r.Lk)("span",{class:"info-label"},"避孕措施",-1)),(0,r.Lk)("span",vO,(0,o.v_)(ee.value),1)])):(0,r.Q3)("v-if",!0)]),J.value?((0,r.uX)(),(0,r.CE)("div",fO," 亲密需求："+(0,o.v_)(J.value),1)):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 偏好与边界 "),ne.value.length||re.value.length||te.value.length||oe.value.length?((0,r.uX)(),(0,r.CE)("div",hO,[t[68]||(t[68]=(0,r.Lk)("h6",{class:"subsection-title"},"偏好与边界",-1)),ne.value.length?((0,r.uX)(),(0,r.CE)("div",mO,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ne.value,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:`${e}-${n}`,class:"preference-tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),re.value.length?((0,r.uX)(),(0,r.CE)("div",gO,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(re.value,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:`${e}-${n}`,class:"fetish-tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),te.value.length?((0,r.uX)(),(0,r.CE)("div",bO,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(te.value,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:`${e}-${n}`,class:"taboo-tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),oe.value.length?((0,r.uX)(),(0,r.CE)("div",yO,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(oe.value,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:`${e}-${n}`,class:"special-trait-tag"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 生育与妊娠 "),se.value?((0,r.uX)(),(0,r.CE)("div",xO,[(0,r.Lk)("h6",kO,(0,o.v_)(G.value?"生育与妊娠":(0,i.R1)(u)("生育状态")),1),(0,r.Lk)("div",wO,[G.value&&pe.value?((0,r.uX)(),(0,r.CE)("div",_O,[t[69]||(t[69]=(0,r.Lk)("span",{class:"pregnancy-icon"},"🤰",-1)),(0,r.Lk)("div",CO,[(0,r.Lk)("div",null,"当前状态："+(0,o.v_)(ce.value||"已怀孕"),1),null!==de.value?((0,r.uX)(),(0,r.CE)("div",AO,"怀孕月数："+(0,o.v_)(de.value)+"个月",1)):(0,r.Q3)("v-if",!0),ue.value?((0,r.uX)(),(0,r.CE)("div",SO,"预计分娩："+(0,o.v_)(ue.value),1)):(0,r.Q3)("v-if",!0)])])):G.value?((0,r.uX)(),(0,r.CE)("div",LO,(0,o.v_)(ce.value||"未怀孕"),1)):((0,r.uX)(),(0,r.CE)("div",EO,(0,o.v_)(q.value?"不适用（男性）":ce.value||"不适用"),1))]),G.value?((0,r.uX)(),(0,r.CE)("div",TO,[null!==le.value?((0,r.uX)(),(0,r.CE)("div",IO,[t[70]||(t[70]=(0,r.Lk)("span",{class:"info-label"},"是否可孕",-1)),(0,r.Lk)("span",RO,(0,o.v_)(le.value?"是":"否"),1)])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 性伴侣名单 "),fe.value.length?((0,r.uX)(),(0,r.CE)("div",MO,[t[71]||(t[71]=(0,r.Lk)("h6",{class:"subsection-title"},"性伴侣名单",-1)),(0,r.Lk)("div",PO,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(he.value,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:`${e}-${n}`,class:"partner-tag"},(0,o.v_)(e),1))),128))]),fe.value.length>he.value.length?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"toggle-more-btn",onClick:t[6]||(t[6]=e=>ve.value=!0),type:"button"}," 显示全部（"+(0,o.v_)(fe.value.length)+"） ",1)):fe.value.length>10&&ve.value?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"toggle-more-btn",onClick:t[7]||(t[7]=e=>ve.value=!1),type:"button"}," 收起 ")):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 身体部位 "),ge.value.length?((0,r.uX)(),(0,r.CE)("div",DO,[t[74]||(t[74]=(0,r.Lk)("h6",{class:"subsection-title"},"身体部位",-1)),(0,r.Lk)("div",zO,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(be.value,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.部位名称}-${a}`,class:"body-part-item"},[(0,r.Lk)("div",NO,[(0,r.Lk)("span",$O,(0,o.v_)(e.部位名称||`部位${a+1}`),1),e.特殊印记?((0,r.uX)(),(0,r.CE)("span",OO,(0,o.v_)(e.特殊印记),1)):(0,r.Q3)("v-if",!0)]),e.特征描述?((0,r.uX)(),(0,r.CE)("div",FO,(0,o.v_)(e.特征描述),1)):(0,r.Q3)("v-if",!0),e.反应描述?((0,r.uX)(),(0,r.CE)("div",jO," 反应："+(0,o.v_)(e.反应描述),1)):(0,r.Q3)("v-if",!0),e.偏好刺激?((0,r.uX)(),(0,r.CE)("div",BO," 偏好："+(0,o.v_)(e.偏好刺激),1)):(0,r.Q3)("v-if",!0),e.禁忌?((0,r.uX)(),(0,r.CE)("div",XO," 禁忌："+(0,o.v_)(e.禁忌),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",UO,[(0,r.Lk)("div",WO,[t[72]||(t[72]=(0,r.Lk)("span",{class:"stat-label"},"敏感度",-1)),(0,r.Lk)("div",qO,[(0,r.Lk)("div",{class:"stat-bar-fill sensitivity",style:(0,o.Tr)({width:`${n(e.敏感度)}%`})},null,4)]),(0,r.Lk)("span",GO,(0,o.v_)(e.敏感度??0),1)]),(0,r.Lk)("div",HO,[t[73]||(t[73]=(0,r.Lk)("span",{class:"stat-label"},"开发度",-1)),(0,r.Lk)("div",VO,[(0,r.Lk)("div",{class:"stat-bar-fill development",style:(0,o.Tr)({width:`${n(e.开发度)}%`})},null,4)]),(0,r.Lk)("span",QO,(0,o.v_)(e.开发度??0),1)])])]))),128))]),ge.value.length>be.value.length?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"toggle-more-btn",onClick:t[8]||(t[8]=e=>me.value=!0),type:"button"}," 显示全部（"+(0,o.v_)(ge.value.length)+"） ",1)):ge.value.length>6&&me.value?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"toggle-more-btn",onClick:t[9]||(t[9]=e=>me.value=!1),type:"button"}," 收起 ")):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",KO,"暂无私密信息（等待AI生成）")):((0,r.uX)(),(0,r.CE)("div",E$," 成人内容未启用（可在设置面板开启） "))])],512),[[s.aG,"nsfw"===xe.value]]),(0,r.Q3)(" Tab 3: 记忆档案 "),(0,r.bo)((0,r.Lk)("div",YO,[(0,r.Q3)(" 详细记忆区域 "),g.value.记忆?.length?((0,r.uX)(),(0,r.CE)("div",JO,[(0,r.Lk)("div",ZO,[t[76]||(t[76]=(0,r.Lk)("h5",{class:"section-title",style:{border:"none",padding:"0",margin:"0"}}," 📝 详细记忆 ",-1)),(0,r.Lk)("div",eF,[(0,r.Lk)("div",nF,(0,o.v_)(g.value.记忆?.length||0)+" 条",1),(0,r.Lk)("div",tF,[(0,r.Lk)("button",{class:"download-memory-btn",onClick:tn,title:"下载所有记忆"}," 💾 下载记忆 "),(g.value.记忆?.length||0)>=3?((0,r.uX)(),(0,r.CE)("div",aF,[(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=e=>_e.value=e),min:3,max:g.value.记忆?.length||3,class:"summarize-input",placeholder:"条数",title:"从最旧开始总结的记忆条数"},null,8,rF),[[s.Jo,_e.value,void 0,{number:!0}]]),(0,r.Lk)("button",{class:"summarize-btn",onClick:nn,disabled:we.value,title:"总结最旧的记忆"},(0,o.v_)(we.value?"总结中...":"📝 总结"),9,oF)])):(0,r.Q3)("v-if",!0)])])]),(0,r.Q3)(" 总结模式提示 "),t[77]||(t[77]=(0,r.Lk)("div",{class:"summary-mode-hint"},[(0,r.eW)(" ℹ️ 总结模式配置（Raw/标准、流式/非流式）请前往 "),(0,r.Lk)("strong",null,"记忆中心面板"),(0,r.eW)(" → 设置 ")],-1)),(0,r.Lk)("div",iF,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Le.value,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"memory-item"},[(0,r.Lk)("div",sF,[(0,i.R1)(qD)(e)?((0,r.uX)(),(0,r.CE)("div",lF,(0,o.v_)((0,i.R1)(qD)(e)),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",cF,(0,o.v_)((0,i.R1)(GD)(e)),1)]),(0,r.Lk)("div",dF,[(0,r.Lk)("button",{class:"memory-btn edit",onClick:e=>(async e=>{if(!g.value)return;const n=g.value.名字,t=Ye(n);if(!t)return;if(!d.relationships?.[t]?.记忆)return;const a=d.relationships[t].记忆[e];if("string"==typeof a){const n=window.prompt("编辑记忆内容",a);if(null===n||""===n.trim())return;return d.relationships[t].记忆[e]=n.trim(),g.value={...d.relationships[t]},await d.saveGame(),void f.showToast("记忆已更新",{type:"success"})}if(a&&"object"==typeof a){const n=a.时间||"未知时间",r=a.事件||"",o=window.prompt("编辑记忆时间",n);if(null===o)return;const i=window.prompt("编辑记忆事件",r);if(null===i)return;d.relationships[t].记忆[e]={时间:o.trim(),事件:i.trim()},g.value={...d.relationships[t]},await d.saveGame(),f.showToast("记忆已更新",{type:"success"})}})((Ae.value-1)*Ce.value+n)}," 编辑 ",8,uF),(0,r.Lk)("button",{class:"memory-btn delete",onClick:e=>(async e=>{g.value&&f.showRetryDialog({title:"删除记忆",message:"确定要删除这条记忆吗？",confirmText:"删除",cancelText:"取消",onConfirm:async()=>{const n=g.value.名字,t=Ye(n);t&&d.relationships?.[t]?.记忆&&(d.relationships[t].记忆.splice(e,1),g.value={...d.relationships[t]},await d.saveGame(),f.showToast("记忆已删除",{type:"success"}))},onCancel:()=>{}})})((Ae.value-1)*Ce.value+n)}," 删除 ",8,pF)])]))),128))]),Ee.value>1?((0,r.uX)(),(0,r.CE)("div",vF,[(0,r.Lk)("button",{class:"pagination-btn",disabled:Ae.value<=1,onClick:t[11]||(t[11]=e=>Te(Ae.value-1))}," 上一页 ",8,fF),(0,r.Lk)("div",hF,[(0,r.Lk)("span",mF,(0,o.v_)(Ae.value)+" / "+(0,o.v_)(Ee.value),1),(0,r.Lk)("div",gF,[(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>Se.value=e),min:1,max:Ee.value,class:"page-input",placeholder:"页码",onKeyup:(0,s.jR)(Ie,["enter"])},null,40,bF),[[s.Jo,Se.value,void 0,{number:!0}]]),(0,r.Lk)("button",{class:"jump-btn",onClick:Ie},"跳转")])]),(0,r.Lk)("button",{class:"pagination-btn",disabled:Ae.value>=Ee.value,onClick:t[13]||(t[13]=e=>Te(Ae.value+1))}," 下一页 ",8,yF)])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 记忆总结区域 "),g.value.记忆总结?.length?((0,r.uX)(),(0,r.CE)("div",xF,[t[79]||(t[79]=(0,r.Lk)("h5",{class:"section-title"},"📜 记忆总结",-1)),(0,r.Lk)("div",kF,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value.记忆总结,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"memory-summary-item"},[t[78]||(t[78]=(0,r.Lk)("div",{class:"summary-icon"},"📜",-1)),(0,r.Lk)("div",wF,(0,o.v_)(e),1)]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 空状态提示 "),g.value.记忆?.length||g.value.记忆总结?.length?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",_F,[(0,r.Lk)("div",CF,[(0,r.bF)((0,i.R1)(Qu.A),{size:24,class:"empty-icon"}),t[80]||(t[80]=(0,r.Lk)("p",null,"此人暂无记忆",-1)),t[81]||(t[81]=(0,r.Lk)("p",{class:"empty-hint"},"在游戏中与该人物互动会生成记忆",-1))])]))],512),[[s.aG,"memory"===xe.value]]),(0,r.Q3)(" End of Tab 4: 记忆档案 "),(0,r.Q3)(" Tab 5: 背包 "),(0,r.bo)((0,r.Lk)("div",AF,[(0,r.Lk)("div",SF,[t[88]||(t[88]=(0,r.Lk)("h5",{class:"section-title"},"背包",-1)),g.value.背包?.突变结晶?((0,r.uX)(),(0,r.CE)("div",LF,[(0,r.Lk)("div",EF,[t[82]||(t[82]=(0,r.Lk)("span",null,"下级突变结晶",-1)),(0,r.Lk)("span",null,(0,o.v_)(g.value.背包.突变结晶.下级||0),1)]),(0,r.Lk)("div",TF,[t[83]||(t[83]=(0,r.Lk)("span",null,"中级突变结晶",-1)),(0,r.Lk)("span",null,(0,o.v_)(g.value.背包.突变结晶.中级||0),1)]),(0,r.Lk)("div",IF,[t[84]||(t[84]=(0,r.Lk)("span",null,"上级突变结晶",-1)),(0,r.Lk)("span",null,(0,o.v_)(g.value.背包.突变结晶.上级||0),1)]),(0,r.Lk)("div",RF,[t[85]||(t[85]=(0,r.Lk)("span",null,"顶级突变结晶",-1)),(0,r.Lk)("span",null,(0,o.v_)(g.value.背包.突变结晶.顶级||0),1)])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",MF,[Ze(g.value)?((0,r.uX)(),(0,r.CE)("div",PF,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value.背包.物品,(e,n)=>{return(0,r.uX)(),(0,r.CE)("div",{key:n,class:(0,o.C4)(["npc-item-card",(s=e.品质?.quality,s?`quality-${s.toLowerCase()}`:"quality-unknown")])},[(0,r.Lk)("div",DF,[(0,r.Lk)("span",zF,(0,o.v_)(e.名称||n),1),(0,r.Lk)("span",NF,(0,o.v_)(e.类型||"其他"),1)]),e.品质?((0,r.uX)(),(0,r.CE)("div",$F,[(0,r.Lk)("span",OF,(0,o.v_)(e.品质?.quality||"未知")+(0,o.v_)(e.品质?.grade?(a=e.品质.grade,null==a?"":0===a?"残缺":a>=1&&a<=3?"下级":a>=4&&a<=6?"中级":a>=7&&a<=9?"上级":10===a?"顶级":""):""),1)])):(0,r.Q3)("v-if",!0),e.数量>1?((0,r.uX)(),(0,r.CE)("div",FF,[(0,r.Lk)("span",null,"x"+(0,o.v_)(e.数量),1)])):(0,r.Q3)("v-if",!0),e.描述?((0,r.uX)(),(0,r.CE)("div",jF,[(0,r.Lk)("p",null,(0,o.v_)(e.描述),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",BF,[(0,r.Lk)("button",{class:"trade-btn",onClick:n=>((e,n)=>{const t=`尝试与 ${e.名字} 交易 ${n.名称}`;v.addAction({type:"npc_trade",itemName:n.名称,itemType:"NPC交易",description:t,npcName:e.名字,itemId:n.物品ID||n.名称,tradeType:"trade"}),f.showToast(`已将与 ${e.名字} 的交易请求加入动作队列`,{type:"success"})})(g.value,e),title:"尝试交易此物品"},[(0,r.bF)((0,i.R1)(WD),{size:12}),t[86]||(t[86]=(0,r.eW)("交易 ",-1))],8,XF),(0,r.Lk)("button",{class:"request-btn",onClick:n=>((e,n)=>{const t=`向 ${e.名字} 索要 ${n.名称}`;v.addAction({type:"npc_request",itemName:n.名称,itemType:"NPC索要",description:t,npcName:e.名字,itemId:n.物品ID||n.名称,tradeType:"request"}),f.showToast(`已将向 ${e.名字} 索要物品的请求加入动作队列`,{type:"success"})})(g.value,e),title:"请求获得此物品"}," 🙏 索要 ",8,UF),(0,r.Lk)("button",{class:"steal-btn",onClick:n=>((e,n)=>{const t=`尝试从 ${e.名字} 身上偷取 ${n.名称}`;v.addAction({type:"npc_steal",itemName:n.名称,itemType:"NPC偷窃",description:t,npcName:e.名字,itemId:n.物品ID||n.名称,tradeType:"steal"}),f.showToast(`已将偷窃 ${e.名字} 物品的计划加入动作队列`,{type:"success"})})(g.value,e),title:"尝试偷取此物品"}," 🥷 偷窃 ",8,WF)])],2);var a,s}),128))])):((0,r.uX)(),(0,r.CE)("div",qF,[(0,r.bF)((0,i.R1)(Hc),{size:24,class:"empty-icon"}),t[87]||(t[87]=(0,r.Lk)("p",null,"此人身上没有物品",-1))]))])])],512),[[s.aG,"inventory"===xe.value]]),(0,r.Q3)(" End of Tab 5: 背包 "),(0,r.Q3)(" Tab 6: 原始数据 "),(0,r.bo)((0,r.Lk)("div",GF,[(0,r.Lk)("div",HF,[t[89]||(t[89]=(0,r.Lk)("h5",{class:"section-title"},"原始数据 (JSON)",-1)),(0,r.Lk)("div",VF,[(0,r.Lk)("pre",null,[(0,r.Lk)("code",null,(0,o.v_)(JSON.stringify(g.value,null,2)),1)])])])],512),[[s.aG,"raw"===xe.value]]),(0,r.Q3)(" End of Tab 7: 原始数据 ")]),(0,r.Q3)(" End of tab-content ")]),(0,r.Q3)(" End of detail-body ")],64)):((0,r.uX)(),(0,r.CE)("div",QF,[(0,r.bF)((0,i.R1)(vp),{size:64,class:"placeholder-icon"}),t[90]||(t[90]=(0,r.Lk)("p",{class:"placeholder-text"},"选择一个人物查看详细信息",-1)),t[91]||(t[91]=(0,r.Lk)("p",{class:"placeholder-hint"},"在游戏中与人物互动会建立关系记录",-1))]))])],2)):((0,r.uX)(),(0,r.CE)("div",KF,[((0,r.uX)(),(0,r.CE)("svg",{ref_key:"graphSvgRef",ref:k,class:"graph-svg",viewBox:"0 0 900 600",onWheel:(0,s.D$)(j,["prevent"]),onPointerdown:B,onPointermove:X,onPointerup:U,onPointerleave:U},[(0,r.Lk)("g",{transform:L.value},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(P.value,(e,n)=>((0,r.uX)(),(0,r.CE)("line",{key:n,x1:z.value[e.from]?.x??0,y1:z.value[e.from]?.y??0,x2:z.value[e.to]?.x??0,y2:z.value[e.to]?.y??0,class:"graph-edge",style:(0,o.Tr)({stroke:N(e),strokeWidth:O(e)})},null,12,JF))),128)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(D.value,e=>{return(0,r.uX)(),(0,r.CE)("g",{key:e.id,class:"graph-node",transform:`translate(${e.x} ${e.y})`,onClick:(0,s.D$)(n=>(e=>{if(e===tj)return;const n=He.value.find(n=>n.名字===e);n&&(Ke(n),y.value=!0,x.value="list")})(e.id),["stop"])},[(0,r.Lk)("circle",{class:(0,o.C4)(["graph-node-dot",(n=e.id,n===tj?"player":g.value?.名字===n?"selected":"")]),r:"player"===e.kind?18:14},null,10,ej),(0,r.Lk)("text",{class:"graph-node-label",x:"0",y:"player"===e.kind?28:24,"text-anchor":"middle"},(0,o.v_)(e.label),9,nj)],8,ZF);var n}),128))],8,YF)],544))]))])]))}});var rj=t(5039),oj={};oj.styleTagTransform=A(),oj.setAttributes=k(),oj.insert=y().bind(null,"head"),oj.domAPI=g(),oj.insertStyleElement=_(),h()(rj.A,oj),rj.A&&rj.A.locals&&rj.A.locals;const ij=(0,E.A)(aj,[["__scopeId","data-v-146b0908"]]);var sj=t(5327),lj=t(6680);const cj=(0,I.A)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);var dj=t(6588);const uj={class:"save-panel"},pj={class:"saves-container"},vj={key:0,class:"current-save-section"},fj={class:"section-header"},hj={class:"section-title"},mj={class:"current-save-card"},gj={class:"save-preview"},bj={class:"preview-avatar"},yj={class:"preview-info"},xj={class:"character-name"},kj={class:"character-details"},wj={class:"detail-item"},_j={class:"detail-item"},Cj={key:0,class:"current-save-hint last"},Aj={key:1,class:"current-save-hint time"},Sj={class:"save-stats"},Lj={class:"stat-item"},Ej={class:"stat-label"},Tj={class:"stat-value"},Ij={class:"stat-item"},Rj={class:"stat-label"},Mj={class:"stat-value"},Pj={class:"saves-section"},Dj={class:"section-header"},zj={class:"header-actions"},Nj=["disabled"],$j={key:1,class:"saves-count"},Oj={key:2,class:"saves-count online-badge"},Fj={key:0,class:"loading-state"},jj={class:"loading-spinner"},Bj={class:"loading-text"},Xj={key:1,class:"empty-state"},Uj={class:"empty-icon"},Wj={class:"empty-text"},qj={class:"empty-hint"},Gj={key:2,class:"saves-list"},Hj=["onClick"],Vj={class:"card-header"},Qj={class:"save-preview small"},Kj={class:"preview-avatar small"},Yj={class:"preview-info"},Jj={class:"save-name"},Zj={class:"character-name-small"},eB={class:"save-time"},nB={class:"card-actions"},tB=["onClick","disabled"],aB=["onClick","disabled"],rB=["onClick","disabled"],oB=["onClick","disabled"],iB=["onClick","disabled","title"],sB={class:"card-content"},lB={class:"save-details"},cB={class:"detail-row"},dB={class:"detail-value"},uB={class:"detail-row"},pB={class:"detail-value"},vB={class:"detail-row"},fB={class:"detail-value"},hB={key:1,class:"auto-save-settings-section"},mB={class:"section-header"},gB={class:"section-title"},bB={class:"settings-list"},yB={class:"setting-item"},xB={class:"setting-info"},kB={class:"setting-name"},wB={class:"setting-control"},_B={class:"setting-switch"},CB={class:"setting-item"},AB={class:"setting-info"},SB={class:"setting-name"},LB={class:"setting-control"},EB={class:"setting-switch"},TB={key:0,class:"setting-item"},IB={class:"setting-info"},RB={class:"setting-name"},MB={class:"setting-control"},PB={class:"operations-section"},DB={class:"section-header"},zB={class:"section-title"},NB={class:"operations-list"},$B=["disabled"],OB=["disabled"],FB={class:"btn-content"},jB={class:"btn-desc"},BB=["disabled"],XB={class:"btn-content"},UB={class:"btn-desc"},WB=["disabled"],qB=["disabled"],GB={class:"btn-content"},HB={class:"btn-title"},VB={class:"btn-desc"},QB=(0,r.pM)({__name:"SavePanel",setup(e){const{t:n}=(0,l.s)(),a=(0,Ec.useCharacterStore)(),c=(0,Hu.useGameStateStore)(),d=(0,i.KR)(!1),u=(0,i.KR)(),p=()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},v=(0,r.EW)(()=>"联机"===a.activeCharacterProfile?.模式),f=(0,r.EW)({get:()=>c.conversationAutoSaveEnabled,set:e=>{c.setConversationAutoSaveEnabled(e),_e.o.info("对话前自动备份已"+(e?"开启":"关闭"))}}),h=(0,r.EW)({get:()=>c.timeBasedSaveEnabled,set:e=>{c.setTimeBasedSaveEnabled(e),e?_e.o.success(`时间点存档已启用，间隔${m.value}分钟`):_e.o.info("时间点存档已禁用")}}),m=(0,r.EW)({get:()=>c.timeBasedSaveInterval,set:e=>{c.setTimeBasedSaveInterval(e),_e.o.success(`存档间隔已设置为${e}分钟`)}}),g=(0,r.EW)(()=>a.saveSlots.filter(e=>!!e&&(e.存档名||e.id))),b=(0,r.EW)(()=>a.activeSaveSlot),y=(0,r.EW)(()=>null!==a.activeCharacterProfile||null!==c.character&&void 0!==c.character),x=(0,r.EW)(()=>{const e=new Set([b.value?.存档名,"上次对话","时间点存档"]);return g.value.filter(n=>!e.has(n.存档名)).length}),k=e=>"上次对话"===e.存档名||"时间点存档"===e.存档名||e.id===b.value?.id||x.value<=1,w=e=>"上次对话"===e.存档名?"上次对话存档不可删除（用于重roll）":"时间点存档"===e.存档名?"时间点存档不可删除（定时自动覆盖）":e.id===b.value?.id?"当前激活存档不可删除":x.value<=1?"最后一个普通存档不可删除":"删除存档",_=async()=>{d.value=!0;try{await a.loadSaves()}catch(e){TA.Yz.error("存档面板","刷新失败",e),_e.o.error("刷新存档列表失败")}finally{d.value=!1}},C=async()=>{if(!y.value)return void _e.o.warning("当前没有可存档的游戏状态");const e=window.prompt("请输入新存档的名称：",`存档_${(new Date).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})}`);if(e&&""!==e.trim()){d.value=!0;try{await a.saveCurrentGame({notifyIfNoActive:!0}),await a.saveAsNewSlot(e.trim())&&await _()}catch(e){TA.Yz.error("存档面板","新建存档失败",e),_e.o.error("新建存档失败")}finally{d.value=!1}}else _e.o.info("已取消新建存档")},A=(0,$.useUIStore)(),S=async()=>{try{console.log("[角色导出] 开始导出角色...");const e=a.rootState.当前激活存档?.角色ID;if(!e)return void _e.o.error("无法获取角色ID");const n=a.activeCharacterProfile;if(!n)return void _e.o.error("无法获取角色信息");const{loadSaveData:r}=await Promise.resolve().then(t.bind(t,5099)),o=await Promise.all(g.value.filter(e=>"上次对话"!==e.存档名).map(async n=>{const t=n.id||n.存档名,a=await r(e,t);return{...n,存档数据:a}})),i=o.map(e=>{const n=e.存档数据;if(!n)throw new Error(`存档「${e.存档名}」缺少存档数据，无法导出`);let t=n;try{const a=(0,Ic.ru)(n)?n:(0,Ic.jj)(n).migrated,r=(0,Rc.$)(a);r.isValid||console.warn(`[角色导出] 存档「${e.存档名}」校验警告：${r.errors[0]||"未知原因"}`),t=a}catch(n){console.warn(`[角色导出] 存档「${e.存档名}」迁移失败，使用原始数据:`,n)}return{...e,存档数据:t}}),s=(0,Tc.q3)("character",{角色ID:e,角色信息:JSON.parse(JSON.stringify(n)),存档列表:i}),l=JSON.stringify(s,null,2),c=new Blob([l],{type:"application/json"});console.log("[角色导出] 数据大小:",(l.length/1024).toFixed(2),"KB");const d=document.createElement("a");d.href=URL.createObjectURL(c);const u=n.角色?.名字||"未命名角色",v=`仙途-角色-${u}-${p()}.json`;d.download=v,document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(d.href)},100),console.log("[角色导出] 导出成功，文件名:",v),_e.o.success(`已导出角色: ${u} (含 ${o.length} 个存档)`)}catch(e){console.error("[角色导出] 导出失败:",e),_e.o.error(`导出角色失败: ${e instanceof Error?e.message:"未知错误"}`)}},L=async()=>{try{if(console.log("[存档导出] 开始导出存档..."),console.log("[存档导出] savesList.value:",g.value),console.log("[存档导出] savesList 数量:",g.value.length),!g.value||0===g.value.length)return _e.o.warning("没有可导出的存档"),void console.warn("[存档导出] 没有可导出的存档");const e=a.rootState.当前激活存档?.角色ID;if(!e)return void _e.o.error("无法获取角色ID");const{loadSaveData:n}=await Promise.resolve().then(t.bind(t,5099)),r=(await Promise.all(g.value.map(async t=>{const a=await n(e,t.存档名);return{...t,存档数据:a}}))).map(e=>{const n=e.存档数据;if(!n)return{...e,存档数据:n};try{const t=(0,Ic.ru)(n)?n:(0,Ic.jj)(n).migrated,a=(0,Rc.$)(t);return a.isValid||console.warn(`[存档导出] 存档「${e.存档名}」校验警告：${a.errors[0]||"未知原因"}`),{...e,存档数据:t}}catch(t){return console.warn(`[存档导出] 存档「${e.存档名}」迁移失败，导出原始数据:`,t),{...e,存档数据:n}}}),o=(0,Tc.q3)("saves",{characterId:e,characterName:a.activeCharacterProfile?.角色?.名字,saves:r});console.log("[存档导出] 导出数据:",o);const i=JSON.stringify(o,null,2),s=new Blob([i],{type:"application/json"});console.log("[存档导出] 数据大小:",(i.length/1024).toFixed(2),"KB");const l=document.createElement("a");l.href=URL.createObjectURL(s);const c=`仙途-存档备份-${p()}.json`;l.download=c,document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),URL.revokeObjectURL(l.href)},100),console.log("[存档导出] 导出成功，文件名:",c),_e.o.success(`已导出 ${g.value.length} 个存档`)}catch(e){console.error("[存档导出] 导出失败:",e),TA.Yz.error("存档面板","导出失败",e),_e.o.error(`导出存档失败: ${e instanceof Error?e.message:"未知错误"}`)}},E=()=>{u.value?.click()},T=async e=>{const n=e.target.files?.[0];if(n){d.value=!0;try{const e=await n.text(),t=JSON.parse(e),r=(0,Tc.ZT)(t);if("saves"!==r.type||!Array.isArray(r.payload?.saves))throw new Error("无效的存档文件格式，请使用本游戏导出的存档文件");const o=r.payload.saves;if(0===o.length)throw new Error("文件中没有找到有效的存档数据");const i=a.rootState.当前激活存档?.角色ID;if(!i)throw new Error("无法导入存档，当前没有激活的角色");for(const e of o)await a.importSave(i,e);await _(),_e.o.success(`成功导入 ${o.length} 个存档`)}catch(e){TA.Yz.error("存档面板","导入失败",e),_e.o.error("导入存档失败: "+e.message)}finally{d.value=!1,u.value&&(u.value.value="")}}},I=async()=>{b.value?A.showRetryDialog({title:"修复存档",message:"将对当前存档进行数据结构修复，补全缺失字段、修正数据类型。建议先导出备份。确定继续？",confirmText:"开始修复",cancelText:"取消",onConfirm:async()=>{d.value=!0;try{const e=a.rootState.当前激活存档?.角色ID;if(!e)throw new Error("无法获取角色ID");const n=b.value.存档名,{loadSaveData:r,saveSaveData:o}=await Promise.resolve().then(t.bind(t,5099)),i=await r(e,n);if(!i)throw new Error("无法加载存档数据");console.log("[存档修复] 原始数据:",i);const s=(0,dj.repairSaveData)(i);console.log("[存档修复] 修复后数据:",s),await o(e,n,s),await a.loadGameById(n),_e.o.success("存档修复完成"),await _()}catch(e){TA.Yz.error("存档面板","修复失败",e),_e.o.error(`修复失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{d.value=!1}},onCancel:()=>{}}):_e.o.warning("没有当前激活的存档")},R=async()=>{A.showRetryDialog({title:"清空所有存档",message:"确定要删除所有存档吗？此操作不可撤销！",confirmText:"继续",cancelText:"取消",onConfirm:()=>{A.showRetryDialog({title:"再次确认",message:"再次确认：这将永久删除所有存档数据！",confirmText:"确认清空",cancelText:"取消",onConfirm:async()=>{d.value=!0;try{await a.clearAllSaves(),_e.o.success("所有存档已清空")}catch(e){TA.Yz.error("存档面板","清空失败",e),_e.o.error("清空存档失败")}finally{d.value=!1}},onCancel:()=>{}})},onCancel:()=>{}})},M=e=>{if(!e)return"未知";const n=new Date(e);if(isNaN(n.getTime()))return"未知";const t=(new Date).getTime()-n.getTime();return t<6e4?"刚刚":t<36e5?`${Math.floor(t/6e4)}分钟前`:t<864e5?`${Math.floor(t/36e5)}小时前`:n.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return(0,r.sV)(()=>{_(),fp.on("refresh",()=>_()),fp.on("save",()=>(async()=>{if(y.value){d.value=!0;try{await a.saveCurrentGame({notifyIfNoActive:!0}),_e.o.success("快速存档完成")}catch(e){TA.Yz.error("存档面板","快速存档失败",e),_e.o.error("快速存档失败")}finally{d.value=!1}}else _e.o.warning("当前没有可存档的游戏状态")})())}),(e,l)=>((0,r.uX)(),(0,r.CE)("div",uj,[(0,r.Q3)(" 存档容器 "),(0,r.Lk)("div",pj,[(0,r.Q3)(" 当前存档状态 "),b.value?((0,r.uX)(),(0,r.CE)("div",vj,[(0,r.Lk)("div",fj,[(0,r.Lk)("h4",hj,["上次对话"===b.value.存档名?((0,r.uX)(),(0,r.Wv)((0,i.R1)(N),{key:0,size:16,class:"last-save-icon"})):"时间点存档"===b.value.存档名?((0,r.uX)(),(0,r.Wv)((0,i.R1)(Bp),{key:1,size:16,class:"time-save-icon"})):(0,r.Q3)("v-if",!0),(0,r.eW)(" 当前进度 - "+(0,o.v_)(b.value.存档名),1)])]),(0,r.Lk)("div",mj,[(0,r.Lk)("div",gj,[(0,r.Lk)("div",bj,(0,o.v_)(b.value.角色名字?.[0]||"道"),1),(0,r.Lk)("div",yj,[(0,r.Lk)("div",xj,(0,o.v_)(b.value.角色名字||"无名道友"),1),(0,r.Lk)("div",kj,[(0,r.Lk)("span",wj,(0,o.v_)(b.value.觉醒阶段||"凡人"),1),l[3]||(l[3]=(0,r.Lk)("span",{class:"detail-separator"},"·",-1)),(0,r.Lk)("span",_j,(0,o.v_)(b.value.位置||"未知"),1)]),(0,r.Q3)(" 特殊存档说明 "),"上次对话"===b.value.存档名?((0,r.uX)(),(0,r.CE)("div",Cj," 每次对话前自动备份，可用于回退到上次对话前的状态 ")):"时间点存档"===b.value.存档名?((0,r.uX)(),(0,r.CE)("div",Aj," 按设定时间间隔自动覆盖保存，防止长时间游玩数据丢失 ")):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",Sj,[(0,r.Lk)("div",Lj,[(0,r.Lk)("span",Ej,(0,o.v_)((0,i.R1)(n)("创建时间")),1),(0,r.Lk)("span",Tj,(0,o.v_)(M(b.value.保存时间||"")),1)]),(0,r.Lk)("div",Ij,[(0,r.Lk)("span",Rj,(0,o.v_)((0,i.R1)(n)("最后保存")),1),(0,r.Lk)("span",Mj,(0,o.v_)(M(b.value.最后保存时间??b.value.保存时间??"")),1)])])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 存档列表 "),(0,r.Lk)("div",Pj,[(0,r.Lk)("div",Dj,[l[4]||(l[4]=(0,r.Lk)("h4",{class:"section-title"},"存档列表",-1)),(0,r.Lk)("div",zj,[v.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"new-save-btn",onClick:C,disabled:d.value,title:"新建存档"},[(0,r.bF)((0,i.R1)(lj.A),{size:16})],8,Nj)),v.value?((0,r.uX)(),(0,r.CE)("div",Oj,"☁️ 云端存档")):((0,r.uX)(),(0,r.CE)("div",$j,(0,o.v_)(g.value.length)+"/10",1))])]),d.value?((0,r.uX)(),(0,r.CE)("div",Fj,[(0,r.Lk)("div",jj,[(0,r.bF)((0,i.R1)(Fc.A),{size:18,class:"animate-spin"})]),(0,r.Lk)("div",Bj,(0,o.v_)((0,i.R1)(n)("正在加载存档...")),1)])):0===g.value.length?((0,r.uX)(),(0,r.CE)("div",Xj,[(0,r.Lk)("div",Uj,[(0,r.bF)((0,i.R1)(Pc.A),{size:32})]),(0,r.Lk)("div",Wj,(0,o.v_)((0,i.R1)(n)("修仙路上尚未留存，创建存档记录道途")),1),(0,r.Lk)("div",qj,(0,o.v_)((0,i.R1)(n)("开始游戏后可以创建存档")),1)])):((0,r.uX)(),(0,r.CE)("div",Gj,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["save-card",{active:e.id===b.value?.id}]),onClick:n=>(e=>{TA.Yz.log("存档面板","选择存档",e)})(e)},[(0,r.Lk)("div",Vj,[(0,r.Lk)("div",Qj,[(0,r.Lk)("div",Kj,(0,o.v_)(e.角色名字?.[0]||"道"),1),(0,r.Lk)("div",Yj,[(0,r.Lk)("div",Jj,["上次对话"===e.存档名?((0,r.uX)(),(0,r.Wv)((0,i.R1)(N),{key:0,size:14,class:"last-save-icon"})):"时间点存档"===e.存档名?((0,r.uX)(),(0,r.Wv)((0,i.R1)(Bp),{key:1,size:14,class:"time-save-icon"})):(0,r.Q3)("v-if",!0),(0,r.eW)(" "+(0,o.v_)(e.存档名||e.id||`存档${n+1}`),1)]),(0,r.Lk)("div",Zj,(0,o.v_)(e.角色名字||"无名道友"),1),(0,r.Q3)(" 显示最后保存时间 "),(0,r.Lk)("div",eB,(0,o.v_)(M(e.最后保存时间??e.保存时间??null)),1)])]),(0,r.Lk)("div",nB,[e.id!==b.value?.id&&"上次对话"!==e.存档名&&"时间点存档"!==e.存档名?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"card-btn",onClick:(0,s.D$)(n=>(async e=>{if(e){d.value=!0;try{await a.loadGameById(e.存档名),_e.o.success(`已加载存档: ${e.存档名}`)}catch(e){TA.Yz.error("存档面板","加载失败",e),_e.o.error("加载存档失败")}finally{d.value=!1}}})(e),["stop"]),disabled:d.value,title:"读取存档"},[(0,r.bF)((0,i.R1)(cj),{size:14})],8,tB)):(0,r.Q3)("v-if",!0),"上次对话"!==e.存档名||v.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:1,class:"card-btn warning",onClick:(0,s.D$)(n=>(async e=>{if(!b.value)return void _e.o.warning("没有当前激活的存档");const{useUIStore:n}=await Promise.resolve().then(t.bind(t,9173));n().showRetryDialog({title:"回滚到上次对话",message:`确定要将"${e.存档名}"的数据覆盖到当前存档"${b.value.存档名}"吗？当前进度将被替换为上次对话前的状态。`,confirmText:"确认回滚",cancelText:"取消",onConfirm:async()=>{d.value=!0;try{await a.rollbackToLastConversation(),_e.o.success("已回滚到上次对话前的状态"),await _()}catch(e){TA.Yz.error("存档面板","回滚失败",e),_e.o.error(`回滚失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{d.value=!1}},onCancel:()=>{}})})(e),["stop"]),disabled:d.value||!b.value,title:"用上次对话的数据覆盖当前存档（回滚）"},[(0,r.bF)((0,i.R1)(Fc.A),{size:14})],8,aB)),(0,r.Lk)("button",{class:"card-btn info",onClick:(0,s.D$)(n=>(async e=>{try{console.log("[单个存档导出] 开始导出存档:",e.存档名);const n=a.rootState.当前激活存档?.角色ID;if(!n)return void _e.o.error("无法获取角色ID");const{loadSaveData:r}=await Promise.resolve().then(t.bind(t,5099)),o=e.id||e.存档名,i=await r(n,o);if(!i)return void _e.o.error("无法加载存档数据");let s=i;try{const e=(0,Ic.ru)(i)?i:(0,Ic.jj)(i).migrated,n=(0,Rc.$)(e);n.isValid||console.warn("[单个存档导出] 存档校验警告:",n.errors[0]),s=e}catch(e){console.warn("[单个存档导出] 迁移失败，导出原始数据:",e)}const l=(0,Tc.q3)("saves",{characterId:n,characterName:a.activeCharacterProfile?.角色?.名字,saves:[{...e,存档数据:s}]}),c=JSON.stringify(l,null,2),d=new Blob([c],{type:"application/json"}),u=document.createElement("a");u.href=URL.createObjectURL(d);const v=`仙途-${e.存档名}-${p()}.json`;u.download=v,document.body.appendChild(u),u.click(),setTimeout(()=>{document.body.removeChild(u),URL.revokeObjectURL(u.href)},100),console.log("[单个存档导出] 导出成功，文件名:",v),_e.o.success(`已导出存档: ${e.存档名}`)}catch(e){console.error("[单个存档导出] 导出失败:",e),_e.o.error(`导出存档失败: ${e instanceof Error?e.message:"未知错误"}`)}})(e),["stop"]),disabled:d.value,title:"导出此存档"},[(0,r.bF)((0,i.R1)(Vc.A),{size:14})],8,rB),"上次对话"!==e.存档名&&"时间点存档"!==e.存档名?((0,r.uX)(),(0,r.CE)("button",{key:2,class:"card-btn primary",onClick:(0,s.D$)(n=>(async e=>{y.value?A.showRetryDialog({title:"覆盖存档",message:`确定要用当前游戏进度覆盖存档"${e.存档名}"吗？原存档数据将丢失。`,confirmText:"确认覆盖",cancelText:"取消",onConfirm:async()=>{d.value=!0;try{await a.saveCurrentGame({notifyIfNoActive:!0}),await a.saveToSlot(e.存档名),_e.o.success(`已覆盖存档: ${e.存档名}`),await _()}catch(e){TA.Yz.error("存档面板","覆盖存档失败",e),_e.o.error("覆盖存档失败")}finally{d.value=!1}},onCancel:()=>{}}):_e.o.warning("当前没有可存档的游戏状态")})(e),["stop"]),disabled:d.value||!b.value,title:"用当前进度覆盖此存档"},[(0,r.bF)((0,i.R1)(Pc.A),{size:14})],8,oB)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{class:"card-btn danger",onClick:(0,s.D$)(n=>(async e=>{A.showRetryDialog({title:"删除存档",message:`确定要删除存档"${e.存档名||"存档"}"吗？此操作不可撤销。`,confirmText:"确认删除",cancelText:"取消",onConfirm:async()=>{d.value=!0;try{await a.deleteSaveById(e.存档名),_e.o.success("存档已删除"),await _()}catch(e){TA.Yz.error("存档面板","删除失败",e),_e.o.error("删除存档失败")}finally{d.value=!1}},onCancel:()=>{}})})(e),["stop"]),disabled:d.value||k(e),title:w(e)},[(0,r.bF)((0,i.R1)(ba.A),{size:14})],8,iB)])]),(0,r.Lk)("div",sB,[(0,r.Lk)("div",lB,[(0,r.Lk)("div",cB,[l[5]||(l[5]=(0,r.Lk)("span",{class:"detail-label"},"觉醒阶段:",-1)),(0,r.Lk)("span",dB,(0,o.v_)(e.觉醒阶段||"凡人"),1)]),(0,r.Lk)("div",uB,[l[6]||(l[6]=(0,r.Lk)("span",{class:"detail-label"},"位置:",-1)),(0,r.Lk)("span",pB,(0,o.v_)(e.位置||"未知"),1)]),(0,r.Lk)("div",vB,[l[7]||(l[7]=(0,r.Lk)("span",{class:"detail-label"},"修改:",-1)),(0,r.Lk)("span",fB,(0,o.v_)(M(e.最后保存时间??e.保存时间??"")),1)])])])],10,Hj))),128))]))]),(0,r.Q3)(" 自动存档设置 (仅单机模式) "),v.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",hB,[(0,r.Lk)("div",mB,[(0,r.Lk)("h4",gB,(0,o.v_)((0,i.R1)(n)("自动存档设置")),1)]),(0,r.Lk)("div",bB,[(0,r.Lk)("div",yB,[(0,r.Lk)("div",xB,[(0,r.Lk)("label",kB,(0,o.v_)((0,i.R1)(n)("对话前自动备份")),1),l[8]||(l[8]=(0,r.Lk)("span",{class:"setting-desc"},"每次对话前自动备份，用于回退到上次对话前的状态",-1))]),(0,r.Lk)("div",wB,[(0,r.Lk)("label",_B,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e)},null,512),[[s.lH,f.value]]),l[9]||(l[9]=(0,r.Lk)("span",{class:"switch-slider"},null,-1))])])]),(0,r.Lk)("div",CB,[(0,r.Lk)("div",AB,[(0,r.Lk)("label",SB,(0,o.v_)((0,i.R1)(n)("时间点存档")),1),l[10]||(l[10]=(0,r.Lk)("span",{class:"setting-desc"},"按设定时间间隔自动覆盖保存，防止长时间游玩数据丢失",-1))]),(0,r.Lk)("div",LB,[(0,r.Lk)("label",EB,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=e=>h.value=e)},null,512),[[s.lH,h.value]]),l[11]||(l[11]=(0,r.Lk)("span",{class:"switch-slider"},null,-1))])])]),h.value?((0,r.uX)(),(0,r.CE)("div",TB,[(0,r.Lk)("div",IB,[(0,r.Lk)("label",RB,(0,o.v_)((0,i.R1)(n)("存档间隔")),1),l[12]||(l[12]=(0,r.Lk)("span",{class:"setting-desc"},"自动存档的时间间隔（真实时间）",-1))]),(0,r.Lk)("div",MB,[(0,r.bo)((0,r.Lk)("input",{type:"number",min:"1","onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e),class:"interval-input"},null,512),[[s.Jo,m.value,void 0,{number:!0}]]),l[13]||(l[13]=(0,r.Lk)("span",{class:"unit-label"},"分钟",-1))])])):(0,r.Q3)("v-if",!0)])])),(0,r.Q3)(" 存档操作 "),(0,r.Lk)("div",PB,[(0,r.Lk)("div",DB,[(0,r.Lk)("h4",zB,(0,o.v_)((0,i.R1)(n)("存档操作")),1)]),(0,r.Lk)("div",NB,[(0,r.Lk)("button",{class:"operation-btn",onClick:S,disabled:d.value||!(0,i.R1)(a).activeCharacterProfile},[(0,r.bF)((0,i.R1)(Vc.A),{size:16}),l[14]||(l[14]=(0,r.Lk)("div",{class:"btn-content"},[(0,r.Lk)("span",{class:"btn-title"},"导出角色"),(0,r.Lk)("span",{class:"btn-desc"},"导出当前角色及其所有存档")],-1))],8,$B),(0,r.Lk)("button",{class:"operation-btn",onClick:L,disabled:d.value||0===g.value.length},[(0,r.bF)((0,i.R1)(Vc.A),{size:16}),(0,r.Lk)("div",FB,[l[15]||(l[15]=(0,r.Lk)("span",{class:"btn-title"},"导出所有存档",-1)),(0,r.Lk)("span",jB,(0,o.v_)((0,i.R1)(n)("备份所有存档到文件")),1)])],8,OB),v.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"operation-btn",onClick:E,disabled:d.value},[(0,r.bF)((0,i.R1)(Wc.A),{size:16}),(0,r.Lk)("div",XB,[l[16]||(l[16]=(0,r.Lk)("span",{class:"btn-title"},"导入存档",-1)),(0,r.Lk)("span",UB,(0,o.v_)((0,i.R1)(n)("从文件恢复存档")),1)])],8,BB)),(0,r.Lk)("button",{class:"operation-btn warning",onClick:I,disabled:d.value||!b.value,title:"修复当前存档数据结构"},[(0,r.bF)((0,i.R1)(mg),{size:16}),l[17]||(l[17]=(0,r.Lk)("div",{class:"btn-content"},[(0,r.Lk)("span",{class:"btn-title"},"修复存档"),(0,r.Lk)("span",{class:"btn-desc"},"修复当前存档的数据结构问题")],-1))],8,WB),v.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:1,class:"operation-btn danger",onClick:R,disabled:d.value||0===g.value.length},[(0,r.bF)((0,i.R1)(ba.A),{size:16}),(0,r.Lk)("div",GB,[(0,r.Lk)("span",HB,(0,o.v_)((0,i.R1)(n)("清空存档")),1),(0,r.Lk)("span",VB,(0,o.v_)((0,i.R1)(n)("删除所有存档数据")),1)])],8,qB))])])]),(0,r.Q3)(" 隐藏的文件输入 "),(0,r.Lk)("input",{ref_key:"fileInput",ref:u,type:"file",accept:".json",onChange:T,style:{display:"none"}},null,544)]))}});var KB=t(618),YB={};YB.styleTagTransform=A(),YB.setAttributes=k(),YB.insert=y().bind(null,"head"),YB.domAPI=g(),YB.insertStyleElement=_(),h()(KB.A,YB),KB.A&&KB.A.locals&&KB.A.locals;const JB=(0,E.A)(QB,[["__scopeId","data-v-37662781"]]),ZB=(0,I.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var eX=t(31),nX=t(2815),tX=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(tX||{}),aX=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(aX||{}),rX=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(rX||{}),oX=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(oX||{}),iX=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(iX||{}),sX=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(sX||{}),lX=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(lX||{}),cX=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(cX||{}),dX=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(dX||{}),uX=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(uX||{}),pX=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(pX||{}),vX=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(vX||{}),fX=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(fX||{}),hX=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(hX||{}),mX=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(mX||{}),gX=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(gX||{}),bX=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(bX||{}),yX=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(yX||{}),xX=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(xX||{});const kX={createCanvas:(e,n)=>{const t=document.createElement("canvas");return t.width=e,t.height=n,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,n)=>fetch(e,n),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")},wX={ADAPTER:kX,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var _X=/iPhone/i,CX=/iPod/i,AX=/iPad/i,SX=/\biOS-universal(?:.+)Mac\b/i,LX=/\bAndroid(?:.+)Mobile\b/i,EX=/Android/i,TX=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,IX=/Silk/i,RX=/Windows Phone/i,MX=/\bWindows(?:.+)ARM\b/i,PX=/BlackBerry/i,DX=/BB10/i,zX=/Opera Mini/i,NX=/\b(CriOS|Chrome)(?:.+)Mobile/i,$X=/Mobile(?:.+)Firefox\b/i,OX=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};function FX(e){var n={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?n.userAgent=e:e&&e.userAgent&&(n={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):n={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var t=n.userAgent,a=t.split("[FBAN");void 0!==a[1]&&(t=a[0]),void 0!==(a=t.split("Twitter"))[1]&&(t=a[0]);var r=function(e){return function(n){return n.test(e)}}(t),o={apple:{phone:r(_X)&&!r(RX),ipod:r(CX),tablet:!r(_X)&&(r(AX)||OX(n))&&!r(RX),universal:r(SX),device:(r(_X)||r(CX)||r(AX)||r(SX)||OX(n))&&!r(RX)},amazon:{phone:r(TX),tablet:!r(TX)&&r(IX),device:r(TX)||r(IX)},android:{phone:!r(RX)&&r(TX)||!r(RX)&&r(LX),tablet:!r(RX)&&!r(TX)&&!r(LX)&&(r(IX)||r(EX)),device:!r(RX)&&(r(TX)||r(IX)||r(LX)||r(EX))||r(/\bokhttp\b/i)},windows:{phone:r(RX),tablet:r(MX),device:r(RX)||r(MX)},other:{blackberry:r(PX),blackberry10:r(DX),opera:r(zX),firefox:r($X),chrome:r(NX),device:r(PX)||r(DX)||r(zX)||r($X)||r(NX)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const jX=(FX.default??FX)(globalThis.navigator);wX.RETINA_PREFIX=/@([0-9\.]+)x/,wX.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var BX=t(228),XX=t(6570);t(8835);const UX={};function WX(e,n,t=3){if(UX[n])return;let a=(new Error).stack;typeof a>"u"?console.warn("PixiJS Deprecation Warning: ",`${n}\nDeprecated since v${e}`):(a=a.split("\n").splice(t).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${n}\nDeprecated since v${e}`),console.warn(a),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${n}\nDeprecated since v${e}`),console.warn(a))),UX[n]=!0}function qX(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function GX(e){return e.split("?")[0].split("#")[0]}const HX={toPosix:e=>e.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/"),isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){qX(e),e=this.toPosix(e);const n=/^file:\/\/\//.exec(e);if(n)return n[0];const t=/^[^/:]+:\/{0,2}/.exec(e);return t?t[0]:""},toAbsolute(e,n,t){if(qX(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const a=GX(this.toPosix(n??wX.ADAPTER.getBaseUrl())),r=GX(this.toPosix(t??this.rootname(a)));return(e=this.toPosix(e)).startsWith("/")?HX.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(a,e)},normalize(e){if(qX(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;let n="";const t=(e=this.toPosix(e)).startsWith("/");this.hasProtocol(e)&&(n=this.rootname(e),e=e.slice(n.length));const a=e.endsWith("/");return e=function(e){let n="",t=0,a=-1,r=0,o=-1;for(let i=0;i<=e.length;++i){if(i<e.length)o=e.charCodeAt(i);else{if(47===o)break;o=47}if(47===o){if(a!==i-1&&1!==r)if(a!==i-1&&2===r){if(n.length<2||2!==t||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){const e=n.lastIndexOf("/");if(e!==n.length-1){-1===e?(n="",t=0):(n=n.slice(0,e),t=n.length-1-n.lastIndexOf("/")),a=i,r=0;continue}}else if(2===n.length||1===n.length){n="",t=0,a=i,r=0;continue}}else n.length>0?n+=`/${e.slice(a+1,i)}`:n=e.slice(a+1,i),t=i-a-1;a=i,r=0}else 46===o&&-1!==r?++r:r=-1}return n}(e),e.length>0&&a&&(e+="/"),t?`/${e}`:n+e},isAbsolute(e){return qX(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){if(0===e.length)return".";let n;for(let t=0;t<e.length;++t){const a=e[t];if(qX(a),a.length>0)if(void 0===n)n=a;else{const r=e[t-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?n+=`/../${a}`:n+=`/${a}`}}return void 0===n?".":this.normalize(n)},dirname(e){if(qX(e),0===e.length)return".";let n=(e=this.toPosix(e)).charCodeAt(0);const t=47===n;let a=-1,r=!0;const o=this.getProtocol(e),i=e;for(let t=(e=e.slice(o.length)).length-1;t>=1;--t)if(n=e.charCodeAt(t),47===n){if(!r){a=t;break}}else r=!1;return-1===a?t?"/":this.isUrl(i)?o+e:o:t&&1===a?"//":o+e.slice(0,a)},rootname(e){qX(e);let n="";if(n=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){const t=e.indexOf("/",n.length);n=-1!==t?e.slice(0,t):e,n.endsWith("/")||(n+="/")}return n},basename(e,n){qX(e),n&&qX(n),e=GX(this.toPosix(e));let t,a=0,r=-1,o=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";let i=n.length-1,s=-1;for(t=e.length-1;t>=0;--t){const l=e.charCodeAt(t);if(47===l){if(!o){a=t+1;break}}else-1===s&&(o=!1,s=t+1),i>=0&&(l===n.charCodeAt(i)?-1===--i&&(r=t):(i=-1,r=s))}return a===r?r=s:-1===r&&(r=e.length),e.slice(a,r)}for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){a=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(a,r)},extname(e){qX(e);let n=-1,t=0,a=-1,r=!0,o=0;for(let i=(e=GX(this.toPosix(e))).length-1;i>=0;--i){const s=e.charCodeAt(i);if(47!==s)-1===a&&(r=!1,a=i+1),46===s?-1===n?n=i:1!==o&&(o=1):-1!==n&&(o=-1);else if(!r){t=i+1;break}}return-1===n||-1===a||0===o||1===o&&n===a-1&&n===t+1?"":e.slice(n,a)},parse(e){qX(e);const n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;let t=(e=GX(this.toPosix(e))).charCodeAt(0);const a=this.isAbsolute(e);let r;n.root=this.rootname(e),r=a||this.hasProtocol(e)?1:0;let o=-1,i=0,s=-1,l=!0,c=e.length-1,d=0;for(;c>=r;--c)if(t=e.charCodeAt(c),47!==t)-1===s&&(l=!1,s=c+1),46===t?-1===o?o=c:1!==d&&(d=1):-1!==o&&(d=-1);else if(!l){i=c+1;break}return-1===o||-1===s||0===d||1===d&&o===s-1&&o===i+1?-1!==s&&(n.base=n.name=0===i&&a?e.slice(1,s):e.slice(i,s)):(0===i&&a?(n.name=e.slice(1,o),n.base=e.slice(1,s)):(n.name=e.slice(i,o),n.base=e.slice(i,s)),n.ext=e.slice(o,s)),n.dir=this.dirname(e),n},sep:"/",delimiter:":",joinExtensions:[".html"]};let VX,QX;async function KX(){return VX??(VX=(async()=>{const e=document.createElement("canvas").getContext("webgl");if(!e)return fX.UNPACK;const n=await new Promise(e=>{const n=document.createElement("video");n.onloadeddata=()=>e(n),n.onerror=()=>e(null),n.autoplay=!1,n.crossOrigin="anonymous",n.preload="auto",n.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",n.load()});if(!n)return fX.UNPACK;const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n);const r=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,r),e.deleteFramebuffer(a),e.deleteTexture(t),e.getExtension("WEBGL_lose_context")?.loseContext(),r[0]<=r[3]?fX.PMA:fX.UNPACK})()),VX}var YX={grad:.9,turn:360,rad:360/(2*Math.PI)},JX=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},ZX=function(e,n,t){return void 0===n&&(n=0),void 0===t&&(t=Math.pow(10,n)),Math.round(t*e)/t+0},eU=function(e,n,t){return void 0===n&&(n=0),void 0===t&&(t=1),e>t?t:e>n?e:n},nU=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},tU=function(e){return{r:eU(e.r,0,255),g:eU(e.g,0,255),b:eU(e.b,0,255),a:eU(e.a)}},aU=function(e){return{r:ZX(e.r),g:ZX(e.g),b:ZX(e.b),a:ZX(e.a,3)}},rU=/^#([0-9a-f]{3,8})$/i,oU=function(e){var n=e.toString(16);return n.length<2?"0"+n:n},iU=function(e){var n=e.r,t=e.g,a=e.b,r=e.a,o=Math.max(n,t,a),i=o-Math.min(n,t,a),s=i?o===n?(t-a)/i:o===t?2+(a-n)/i:4+(n-t)/i:0;return{h:60*(s<0?s+6:s),s:o?i/o*100:0,v:o/255*100,a:r}},sU=function(e){var n=e.h,t=e.s,a=e.v,r=e.a;n=n/360*6,t/=100,a/=100;var o=Math.floor(n),i=a*(1-t),s=a*(1-(n-o)*t),l=a*(1-(1-n+o)*t),c=o%6;return{r:255*[a,s,i,i,l,a][c],g:255*[l,a,a,s,i,i][c],b:255*[i,i,l,a,a,s][c],a:r}},lU=function(e){return{h:nU(e.h),s:eU(e.s,0,100),l:eU(e.l,0,100),a:eU(e.a)}},cU=function(e){return{h:ZX(e.h),s:ZX(e.s),l:ZX(e.l),a:ZX(e.a,3)}},dU=function(e){return sU((t=(n=e).s,{h:n.h,s:(t*=((a=n.l)<50?a:100-a)/100)>0?2*t/(a+t)*100:0,v:a+t,a:n.a}));var n,t,a},uU=function(e){return{h:(n=iU(e)).h,s:(r=(200-(t=n.s))*(a=n.v)/100)>0&&r<200?t*a/100/(r<=100?r:200-r)*100:0,l:r/2,a:n.a};var n,t,a,r},pU=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vU=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fU=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,hU=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mU={string:[[function(e){var n=rU.exec(e);return n?(e=n[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?ZX(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?ZX(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var n=fU.exec(e)||hU.exec(e);return n?n[2]!==n[4]||n[4]!==n[6]?null:tU({r:Number(n[1])/(n[2]?100/255:1),g:Number(n[3])/(n[4]?100/255:1),b:Number(n[5])/(n[6]?100/255:1),a:void 0===n[7]?1:Number(n[7])/(n[8]?100:1)}):null},"rgb"],[function(e){var n=pU.exec(e)||vU.exec(e);if(!n)return null;var t,a,r=lU({h:(t=n[1],a=n[2],void 0===a&&(a="deg"),Number(t)*(YX[a]||1)),s:Number(n[3]),l:Number(n[4]),a:void 0===n[5]?1:Number(n[5])/(n[6]?100:1)});return dU(r)},"hsl"]],object:[[function(e){var n=e.r,t=e.g,a=e.b,r=e.a,o=void 0===r?1:r;return JX(n)&&JX(t)&&JX(a)?tU({r:Number(n),g:Number(t),b:Number(a),a:Number(o)}):null},"rgb"],[function(e){var n=e.h,t=e.s,a=e.l,r=e.a,o=void 0===r?1:r;if(!JX(n)||!JX(t)||!JX(a))return null;var i=lU({h:Number(n),s:Number(t),l:Number(a),a:Number(o)});return dU(i)},"hsl"],[function(e){var n=e.h,t=e.s,a=e.v,r=e.a,o=void 0===r?1:r;if(!JX(n)||!JX(t)||!JX(a))return null;var i=function(e){return{h:nU(e.h),s:eU(e.s,0,100),v:eU(e.v,0,100),a:eU(e.a)}}({h:Number(n),s:Number(t),v:Number(a),a:Number(o)});return sU(i)},"hsv"]]},gU=function(e,n){for(var t=0;t<n.length;t++){var a=n[t][0](e);if(a)return[a,n[t][1]]}return[null,void 0]},bU=function(e,n){var t=uU(e);return{h:t.h,s:eU(t.s+100*n,0,100),l:t.l,a:t.a}},yU=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},xU=function(e,n){var t=uU(e);return{h:t.h,s:t.s,l:eU(t.l+100*n,0,100),a:t.a}},kU=function(){function e(e){this.parsed=function(e){return"string"==typeof e?gU(e.trim(),mU.string):"object"==typeof e&&null!==e?gU(e,mU.object):[null,void 0]}(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return ZX(yU(this.rgba),2)},e.prototype.isDark=function(){return yU(this.rgba)<.5},e.prototype.isLight=function(){return yU(this.rgba)>=.5},e.prototype.toHex=function(){return n=(e=aU(this.rgba)).r,t=e.g,a=e.b,o=(r=e.a)<1?oU(ZX(255*r)):"","#"+oU(n)+oU(t)+oU(a)+o;var e,n,t,a,r,o},e.prototype.toRgb=function(){return aU(this.rgba)},e.prototype.toRgbString=function(){return n=(e=aU(this.rgba)).r,t=e.g,a=e.b,(r=e.a)<1?"rgba("+n+", "+t+", "+a+", "+r+")":"rgb("+n+", "+t+", "+a+")";var e,n,t,a,r},e.prototype.toHsl=function(){return cU(uU(this.rgba))},e.prototype.toHslString=function(){return n=(e=cU(uU(this.rgba))).h,t=e.s,a=e.l,(r=e.a)<1?"hsla("+n+", "+t+"%, "+a+"%, "+r+")":"hsl("+n+", "+t+"%, "+a+"%)";var e,n,t,a,r},e.prototype.toHsv=function(){return e=iU(this.rgba),{h:ZX(e.h),s:ZX(e.s),v:ZX(e.v),a:ZX(e.a,3)};var e},e.prototype.invert=function(){return wU({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),wU(bU(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),wU(bU(this.rgba,-e))},e.prototype.grayscale=function(){return wU(bU(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),wU(xU(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),wU(xU(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?wU({r:(n=this.rgba).r,g:n.g,b:n.b,a:e}):ZX(this.rgba.a,3);var n},e.prototype.hue=function(e){var n=uU(this.rgba);return"number"==typeof e?wU({h:e,s:n.s,l:n.l,a:n.a}):ZX(n.h)},e.prototype.isEqual=function(e){return this.toHex()===wU(e).toHex()},e}(),wU=function(e){return e instanceof kU?e:new kU(e)},_U=[];!function(e){e.forEach(function(e){_U.indexOf(e)<0&&(e(kU,mU),_U.push(e))})}([function(e,n){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},a={};for(var r in t)a[t[r]]=r;var o={};e.prototype.toName=function(n){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,i,s=a[this.toHex()];if(s)return s;if(null==n?void 0:n.closest){var l=this.toRgb(),c=1/0,d="black";if(!o.length)for(var u in t)o[u]=new e(t[u]).toRgb();for(var p in t){var v=(r=l,i=o[p],Math.pow(r.r-i.r,2)+Math.pow(r.g-i.g,2)+Math.pow(r.b-i.b,2));v<c&&(c=v,d=p)}return d}},n.string.push([function(n){var a=n.toLowerCase(),r="transparent"===a?"#0000":t[a];return r?new e(r).toRgb():null},"name"])}]);const CU=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(n){if(n instanceof e)this._value=this.cloneSource(n._value),this._int=n._int,this._components.set(n._components);else{if(null===n)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,n))&&(this.normalize(n),this._value=this.cloneSource(n))}}get value(){return this._value}cloneSource(e){return"string"==typeof e||"number"==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):"object"==typeof e&&null!==e?{...e}:e}isSourceEqual(e,n){const t=typeof e;if(t!==typeof n)return!1;if("number"===t||"string"===t||e instanceof Number)return e===n;if(Array.isArray(e)&&Array.isArray(n)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(n))return e.length===n.length&&e.every((e,t)=>e===n[t]);if(null!==e&&null!==n){const t=Object.keys(e),a=Object.keys(n);return t.length===a.length&&t.every(t=>e[t]===n[t])}return e===n}toRgba(){const[e,n,t,a]=this._components;return{r:e,g:n,b:t,a}}toRgb(){const[e,n,t]=this._components;return{r:e,g:n,b:t}}toRgbaString(){const[e,n,t]=this.toUint8RgbArray();return`rgba(${e},${n},${t},${this.alpha})`}toUint8RgbArray(e){const[n,t,a]=this._components;return(e=e??[])[0]=Math.round(255*n),e[1]=Math.round(255*t),e[2]=Math.round(255*a),e}toRgbArray(e){e=e??[];const[n,t,a]=this._components;return e[0]=n,e[1]=t,e[2]=a,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(n){const[t,a,r,o]=e.temp.setValue(n)._components;return this._components[0]*=t,this._components[1]*=a,this._components[2]*=r,this._components[3]*=o,this.refreshInt(),this._value=null,this}premultiply(e,n=!0){return n&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,n=!0){if(1===e)return(255<<24)+this._int;if(0===e)return n?0:this._int;let t=this._int>>16&255,a=this._int>>8&255,r=255&this._int;return n&&(t=t*e+.5|0,a=a*e+.5|0,r=r*e+.5|0),(255*e<<24)+(t<<16)+(a<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[n,t,a]=this._components;return this._components[0]=Math.round(n*e)/e,this._components[1]=Math.round(t*e)/e,this._components[2]=Math.round(a*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[n,t,a,r]=this._components;return e[0]=n,e[1]=t,e[2]=a,e[3]=r,e}normalize(n){let t,a,r,o;if(("number"==typeof n||n instanceof Number)&&n>=0&&n<=16777215)t=(n>>16&255)/255,a=(n>>8&255)/255,r=(255&n)/255,o=1;else if((Array.isArray(n)||n instanceof Float32Array)&&n.length>=3&&n.length<=4)n=this._clamp(n),[t,a,r,o=1]=n;else if((n instanceof Uint8Array||n instanceof Uint8ClampedArray)&&n.length>=3&&n.length<=4)n=this._clamp(n,0,255),[t,a,r,o=255]=n,t/=255,a/=255,r/=255,o/=255;else if("string"==typeof n||"object"==typeof n){if("string"==typeof n){const t=e.HEX_PATTERN.exec(n);t&&(n=`#${t[2]}`)}const i=wU(n);i.isValid()&&(({r:t,g:a,b:r,a:o}=i.rgba),t/=255,a/=255,r/=255)}if(void 0===t)throw new Error(`Unable to convert color ${n}`);this._components[0]=t,this._components[1]=a,this._components[2]=r,this._components[3]=o,this.refreshInt()}refreshInt(){this._clamp(this._components);const[e,n,t]=this._components;this._int=(255*e<<16)+(255*n<<8)+(255*t|0)}_clamp(e,n=0,t=1){return"number"==typeof e?Math.min(Math.max(e,n),t):(e.forEach((a,r)=>{e[r]=Math.min(Math.max(a,n),t)}),e)}};CU.shared=new CU,CU.temp=new CU,CU.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let AU=CU;const SU=function(){const e=[],n=[];for(let t=0;t<32;t++)e[t]=t,n[t]=t;e[oX.NORMAL_NPM]=oX.NORMAL,e[oX.ADD_NPM]=oX.ADD,e[oX.SCREEN_NPM]=oX.SCREEN,n[oX.NORMAL]=oX.NORMAL_NPM,n[oX.ADD]=oX.ADD_NPM,n[oX.SCREEN]=oX.SCREEN_NPM;const t=[];return t.push(n),t.push(e),t}();function LU(e,n){return SU[n?1:0][e]}function EU(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}function TU(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}function IU(e){return!(e&e-1||!e)}function RU(e){let n=(e>65535?1:0)<<4,t=((e>>>=n)>255?1:0)<<3;return n|=t,t=((e>>>=t)>15?1:0)<<2,n|=t,t=((e>>>=t)>3?1:0)<<1,n|=t,n|(e>>>=t)>>1}function MU(e,n,t){const a=e.length;let r;if(n>=a||0===t)return;const o=a-(t=n+t>a?a-n:t);for(r=n;r<o;++r)e[r]=e[r+t];e.length=o}function PU(e){return 0===e?0:e<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let DU=0;function zU(){return++DU}const NU=class{constructor(e,n,t,a){this.left=e,this.top=n,this.right=t,this.bottom=a}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};NU.EMPTY=new NU(0,0,0,0);let $U=NU;const OU={},FU=Object.create(null),jU=Object.create(null);class BU{constructor(e,n,t){this._canvas=wX.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=t||wX.RESOLUTION,this.resize(e,n)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,n){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(n*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function XU(e,n,t){for(let a=0,r=4*t*n;a<n;++a,r+=4)if(0!==e[r+3])return!1;return!0}function UU(e,n,t,a,r){const o=4*n;for(let n=a,i=a*o+4*t;n<=r;++n,i+=o)if(0!==e[i+3])return!1;return!0}function WU(e,n=1){const t=wX.RETINA_PREFIX?.exec(e);return t?parseFloat(t[1]):n}var qU=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(qU||{});const GU=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"!=typeof e)throw new Error("Invalid extension type");return"string"==typeof(e={...e}).type&&(e.type=[e.type]),e},HU=(e,n)=>GU(e).priority??n,VU={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(GU).forEach(e=>{e.type.forEach(n=>this._removeHandlers[n]?.(e))}),this},add(...e){return e.map(GU).forEach(e=>{e.type.forEach(n=>{const t=this._addHandlers,a=this._queue;t[n]?t[n]?.(e):(a[n]=a[n]||[],a[n]?.push(e))})}),this},handle(e,n,t){const a=this._addHandlers,r=this._removeHandlers;if(a[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);a[e]=n,r[e]=t;const o=this._queue;return o[e]&&(o[e]?.forEach(e=>n(e)),delete o[e]),this},handleByMap(e,n){return this.handle(e,e=>{e.name&&(n[e.name]=e.ref)},e=>{e.name&&delete n[e.name]})},handleByList(e,n,t=-1){return this.handle(e,e=>{n.includes(e.ref)||(n.push(e.ref),n.sort((e,n)=>HU(n,t)-HU(e,t)))},e=>{const t=n.indexOf(e.ref);-1!==t&&n.splice(t,1)})}};class QU{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const KU=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function YU(e){let n="";for(let t=0;t<e;++t)t>0&&(n+="\nelse "),t<e-1&&(n+=`if(test == ${t}.0){}`);return n}class JU{constructor(){this.data=0,this.blendMode=oX.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==oX.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new JU;return e.depthTest=!1,e.blend=!0,e}}JU.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const ZU=[];function eW(e,n){if(!e)return null;let t="";if("string"==typeof e){const n=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);n&&(t=n[1].toLowerCase())}for(let a=ZU.length-1;a>=0;--a){const r=ZU[a];if(r.test&&r.test(e,t))return new r(e,n)}throw new Error("Unrecognized source type to auto-detect Resource")}class nW{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,n,t,a,r,o,i,s){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let d=0,u=c.length;d<u;d++)c[d][l](e,n,t,a,r,o,i,s);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return-1!==n&&(this.ensureNonAliasedItems(),this.items.splice(n,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(nW.prototype,{dispatch:{value:nW.prototype.emit},run:{value:nW.prototype.emit}});class tW{constructor(e=0,n=0){this._width=e,this._height=n,this.destroyed=!1,this.internal=!1,this.onResize=new nW("setRealSize"),this.onUpdate=new nW("update"),this.onError=new nW("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,n){(e!==this._width||n!==this._height)&&(this._width=e,this._height=n,this.onResize.emit(e,n))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,n,t){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,n){return!1}}class aW extends tW{constructor(e,n){const{width:t,height:a}=n||{};if(!t||!a)throw new Error("BufferResource width or height invalid");super(t,a),this.data=e,this.unpackAlignment=n.unpackAlignment??4}upload(e,n,t){const a=e.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,this.unpackAlignment),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.alphaMode===fX.UNPACK);const r=n.realWidth,o=n.realHeight;return t.width===r&&t.height===o?a.texSubImage2D(n.target,0,0,0,r,o,n.format,t.type,this.data):(t.width=r,t.height=o,a.texImage2D(n.target,0,t.internalFormat,r,o,0,n.format,t.type,this.data)),!0}dispose(){this.data=null}static test(e){return null===e||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const rW={scaleMode:uX.NEAREST,alphaMode:fX.NPM},oW=class e extends BX{constructor(n=null,t=null){super(),t=Object.assign({},e.defaultOptions,t);const{alphaMode:a,mipmap:r,anisotropicLevel:o,scaleMode:i,width:s,height:l,wrapMode:c,format:d,type:u,target:p,resolution:v,resourceOptions:f}=t;n&&!(n instanceof tW)&&((n=eW(n,f)).internal=!0),this.resolution=v||wX.RESOLUTION,this.width=Math.round((s||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=o,this._wrapMode=c,this._scaleMode=i,this.format=d,this.type=u,this.target=p,this.alphaMode=a,this.uid=zU(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=s>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(n)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,n){let t;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,t=!0),void 0!==n&&n!==this.mipmap&&(this.mipmap=n,t=!0),t&&this.dirtyStyleId++,this}setSize(e,n,t){return t=t||this.resolution,this.setRealSize(e*t,n*t,t)}setRealSize(e,n,t){return this.resolution=t||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(n)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=IU(this.realWidth)&&IU(this.realHeight)}setResolution(e){const n=this.resolution;return n===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*n)/e,this.height=Math.round(this.height*n)/e,this.emit("update",this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete jU[this.cacheId],delete FU[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(n,t,a=wX.STRICT_TEXTURE_CACHE){const r="string"==typeof n;let o=null;if(r)o=n;else{if(!n._pixiId){const e=t?.pixiIdPrefix||"pixiid";n._pixiId=`${e}_${zU()}`}o=n._pixiId}let i=jU[o];if(r&&a&&!i)throw new Error(`The cacheId "${o}" does not exist in BaseTextureCache.`);return i||(i=new e(n,t),i.cacheId=o,e.addToCache(i,o)),i}static fromBuffer(n,t,a,r){n=n||new Float32Array(t*a*4);const o=new aW(n,{width:t,height:a,...r?.resourceOptions});let i,s;return n instanceof Float32Array?(i=sX.RGBA,s=cX.FLOAT):n instanceof Int32Array?(i=sX.RGBA_INTEGER,s=cX.INT):n instanceof Uint32Array?(i=sX.RGBA_INTEGER,s=cX.UNSIGNED_INT):n instanceof Int16Array?(i=sX.RGBA_INTEGER,s=cX.SHORT):n instanceof Uint16Array?(i=sX.RGBA_INTEGER,s=cX.UNSIGNED_SHORT):n instanceof Int8Array?(i=sX.RGBA,s=cX.BYTE):(i=sX.RGBA,s=cX.UNSIGNED_BYTE),o.internal=!0,new e(o,Object.assign({},rW,{type:s,format:i},r))}static addToCache(e,n){n&&(e.textureCacheIds.includes(n)||e.textureCacheIds.push(n),jU[n]&&jU[n]!==e&&console.warn(`BaseTexture added to the cache with an id [${n}] that already had an entry`),jU[n]=e)}static removeFromCache(e){if("string"==typeof e){const n=jU[e];if(n){const t=n.textureCacheIds.indexOf(e);return t>-1&&n.textureCacheIds.splice(t,1),delete jU[e],n}}else if(e?.textureCacheIds){for(let n=0;n<e.textureCacheIds.length;++n)delete jU[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null}};oW.defaultOptions={mipmap:vX.POW2,anisotropicLevel:0,scaleMode:uX.LINEAR,wrapMode:pX.CLAMP,alphaMode:fX.UNPACK,target:lX.TEXTURE_2D,format:sX.RGBA,type:cX.UNSIGNED_BYTE},oW._globalBatch=0;let iW=oW;class sW{constructor(){this.texArray=null,this.blend=0,this.type=iX.TRIANGLES,this.start=0,this.size=0,this.data=null}}let lW=0;class cW{constructor(e,n=!0,t=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=t,this.static=n,this.id=lW++,this.disposeRunner=new nW("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?xX.ELEMENT_ARRAY_BUFFER:xX.ARRAY_BUFFER}get index(){return this.type===xX.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new cW(e)}}class dW{constructor(e,n=0,t=!1,a=cX.FLOAT,r,o,i,s=1){this.buffer=e,this.size=n,this.normalized=t,this.type=a,this.stride=r,this.start=o,this.instance=i,this.divisor=s}destroy(){this.buffer=null}static from(e,n,t,a,r){return new dW(e,n,t,a,r)}}const uW={Float32Array,Uint32Array,Int32Array,Uint8Array},pW={5126:4,5123:2,5121:1};let vW=0;const fW={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class hW{constructor(e=[],n={}){this.buffers=e,this.indexBuffer=null,this.attributes=n,this.glVertexArrayObjects={},this.id=vW++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new nW("disposeGeometry"),this.refCount=0}addAttribute(e,n,t=0,a=!1,r,o,i,s=!1){if(!n)throw new Error("You must pass a buffer when creating an attribute");n instanceof cW||(n instanceof Array&&(n=new Float32Array(n)),n=new cW(n));const l=e.split("|");if(l.length>1){for(let e=0;e<l.length;e++)this.addAttribute(l[e],n,t,a,r);return this}let c=this.buffers.indexOf(n);return-1===c&&(this.buffers.push(n),c=this.buffers.length-1),this.attributes[e]=new dW(c,t,a,r,o,i,s),this.instanced=this.instanced||s,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof cW||(e instanceof Array&&(e=new Uint16Array(e)),e=new cW(e)),e.type=xX.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],n=[],t=new cW;let a;for(a in this.attributes){const t=this.attributes[a],r=this.buffers[t.buffer];e.push(r.data),n.push(t.size*pW[t.type]/4),t.buffer=0}for(t.data=function(e,n){let t=0,a=0;const r={};for(let r=0;r<e.length;r++)a+=n[r],t+=e[r].length;const o=new ArrayBuffer(4*t);let i=null,s=0;for(let t=0;t<e.length;t++){const l=n[t],c=e[t],d=EU(c);r[d]||(r[d]=new uW[d](o)),i=r[d];for(let e=0;e<c.length;e++)i[(e/l|0)*a+s+e%l]=c[e];s+=l}return new Float32Array(o)}(e,n),a=0;a<this.buffers.length;a++)this.buffers[a]!==this.indexBuffer&&this.buffers[a].destroy();return this.buffers=[t],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const n=this.attributes[e];return this.buffers[n.buffer].data.length/(n.stride/4||n.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new hW;for(let n=0;n<this.buffers.length;n++)e.buffers[n]=new cW(this.buffers[n].data.slice(0));for(const n in this.attributes){const t=this.attributes[n];e.attributes[n]=new dW(t.buffer,t.size,t.normalized,t.type,t.stride,t.start,t.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=xX.ELEMENT_ARRAY_BUFFER),e}static merge(e){const n=new hW,t=[],a=[],r=[];let o;for(let n=0;n<e.length;n++){o=e[n];for(let e=0;e<o.buffers.length;e++)a[e]=a[e]||0,a[e]+=o.buffers[e].data.length,r[e]=0}for(let e=0;e<o.buffers.length;e++)t[e]=new(fW[EU(o.buffers[e].data)])(a[e]),n.buffers[e]=new cW(t[e]);for(let n=0;n<e.length;n++){o=e[n];for(let e=0;e<o.buffers.length;e++)t[e].set(o.buffers[e].data,r[e]),r[e]+=o.buffers[e].data.length}if(n.attributes=o.attributes,o.indexBuffer){n.indexBuffer=n.buffers[o.buffers.indexOf(o.indexBuffer)],n.indexBuffer.type=xX.ELEMENT_ARRAY_BUFFER;let t=0,a=0,r=0,i=0;for(let e=0;e<o.buffers.length;e++)if(o.buffers[e]!==o.indexBuffer){i=e;break}for(const e in o.attributes){const n=o.attributes[e];(0|n.buffer)===i&&(a+=n.size*pW[n.type]/4)}for(let o=0;o<e.length;o++){const s=e[o].indexBuffer.data;for(let e=0;e<s.length;e++)n.indexBuffer.data[e+r]+=t;t+=e[o].buffers[i].data.length/a,r+=s.length}}return n}}class mW extends hW{constructor(e=!1){super(),this._buffer=new cW(null,e,!1),this._indexBuffer=new cW(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,cX.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,cX.FLOAT).addAttribute("aColor",this._buffer,4,!0,cX.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,cX.FLOAT).addIndex(this._indexBuffer)}}const gW=2*Math.PI,bW=180/Math.PI,yW=Math.PI/180;var xW=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(xW||{});class kW{constructor(e=0,n=0){this.x=0,this.y=0,this.x=e,this.y=n}clone(){return new kW(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,n=e){return this.x=e,this.y=n,this}}kW.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const wW=[new kW,new kW,new kW,new kW];class _W{constructor(e=0,n=0,t=0,a=0){this.x=Number(e),this.y=Number(n),this.width=Number(t),this.height=Number(a),this.type=xW.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new _W(0,0,0,0)}clone(){return new _W(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,n){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&n>=this.y&&n<this.y+this.height}intersects(e,n){if(!n){const n=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=n)return!1;const t=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>t}const t=this.left,a=this.right,r=this.top,o=this.bottom;if(a<=t||o<=r)return!1;const i=wW[0].set(e.left,e.top),s=wW[1].set(e.left,e.bottom),l=wW[2].set(e.right,e.top),c=wW[3].set(e.right,e.bottom);if(l.x<=i.x||s.y<=i.y)return!1;const d=Math.sign(n.a*n.d-n.b*n.c);if(0===d||(n.apply(i,i),n.apply(s,s),n.apply(l,l),n.apply(c,c),Math.max(i.x,s.x,l.x,c.x)<=t||Math.min(i.x,s.x,l.x,c.x)>=a||Math.max(i.y,s.y,l.y,c.y)<=r||Math.min(i.y,s.y,l.y,c.y)>=o))return!1;const u=d*(s.y-i.y),p=d*(i.x-s.x),v=u*t+p*r,f=u*a+p*r,h=u*t+p*o,m=u*a+p*o;if(Math.max(v,f,h,m)<=u*i.x+p*i.y||Math.min(v,f,h,m)>=u*c.x+p*c.y)return!1;const g=d*(i.y-l.y),b=d*(l.x-i.x),y=g*t+b*r,x=g*a+b*r,k=g*t+b*o,w=g*a+b*o;return!(Math.max(y,x,k,w)<=g*i.x+b*i.y||Math.min(y,x,k,w)>=g*c.x+b*c.y)}pad(e=0,n=e){return this.x-=e,this.y-=n,this.width+=2*e,this.height+=2*n,this}fit(e){const n=Math.max(this.x,e.x),t=Math.min(this.x+this.width,e.x+e.width),a=Math.max(this.y,e.y),r=Math.min(this.y+this.height,e.y+e.height);return this.x=n,this.width=Math.max(t-n,0),this.y=a,this.height=Math.max(r-a,0),this}ceil(e=1,n=.001){const t=Math.ceil((this.x+this.width-n)*e)/e,a=Math.ceil((this.y+this.height-n)*e)/e;return this.x=Math.floor((this.x+n)*e)/e,this.y=Math.floor((this.y+n)*e)/e,this.width=t-this.x,this.height=a-this.y,this}enlarge(e){const n=Math.min(this.x,e.x),t=Math.max(this.x+this.width,e.x+e.width),a=Math.min(this.y,e.y),r=Math.max(this.y+this.height,e.y+e.height);return this.x=n,this.width=t-n,this.y=a,this.height=r-a,this}}_W.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class CW{constructor(e=0,n=0,t=0){this.x=e,this.y=n,this.radius=t,this.type=xW.CIRC}clone(){return new CW(this.x,this.y,this.radius)}contains(e,n){if(this.radius<=0)return!1;const t=this.radius*this.radius;let a=this.x-e,r=this.y-n;return a*=a,r*=r,a+r<=t}getBounds(){return new _W(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}CW.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class AW{constructor(e=0,n=0,t=0,a=0){this.x=e,this.y=n,this.width=t,this.height=a,this.type=xW.ELIP}clone(){return new AW(this.x,this.y,this.width,this.height)}contains(e,n){if(this.width<=0||this.height<=0)return!1;let t=(e-this.x)/this.width,a=(n-this.y)/this.height;return t*=t,a*=a,t+a<=1}getBounds(){return new _W(this.x-this.width,this.y-this.height,this.width,this.height)}}AW.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class SW{constructor(...e){let n=Array.isArray(e[0])?e[0]:e;if("number"!=typeof n[0]){const e=[];for(let t=0,a=n.length;t<a;t++)e.push(n[t].x,n[t].y);n=e}this.points=n,this.type=xW.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),n=new SW(e);return n.closeStroke=this.closeStroke,n}contains(e,n){let t=!1;const a=this.points.length/2;for(let r=0,o=a-1;r<a;o=r++){const a=this.points[2*r],i=this.points[2*r+1],s=this.points[2*o],l=this.points[2*o+1];i>n!=l>n&&e<(n-i)/(l-i)*(s-a)+a&&(t=!t)}return t}}SW.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,n)=>`${e}, ${n}`,"")}]`};class LW{constructor(e=0,n=0,t=0,a=0,r=20){this.x=e,this.y=n,this.width=t,this.height=a,this.radius=r,this.type=xW.RREC}clone(){return new LW(this.x,this.y,this.width,this.height,this.radius)}contains(e,n){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&n>=this.y&&n<=this.y+this.height){const t=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(n>=this.y+t&&n<=this.y+this.height-t||e>=this.x+t&&e<=this.x+this.width-t)return!0;let a=e-(this.x+t),r=n-(this.y+t);const o=t*t;if(a*a+r*r<=o||(a=e-(this.x+this.width-t),a*a+r*r<=o)||(r=n-(this.y+this.height-t),a*a+r*r<=o)||(a=e-(this.x+t),a*a+r*r<=o))return!0}return!1}}LW.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class EW{constructor(e=1,n=0,t=0,a=1,r=0,o=0){this.array=null,this.a=e,this.b=n,this.c=t,this.d=a,this.tx=r,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,n,t,a,r,o){return this.a=e,this.b=n,this.c=t,this.d=a,this.tx=r,this.ty=o,this}toArray(e,n){this.array||(this.array=new Float32Array(9));const t=n||this.array;return e?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t}apply(e,n){n=n||new kW;const t=e.x,a=e.y;return n.x=this.a*t+this.c*a+this.tx,n.y=this.b*t+this.d*a+this.ty,n}applyInverse(e,n){n=n||new kW;const t=1/(this.a*this.d+this.c*-this.b),a=e.x,r=e.y;return n.x=this.d*t*a+-this.c*t*r+(this.ty*this.c-this.tx*this.d)*t,n.y=this.a*t*r+-this.b*t*a+(-this.ty*this.a+this.tx*this.b)*t,n}translate(e,n){return this.tx+=e,this.ty+=n,this}scale(e,n){return this.a*=e,this.d*=n,this.c*=e,this.b*=n,this.tx*=e,this.ty*=n,this}rotate(e){const n=Math.cos(e),t=Math.sin(e),a=this.a,r=this.c,o=this.tx;return this.a=a*n-this.b*t,this.b=a*t+this.b*n,this.c=r*n-this.d*t,this.d=r*t+this.d*n,this.tx=o*n-this.ty*t,this.ty=o*t+this.ty*n,this}append(e){const n=this.a,t=this.b,a=this.c,r=this.d;return this.a=e.a*n+e.b*a,this.b=e.a*t+e.b*r,this.c=e.c*n+e.d*a,this.d=e.c*t+e.d*r,this.tx=e.tx*n+e.ty*a+this.tx,this.ty=e.tx*t+e.ty*r+this.ty,this}setTransform(e,n,t,a,r,o,i,s,l){return this.a=Math.cos(i+l)*r,this.b=Math.sin(i+l)*r,this.c=-Math.sin(i-s)*o,this.d=Math.cos(i-s)*o,this.tx=e-(t*this.a+a*this.c),this.ty=n-(t*this.b+a*this.d),this}prepend(e){const n=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const n=this.a,t=this.c;this.a=n*e.a+this.b*e.c,this.b=n*e.b+this.b*e.d,this.c=t*e.a+this.d*e.c,this.d=t*e.b+this.d*e.d}return this.tx=n*e.a+this.ty*e.c+e.tx,this.ty=n*e.b+this.ty*e.d+e.ty,this}decompose(e){const n=this.a,t=this.b,a=this.c,r=this.d,o=e.pivot,i=-Math.atan2(-a,r),s=Math.atan2(t,n),l=Math.abs(i+s);return l<1e-5||Math.abs(gW-l)<1e-5?(e.rotation=s,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=i,e.skew.y=s),e.scale.x=Math.sqrt(n*n+t*t),e.scale.y=Math.sqrt(a*a+r*r),e.position.x=this.tx+(o.x*n+o.y*a),e.position.y=this.ty+(o.x*t+o.y*r),e}invert(){const e=this.a,n=this.b,t=this.c,a=this.d,r=this.tx,o=e*a-n*t;return this.a=a/o,this.b=-n/o,this.c=-t/o,this.d=e/o,this.tx=(t*this.ty-a*r)/o,this.ty=-(e*this.ty-n*r)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new EW;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new EW}static get TEMP_MATRIX(){return new EW}}EW.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const TW=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],IW=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],RW=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],MW=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],PW=[],DW=[],zW=Math.sign;!function(){for(let e=0;e<16;e++){const n=[];PW.push(n);for(let t=0;t<16;t++){const a=zW(TW[e]*TW[t]+RW[e]*IW[t]),r=zW(IW[e]*TW[t]+MW[e]*IW[t]),o=zW(TW[e]*RW[t]+RW[e]*MW[t]),i=zW(IW[e]*RW[t]+MW[e]*MW[t]);for(let e=0;e<16;e++)if(TW[e]===a&&IW[e]===r&&RW[e]===o&&MW[e]===i){n.push(e);break}}}for(let e=0;e<16;e++){const n=new EW;n.set(TW[e],IW[e],RW[e],MW[e],0,0),DW.push(n)}}();const NW={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>TW[e],uY:e=>IW[e],vX:e=>RW[e],vY:e=>MW[e],inv:e=>8&e?15&e:7&-e,add:(e,n)=>PW[e][n],sub:(e,n)=>PW[e][NW.inv(n)],rotate180:e=>4^e,isVertical:e=>2==(3&e),byDirection:(e,n)=>2*Math.abs(e)<=Math.abs(n)?n>=0?NW.S:NW.N:2*Math.abs(n)<=Math.abs(e)?e>0?NW.E:NW.W:n>0?e>0?NW.SE:NW.SW:e>0?NW.NE:NW.NW,matrixAppendRotationInv:(e,n,t=0,a=0)=>{const r=DW[NW.inv(n)];r.tx=t,r.ty=a,e.append(r)}};class $W{constructor(e,n,t=0,a=0){this._x=t,this._y=a,this.cb=e,this.scope=n}clone(e=this.cb,n=this.scope){return new $W(e,n,this._x,this._y)}set(e=0,n=e){return(this._x!==e||this._y!==n)&&(this._x=e,this._y=n,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}$W.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const OW=class{constructor(){this.worldTransform=new EW,this.localTransform=new EW,this.position=new $W(this.onChange,this,0,0),this.scale=new $W(this.onChange,this,1,1),this.pivot=new $W(this.onChange,this,0,0),this.skew=new $W(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const n=this.localTransform;if(this._localID!==this._currentLocalID&&(n.a=this._cx*this.scale.x,n.b=this._sx*this.scale.x,n.c=this._cy*this.scale.y,n.d=this._sy*this.scale.y,n.tx=this.position.x-(this.pivot.x*n.a+this.pivot.y*n.c),n.ty=this.position.y-(this.pivot.x*n.b+this.pivot.y*n.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const t=e.worldTransform,a=this.worldTransform;a.a=n.a*t.a+n.b*t.c,a.b=n.a*t.b+n.b*t.d,a.c=n.c*t.a+n.d*t.c,a.d=n.c*t.b+n.d*t.d,a.tx=n.tx*t.a+n.ty*t.c+t.tx,a.ty=n.tx*t.b+n.ty*t.d+t.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};OW.IDENTITY=new OW;let FW=OW;FW.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const jW=[{test:e=>"float"===e.type&&1===e.size&&!e.isArray,code:e=>`\n            if(uv["${e}"] !== ud["${e}"].value)\n            {\n                ud["${e}"].value = uv["${e}"]\n                gl.uniform1f(ud["${e}"].location, uv["${e}"])\n            }\n            `},{test:(e,n)=>!("sampler2D"!==e.type&&"samplerCube"!==e.type&&"sampler2DArray"!==e.type||1!==e.size||e.isArray||null!=n&&void 0===n.castToBaseTexture),code:e=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${e}"], t);\n\n            if(ud["${e}"].value !== t)\n            {\n                ud["${e}"].value = t;\n                gl.uniform1i(ud["${e}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(e,n)=>"mat3"===e.type&&1===e.size&&!e.isArray&&void 0!==n.a,code:e=>`\n            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));\n            `,codeUbo:e=>`\n                var ${e}_matrix = uv.${e}.toArray(true);\n\n                data[offset] = ${e}_matrix[0];\n                data[offset+1] = ${e}_matrix[1];\n                data[offset+2] = ${e}_matrix[2];\n        \n                data[offset + 4] = ${e}_matrix[3];\n                data[offset + 5] = ${e}_matrix[4];\n                data[offset + 6] = ${e}_matrix[5];\n        \n                data[offset + 8] = ${e}_matrix[6];\n                data[offset + 9] = ${e}_matrix[7];\n                data[offset + 10] = ${e}_matrix[8];\n            `},{test:(e,n)=>"vec2"===e.type&&1===e.size&&!e.isArray&&void 0!==n.x,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${e}"].location, v.x, v.y);\n                }`,codeUbo:e=>`\n                v = uv.${e};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:e=>"vec2"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);\n                }\n            `},{test:(e,n)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==n.width,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(e,n)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==n.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(e,n)=>"vec3"===e.type&&1===e.size&&!e.isArray&&void 0!==n.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:e=>"vec4"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])\n                }`}],BW={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},XW={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},UW={};let WW,qW=UW;const GW={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function HW(e){return GW[e]}let VW=null;const QW={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function KW(e,n){if(!VW){const n=Object.keys(QW);VW={};for(let t=0;t<n.length;++t){const a=n[t];VW[e[a]]=QW[a]}}return VW[n]}function YW(e,n,t){if("precision"!==e.substring(0,9)){let a=n;return n===gX.HIGH&&t!==gX.HIGH&&(a=gX.MEDIUM),`precision ${a} float;\n${e}`}return t!==gX.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}let JW=0;const ZW={},eq=class e{constructor(n,t,a="pixi-shader",r={}){this.extra={},this.id=JW++,this.vertexSrc=n||e.defaultVertexSrc,this.fragmentSrc=t||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(a=a.replace(/\s+/g,"-"),ZW[a]?(ZW[a]++,a+=`-${ZW[a]}`):ZW[a]=1,this.vertexSrc=`#define SHADER_NAME ${a}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${a}\n${this.fragmentSrc}`,this.vertexSrc=YW(this.vertexSrc,e.defaultVertexPrecision,gX.HIGH),this.fragmentSrc=YW(this.fragmentSrc,e.defaultFragmentPrecision,function(){if(!WW){WW=gX.MEDIUM;const e=function(){if(qW===UW||qW?.isContextLost()){const e=wX.ADAPTER.createCanvas();let n;wX.PREFER_ENV>=tX.WEBGL2&&(n=e.getContext("webgl2",{})),n||(n=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),n?n.getExtension("WEBGL_draw_buffers"):n=null),qW=n}return qW}();if(e&&e.getShaderPrecisionFormat){const n=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);n&&(WW=n.precision?gX.HIGH:gX.MEDIUM)}}return WW}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(n,t,a){const r=n+t;let o=OU[r];return o||(OU[r]=o=new e(n,t,a)),o}};eq.defaultVertexPrecision=gX.HIGH,eq.defaultFragmentPrecision=jX.apple.device?gX.HIGH:gX.MEDIUM;let nq=eq,tq=0;class aq{constructor(e,n,t){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=tq++,this.static=!!n,this.ubo=!!t,e instanceof cW?(this.buffer=e,this.buffer.type=xX.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new cW(new Float32Array(1)),this.buffer.type=xX.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,n,t){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new aq(n,t)}static from(e,n,t){return new aq(e,n,t)}static uboFrom(e,n){return new aq(e,n??!0,!0)}}class rq{constructor(e,n){this.uniformBindCount=0,this.program=e,this.uniformGroup=n?n instanceof aq?n:new aq(n):new aq({}),this.disposeRunner=new nW("disposeShader")}checkUniformExists(e,n){if(n.uniforms[e])return!0;for(const t in n.uniforms){const a=n.uniforms[t];if(!0===a.group&&this.checkUniformExists(e,a))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,n,t){const a=nq.from(e,n);return new rq(a,t)}}class oq{constructor(e,n){if(this.vertexSrc=e,this.fragTemplate=n,this.programCache={},this.defaultGroupCache={},!n.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!n.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;this.defaultGroupCache[e]=aq.from({uSamplers:n},!0);let t=this.fragTemplate;t=t.replace(/%count%/gi,`${e}`),t=t.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new nq(this.vertexSrc,t)}const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new EW,default:this.defaultGroupCache[e]};return new rq(this.programCache[e],n)}generateSampleSrc(e){let n="";n+="\n",n+="\n";for(let t=0;t<e;t++)t>0&&(n+="\nelse "),t<e-1&&(n+=`if(vTextureId < ${t}.5)`),n+="\n{",n+=`\n\tcolor = texture2D(uSamplers[${t}], vTextureCoord);`,n+="\n}";return n+="\n",n+="\n",n}}class iq{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class sq{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const lq=class e extends sq{constructor(n){super(n),this.setShaderGenerator(),this.geometryClass=mW,this.vertexSize=6,this.state=JU.for2d(),this.size=4*e.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),n.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(){let e=!0;const n=wX.ADAPTER.getNavigator();if(jX.tablet||jX.phone){if(jX.apple.device){const t=n.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(jX.android.device){const t=n.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!jX.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return WX("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:n=e.defaultVertexSrc,fragment:t=e.defaultFragmentTemplate}={}){this.shaderGenerator=new oq(n,t)}contextChange(){const n=this.renderer.gl;wX.PREFER_ENV===tX.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),e.defaultMaxTextures),this.maxTextures=function(e,n){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=n.createShader(n.FRAGMENT_SHADER);for(;;){const a=KU.replace(/%forloop%/gi,YU(e));if(n.shaderSource(t,a),n.compileShader(t),n.getShaderParameter(t,n.COMPILE_STATUS))break;e=e/2|0}return e}(this.maxTextures,n)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:n,_textureArrayPool:t}=e,a=this.size/4,r=Math.floor(a/this.maxTextures)+1;for(;n.length<a;)n.push(new sW);for(;t.length<r;)t.push(new iq);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:n,maxTextures:t}=this,a=e._textureArrayPool,r=this.renderer.batch,o=this._tempBoundTextures,i=this.renderer.textureGC.count;let s=++iW._globalBatch,l=0,c=a[0],d=0;r.copyBoundTextures(o,t);for(let e=0;e<this._bufferSize;++e){const u=n[e];n[e]=null,u._batchEnabled!==s&&(c.count>=t&&(r.boundArray(c,o,s,t),this.buildDrawCalls(c,d,e),d=e,c=a[++l],++s),u._batchEnabled=s,u.touched=i,c.elements[c.count++]=u)}c.count>0&&(r.boundArray(c,o,s,t),this.buildDrawCalls(c,d,this._bufferSize),++l,++s);for(let e=0;e<o.length;e++)o[e]=null;iW._globalBatch=s}buildDrawCalls(n,t,a){const{_bufferedElements:r,_attributeBuffer:o,_indexBuffer:i,vertexSize:s}=this,l=e._drawCallPool;let c=this._dcIndex,d=this._aIndex,u=this._iIndex,p=l[c];p.start=this._iIndex,p.texArray=n;for(let e=t;e<a;++e){const a=r[e],v=a._texture.baseTexture,f=SU[v.alphaMode?1:0][a.blendMode];r[e]=null,t<e&&p.blend!==f&&(p.size=u-p.start,t=e,p=l[++c],p.texArray=n,p.start=u),this.packInterleavedGeometry(a,o,i,d,u),d+=a.vertexData.length/2*s,u+=a.indices.length,p.blend=f}t<a&&(p.size=u-p.start,++c),this._dcIndex=c,this._aIndex=d,this._iIndex=u}bindAndClearTexArray(e){const n=this.renderer.texture;for(let t=0;t<e.count;t++)n.bind(e.elements[t],e.ids[t]),e.elements[t]=null;e.count=0}updateGeometry(){const{_packedGeometries:n,_attributeBuffer:t,_indexBuffer:a}=this;e.canUploadSameBuffer?(n[this._flushId]._buffer.update(t.rawBinaryData),n[this._flushId]._indexBuffer.update(a),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,n[this._flushId]=new this.geometryClass),n[this._flushId]._buffer.update(t.rawBinaryData),n[this._flushId]._indexBuffer.update(a),this.renderer.geometry.bind(n[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const n=this._dcIndex,{gl:t,state:a}=this.renderer,r=e._drawCallPool;let o=null;for(let e=0;e<n;e++){const{texArray:n,type:i,size:s,start:l,blend:c}=r[e];o!==n&&(o=n,this.bindAndClearTexArray(n)),this.state.blendMode=c,a.set(this.state),t.drawElements(i,s,t.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),e.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const n=TU(Math.ceil(e/8)),t=RU(n),a=8*n;this._aBuffers.length<=t&&(this._iBuffers.length=t+1);let r=this._aBuffers[a];return r||(this._aBuffers[a]=r=new QU(a*this.vertexSize*4)),r}getIndexBuffer(e){const n=TU(Math.ceil(e/12)),t=RU(n),a=12*n;this._iBuffers.length<=t&&(this._iBuffers.length=t+1);let r=this._iBuffers[t];return r||(this._iBuffers[t]=r=new Uint16Array(a)),r}packInterleavedGeometry(e,n,t,a,r){const{uint32View:o,float32View:i}=n,s=a/this.vertexSize,l=e.uvs,c=e.indices,d=e.vertexData,u=e._texture.baseTexture._batchLocation,p=Math.min(e.worldAlpha,1),v=AU.shared.setValue(e._tintRGB).toPremultiplied(p,e._texture.baseTexture.alphaMode>0);for(let e=0;e<d.length;e+=2)i[a++]=d[e],i[a++]=d[e+1],i[a++]=l[e],i[a++]=l[e+1],o[a++]=v,i[a++]=u;for(let e=0;e<c.length;e++)t[r++]=s+c[e]}};lq.defaultBatchSize=4096,lq.extension={name:"batch",type:qU.RendererPlugin},lq._drawCallPool=[],lq._textureArrayPool=[];let cq=lq;VU.add(cq);const dq=class e extends rq{constructor(n,t,a){super(nq.from(n||e.defaultVertexSrc,t||e.defaultFragmentSrc),a),this.padding=0,this.resolution=e.defaultResolution,this.multisample=e.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new JU}apply(e,n,t,a,r){e.applyFilter(this,n,t,a)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};dq.defaultResolution=1,dq.defaultMultisample=yX.NONE;let uq=dq;class pq{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new AU(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:n,background:t,backgroundAlpha:a}=e,r=t??n;void 0!==r&&(this.color=r),this.alpha=a}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}pq.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},pq.extension={type:[qU.RendererSystem,qU.CanvasRendererSystem],name:"background"},VU.add(pq);class vq{constructor(e){this.renderer=e,this.emptyRenderer=new sq(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,n){const{boundTextures:t}=this.renderer.texture;for(let a=n-1;a>=0;--a)e[a]=t[a]||null,e[a]&&(e[a]._batchLocation=a)}boundArray(e,n,t,a){const{elements:r,ids:o,count:i}=e;let s=0;for(let e=0;e<i;e++){const i=r[e],l=i._batchLocation;if(l>=0&&l<a&&n[l]===i)o[e]=l;else for(;s<a;){const a=n[s];if(!a||a._batchEnabled!==t||a._batchLocation!==s){o[e]=s,i._batchLocation=s,n[s]=i;break}s++}}}destroy(){this.renderer=null}}vq.extension={type:qU.RendererSystem,name:"batch"},VU.add(vq);let fq=0;class hq{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=fq++}init(e){if(e.context)this.initFromContext(e.context);else{const n=this.renderer.background.alpha<1,t=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:n,premultipliedAlpha:t,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=fq++,this.renderer.runners.contextChange.emit(e);const n=this.renderer.view;void 0!==n.addEventListener&&(n.addEventListener("webglcontextlost",this.handleContextLost,!1),n.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const n=this.createContext(this.renderer.view,e);this.initFromContext(n)}createContext(e,n){let t;if(wX.PREFER_ENV>=tX.WEBGL2&&(t=e.getContext("webgl2",n)),t)this.webGLVersion=2;else if(this.webGLVersion=1,t=e.getContext("webgl",n)||e.getContext("experimental-webgl",n),!t)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=t,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,n={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,n,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,n,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const n=e.getContextAttributes(),t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;t&&(this.webGLVersion=2),n&&!n.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const a=t||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=a,a||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}hq.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},hq.extension={type:qU.RendererSystem,name:"context"},VU.add(hq);class mq{constructor(e,n){if(this.width=Math.round(e),this.height=Math.round(n),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new nW("disposeFramebuffer"),this.multisample=yX.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,n){return this.colorTextures[e]=n||new iW(null,{scaleMode:uX.NEAREST,resolution:1,mipmap:vX.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new iW(null,{scaleMode:uX.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:vX.OFF,format:sX.DEPTH_COMPONENT,type:cX.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,n){if(e=Math.round(e),n=Math.round(n),!e||!n)throw new Error("Framebuffer width and height must not be zero");if(e!==this.width||n!==this.height){this.width=e,this.height=n,this.dirtyId++,this.dirtySize++;for(let t=0;t<this.colorTextures.length;t++){const a=this.colorTextures[t],r=a.resolution;a.setSize(e/r,n/r)}if(this.depthTexture){const t=this.depthTexture.resolution;this.depthTexture.setSize(e/t,n/t)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class gq extends iW{constructor(e={}){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=yX.NONE),super(null,e),this.mipmap=vX.OFF,this.valid=!0,this._clear=new AU([0,0,0,0]),this.framebuffer=new mq(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,n){this.framebuffer.resize(e*this.resolution,n*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class bq extends tW{constructor(e){const n=e;super(n.naturalWidth||n.videoWidth||n.displayWidth||n.width,n.naturalHeight||n.videoHeight||n.displayHeight||n.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,n,t){void 0!==t||n.startsWith("data:")?!1!==t&&(e.crossOrigin="string"==typeof t?t:"anonymous"):e.crossOrigin=function(e,n=globalThis.location){if(e.startsWith("data:"))return"";n=n||globalThis.location;const t=new URL(e,document.baseURI);return t.hostname!==n.hostname||t.port!==n.port||t.protocol!==n.protocol?"anonymous":""}(n)}upload(e,n,t,a){const r=e.gl,o=n.realWidth,i=n.realHeight;if(a=a||this.source,typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement){if(!a.complete||0===a.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement&&a.readyState<=1)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.alphaMode===fX.UNPACK),this.noSubImage||n.target!==r.TEXTURE_2D||t.width!==o||t.height!==i?(t.width=o,t.height=i,r.texImage2D(n.target,0,t.internalFormat,n.format,t.type,a)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,n.format,t.type,a),!0}update(){if(this.destroyed)return;const e=this.source,n=e.naturalWidth||e.videoWidth||e.width,t=e.naturalHeight||e.videoHeight||e.height;this.resize(n,t),super.update()}dispose(){this.source=null}}class yq extends bq{constructor(e,n){if(n=n||{},"string"==typeof e){const t=new Image;bq.crossOrigin(t,e,n.crossorigin),t.src=e,e=t}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(n.createBitmap??wX.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,this.bitmap=null,this._load=null,!1!==n.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise((e,n)=>{const t=this.source;this.url=t.src;const a=()=>{this.destroyed||(t.onload=null,t.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};t.complete&&t.src?a():(t.onload=a,t.onerror=e=>{n(e),this.onError.emit(e)})})),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const n=globalThis.createImageBitmap,t=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:t?"cors":"no-cors"}).then(e=>e.blob()).then(t=>n(t,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===fX.UNPACK?"premultiply":"none"})).then(e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,n,t){if("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,n,t);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,n,t,this.bitmap),!this.preserveBitmap){let e=!0;const a=n._glTextures;for(const r in a){const o=a[r];if(o!==t&&o.dirtyId!==n.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&("string"==typeof e||e instanceof HTMLImageElement)}}class xq{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,n,t){const a=n.width,r=n.height;if(t){const n=e.width/2/a,o=e.height/2/r,i=e.x/a+n,s=e.y/r+o;t=NW.add(t,NW.NW),this.x0=i+n*NW.uX(t),this.y0=s+o*NW.uY(t),t=NW.add(t,2),this.x1=i+n*NW.uX(t),this.y1=s+o*NW.uY(t),t=NW.add(t,2),this.x2=i+n*NW.uX(t),this.y2=s+o*NW.uY(t),t=NW.add(t,2),this.x3=i+n*NW.uX(t),this.y3=s+o*NW.uY(t)}else this.x0=e.x/a,this.y0=e.y/r,this.x1=(e.x+e.width)/a,this.y1=e.y/r,this.x2=(e.x+e.width)/a,this.y2=(e.y+e.height)/r,this.x3=e.x/a,this.y3=(e.y+e.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}xq.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const kq=new xq;function wq(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class _q extends BX{constructor(e,n,t,a,r,o,i){if(super(),this.noFrame=!1,n||(this.noFrame=!0,n=new _W(0,0,1,1)),e instanceof _q&&(e=e.baseTexture),this.baseTexture=e,this._frame=n,this.trim=a,this.valid=!1,this.destroyed=!1,this._uvs=kq,this.uvMatrix=null,this.orig=t||n,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new kW(o.x,o.y):new kW(0,0),this.defaultBorders=i,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=n:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e?.url&&FU[e.url]&&_q.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,_q.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const e=this._frame.clone(),n=this._frame===this.orig?e:this.orig.clone(),t=new _q(this.baseTexture,!this.noFrame&&e,n,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(t._frame=e),t}updateUvs(){this._uvs===kq&&(this._uvs=new xq),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,n={},t=wX.STRICT_TEXTURE_CACHE){const a="string"==typeof e;let r=null;if(a)r=e;else if(e instanceof iW){if(!e.cacheId){const t=n?.pixiIdPrefix||"pixiid";e.cacheId=`${t}-${zU()}`,iW.addToCache(e,e.cacheId)}r=e.cacheId}else{if(!e._pixiId){const t=n?.pixiIdPrefix||"pixiid";e._pixiId=`${t}_${zU()}`}r=e._pixiId}let o=FU[r];if(a&&t&&!o)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return o||e instanceof iW?!o&&e instanceof iW&&(o=new _q(e),_q.addToCache(o,r)):(n.resolution||(n.resolution=WU(e)),o=new _q(new iW(e,n)),o.baseTexture.cacheId=r,iW.addToCache(o.baseTexture,r),_q.addToCache(o,r)),o}static fromURL(e,n){const t=Object.assign({autoLoad:!1},n?.resourceOptions),a=_q.from(e,Object.assign({resourceOptions:t},n),!1),r=a.baseTexture.resource;return a.baseTexture.valid?Promise.resolve(a):r.load().then(()=>Promise.resolve(a))}static fromBuffer(e,n,t,a){return new _q(iW.fromBuffer(e,n,t,a))}static fromLoader(e,n,t,a){const r=new iW(e,Object.assign({scaleMode:iW.defaultOptions.scaleMode,resolution:WU(n)},a)),{resource:o}=r;o instanceof yq&&(o.url=n);const i=new _q(r);return t||(t=n),iW.addToCache(i.baseTexture,t),_q.addToCache(i,t),t!==n&&(iW.addToCache(i.baseTexture,n),_q.addToCache(i,n)),i.baseTexture.valid?Promise.resolve(i):new Promise(e=>{i.baseTexture.once("loaded",()=>e(i))})}static addToCache(e,n){n&&(e.textureCacheIds.includes(n)||e.textureCacheIds.push(n),FU[n]&&FU[n]!==e&&console.warn(`Texture added to the cache with an id [${n}] that already had an entry`),FU[n]=e)}static removeFromCache(e){if("string"==typeof e){const n=FU[e];if(n){const t=n.textureCacheIds.indexOf(e);return t>-1&&n.textureCacheIds.splice(t,1),delete FU[e],n}}else if(e?.textureCacheIds){for(let n=0;n<e.textureCacheIds.length;++n)FU[e.textureCacheIds[n]]===e&&delete FU[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:n,y:t,width:a,height:r}=e,o=n+a>this.baseTexture.width,i=t+r>this.baseTexture.height;if(o||i){const e=o&&i?"and":"or",s=`X: ${n} + ${a} = ${n+a} > ${this.baseTexture.width}`,l=`Y: ${t} + ${r} = ${t+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${s} ${e} ${l}`)}this.valid=a&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return _q._EMPTY||(_q._EMPTY=new _q(new iW),wq(_q._EMPTY),wq(_q._EMPTY.baseTexture)),_q._EMPTY}static get WHITE(){if(!_q._WHITE){const e=wX.ADAPTER.createCanvas(16,16),n=e.getContext("2d");e.width=16,e.height=16,n.fillStyle="white",n.fillRect(0,0,16,16),_q._WHITE=new _q(iW.from(e)),wq(_q._WHITE),wq(_q._WHITE.baseTexture)}return _q._WHITE}}class Cq extends _q{constructor(e,n){super(e,n),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,n,t=!0){const a=this.baseTexture.resolution,r=Math.round(e*a)/a,o=Math.round(n*a)/a;this.valid=r>0&&o>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=o,t&&this.baseTexture.resize(r,o),this.updateUvs()}setResolution(e){const{baseTexture:n}=this;n.resolution!==e&&(n.setResolution(e),this.resize(n.width,n.height,!1))}static create(e){return new Cq(new gq(e))}}class Aq{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,n,t=yX.NONE){const a=new gq(Object.assign({width:e,height:n,resolution:1,multisample:t},this.textureOptions));return new Cq(a)}getOptimalTexture(e,n,t=1,a=yX.NONE){let r;e=Math.max(Math.ceil(e*t-1e-6),1),n=Math.max(Math.ceil(n*t-1e-6),1),this.enableFullScreen&&e===this._pixelsWidth&&n===this._pixelsHeight?r=a>1?-a:-1:(r=((65535&(e=TU(e)))<<16|65535&(n=TU(n)))>>>0,a>1&&(r+=4294967296*a)),this.texturePool[r]||(this.texturePool[r]=[]);let o=this.texturePool[r].pop();return o||(o=this.createTexture(e,n,a)),o.filterPoolKey=r,o.setResolution(t),o}getFilterTexture(e,n,t){const a=this.getOptimalTexture(e.width,e.height,n||e.resolution,t||yX.NONE);return a.filterFrame=e.filterFrame,a}returnTexture(e){const n=e.filterPoolKey;e.filterFrame=null,this.texturePool[n].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const e in this.texturePool){const n=this.texturePool[e];if(n)for(let e=0;e<n.length;e++)n[e].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const n=this.texturePool[e];if(n)for(let e=0;e<n.length;e++)n[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Aq.SCREEN_KEY=-1;class Sq extends hW{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Lq extends hW{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new cW(this.vertices),this.uvBuffer=new cW(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,n){let t=0,a=0;return this.uvs[0]=t,this.uvs[1]=a,this.uvs[2]=t+n.width/e.width,this.uvs[3]=a,this.uvs[4]=t+n.width/e.width,this.uvs[5]=a+n.height/e.height,this.uvs[6]=t,this.uvs[7]=a+n.height/e.height,t=n.x,a=n.y,this.vertices[0]=t,this.vertices[1]=a,this.vertices[2]=t+n.width,this.vertices[3]=a,this.vertices[4]=t+n.width,this.vertices[5]=a+n.height,this.vertices[6]=t,this.vertices[7]=a+n.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Eq{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=yX.NONE,this.sourceFrame=new _W,this.destinationFrame=new _W,this.bindingSourceFrame=new _W,this.bindingDestinationFrame=new _W,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Tq=[new kW,new kW,new kW,new kW],Iq=new EW;class Rq{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Aq,this.statePool=[],this.quad=new Sq,this.quadUv=new Lq,this.tempRect=new _W,this.activeState={},this.globalUniforms=new aq({outputFrame:new _W,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,n){const t=this.renderer,a=this.defaultFilterStack,r=this.statePool.pop()||new Eq,o=t.renderTexture;let i,s;if(o.current){const e=o.current;i=e.resolution,s=e.multisample}else i=t.resolution,s=t.multisample;let l=n[0].resolution||i,c=n[0].multisample??s,d=n[0].padding,u=n[0].autoFit,p=n[0].legacy??!0;for(let e=1;e<n.length;e++){const t=n[e];l=Math.min(l,t.resolution||i),c=Math.min(c,t.multisample??s),d=this.useMaxPadding?Math.max(d,t.padding):d+t.padding,u=u&&t.autoFit,p=p||(t.legacy??!0)}1===a.length&&(this.defaultFilterStack[0].renderTexture=o.current),a.push(r),r.resolution=l,r.multisample=c,r.legacy=p,r.target=e,r.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),r.sourceFrame.pad(d);const v=this.tempRect.copyFrom(o.sourceFrame);t.projection.transform&&this.transformAABB(Iq.copyFrom(t.projection.transform).invert(),v),u?(r.sourceFrame.fit(v),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(v)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,o.current?o.current.resolution:t.resolution,o.sourceFrame,o.destinationFrame,t.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,l,c),r.filters=n,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=r.sourceFrame.width,f.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(o.sourceFrame),r.bindingDestinationFrame.copyFrom(o.destinationFrame),r.transform=t.projection.transform,t.projection.transform=null,o.bind(r.renderTexture,r.sourceFrame,f),t.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,n=e.pop(),t=n.filters;this.activeState=n;const a=this.globalUniforms.uniforms;a.outputFrame=n.sourceFrame,a.resolution=n.resolution;const r=a.inputSize,o=a.inputPixel,i=a.inputClamp;if(r[0]=n.destinationFrame.width,r[1]=n.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],o[0]=Math.round(r[0]*n.resolution),o[1]=Math.round(r[1]*n.resolution),o[2]=1/o[0],o[3]=1/o[1],i[0]=.5*o[2],i[1]=.5*o[3],i[2]=n.sourceFrame.width*r[2]-.5*o[2],i[3]=n.sourceFrame.height*r[3]-.5*o[3],n.legacy){const e=a.filterArea;e[0]=n.destinationFrame.width,e[1]=n.destinationFrame.height,e[2]=n.sourceFrame.x,e[3]=n.sourceFrame.y,a.filterClamp=a.inputClamp}this.globalUniforms.update();const s=e[e.length-1];if(this.renderer.framebuffer.blit(),1===t.length)t[0].apply(this,n.renderTexture,s.renderTexture,hX.BLEND,n),this.returnFilterTexture(n.renderTexture);else{let e=n.renderTexture,a=this.getOptimalFilterTexture(e.width,e.height,n.resolution);a.filterFrame=e.filterFrame;let r=0;for(r=0;r<t.length-1;++r){1===r&&n.multisample>1&&(a=this.getOptimalFilterTexture(e.width,e.height,n.resolution),a.filterFrame=e.filterFrame),t[r].apply(this,e,a,hX.CLEAR,n);const o=e;e=a,a=o}t[r].apply(this,e,s.renderTexture,hX.BLEND,n),r>1&&n.multisample>1&&this.returnFilterTexture(n.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(a)}n.clear(),this.statePool.push(n)}bindAndClear(e,n=hX.CLEAR){const{renderTexture:t,state:a}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const n=this.tempRect;n.x=0,n.y=0,n.width=e.filterFrame.width,n.height=e.filterFrame.height,t.bind(e,e.filterFrame,n)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?t.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&a.stateId||this.forceClear;(n===hX.CLEAR||n===hX.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,n,t,a){const r=this.renderer;r.state.set(e.state),this.bindAndClear(t,a),e.uniforms.uSampler=n,e.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(n._frame,n.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(iX.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(iX.TRIANGLE_STRIP))}calculateSpriteMatrix(e,n){const{sourceFrame:t,destinationFrame:a}=this.activeState,{orig:r}=n._texture,o=e.set(a.width,0,0,a.height,t.x,t.y),i=n.worldTransform.copyTo(EW.TEMP_MATRIX);return i.invert(),o.prepend(i),o.scale(1/r.width,1/r.height),o.translate(n.anchor.x,n.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,n,t=1,a=yX.NONE){return this.texturePool.getOptimalTexture(e,n,t,a)}getFilterTexture(e,n,t){if("number"==typeof e){const t=e;e=n,n=t}e=e||this.activeState.renderTexture;const a=this.texturePool.getOptimalTexture(e.width,e.height,n||e.resolution,t||yX.NONE);return a.filterFrame=e.filterFrame,a}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,n){const t=Tq[0],a=Tq[1],r=Tq[2],o=Tq[3];t.set(n.left,n.top),a.set(n.left,n.bottom),r.set(n.right,n.top),o.set(n.right,n.bottom),e.apply(t,t),e.apply(a,a),e.apply(r,r),e.apply(o,o);const i=Math.min(t.x,a.x,r.x,o.x),s=Math.min(t.y,a.y,r.y,o.y),l=Math.max(t.x,a.x,r.x,o.x),c=Math.max(t.y,a.y,r.y,o.y);n.x=i,n.y=s,n.width=l-i,n.height=c-s}roundFrame(e,n,t,a,r){if(!(e.width<=0||e.height<=0||t.width<=0||t.height<=0)){if(r){const{a:e,b:n,c:t,d:a}=r;if((Math.abs(n)>1e-4||Math.abs(t)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(a)>1e-4))return}(r=r?Iq.copyFrom(r):Iq.identity()).translate(-t.x,-t.y).scale(a.width/t.width,a.height/t.height).translate(a.x,a.y),this.transformAABB(r,e),e.ceil(n),this.transformAABB(r.invert(),e)}}}Rq.extension={type:qU.RendererSystem,name:"filter"},VU.add(Rq);class Mq{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=yX.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Pq=new _W;class Dq{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new mq(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new _W,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let n=this.renderer.context.extensions.drawBuffers,t=this.renderer.context.extensions.depthTexture;wX.PREFER_ENV===tX.WEBGL_LEGACY&&(n=null,t=null),n?e.drawBuffers=e=>n.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),t||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,n,t=0){const{gl:a}=this;if(e){const r=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,a.bindFramebuffer(a.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==t&&(e.dirtyId++,e.dirtyFormat++,r.mipLevel=t),r.dirtyId!==e.dirtyId&&(r.dirtyId=e.dirtyId,r.dirtyFormat!==e.dirtyFormat?(r.dirtyFormat=e.dirtyFormat,r.dirtySize=e.dirtySize,this.updateFramebuffer(e,t)):r.dirtySize!==e.dirtySize&&(r.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let n=0;n<e.colorTextures.length;n++){const t=e.colorTextures[n];this.renderer.texture.unbind(t.parentTextureArray||t)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),n){const e=n.width>>t,a=n.height>>t,r=e/n.width;this.setViewport(n.x*r,n.y*r,e,a)}else{const n=e.width>>t,a=e.height>>t;this.setViewport(0,0,n,a)}}else this.current&&(this.current=null,a.bindFramebuffer(a.FRAMEBUFFER,null)),n?this.setViewport(n.x,n.y,n.width,n.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,n,t,a){const r=this.viewport;e=Math.round(e),n=Math.round(n),t=Math.round(t),a=Math.round(a),(r.width!==t||r.height!==a||r.x!==e||r.y!==n)&&(r.x=e,r.y=n,r.width=t,r.height=a,this.gl.viewport(e,n,t,a))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,n,t,a,r=rX.COLOR|rX.DEPTH){const{gl:o}=this;o.clearColor(e,n,t,a),o.clear(r)}initFramebuffer(e){const{gl:n}=this,t=new Mq(n.createFramebuffer());return t.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=t,this.managedFramebuffers.push(e),e.disposeRunner.add(this),t}resizeFramebuffer(e){const{gl:n}=this,t=e.glFramebuffers[this.CONTEXT_UID];if(t.stencil){let a;n.bindRenderbuffer(n.RENDERBUFFER,t.stencil),a=1===this.renderer.context.webGLVersion?n.DEPTH_STENCIL:e.depth&&e.stencil?n.DEPTH24_STENCIL8:e.depth?n.DEPTH_COMPONENT24:n.STENCIL_INDEX8,t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,a,e.width,e.height):n.renderbufferStorage(n.RENDERBUFFER,a,e.width,e.height)}const a=e.colorTextures;let r=a.length;n.drawBuffers||(r=Math.min(r,1));for(let o=0;o<r;o++){const r=a[o],i=r.parentTextureArray||r;this.renderer.texture.bind(i,0),0===o&&t.msaaBuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,t.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,i._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,n){const{gl:t}=this,a=e.glFramebuffers[this.CONTEXT_UID],r=e.colorTextures;let o=r.length;t.drawBuffers||(o=Math.min(o,1)),a.multisample>1&&this.canMultisampleFramebuffer(e)?a.msaaBuffer=a.msaaBuffer||t.createRenderbuffer():a.msaaBuffer&&(t.deleteRenderbuffer(a.msaaBuffer),a.msaaBuffer=null,a.blitFramebuffer&&(a.blitFramebuffer.dispose(),a.blitFramebuffer=null));const i=[];for(let s=0;s<o;s++){const o=r[s],l=o.parentTextureArray||o;this.renderer.texture.bind(l,0),0===s&&a.msaaBuffer?(t.bindRenderbuffer(t.RENDERBUFFER,a.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,a.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,a.msaaBuffer)):(t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+s,o.target,l._glTextures[this.CONTEXT_UID].texture,n),i.push(t.COLOR_ATTACHMENT0+s))}if(i.length>1&&t.drawBuffers(i),e.depthTexture&&this.writeDepthTexture){const a=e.depthTexture;this.renderer.texture.bind(a,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,n)}if(!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture)a.stencil&&(t.deleteRenderbuffer(a.stencil),a.stencil=null);else{let n,r;a.stencil=a.stencil||t.createRenderbuffer(),1===this.renderer.context.webGLVersion?(n=t.DEPTH_STENCIL_ATTACHMENT,r=t.DEPTH_STENCIL):e.depth&&e.stencil?(n=t.DEPTH_STENCIL_ATTACHMENT,r=t.DEPTH24_STENCIL8):e.depth?(n=t.DEPTH_ATTACHMENT,r=t.DEPTH_COMPONENT24):(n=t.STENCIL_ATTACHMENT,r=t.STENCIL_INDEX8),t.bindRenderbuffer(t.RENDERBUFFER,a.stencil),a.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,a.multisample,r,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,r,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,a.stencil)}}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:n}=this;let t=yX.NONE;if(e<=1||null===n)return t;for(let a=0;a<n.length;a++)if(n[a]<=e){t=n[a];break}return 1===t&&(t=yX.NONE),t}blit(e,n,t){const{current:a,renderer:r,gl:o,CONTEXT_UID:i}=this;if(2!==r.context.webGLVersion||!a)return;const s=a.glFramebuffers[i];if(!s)return;if(!e){if(!s.msaaBuffer)return;const n=a.colorTextures[0];if(!n)return;s.blitFramebuffer||(s.blitFramebuffer=new mq(a.width,a.height),s.blitFramebuffer.addColorTexture(0,n)),(e=s.blitFramebuffer).colorTextures[0]!==n&&(e.colorTextures[0]=n,e.dirtyId++,e.dirtyFormat++),(e.width!==a.width||e.height!==a.height)&&(e.width=a.width,e.height=a.height,e.dirtyId++,e.dirtySize++)}n||((n=Pq).width=a.width,n.height=a.height),t||(t=n);const l=n.width===t.width&&n.height===t.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,s.framebuffer),o.blitFramebuffer(n.left,n.top,n.right,n.bottom,t.left,t.top,t.right,t.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,n){const t=e.glFramebuffers[this.CONTEXT_UID],a=this.gl;if(!t)return;delete e.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(e);r>=0&&this.managedFramebuffers.splice(r,1),e.disposeRunner.remove(this),n||(a.deleteFramebuffer(t.framebuffer),t.msaaBuffer&&a.deleteRenderbuffer(t.msaaBuffer),t.stencil&&a.deleteRenderbuffer(t.stencil)),t.blitFramebuffer&&this.disposeFramebuffer(t.blitFramebuffer,n)}disposeAll(e){const n=this.managedFramebuffers;this.managedFramebuffers=[];for(let t=0;t<n.length;t++)this.disposeFramebuffer(n[t],e)}forceStencil(){const e=this.current;if(!e)return;const n=e.glFramebuffers[this.CONTEXT_UID];if(!n||n.stencil&&e.stencil)return;e.stencil=!0;const t=e.width,a=e.height,r=this.gl,o=n.stencil=r.createRenderbuffer();let i,s;r.bindRenderbuffer(r.RENDERBUFFER,o),1===this.renderer.context.webGLVersion?(i=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH_STENCIL):e.depth?(i=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH24_STENCIL8):(i=r.STENCIL_ATTACHMENT,s=r.STENCIL_INDEX8),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,s,t,a):r.renderbufferStorage(r.RENDERBUFFER,s,t,a),r.framebufferRenderbuffer(r.FRAMEBUFFER,i,r.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new _W}destroy(){this.renderer=null}}Dq.extension={type:qU.RendererSystem,name:"framebuffer"},VU.add(Dq);const zq={5126:4,5123:2,5121:1};class Nq{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,n=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==n.webGLVersion){let n=this.renderer.context.extensions.vertexArrayObject;wX.PREFER_ENV===tX.WEBGL_LEGACY&&(n=null),n?(e.createVertexArray=()=>n.createVertexArrayOES(),e.bindVertexArray=e=>n.bindVertexArrayOES(e),e.deleteVertexArray=e=>n.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==n.webGLVersion){const n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=(e,t)=>n.vertexAttribDivisorANGLE(e,t),e.drawElementsInstanced=(e,t,a,r,o)=>n.drawElementsInstancedANGLE(e,t,a,r,o),e.drawArraysInstanced=(e,t,a,r)=>n.drawArraysInstancedANGLE(e,t,a,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===n.webGLVersion||!!n.extensions.uint32ElementIndex}bind(e,n){n=n||this.renderer.shader.shader;const{gl:t}=this;let a=e.glVertexArrayObjects[this.CONTEXT_UID],r=!1;a||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=a={},r=!0);const o=a[n.program.id]||this.initGeometryVao(e,n,r);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?t.bindVertexArray(o):this.activateVao(e,n.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,n=this.renderer.buffer;for(let t=0;t<e.buffers.length;t++){const a=e.buffers[t];n.update(a)}}checkCompatibility(e,n){const t=e.attributes,a=n.attributeData;for(const e in a)if(!t[e])throw new Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,n){const t=e.attributes,a=n.attributeData,r=["g",e.id];for(const e in t)a[e]&&r.push(e,a[e].location);return r.join("-")}initGeometryVao(e,n,t=!0){const a=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,i=n.program;i.glPrograms[r]||this.renderer.shader.generateProgram(n),this.checkCompatibility(e,i);const s=this.getSignature(e,i),l=e.glVertexArrayObjects[this.CONTEXT_UID];let c=l[s];if(c)return l[i.id]=c,c;const d=e.buffers,u=e.attributes,p={},v={};for(const e in d)p[e]=0,v[e]=0;for(const e in u)!u[e].size&&i.attributeData[e]?u[e].size=i.attributeData[e].size:u[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),p[u[e].buffer]+=u[e].size*zq[u[e].type];for(const e in u){const n=u[e],t=n.size;void 0===n.stride&&(p[n.buffer]===t*zq[n.type]?n.stride=0:n.stride=p[n.buffer]),void 0===n.start&&(n.start=v[n.buffer],v[n.buffer]+=t*zq[n.type])}c=a.createVertexArray(),a.bindVertexArray(c);for(let e=0;e<d.length;e++){const n=d[e];o.bind(n),t&&n._glBuffers[r].refCount++}return this.activateVao(e,i),l[i.id]=c,l[s]=c,a.bindVertexArray(null),o.unbind(xX.ARRAY_BUFFER),c}disposeGeometry(e,n){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const t=e.glVertexArrayObjects[this.CONTEXT_UID],a=this.gl,r=e.buffers,o=this.renderer?.buffer;if(e.disposeRunner.remove(this),t){if(o)for(let e=0;e<r.length;e++){const t=r[e]._glBuffers[this.CONTEXT_UID];t&&(t.refCount--,0===t.refCount&&!n&&o.dispose(r[e],n))}if(!n)for(const e in t)if("g"===e[0]){const n=t[e];this._activeVao===n&&this.unbind(),a.deleteVertexArray(n)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const n=Object.keys(this.managedGeometries);for(let t=0;t<n.length;t++)this.disposeGeometry(this.managedGeometries[n[t]],e)}activateVao(e,n){const t=this.gl,a=this.CONTEXT_UID,r=this.renderer.buffer,o=e.buffers,i=e.attributes;e.indexBuffer&&r.bind(e.indexBuffer);let s=null;for(const e in i){const l=i[e],c=o[l.buffer],d=c._glBuffers[a];if(n.attributeData[e]){s!==d&&(r.bind(c),s=d);const a=n.attributeData[e].location;if(t.enableVertexAttribArray(a),t.vertexAttribPointer(a,l.size,l.type||t.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");t.vertexAttribDivisor(a,l.divisor)}}}}draw(e,n,t,a){const{gl:r}=this,o=this._activeGeometry;if(o.indexBuffer){const i=o.indexBuffer.data.BYTES_PER_ELEMENT,s=2===i?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===i||4===i&&this.canUseUInt32ElementIndex?o.instanced?r.drawElementsInstanced(e,n||o.indexBuffer.data.length,s,(t||0)*i,a||1):r.drawElements(e,n||o.indexBuffer.data.length,s,(t||0)*i):console.warn("unsupported index buffer type: uint32")}else o.instanced?r.drawArraysInstanced(e,t,n||o.getSize(),a||1):r.drawArrays(e,t,n||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Nq.extension={type:qU.RendererSystem,name:"geometry"},VU.add(Nq);const $q=new EW;class Oq{constructor(e,n){this._texture=e,this.mapCoord=new EW,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof n>"u"?.5:n,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,n){void 0===n&&(n=e);const t=this.mapCoord;for(let a=0;a<e.length;a+=2){const r=e[a],o=e[a+1];n[a]=r*t.a+o*t.c+t.tx,n[a+1]=r*t.b+o*t.d+t.ty}return n}update(e){const n=this._texture;if(!n||!n.valid||!e&&this._textureID===n._updateID)return!1;this._textureID=n._updateID,this._updateID++;const t=n._uvs;this.mapCoord.set(t.x1-t.x0,t.y1-t.y0,t.x3-t.x0,t.y3-t.y0,t.x0,t.y0);const a=n.orig,r=n.trim;r&&($q.set(a.width/r.width,0,0,a.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append($q));const o=n.baseTexture,i=this.uClampFrame,s=this.clampMargin/o.resolution,l=this.clampOffset;return i[0]=(n._frame.x+s+l)/o.width,i[1]=(n._frame.y+s+l)/o.height,i[2]=(n._frame.x+n._frame.width-s+l)/o.width,i[3]=(n._frame.y+n._frame.height-s+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=n._frame.width===o.width&&n._frame.height===o.height&&0===n.rotate,!0}}class Fq extends uq{constructor(e,n,t){let a=null;"string"!=typeof e&&void 0===n&&void 0===t&&(a=e,e=void 0,n=void 0,t=void 0),super(e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",n||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",t),this.maskSprite=a,this.maskMatrix=new EW}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,n,t,a){const r=this._maskSprite,o=r._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Oq(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,r).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,n,t,a))}}class jq{constructor(e=null){this.type=bX.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=uq.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=bX.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Bq{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,n){let t=n;if(!t.isMaskData){const e=this.maskDataPool.pop()||new jq;e.pooled=!0,e.maskObject=n,t=e}const a=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(t.copyCountersOrReset(a),t._colorMask=a?a._colorMask:15,t.autoDetect&&this.detect(t),t._target=e,t.type!==bX.SPRITE&&this.maskStack.push(t),t.enabled)switch(t.type){case bX.SCISSOR:this.renderer.scissor.push(t);break;case bX.STENCIL:this.renderer.stencil.push(t);break;case bX.SPRITE:t.copyCountersOrReset(null),this.pushSpriteMask(t);break;case bX.COLOR:this.pushColorMask(t)}t.type===bX.SPRITE&&this.maskStack.push(t)}pop(e){const n=this.maskStack.pop();if(n&&n._target===e){if(n.enabled)switch(n.type){case bX.SCISSOR:this.renderer.scissor.pop(n);break;case bX.STENCIL:this.renderer.stencil.pop(n.maskObject);break;case bX.SPRITE:this.popSpriteMask(n);break;case bX.COLOR:this.popColorMask(n)}if(n.reset(),n.pooled&&this.maskDataPool.push(n),0!==this.maskStack.length){const e=this.maskStack[this.maskStack.length-1];e.type===bX.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const n=e.maskObject;n?n.isSprite?e.type=bX.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=bX.SCISSOR:e.type=bX.STENCIL:e.type=bX.COLOR}pushSpriteMask(e){const{maskObject:n}=e,t=e._target;let a=e._filters;a||(a=this.alphaMaskPool[this.alphaMaskIndex],a||(a=this.alphaMaskPool[this.alphaMaskIndex]=[new Fq])),a[0].resolution=e.resolution,a[0].multisample=e.multisample,a[0].maskSprite=n;const r=t.filterArea;t.filterArea=n.getBounds(!0),this.renderer.filter.push(t,a),t.filterArea=r,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const n=e._colorMask,t=e._colorMask=n&e.colorMask;t!==n&&this.renderer.gl.colorMask(!!(1&t),!!(2&t),!!(4&t),!!(8&t))}popColorMask(e){const n=e._colorMask,t=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;t!==n&&this.renderer.gl.colorMask(!!(1&t),!!(2&t),!!(4&t),!!(8&t))}destroy(){this.renderer=null}}Bq.extension={type:qU.RendererSystem,name:"mask"},VU.add(Bq);class Xq{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:n}=this.renderer,t=this.getStackLength();this.maskStack=e;const a=this.getStackLength();a!==t&&(0===a?n.disable(this.glConst):(n.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Uq=new EW,Wq=[],qq=class e extends Xq{constructor(e){super(e),this.glConst=wX.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const n=e._scissorRect,{maskObject:t}=e,{renderer:a}=this,r=a.renderTexture,o=t.getBounds(!0,Wq.pop()??new _W);this.roundFrameToPixels(o,r.current?r.current.resolution:a.resolution,r.sourceFrame,r.destinationFrame,a.projection.transform),n&&o.fit(n),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:n,b:t,c:a,d:r}=e;return(Math.abs(t)>1e-4||Math.abs(a)>1e-4)&&(Math.abs(n)>1e-4||Math.abs(r)>1e-4)}testScissor(n){const{maskObject:t}=n;if(!t.isFastRect||!t.isFastRect()||e.isMatrixRotated(t.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(n);const a=n._scissorRectLocal;return a.width>0&&a.height>0}roundFrameToPixels(n,t,a,r,o){e.isMatrixRotated(o)||((o=o?Uq.copyFrom(o):Uq.identity()).translate(-a.x,-a.y).scale(r.width/a.width,r.height/a.height).translate(r.x,r.y),this.renderer.filter.transformAABB(o,n),n.fit(r),n.x=Math.round(n.x*t),n.y=Math.round(n.y*t),n.width=Math.round(n.width*t),n.height=Math.round(n.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:n}=this.renderer;e._scissorRect||n.enable(n.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:n}=this.renderer;e&&Wq.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():n.disable(n.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let n;n=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,n,e.width,e.height)}};qq.extension={type:qU.RendererSystem,name:"scissor"};let Gq=qq;VU.add(Gq);class Hq extends Xq{constructor(e){super(e),this.glConst=wX.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const n=e.maskObject,{gl:t}=this.renderer,a=e._stencilCounter;0===a&&(this.renderer.framebuffer.forceStencil(),t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT),t.enable(t.STENCIL_TEST)),e._stencilCounter++;const r=e._colorMask;0!==r&&(e._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilFunc(t.EQUAL,a,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.INCR),n.renderable=!0,n.render(this.renderer),this.renderer.batch.flush(),n.renderable=!1,0!==r&&(e._colorMask=r,t.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))),this._useCurrent()}pop(e){const n=this.renderer.gl;if(0===this.getStackLength())n.disable(n.STENCIL_TEST);else{const t=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,a=t?t._colorMask:15;0!==a&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilOp(n.KEEP,n.KEEP,n.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==a&&(t._colorMask=a,n.colorMask(!!(1&a),!!(2&a),!!(4&a),!!(8&a))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Hq.extension={type:qU.RendererSystem,name:"stencil"},VU.add(Hq);class Vq{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(WX("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(WX("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(WX("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){const e=this.rendererPlugins;for(const n in e)this.plugins[n]=new e[n](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Vq.extension={type:[qU.RendererSystem,qU.CanvasRendererSystem],name:"_plugin"},VU.add(Vq);class Qq{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new EW,this.transform=null}update(e,n,t,a){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=n||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,t,a),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(e,n,t,a){const r=this.projectionMatrix,o=a?-1:1;r.identity(),r.a=1/n.width*2,r.d=o*(1/n.height*2),r.tx=-1-n.x*r.a,r.ty=-o-n.y*r.d}setTransform(e){}destroy(){this.renderer=null}}Qq.extension={type:qU.RendererSystem,name:"projection"},VU.add(Qq);const Kq=new FW,Yq=new _W;class Jq{constructor(e){this.renderer=e,this._tempMatrix=new EW}generateTexture(e,n){const{region:t,...a}=n||{},r=t?.copyTo(Yq)||e.getLocalBounds(Yq,!0),o=a.resolution||this.renderer.resolution;r.width=Math.max(r.width,1/o),r.height=Math.max(r.height,1/o),a.width=r.width,a.height=r.height,a.resolution=o,a.multisample??(a.multisample=this.renderer.multisample);const i=Cq.create(a);this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const s=e.transform;return e.transform=Kq,this.renderer.render(e,{renderTexture:i,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=s,i}destroy(){}}Jq.extension={type:[qU.RendererSystem,qU.CanvasRendererSystem],name:"textureGenerator"},VU.add(Jq);const Zq=new _W,eG=new _W;class nG{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new _W,this.destinationFrame=new _W,this.viewportFrame=new _W}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,n,t){const a=this.renderer;let r,o,i;this.current=e,e?(r=e.baseTexture,i=r.resolution,n||(Zq.width=e.frame.width,Zq.height=e.frame.height,n=Zq),t||(eG.x=e.frame.x,eG.y=e.frame.y,eG.width=n.width,eG.height=n.height,t=eG),o=r.framebuffer):(i=a.resolution,n||(Zq.width=a._view.screen.width,Zq.height=a._view.screen.height,n=Zq),t||((t=Zq).width=n.width,t.height=n.height));const s=this.viewportFrame;s.x=t.x*i,s.y=t.y*i,s.width=t.width*i,s.height=t.height*i,e||(s.y=a.view.height-(s.y+s.height)),s.ceil(),this.renderer.framebuffer.bind(o,s),this.renderer.projection.update(t,n,i,!o),e?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(n),this.destinationFrame.copyFrom(t)}clear(e,n){const t=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,a=AU.shared.setValue(e||t);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&a.premultiply(a.alpha);const r=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,i=r.width!==o.width||r.height!==o.height;if(i){let{x:e,y:n,width:t,height:a}=this.viewportFrame;e=Math.round(e),n=Math.round(n),t=Math.round(t),a=Math.round(a),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,n,t,a)}this.renderer.framebuffer.clear(a.red,a.green,a.blue,a.alpha,n),i&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}nG.extension={type:qU.RendererSystem,name:"renderTexture"},VU.add(nG);class tG{constructor(e,n){this.program=e,this.uniformData=n,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function aG(e,n,t){const a=e.createShader(n);return e.shaderSource(a,t),e.compileShader(a),a}function rG(e){const n=new Array(e);for(let e=0;e<n.length;e++)n[e]=!1;return n}function oG(e,n){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*n);case"vec3":return new Float32Array(3*n);case"vec4":return new Float32Array(4*n);case"ivec2":return new Int32Array(2*n);case"ivec3":return new Int32Array(3*n);case"ivec4":return new Int32Array(4*n);case"uvec2":return new Uint32Array(2*n);case"uvec3":return new Uint32Array(3*n);case"uvec4":return new Uint32Array(4*n);case"bool":return!1;case"bvec2":return rG(2*n);case"bvec3":return rG(3*n);case"bvec4":return rG(4*n);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function iG(e,n){const t=e.getShaderSource(n).split("\n").map((e,n)=>`${n}: ${e}`),a=e.getShaderInfoLog(n),r=a.split("\n"),o={},i=r.map(e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(e=>!(!e||o[e]||(o[e]=!0,0))),s=[""];i.forEach(e=>{t[e-1]=`%c${t[e-1]}%c`,s.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=t.join("\n");s[0]=l,console.error(a),console.groupCollapsed("click to view full shader code"),console.warn(...s),console.groupEnd()}function sG(e,n,t,a,r){t.buffer.update(r)}const lG={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},cG={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let dG,uG=0;const pG={textureCount:0,uboCount:0};class vG{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=uG++}systemCheck(){if(!function(){if("boolean"==typeof dG)return dG;try{dG=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{dG=!1}return dG}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,n){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const t=e.program,a=t.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==t&&(this.program=t,this.gl.useProgram(a.program)),n||(pG.textureCount=0,pG.uboCount=0,this.syncUniformGroup(e.uniformGroup,pG)),a}setUniforms(e){const n=this.shader.program,t=n.glPrograms[this.renderer.CONTEXT_UID];n.syncUniforms(t.uniformData,e,this.renderer)}syncUniformGroup(e,n){const t=this.getGlProgram();(!e.static||e.dirtyId!==t.uniformDirtyGroups[e.id])&&(t.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,t,n))}syncUniforms(e,n,t){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(n.uniformData,e.uniforms,this.renderer,t)}createSyncGroups(e){const n=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[n]||(this.cache[n]=function(e,n){const t=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const a in e.uniforms){const r=n[a];if(!r){!0===e.uniforms[a]?.group&&(e.uniforms[a].ubo?t.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${a}, '${a}');\n                    `):t.push(`\n                        renderer.shader.syncUniformGroup(uv.${a}, syncData);\n                    `));continue}const o=e.uniforms[a];let i=!1;for(let e=0;e<jW.length;e++)if(jW[e].test(r,o)){t.push(jW[e].code(a,o)),i=!0;break}if(!i){const e=(1!==r.size||r.isArray?XW:BW)[r.type].replace("location",`ud["${a}"].location`);t.push(`\n            cu = ud["${a}"];\n            cv = cu.value;\n            v = uv["${a}"];\n            ${e};`)}}return new Function("ud","uv","renderer","syncData",t.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[n],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,n){const t=this.getGlProgram();if(!e.static||0!==e.dirtyId||!t.uniformGroups[e.id]){e.dirtyId=0;const a=t.uniformGroups[e.id]||this.createSyncBufferGroup(e,t,n);e.buffer.update(),a(t.uniformData,e.uniforms,this.renderer,pG,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,t.uniformBufferBindings[n])}createSyncBufferGroup(e,n,t){const{gl:a}=this.renderer;this.renderer.buffer.bind(e.buffer);const r=this.gl.getUniformBlockIndex(n.program,t);n.uniformBufferBindings[t]=this.shader.uniformBindCount,a.uniformBlockBinding(n.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let i=this._uboCache[o];if(i||(i=this._uboCache[o]=function(e,n){if(!e.autoManage)return{size:0,syncFunc:sG};const t=function(e,n){const t=[];for(const a in e)n[a]&&t.push(n[a]);return t.sort((e,n)=>e.index-n.index),t}(e.uniforms,n),{uboElements:a,size:r}=function(e){const n=e.map(e=>({data:e,offset:0,dataLen:0,dirty:0}));let t=0,a=0,r=0;for(let e=0;e<n.length;e++){const o=n[e];if(t=cG[o.data.type],o.data.size>1&&(t=Math.max(t,16)*o.data.size),o.dataLen=t,a%t!==0&&a<16){const e=a%t%16;a+=e,r+=e}a+t>16?(r=16*Math.ceil(r/16),o.offset=r,r+=t,a=t):(o.offset=r,a+=t,r+=t)}return r=16*Math.ceil(r/16),{uboElements:n,size:r}}(t),o=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let n=0;n<a.length;n++){const t=a[n],r=e.uniforms[t.data.name],i=t.data.name;let s=!1;for(let e=0;e<jW.length;e++){const n=jW[e];if(n.codeUbo&&n.test(t.data,r)){o.push(`offset = ${t.offset/4};`,jW[e].codeUbo(t.data.name,r)),s=!0;break}}if(!s)if(t.data.size>1){const e=HW(t.data.type),n=Math.max(cG[t.data.type]/16,1),a=e/n,r=(4-a%4)%4;o.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${t.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${t.data.size*n}; i++)\n                {\n                    for(var j = 0; j < ${a}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const e=lG[t.data.type];o.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${t.offset/4};\n                ${e};\n                `)}}return o.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join("\n"))}}(e,this.shader.program.uniformData)),e.autoManage){const n=new Float32Array(i.size/4);e.buffer.update(n)}return n.uniformGroups[e.id]=i.syncFunc,n.uniformGroups[e.id]}getSignature(e,n,t){const a=e.uniforms,r=[`${t}-`];for(const e in a)r.push(e),n[e]&&r.push(n[e].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const n=this.gl,t=e.program,a=function(e,n){const t=aG(e,e.VERTEX_SHADER,n.vertexSrc),a=aG(e,e.FRAGMENT_SHADER,n.fragmentSrc),r=e.createProgram();e.attachShader(r,t),e.attachShader(r,a);const o=n.extra?.transformFeedbackVaryings;if(o&&("function"!=typeof e.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(r,o.names,"separate"===o.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||function(e,n,t,a){e.getProgramParameter(n,e.LINK_STATUS)||(e.getShaderParameter(t,e.COMPILE_STATUS)||iG(e,t),e.getShaderParameter(a,e.COMPILE_STATUS)||iG(e,a),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(n)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(n)))}(e,r,t,a),n.attributeData=function(e,n){const t={},a=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<a;r++){const a=n.getActiveAttrib(e,r);if(a.name.startsWith("gl_"))continue;const o=KW(n,a.type),i={type:o,name:a.name,size:HW(o),location:n.getAttribLocation(e,a.name)};t[a.name]=i}return t}(r,e),n.uniformData=function(e,n){const t={},a=n.getProgramParameter(e,n.ACTIVE_UNIFORMS);for(let r=0;r<a;r++){const a=n.getActiveUniform(e,r),o=a.name.replace(/\[.*?\]$/,""),i=!!a.name.match(/\[.*?\]$/),s=KW(n,a.type);t[o]={name:o,index:r,type:s,size:a.size,isArray:i,value:oG(s,a.size)}}return t}(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(n.vertexSrc)){const t=Object.keys(n.attributeData);t.sort((e,n)=>e>n?1:-1);for(let a=0;a<t.length;a++)n.attributeData[t[a]].location=a,e.bindAttribLocation(r,a,t[a]);e.linkProgram(r)}e.deleteShader(t),e.deleteShader(a);const i={};for(const t in n.uniformData){const a=n.uniformData[t];i[t]={location:e.getUniformLocation(r,t),value:oG(a.type,a.size)}}return new tG(r,i)}(n,t);return t.glPrograms[this.renderer.CONTEXT_UID]=a,a}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}vG.extension={type:qU.RendererSystem,name:"shader"},VU.add(vG);class fG{constructor(e){this.renderer=e}run(e){const{renderer:n}=this;n.runners.init.emit(n.options),e.hello&&console.log(`PixiJS 7.4.3 - ${n.rendererLogId} - https://pixijs.com`),n.resize(n.screen.width,n.screen.height)}destroy(){}}fG.defaultOptions={hello:!1},fG.extension={type:[qU.RendererSystem,qU.CanvasRendererSystem],name:"startup"},VU.add(fG);const hG=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=oX.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new JU,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e,n=[]){return n[oX.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.ADD]=[e.ONE,e.ONE],n[oX.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.NONE]=[0,0],n[oX.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],n[oX.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],n[oX.SRC_IN]=[e.DST_ALPHA,e.ZERO],n[oX.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],n[oX.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],n[oX.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],n[oX.DST_IN]=[e.ZERO,e.SRC_ALPHA],n[oX.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],n[oX.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],n[oX.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],n[oX.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],n}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let n=this.stateId^e.data,t=0;for(;n;)1&n&&this.map[t].call(this,!!(e.data&1<<t)),n>>=1,t++;this.stateId=e.data}for(let n=0;n<this.checks.length;n++)this.checks[n](this,e)}forceState(e){e=e||this.defaultState;for(let n=0;n<this.map.length;n++)this.map[n].call(this,!!(e.data&1<<n));for(let n=0;n<this.checks.length;n++)this.checks[n](this,e);this.stateId=e.data}setBlend(n){this.updateCheck(e.checkBlendMode,n),this.gl[n?"enable":"disable"](this.gl.BLEND)}setOffset(n){this.updateCheck(e.checkPolygonOffset,n),this.gl[n?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const n=this.blendModes[e],t=this.gl;2===n.length?t.blendFunc(n[0],n[1]):t.blendFuncSeparate(n[0],n[1],n[2],n[3]),6===n.length?(this._blendEq=!0,t.blendEquationSeparate(n[4],n[5])):this._blendEq&&(this._blendEq=!1,t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD))}setPolygonOffset(e,n){this.gl.polygonOffset(e,n)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,n){const t=this.checks.indexOf(e);n&&-1===t?this.checks.push(e):!n&&-1!==t&&this.checks.splice(t,1)}static checkBlendMode(e,n){e.setBlendMode(n.blendMode)}static checkPolygonOffset(e,n){e.setPolygonOffset(1,n.polygonOffset)}destroy(){this.gl=null}};hG.extension={type:qU.RendererSystem,name:"state"};let mG=hG;VU.add(mG);class gG extends BX{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const n=(e.priority??[]).filter(n=>e.systems[n]),t=[...n,...Object.keys(e.systems).filter(e=>!n.includes(e))];for(const n of t)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(e=>{this.runners[e]=new nW(e)})}addSystem(e,n){const t=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=t,this._systemsHash[n]=t;for(const e in this.runners)this.runners[e].add(t);return this}emitWithCustomOptions(e,n){const t=Object.keys(this._systemsHash);e.items.forEach(a=>{const r=t.find(e=>this._systemsHash[e]===a);a[e.name](n[r])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const bG=class e{constructor(n){this.renderer=n,this.count=0,this.checkCount=0,this.maxIdle=e.defaultMaxIdle,this.checkCountMax=e.defaultCheckCountMax,this.mode=e.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==mX.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,n=e.managedTextures;let t=!1;for(let a=0;a<n.length;a++){const r=n[a];r.resource&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),n[a]=null,t=!0)}if(t){let e=0;for(let t=0;t<n.length;t++)null!==n[t]&&(n[e++]=n[t]);n.length=e}}unload(e){const n=this.renderer.texture,t=e._texture;t&&!t.framebuffer&&n.destroyTexture(t);for(let n=e.children.length-1;n>=0;n--)this.unload(e.children[n])}destroy(){this.renderer=null}};bG.defaultMode=mX.AUTO,bG.defaultMaxIdle=3600,bG.defaultCheckCountMax=600,bG.extension={type:qU.RendererSystem,name:"textureGC"};let yG=bG;VU.add(yG);class xG{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=cX.UNSIGNED_BYTE,this.internalFormat=sX.RGBA,this.samplerType=0}}class kG{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new iW,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){let n;return n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[cX.UNSIGNED_BYTE]:{[sX.RGBA]:e.RGBA8,[sX.RGB]:e.RGB8,[sX.RG]:e.RG8,[sX.RED]:e.R8,[sX.RGBA_INTEGER]:e.RGBA8UI,[sX.RGB_INTEGER]:e.RGB8UI,[sX.RG_INTEGER]:e.RG8UI,[sX.RED_INTEGER]:e.R8UI,[sX.ALPHA]:e.ALPHA,[sX.LUMINANCE]:e.LUMINANCE,[sX.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[cX.BYTE]:{[sX.RGBA]:e.RGBA8_SNORM,[sX.RGB]:e.RGB8_SNORM,[sX.RG]:e.RG8_SNORM,[sX.RED]:e.R8_SNORM,[sX.RGBA_INTEGER]:e.RGBA8I,[sX.RGB_INTEGER]:e.RGB8I,[sX.RG_INTEGER]:e.RG8I,[sX.RED_INTEGER]:e.R8I},[cX.UNSIGNED_SHORT]:{[sX.RGBA_INTEGER]:e.RGBA16UI,[sX.RGB_INTEGER]:e.RGB16UI,[sX.RG_INTEGER]:e.RG16UI,[sX.RED_INTEGER]:e.R16UI,[sX.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[cX.SHORT]:{[sX.RGBA_INTEGER]:e.RGBA16I,[sX.RGB_INTEGER]:e.RGB16I,[sX.RG_INTEGER]:e.RG16I,[sX.RED_INTEGER]:e.R16I},[cX.UNSIGNED_INT]:{[sX.RGBA_INTEGER]:e.RGBA32UI,[sX.RGB_INTEGER]:e.RGB32UI,[sX.RG_INTEGER]:e.RG32UI,[sX.RED_INTEGER]:e.R32UI,[sX.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[cX.INT]:{[sX.RGBA_INTEGER]:e.RGBA32I,[sX.RGB_INTEGER]:e.RGB32I,[sX.RG_INTEGER]:e.RG32I,[sX.RED_INTEGER]:e.R32I},[cX.FLOAT]:{[sX.RGBA]:e.RGBA32F,[sX.RGB]:e.RGB32F,[sX.RG]:e.RG32F,[sX.RED]:e.R32F,[sX.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[cX.HALF_FLOAT]:{[sX.RGBA]:e.RGBA16F,[sX.RGB]:e.RGB16F,[sX.RG]:e.RG16F,[sX.RED]:e.R16F},[cX.UNSIGNED_SHORT_5_6_5]:{[sX.RGB]:e.RGB565},[cX.UNSIGNED_SHORT_4_4_4_4]:{[sX.RGBA]:e.RGBA4},[cX.UNSIGNED_SHORT_5_5_5_1]:{[sX.RGBA]:e.RGB5_A1},[cX.UNSIGNED_INT_2_10_10_10_REV]:{[sX.RGBA]:e.RGB10_A2,[sX.RGBA_INTEGER]:e.RGB10_A2UI},[cX.UNSIGNED_INT_10F_11F_11F_REV]:{[sX.RGB]:e.R11F_G11F_B10F},[cX.UNSIGNED_INT_5_9_9_9_REV]:{[sX.RGB]:e.RGB9_E5},[cX.UNSIGNED_INT_24_8]:{[sX.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[cX.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[sX.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[cX.UNSIGNED_BYTE]:{[sX.RGBA]:e.RGBA,[sX.RGB]:e.RGB,[sX.ALPHA]:e.ALPHA,[sX.LUMINANCE]:e.LUMINANCE,[sX.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[cX.UNSIGNED_SHORT_5_6_5]:{[sX.RGB]:e.RGB},[cX.UNSIGNED_SHORT_4_4_4_4]:{[sX.RGBA]:e.RGBA},[cX.UNSIGNED_SHORT_5_5_5_1]:{[sX.RGBA]:e.RGBA}},n}(e),this.samplerTypes=function(e){let n;return n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[e.RGB]:dX.FLOAT,[e.RGBA]:dX.FLOAT,[e.ALPHA]:dX.FLOAT,[e.LUMINANCE]:dX.FLOAT,[e.LUMINANCE_ALPHA]:dX.FLOAT,[e.R8]:dX.FLOAT,[e.R8_SNORM]:dX.FLOAT,[e.RG8]:dX.FLOAT,[e.RG8_SNORM]:dX.FLOAT,[e.RGB8]:dX.FLOAT,[e.RGB8_SNORM]:dX.FLOAT,[e.RGB565]:dX.FLOAT,[e.RGBA4]:dX.FLOAT,[e.RGB5_A1]:dX.FLOAT,[e.RGBA8]:dX.FLOAT,[e.RGBA8_SNORM]:dX.FLOAT,[e.RGB10_A2]:dX.FLOAT,[e.RGB10_A2UI]:dX.FLOAT,[e.SRGB8]:dX.FLOAT,[e.SRGB8_ALPHA8]:dX.FLOAT,[e.R16F]:dX.FLOAT,[e.RG16F]:dX.FLOAT,[e.RGB16F]:dX.FLOAT,[e.RGBA16F]:dX.FLOAT,[e.R32F]:dX.FLOAT,[e.RG32F]:dX.FLOAT,[e.RGB32F]:dX.FLOAT,[e.RGBA32F]:dX.FLOAT,[e.R11F_G11F_B10F]:dX.FLOAT,[e.RGB9_E5]:dX.FLOAT,[e.R8I]:dX.INT,[e.R8UI]:dX.UINT,[e.R16I]:dX.INT,[e.R16UI]:dX.UINT,[e.R32I]:dX.INT,[e.R32UI]:dX.UINT,[e.RG8I]:dX.INT,[e.RG8UI]:dX.UINT,[e.RG16I]:dX.INT,[e.RG16UI]:dX.UINT,[e.RG32I]:dX.INT,[e.RG32UI]:dX.UINT,[e.RGB8I]:dX.INT,[e.RGB8UI]:dX.UINT,[e.RGB16I]:dX.INT,[e.RGB16UI]:dX.UINT,[e.RGB32I]:dX.INT,[e.RGB32UI]:dX.UINT,[e.RGBA8I]:dX.INT,[e.RGBA8UI]:dX.UINT,[e.RGBA16I]:dX.INT,[e.RGBA16UI]:dX.UINT,[e.RGBA32I]:dX.INT,[e.RGBA32UI]:dX.UINT,[e.DEPTH_COMPONENT16]:dX.FLOAT,[e.DEPTH_COMPONENT24]:dX.FLOAT,[e.DEPTH_COMPONENT32F]:dX.FLOAT,[e.DEPTH_STENCIL]:dX.FLOAT,[e.DEPTH24_STENCIL8]:dX.FLOAT,[e.DEPTH32F_STENCIL8]:dX.FLOAT}:{[e.RGB]:dX.FLOAT,[e.RGBA]:dX.FLOAT,[e.ALPHA]:dX.FLOAT,[e.LUMINANCE]:dX.FLOAT,[e.LUMINANCE_ALPHA]:dX.FLOAT,[e.DEPTH_STENCIL]:dX.FLOAT},n}(e);const n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=n;for(let e=0;e<n;e++)this.boundTextures[e]=null;this.emptyTextures={};const t=new xG(e.createTexture());e.bindTexture(e.TEXTURE_2D,t.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=t,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new xG(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,n=0){const{gl:t}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const a=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[n]!==e&&(this.currentLocation!==n&&(this.currentLocation=n,t.activeTexture(t.TEXTURE0+n)),t.bindTexture(e.target,a.texture)),a.dirtyId!==e.dirtyId?(this.currentLocation!==n&&(this.currentLocation=n,t.activeTexture(t.TEXTURE0+n)),this.updateTexture(e)):a.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[n]=e}else this.currentLocation!==n&&(this.currentLocation=n,t.activeTexture(t.TEXTURE0+n)),t.bindTexture(t.TEXTURE_2D,this.emptyTextures[t.TEXTURE_2D].texture),this.boundTextures[n]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:n,boundTextures:t}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<t.length;e++)t[e]===this.unknownTexture&&this.bind(null,e)}for(let a=0;a<t.length;a++)t[a]===e&&(this.currentLocation!==a&&(n.activeTexture(n.TEXTURE0+a),this.currentLocation=a),n.bindTexture(e.target,this.emptyTextures[e.target].texture),t[a]=null)}ensureSamplerType(e){const{boundTextures:n,hasIntegerTextures:t,CONTEXT_UID:a}=this;if(t)for(let t=e-1;t>=0;--t){const e=n[t];e&&e._glTextures[a].samplerType!==dX.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){const n=new xG(this.gl.createTexture());return n.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=n,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),n}initTextureType(e,n){n.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,n.samplerType=this.samplerTypes[n.internalFormat]??dX.FLOAT,2===this.webGLVersion&&e.type===cX.HALF_FLOAT?n.type=this.gl.HALF_FLOAT:n.type=e.type}updateTexture(e){const n=e._glTextures[this.CONTEXT_UID];if(!n)return;const t=this.renderer;if(this.initTextureType(e,n),e.resource?.upload(t,e,n))n.samplerType!==dX.FLOAT&&(this.hasIntegerTextures=!0);else{const a=e.realWidth,r=e.realHeight,o=t.gl;(n.width!==a||n.height!==r||n.dirtyId<0)&&(n.width=a,n.height=r,o.texImage2D(e.target,0,n.internalFormat,a,r,0,e.format,n.type,null))}e.dirtyStyleId!==n.dirtyStyleId&&this.updateTextureStyle(e),n.dirtyId=e.dirtyId}destroyTexture(e,n){const{gl:t}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),t.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!n)){const n=this.managedTextures.indexOf(e);-1!==n&&MU(this.managedTextures,n,1)}}updateTextureStyle(e){const n=e._glTextures[this.CONTEXT_UID];n&&(e.mipmap!==vX.POW2&&2===this.webGLVersion||e.isPowerOfTwo?n.mipmap=e.mipmap>=1:n.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?n.wrapMode=e.wrapMode:n.wrapMode=pX.CLAMP,e.resource?.style(this.renderer,e,n)||this.setStyle(e,n),n.dirtyStyleId=e.dirtyStyleId)}setStyle(e,n){const t=this.gl;if(n.mipmap&&e.mipmap!==vX.ON_MANUAL&&t.generateMipmap(e.target),t.texParameteri(e.target,t.TEXTURE_WRAP_S,n.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,n.wrapMode),n.mipmap){t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,e.scaleMode===uX.LINEAR?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===uX.LINEAR){const a=Math.min(e.anisotropicLevel,t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));t.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,a)}}else t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,e.scaleMode===uX.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,e.scaleMode===uX.LINEAR?t.LINEAR:t.NEAREST)}destroy(){this.renderer=null}}kG.extension={type:qU.RendererSystem,name:"texture"},VU.add(kG);class wG{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:n,CONTEXT_UID:t}=this,a=e._glTransformFeedbacks[t]||this.createGLTransformFeedback(e);n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,a)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,n){const{gl:t,renderer:a}=this;n&&a.shader.bind(n),t.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:n,renderer:t,CONTEXT_UID:a}=this,r=n.createTransformFeedback();e._glTransformFeedbacks[a]=r,n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,r);for(let r=0;r<e.buffers.length;r++){const o=e.buffers[r];o&&(t.buffer.update(o),o._glBuffers[a].refCount++,n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,r,o._glBuffers[a].buffer||null))}return n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),r}disposeTransformFeedback(e,n){const t=e._glTransformFeedbacks[this.CONTEXT_UID],a=this.gl;e.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let t=0;t<e.buffers.length;t++){const a=e.buffers[t];if(!a)continue;const o=a._glBuffers[this.CONTEXT_UID];o&&(o.refCount--,0===o.refCount&&!n&&r.dispose(a,n))}t&&(n||a.deleteTransformFeedback(t),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}wG.extension={type:qU.RendererSystem,name:"transformFeedback"},VU.add(wG);class _G{constructor(e){this.renderer=e}init(e){this.screen=new _W(0,0,e.width,e.height),this.element=e.view||wX.ADAPTER.createCanvas(),this.resolution=e.resolution||wX.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,n){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(n*this.resolution);const t=this.element.width/this.resolution,a=this.element.height/this.resolution;this.screen.width=t,this.screen.height=a,this.autoDensity&&(this.element.style.width=`${t}px`,this.element.style.height=`${a}px`),this.renderer.emit("resize",t,a),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}_G.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},_G.extension={type:[qU.RendererSystem,qU.CanvasRendererSystem],name:"_view"},VU.add(_G),wX.PREFER_ENV=tX.WEBGL2,wX.STRICT_TEXTURE_CACHE=!1,wX.RENDER_OPTIONS={...hq.defaultOptions,...pq.defaultOptions,..._G.defaultOptions,...fG.defaultOptions},Object.defineProperties(wX,{WRAP_MODE:{get:()=>iW.defaultOptions.wrapMode,set(e){WX("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),iW.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>iW.defaultOptions.scaleMode,set(e){WX("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),iW.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>iW.defaultOptions.mipmap,set(e){WX("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),iW.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>iW.defaultOptions.anisotropicLevel,set(e){WX("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),iW.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(WX("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),uq.defaultResolution),set(e){uq.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(WX("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),uq.defaultMultisample),set(e){uq.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>cq.defaultMaxTextures,set(e){WX("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),cq.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>cq.defaultBatchSize,set(e){WX("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),cq.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>cq.canUploadSameBuffer,set(e){WX("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),cq.canUploadSameBuffer=e}},GC_MODE:{get:()=>yG.defaultMode,set(e){WX("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),yG.defaultMode=e}},GC_MAX_IDLE:{get:()=>yG.defaultMaxIdle,set(e){WX("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),yG.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>yG.defaultCheckCountMax,set(e){WX("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),yG.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>nq.defaultVertexPrecision,set(e){WX("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),nq.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>nq.defaultFragmentPrecision,set(e){WX("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),nq.defaultFragmentPrecision=e}}});var CG=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(CG||{});class AG{constructor(e,n=null,t=0,a=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=n,this.priority=t,this.once=a}match(e,n=null){return this.fn===e&&this.context===n}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const n=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),n}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const n=this.next;return this.next=e?null:n,this.previous=null,n}}const SG=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new AG(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,n,t=CG.NORMAL){return this._addListener(new AG(e,n,t))}addOnce(e,n,t=CG.NORMAL){return this._addListener(new AG(e,n,t,!0))}_addListener(e){let n=this._head.next,t=this._head;if(n){for(;n;){if(e.priority>n.priority){e.connect(t);break}t=n,n=n.next}e.previous||e.connect(t)}else e.connect(t);return this._startIfPossible(),this}remove(e,n){let t=this._head.next;for(;t;)t=t.match(e,n)?t.destroy():t.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,n=this._head;for(;n=n.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(n=performance.now()){let t;if(n>this.lastTime){if(t=this.elapsedMS=n-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const e=n-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=n-e%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*e.targetFPMS;const a=this._head;let r=a.next;for(;r;)r=r.emit(this.deltaTime);a.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=n}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(n){const t=Math.min(this.maxFPS,n),a=Math.min(Math.max(0,t)/1e3,e.targetFPMS);this._maxElapsedMS=1/a}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const n=Math.max(this.minFPS,e);this._minElapsedMS=1/(n/1e3)}}static get shared(){if(!e._shared){const n=e._shared=new e;n.autoStart=!0,n._protected=!0}return e._shared}static get system(){if(!e._system){const n=e._system=new e;n.autoStart=!0,n._protected=!0}return e._system}};SG.targetFPMS=.06;let LG=SG;Object.defineProperties(wX,{TARGET_FPMS:{get:()=>LG.targetFPMS,set(e){WX("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),LG.targetFPMS=e}}});class EG{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,CG.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?LG.shared:new LG,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}EG.extension=qU.Application,VU.add(EG);const TG=[];VU.handleByList(qU.Renderer,TG);const IG="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class RG{constructor(e){this.renderer=e}contextChange(e){let n;if(1===this.renderer.context.webGLVersion){const t=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),n=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,t)}else{const t=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),n=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,t)}n>=yX.HIGH?this.multisample=yX.HIGH:n>=yX.MEDIUM?this.multisample=yX.MEDIUM:n>=yX.LOW?this.multisample=yX.LOW:this.multisample=yX.NONE}destroy(){}}RG.extension={type:qU.RendererSystem,name:"_multisample"},VU.add(RG);class MG{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class PG{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:n,CONTEXT_UID:t}=this,a=e._glBuffers[t]||this.createGLBuffer(e);n.bindBuffer(e.type,a.buffer)}unbind(e){const{gl:n}=this;n.bindBuffer(e,null)}bindBufferBase(e,n){const{gl:t,CONTEXT_UID:a}=this;if(this.boundBufferBases[n]!==e){const r=e._glBuffers[a]||this.createGLBuffer(e);this.boundBufferBases[n]=e,t.bindBufferBase(t.UNIFORM_BUFFER,n,r.buffer)}}bindBufferRange(e,n,t){const{gl:a,CONTEXT_UID:r}=this;t=t||0;const o=e._glBuffers[r]||this.createGLBuffer(e);a.bindBufferRange(a.UNIFORM_BUFFER,n||0,o.buffer,256*t,256)}update(e){const{gl:n,CONTEXT_UID:t}=this,a=e._glBuffers[t]||this.createGLBuffer(e);if(e._updateID!==a.updateID)if(a.updateID=e._updateID,n.bindBuffer(e.type,a.buffer),a.byteLength>=e.data.byteLength)n.bufferSubData(e.type,0,e.data);else{const t=e.static?n.STATIC_DRAW:n.DYNAMIC_DRAW;a.byteLength=e.data.byteLength,n.bufferData(e.type,e.data,t)}}dispose(e,n){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const t=e._glBuffers[this.CONTEXT_UID],a=this.gl;e.disposeRunner.remove(this),t&&(n||a.deleteBuffer(t.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const n=Object.keys(this.managedBuffers);for(let t=0;t<n.length;t++)this.dispose(this.managedBuffers[n[t]],e)}createGLBuffer(e){const{CONTEXT_UID:n,gl:t}=this;return e._glBuffers[n]=new MG(t.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[n]}}PG.extension={type:qU.RendererSystem,name:"buffer"},VU.add(PG);class DG{constructor(e){this.renderer=e}render(e,n){const t=this.renderer;let a,r,o,i;if(n&&(a=n.renderTexture,r=n.clear,o=n.transform,i=n.skipUpdateTransform),this.renderingToScreen=!a,t.runners.prerender.emit(),t.emit("prerender"),t.projection.transform=o,!t.context.isLost){if(a||(this.lastObjectRendered=e),!i){const n=e.enableTempParent();e.updateTransform(),e.disableTempParent(n)}t.renderTexture.bind(a),t.batch.currentRenderer.start(),(r??t.background.clearBeforeRender)&&t.renderTexture.clear(),e.render(t),t.batch.currentRenderer.flush(),a&&(n.blit&&t.framebuffer.blit(),a.baseTexture.update()),t.runners.postrender.emit(),t.projection.transform=null,t.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}DG.extension={type:qU.RendererSystem,name:"objectRenderer"},VU.add(DG);const zG=class e extends gG{constructor(n){super(),this.type=aX.WEBGL,n=Object.assign({},wX.RENDER_OPTIONS,n),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new aq({projectionMatrix:new EW},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:e.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in n&&(WX("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),n.premultipliedAlpha=n.useContextAlpha&&"notMultiplied"!==n.useContextAlpha,n.backgroundAlpha=!1===n.useContextAlpha?1:n.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=n,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&(typeof QX>"u"&&(QX=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:wX.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!wX.ADAPTER.getWebGLRenderingContext())return!1;const n=wX.ADAPTER.createCanvas();let t=n.getContext("webgl",e)||n.getContext("experimental-webgl",e);const a=!!t?.getContextAttributes()?.stencil;if(t){const e=t.getExtension("WEBGL_lose_context");e&&e.loseContext()}return t=null,a}catch{return!1}}()),QX)}render(e,n){this.objectRenderer.render(e,n)}resize(e,n){this._view.resizeView(e,n)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return WX("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return WX("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return WX("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return WX("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){WX("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return WX("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){WX("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return WX("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,n){return this.textureGenerator.generateTexture(e,n)}};zG.extension={type:qU.Renderer,priority:1},zG.__plugins={},zG.__systems={};let NG=zG;VU.handleByMap(qU.RendererPlugin,NG.__plugins),VU.handleByMap(qU.RendererSystem,NG.__systems),VU.add(NG);class $G extends tW{constructor(e,n){const{width:t,height:a}=n||{};super(t,a),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){const e=new iW;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,n){for(let t=0;t<this.length;t++)e[t]&&(e[t].castToBaseTexture?this.addBaseTextureAt(e[t].castToBaseTexture(),t):e[t]instanceof tW?this.addResourceAt(e[t],t):this.addResourceAt(eW(e[t],n),t))}dispose(){for(let e=0,n=this.length;e<n;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,n){if(!this.items[n])throw new Error(`Index ${n} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[n].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let n=0;n<this.length;n++)this.items[n].parentTextureArray=e,this.items[n].on("update",e.update,e)}unbind(e){super.unbind(e);for(let n=0;n<this.length;n++)this.items[n].parentTextureArray=null,this.items[n].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(e).then(()=>{const{realWidth:e,realHeight:n}=this.items[0];return this.resize(e,n),this.update(),Promise.resolve(this)}),this._load}}const OG=class e extends $G{constructor(n,t){const{width:a,height:r,autoLoad:o,linkBaseTexture:i}=t||{};if(n&&n.length!==e.SIDES)throw new Error(`Invalid length. Got ${n.length}, expected 6`);super(6,{width:a,height:r});for(let n=0;n<e.SIDES;n++)this.items[n].target=lX.TEXTURE_CUBE_MAP_POSITIVE_X+n;this.linkBaseTexture=!1!==i,n&&this.initFromArray(n,t),!1!==o&&this.load()}bind(e){super.bind(e),e.target=lX.TEXTURE_CUBE_MAP}addBaseTextureAt(e,n,t){if(void 0===t&&(t=this.linkBaseTexture),!this.items[n])throw new Error(`Index ${n} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,n)}else e.target=lX.TEXTURE_CUBE_MAP_POSITIVE_X+n,e.parentTextureArray=this.baseTexture,this.items[n]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[n]=e,this}upload(n,t,a){const r=this.itemDirtyIds;for(let o=0;o<e.SIDES;o++){const e=this.items[o];(r[o]<e.dirtyId||a.dirtyId<t.dirtyId)&&(e.valid&&e.resource?(e.resource.upload(n,e,a),r[o]=e.dirtyId):r[o]<-1&&(n.gl.texImage2D(e.target,0,a.internalFormat,t.realWidth,t.realHeight,0,t.format,a.type,null),r[o]=-1))}return!0}static test(n){return Array.isArray(n)&&n.length===e.SIDES}};OG.SIDES=6;let FG=OG;class jG extends bq{constructor(e,n){let t,a,r;n=n||{},"string"==typeof e?(t=jG.EMPTY,a=e,r=!0):(t=e,a=null,r=!1),super(t),this.url=a,this.crossOrigin=n.crossOrigin??!0,this.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,this.ownsImageBitmap=n.ownsImageBitmap??r,this._load=null,!1!==n.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(async(e,n)=>{if(null!==this.url)try{const n=await wX.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const t=await n.blob();if(this.destroyed)return;const a=await createImageBitmap(t,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===fX.UNPACK?"premultiply":"none"});if(this.destroyed)return void a.close();this.source=a,this.update(),e(this)}catch(e){if(this.destroyed)return;n(e),this.onError.emit(e)}else e(this)})),this._load}upload(e,n,t){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),super.upload(e,n,t)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return jG._EMPTY=jG._EMPTY??wX.ADAPTER.createCanvas(0,0),jG._EMPTY}}const BG=class e extends bq{constructor(e,n){n=n||{},super(wX.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=n.scale||1,this._overrideWidth=n.width,this._overrideHeight=n.height,this._resolve=null,this._crossorigin=n.crossorigin,this._load=null,!1!==n.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(n=>{if(this._resolve=()=>{this.update(),n(this)},e.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const e=new Image;bq.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=n=>{this._resolve&&(e.onerror=null,this.onError.emit(n))},e.onload=()=>{if(!this._resolve)return;const n=e.width,t=e.height;if(!n||!t)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let a=n*this.scale,r=t*this.scale;(this._overrideWidth||this._overrideHeight)&&(a=this._overrideWidth||this._overrideHeight/t*n,r=this._overrideHeight||this._overrideWidth/n*t),a=Math.round(a),r=Math.round(r);const o=this.source;o.width=a,o.height=r,o._pixiId=`canvas_${zU()}`,o.getContext("2d").drawImage(e,0,0,n,t,0,0,a,r),this._resolve(),this._resolve=null}}static getSize(n){const t=e.SVG_SIZE.exec(n),a={};return t&&(a[t[1]]=Math.round(parseFloat(t[3])),a[t[5]]=Math.round(parseFloat(t[7]))),a}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(n,t){return"svg"===t||"string"==typeof n&&n.startsWith("data:image/svg+xml")||"string"==typeof n&&e.SVG_XML.test(n)}};BG.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,BG.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let XG=BG;const UG=class e extends bq{constructor(n,t){if(t=t||{},!(n instanceof HTMLVideoElement)){const a=document.createElement("video");!1!==t.autoLoad&&a.setAttribute("preload","auto"),!1!==t.playsinline&&(a.setAttribute("webkit-playsinline",""),a.setAttribute("playsinline","")),!0===t.muted&&(a.setAttribute("muted",""),a.muted=!0),!0===t.loop&&a.setAttribute("loop",""),!1!==t.autoPlay&&a.setAttribute("autoplay",""),"string"==typeof n&&(n=[n]);const r=n[0].src||n[0];bq.crossOrigin(a,r,t.crossorigin);for(let t=0;t<n.length;++t){const r=document.createElement("source");let{src:o,mime:i}=n[t];if(o=o||n[t],o.startsWith("data:"))i=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const n=o.split("?").shift().toLowerCase(),t=n.slice(n.lastIndexOf(".")+1);i=i||e.MIME_TYPES[t]||`video/${t}`}r.src=o,i&&(r.type=i),a.appendChild(r)}n=a}super(n),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==t.autoLoad&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const e=LG.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((n,t)=>{this.valid?n(this):(this._resolve=n,this._reject=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const n=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!n&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(LG.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(LG.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(LG.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(n,t){return globalThis.HTMLVideoElement&&n instanceof HTMLVideoElement||e.TYPES.includes(t)}};UG.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],UG.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let WG=UG;ZU.push(jG,yq,class extends bq{constructor(e){super(e)}static test(e){const{OffscreenCanvas:n}=globalThis;return!!(n&&e instanceof n)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},WG,class extends bq{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},XG,aW,FG,class extends $G{constructor(e,n){const{width:t,height:a}=n||{};let r,o;Array.isArray(e)?(r=e,o=e.length):o=e,super(o,{width:t,height:a}),r&&this.initFromArray(r,n)}addBaseTextureAt(e,n){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,n),this}bind(e){super.bind(e),e.target=lX.TEXTURE_2D_ARRAY}upload(e,n,t){const{length:a,itemDirtyIds:r,items:o}=this,{gl:i}=e;t.dirtyId<0&&i.texImage3D(i.TEXTURE_2D_ARRAY,0,t.internalFormat,this._width,this._height,a,0,n.format,t.type,null);for(let e=0;e<a;e++){const a=o[e];r[e]<a.dirtyId&&(r[e]=a.dirtyId,a.valid&&i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,e,a.resource.width,a.resource.height,1,n.format,t.type,a.resource.source))}return!0}});class qG{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?_W.EMPTY:((e=e||new _W(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,n){const{a:t,b:a,c:r,d:o,tx:i,ty:s}=e,l=t*n.x+r*n.y+i,c=a*n.x+o*n.y+s;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(e){let n=this.minX,t=this.minY,a=this.maxX,r=this.maxY,o=e[0],i=e[1];n=o<n?o:n,t=i<t?i:t,a=o>a?o:a,r=i>r?i:r,o=e[2],i=e[3],n=o<n?o:n,t=i<t?i:t,a=o>a?o:a,r=i>r?i:r,o=e[4],i=e[5],n=o<n?o:n,t=i<t?i:t,a=o>a?o:a,r=i>r?i:r,o=e[6],i=e[7],n=o<n?o:n,t=i<t?i:t,a=o>a?o:a,r=i>r?i:r,this.minX=n,this.minY=t,this.maxX=a,this.maxY=r}addFrame(e,n,t,a,r){this.addFrameMatrix(e.worldTransform,n,t,a,r)}addFrameMatrix(e,n,t,a,r){const o=e.a,i=e.b,s=e.c,l=e.d,c=e.tx,d=e.ty;let u=this.minX,p=this.minY,v=this.maxX,f=this.maxY,h=o*n+s*t+c,m=i*n+l*t+d;u=h<u?h:u,p=m<p?m:p,v=h>v?h:v,f=m>f?m:f,h=o*a+s*t+c,m=i*a+l*t+d,u=h<u?h:u,p=m<p?m:p,v=h>v?h:v,f=m>f?m:f,h=o*n+s*r+c,m=i*n+l*r+d,u=h<u?h:u,p=m<p?m:p,v=h>v?h:v,f=m>f?m:f,h=o*a+s*r+c,m=i*a+l*r+d,u=h<u?h:u,p=m<p?m:p,v=h>v?h:v,f=m>f?m:f,this.minX=u,this.minY=p,this.maxX=v,this.maxY=f}addVertexData(e,n,t){let a=this.minX,r=this.minY,o=this.maxX,i=this.maxY;for(let s=n;s<t;s+=2){const n=e[s],t=e[s+1];a=n<a?n:a,r=t<r?t:r,o=n>o?n:o,i=t>i?t:i}this.minX=a,this.minY=r,this.maxX=o,this.maxY=i}addVertices(e,n,t,a){this.addVerticesMatrix(e.worldTransform,n,t,a)}addVerticesMatrix(e,n,t,a,r=0,o=r){const i=e.a,s=e.b,l=e.c,c=e.d,d=e.tx,u=e.ty;let p=this.minX,v=this.minY,f=this.maxX,h=this.maxY;for(let e=t;e<a;e+=2){const t=n[e],a=n[e+1],m=i*t+l*a+d,g=c*a+s*t+u;p=Math.min(p,m-r),f=Math.max(f,m+r),v=Math.min(v,g-o),h=Math.max(h,g+o)}this.minX=p,this.minY=v,this.maxX=f,this.maxY=h}addBounds(e){const n=this.minX,t=this.minY,a=this.maxX,r=this.maxY;this.minX=e.minX<n?e.minX:n,this.minY=e.minY<t?e.minY:t,this.maxX=e.maxX>a?e.maxX:a,this.maxY=e.maxY>r?e.maxY:r}addBoundsMask(e,n){const t=e.minX>n.minX?e.minX:n.minX,a=e.minY>n.minY?e.minY:n.minY,r=e.maxX<n.maxX?e.maxX:n.maxX,o=e.maxY<n.maxY?e.maxY:n.maxY;if(t<=r&&a<=o){const e=this.minX,n=this.minY,i=this.maxX,s=this.maxY;this.minX=t<e?t:e,this.minY=a<n?a:n,this.maxX=r>i?r:i,this.maxY=o>s?o:s}}addBoundsMatrix(e,n){this.addFrameMatrix(n,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,n){const t=e.minX>n.x?e.minX:n.x,a=e.minY>n.y?e.minY:n.y,r=e.maxX<n.x+n.width?e.maxX:n.x+n.width,o=e.maxY<n.y+n.height?e.maxY:n.y+n.height;if(t<=r&&a<=o){const e=this.minX,n=this.minY,i=this.maxX,s=this.maxY;this.minX=t<e?t:e,this.minY=a<n?a:n,this.maxX=r>i?r:i,this.maxY=o>s?o:s}}pad(e=0,n=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=n,this.maxY+=n)}addFramePad(e,n,t,a,r,o){e-=r,n-=o,t+=r,a+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>t?this.maxX:t,this.minY=this.minY<n?this.minY:n,this.maxY=this.maxY>a?this.maxY:a}}class GG extends BX{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new FW,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new qG,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const n=Object.keys(e);for(let t=0;t<n.length;++t){const a=n[t];Object.defineProperty(GG.prototype,a,Object.getOwnPropertyDescriptor(e,a))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,n){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),n||(this._boundsRect||(this._boundsRect=new _W),n=this._boundsRect),this._bounds.getRectangle(n)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new _W),e=this._localBoundsRect),this._localBounds||(this._localBounds=new qG);const n=this.transform,t=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=t?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const a=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,e);return this.parent=t,this.transform=n,this._bounds=a,this._bounds.updateID+=this._boundsID-r,o}toGlobal(e,n,t=!1){return t||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,n)}toLocal(e,n,t,a){return n&&(e=n.toGlobal(e,t,a)),a||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,t)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,n=0,t=1,a=1,r=0,o=0,i=0,s=0,l=0){return this.position.x=e,this.position.y=n,this.scale.x=t||1,this.scale.y=a||1,this.rotation=r,this.skew.x=o,this.skew.y=i,this.pivot.x=s,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new HG),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*bW}set angle(e){this.transform.rotation=e*yW}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class HG extends GG{constructor(){super(...arguments),this.sortDirty=null}}GG.prototype.displayObjectUpdateTransform=GG.prototype.updateTransform;const VG=new EW;function QG(e,n){return e.zIndex===n.zIndex?e._lastSortedIndex-n._lastSortedIndex:e.zIndex-n.zIndex}const KG=class e extends GG{constructor(){super(),this.children=[],this.sortableChildren=e.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let n=0;n<e.length;n++)this.addChild(e[n]);else{const n=e[0];n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.push(n),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",n,this,this.children.length-1),n.emit("added",this)}return e[0]}addChildAt(e,n){if(n<0||n>this.children.length)throw new Error(`${e}addChildAt: The index ${n} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(n,0,e),this._boundsID++,this.onChildrenChange(n),e.emit("added",this),this.emit("childAdded",e,this,n),e}swapChildren(e,n){if(e===n)return;const t=this.getChildIndex(e),a=this.getChildIndex(n);this.children[t]=n,this.children[a]=e,this.onChildrenChange(t<a?t:a)}getChildIndex(e){const n=this.children.indexOf(e);if(-1===n)throw new Error("The supplied DisplayObject must be a child of the caller");return n}setChildIndex(e,n){if(n<0||n>=this.children.length)throw new Error(`The index ${n} supplied is out of bounds ${this.children.length}`);const t=this.getChildIndex(e);MU(this.children,t,1),this.children.splice(n,0,e),this.onChildrenChange(n)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let n=0;n<e.length;n++)this.removeChild(e[n]);else{const n=e[0],t=this.children.indexOf(n);if(-1===t)return null;n.parent=null,n.transform._parentID=-1,MU(this.children,t,1),this._boundsID++,this.onChildrenChange(t),n.emit("removed",this),this.emit("childRemoved",n,this,t)}return e[0]}removeChildAt(e){const n=this.getChildAt(e);return n.parent=null,n.transform._parentID=-1,MU(this.children,e,1),this._boundsID++,this.onChildrenChange(e),n.emit("removed",this),this.emit("childRemoved",n,this,e),n}removeChildren(e=0,n=this.children.length){const t=e,a=n-t;let r;if(a>0&&a<=n){r=this.children.splice(t,a);for(let e=0;e<r.length;++e)r[e].parent=null,r[e].transform&&(r[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<r.length;++e)r[e].emit("removed",this),this.emit("childRemoved",r[e],this,e);return r}if(0===a&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let n=0,t=this.children.length;n<t;++n){const t=this.children[n];t._lastSortedIndex=n,!e&&0!==t.zIndex&&(e=!0)}e&&this.children.length>1&&this.children.sort(QG),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,n=this.children.length;e<n;++e){const n=this.children[e];n.visible&&n.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const n=this.children[e];if(n.visible&&n.renderable)if(n.calculateBounds(),n._mask){const e=n._mask.isMaskData?n._mask.maskObject:n._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(n._bounds,e._bounds)):this._bounds.addBounds(n._bounds)}else n.filterArea?this._bounds.addBoundsArea(n._bounds,n.filterArea):this._bounds.addBounds(n._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,n=!1){const t=super.getLocalBounds(e);if(!n)for(let e=0,n=this.children.length;e<n;++e){const n=this.children[e];n.visible&&n.updateTransform()}return t}_calculateBounds(){}_renderWithCulling(n){const t=n.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let a,r;this.cullArea?(a=this.cullArea,r=this.worldTransform):this._render!==e.prototype._render&&(a=this.getBounds(!0));const o=n.projection.transform;if(o&&(r?(r=VG.copyFrom(r),r.prepend(o)):r=o),a&&t.intersects(a,r))this._render(n);else if(this.cullArea)return;for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e],a=t.cullable;t.cullable=a||!this.cullArea,t.render(n),t.cullable=a}}render(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let n=0,t=this.children.length;n<t;++n)this.children[n].render(e)}}renderAdvanced(e){const n=this.filters,t=this._mask;if(n){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<n.length;e++)n[e].enabled&&this._enabledFilters.push(n[e])}const a=n&&this._enabledFilters?.length||t&&(!t.isMaskData||t.enabled&&(t.autoDetect||t.type!==bX.NONE));if(a&&e.batch.flush(),n&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),t&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let n=0,t=this.children.length;n<t;++n)this.children[n].render(e)}a&&e.batch.flush(),t&&e.mask.pop(this),n&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const n="boolean"==typeof e?e:e?.children,t=this.removeChildren(0,this.children.length);if(n)for(let n=0;n<t.length;++n)t[n].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const n=this.getLocalBounds().width;this.scale.x=0!==n?e/n:1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const n=this.getLocalBounds().height;this.scale.y=0!==n?e/n:1,this._height=e}};KG.defaultSortableChildren=!1;let YG=KG;YG.prototype.containerUpdateTransform=YG.prototype.updateTransform,Object.defineProperties(wX,{SORTABLE_CHILDREN:{get:()=>YG.defaultSortableChildren,set(e){WX("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),YG.defaultSortableChildren=e}}});const JG=new kW,ZG=new Uint16Array([0,1,2,0,2,3]);class eH extends YG{constructor(e){super(),this._anchor=new $W(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new AU(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=oX.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||_q.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ZG,this.pluginName="batch",this.isSprite=!0,this._roundPixels=wX.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=PU(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=PU(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const n=this.transform.worldTransform,t=n.a,a=n.b,r=n.c,o=n.d,i=n.tx,s=n.ty,l=this.vertexData,c=e.trim,d=e.orig,u=this._anchor;let p=0,v=0,f=0,h=0;if(c?(v=c.x-u._x*d.width,p=v+c.width,h=c.y-u._y*d.height,f=h+c.height):(v=-u._x*d.width,p=v+d.width,h=-u._y*d.height,f=h+d.height),l[0]=t*v+r*h+i,l[1]=o*h+a*v+s,l[2]=t*p+r*h+i,l[3]=o*h+a*p+s,l[4]=t*p+r*f+i,l[5]=o*f+a*p+s,l[6]=t*v+r*f+i,l[7]=o*f+a*v+s,this._roundPixels){const e=wX.RESOLUTION;for(let n=0;n<l.length;++n)l[n]=Math.round(l[n]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,n=this.vertexTrimmedData,t=e.orig,a=this._anchor,r=this.transform.worldTransform,o=r.a,i=r.b,s=r.c,l=r.d,c=r.tx,d=r.ty,u=-a._x*t.width,p=u+t.width,v=-a._y*t.height,f=v+t.height;if(n[0]=o*u+s*v+c,n[1]=l*v+i*u+d,n[2]=o*p+s*v+c,n[3]=l*v+i*p+d,n[4]=o*p+s*f+c,n[5]=l*f+i*p+d,n[6]=o*u+s*f+c,n[7]=l*f+i*u+d,this._roundPixels){const e=wX.RESOLUTION;for(let t=0;t<n.length;++t)n[t]=Math.round(n[t]*e)/e}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,n=this._texture.orig;!e||e.width===n.width&&e.height===n.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new qG),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new _W),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,JG);const n=this._texture.orig.width,t=this._texture.orig.height,a=-n*this.anchor.x;let r=0;return JG.x>=a&&JG.x<a+n&&(r=-t*this.anchor.y,JG.y>=r&&JG.y<r+t)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e?.texture){const n="boolean"==typeof e?e:e?.baseTexture;this._texture.destroy(!!n)}this._texture=null}static from(e,n){const t=e instanceof _q?e:_q.from(e,n);return new eH(t)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const n=PU(this.scale.x)||1;this.scale.x=n*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const n=PU(this.scale.y)||1;this.scale.y=n*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||_q.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const nH=new EW;GG.prototype._cacheAsBitmap=!1,GG.prototype._cacheData=null,GG.prototype._cacheAsBitmapResolution=null,GG.prototype._cacheAsBitmapMultisample=null;class tH{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(GG.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;let n;this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new tH),n=this._cacheData,n.originalRender=this.render,n.originalRenderCanvas=this.renderCanvas,n.originalUpdateTransform=this.updateTransform,n.originalCalculateBounds=this.calculateBounds,n.originalGetLocalBounds=this.getLocalBounds,n.originalDestroy=this.destroy,n.originalContainsPoint=this.containsPoint,n.originalMask=this._mask,n.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(n=this._cacheData,n.sprite&&this._destroyCachedDisplayObject(),this.render=n.originalRender,this.renderCanvas=n.originalRenderCanvas,this.calculateBounds=n.originalCalculateBounds,this.getLocalBounds=n.originalGetLocalBounds,this.destroy=n.originalDestroy,this.updateTransform=n.originalUpdateTransform,this.containsPoint=n.originalContainsPoint,this._mask=n.originalMask,this.filterArea=n.originalFilterArea)}}}),GG.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},GG.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const n=this.alpha;this.alpha=1,e.batch.flush();const t=this.getLocalBounds(new _W,!0);if(this.filters?.length){const e=this.filters[0].padding;t.pad(e)}const a=this.cacheAsBitmapResolution||e.resolution;t.ceil(a),t.width=Math.max(t.width,1/a),t.height=Math.max(t.height,1/a);const r=e.renderTexture.current,o=e.renderTexture.sourceFrame.clone(),i=e.renderTexture.destinationFrame.clone(),s=e.projection.transform,l=Cq.create({width:t.width,height:t.height,resolution:a,multisample:this.cacheAsBitmapMultisample??e.multisample}),c=`cacheAsBitmap_${zU()}`;this._cacheData.textureCacheId=c,iW.addToCache(l.baseTexture,c),_q.addToCache(l,c);const d=this.transform.localTransform.copyTo(nH).invert().translate(-t.x,-t.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=s,e.renderTexture.bind(r,o,i),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const u=new eH(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-t.x/t.width,u.anchor.y=-t.y/t.height,u.alpha=n,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},GG.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},GG.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const n=this.getLocalBounds(new _W,!0),t=this.alpha;this.alpha=1;const a=e.canvasContext.activeContext,r=e._projTransform,o=this.cacheAsBitmapResolution||e.resolution;n.ceil(o),n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o);const i=Cq.create({width:n.width,height:n.height,resolution:o}),s=`cacheAsBitmap_${zU()}`;this._cacheData.textureCacheId=s,iW.addToCache(i.baseTexture,s),_q.addToCache(i,s);const l=nH;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=n.x,l.ty-=n.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:i,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=a,e._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new eH(i);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-n.x/n.width,c.anchor.y=-n.y/n.height,c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},GG.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},GG.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},GG.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,iW.removeFromCache(this._cacheData.textureCacheId),_q.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},GG.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},GG.prototype.name=null,YG.prototype.getChildByName=function(e,n){for(let n=0,t=this.children.length;n<t;n++)if(this.children[n].name===e)return this.children[n];if(n)for(let n=0,t=this.children.length;n<t;n++){const t=this.children[n];if(!t.getChildByName)continue;const a=t.getChildByName(e,!0);if(a)return a}return null},GG.prototype.getGlobalPosition=function(e=new kW,n=!1){return this.parent?this.parent.toGlobal(this.position,e,n):(e.x=this.position.x,e.y=this.position.y),e};const aH={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},rH=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class oH extends uq{constructor(e,n=8,t=4,a=uq.defaultResolution,r=5){const o=function(e,n){const t=Math.ceil(e/2);let a,r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",o="";a=n?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let n=0;n<e;n++){let e=a.replace("%index%",n.toString());e=e.replace("%sampleIndex%",n-(t-1)+".0"),o+=e,o+="\n"}return r=r.replace("%blur%",o),r=r.replace("%size%",e.toString()),r}(r,e),i=function(e){const n=aH[e],t=n.length;let a,r=rH,o="";for(let r=0;r<e;r++){let i="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",r.toString());a=r,r>=t&&(a=e-r-1),i=i.replace("%value%",n[a].toString()),o+=i,o+="\n"}return r=r.replace("%blur%",o),r=r.replace("%size%",e.toString()),r}(r);super(o,i),this.horizontal=e,this.resolution=a,this._quality=0,this.quality=t,this.blur=n}apply(e,n,t,a){if(t?this.horizontal?this.uniforms.strength=1/t.width*(t.width/n.width):this.uniforms.strength=1/t.height*(t.height/n.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/n.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/n.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,n,t,a);else{const r=e.getFilterTexture(),o=e.renderer;let i=n,s=r;this.state.blend=!1,e.applyFilter(this,i,s,hX.CLEAR);for(let n=1;n<this.passes-1;n++){e.bindAndClear(i,hX.BLIT),this.uniforms.uSampler=s;const n=s;s=i,i=n,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,s,t,a),e.returnFilterTexture(r)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class iH extends uq{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(IG,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}_loadMatrix(e,n=!1){let t=e;n&&(this._multiply(t,this.uniforms.m,e),t=this._colorMatrix(t)),this.uniforms.m=t}_multiply(e,n,t){return e[0]=n[0]*t[0]+n[1]*t[5]+n[2]*t[10]+n[3]*t[15],e[1]=n[0]*t[1]+n[1]*t[6]+n[2]*t[11]+n[3]*t[16],e[2]=n[0]*t[2]+n[1]*t[7]+n[2]*t[12]+n[3]*t[17],e[3]=n[0]*t[3]+n[1]*t[8]+n[2]*t[13]+n[3]*t[18],e[4]=n[0]*t[4]+n[1]*t[9]+n[2]*t[14]+n[3]*t[19]+n[4],e[5]=n[5]*t[0]+n[6]*t[5]+n[7]*t[10]+n[8]*t[15],e[6]=n[5]*t[1]+n[6]*t[6]+n[7]*t[11]+n[8]*t[16],e[7]=n[5]*t[2]+n[6]*t[7]+n[7]*t[12]+n[8]*t[17],e[8]=n[5]*t[3]+n[6]*t[8]+n[7]*t[13]+n[8]*t[18],e[9]=n[5]*t[4]+n[6]*t[9]+n[7]*t[14]+n[8]*t[19]+n[9],e[10]=n[10]*t[0]+n[11]*t[5]+n[12]*t[10]+n[13]*t[15],e[11]=n[10]*t[1]+n[11]*t[6]+n[12]*t[11]+n[13]*t[16],e[12]=n[10]*t[2]+n[11]*t[7]+n[12]*t[12]+n[13]*t[17],e[13]=n[10]*t[3]+n[11]*t[8]+n[12]*t[13]+n[13]*t[18],e[14]=n[10]*t[4]+n[11]*t[9]+n[12]*t[14]+n[13]*t[19]+n[14],e[15]=n[15]*t[0]+n[16]*t[5]+n[17]*t[10]+n[18]*t[15],e[16]=n[15]*t[1]+n[16]*t[6]+n[17]*t[11]+n[18]*t[16],e[17]=n[15]*t[2]+n[16]*t[7]+n[17]*t[12]+n[18]*t[17],e[18]=n[15]*t[3]+n[16]*t[8]+n[17]*t[13]+n[18]*t[18],e[19]=n[15]*t[4]+n[16]*t[9]+n[17]*t[14]+n[18]*t[19]+n[19],e}_colorMatrix(e){const n=new Float32Array(e);return n[4]/=255,n[9]/=255,n[14]/=255,n[19]/=255,n}brightness(e,n){const t=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(t,n)}tint(e,n){const[t,a,r]=AU.shared.setValue(e).toArray(),o=[t,0,0,0,0,0,a,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(o,n)}greyscale(e,n){const t=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(t,n)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,n){e=(e||0)/180*Math.PI;const t=Math.cos(e),a=Math.sin(e),r=1/3,o=(0,Math.sqrt)(r),i=[t+(1-t)*r,r*(1-t)-o*a,r*(1-t)+o*a,0,0,r*(1-t)+o*a,t+r*(1-t),r*(1-t)-o*a,0,0,r*(1-t)-o*a,r*(1-t)+o*a,t+r*(1-t),0,0,0,0,0,1,0];this._loadMatrix(i,n)}contrast(e,n){const t=(e||0)+1,a=-.5*(t-1),r=[t,0,0,0,a,0,t,0,0,a,0,0,t,0,a,0,0,0,1,0];this._loadMatrix(r,n)}saturate(e=0,n){const t=2*e/3+1,a=-.5*(t-1),r=[t,a,a,0,0,a,t,a,0,0,a,a,t,0,0,0,0,0,1,0];this._loadMatrix(r,n)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,n,t,a,r){e=e||.2,n=n||.15,t=t||16770432,a=a||3375104;const o=AU.shared,[i,s,l]=o.setValue(t).toArray(),[c,d,u]=o.setValue(a).toArray(),p=[.3,.59,.11,0,0,i,s,l,e,0,c,d,u,n,0,i-c,s-d,l-u,0,0];this._loadMatrix(p,r)}night(e,n){const t=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(t,n)}predator(e,n){const t=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(t,n)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}iH.prototype.grayscale=iH.prototype.greyscale;const sH={AlphaFilter:class extends uq{constructor(e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class extends uq{constructor(e=8,n=4,t=uq.defaultResolution,a=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new oH(!0,e,n,t,a),this.blurYFilter=new oH(!1,e,n,t,a),this.resolution=t,this.quality=n,this.blur=e,this.repeatEdgePixels=!1}apply(e,n,t,a){const r=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(r&&o){const r=e.getFilterTexture();this.blurXFilter.apply(e,n,r,hX.CLEAR),this.blurYFilter.apply(e,r,t,a),e.returnFilterTexture(r)}else o?this.blurYFilter.apply(e,n,t,a):this.blurXFilter.apply(e,n,t,a)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:oH,ColorMatrixFilter:iH,DisplacementFilter:class extends uq{constructor(e,n){const t=new EW;e.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:t,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=t,null==n&&(n=20),this.scale=new kW(n,n)}apply(e,n,t,a){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,o=Math.sqrt(r.a*r.a+r.b*r.b),i=Math.sqrt(r.c*r.c+r.d*r.d);0!==o&&0!==i&&(this.uniforms.rotation[0]=r.a/o,this.uniforms.rotation[1]=r.b/o,this.uniforms.rotation[2]=r.c/i,this.uniforms.rotation[3]=r.d/i),e.applyFilter(this,n,t,a)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class extends uq{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends uq{constructor(e=.5,n=Math.random()){super(IG,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=e,this.seed=n}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(sH).forEach(([e,n])=>{Object.defineProperty(sH,e,{get:()=>(WX("7.1.0",`filters.${e} has moved to ${e}`),n)})});const lH=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(LG.system.add(this.tickerUpdate,this,CG.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(LG.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class cH{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=cH.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new kW,this.page=new kW,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,n,t){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,n,t,a,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class dH extends cH{constructor(){super(...arguments),this.client=new kW,this.movement=new kW,this.offset=new kW,this.global=new kW,this.screen=new kW}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,n,t){return e.worldTransform.applyInverse(t||this.global,n)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,n,t,a,r,o,i,s,l,c,d,u,p,v,f){throw new Error("Method not implemented.")}}class uH extends dH{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class pH extends dH{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}pH.DOM_DELTA_PIXEL=0,pH.DOM_DELTA_LINE=1,pH.DOM_DELTA_PAGE=2;const vH=new kW,fH=new kW;class hH{constructor(e){this.dispatch=new BX,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,n){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:n,priority:0}),this.mappingTable[e].sort((e,n)=>e.priority-n.priority)}dispatchEvent(e,n){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,n),this.dispatch.emit(n||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const n=this.mappingTable[e.type];if(n)for(let t=0,a=n.length;t<a;t++)n[t].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,n){lH.pauseUpdate=!0;const t=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,vH.set(e,n),this.hitTestFn,this.hitPruneFn);return t&&t[0]}propagate(e,n){if(!e.target)return;const t=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let a=0,r=t.length-1;a<r;a++)if(e.currentTarget=t[a],this.notifyTarget(e,n),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,n),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let a=t.length-2;a>=0;a--)if(e.currentTarget=t[a],this.notifyTarget(e,n),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,n,t=this._allInteractiveElements){if(0===t.length)return;e.eventPhase=e.BUBBLING_PHASE;const a=Array.isArray(n)?n:[n];for(let n=t.length-1;n>=0;n--)a.forEach(a=>{e.currentTarget=t[n],this.notifyTarget(e,a)})}propagationPath(e){const n=[e];for(let t=0;t<2048&&e!==this.rootTarget;t++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");n.push(e.parent),e=e.parent}return n.reverse(),n}hitTestMoveRecursive(e,n,t,a,r,o=!1){let i=!1;if(this._interactivePrune(e))return null;if(("dynamic"===e.eventMode||"dynamic"===n)&&(lH.pauseUpdate=!1),e.interactiveChildren&&e.children){const s=e.children;for(let l=s.length-1;l>=0;l--){const c=s[l],d=this.hitTestMoveRecursive(c,this._isInteractive(n)?n:c.eventMode,t,a,r,o||r(e,t));if(d){if(d.length>0&&!d[d.length-1].parent)continue;const n=e.isInteractive();(d.length>0||n)&&(n&&this._allInteractiveElements.push(e),d.push(e)),0===this._hitElements.length&&(this._hitElements=d),i=!0}}}const s=this._isInteractive(n),l=e.isInteractive();return s&&l&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:i?this._hitElements:s&&!r(e,t)&&a(e,t)?l?[e]:[]:null}hitTestRecursive(e,n,t,a,r){if(this._interactivePrune(e)||r(e,t))return null;if(("dynamic"===e.eventMode||"dynamic"===n)&&(lH.pauseUpdate=!1),e.interactiveChildren&&e.children){const o=e.children;for(let i=o.length-1;i>=0;i--){const s=o[i],l=this.hitTestRecursive(s,this._isInteractive(n)?n:s.eventMode,t,a,r);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const n=e.isInteractive();return(l.length>0||n)&&l.push(e),l}}}const o=this._isInteractive(n),i=e.isInteractive();return o&&a(e,t)?i?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&!e.isMask&&e.visible&&e.renderable&&"none"!==e.eventMode&&("passive"!==e.eventMode||e.interactiveChildren)&&!e.isMask)}hitPruneFn(e,n){if(e.hitArea&&(e.worldTransform.applyInverse(n,fH),!e.hitArea.contains(fH.x,fH.y)))return!0;if(e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;if(t&&!t.containsPoint?.(n))return!0}return!1}hitTestFn(e,n){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(n))}notifyTarget(e,n){const t=`on${n=n??e.type}`;e.currentTarget[t]?.(e);const a=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${n}capture`:n;this.notifyListeners(e,a),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,n)}mapPointerDown(e){if(!(e instanceof uH))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.createPointerEvent(e);if(this.dispatchEvent(n,"pointerdown"),"touch"===n.pointerType)this.dispatchEvent(n,"touchstart");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.dispatchEvent(n,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=n.composedPath(),this.freeEvent(n)}mapPointerMove(e){if(!(e instanceof uH))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const n=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const t="mouse"===n.pointerType||"pen"===n.pointerType,a=this.trackingData(e.pointerId),r=this.findMountedTarget(a.overTargets);if(a.overTargets?.length>0&&r!==n.target){const a="mousemove"===e.type?"mouseout":"pointerout",o=this.createPointerEvent(e,a,r);if(this.dispatchEvent(o,"pointerout"),t&&this.dispatchEvent(o,"mouseout"),!n.composedPath().includes(r)){const a=this.createPointerEvent(e,"pointerleave",r);for(a.eventPhase=a.AT_TARGET;a.target&&!n.composedPath().includes(a.target);)a.currentTarget=a.target,this.notifyTarget(a),t&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;this.freeEvent(a)}this.freeEvent(o)}if(r!==n.target){const a="mousemove"===e.type?"mouseover":"pointerover",o=this.clonePointerEvent(n,a);this.dispatchEvent(o,"pointerover"),t&&this.dispatchEvent(o,"mouseover");let i=r?.parent;for(;i&&i!==this.rootTarget.parent&&i!==n.target;)i=i.parent;if(!i||i===this.rootTarget.parent){const e=this.clonePointerEvent(n,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==r&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),t&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(o)}const o=[],i=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(n,"pointermove"),i&&o.push("globalpointermove"),"touch"===n.pointerType&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(n,"touchmove"),i&&o.push("globaltouchmove")),t&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(n,"mousemove"),i&&o.push("globalmousemove"),this.cursor=n.target?.cursor),o.length>0&&this.all(n,o),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=n.composedPath(),this.freeEvent(n)}mapPointerOver(e){if(!(e instanceof uH))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.trackingData(e.pointerId),t=this.createPointerEvent(e),a="mouse"===t.pointerType||"pen"===t.pointerType;this.dispatchEvent(t,"pointerover"),a&&this.dispatchEvent(t,"mouseover"),"mouse"===t.pointerType&&(this.cursor=t.target?.cursor);const r=this.clonePointerEvent(t,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),a&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;n.overTargets=t.composedPath(),this.freeEvent(t),this.freeEvent(r)}mapPointerOut(e){if(!(e instanceof uH))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.trackingData(e.pointerId);if(n.overTargets){const t="mouse"===e.pointerType||"pen"===e.pointerType,a=this.findMountedTarget(n.overTargets),r=this.createPointerEvent(e,"pointerout",a);this.dispatchEvent(r),t&&this.dispatchEvent(r,"mouseout");const o=this.createPointerEvent(e,"pointerleave",a);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),t&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;n.overTargets=null,this.freeEvent(r),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof uH))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=performance.now(),t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerup"),"touch"===t.pointerType)this.dispatchEvent(t,"touchend");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?"rightup":"mouseup")}const a=this.trackingData(e.pointerId),r=this.findMountedTarget(a.pressTargetsByButton[e.button]);let o=r;if(r&&!t.composedPath().includes(r)){let n=r;for(;n&&!t.composedPath().includes(n);){if(t.currentTarget=n,this.notifyTarget(t,"pointerupoutside"),"touch"===t.pointerType)this.notifyTarget(t,"touchendoutside");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.notifyTarget(t,e?"rightupoutside":"mouseupoutside")}n=n.parent}delete a.pressTargetsByButton[e.button],o=n}if(o){const r=this.clonePointerEvent(t,"click");r.target=o,r.path=null,a.clicksByButton[e.button]||(a.clicksByButton[e.button]={clickCount:0,target:r.target,timeStamp:n});const i=a.clicksByButton[e.button];if(i.target===r.target&&n-i.timeStamp<200?++i.clickCount:i.clickCount=1,i.target=r.target,i.timeStamp=n,r.detail=i.clickCount,"mouse"===r.pointerType){const e=2===r.button;this.dispatchEvent(r,e?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(t)}mapPointerUpOutside(e){if(!(e instanceof uH))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const n=this.trackingData(e.pointerId),t=this.findMountedTarget(n.pressTargetsByButton[e.button]),a=this.createPointerEvent(e);if(t){let r=t;for(;r;)a.currentTarget=r,this.notifyTarget(a,"pointerupoutside"),"touch"===a.pointerType?this.notifyTarget(a,"touchendoutside"):("mouse"===a.pointerType||"pen"===a.pointerType)&&this.notifyTarget(a,2===a.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete n.pressTargetsByButton[e.button]}this.freeEvent(a)}mapWheel(e){if(!(e instanceof pH))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const n=this.createWheelEvent(e);this.dispatchEvent(n),this.freeEvent(n)}findMountedTarget(e){if(!e)return null;let n=e[0];for(let t=1;t<e.length&&e[t].parent===n;t++)n=e[t];return n}createPointerEvent(e,n,t){const a=this.allocateEvent(uH);return this.copyPointerData(e,a),this.copyMouseData(e,a),this.copyData(e,a),a.nativeEvent=e.nativeEvent,a.originalEvent=e,a.target=t??this.hitTest(a.global.x,a.global.y)??this._hitElements[0],"string"==typeof n&&(a.type=n),a}createWheelEvent(e){const n=this.allocateEvent(pH);return this.copyWheelData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=this.hitTest(n.global.x,n.global.y),n}clonePointerEvent(e,n){const t=this.allocateEvent(uH);return t.nativeEvent=e.nativeEvent,t.originalEvent=e.originalEvent,this.copyPointerData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.target=e.target,t.path=e.composedPath().slice(),t.type=n??t.type,t}copyWheelData(e,n){n.deltaMode=e.deltaMode,n.deltaX=e.deltaX,n.deltaY=e.deltaY,n.deltaZ=e.deltaZ}copyPointerData(e,n){e instanceof uH&&n instanceof uH&&(n.pointerId=e.pointerId,n.width=e.width,n.height=e.height,n.isPrimary=e.isPrimary,n.pointerType=e.pointerType,n.pressure=e.pressure,n.tangentialPressure=e.tangentialPressure,n.tiltX=e.tiltX,n.tiltY=e.tiltY,n.twist=e.twist)}copyMouseData(e,n){e instanceof dH&&n instanceof dH&&(n.altKey=e.altKey,n.button=e.button,n.buttons=e.buttons,n.client.copyFrom(e.client),n.ctrlKey=e.ctrlKey,n.metaKey=e.metaKey,n.movement.copyFrom(e.movement),n.screen.copyFrom(e.screen),n.shiftKey=e.shiftKey,n.global.copyFrom(e.global))}copyData(e,n){n.isTrusted=e.isTrusted,n.srcElement=e.srcElement,n.timeStamp=performance.now(),n.type=e.type,n.detail=e.detail,n.view=e.view,n.which=e.which,n.layer.copyFrom(e.layer),n.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const n=this.eventPool.get(e).pop()||new e(this);return n.eventPhase=n.NONE,n.currentTarget=null,n.path=null,n.target=null,n}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const n=e.constructor;this.eventPool.has(n)||this.eventPool.set(n,[]),this.eventPool.get(n).push(e)}notifyListeners(e,n){const t=e.currentTarget._events[n];if(t&&e.currentTarget.isInteractive())if("fn"in t)t.once&&e.currentTarget.removeListener(n,t.fn,void 0,!0),t.fn.call(t.context,e);else for(let a=0,r=t.length;a<r&&!e.propagationImmediatelyStopped;a++)t[a].once&&e.currentTarget.removeListener(n,t[a].fn,void 0,!0),t[a].fn.call(t[a].context,e)}}const mH={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},gH=class e{constructor(n){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=n,this.rootBoundary=new hH(null),lH.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new uH(null),this.rootWheelEvent=new pH(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,n,t)=>("globalMove"===n&&(this.rootBoundary.enableGlobalMoveEvents=t),e[n]=t,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(n){const{view:t,resolution:a}=this.renderer;this.setTargetElement(t),this.resolution=a,e._defaultEventMode=n.eventMode??"auto",Object.assign(this.features,n.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let n=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(n=!1),this.currentCursor===e)return;this.currentCursor=e;const t=this.cursorStyles[e];if(t)switch(typeof t){case"string":n&&(this.domElement.style.cursor=t);break;case"function":t(e);break;case"object":n&&Object.assign(this.domElement.style,t)}else n&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const n=this.normalizeToPointerData(e);this.autoPreventDefault&&n[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let e=0,t=n.length;e<t;e++){const t=n[e],a=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,lH.pointerMoved();const n=this.normalizeToPointerData(e);for(let e=0,t=n.length;e<t;e++){const t=this.bootstrapEvent(this.rootPointerEvent,n[e]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let n=e.target;e.composedPath&&e.composedPath().length>0&&(n=e.composedPath()[0]);const t=n!==this.domElement?"outside":"",a=this.normalizeToPointerData(e);for(let e=0,n=a.length;e<n;e++){const n=this.bootstrapEvent(this.rootPointerEvent,a[e]);n.type+=t,this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const n=this.normalizeToPointerData(e);for(let e=0,t=n.length;e<t;e++){const t=this.bootstrapEvent(this.rootPointerEvent,n[e]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const n=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(n)}setTargetElement(e){this.removeEvents(),this.domElement=e,lH.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;lH.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;lH.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,n,t){const a=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;e.x=(n-a.left)*(this.domElement.width/a.width)*r,e.y=(t-a.top)*(this.domElement.height/a.height)*r}normalizeToPointerData(e){const n=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let t=0,a=e.changedTouches.length;t<a;t++){const a=e.changedTouches[t];typeof a.button>"u"&&(a.button=0),typeof a.buttons>"u"&&(a.buttons=1),typeof a.isPrimary>"u"&&(a.isPrimary=1===e.touches.length&&"touchstart"===e.type),typeof a.width>"u"&&(a.width=a.radiusX||1),typeof a.height>"u"&&(a.height=a.radiusY||1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="touch"),typeof a.pointerId>"u"&&(a.pointerId=a.identifier||0),typeof a.pressure>"u"&&(a.pressure=a.force||.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),typeof a.layerX>"u"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY>"u"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,a.type=e.type,n.push(a)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&!(this.supportsPointerEvents&&e instanceof globalThis.PointerEvent)){const t=e;typeof t.isPrimary>"u"&&(t.isPrimary=!0),typeof t.width>"u"&&(t.width=1),typeof t.height>"u"&&(t.height=1),typeof t.tiltX>"u"&&(t.tiltX=0),typeof t.tiltY>"u"&&(t.tiltY=0),typeof t.pointerType>"u"&&(t.pointerType="mouse"),typeof t.pointerId>"u"&&(t.pointerId=1),typeof t.pressure>"u"&&(t.pressure=.5),typeof t.twist>"u"&&(t.twist=0),typeof t.tangentialPressure>"u"&&(t.tangentialPressure=0),t.isNormalized=!0,n.push(t)}else n.push(e);return n}normalizeWheelEvent(e){const n=this.rootWheelEvent;return this.transferMouseData(n,e),n.deltaX=e.deltaX,n.deltaY=e.deltaY,n.deltaZ=e.deltaZ,n.deltaMode=e.deltaMode,this.mapPositionToPoint(n.screen,e.clientX,e.clientY),n.global.copyFrom(n.screen),n.offset.copyFrom(n.screen),n.nativeEvent=e,n.type=e.type,n}bootstrapEvent(e,n){return e.originalEvent=null,e.nativeEvent=n,e.pointerId=n.pointerId,e.width=n.width,e.height=n.height,e.isPrimary=n.isPrimary,e.pointerType=n.pointerType,e.pressure=n.pressure,e.tangentialPressure=n.tangentialPressure,e.tiltX=n.tiltX,e.tiltY=n.tiltY,e.twist=n.twist,this.transferMouseData(e,n),this.mapPositionToPoint(e.screen,n.clientX,n.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=n.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=mH[e.type]||e.type),e}transferMouseData(e,n){e.isTrusted=n.isTrusted,e.srcElement=n.srcElement,e.timeStamp=performance.now(),e.type=n.type,e.altKey=n.altKey,e.button=n.button,e.buttons=n.buttons,e.client.x=n.clientX,e.client.y=n.clientY,e.ctrlKey=n.ctrlKey,e.metaKey=n.metaKey,e.movement.x=n.movementX,e.movement.y=n.movementY,e.page.x=n.pageX,e.page.y=n.pageY,e.relatedTarget=null,e.shiftKey=n.shiftKey}};gH.extension={name:"events",type:[qU.RendererSystem,qU.CanvasRendererSystem]},gH.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let bH=gH;function yH(e){return"dynamic"===e||"static"===e}VU.add(bH);const xH={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??yH(bH.defaultEventMode)},set interactive(e){WX("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??bH.defaultEventMode},set eventMode(e){this._internalInteractive=yH(e),this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,n,t){const a="boolean"==typeof t&&t||"object"==typeof t&&t.capture,r="object"==typeof t?t.signal:void 0,o="object"==typeof t&&!0===t.once,i="function"==typeof n?void 0:n;e=a?`${e}capture`:e;const s="function"==typeof n?n:n.handleEvent,l=this;r&&r.addEventListener("abort",()=>{l.off(e,s,i)}),o?l.once(e,s,i):l.on(e,s,i)},removeEventListener(e,n,t){const a="function"==typeof n?void 0:n;e="boolean"==typeof t&&t||"object"==typeof t&&t.capture?`${e}capture`:e,n="function"==typeof n?n:n.handleEvent,this.off(e,n,a)},dispatchEvent(e){if(!(e instanceof cH))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};GG.mixin(xH),GG.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class kH{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(jX.tablet||jX.phone)&&this.createTouchHook();const n=document.createElement("div");n.style.width="100px",n.style.height="100px",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex=2..toString(),this.div=n,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const n=e.children;if(n)for(let e=0;e<n.length;e++)this.updateAccessibleObjects(n[e])}update(){const e=performance.now();if(jX.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:n,y:t,width:a,height:r}=this.renderer.view.getBoundingClientRect(),{width:o,height:i,resolution:s}=this.renderer,l=a/o*s,c=r/i*s;let d=this.div;d.style.left=`${n}px`,d.style.top=`${t}px`,d.style.width=`${o}px`,d.style.height=`${i}px`;for(let e=0;e<this.children.length;e++){const n=this.children[e];if(n.renderId!==this.renderId)n._accessibleActive=!1,MU(this.children,e,1),this.div.removeChild(n._accessibleDiv),this.pool.push(n._accessibleDiv),n._accessibleDiv=null,e--;else{d=n._accessibleDiv;let e=n.hitArea;const t=n.worldTransform;n.hitArea?(d.style.left=(t.tx+e.x*t.a)*l+"px",d.style.top=(t.ty+e.y*t.d)*c+"px",d.style.width=e.width*t.a*l+"px",d.style.height=e.height*t.d*c+"px"):(e=n.getBounds(),this.capHitArea(e),d.style.left=e.x*l+"px",d.style.top=e.y*c+"px",d.style.width=e.width*l+"px",d.style.height=e.height*c+"px",d.title!==n.accessibleTitle&&null!==n.accessibleTitle&&(d.title=n.accessibleTitle),d.getAttribute("aria-label")!==n.accessibleHint&&null!==n.accessibleHint&&d.setAttribute("aria-label",n.accessibleHint)),(n.accessibleTitle!==d.title||n.tabIndex!==d.tabIndex)&&(d.title=n.accessibleTitle,d.tabIndex=n.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:n,height:t}=this.renderer;e.x+e.width>n&&(e.width=n-e.x),e.y+e.height>t&&(e.height=t-e.y)}addChild(e){let n=this.pool.pop();n||(n=document.createElement("button"),n.style.width="100px",n.style.height="100px",n.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",n.style.position="absolute",n.style.zIndex=2..toString(),n.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?n.setAttribute("aria-live","off"):n.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?n.setAttribute("aria-relevant","additions"):n.setAttribute("aria-relevant","text"),n.addEventListener("click",this._onClick.bind(this)),n.addEventListener("focus",this._onFocus.bind(this)),n.addEventListener("focusout",this._onFocusOut.bind(this))),n.style.pointerEvents=e.accessiblePointerEvents,n.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?n.title=e.accessibleTitle:(!e.accessibleHint||null===e.accessibleHint)&&(n.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&n.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(n),e._accessibleActive=!0,e._accessibleDiv=n,n.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,n){const{displayObject:t}=e.target,a=this.renderer.events.rootBoundary,r=Object.assign(new cH(a),{target:t});a.rootTarget=this.renderer.lastObjectRendered,n.forEach(e=>a.dispatchEvent(r,e))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}kH.extension={name:"accessibility",type:[qU.RendererPlugin,qU.CanvasRendererPlugin]},VU.add(kH);const wH=class e{constructor(n){this.stage=new YG,n=Object.assign({forceCanvas:!1},n),this.renderer=function(e){for(const n of TG)if(n.test(e))return new n(e);throw new Error("Unable to auto-detect a suitable renderer.")}(n),e._plugins.forEach(e=>{e.init.call(this,n)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(n,t){const a=e._plugins.slice(0);a.reverse(),a.forEach(e=>{e.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(n),this.renderer=null}};wH._plugins=[];let _H=wH;VU.handleByList(qU.Application,_H._plugins);class CH{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,n;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:t,clientHeight:a}=this._resizeTo;e=t,n=a}this.renderer.resize(e,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}CH.extension=qU.Application,VU.add(CH);const AH={loader:qU.LoadParser,resolver:qU.ResolveParser,cache:qU.CacheParser,detection:qU.DetectionParser};VU.handle(qU.Asset,e=>{const n=e.ref;Object.entries(AH).filter(([e])=>!!n[e]).forEach(([e,t])=>VU.add(Object.assign(n[e],{extension:n[e].extension??t})))},e=>{const n=e.ref;Object.keys(AH).filter(e=>!!n[e]).forEach(e=>VU.remove(n[e]))});class SH{constructor(e,n=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=n}add(e){e.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],n=Math.min(this._assetList.length,this._maxConcurrent);for(let t=0;t<n;t++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function LH(e,n){const t=e.split("?")[0],a=HX.extname(t).toLowerCase();return Array.isArray(n)?n.includes(a):a===n}const EH=(e,n,t=!1)=>(Array.isArray(e)||(e=[e]),n?e.map(e=>"string"==typeof e||t?n(e):e):e),TH=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const n=this._cache.get(e);return n||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),n}set(e,n){const t=EH(e);let a;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];if(r.test(n)){a=r.getCacheableAssets(t,n);break}}a||(a={},t.forEach(e=>{a[e]=n}));const r=Object.keys(a),o={cacheKeys:r,keys:t};if(t.forEach(e=>{this._cacheMap.set(e,o)}),r.forEach(e=>{const t=a?a[e]:n;this._cache.has(e)&&this._cache.get(e)!==t&&console.warn("[Cache] already has key:",e),this._cache.set(e,a[e])}),n instanceof _q){const e=n;t.forEach(n=>{e.baseTexture!==_q.EMPTY.baseTexture&&iW.addToCache(e.baseTexture,n),_q.addToCache(e,n)})}}remove(e){if(!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const n=this._cacheMap.get(e);n.cacheKeys.forEach(e=>{this._cache.delete(e)}),n.keys.forEach(e=>{this._cacheMap.delete(e)})}get parsers(){return this._parsers}},IH=e=>!Array.isArray(e);class RH{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,n,t)=>(this._parsersValidated=!1,e[n]=t,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,n){const t={promise:null,parser:null};return t.promise=(async()=>{let a=null,r=null;if(n.loadParser&&(r=this._parserHash[n.loadParser],r||console.warn(`[Assets] specified load parser "${n.loadParser}" not found while loading ${e}`)),!r){for(let t=0;t<this.parsers.length;t++){const a=this.parsers[t];if(a.load&&a.test?.(e,n,this)){r=a;break}}if(!r)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}a=await r.load(e,n,this),t.parser=r;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];r.parse&&r.parse&&await(r.testParse?.(a,n,this))&&(a=await r.parse(a,n,this)||a,t.parser=r)}return a})(),t}async load(e,n){this._parsersValidated||this._validateParsers();let t=0;const a={},r=IH(e),o=EH(e,e=>({alias:[e],src:e})),i=o.length,s=o.map(async e=>{const r=HX.toAbsolute(e.src);if(!a[e.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,e)),a[e.src]=await this.promiseCache[r].promise,n&&n(++t/i)}catch(n){throw delete this.promiseCache[r],delete a[e.src],new Error(`[Loader.load] Failed to load ${r}.\n${n}`)}});return await Promise.all(s),r?a[o[0].src]:a}async unload(e){const n=EH(e,e=>({alias:[e],src:e})).map(async e=>{const n=HX.toAbsolute(e.src),t=this.promiseCache[n];if(t){const a=await t.promise;delete this.promiseCache[n],t.parser?.unload?.(a,e,this)}});await Promise.all(n)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,n)=>(e[n.name]&&console.warn(`[Assets] loadParser name conflict "${n.name}"`),{...e,[n.name]:n}),{})}}var MH=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(MH||{});function PH(e,n){if(Array.isArray(n)){for(const t of n)if(e.startsWith(`data:${t}`))return!0;return!1}return e.startsWith(`data:${n}`)}const DH={extension:{type:qU.LoadParser,priority:MH.Low},name:"loadJson",test:e=>PH(e,"application/json")||LH(e,".json"),load:async e=>await(await wX.ADAPTER.fetch(e)).json()};VU.add(DH);const zH={name:"loadTxt",extension:{type:qU.LoadParser,priority:MH.Low},test:e=>PH(e,"text/plain")||LH(e,".txt"),load:async e=>await(await wX.ADAPTER.fetch(e)).text()};VU.add(zH);const NH=["normal","bold","100","200","300","400","500","600","700","800","900"],$H=[".ttf",".otf",".woff",".woff2"],OH=["font/ttf","font/otf","font/woff","font/woff2"],FH=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,jH=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function BH(e){return jH.test(e)?e:encodeURI(e)}const XH={extension:{type:qU.LoadParser,priority:MH.Low},name:"loadWebFont",test:e=>PH(e,OH)||LH(e,$H),async load(e,n){const t=wX.ADAPTER.getFontFaceSet();if(t){const a=[],r=n.data?.family??function(e){const n=HX.extname(e),t=HX.basename(e,n).replace(/(-|_)/g," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1));let a=t.length>0;for(const e of t)if(!e.match(FH)){a=!1;break}let r=t.join(" ");return a||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}(e),o=n.data?.weights?.filter(e=>NH.includes(e))??["normal"],i=n.data??{};for(let n=0;n<o.length;n++){const s=o[n],l=new FontFace(r,`url(${BH(e)})`,{...i,weight:s});await l.load(),t.add(l),a.push(l)}return 1===a.length?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(e=>wX.ADAPTER.getFontFaceSet().delete(e))}};VU.add(XH);let UH=null;class WH{constructor(){UH||(UH=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(UH)}}WH.revokeObjectURL=function(){UH&&(URL.revokeObjectURL(UH),UH=null)};let qH=null;class GH{constructor(){qH||(qH=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(qH)}}GH.revokeObjectURL=function(){qH&&(URL.revokeObjectURL(qH),qH=null)};let HH,VH=0;const QH=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(e=>{const{worker:n}=new WH;n.addEventListener("message",t=>{n.terminate(),WH.revokeObjectURL(),e(t.data)})})),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===HH&&(HH=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<HH&&(this._createdWorkers++,e=(new GH).worker,e.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,n){await this._initWorkers();const t=new Promise((t,a)=>{this.queue.push({id:e,arguments:n,resolve:t,reject:a})});return this.next(),t}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const n=this.queue.pop(),t=n.id;this.resolveHash[VH]={resolve:n.resolve,reject:n.reject},e.postMessage({data:n.arguments,uuid:VH++,id:t})}};function KH(e,n,t){e.resource.internal=!0;const a=new _q(e),r=()=>{delete n.promiseCache[t],TH.has(t)&&TH.remove(t)};return a.baseTexture.once("destroyed",()=>{t in n.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),r())}),a.once("destroyed",()=>{e.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),a}const YH=[".jpeg",".jpg",".png",".webp",".avif"],JH=["image/jpeg","image/png","image/webp","image/avif"],ZH={name:"loadTextures",extension:{type:qU.LoadParser,priority:MH.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>PH(e,JH)||LH(e,YH),async load(e,n,t){const a=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let r;r=a?this.config.preferWorkers&&await QH.isImageBitmapSupported()?await QH.loadImageBitmap(e):await async function(e){const n=await wX.ADAPTER.fetch(e);if(!n.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${n.status} ${n.statusText}`);const t=await n.blob();return await createImageBitmap(t)}(e):await new Promise((n,t)=>{const a=new Image;a.crossOrigin=this.config.crossOrigin,a.src=e,a.complete?n(a):(a.onload=()=>n(a),a.onerror=e=>t(e))});const o={...n.data};o.resolution??(o.resolution=WU(e)),a&&void 0===o.resourceOptions?.ownsImageBitmap&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);const i=new iW(r,o);return i.resource.src=e,KH(i,t,e)},unload(e){e.destroy(!0)}};VU.add(ZH);const eV={extension:{type:qU.LoadParser,priority:MH.High},name:"loadSVG",test:e=>PH(e,"image/svg+xml")||LH(e,".svg"),testParse:async e=>XG.test(e),async parse(e,n,t){const a=new XG(e,n?.data?.resourceOptions);await a.load();const r=new iW(a,{resolution:WU(e),...n?.data});return r.resource.src=n.src,KH(r,t,n.src)},load:async(e,n)=>(await wX.ADAPTER.fetch(e)).text(),unload:ZH.unload};VU.add(eV);const nV=[".mp4",".m4v",".webm",".ogv"],tV=["video/mp4","video/webm","video/ogg"],aV={name:"loadVideo",extension:{type:qU.LoadParser,priority:MH.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:e=>PH(e,tV)||LH(e,nV),async load(e,n,t){let a;const r=await(await wX.ADAPTER.fetch(e)).blob(),o=URL.createObjectURL(r);try{const r={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...n?.data?.resourceOptions,autoLoad:!0},i=new WG(o,r);await i.load();const s=new iW(i,{alphaMode:await KX(),resolution:WU(e),...n?.data});s.resource.src=e,a=KH(s,t,e),a.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(e){throw URL.revokeObjectURL(o),e}return a},unload(e){e.destroy(!0)}};function rV(e,n,t,a,r){const o=n[t];for(let i=0;i<o.length;i++){const s=o[i];t<n.length-1?rV(e.replace(a[t],s),n,t+1,a,r):r.push(e.replace(a[t],s))}}function oV(e){const n=e.match(/\{(.*?)\}/g),t=[];if(n){const a=[];n.forEach(e=>{const n=e.substring(1,e.length-1).split(",");a.push(n)}),rV(e,a,0,n,t)}else t.push(e);return t}VU.add(aV);class iV{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,n)=>`${e}${this._bundleIdConnector}${n}`,extractAssetIdFromBundle:(e,n)=>n.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const n=e;this._defaultSearchParams=Object.keys(n).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(n[e])}`).join("&")}}getAlias(e){const{alias:n,name:t,src:a,srcs:r}=e;return EH(n||t||a||r,e=>"string"==typeof e?e:Array.isArray(e)?e.map(e=>e?.src??e?.srcs??e):e?.src||e?.srcs?e.src??e.srcs:e,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(e,n){const t=[];Array.isArray(n)?n.forEach(n=>{const a=n.src??n.srcs,r=n.alias??n.name;let o;if("string"==typeof r){const n=this._createBundleAssetId(e,r);t.push(n),o=[r,n]}else{const n=r.map(n=>this._createBundleAssetId(e,n));t.push(...n),o=[...r,...n]}this.add({...n,alias:o,src:a})}):Object.keys(n).forEach(a=>{const r=[a,this._createBundleAssetId(e,a)];if("string"==typeof n[a])this.add({alias:r,src:n[a]});else if(Array.isArray(n[a]))this.add({alias:r,src:n[a]});else{const e=n[a],t=e.src??e.srcs;this.add({...e,alias:r,src:Array.isArray(t)?t:[t]})}t.push(...r)}),this._bundles[e]=t}add(e,n,t,a,r){const o=[];let i;"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]?(WX("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),o.push({alias:e,src:n,data:t,format:a,loadParser:r})):Array.isArray(e)?o.push(...e):o.push(e),i=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},EH(o).forEach(e=>{const{src:n,srcs:t}=e;let{data:a,format:r,loadParser:o}=e;const s=EH(n||t).map(e=>"string"==typeof e?oV(e):Array.isArray(e)?e:[e]),l=this.getAlias(e);Array.isArray(l)?l.forEach(i):i(l);const c=[];s.forEach(e=>{e.forEach(e=>{let n={};if("object"!=typeof e){n.src=e;for(let t=0;t<this._parsers.length;t++){const a=this._parsers[t];if(a.test(e)){n=a.parse(e);break}}}else a=e.data??a,r=e.format??r,o=e.loadParser??o,n={...n,...e};if(!l)throw new Error(`[Resolver] alias is undefined for this asset: ${n.src}`);n=this.buildResolvedAsset(n,{aliases:l,data:a,format:r,loadParser:o}),c.push(n)})}),l.forEach(e=>{this._assetMap[e]=c})})}resolveBundle(e){const n=IH(e);e=EH(e);const t={};return e.forEach(e=>{const n=this._bundles[e];if(n){const a=this.resolve(n),r={};for(const n in a){const t=a[n];r[this._extractAssetIdFromBundle(e,n)]=t}t[e]=r}}),n?t[e[0]]:t}resolveUrl(e){const n=this.resolve(e);if("string"!=typeof e){const e={};for(const t in n)e[t]=n[t].src;return e}return n.src}resolve(e){const n=IH(e);e=EH(e);const t={};return e.forEach(e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let n=this._assetMap[e];const t=n[0],a=this._getPreferredOrder(n);a?.priority.forEach(e=>{a.params[e].forEach(t=>{const a=n.filter(n=>!!n[e]&&n[e]===t);a.length&&(n=a)})}),this._resolverHash[e]=n[0]??t}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{});t[e]=this._resolverHash[e]}),n?t[e[0]]:t}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let n=0;n<e.length;n++){const n=e[0],t=this._preferredOrder.find(e=>e.params.format.includes(n.format));if(t)return t}return this._preferredOrder[0]}_appendDefaultSearchParams(e){return this._defaultSearchParams?`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`:e}buildResolvedAsset(e,n){const{aliases:t,data:a,loadParser:r,format:o}=n;return(this._basePath||this._rootPath)&&(e.src=HX.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=t??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...a||{},...e.data},e.loadParser=r??e.loadParser,e.format=o??e.format??HX.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}const sV=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new iV,this.loader=new RH,this.cache=TH,this._backgroundLoader=new SH(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let n=e.manifest;"string"==typeof n&&(n=await this.load(n)),this.resolver.addManifest(n)}const n=e.texturePreference?.resolution??1,t="number"==typeof n?[n]:n,a=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:a,resolution:t}}),e.preferences&&this.setPreferences(e.preferences)}add(e,n,t,a,r){this.resolver.add(e,n,t,a,r)}async load(e,n){this._initialized||await this.init();const t=IH(e),a=EH(e).map(e=>{if("string"!=typeof e){const n=this.resolver.getAlias(e);return n.some(e=>!this.resolver.hasKey(e))&&this.add(e),Array.isArray(n)?n[0]:n}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e}),r=this.resolver.resolve(a),o=await this._mapLoadToResolve(r,n);return t?o[a[0]]:o}addBundle(e,n){this.resolver.addBundle(e,n)}async loadBundle(e,n){this._initialized||await this.init();let t=!1;"string"==typeof e&&(t=!0,e=[e]);const a=this.resolver.resolveBundle(e),r={},o=Object.keys(a);let i=0,s=0;const l=()=>{n?.(++i/s)},c=o.map(e=>{const n=a[e];return s+=Object.keys(n).length,this._mapLoadToResolve(n,l).then(n=>{r[e]=n})});return await Promise.all(c),t?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const n=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(n))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const n=this.resolver.resolveBundle(e);Object.values(n).forEach(e=>{this._backgroundLoader.add(Object.values(e))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return TH.get(e);const n={};for(let t=0;t<e.length;t++)n[t]=TH.get(e[t]);return n}async _mapLoadToResolve(e,n){const t=Object.values(e),a=Object.keys(e);this._backgroundLoader.active=!1;const r=await this.loader.load(t,n);this._backgroundLoader.active=!0;const o={};return t.forEach((e,n)=>{const t=r[e.src],i=[e.src];e.alias&&i.push(...e.alias),o[a[n]]=t,TH.set(i,t)}),o}async unload(e){this._initialized||await this.init();const n=EH(e).map(e=>"string"!=typeof e?e.src:e),t=this.resolver.resolve(n);await this._unloadFromResolved(t)}async unloadBundle(e){this._initialized||await this.init(),e=EH(e);const n=this.resolver.resolveBundle(e),t=Object.keys(n).map(e=>this._unloadFromResolved(n[e]));await Promise.all(t)}async _unloadFromResolved(e){const n=Object.values(e);n.forEach(e=>{TH.remove(e.src)}),await this.loader.unload(n)}async _detectFormats(e){let n=[];e.preferredFormats&&(n=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const t of e.detections)e.skipDetections||await t.test()?n=await t.add(n):e.skipDetections||(n=await t.remove(n));return n=n.filter((e,t)=>n.indexOf(e)===t),n}get detections(){return this._detections}get preferWorkers(){return ZH.config.preferWorkers}set preferWorkers(e){WX("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(n=>{n.config&&Object.keys(n.config).filter(n=>n in e).forEach(t=>{n.config[t]=e[t]})})}};VU.handleByList(qU.LoadParser,sV.loader.parsers).handleByList(qU.ResolveParser,sV.resolver.parsers).handleByList(qU.CacheParser,sV.cache.parsers).handleByList(qU.DetectionParser,sV.detections);const lV={extension:qU.CacheParser,test:e=>Array.isArray(e)&&e.every(e=>e instanceof _q),getCacheableAssets:(e,n)=>{const t={};return e.forEach(e=>{n.forEach((n,a)=>{t[e+(0===a?"":a+1)]=n})}),t}};async function cV(e){if("Image"in globalThis)return new Promise(n=>{const t=new Image;t.onload=()=>{n(!0)},t.onerror=()=>{n(!1)},t.src=e});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const n=await(await fetch(e)).blob();await createImageBitmap(n)}catch{return!1}return!0}return!1}VU.add(lV);const dV={extension:{type:qU.DetectionParser,priority:1},test:async()=>cV("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter(e=>"avif"!==e)};VU.add(dV);const uV={extension:{type:qU.DetectionParser,priority:0},test:async()=>cV("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter(e=>"webp"!==e)};VU.add(uV);const pV=["png","jpg","jpeg"],vV={extension:{type:qU.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...pV],remove:async e=>e.filter(e=>!pV.includes(e))};VU.add(vV);const fV="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function hV(e){return!fV&&""!==document.createElement("video").canPlayType(e)}const mV={extension:{type:qU.DetectionParser,priority:0},test:async()=>hV("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(e=>"webm"!==e)};VU.add(mV);const gV={extension:{type:qU.DetectionParser,priority:0},test:async()=>hV("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(e=>"mp4"!==e&&"m4v"!==e)};VU.add(gV);const bV={extension:{type:qU.DetectionParser,priority:0},test:async()=>hV("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(e=>"ogv"!==e)};VU.add(bV);const yV={extension:qU.ResolveParser,test:ZH.test,parse:e=>({resolution:parseFloat(wX.RETINA_PREFIX.exec(e)?.[1]??"1"),format:HX.extname(e).slice(1),src:e})};VU.add(yV);const xV=(e,n)=>{const t=n.split("?")[1];return t&&(e+=`?${t}`),e};var kV=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e))(kV||{});const wV={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let _V,CV;function AV(){CV={bptc:_V.getExtension("EXT_texture_compression_bptc"),astc:_V.getExtension("WEBGL_compressed_texture_astc"),etc:_V.getExtension("WEBGL_compressed_texture_etc"),s3tc:_V.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:_V.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:_V.getExtension("WEBGL_compressed_texture_pvrtc")||_V.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:_V.getExtension("WEBGL_compressed_texture_etc1"),atc:_V.getExtension("WEBGL_compressed_texture_atc")}}const SV={extension:{type:qU.DetectionParser,priority:2},test:async()=>{const e=wX.ADAPTER.createCanvas().getContext("webgl");return e?(_V=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{CV||AV();const n=[];for(const e in CV)CV[e]&&n.push(e);return[...n,...e]},remove:async e=>(CV||AV(),e.filter(e=>!(e in CV)))};VU.add(SV);class LV extends aW{constructor(e,n={width:1,height:1,autoLoad:!0}){let t,a;"string"==typeof e?(t=e,a=new Uint8Array):(t=null,a=e),super(a,n),this.origin=t,this.buffer=a?new QU(a):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==n.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new QU(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this))),this._load}}class EV extends LV{constructor(e,n){super(e,n),this.format=n.format,this.levels=n.levels||1,this._width=n.width,this._height=n.height,this._extension=EV._formatToExtension(this.format),(n.levelBuffers||this.buffer)&&(this._levelBuffers=n.levelBuffers||EV._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,n,t){const a=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;a.pixelStorei(a.UNPACK_ALIGNMENT,4);for(let e=0,n=this.levels;e<n;e++){const{levelID:n,levelWidth:t,levelHeight:r,levelBuffer:o}=this._levelBuffers[e];a.compressedTexImage2D(a.TEXTURE_2D,n,this.format,t,r,0,o)}return!0}onBlobLoaded(){this._levelBuffers=EV._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(36196===e)return"etc1";if(35986===e||35987===e||34798===e)return"atc";if(e>=36492&&e<=36495)return"bptc";if(37808===e)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,n,t,a,r,o,i){const s=new Array(t);let l=e.byteOffset,c=o,d=i,u=c+a-1&~(a-1),p=d+r-1&~(r-1),v=u*p*wV[n];for(let o=0;o<t;o++)s[o]={levelID:o,levelWidth:t>1?c:u,levelHeight:t>1?d:p,levelBuffer:new Uint8Array(e.buffer,l,v)},l+=v,c=c>>1||1,d=d>>1||1,u=c+a-1&~(a-1),p=d+r-1&~(r-1),v=u*p*wV[n];return s}}const TV=827611204,IV=861165636,RV=894720068,MV={[TV]:kV.COMPRESSED_RGBA_S3TC_DXT1_EXT,[IV]:kV.COMPRESSED_RGBA_S3TC_DXT3_EXT,[RV]:kV.COMPRESSED_RGBA_S3TC_DXT5_EXT},PV={70:kV.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:kV.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:kV.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:kV.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:kV.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:kV.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:kV.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:kV.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:kV.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:kV.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:kV.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:kV.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:kV.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT},DV=[171,75,84,88,32,49,49,187,13,10,26,10],zV={[cX.UNSIGNED_BYTE]:1,[cX.UNSIGNED_SHORT]:2,[cX.INT]:4,[cX.UNSIGNED_INT]:4,[cX.FLOAT]:4,[cX.HALF_FLOAT]:8},NV={[sX.RGBA]:4,[sX.RGB]:3,[sX.RG]:2,[sX.RED]:1,[sX.LUMINANCE]:1,[sX.LUMINANCE_ALPHA]:2,[sX.ALPHA]:1},$V={[cX.UNSIGNED_SHORT_4_4_4_4]:2,[cX.UNSIGNED_SHORT_5_5_5_1]:2,[cX.UNSIGNED_SHORT_5_6_5]:2};function OV(e){switch(e){case sX.RGBA:return sX.RGBA_INTEGER;case sX.RGB:return sX.RGB_INTEGER;case sX.RG:return sX.RG_INTEGER;case sX.RED:return sX.RED_INTEGER;default:return e}}const FV={extension:{type:qU.LoadParser,priority:MH.High},name:"loadDDS",test:e=>LH(e,".dds"),async load(e,n,t){const a=function(e){const n=new Uint32Array(e);if(542327876!==n[0])throw new Error("Invalid DDS file magic word");const t=new Uint32Array(e,0,124/Uint32Array.BYTES_PER_ELEMENT),a=t[3],r=t[4],o=t[7],i=new Uint32Array(e,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),s=i[1];if(4&s){const t=i[2];if(808540228!==t){const n=MV[t],i=new Uint8Array(e,128);return[new EV(i,{format:n,width:r,height:a,levels:o})]}const s=128,l=new Uint32Array(n.buffer,s,20/Uint32Array.BYTES_PER_ELEMENT),c=l[0],d=l[1],u=l[2],p=l[3],v=PV[c];if(void 0===v)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===d)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,h=148;if(1===p)f.push(new Uint8Array(e,h));else{const n=wV[v];let t=0,i=r,s=a;for(let e=0;e<o;e++)t+=Math.max(1,i+3&-4)*Math.max(1,s+3&-4)*n,i>>>=1,s>>>=1;let l=h;for(let n=0;n<p;n++)f.push(new Uint8Array(e,l,t)),l+=t}return f.map(e=>new EV(e,{format:v,width:r,height:a,levels:o}))}throw 64&s?new Error("DDSParser does not support uncompressed texture data."):512&s?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&s?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&s?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await wX.ADAPTER.fetch(e)).arrayBuffer()).map(a=>KH(new iW(a,{mipmap:vX.OFF,alphaMode:fX.NO_PREMULTIPLIED_ALPHA,resolution:WU(e),...n.data}),t,e));return 1===a.length?a[0]:a},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};VU.add(FV);const jV={extension:{type:qU.LoadParser,priority:MH.High},name:"loadKTX",test:e=>LH(e,".ktx"),async load(e,n,t){const a=await(await wX.ADAPTER.fetch(e)).arrayBuffer(),{compressed:r,uncompressed:o,kvData:i}=function(e,n,t=!1){const a=new DataView(n);if(!function(e,n){for(let t=0;t<DV.length;t++)if(n.getUint8(t)!==DV[t])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,a))return null;const r=67305985===a.getUint32(12,!0),o=a.getUint32(16,r),i=a.getUint32(24,r),s=a.getUint32(28,r),l=a.getUint32(36,r),c=a.getUint32(40,r)||1,d=a.getUint32(44,r)||1,u=a.getUint32(48,r)||1,p=a.getUint32(52,r),v=a.getUint32(56,r),f=a.getUint32(60,r);if(0===c||1!==d)throw new Error("Only 2D textures are supported");if(1!==p)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const h=l+3&-4,m=c+3&-4,g=new Array(u);let b,y=l*c;if(0===o&&(y=h*m),b=0!==o?zV[o]?zV[o]*NV[i]:$V[o]:wV[s],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=t?function(e,n,t){const a=new Map;let r=0;for(;r<n;){const o=e.getUint32(64+r,t),i=64+r+4,s=3-(o+3)%4;if(0===o||o>n-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<o&&0!==e.getUint8(i+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=(new TextDecoder).decode(new Uint8Array(e.buffer,i,l)),d=new DataView(e.buffer,i+l+1,o-l-1);a.set(c,d),r+=4+o+s}return a}(a,f,r):null;let k=y*b,w=l,_=c,C=h,A=m,S=64+f;for(let e=0;e<v;e++){const t=a.getUint32(S,r);let i=S+4;for(let t=0;t<u;t++){let a=g[t];a||(a=g[t]=new Array(v)),a[e]={levelID:e,levelWidth:v>1||0!==o?w:C,levelHeight:v>1||0!==o?_:A,levelBuffer:new Uint8Array(n,i,k)},i+=k}S+=t+4,S=S%4!=0?S+4-S%4:S,w=w>>1||1,_=_>>1||1,C=w+4-1&-4,A=_+4-1&-4,k=C*A*b}return 0!==o?{uncompressed:g.map(e=>{let n=e[0].levelBuffer,t=!1;return o===cX.FLOAT?n=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):o===cX.UNSIGNED_INT?(t=!0,n=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):o===cX.INT&&(t=!0,n=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new aW(n,{width:e[0].levelWidth,height:e[0].levelHeight}),type:o,format:t?OV(i):i}}),kvData:x}:{compressed:g.map(e=>new EV(null,{format:s,width:l,height:c,levels:v,levelBuffers:e})),kvData:x}}(e,a),s=r??o,l={mipmap:vX.OFF,alphaMode:fX.NO_PREMULTIPLIED_ALPHA,resolution:WU(e),...n.data},c=s.map(n=>{s===o&&Object.assign(l,{type:n.type,format:n.format});const a=n.resource??n,r=new iW(a,l);return r.ktxKeyValueData=i,KH(r,t,e)});return 1===c.length?c[0]:c},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};VU.add(jV);const BV=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],XV={extension:qU.ResolveParser,test:e=>{const n=HX.extname(e).slice(1);return["basis","ktx","dds"].includes(n)},parse:e=>{const n=e.split("."),t=n.pop();if(["ktx","dds"].includes(t)){const t=n.pop();if(BV.includes(t))return{resolution:parseFloat(wX.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t,src:e}}return{resolution:parseFloat(wX.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t,src:e}}};VU.add(XV);const UV=new _W,WV=class e{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,n,t,a){const r=new Image;return r.src=await this.base64(e,n,t,a),r}async base64(e,n,t,a){const r=this.canvas(e,a);if(void 0!==r.toBlob)return new Promise((e,a)=>{r.toBlob(n=>{if(!n)return void a(new Error("ICanvas.toBlob failed!"));const t=new FileReader;t.onload=()=>e(t.result),t.onerror=a,t.readAsDataURL(n)},n,t)});if(void 0!==r.toDataURL)return r.toDataURL(n,t);if(void 0!==r.convertToBlob){const e=await r.convertToBlob({type:n,quality:t});return new Promise((n,t)=>{const a=new FileReader;a.onload=()=>n(a.result),a.onerror=t,a.readAsDataURL(e)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(n,t){const{pixels:a,width:r,height:o,flipY:i,premultipliedAlpha:s}=this._rawPixels(n,t);i&&e._flipY(a,r,o),s&&e._unpremultiplyAlpha(a);const l=new BU(r,o,1),c=new ImageData(new Uint8ClampedArray(a.buffer),r,o);return l.context.putImageData(c,0,0),l.canvas}pixels(n,t){const{pixels:a,width:r,height:o,flipY:i,premultipliedAlpha:s}=this._rawPixels(n,t);return i&&e._flipY(a,r,o),s&&e._unpremultiplyAlpha(a),a}_rawPixels(e,n){const t=this.renderer;if(!t)throw new Error("The Extract has already been destroyed");let a,r,o=!1,i=!1,s=!1;e&&(e instanceof Cq?r=e:(r=t.generateTexture(e,{region:n,resolution:t.resolution,multisample:t.multisample}),s=!0,n&&(UV.width=n.width,UV.height=n.height,n=UV)));const l=t.gl;if(r){if(a=r.baseTexture.resolution,n=n??r.frame,o=!1,i=r.baseTexture.alphaMode>0&&r.baseTexture.format===sX.RGBA,!s){t.renderTexture.bind(r);const e=r.framebuffer.glFramebuffers[t.CONTEXT_UID];e.blitFramebuffer&&t.framebuffer.bind(e.blitFramebuffer)}}else a=t.resolution,n||((n=UV).width=t.width/a,n.height=t.height/a),o=!0,i=this._rendererPremultipliedAlpha,t.renderTexture.bind();const c=Math.max(Math.round(n.width*a),1),d=Math.max(Math.round(n.height*a),1),u=new Uint8Array(4*c*d);return l.readPixels(Math.round(n.x*a),Math.round(n.y*a),c,d,l.RGBA,l.UNSIGNED_BYTE,u),s&&r?.destroy(!0),{pixels:u,width:c,height:d,flipY:o,premultipliedAlpha:i}}destroy(){this.renderer=null}static _flipY(e,n,t){const a=n<<2,r=t>>1,o=new Uint8Array(a);for(let n=0;n<r;n++){const r=n*a,i=(t-n-1)*a;o.set(e.subarray(r,r+a)),e.copyWithin(r,i,i+a),e.set(o,i)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const n=e.length;for(let t=0;t<n;t+=4){const n=e[t+3];if(0!==n){const a=255.001/n;e[t]=e[t]*a+.5,e[t+1]=e[t+1]*a+.5,e[t+2]=e[t+2]*a+.5}}}};WV.extension={name:"extract",type:qU.RendererSystem};let qV=WV;VU.add(qV);const GV={build(e){const n=e.points;let t,a,r,o,i,s;if(e.type===xW.CIRC){const n=e.shape;t=n.x,a=n.y,i=s=n.radius,r=o=0}else if(e.type===xW.ELIP){const n=e.shape;t=n.x,a=n.y,i=n.width,s=n.height,r=o=0}else{const n=e.shape,l=n.width/2,c=n.height/2;t=n.x+l,a=n.y+c,i=s=Math.max(0,Math.min(n.radius,Math.min(l,c))),r=l-i,o=c-s}if(!(i>=0&&s>=0&&r>=0&&o>=0))return void(n.length=0);const l=Math.ceil(2.3*Math.sqrt(i+s)),c=8*l+(r?4:0)+(o?4:0);if(n.length=c,0===c)return;if(0===l)return n.length=8,n[0]=n[6]=t+r,n[1]=n[3]=a+o,n[2]=n[4]=t-r,void(n[5]=n[7]=a-o);let d=0,u=4*l+(r?2:0)+2,p=u,v=c;{const e=r+i,s=o,l=t+e,c=t-e,f=a+s;if(n[d++]=l,n[d++]=f,n[--u]=f,n[--u]=c,o){const e=a-s;n[p++]=c,n[p++]=e,n[--v]=e,n[--v]=l}}for(let e=1;e<l;e++){const c=Math.PI/2*(e/l),f=r+Math.cos(c)*i,h=o+Math.sin(c)*s,m=t+f,g=t-f,b=a+h,y=a-h;n[d++]=m,n[d++]=b,n[--u]=b,n[--u]=g,n[p++]=g,n[p++]=y,n[--v]=y,n[--v]=m}{const e=o+s,i=t+r,l=t-r,c=a+e,u=a-e;n[d++]=i,n[d++]=c,n[--v]=u,n[--v]=i,r&&(n[d++]=l,n[d++]=c,n[--v]=u,n[--v]=l)}},triangulate(e,n){const t=e.points,a=n.points,r=n.indices;if(0===t.length)return;let o=a.length/2;const i=o;let s,l;if(e.type!==xW.RREC){const n=e.shape;s=n.x,l=n.y}else{const n=e.shape;s=n.x+n.width/2,l=n.y+n.height/2}const c=e.matrix;a.push(e.matrix?c.a*s+c.c*l+c.tx:s,e.matrix?c.b*s+c.d*l+c.ty:l),o++,a.push(t[0],t[1]);for(let e=2;e<t.length;e+=2)a.push(t[e],t[e+1]),r.push(o++,i,o);r.push(i+1,i,o)}};function HV(e,n=!1){const t=e.length;if(t<6)return;let a=0;for(let n=0,r=e[t-2],o=e[t-1];n<t;n+=2){const t=e[n],i=e[n+1];a+=(t-r)*(i+o),r=t,o=i}if(!n&&a>0||n&&a<=0){const n=t/2;for(let a=n+n%2;a<t;a+=2){const n=t-a-2,r=t-a-1,o=a,i=a+1;[e[n],e[o]]=[e[o],e[n]],[e[r],e[i]]=[e[i],e[r]]}}}const VV={build(e){e.points=e.shape.points.slice()},triangulate(e,n){let t=e.points;const a=e.holes,r=n.points,o=n.indices;if(t.length>=6){HV(t,!1);const e=[];for(let n=0;n<a.length;n++){const r=a[n];HV(r.points,!0),e.push(t.length/2),t=t.concat(r.points)}const n=XX(t,e,2);if(!n)return;const i=r.length/2;for(let e=0;e<n.length;e+=3)o.push(n[e]+i),o.push(n[e+1]+i),o.push(n[e+2]+i);for(let e=0;e<t.length;e++)r.push(t[e])}}},QV={build(e){const n=e.shape,t=n.x,a=n.y,r=n.width,o=n.height,i=e.points;i.length=0,r>=0&&o>=0&&i.push(t,a,t+r,a,t+r,a+o,t,a+o)},triangulate(e,n){const t=e.points,a=n.points;if(0===t.length)return;const r=a.length/2;a.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),n.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},KV={build(e){GV.build(e)},triangulate(e,n){GV.triangulate(e,n)}};var YV=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(YV||{}),JV=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(JV||{});const ZV={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,n=20){if(!this.adaptive||!e||isNaN(e))return n;let t=Math.ceil(e/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class eQ{static curveTo(e,n,t,a,r,o){const i=o[o.length-2],s=o[o.length-1]-n,l=i-e,c=a-n,d=t-e,u=Math.abs(s*d-l*c);if(u<1e-8||0===r)return(o[o.length-2]!==e||o[o.length-1]!==n)&&o.push(e,n),null;const p=s*s+l*l,v=c*c+d*d,f=s*c+l*d,h=r*Math.sqrt(p)/u,m=r*Math.sqrt(v)/u,g=h*f/p,b=m*f/v,y=h*d+m*l,x=h*c+m*s,k=l*(m+g),w=s*(m+g),_=d*(h+b),C=c*(h+b);return{cx:y+e,cy:x+n,radius:r,startAngle:Math.atan2(w-x,k-y),endAngle:Math.atan2(C-x,_-y),anticlockwise:l*c>d*s}}static arc(e,n,t,a,r,o,i,s,l){const c=i-o,d=ZV._segmentsCount(Math.abs(c)*r,40*Math.ceil(Math.abs(c)/gW)),u=c/(2*d),p=2*u,v=Math.cos(u),f=Math.sin(u),h=d-1,m=h%1/h;for(let e=0;e<=h;++e){const n=u+o+p*(e+m*e),i=Math.cos(n),s=-Math.sin(n);l.push((v*i+f*s)*r+t,(v*-s+f*i)*r+a)}}}class nQ{static curveLength(e,n,t,a,r,o,i,s){let l=0,c=0,d=0,u=0,p=0,v=0,f=0,h=0,m=0,g=0,b=0,y=e,x=n;for(let k=1;k<=10;++k)c=k/10,d=c*c,u=d*c,p=1-c,v=p*p,f=v*p,h=f*e+3*v*c*t+3*p*d*r+u*i,m=f*n+3*v*c*a+3*p*d*o+u*s,g=y-h,b=x-m,y=h,x=m,l+=Math.sqrt(g*g+b*b);return l}static curveTo(e,n,t,a,r,o,i){const s=i[i.length-2],l=i[i.length-1];i.length-=2;const c=ZV._segmentsCount(nQ.curveLength(s,l,e,n,t,a,r,o));let d=0,u=0,p=0,v=0,f=0;i.push(s,l);for(let h=1,m=0;h<=c;++h)m=h/c,d=1-m,u=d*d,p=u*d,v=m*m,f=v*m,i.push(p*s+3*u*m*e+3*d*v*t+f*r,p*l+3*u*m*n+3*d*v*a+f*o)}}function tQ(e,n,t,a,r,o,i,s){let l,c;i?(l=a,c=-t):(l=-a,c=t);const d=e-t*r+l,u=n-a*r+c,p=e+t*o+l,v=n+a*o+c;return s.push(d,u,p,v),2}function aQ(e,n,t,a,r,o,i,s){const l=t-e,c=a-n;let d=Math.atan2(l,c),u=Math.atan2(r-e,o-n);s&&d<u?d+=2*Math.PI:!s&&d>u&&(u+=2*Math.PI);let p=d;const v=u-d,f=Math.abs(v),h=Math.sqrt(l*l+c*c),m=1+(15*f*Math.sqrt(h)/Math.PI|0),g=v/m;if(p+=g,s){i.push(e,n,t,a);for(let t=1,a=p;t<m;t++,a+=g)i.push(e,n,e+Math.sin(a)*h,n+Math.cos(a)*h);i.push(e,n,r,o)}else{i.push(t,a,e,n);for(let t=1,a=p;t<m;t++,a+=g)i.push(e+Math.sin(a)*h,n+Math.cos(a)*h,e,n);i.push(r,o,e,n)}return 2*m}function rQ(e,n){e.lineStyle.native?function(e,n){let t=0;const a=e.shape,r=e.points||a.points,o=a.type!==xW.POLY||a.closeStroke;if(0===r.length)return;const i=n.points,s=n.indices,l=r.length/2,c=i.length/2;let d=c;for(i.push(r[0],r[1]),t=1;t<l;t++)i.push(r[2*t],r[2*t+1]),s.push(d,d+1),d++;o&&s.push(d,c)}(e,n):function(e,n){const t=e.shape;let a=e.points||t.points.slice();const r=n.closePointEps;if(0===a.length)return;const o=e.lineStyle,i=new kW(a[0],a[1]),s=new kW(a[a.length-2],a[a.length-1]),l=t.type!==xW.POLY||t.closeStroke,c=Math.abs(i.x-s.x)<r&&Math.abs(i.y-s.y)<r;if(l){a=a.slice(),c&&(a.pop(),a.pop(),s.set(a[a.length-2],a[a.length-1]));const e=.5*(i.x+s.x),n=.5*(s.y+i.y);a.unshift(e,n),a.push(e,n)}const d=n.points,u=a.length/2;let p=a.length;const v=d.length/2,f=o.width/2,h=f*f,m=o.miterLimit*o.miterLimit;let g=a[0],b=a[1],y=a[2],x=a[3],k=0,w=0,_=-(b-x),C=g-y,A=0,S=0,L=Math.sqrt(_*_+C*C);_/=L,C/=L,_*=f,C*=f;const E=o.alignment,T=2*(1-E),I=2*E;l||(o.cap===JV.ROUND?p+=aQ(g-_*(T-I)*.5,b-C*(T-I)*.5,g-_*T,b-C*T,g+_*I,b+C*I,d,!0)+2:o.cap===JV.SQUARE&&(p+=tQ(g,b,_,C,T,I,!0,d))),d.push(g-_*T,b-C*T,g+_*I,b+C*I);for(let e=1;e<u-1;++e){g=a[2*(e-1)],b=a[2*(e-1)+1],y=a[2*e],x=a[2*e+1],k=a[2*(e+1)],w=a[2*(e+1)+1],_=-(b-x),C=g-y,L=Math.sqrt(_*_+C*C),_/=L,C/=L,_*=f,C*=f,A=-(x-w),S=y-k,L=Math.sqrt(A*A+S*S),A/=L,S/=L,A*=f,S*=f;const n=y-g,t=b-x,r=y-k,i=w-x,s=n*r+t*i,l=t*r-i*n,c=l<0;if(Math.abs(l)<.001*Math.abs(s)){d.push(y-_*T,x-C*T,y+_*I,x+C*I),s>=0&&(o.join===YV.ROUND?p+=aQ(y,x,y-_*T,x-C*T,y-A*T,x-S*T,d,!1)+4:p+=2,d.push(y-A*I,x-S*I,y+A*T,x+S*T));continue}const u=(-_+g)*(-C+x)-(-_+y)*(-C+b),v=(-A+k)*(-S+x)-(-A+y)*(-S+w),E=(n*v-r*u)/l,R=(i*u-t*v)/l,M=(E-y)*(E-y)+(R-x)*(R-x),P=y+(E-y)*T,D=x+(R-x)*T,z=y-(E-y)*I,N=x-(R-x)*I,$=c?T:I,O=M<=Math.min(n*n+t*t,r*r+i*i)+$*$*h;let F=o.join;if(F===YV.MITER&&M/h>m&&(F=YV.BEVEL),O)switch(F){case YV.MITER:d.push(P,D,z,N);break;case YV.BEVEL:c?d.push(P,D,y+_*I,x+C*I,P,D,y+A*I,x+S*I):d.push(y-_*T,x-C*T,z,N,y-A*T,x-S*T,z,N),p+=2;break;case YV.ROUND:c?(d.push(P,D,y+_*I,x+C*I),p+=aQ(y,x,y+_*I,x+C*I,y+A*I,x+S*I,d,!0)+4,d.push(P,D,y+A*I,x+S*I)):(d.push(y-_*T,x-C*T,z,N),p+=aQ(y,x,y-_*T,x-C*T,y-A*T,x-S*T,d,!1)+4,d.push(y-A*T,x-S*T,z,N))}else{switch(d.push(y-_*T,x-C*T,y+_*I,x+C*I),F){case YV.MITER:c?d.push(z,N,z,N):d.push(P,D,P,D),p+=2;break;case YV.ROUND:p+=c?aQ(y,x,y+_*I,x+C*I,y+A*I,x+S*I,d,!0)+2:aQ(y,x,y-_*T,x-C*T,y-A*T,x-S*T,d,!1)+2}d.push(y-A*T,x-S*T,y+A*I,x+S*I),p+=2}}g=a[2*(u-2)],b=a[2*(u-2)+1],y=a[2*(u-1)],x=a[2*(u-1)+1],_=-(b-x),C=g-y,L=Math.sqrt(_*_+C*C),_/=L,C/=L,_*=f,C*=f,d.push(y-_*T,x-C*T,y+_*I,x+C*I),l||(o.cap===JV.ROUND?p+=aQ(y-_*(T-I)*.5,x-C*(T-I)*.5,y-_*T,x-C*T,y+_*I,x+C*I,d,!1)+2:o.cap===JV.SQUARE&&(p+=tQ(y,x,_,C,T,I,!1,d)));const R=n.indices,M=ZV.epsilon*ZV.epsilon;for(let e=v;e<p+v-2;++e)g=d[2*e],b=d[2*e+1],y=d[2*(e+1)],x=d[2*(e+1)+1],k=d[2*(e+2)],w=d[2*(e+2)+1],!(Math.abs(g*(x-w)+y*(w-b)+k*(b-x))<M)&&R.push(e,e+1,e+2)}(e,n)}class oQ{static curveLength(e,n,t,a,r,o){const i=e-2*t+r,s=n-2*a+o,l=2*t-2*e,c=2*a-2*n,d=4*(i*i+s*s),u=4*(i*l+s*c),p=l*l+c*c,v=2*Math.sqrt(d+u+p),f=Math.sqrt(d),h=2*d*f,m=2*Math.sqrt(p),g=u/f;return(h*v+f*u*(v-m)+(4*p*d-u*u)*Math.log((2*f+g+v)/(g+m)))/(4*h)}static curveTo(e,n,t,a,r){const o=r[r.length-2],i=r[r.length-1],s=ZV._segmentsCount(oQ.curveLength(o,i,e,n,t,a));let l=0,c=0;for(let d=1;d<=s;++d){const u=d/s;l=o+(e-o)*u,c=i+(n-i)*u,r.push(l+(e+(t-e)*u-l)*u,c+(n+(a-n)*u-c)*u)}}}const iQ={[xW.POLY]:VV,[xW.CIRC]:GV,[xW.ELIP]:GV,[xW.RECT]:QV,[xW.RREC]:KV},sQ=[],lQ=[];class cQ{constructor(e,n=null,t=null,a=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=t,this.fillStyle=n,this.matrix=a,this.type=e.type}clone(){return new cQ(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class dQ{constructor(){this.reset()}begin(e,n,t){this.reset(),this.style=e,this.start=n,this.attribStart=t}end(e,n){this.attribSize=n-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const uQ=new kW,pQ=class e extends mW{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new qG,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),lQ.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const n=this.batches[e];n.reset(),sQ.push(n)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,n=null,t=null,a=null){const r=new cQ(e,n,t,a);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,n=null){if(!this.graphicsData.length)return null;const t=new cQ(e,null,null,n),a=this.graphicsData[this.graphicsData.length-1];return t.lineStyle=a.lineStyle,a.holes.push(t),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const n=this.graphicsData;for(let t=0;t<n.length;++t){const a=n[t];if(a.fillStyle.visible&&a.shape&&(a.matrix?a.matrix.applyInverse(e,uQ):uQ.copyFrom(e),a.shape.contains(uQ.x,uQ.y))){let e=!1;if(a.holes)for(let n=0;n<a.holes.length;n++)if(a.holes[n].shape.contains(uQ.x,uQ.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,n=this.graphicsData;let t=null,a=null;this.batches.length>0&&(t=this.batches[this.batches.length-1],a=t.style);for(let r=this.shapeIndex;r<n.length;r++){this.shapeIndex++;const o=n[r],i=o.fillStyle,s=o.lineStyle;iQ[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix),(i.visible||s.visible)&&this.processHoles(o.holes);for(let n=0;n<2;n++){const r=0===n?i:s;if(!r.visible)continue;const l=r.texture.baseTexture,c=this.indices.length,d=this.points.length/2;l.wrapMode=pX.REPEAT,0===n?this.processFill(o):this.processLine(o);const u=this.points.length/2-d;0!==u&&(t&&!this._compareStyles(a,r)&&(t.end(c,d),t=null),t||(t=sQ.pop()||new dQ,t.begin(r,c,d),this.batches.push(t),a=r),this.addUvs(this.points,e,r.texture,d,u,r.matrix))}}const r=this.indices.length,o=this.points.length/2;if(t&&t.end(r,o),0===this.batches.length)return void(this.batchable=!0);const i=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&i===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=i?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,n){return!(!e||!n||e.texture.baseTexture!==n.texture.baseTexture||e.color+e.alpha!==n.color+n.alpha||!!e.native!=!!n.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,n=this.graphicsData.length;e<n;e++){const n=this.graphicsData[e],t=n.fillStyle,a=n.lineStyle;if(t&&!t.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let n=0,t=e.length;n<t;n++){const t=e[n];for(let e=0;e<t.size;e++){const n=t.start+e;this.indicesUint16[n]=this.indicesUint16[n]-t.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const n=this.batches;for(let e=0;e<n.length;e++)if(n[e].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE}buildDrawCalls(){let e=++iW._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),lQ.push(this.drawCalls[e]);this.drawCalls.length=0;const n=this.colors,t=this.textureIds;let a=lQ.pop();a||(a=new sW,a.texArray=new iq),a.texArray.count=0,a.start=0,a.size=0,a.type=iX.TRIANGLES;let r=0,o=null,i=0,s=!1,l=iX.TRIANGLES,c=0;this.drawCalls.push(a);for(let d=0;d<this.batches.length;d++){const u=this.batches[d],p=8,v=u.style,f=v.texture.baseTexture;s!==!!v.native&&(s=!!v.native,l=s?iX.LINES:iX.TRIANGLES,o=null,r=p,e++),o!==f&&(o=f,f._batchEnabled!==e&&(r===p&&(e++,r=0,a.size>0&&(a=lQ.pop(),a||(a=new sW,a.texArray=new iq),this.drawCalls.push(a)),a.start=c,a.size=0,a.texArray.count=0,a.type=l),f.touched=1,f._batchEnabled=e,f._batchLocation=r,f.wrapMode=pX.REPEAT,a.texArray.elements[a.texArray.count++]=f,r++)),a.size+=u.size,c+=u.size,i=f._batchLocation,this.addColors(n,v.color,v.alpha,u.attribSize,u.attribStart),this.addTextureIds(t,i,u.attribSize,u.attribStart)}iW._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,n=this.uvs,t=this.colors,a=this.textureIds,r=new ArrayBuffer(3*e.length*4),o=new Float32Array(r),i=new Uint32Array(r);let s=0;for(let r=0;r<e.length/2;r++)o[s++]=e[2*r],o[s++]=e[2*r+1],o[s++]=n[2*r],o[s++]=n[2*r+1],i[s++]=t[r],o[s++]=a[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?VV.triangulate(e,this):iQ[e.type].triangulate(e,this)}processLine(e){rQ(e,this);for(let n=0;n<e.holes.length;n++)rQ(e.holes[n],this)}processHoles(e){for(let n=0;n<e.length;n++){const t=e[n];iQ[t.type].build(t),t.matrix&&this.transformPoints(t.points,t.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,n){for(let t=0;t<e.length/2;t++){const a=e[2*t],r=e[2*t+1];e[2*t]=n.a*a+n.c*r+n.tx,e[2*t+1]=n.b*a+n.d*r+n.ty}}addColors(e,n,t,a,r=0){const o=AU.shared.setValue(n).toLittleEndianNumber(),i=AU.shared.setValue(o).toPremultiplied(t);e.length=Math.max(e.length,r+a);for(let n=0;n<a;n++)e[r+n]=i}addTextureIds(e,n,t,a=0){e.length=Math.max(e.length,a+t);for(let r=0;r<t;r++)e[a+r]=n}addUvs(e,n,t,a,r,o=null){let i=0;const s=n.length,l=t.frame;for(;i<r;){let t=e[2*(a+i)],r=e[2*(a+i)+1];if(o){const e=o.a*t+o.c*r+o.tx;r=o.b*t+o.d*r+o.ty,t=e}i++,n.push(t/l.width,r/l.height)}const c=t.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(n,t,s,r)}adjustUvs(e,n,t,a){const r=n.baseTexture,o=1e-6,i=t+2*a,s=n.frame,l=s.width/r.width,c=s.height/r.height;let d=s.x/s.width,u=s.y/s.height,p=Math.floor(e[t]+o),v=Math.floor(e[t+1]+o);for(let n=t+2;n<i;n+=2)p=Math.min(p,Math.floor(e[n]+o)),v=Math.min(v,Math.floor(e[n+1]+o));d-=p,u-=v;for(let n=t;n<i;n+=2)e[n]=(e[n]+d)*l,e[n+1]=(e[n+1]+u)*c}};pQ.BATCHABLE_SIZE=100;let vQ=pQ;class fQ{constructor(){this.color=16777215,this.alpha=1,this.texture=_q.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new fQ;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=_q.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class hQ extends fQ{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=JV.BUTT,this.join=YV.MITER,this.miterLimit=10}clone(){const e=new hQ;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=JV.BUTT,this.join=YV.MITER,this.miterLimit=10}}const mQ={},gQ=class e extends YG{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new fQ,this._lineStyle=new hQ,this._matrix=null,this._holeMode=!1,this.state=JU.for2d(),this._geometry=e||new vQ,this._geometry.refCount++,this._transformID=-1,this._tintColor=new AU(16777215),this.blendMode=oX.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new e(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,n=0,t,a=.5,r=!1){return"number"==typeof e&&(e={width:e,color:n,alpha:t,alignment:a,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const n={width:0,texture:_q.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:JV.BUTT,join:YV.MITER,miterLimit:10};e=Object.assign(n,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,n=this.currentPath.points.length;n>2&&(this.drawShape(this.currentPath),this.currentPath=new SW,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[n-2],e[n-1]))}else this.currentPath=new SW,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,n){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=n,this}lineTo(e,n){this.currentPath||this.moveTo(0,0);const t=this.currentPath.points,a=t[t.length-2],r=t[t.length-1];return(a!==e||r!==n)&&t.push(e,n),this}_initCurve(e=0,n=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,n]):this.moveTo(e,n)}quadraticCurveTo(e,n,t,a){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),oQ.curveTo(e,n,t,a,r),this}bezierCurveTo(e,n,t,a,r,o){return this._initCurve(),nQ.curveTo(e,n,t,a,r,o,this.currentPath.points),this}arcTo(e,n,t,a,r){this._initCurve(e,n);const o=this.currentPath.points,i=eQ.curveTo(e,n,t,a,r,o);if(i){const{cx:e,cy:n,radius:t,startAngle:a,endAngle:r,anticlockwise:o}=i;this.arc(e,n,t,a,r,o)}return this}arc(e,n,t,a,r,o=!1){if(a===r)return this;if(!o&&r<=a?r+=gW:o&&a<=r&&(a+=gW),r-a===0)return this;const i=e+Math.cos(a)*t,s=n+Math.sin(a)*t,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const e=Math.abs(c[c.length-2]-i),n=Math.abs(c[c.length-1]-s);e<l&&n<l||c.push(i,s)}else this.moveTo(i,s),c=this.currentPath.points;return eQ.arc(i,s,e,n,t,a,r,o,c),this}beginFill(e=0,n){return this.beginTextureFill({texture:_q.WHITE,color:e,alpha:n})}normalizeColor(e){const n=AU.shared.setValue(e.color??0);e.color=n.toNumber(),e.alpha??(e.alpha=n.alpha)}beginTextureFill(e){const n={texture:_q.WHITE,color:16777215,matrix:null};e=Object.assign(n,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,n,t,a){return this.drawShape(new _W(e,n,t,a))}drawRoundedRect(e,n,t,a,r){return this.drawShape(new LW(e,n,t,a,r))}drawCircle(e,n,t){return this.drawShape(new CW(e,n,t))}drawEllipse(e,n,t,a){return this.drawShape(new AW(e,n,t,a))}drawPolygon(...e){let n,t=!0;const a=e[0];a.points?(t=a.closeStroke,n=a.points):n=Array.isArray(e[0])?e[0]:e;const r=new SW(n);return r.closeStroke=t,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return!(1!==e.length||e[0].shape.type!==xW.RECT||e[0].matrix||e[0].holes.length||e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const n=this._geometry;n.updateBatches(),n.batchable?(this.batchDirty!==n.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,n=this.blendMode,t=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=t,this.vertexData=new Float32Array(e.points);for(let a=0;a<t;a++){const t=e.batches[a],r=t.style.color,o=new Float32Array(this.vertexData.buffer,4*t.attribStart*2,2*t.attribSize),i=new Float32Array(e.uvsFloat32.buffer,4*t.attribStart*2,2*t.attribSize),s={vertexData:o,blendMode:n,indices:new Uint16Array(e.indicesUint16.buffer,2*t.start,t.size),uvs:i,_batchRGB:AU.shared.setValue(r).toRgbArray(),_tintRGB:r,_texture:t.style.texture,alpha:t.style.alpha,worldAlpha:1};this.batches[a]=s}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let n=0,t=this.batches.length;n<t;n++){const t=this.batches[n];t.worldAlpha=this.worldAlpha*t.alpha,e.plugins[this.pluginName].render(t)}}}_renderDirect(e){const n=this._resolveDirectShader(e),t=this._geometry,a=this.worldAlpha,r=n.uniforms,o=t.drawCalls;r.translationMatrix=this.transform.worldTransform,AU.shared.setValue(this._tintColor).premultiply(a).toArray(r.tint),e.shader.bind(n),e.geometry.bind(t,n),e.state.set(this.state);for(let n=0,a=o.length;n<a;n++)this._renderDrawCallDirect(e,t.drawCalls[n])}_renderDrawCallDirect(e,n){const{texArray:t,type:a,size:r,start:o}=n,i=t.count;for(let n=0;n<i;n++)e.texture.bind(t.elements[n],n);e.geometry.draw(a,r,o)}_resolveDirectShader(e){let n=this.shader;const t=this.pluginName;if(!n){if(!mQ[t]){const{maxTextures:n}=e.plugins[t],a=new Int32Array(n);for(let e=0;e<n;e++)a[e]=e;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new EW,default:aq.from({uSamplers:a},!0)},o=e.plugins[t]._shader.program;mQ[t]=new rq(o,r)}n=mQ[t]}return n}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:n,minY:t,maxX:a,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,n,t,a,r)}containsPoint(n){return this.worldTransform.applyInverse(n,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const n=this.batches[e];n._tintRGB=AU.shared.setValue(this._tintColor).multiply(n._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const n=this.transform.worldTransform,t=n.a,a=n.b,r=n.c,o=n.d,i=n.tx,s=n.ty,l=this._geometry.points,c=this.vertexData;let d=0;for(let e=0;e<l.length;e+=2){const n=l[e],u=l[e+1];c[d++]=t*n+r*u+i,c[d++]=o*u+a*n+s}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};gQ.curves=ZV,gQ._TEMP_POINT=new kW;let bQ=gQ;class yQ{constructor(e,n){this.uvBuffer=e,this.uvMatrix=n,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const n=this.uvBuffer.data;(!this.data||this.data.length!==n.length)&&(this.data=new Float32Array(n.length)),this.uvMatrix.multiplyUvs(n,this.data),this._updateID++}}const xQ=new kW,kQ=new SW,wQ=class e extends YG{constructor(e,n,t,a=iX.TRIANGLES){super(),this.geometry=e,this.shader=n,this.state=t||JU.for2d(),this.drawMode=a,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=wX.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(n){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===iX.TRIANGLES&&t.length<2*e.BATCHABLE_SIZE?this._renderToBatch(n):this._renderDefault(n)}_renderDefault(e){const n=this.shader;n.alpha=this.worldAlpha,n.update&&n.update(),e.batch.flush(),n.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(n),e.state.set(this.state),e.geometry.bind(this.geometry,n),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const n=this.geometry,t=this.shader;t.uvMatrix&&(t.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=n.indexBuffer.data,this._tintRGB=t._tintRGB,this._texture=t.texture;const a=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[a]),e.plugins[a].render(this)}calculateVertices(){const e=this.geometry.buffers[0],n=e.data,t=e._updateID;if(t===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==n.length&&(this.vertexData=new Float32Array(n.length));const a=this.transform.worldTransform,r=a.a,o=a.b,i=a.c,s=a.d,l=a.tx,c=a.ty,d=this.vertexData;for(let e=0;e<d.length/2;e++){const t=n[2*e],a=n[2*e+1];d[2*e]=r*t+i*a+l,d[2*e+1]=o*t+s*a+c}if(this._roundPixels){const e=wX.RESOLUTION;for(let n=0;n<d.length;++n)d[n]=Math.round(d[n]*e)/e}this.vertexDirty=t}calculateUvs(){const e=this.geometry.buffers[1],n=this.shader;n.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new yQ(e,n.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,xQ);const n=this.geometry.getBuffer("aVertexPosition").data,t=kQ.points,a=this.geometry.getIndex().data,r=a.length,o=4===this.drawMode?3:1;for(let e=0;e+2<r;e+=o){const r=2*a[e],o=2*a[e+1],i=2*a[e+2];if(t[0]=n[r],t[1]=n[r+1],t[2]=n[o],t[3]=n[o+1],t[4]=n[i],t[5]=n[i+1],kQ.contains(xQ.x,xQ.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};wQ.BATCHABLE_SIZE=100;let _Q=wQ;class CQ extends hW{constructor(e,n,t){super();const a=new cW(e),r=new cW(n,!0),o=new cW(t,!0,!0);this.addAttribute("aVertexPosition",a,2,!1,cX.FLOAT).addAttribute("aTextureCoord",r,2,!1,cX.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class AQ extends rq{constructor(e,n){const t={uSampler:e,alpha:1,uTextureMatrix:EW.IDENTITY,uColor:new Float32Array([1,1,1,1])};(n=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},n)).uniforms&&Object.assign(t,n.uniforms),super(n.program||nq.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),t),this._colorDirty=!1,this.uvMatrix=new Oq(e),this.batchable=void 0===n.program,this.pluginName=n.pluginName,this._tintColor=new AU(n.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=n.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;AU.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class SQ{constructor(e,n,t){this.geometry=new hW,this.indexBuffer=null,this.size=t,this.dynamicProperties=[],this.staticProperties=[];for(let t=0;t<e.length;++t){let a=e[t];a={attributeName:a.attributeName,size:a.size,uploadFunction:a.uploadFunction,type:a.type||cX.FLOAT,offset:a.offset},n[t]?this.dynamicProperties.push(a):this.staticProperties.push(a)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let n=0;this.indexBuffer=new cW(function(e,n=null){const t=6*e;if((n=n||new Uint16Array(t)).length!==t)throw new Error(`Out buffer length is incorrect, got ${n.length} and expected ${t}`);for(let e=0,a=0;e<t;e+=6,a+=4)n[e+0]=a+0,n[e+1]=a+1,n[e+2]=a+2,n[e+3]=a+0,n[e+4]=a+2,n[e+5]=a+3;return n}(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){const t=this.dynamicProperties[e];t.offset=n,n+=t.size,this.dynamicStride+=t.size}const t=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(t),this.dynamicDataUint32=new Uint32Array(t),this.dynamicBuffer=new cW(this.dynamicData,!1,!1);let a=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){const n=this.staticProperties[e];n.offset=a,a+=n.size,this.staticStride+=n.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new cW(this.staticData,!0,!1);for(let n=0;n<this.dynamicProperties.length;++n){const t=this.dynamicProperties[n];e.addAttribute(t.attributeName,this.dynamicBuffer,0,t.type===cX.UNSIGNED_BYTE,t.type,4*this.dynamicStride,4*t.offset)}for(let n=0;n<this.staticProperties.length;++n){const t=this.staticProperties[n];e.addAttribute(t.attributeName,this.staticBuffer,0,t.type===cX.UNSIGNED_BYTE,t.type,4*this.staticStride,4*t.offset)}}uploadDynamic(e,n,t){for(let a=0;a<this.dynamicProperties.length;a++){const r=this.dynamicProperties[a];r.uploadFunction(e,n,t,r.type===cX.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,n,t){for(let a=0;a<this.staticProperties.length;a++){const r=this.staticProperties[a];r.uploadFunction(e,n,t,r.type===cX.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class LQ extends sq{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new EW,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:cX.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=rq.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=JU.for2d()}render(e){const n=e.children,t=e._maxSize,a=e._batchSize,r=this.renderer;let o=n.length;if(0===o)return;o>t&&!e.autoResize&&(o=t);let i=e._buffers;i||(i=e._buffers=this.generateBuffers(e));const s=n[0]._texture.baseTexture,l=s.alphaMode>0;this.state.blendMode=LU(e.blendMode,l),r.state.set(this.state);const c=r.gl,d=e.worldTransform.copyTo(this.tempMatrix);d.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=AU.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=s,this.renderer.shader.bind(this.shader);let u=!1;for(let t=0,s=0;t<o;t+=a,s+=1){let l=o-t;l>a&&(l=a),s>=i.length&&i.push(this._generateOneMoreBuffer(e));const d=i[s];d.uploadDynamic(n,t,l);const p=e._bufferUpdateIDs[s]||0;u=u||d._updateID<p,u&&(d._updateID=e._updateID,d.uploadStatic(n,t,l)),r.geometry.bind(d.geometry),c.drawElements(c.TRIANGLES,6*l,c.UNSIGNED_SHORT,0)}}generateBuffers(e){const n=[],t=e._maxSize,a=e._batchSize,r=e._properties;for(let e=0;e<t;e+=a)n.push(new SQ(this.properties,r,a));return n}_generateOneMoreBuffer(e){const n=e._batchSize,t=e._properties;return new SQ(this.properties,t,n)}uploadVertices(e,n,t,a,r,o){let i=0,s=0,l=0,c=0;for(let d=0;d<t;++d){const t=e[n+d],u=t._texture,p=t.scale.x,v=t.scale.y,f=u.trim,h=u.orig;f?(s=f.x-t.anchor.x*h.width,i=s+f.width,c=f.y-t.anchor.y*h.height,l=c+f.height):(i=h.width*(1-t.anchor.x),s=h.width*-t.anchor.x,l=h.height*(1-t.anchor.y),c=h.height*-t.anchor.y),a[o]=s*p,a[o+1]=c*v,a[o+r]=i*p,a[o+r+1]=c*v,a[o+2*r]=i*p,a[o+2*r+1]=l*v,a[o+3*r]=s*p,a[o+3*r+1]=l*v,o+=4*r}}uploadPosition(e,n,t,a,r,o){for(let i=0;i<t;i++){const t=e[n+i].position;a[o]=t.x,a[o+1]=t.y,a[o+r]=t.x,a[o+r+1]=t.y,a[o+2*r]=t.x,a[o+2*r+1]=t.y,a[o+3*r]=t.x,a[o+3*r+1]=t.y,o+=4*r}}uploadRotation(e,n,t,a,r,o){for(let i=0;i<t;i++){const t=e[n+i].rotation;a[o]=t,a[o+r]=t,a[o+2*r]=t,a[o+3*r]=t,o+=4*r}}uploadUvs(e,n,t,a,r,o){for(let i=0;i<t;++i){const t=e[n+i]._texture._uvs;t?(a[o]=t.x0,a[o+1]=t.y0,a[o+r]=t.x1,a[o+r+1]=t.y1,a[o+2*r]=t.x2,a[o+2*r+1]=t.y2,a[o+3*r]=t.x3,a[o+3*r+1]=t.y3,o+=4*r):(a[o]=0,a[o+1]=0,a[o+r]=0,a[o+r+1]=0,a[o+2*r]=0,a[o+2*r+1]=0,a[o+3*r]=0,a[o+3*r+1]=0,o+=4*r)}}uploadTint(e,n,t,a,r,o){for(let i=0;i<t;++i){const t=e[n+i],s=AU.shared.setValue(t._tintRGB).toPremultiplied(t.alpha,t.texture.baseTexture.alphaMode>0);a[o]=s,a[o+r]=s,a[o+2*r]=s,a[o+3*r]=s,o+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}LQ.extension={name:"particle",type:qU.RendererPlugin},VU.add(LQ);var EQ=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(EQ||{});const TQ={willReadFrequently:!0},IQ=class e{static get experimentalLetterSpacingSupported(){let n=e._experimentalLetterSpacingSupported;if(void 0!==n){const t=wX.ADAPTER.getCanvasRenderingContext2D().prototype;n=e._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return n}constructor(e,n,t,a,r,o,i,s,l){this.text=e,this.style=n,this.width=t,this.height=a,this.lines=r,this.lineWidths=o,this.lineHeight=i,this.maxLineWidth=s,this.fontProperties=l}static measureText(n,t,a,r=e._canvas){a=a??t.wordWrap;const o=t.toFontString(),i=e.measureFont(o);0===i.fontSize&&(i.fontSize=t.fontSize,i.ascent=t.fontSize);const s=r.getContext("2d",TQ);s.font=o;const l=(a?e.wordWrap(n,t,r):n).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let d=0;for(let n=0;n<l.length;n++){const a=e._measureText(l[n],t.letterSpacing,s);c[n]=a,d=Math.max(d,a)}let u=d+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const p=t.lineHeight||i.fontSize+t.strokeThickness;let v=Math.max(p,i.fontSize+2*t.strokeThickness)+t.leading+(l.length-1)*(p+t.leading);return t.dropShadow&&(v+=t.dropShadowDistance),new e(n,t,u,v,l,c,p+t.leading,d,i)}static _measureText(n,t,a){let r=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(a.letterSpacing=`${t}px`,a.textLetterSpacing=`${t}px`,r=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px"));let o=a.measureText(n).width;return o>0&&(r?o-=t:o+=(e.graphemeSegmenter(n).length-1)*t),o}static wordWrap(n,t,a=e._canvas){const r=a.getContext("2d",TQ);let o=0,i="",s="";const l=Object.create(null),{letterSpacing:c,whiteSpace:d}=t,u=e.collapseSpaces(d),p=e.collapseNewlines(d);let v=!u;const f=t.wordWrapWidth+c,h=e.tokenize(n);for(let n=0;n<h.length;n++){let a=h[n];if(e.isNewline(a)){if(!p){s+=e.addLine(i),v=!u,i="",o=0;continue}a=" "}if(u){const n=e.isBreakingSpace(a),t=e.isBreakingSpace(i[i.length-1]);if(n&&t)continue}const d=e.getFromCache(a,c,l,r);if(d>f)if(""!==i&&(s+=e.addLine(i),i="",o=0),e.canBreakWords(a,t.breakWords)){const n=e.wordWrapSplit(a);for(let d=0;d<n.length;d++){let u=n[d],p=u,h=1;for(;n[d+h];){const r=n[d+h];if(e.canBreakChars(p,r,a,d,t.breakWords))break;u+=r,p=r,h++}d+=h-1;const m=e.getFromCache(u,c,l,r);m+o>f&&(s+=e.addLine(i),v=!1,i="",o=0),i+=u,o+=m}}else{i.length>0&&(s+=e.addLine(i),i="",o=0);const t=n===h.length-1;s+=e.addLine(a,!t),v=!1,i="",o=0}else d+o>f&&(v=!1,s+=e.addLine(i),i="",o=0),(i.length>0||!e.isBreakingSpace(a)||v)&&(i+=a,o+=d)}return s+=e.addLine(i,!1),s}static addLine(n,t=!0){return n=e.trimRight(n),t?`${n}\n`:n}static getFromCache(n,t,a,r){let o=a[n];return"number"!=typeof o&&(o=e._measureText(n,t,r)+t,a[n]=o),o}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(n){if("string"!=typeof n)return"";for(let t=n.length-1;t>=0;t--){const a=n[t];if(!e.isBreakingSpace(a))break;n=n.slice(0,-1)}return n}static isNewline(n){return"string"==typeof n&&e._newlines.includes(n.charCodeAt(0))}static isBreakingSpace(n,t){return"string"==typeof n&&e._breakingSpaces.includes(n.charCodeAt(0))}static tokenize(n){const t=[];let a="";if("string"!=typeof n)return t;for(let r=0;r<n.length;r++){const o=n[r],i=n[r+1];e.isBreakingSpace(o,i)||e.isNewline(o)?(""!==a&&(t.push(a),a=""),t.push(o)):a+=o}return""!==a&&t.push(a),t}static canBreakWords(e,n){return n}static canBreakChars(e,n,t,a,r){return!0}static wordWrapSplit(n){return e.graphemeSegmenter(n)}static measureFont(n){if(e._fonts[n])return e._fonts[n];const t={ascent:0,descent:0,fontSize:0},a=e._canvas,r=e._context;r.font=n;const o=e.METRICS_STRING+e.BASELINE_SYMBOL,i=Math.ceil(r.measureText(o).width);let s=Math.ceil(r.measureText(e.BASELINE_SYMBOL).width);const l=Math.ceil(e.HEIGHT_MULTIPLIER*s);if(s=s*e.BASELINE_MULTIPLIER|0,0===i||0===l)return e._fonts[n]=t,t;a.width=i,a.height=l,r.fillStyle="#f00",r.fillRect(0,0,i,l),r.font=n,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(o,0,s);const c=r.getImageData(0,0,i,l).data,d=c.length,u=4*i;let p=0,v=0,f=!1;for(p=0;p<s;++p){for(let e=0;e<u;e+=4)if(255!==c[v+e]){f=!0;break}if(f)break;v+=u}for(t.ascent=s-p,v=d-u,f=!1,p=l;p>s;--p){for(let e=0;e<u;e+=4)if(255!==c[v+e]){f=!0;break}if(f)break;v-=u}return t.descent=p-s,t.fontSize=t.ascent+t.descent,e._fonts[n]=t,t}static clearMetrics(n=""){n?delete e._fonts[n]:e._fonts={}}static get _canvas(){if(!e.__canvas){let n;try{const t=new OffscreenCanvas(0,0);if(t.getContext("2d",TQ)?.measureText)return e.__canvas=t,t;n=wX.ADAPTER.createCanvas()}catch{n=wX.ADAPTER.createCanvas()}n.width=n.height=10,e.__canvas=n}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",TQ)),e.__context}};IQ.METRICS_STRING="|ÉqÅ",IQ.BASELINE_SYMBOL="M",IQ.BASELINE_MULTIPLIER=1.4,IQ.HEIGHT_MULTIPLIER=2,IQ.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const e=new Intl.Segmenter;return n=>[...e.segment(n)].map(e=>e.segment)}return e=>[...e]})(),IQ.experimentalLetterSpacing=!1,IQ._fonts={},IQ._newlines=[10,13],IQ._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let RQ=IQ;const MQ=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],PQ=class e{constructor(e){this.styleID=0,this.reset(),NQ(this,e,e)}clone(){const n={};return NQ(n,this,e.defaultStyle),new e(n)}reset(){NQ(this,e.defaultStyle,e.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const n=zQ(e);this._dropShadowColor!==n&&(this._dropShadowColor=n,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const n=zQ(e);this._fill!==n&&(this._fill=n,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,n){if(!Array.isArray(e)||!Array.isArray(n)||e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(e[t]!==n[t])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const n=zQ(e);this._stroke!==n&&(this._stroke=n,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let n=this.fontFamily;Array.isArray(this.fontFamily)||(n=this.fontFamily.split(","));for(let e=n.length-1;e>=0;e--){let t=n[e].trim();!/([\"\'])[^\'\"]+\1/.test(t)&&!MQ.includes(t)&&(t=`"${t}"`),n[e]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${n.join(",")}`}};PQ.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:EQ.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let DQ=PQ;function zQ(e){const n=AU.shared,t=e=>{const t=n.setValue(e);return 1===t.alpha?t.toHex():t.toRgbaString()};return Array.isArray(e)?e.map(t):t(e)}function NQ(e,n,t){for(const a in t)Array.isArray(n[a])?e[a]=n[a].slice():e[a]=n[a]}const $Q={texture:!0,children:!1,baseTexture:!0},OQ=class e extends eH{constructor(n,t,a){let r=!1;a||(a=wX.ADAPTER.createCanvas(),r=!0),a.width=3,a.height=3;const o=_q.from(a);o.orig=new _W,o.trim=new _W,super(o),this._ownCanvas=r,this.canvas=a,this.context=a.getContext("2d",{willReadFrequently:!0}),this._resolution=e.defaultResolution??wX.RESOLUTION,this._autoResolution=e.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=n,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return RQ.experimentalLetterSpacing}static set experimentalLetterSpacing(e){WX("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),RQ.experimentalLetterSpacing=e}updateText(e){const n=this._style;if(this.localStyleID!==n.styleID&&(this.dirty=!0,this.localStyleID=n.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const t=this.context,a=RQ.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=a.width,o=a.height,i=a.lines,s=a.lineHeight,l=a.lineWidths,c=a.maxLineWidth,d=a.fontProperties;let u,p;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+2*n.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+2*n.padding)*this._resolution),t.scale(this._resolution,this._resolution),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.font=this._font,t.lineWidth=n.strokeThickness,t.textBaseline=n.textBaseline,t.lineJoin=n.lineJoin,t.miterLimit=n.miterLimit;const v=n.dropShadow?2:1;for(let e=0;e<v;++e){const r=n.dropShadow&&0===e,v=r?Math.ceil(Math.max(1,o)+2*n.padding):0,f=v*this._resolution;if(r){t.fillStyle="black",t.strokeStyle="black";const e=n.dropShadowColor,a=n.dropShadowBlur*this._resolution,r=n.dropShadowDistance*this._resolution;t.shadowColor=AU.shared.setValue(e).setAlpha(n.dropShadowAlpha).toRgbaString(),t.shadowBlur=a,t.shadowOffsetX=Math.cos(n.dropShadowAngle)*r,t.shadowOffsetY=Math.sin(n.dropShadowAngle)*r+f}else t.fillStyle=this._generateFillStyle(n,i,a),t.strokeStyle=n.stroke,t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;let h=(s-d.fontSize)/2;s-d.fontSize<0&&(h=0);for(let e=0;e<i.length;e++)u=n.strokeThickness/2,p=n.strokeThickness/2+e*s+d.ascent+h,"right"===n.align?u+=c-l[e]:"center"===n.align&&(u+=(c-l[e])/2),n.stroke&&n.strokeThickness&&this.drawLetterSpacing(i[e],u+n.padding,p+n.padding-v,!0),n.fill&&this.drawLetterSpacing(i[e],u+n.padding,p+n.padding-v)}this.updateTexture()}drawLetterSpacing(e,n,t,a=!1){const r=this._style.letterSpacing;let o=!1;if(RQ.experimentalLetterSpacingSupported&&(RQ.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||o)return void(a?this.context.strokeText(e,n,t):this.context.fillText(e,n,t));let i=n;const s=RQ.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let e=0;e<s.length;++e){const n=s[e];a?this.context.strokeText(n,i,t):this.context.fillText(n,i,t);let o="";for(let n=e+1;n<s.length;++n)o+=s[n];c=this.context.measureText(o).width,i+=l-c+r,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const n=function(e){const n=function(e){const{width:n,height:t}=e,a=e.getContext("2d",{willReadFrequently:!0});if(null===a)throw new TypeError("Failed to get canvas 2D context");const r=a.getImageData(0,0,n,t).data;let o=0,i=0,s=n-1,l=t-1;for(;i<t&&XU(r,n,i);)++i;if(i===t)return $U.EMPTY;for(;XU(r,n,l);)--l;for(;UU(r,n,o,i,l);)++o;for(;UU(r,n,s,i,l);)--s;return++s,++l,new $U(o,i,s,l)}(e),{width:t,height:a}=n;let r=null;if(!n.isEmpty()){const o=e.getContext("2d");if(null===o)throw new TypeError("Failed to get canvas 2D context");r=o.getImageData(n.left,n.top,t,a)}return{width:t,height:a,data:r}}(e);n.data&&(e.width=n.width,e.height=n.height,this.context.putImageData(n.data,0,0))}const n=this._texture,t=this._style,a=t.trim?0:t.padding,r=n.baseTexture;n.trim.width=n._frame.width=e.width/this._resolution,n.trim.height=n._frame.height=e.height/this._resolution,n.trim.x=-a,n.trim.y=-a,n.orig.width=n._frame.width-2*a,n.orig.height=n._frame.height-2*a,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),n.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,n){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,n)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,n,t){const a=e.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let r;const o=e.dropShadow?e.dropShadowDistance:0,i=e.padding||0,s=this.canvas.width/this._resolution-o-2*i,l=this.canvas.height/this._resolution-o-2*i,c=a.slice(),d=e.fillGradientStops.slice();if(!d.length){const e=c.length+1;for(let n=1;n<e;++n)d.push(n/e)}if(c.unshift(a[0]),d.unshift(0),c.push(a[a.length-1]),d.push(1),e.fillGradientType===EQ.LINEAR_VERTICAL){r=this.context.createLinearGradient(s/2,i,s/2,l+i);const a=t.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<n.length;e++){const o=t.lineHeight*(e-1)+a,i=t.lineHeight*e;let s=i;e>0&&o>i&&(s=(i+o)/2);const u=i+a,p=t.lineHeight*(e+1);let v=u;e+1<n.length&&p<u&&(v=(u+p)/2);const f=(v-s)/l;for(let e=0;e<c.length;e++){let n=0;n="number"==typeof d[e]?d[e]:e/c.length;let t=Math.min(1,Math.max(0,s/l+n*f));t=Number(t.toFixed(5)),r.addColorStop(t,c[e])}}}else{r=this.context.createLinearGradient(i,l/2,s+i,l/2);const e=c.length+1;let n=1;for(let t=0;t<c.length;t++){let a;a="number"==typeof d[t]?d[t]:n/e,r.addColorStop(a,c[t]),n++}}return r}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},$Q,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const n=PU(this.scale.x)||1;this.scale.x=n*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const n=PU(this.scale.y)||1;this.scale.y=n*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},this._style=e instanceof DQ?e:new DQ(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};OQ.defaultAutoResolution=!0;let FQ=OQ;class jQ{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function BQ(e,n){let t=!1;if(e?._textures?.length)for(let a=0;a<e._textures.length;a++)if(e._textures[a]instanceof _q){const r=e._textures[a].baseTexture;n.includes(r)||(n.push(r),t=!0)}return t}function XQ(e,n){if(e.baseTexture instanceof iW){const t=e.baseTexture;return n.includes(t)||n.push(t),!0}return!1}function UQ(e,n){if(e._texture&&e._texture instanceof _q){const t=e._texture.baseTexture;return n.includes(t)||n.push(t),!0}return!1}function WQ(e,n){return n instanceof FQ&&(n.updateText(!0),!0)}function qQ(e,n){if(n instanceof DQ){const e=n.toFontString();return RQ.measureFont(e),!0}return!1}function GQ(e,n){if(e instanceof FQ){n.includes(e.style)||n.push(e.style),n.includes(e)||n.push(e);const t=e._texture.baseTexture;return n.includes(t)||n.push(t),!0}return!1}function HQ(e,n){return e instanceof DQ&&(n.includes(e)||n.push(e),!0)}const VQ=class e{constructor(n){this.limiter=new jQ(e.uploadsPerFrame),this.renderer=n,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(GQ),this.registerFindHook(HQ),this.registerFindHook(BQ),this.registerFindHook(XQ),this.registerFindHook(UQ),this.registerUploadHook(WQ),this.registerUploadHook(qQ)}upload(e){return new Promise(n=>{e&&this.add(e),this.queue.length?(this.completes.push(n),this.ticking||(this.ticking=!0,LG.system.addOnce(this.tick,this,CG.UTILITY))):n()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let n=!1;if(e&&!e._destroyed)for(let t=0,a=this.uploadHooks.length;t<a;t++)if(this.uploadHooks[t](this.uploadHookHelper,e)){this.queue.shift(),n=!0;break}n||this.queue.shift()}if(this.queue.length)LG.system.addOnce(this.tick,this,CG.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let n=0,t=e.length;n<t;n++)e[n]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let n=0,t=this.addHooks.length;n<t&&!this.addHooks[n](e,this.queue);n++);if(e instanceof YG)for(let n=e.children.length-1;n>=0;n--)this.add(e.children[n]);return this}destroy(){this.ticking&&LG.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};VQ.uploadsPerFrame=4;let QQ=VQ;function KQ(e,n){return n instanceof iW&&(n._glTextures[e.CONTEXT_UID]||e.texture.bind(n),!0)}function YQ(e,n){if(!(n instanceof bQ))return!1;const{geometry:t}=n;n.finishPoly(),t.updateBatches();const{batches:a}=t;for(let n=0;n<a.length;n++){const{texture:t}=a[n].style;t&&KQ(e,t.baseTexture)}return t.batchable||e.geometry.bind(t,n._resolveDirectShader(e)),!0}function JQ(e,n){return e instanceof bQ&&(n.push(e),!0)}Object.defineProperties(wX,{UPLOADS_PER_FRAME:{get:()=>QQ.uploadsPerFrame,set(e){WX("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),QQ.uploadsPerFrame=e}}});class ZQ extends QQ{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(JQ),this.registerUploadHook(KQ),this.registerUploadHook(YQ)}}ZQ.extension={name:"prepare",type:qU.RendererSystem},VU.add(ZQ),new kW;var eK="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const nK=new EW;class tK extends sq{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Lq,this.state=JU.for2d()}contextChange(){const e=this.renderer,n={globals:e.globalUniforms};this.simpleShader=rq.from(eK,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",n),this.shader=e.context.webGLVersion>1?rq.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",n):rq.from(eK,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",n)}render(e){const n=this.renderer,t=this.quad;let a=t.vertices;a[0]=a[6]=e._width*-e.anchor.x,a[1]=a[3]=e._height*-e.anchor.y,a[2]=a[4]=e._width*(1-e.anchor.x),a[5]=a[7]=e._height*(1-e.anchor.y);const r=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;a=t.uvs,a[0]=a[6]=-r,a[1]=a[3]=-o,a[2]=a[4]=1-r,a[5]=a[7]=1-o,t.invalidate();const i=e._texture,s=i.baseTexture,l=s.alphaMode>0,c=e.tileTransform.localTransform,d=e.uvMatrix;let u=s.isPowerOfTwo&&i.frame.width===s.width&&i.frame.height===s.height;u&&(s._glTextures[n.CONTEXT_UID]?u=s.wrapMode!==pX.CLAMP:s.wrapMode===pX.CLAMP&&(s.wrapMode=pX.REPEAT));const p=u?this.simpleShader:this.shader,v=i.width,f=i.height,h=e._width,m=e._height;nK.set(c.a*v/h,c.b*v/m,c.c*f/h,c.d*f/m,c.tx/h,c.ty/m),nK.invert(),u?nK.prepend(d.mapCoord):(p.uniforms.uMapCoord=d.mapCoord.toArray(!0),p.uniforms.uClampFrame=d.uClampFrame,p.uniforms.uClampOffset=d.uClampOffset),p.uniforms.uTransform=nK.toArray(!0),p.uniforms.uColor=AU.shared.setValue(e.tint).premultiply(e.worldAlpha,l).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),p.uniforms.uSampler=i,n.shader.bind(p),n.geometry.bind(t),this.state.blendMode=LU(e.blendMode,l),n.state.set(this.state),n.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}tK.extension={name:"tilingSprite",type:qU.RendererPlugin},VU.add(tK);const aK=class e{constructor(e,n,t){this.linkedSheets=[],(e instanceof iW||e instanceof _q)&&(e={texture:e,data:n,resolutionFilename:t});const{texture:a,data:r,resolutionFilename:o=null,cachePrefix:i=""}=e;this.cachePrefix=i,this._texture=a instanceof _q?a:null,this.baseTexture=a instanceof iW?a:this._texture.baseTexture,this.textures={},this.animations={},this.data=r;const s=this.baseTexture.resource;this.resolution=this._updateResolution(o||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:n}=this.data.meta;let t=WU(e,null);return null===t&&(t="number"==typeof n?n:parseFloat(n??"1")),1!==t&&this.baseTexture.setResolution(t),t}parse(){return new Promise(n=>{this._callback=n,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(n){let t=n;const a=e.BATCH_SIZE;for(;t-n<a&&t<this._frameKeys.length;){const e=this._frameKeys[t],n=this._frames[e],a=n.frame;if(a){let t=null,r=null;const o=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,i=new _W(0,0,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution);t=n.rotated?new _W(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):new _W(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(r=new _W(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[e]=new _q(this.baseTexture,t,i,r,n.rotated?2:0,n.anchor,n.borders),_q.addToCache(this.textures[e],this.cachePrefix+e.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const n in e){this.animations[n]=[];for(let t=0;t<e[n].length;t++){const a=e[n][t];this.animations[n].push(this.textures[a])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};aK.BATCH_SIZE=1e3;let rK=aK;const oK=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function iK(e,n,t){const a={};if(e.forEach(e=>{a[e]=n}),Object.keys(n.textures).forEach(e=>{a[`${n.cachePrefix}${e}`]=n.textures[e]}),!t){const t=HX.dirname(e[0]);n.linkedSheets.forEach((e,r)=>{Object.assign(a,iK([`${t}/${n.data.meta.related_multi_packs[r]}`],e,!0))})}return a}const sK={extension:qU.Asset,cache:{test:e=>e instanceof rK,getCacheableAssets:(e,n)=>iK(e,n,!1)},resolver:{test:e=>{const n=e.split("?")[0].split("."),t=n.pop(),a=n.pop();return"json"===t&&oK.includes(a)},parse:e=>{const n=e.split(".");return{resolution:parseFloat(wX.RETINA_PREFIX.exec(e)?.[1]??"1"),format:n[n.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:qU.LoadParser,priority:MH.Normal},testParse:async(e,n)=>".json"===HX.extname(n.src).toLowerCase()&&!!e.frames,async parse(e,n,t){const{texture:a,imageFilename:r,cachePrefix:o}=n?.data??{};let i,s=HX.dirname(n.src);if(s&&s.lastIndexOf("/")!==s.length-1&&(s+="/"),a&&a.baseTexture)i=a;else{const a=xV(s+(r??e.meta.image),n.src);i=(await t.load([a]))[a]}const l=new rK({texture:i.baseTexture,data:e,resolutionFilename:n.src,cachePrefix:o});await l.parse();const c=e?.meta?.related_multi_packs;if(Array.isArray(c)){const e=[];for(const a of c){if("string"!=typeof a)continue;let r=s+a;n.data?.ignoreMultiPack||(r=xV(r,n.src),e.push(t.load({src:r,data:{ignoreMultiPack:!0}})))}const a=await Promise.all(e);l.linkedSheets=a,a.forEach(e=>{e.linkedSheets=[l].concat(l.linkedSheets.filter(n=>n!==e))})}return l},unload(e){e.destroy(!0)}}};VU.add(sK);class lK{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class cK{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){const n=e.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const e in n){const a=n[e].match(/^[a-z]+/gm)[0],r=n[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(const e in r){const n=r[e].split("="),t=n[0],a=n[1].replace(/"/gm,""),i=parseFloat(a),s=isNaN(i)?a:i;o[t]=s}t[a].push(o)}const a=new lK;return t.info.forEach(e=>a.info.push({face:e.face,size:parseInt(e.size,10)})),t.common.forEach(e=>a.common.push({lineHeight:parseInt(e.lineHeight,10)})),t.page.forEach(e=>a.page.push({id:parseInt(e.id,10),file:e.file})),t.char.forEach(e=>a.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)})),t.kerning.forEach(e=>a.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)})),t.distanceField.forEach(e=>a.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType})),a}}class dK{static test(e){const n=e;return"string"!=typeof e&&"getElementsByTagName"in e&&n.getElementsByTagName("page").length&&null!==n.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){const n=new lK,t=e.getElementsByTagName("info"),a=e.getElementsByTagName("common"),r=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),i=e.getElementsByTagName("kerning"),s=e.getElementsByTagName("distanceField");for(let e=0;e<t.length;e++)n.info.push({face:t[e].getAttribute("face"),size:parseInt(t[e].getAttribute("size"),10)});for(let e=0;e<a.length;e++)n.common.push({lineHeight:parseInt(a[e].getAttribute("lineHeight"),10)});for(let e=0;e<r.length;e++)n.page.push({id:parseInt(r[e].getAttribute("id"),10)||0,file:r[e].getAttribute("file")});for(let e=0;e<o.length;e++){const t=o[e];n.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let e=0;e<i.length;e++)n.kerning.push({first:parseInt(i[e].getAttribute("first"),10),second:parseInt(i[e].getAttribute("second"),10),amount:parseInt(i[e].getAttribute("amount"),10)});for(let e=0;e<s.length;e++)n.distanceField.push({fieldType:s[e].getAttribute("fieldType"),distanceRange:parseInt(s[e].getAttribute("distanceRange"),10)});return n}}class uK{static test(e){return!("string"!=typeof e||!e.includes("<font>"))&&dK.test(wX.ADAPTER.parseXML(e))}static parse(e){return dK.parse(wX.ADAPTER.parseXML(e))}}const pK=[cK,dK,uK];function vK(e,n,t,a,r,o,i){const s=t.text,l=t.fontProperties;n.translate(a,r),n.scale(o,o);const c=i.strokeThickness/2,d=-i.strokeThickness/2;if(n.font=i.toFontString(),n.lineWidth=i.strokeThickness,n.textBaseline=i.textBaseline,n.lineJoin=i.lineJoin,n.miterLimit=i.miterLimit,n.fillStyle=function(e,n,t,a,r,o){const i=t.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let s;const l=t.dropShadow?t.dropShadowDistance:0,c=t.padding||0,d=e.width/a-l-2*c,u=e.height/a-l-2*c,p=i.slice(),v=t.fillGradientStops.slice();if(!v.length){const e=p.length+1;for(let n=1;n<e;++n)v.push(n/e)}if(p.unshift(i[0]),v.unshift(0),p.push(i[i.length-1]),v.push(1),t.fillGradientType===EQ.LINEAR_VERTICAL){s=n.createLinearGradient(d/2,c,d/2,u+c);let e=0;const a=(o.fontProperties.fontSize+t.strokeThickness)/u;for(let n=0;n<r.length;n++){const t=o.lineHeight*n;for(let n=0;n<p.length;n++){let r=0;r="number"==typeof v[n]?v[n]:n/p.length;const o=t/u+r*a;let i=Math.max(e,o);i=Math.min(i,1),s.addColorStop(i,p[n]),e=i}}}else{s=n.createLinearGradient(c,u/2,d+c,u/2);const e=p.length+1;let t=1;for(let n=0;n<p.length;n++){let a;a="number"==typeof v[n]?v[n]:t/e,s.addColorStop(a,p[n]),t++}}return s}(e,n,i,o,[s],t),n.strokeStyle=i.stroke,i.dropShadow){const e=i.dropShadowColor,t=i.dropShadowBlur*o,a=i.dropShadowDistance*o;n.shadowColor=AU.shared.setValue(e).setAlpha(i.dropShadowAlpha).toRgbaString(),n.shadowBlur=t,n.shadowOffsetX=Math.cos(i.dropShadowAngle)*a,n.shadowOffsetY=Math.sin(i.dropShadowAngle)*a}else n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;i.stroke&&i.strokeThickness&&n.strokeText(s,c,d+t.lineHeight-l.descent),i.fill&&n.fillText(s,c,d+t.lineHeight-l.descent),n.setTransform(1,0,0,1,0,0),n.fillStyle="rgba(0, 0, 0, 0)"}function fK(e){return Array.from?Array.from(e):e.split("")}function hK(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const mK=class e{constructor(e,n,t){const[a]=e.info,[r]=e.common,[o]=e.page,[i]=e.distanceField,s=WU(o.file),l={};this._ownsTextures=t,this.font=a.face,this.size=a.size,this.lineHeight=r.lineHeight/s,this.chars={},this.pageTextures=l;for(let t=0;t<e.page.length;t++){const{id:a,file:r}=e.page[t];l[a]=n instanceof Array?n[t]:n[r],i?.fieldType&&"none"!==i.fieldType&&(l[a].baseTexture.alphaMode=fX.NO_PREMULTIPLIED_ALPHA,l[a].baseTexture.mipmap=vX.OFF)}for(let n=0;n<e.char.length;n++){const{id:t,page:a}=e.char[n];let{x:r,y:o,width:i,height:c,xoffset:d,yoffset:u,xadvance:p}=e.char[n];r/=s,o/=s,i/=s,c/=s,d/=s,u/=s,p/=s;const v=new _W(r+l[a].frame.x/s,o+l[a].frame.y/s,i,c);this.chars[t]={xOffset:d,yOffset:u,xAdvance:p,kerning:{},texture:new _q(l[a].baseTexture,v),page:a}}for(let n=0;n<e.kerning.length;n++){let{first:t,second:a,amount:r}=e.kerning[n];t/=s,a/=s,r/=s,this.chars[a]&&(this.chars[a].kerning[t]=r)}this.distanceFieldRange=i?.distanceRange,this.distanceFieldType=i?.fieldType?.toLowerCase()??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(n,t,a){let r;if(n instanceof lK)r=n;else{const e=function(e){for(let n=0;n<pK.length;n++)if(pK[n].test(e))return pK[n];return null}(n);if(!e)throw new Error("Unrecognized data format for font.");r=e.parse(n)}t instanceof _q&&(t=[t]);const o=new e(r,t,a);return e.available[o.font]=o,o}static uninstall(n){const t=e.available[n];if(!t)throw new Error(`No font found named '${n}'`);t.destroy(),delete e.available[n]}static from(n,t,a){if(!n)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:o,resolution:i,textureWidth:s,textureHeight:l,...c}=Object.assign({},e.defaultOptions,a),d=function(e){"string"==typeof e&&(e=[e]);const n=[];for(let t=0,a=e.length;t<a;t++){const a=e[t];if(Array.isArray(a)){if(2!==a.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${a.length}.`);const e=a[0].charCodeAt(0),t=a[1].charCodeAt(0);if(t<e)throw new Error("[BitmapFont]: Invalid character range.");for(let a=e,r=t;a<=r;a++)n.push(String.fromCharCode(a))}else n.push(...fK(a))}if(0===n.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return n}(r),u=t instanceof DQ?t:new DQ(t),p=s,v=new lK;v.info[0]={face:u.fontFamily,size:u.fontSize},v.common[0]={lineHeight:u.fontSize};let f,h,m,g=0,b=0,y=0;const x=[],k=[];for(let e=0;e<d.length;e++){f||(f=wX.ADAPTER.createCanvas(),f.width=s,f.height=l,h=f.getContext("2d"),m=new iW(f,{resolution:i,...c}),x.push(m),k.push(new _q(m)),v.page.push({id:k.length-1,file:""}));const n=d[e],t=RQ.measureText(n,u,!1,f),a=t.width,r=Math.ceil(t.height),w=Math.ceil(("italic"===u.fontStyle?2:1)*a);if(b>=l-r*i){if(0===b)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${n}')`);--e,f=null,h=null,m=null,b=0,g=0,y=0;continue}if(y=Math.max(r+t.fontProperties.descent,y),w*i+g>=p){if(0===g)throw new Error(`[BitmapFont] textureWidth ${s}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${n}')`);--e,b+=y*i,b=Math.ceil(b),g=0,y=0;continue}vK(f,h,t,g,b,i,u);const _=hK(t.text);v.char.push({id:_,page:k.length-1,x:g/i,y:b/i,width:w,height:r,xoffset:0,yoffset:0,xadvance:a-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),g+=(w+2*o)*i,g=Math.ceil(g)}if(!a?.skipKerning)for(let e=0,n=d.length;e<n;e++){const t=d[e];for(let e=0;e<n;e++){const n=d[e],a=h.measureText(t).width,r=h.measureText(n).width,o=h.measureText(t+n).width-(a+r);o&&v.kerning.push({first:hK(t),second:hK(n),amount:o})}}const w=new e(v,k,!0);return void 0!==e.available[n]&&e.uninstall(n),e.available[n]=w,w}};mK.ALPHA=[["a","z"],["A","Z"]," "],mK.NUMERIC=[["0","9"]],mK.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],mK.ASCII=[[" ","~"]],mK.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:mK.ALPHANUMERIC},mK.available={};let gK=mK;const bK=[],yK=[],xK=[];(class e extends YG{constructor(n,t={}){super();const{align:a,tint:r,maxWidth:o,letterSpacing:i,fontName:s,fontSize:l}=Object.assign({},e.styleDefaults,t);if(!gK.available[s])throw new Error(`Missing BitmapFont "${s}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=a,this._tintColor=new AU(r),this._font=void 0,this._fontName=s,this._fontSize=l,this.text=n,this._maxWidth=o,this._maxLineHeight=0,this._letterSpacing=i,this._anchor=new $W(()=>{this.dirty=!0},this,0,0),this._roundPixels=wX.ROUND_PIXELS,this.dirty=!0,this._resolution=wX.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=gK.available[this._fontName],n=this.fontSize,t=n/e.size,a=new kW,r=[],o=[],i=[],s=fK(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/n,c="none"===e.distanceFieldType?bK:yK;let d=null,u=0,p=0,v=0,f=-1,h=0,m=0,g=0,b=0;for(let n=0;n<s.length;n++){const t=s[n],c=hK(t);if(/(?:\s)/.test(t)&&(f=n,h=u,b++),"\r"===t||"\n"===t){o.push(u),i.push(-1),p=Math.max(p,u),++v,++m,a.x=0,a.y+=e.lineHeight,d=null,b=0;continue}const y=e.chars[c];if(!y)continue;d&&y.kerning[d]&&(a.x+=y.kerning[d]);const x=xK.pop()||{texture:_q.EMPTY,line:0,charCode:0,prevSpaces:0,position:new kW};x.texture=y.texture,x.line=v,x.charCode=c,x.position.x=Math.round(a.x+y.xOffset+this._letterSpacing/2),x.position.y=Math.round(a.y+y.yOffset),x.prevSpaces=b,r.push(x),u=x.position.x+Math.max(y.xAdvance-y.xOffset,y.texture.orig.width),a.x+=y.xAdvance+this._letterSpacing,g=Math.max(g,y.yOffset+y.texture.height),d=c,-1!==f&&l>0&&a.x>l&&(++m,MU(r,1+f-m,1+n-f),n=f,f=-1,o.push(h),i.push(r.length>0?r[r.length-1].prevSpaces:0),p=Math.max(p,h),v++,a.x=0,a.y+=e.lineHeight,d=null,b=0)}const y=s[s.length-1];"\r"!==y&&"\n"!==y&&(/(?:\s)/.test(y)&&(u=h),o.push(u),p=Math.max(p,u),i.push(-1));const x=[];for(let e=0;e<=v;e++){let n=0;"right"===this._align?n=p-o[e]:"center"===this._align?n=(p-o[e])/2:"justify"===this._align&&(n=i[e]<0?0:(p-o[e])/i[e]),x.push(n)}const k=r.length,w={},_=[],C=this._activePagesMeshData;c.push(...C);for(let n=0;n<k;n++){const t=r[n].texture,a=t.baseTexture.uid;if(!w[a]){let n=c.pop();if(!n){const t=new CQ;let a,r;"none"===e.distanceFieldType?(a=new AQ(_q.EMPTY),r=oX.NORMAL):(a=new AQ(_q.EMPTY,{program:nq.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),r=oX.NORMAL_NPM);const o=new _Q(t,a);o.blendMode=r,n={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}n.index=0,n.indexCount=0,n.vertexCount=0,n.uvsCount=0,n.total=0;const{_textureCache:r}=this;r[a]=r[a]||new _q(t.baseTexture),n.mesh.texture=r[a],n.mesh.tint=this._tintColor.value,_.push(n),w[a]=n}w[a].total++}for(let e=0;e<C.length;e++)_.includes(C[e])||this.removeChild(C[e].mesh);for(let e=0;e<_.length;e++)_[e].mesh.parent!==this&&this.addChild(_[e].mesh);this._activePagesMeshData=_;for(const e in w){const n=w[e],t=n.total;if(!(n.indices?.length>6*t)||n.vertices.length<2*_Q.BATCHABLE_SIZE)n.vertices=new Float32Array(8*t),n.uvs=new Float32Array(8*t),n.indices=new Uint16Array(6*t);else{const e=n.total,t=n.vertices;for(let n=4*e*2;n<t.length;n++)t[n]=0}n.mesh.size=6*t}for(let e=0;e<k;e++){const n=r[e];let a=n.position.x+x[n.line]*("justify"===this._align?n.prevSpaces:1);this._roundPixels&&(a=Math.round(a));const o=a*t,i=n.position.y*t,s=n.texture,l=w[s.baseTexture.uid],c=s.frame,d=s._uvs,u=l.index++;l.indices[6*u+0]=0+4*u,l.indices[6*u+1]=1+4*u,l.indices[6*u+2]=2+4*u,l.indices[6*u+3]=0+4*u,l.indices[6*u+4]=2+4*u,l.indices[6*u+5]=3+4*u,l.vertices[8*u+0]=o,l.vertices[8*u+1]=i,l.vertices[8*u+2]=o+c.width*t,l.vertices[8*u+3]=i,l.vertices[8*u+4]=o+c.width*t,l.vertices[8*u+5]=i+c.height*t,l.vertices[8*u+6]=o,l.vertices[8*u+7]=i+c.height*t,l.uvs[8*u+0]=d.x0,l.uvs[8*u+1]=d.y0,l.uvs[8*u+2]=d.x1,l.uvs[8*u+3]=d.y1,l.uvs[8*u+4]=d.x2,l.uvs[8*u+5]=d.y2,l.uvs[8*u+6]=d.x3,l.uvs[8*u+7]=d.y3}this._textWidth=p*t,this._textHeight=(a.y+e.lineHeight)*t;for(const e in w){const n=w[e];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const t=this._textWidth*this.anchor.x,a=this._textHeight*this.anchor.y;for(let r=0;r<n.total;r++)n.vertices[e++]-=t,n.vertices[e++]-=a,n.vertices[e++]-=t,n.vertices[e++]-=a,n.vertices[e++]-=t,n.vertices[e++]-=a,n.vertices[e++]-=t,n.vertices[e++]-=a}this._maxLineHeight=g*t;const a=n.mesh.geometry.getBuffer("aVertexPosition"),r=n.mesh.geometry.getBuffer("aTextureCoord"),o=n.mesh.geometry.getIndex();a.data=n.vertices,r.data=n.uvs,o.data=n.indices,a.update(),r.update(),o.update()}for(let e=0;e<r.length;e++)xK.push(r[e]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:n,distanceFieldType:t,size:a}=gK.available[this._fontName];if("none"!==t){const{a:t,b:r,c:o,d:i}=this.worldTransform,s=Math.sqrt(t*t+r*r),l=Math.sqrt(o*o+i*i),c=(Math.abs(s)+Math.abs(l))/2,d=this.fontSize/a,u=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=c*n*d*u}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=gK.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let n=0;n<this._activePagesMeshData.length;n++)this._activePagesMeshData[n].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!gK.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??gK.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:n}=this,t="none"===gK.available[this._fontName].distanceFieldType?bK:yK;t.push(...this._activePagesMeshData);for(const e of this._activePagesMeshData)this.removeChild(e.mesh);this._activePagesMeshData=[],t.filter(e=>n[e.mesh.texture.baseTexture.uid]).forEach(e=>{e.mesh.texture=_q.EMPTY});for(const e in n)n[e].destroy(),delete n[e];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}}).styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const kK=[".xml",".fnt"],wK={extension:{type:qU.LoadParser,priority:MH.Normal},name:"loadBitmapFont",test:e=>kK.includes(HX.extname(e).toLowerCase()),testParse:async e=>cK.test(e)||uK.test(e),async parse(e,n,t){const a=cK.test(e)?cK.parse(e):uK.parse(e),{src:r}=n,{page:o}=a,i=[];for(let e=0;e<o.length;++e){const n=o[e].file;let t=HX.join(HX.dirname(r),n);t=xV(t,r),i.push(t)}const s=await t.load(i),l=i.map(e=>s[e]);return gK.install(a,l,!0)},load:async(e,n)=>(await wX.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};VU.add(wK);const _K=class e extends DQ{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(n){return new e(Object.keys(e.defaultOptions).reduce((e,t)=>({...e,[t]:n[t]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(n=>{URL.revokeObjectURL(n.src),n.refs--,0===n.refs&&(n.fontFace&&document.fonts.delete(n.fontFace),delete e.availableFonts[n.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(n,t={}){const{availableFonts:a}=e;if(a[n]){const e=a[n];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return wX.ADAPTER.fetch(n).then(e=>e.blob()).then(async e=>new Promise((n,t)=>{const a=URL.createObjectURL(e),r=new FileReader;r.onload=()=>n([a,r.result]),r.onerror=t,r.readAsDataURL(e)})).then(async([e,r])=>{const o=Object.assign({family:HX.basename(n,HX.extname(n)),weight:"normal",style:"normal",display:"auto",src:e,dataSrc:r,refs:1,originalUrl:n,fontFace:null},t);a[n]=o,this._fonts.push(o),this.styleID++;const i=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=i,await i.load(),document.fonts.add(i),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const n=e.filter(e=>!this._overrides.includes(e));n.length>0&&(this._overrides.push(...n),this.styleID++)}removeOverride(...e){const n=e.filter(e=>this._overrides.includes(e));n.length>0&&(this._overrides=this._overrides.filter(e=>!n.includes(e)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,n)=>`${e}\n            @font-face {\n                font-family: "${n.family}";\n                src: url('${n.dataSrc}');\n                font-weight: ${n.weight};\n                font-style: ${n.style};\n                font-display: ${n.display};\n            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(t=e,WX("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),e=AU.shared.setValue(t).toNumber()),"number"==typeof e?(n=e,WX("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),AU.shared.setValue(n).toHex()):e;var n,t}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const n=this.dropShadowAlpha,t=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),a=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&n<1&&(e+=(255*n|0).toString(16).padStart(2,"0"));const r=`${t}px ${a}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,e.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=wX.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};_K.availableFonts={},_K.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let CK=_K;const AK=class e extends eH{constructor(n="",t={}){super(_q.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const a=new Image,r=_q.from(a,{scaleMode:wX.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new _W,r.trim=new _W,this.texture=r;const o="http://www.w3.org/2000/svg",i="http://www.w3.org/1999/xhtml",s=document.createElementNS(o,"svg"),l=document.createElementNS(o,"foreignObject"),c=document.createElementNS(i,"div"),d=document.createElementNS(i,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",s.appendChild(l),this.maxWidth=e.defaultMaxWidth,this.maxHeight=e.defaultMaxHeight,this._domElement=c,this._styleElement=d,this._svgRoot=s,this._foreignObject=l,this._foreignObject.appendChild(d),this._foreignObject.appendChild(c),this._image=a,this._loadImage=new Image,this._autoResolution=e.defaultAutoResolution,this._resolution=e.defaultResolution??wX.RESOLUTION,this.text=n,this.style=t}measureText(e){const{text:n,style:t,resolution:a}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:n,style:t.toCSS(a)}),this._styleElement.textContent=t.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:i}=r;(o>this.maxWidth||i>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const s=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(i));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",l.toString()),n!==this._text&&(this._domElement.innerHTML=this._text),t!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(a)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*t.padding,height:l+2*t.padding}}async updateText(e=!0){const{style:n,_image:t,_loadImage:a}=this;if(this.localStyleID!==n.styleID&&(this.dirty=!0,this.localStyleID=n.styleID),!this.dirty&&e)return;const{width:r,height:o}=this.measureText();t.width=a.width=Math.ceil(Math.max(1,r)),t.height=a.height=Math.ceil(Math.max(1,o)),this._updateID++;const i=this._updateID;await new Promise(e=>{a.onload=async()=>{i<this._updateID||(await n.onBeforeDraw(),t.src=a.src,a.onload=null,a.src="",this.updateTexture()),e()};const r=(new XMLSerializer).serializeToString(this._svgRoot);a.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:n,_image:t,resolution:a}=this,{padding:r}=e,{baseTexture:o}=n;n.trim.width=n._frame.width=t.width/a,n.trim.height=n._frame.height=t.height/a,n.trim.x=-r,n.trim.y=-r,n.orig.width=n._frame.width-2*r,n.orig.height=n._frame.height-2*r,this._onTextureUpdate(),o.setRealSize(t.width,t.height,a),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(n){"boolean"==typeof n&&(n={children:n}),n=Object.assign({},e.defaultDestroyOptions,n),super.destroy(n);const t=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=t,this._svgRoot?.remove(),this._svgRoot=t,this._domElement?.remove(),this._domElement=t,this._foreignObject?.remove(),this._foreignObject=t,this._styleElement?.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const n=PU(this.scale.x)||1;this.scale.x=n*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const n=PU(this.scale.y)||1;this.scale.y=n*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof CK?(this.ownsStyle=!1,this._style=e):e instanceof DQ?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=CK.from(e)):(this.ownsStyle=!0,this._style=new CK(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(""===e||null==e?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};AK.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},AK.defaultMaxWidth=2024,AK.defaultMaxHeight=2024,AK.defaultAutoResolution=!0;class SK{app;worldContainer;layers;config;locationSprites=new Map;eventCallbacks=new Map;continentBounds=new Map;isDragging=!1;dragStart={x:0,y:0};lastPosition={x:0,y:0};dragDistance=0;isPinching=!1;initialPinchDistance=0;initialPinchScale=1;pinchCenter={x:0,y:0};boundOnDragStart;boundOnDragMove;boundOnDragEnd;boundOnTouchStart;boundOnTouchMove;boundOnTouchEnd;boundOnWheel;constructor(e,n){this.config=n,this.boundOnDragStart=this.onDragStart.bind(this),this.boundOnDragMove=this.onDragMove.bind(this),this.boundOnDragEnd=this.onDragEnd.bind(this),this.boundOnTouchStart=this.onTouchStart.bind(this),this.boundOnTouchMove=this.onTouchMove.bind(this),this.boundOnTouchEnd=this.onTouchEnd.bind(this),this.boundOnWheel=this.onWheel.bind(this);const t=e.getBoundingClientRect(),a=t.width||e.clientWidth||800,r=t.height||e.clientHeight||600;try{this.app=new _H({view:e,width:a,height:r,backgroundColor:16317180,antialias:!0,resolution:Math.min(window.devicePixelRatio||1,2),autoDensity:!0,eventMode:"none",powerPreference:"high-performance"})}catch(n){console.error("[地图管理器] Pixi初始化失败，尝试降级方案:",n),this.app=new _H({view:e,width:a,height:r,backgroundColor:16317180,antialias:!1,resolution:1,autoDensity:!0,eventMode:"none",powerPreference:"low-power"})}this.app.renderer.events&&this.app.renderer.events.destroy(),console.log("[地图管理器] Pixi应用初始化完成"),this.worldContainer=new YG,this.worldContainer.sortableChildren=!0,this.worldContainer.eventMode="none",this.worldContainer.interactiveChildren=!1,this.app.stage.addChild(this.worldContainer),this.layers=new Map,this.initLayers(),this.drawBackground(),this.setupDragInteraction(),this.setZoom(.5,!1),this.centerTo(n.width/2,n.height/2,!1),console.log("[地图管理器] 初始化完成",{worldSize:`${n.width}x${n.height}`,screenSize:`${a}x${r}`,initialZoom:.5,initialCenter:{x:n.width/2,y:n.height/2}})}setupDragInteraction(){const e=this.app.view;e.addEventListener("mousedown",this.boundOnDragStart),e.addEventListener("mousemove",this.boundOnDragMove),e.addEventListener("mouseup",this.boundOnDragEnd),e.addEventListener("mouseleave",this.boundOnDragEnd),e.addEventListener("touchstart",this.boundOnTouchStart,{passive:!1}),e.addEventListener("touchmove",this.boundOnTouchMove,{passive:!1}),e.addEventListener("touchend",this.boundOnTouchEnd),e.addEventListener("wheel",this.boundOnWheel,{passive:!1})}onDragStart(e){this.isDragging=!0,this.dragStart={x:e.clientX,y:e.clientY},this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y},this.dragDistance=0,this.app.view.style.cursor="grabbing",this.clickStartPos={x:e.clientX,y:e.clientY},this.clickStartTime=Date.now()}clickStartPos={x:0,y:0};clickStartTime=0;onDragMove(e){if(!this.isDragging)return;const n=e.clientX-this.dragStart.x,t=e.clientY-this.dragStart.y;this.dragDistance+=Math.abs(n-(this.worldContainer.x-this.lastPosition.x))+Math.abs(t-(this.worldContainer.y-this.lastPosition.y)),this.worldContainer.x=this.lastPosition.x+n,this.worldContainer.y=this.lastPosition.y+t}onDragEnd(e){if(e&&this.isDragging){const n=Date.now()-this.clickStartTime;console.log("[地图管理器] 拖拽结束:",{dragDistance:this.dragDistance,time:n}),this.dragDistance<10&&n<500?(console.log("[地图管理器] 判定为点击事件"),this.handleClick(e)):console.log("[地图管理器] 判定为拖拽事件，不触发点击")}this.isDragging=!1,this.dragDistance=0,this.app.view.style.cursor="grab"}handleClick(e){const n=this.app.view.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top,r=this.worldContainer.scale.x,o=(t-this.worldContainer.x)/r,i=(a-this.worldContainer.y)/r,s=this.layers.get(4);if(s){let e=null,n=1/0;if(s.children.forEach(t=>{if(!(t instanceof YG))return;const a=t.userData;if(!a)return;const r=Math.sqrt(Math.pow(o-t.x,2)+Math.pow(i-t.y,2));r<n&&(n=r,e=a)}),e&&n<50)return console.log(`[地图] 点击地点: ${e.data.name}，距离: ${n.toFixed(0)}`),void this.emit("locationClick",{...e.data,clickPosition:{x:t,y:a}})}const l=this.layers.get(3);if(l)for(const e of l.children)if(e instanceof bQ){const n=e.userData;if(n&&"location"===n.type){const r=e.territoryBounds;if(r&&this.isPointInPolygon(o,i,r))return console.log(`[地图] 点击势力范围: ${n.data.name}`),void this.emit("locationClick",{...n.data,clickPosition:{x:t,y:a}})}}console.log(`[地图] 检测大陆点击，世界坐标: (${o.toFixed(0)}, ${i.toFixed(0)})，共有${this.continentBounds.size}个大陆`);const c=[];if(this.continentBounds.forEach((e,n)=>{const t=this.isPointInPolygon(o,i,e.bounds);if(console.log(`[地图] 检测大陆 "${e.data.name}":`,{isInside:t,bounds:e.bounds,boundsCount:e.bounds.length}),t){const t=this.calculatePolygonArea(e.bounds);c.push({id:n,data:e.data,area:t})}}),c.length>0){c.sort((e,n)=>e.area-n.area);const e=c[0];return console.log(`[地图] 点击大陆: ${e.data.name}（共匹配${c.length}个大陆，选择最小的）`),void this.emit("continentClick",{...e.data,clickPosition:{x:t,y:a}})}console.log("[地图] 点击空白区域")}emitClickEvent(e){"location"===e.type?this.emit("locationClick",e.data):"continent"===e.type&&this.emit("continentClick",e.data)}getTouchDistance(e){const n=e[0].clientX-e[1].clientX,t=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+t*t)}getTouchCenter(e){return{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}onTouchStart(e){if(e.preventDefault(),2===e.touches.length)this.isDragging=!1,this.isPinching=!0,this.initialPinchDistance=this.getTouchDistance(e.touches),this.initialPinchScale=this.worldContainer.scale.x,this.pinchCenter=this.getTouchCenter(e.touches),this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y};else if(1===e.touches.length){this.isPinching=!1;const n=e.touches[0];this.isDragging=!0,this.dragStart={x:n.clientX,y:n.clientY},this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y},this.dragDistance=0}}onTouchMove(e){if(e.preventDefault(),2===e.touches.length&&this.isPinching){const n=this.getTouchDistance(e.touches),t=this.getTouchCenter(e.touches),a=n/this.initialPinchDistance*this.initialPinchScale,r=this.config.minZoom||.1,o=this.config.maxZoom||4,i=Math.max(r,Math.min(o,a)),s=(this.pinchCenter.x-this.lastPosition.x)/this.initialPinchScale,l=(this.pinchCenter.y-this.lastPosition.y)/this.initialPinchScale;this.worldContainer.scale.set(i);const c=t.x-this.pinchCenter.x,d=t.y-this.pinchCenter.y;this.worldContainer.x=this.pinchCenter.x-s*i+c,this.worldContainer.y=this.pinchCenter.y-l*i+d}else if(1===e.touches.length&&this.isDragging&&!this.isPinching){const n=e.touches[0],t=n.clientX-this.dragStart.x,a=n.clientY-this.dragStart.y;this.dragDistance+=Math.abs(t-(this.worldContainer.x-this.lastPosition.x))+Math.abs(a-(this.worldContainer.y-this.lastPosition.y)),this.worldContainer.x=this.lastPosition.x+t,this.worldContainer.y=this.lastPosition.y+a}}onTouchEnd(e){if(1===e.touches.length&&this.isPinching){this.isPinching=!1,this.isDragging=!0;const n=e.touches[0];this.dragStart={x:n.clientX,y:n.clientY},this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y},this.dragDistance=0}else 0===e.touches.length&&(this.isDragging=!1,this.isPinching=!1)}onWheel(e){e.preventDefault();const n=e.deltaY>0?.9:1.1,t=this.worldContainer.scale.x*n,a=this.config.minZoom||.1,r=this.config.maxZoom||4,o=Math.max(a,Math.min(r,t)),i=e.clientX,s=e.clientY,l=(i-this.worldContainer.x)/this.worldContainer.scale.x,c=(s-this.worldContainer.y)/this.worldContainer.scale.y;this.worldContainer.scale.set(o),this.worldContainer.x=i-l*o,this.worldContainer.y=s-c*o}initLayers(){[0,1,2,3,4,5,6].forEach(e=>{const n=new YG;n.sortableChildren=!0,this.layers.set(e,n),this.worldContainer.addChild(n)}),console.log("[地图管理器] 图层初始化完成，共",this.layers.size,"个图层")}drawBackground(){const e=this.layers.get(0);if(!e)return;const n=new bQ;n.beginFill(16317180),n.drawRect(0,0,this.config.width,this.config.height),n.endFill(),e.addChild(n);const t=new bQ,a=this.config.tileSize;t.lineStyle(.5,13358561,.3);for(let e=0;e<=this.config.width;e+=a)t.moveTo(e,0),t.lineTo(e,this.config.height);for(let e=0;e<=this.config.height;e+=a)t.moveTo(0,e),t.lineTo(this.config.width,e);e.addChild(t)}addContinent(e){const n=this.layers.get(2);if(!n)return;const t=e.continent_bounds||e.大洲边界;if(!t||t.length<3)return;const a=new bQ;a.beginFill(3900150,.12),a.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)a.lineTo(t[e].x,t[e].y);a.closePath(),a.endFill(),a.lineStyle(2.5,2450411,.75),a.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)a.lineTo(t[e].x,t[e].y);a.closePath(),a.eventMode="none";const r={id:e.id,name:e.name||e.名称,description:e.description||e.描述,特点:e.特点,主要势力:e.主要势力};a.userData={type:"continent",data:r};const o=e.id||`continent_${Date.now()}_${Math.random()}`;this.continentBounds.set(o,{bounds:t,data:r}),n.addChild(a);const i=this.calculatePolygonCenter(t),s=new FQ(e.name||e.名称||"未知大陆",{fontFamily:"Microsoft YaHei, SimHei, sans-serif",fontSize:280,fill:1982639,fontWeight:"bold",align:"center",stroke:"#ffffff",strokeThickness:8});s.anchor.set(.5),s.x=i.x,s.y=i.y,s.alpha=.2,s.eventMode="none",n.addChild(s),console.log("[地图管理器] 添加大陆:",e.name||e.名称,"| ID:",o,"| 边界点数:",t.length,"| 当前存储的大陆数:",this.continentBounds.size)}addLocation(e){const n=this.layers.get(4);if(!n)return;const t=(e,n,t)=>Math.max(n,Math.min(t,e)),a=(e,n,t)=>{const a=t*t;for(const t of this.locationSprites.values()){const r=e-t.x,o=n-t.y;if(r*r+o*o<a)return!0}return!1},r=String(e.等级||e.level||"").toLowerCase();let o=2.5;r.includes("超")?o=3.5:r.includes("一")?o=3.2:r.includes("二")?o=2.8:r.includes("三")&&(o=2.5);const i=44*o,s=((e,n,r)=>{const o=this.config.width,i=this.config.height,s=t(Number(e.x)||0,0,o),l=t(Number(e.y)||0,0,i);if(!a(s,l,n))return{x:s,y:l};let c=2166136261;for(let e=0;e<r.length;e++)c^=r.charCodeAt(e),c=Math.imul(c,16777619);c>>>=0;const d=Math.PI*(3-Math.sqrt(5)),u=c%360*Math.PI/180;for(let e=1;e<=80;e++){const r=n*Math.sqrt(e),c=u+d*e,p=t(s+Math.cos(c)*r,0,o),v=t(l+Math.sin(c)*r,0,i);if(!a(p,v,n))return{x:p,y:v}}return{x:s,y:l}})(e.coordinates||{x:0,y:0},i,`${e.id}|${e.name}`);e.coordinates=s;const l=new YG;l.x=e.coordinates?.x||0,l.y=e.coordinates?.y||0,l.eventMode="none";const c=this.createLocationIcon(e.type,e.iconColor||"#6B7280");c.scale.set(o),l.addChild(c);const d=new FQ(e.name,{fontFamily:"Microsoft YaHei, SimHei, sans-serif",fontSize:38*o,fill:e.iconColor||"#6B7280",fontWeight:"700",align:"center",stroke:"#ffffff",strokeThickness:5});d.anchor.set(.5,0),d.y=32*o,d.eventMode="none",l.addChild(d),l.userData={type:"location",data:{id:e.id,name:e.name,coordinates:e.coordinates||{x:0,y:0},location:e}},n.addChild(l),this.locationSprites.set(e.id,l),console.log("[地图管理器] 添加地点:",e.name,`(${e.coordinates?.x}, ${e.coordinates?.y})`)}createLocationIcon(e,n){const t=new bQ,a=parseInt(n.replace("#",""),16);switch(t.alpha=.95,e){case"自然地标":case"natural_landmark":case"名山大川":t.beginFill(a,.9),t.moveTo(0,-24),t.lineTo(-16,16),t.lineTo(16,16),t.closePath(),t.endFill(),t.lineStyle(2,16777215,.8),t.moveTo(0,-24),t.lineTo(-16,16),t.lineTo(16,16),t.closePath();break;case"sect_power":t.beginFill(a,.9),t.drawRect(-16,-16,32,32),t.endFill(),t.lineStyle(2,16777215,.8),t.drawRect(-16,-16,32,32),t.beginFill(16777215,.9),t.drawRect(-6,0,12,16),t.endFill();break;case"聚居地":case"city_town":case"城镇坊市":t.beginFill(a,.9),t.drawCircle(0,0,20),t.endFill(),t.lineStyle(2,16777215,.8),t.drawCircle(0,0,20),t.beginFill(16777215,.9),t.drawCircle(0,0,8),t.endFill();break;case"遗迹设施":case"blessed_land":case"洞天福地":t.beginFill(a,.85),t.drawCircle(0,0,20),t.endFill(),t.lineStyle(2,16777215,.9),t.drawCircle(0,0,20),t.lineStyle(3,16777215,.95),t.moveTo(0,-12),t.lineTo(0,12),t.moveTo(-12,0),t.lineTo(12,0);break;case"资源点":case"treasure_land":case"奇珍异地":t.beginFill(a,.9),t.moveTo(0,-20),t.lineTo(16,0),t.lineTo(0,20),t.lineTo(-16,0),t.closePath(),t.endFill(),t.lineStyle(2,16777215,.8),t.moveTo(0,-20),t.lineTo(16,0),t.lineTo(0,20),t.lineTo(-16,0),t.closePath();break;case"危险区域":case"dangerous_area":case"凶险之地":t.beginFill(a,.9),t.drawCircle(0,0,20),t.endFill(),t.lineStyle(3,16777215,.9),t.drawCircle(0,0,20),t.moveTo(0,-12),t.lineTo(0,4),t.beginFill(16777215),t.drawCircle(0,10,3),t.endFill();break;case"其他特殊":case"special_other":case"其他特殊":t.beginFill(a,.9),t.moveTo(4,-20),t.lineTo(-12,4),t.lineTo(0,4),t.lineTo(-4,20),t.lineTo(12,-4),t.lineTo(0,-4),t.closePath(),t.endFill(),t.lineStyle(2,16777215,.8),t.moveTo(4,-20),t.lineTo(-12,4),t.lineTo(0,4),t.lineTo(-4,20),t.lineTo(12,-4),t.lineTo(0,-4),t.closePath();break;default:t.beginFill(a,.9),t.drawCircle(0,0,16),t.endFill(),t.lineStyle(2,16777215,.8),t.drawCircle(0,0,16)}return t}addTerritory(e){if(!e.territoryBounds||e.territoryBounds.length<3)return;const n=this.layers.get(3);if(!n)return;const t=e.territoryBounds,a=new bQ,r=parseInt((e.color||"#6B7280").replace("#",""),16);a.beginFill(r,.15),a.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)a.lineTo(t[e].x,t[e].y);a.closePath(),a.endFill(),a.lineStyle(2,r,.6),a.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)a.lineTo(t[e].x,t[e].y);a.closePath(),a.eventMode="none",a.userData={type:"location",data:{id:e.id,name:e.name,coordinates:e.coordinates||{x:0,y:0},location:e}},a.territoryBounds=t,n.addChild(a);const o=this.calculatePolygonCenter(t),i=new FQ(e.name,{fontFamily:"Microsoft YaHei, SimHei, sans-serif",fontSize:100,fill:e.iconColor||"#6B7280",fontWeight:"bold",align:"center",stroke:"#ffffff",strokeThickness:6});i.anchor.set(.5),i.x=o.x,i.y=o.y,i.alpha=.18,i.eventMode="none",n.addChild(i),console.log("[地图管理器] 添加势力范围:",e.name)}clearPlayerMarker(){const e=this.layers.get(5);e&&e.removeChildren()}updateNPCPositions(e){const n=this.layers.get(5);n&&([...n.children].forEach(e=>{const t=e.userData;if(t&&"npc"===t.type){n.removeChild(e);try{e.destroy({children:!0,texture:!1,baseTexture:!1})}catch{}}}),e.forEach(e=>{if(!Number.isFinite(e.coordinates?.x)||!Number.isFinite(e.coordinates?.y))return;const t=new YG;t.x=e.coordinates.x,t.y=e.coordinates.y,t.userData={type:"npc",name:e.name};const a=new bQ;a.beginFill(9133302,.25),a.drawCircle(0,0,35),a.endFill(),t.addChild(a);const r=new bQ;r.beginFill(9133302,.9),r.drawCircle(0,0,22),r.endFill(),r.lineStyle(3,16777215,.9),r.drawCircle(0,0,22),r.lineStyle(0),r.beginFill(16777215,.95),r.drawCircle(0,-6,6),r.endFill(),r.beginFill(16777215,.95),r.moveTo(-8,4),r.lineTo(8,4),r.lineTo(8,14),r.lineTo(-8,14),r.closePath(),r.endFill(),t.addChild(r);const o=new FQ(e.name,{fontFamily:"Microsoft YaHei, sans-serif",fontSize:40,fill:9133302,fontWeight:"600",align:"center",stroke:"#ffffff",strokeThickness:5});o.anchor.set(.5,0),o.y=32,t.addChild(o),n.addChild(t)}),console.log(`[地图管理器] 更新NPC位置: 共${e.length}个NPC`))}updatePlayerPosition(e,n="玩家"){const t=this.layers.get(5);if(!t)return;if(!Number.isFinite(e.x)||!Number.isFinite(e.y))return void this.clearPlayerMarker();t.removeChildren();const a=new YG;a.x=e.x,a.y=e.y;const r=new bQ;r.beginFill(15680580,.3),r.drawCircle(0,0,45),r.endFill(),a.addChild(r);const o=new bQ;o.beginFill(16498468,.5),o.drawCircle(0,0,28),o.endFill(),a.addChild(o);const i=new bQ;i.beginFill(14427686),i.moveTo(0,-30),i.lineTo(-20,20),i.lineTo(20,20),i.closePath(),i.endFill(),i.lineStyle(4,16708338,.95),i.moveTo(0,-30),i.lineTo(-20,20),i.lineTo(20,20),i.closePath(),i.beginFill(16708338),i.drawCircle(0,0,8),i.endFill(),i.beginFill(14427686),i.drawCircle(0,0,4),i.endFill(),a.addChild(i);const s=new FQ(n,{fontFamily:"Microsoft YaHei, sans-serif",fontSize:48,fill:14427686,fontWeight:"700",align:"center",stroke:"#ffffff",strokeThickness:6});s.anchor.set(.5,0),s.y=40,a.addChild(s),t.addChild(a),console.log("[地图管理器] 更新玩家位置:",e)}updateOtherPlayerPosition(e,n="玩家"){const t=this.layers.get(4);if(!t)return;const a=t.children.find(e=>"otherPlayer"===e.name);if(a&&t.removeChild(a),!e||!Number.isFinite(e.x)||!Number.isFinite(e.y))return;const r=new YG;r.name="otherPlayer",r.x=e.x,r.y=e.y;const o=new bQ;o.beginFill(3900150,.3),o.drawCircle(0,0,45),o.endFill(),r.addChild(o);const i=new bQ;i.beginFill(6333946,.5),i.drawCircle(0,0,28),i.endFill(),r.addChild(i);const s=new bQ;s.beginFill(2450411),s.moveTo(0,-25),s.lineTo(18,0),s.lineTo(0,25),s.lineTo(-18,0),s.closePath(),s.endFill(),s.lineStyle(3,16777215,.95),s.moveTo(0,-25),s.lineTo(18,0),s.lineTo(0,25),s.lineTo(-18,0),s.closePath(),s.beginFill(16777215),s.drawCircle(0,0,6),s.endFill(),s.beginFill(2450411),s.drawCircle(0,0,3),s.endFill(),r.addChild(s);const l=new FQ(`${n}玩家`,{fontFamily:"Microsoft YaHei, sans-serif",fontSize:40,fill:2450411,fontWeight:"700",align:"center",stroke:"#ffffff",strokeThickness:5});l.anchor.set(.5,0),l.y=35,r.addChild(l),t.addChild(r),console.log("[地图管理器] 更新其他玩家位置:",e,n)}centerTo(e,n,t=!0){const a=this.app.screen.width/2-e*this.worldContainer.scale.x,r=this.app.screen.height/2-n*this.worldContainer.scale.y;if(t){const e=this.worldContainer.x,n=this.worldContainer.y,t=500,o=Date.now(),i=()=>{const s=Date.now()-o,l=Math.min(s/t,1),c=l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2;this.worldContainer.x=e+(a-e)*c,this.worldContainer.y=n+(r-n)*c,l<1&&requestAnimationFrame(i)};requestAnimationFrame(i)}else this.worldContainer.x=a,this.worldContainer.y=r}getViewportState(){return{x:(this.app.screen.width/2-this.worldContainer.x)/this.worldContainer.scale.x,y:(this.app.screen.height/2-this.worldContainer.y)/this.worldContainer.scale.y,scale:this.worldContainer.scale.x,screenWidth:this.app.screen.width,screenHeight:this.app.screen.height}}setZoom(e,n=!0){const t=this.config.minZoom||.1,a=this.config.maxZoom||4,r=Math.max(t,Math.min(a,e)),o=(this.app.screen.width/2-this.worldContainer.x)/this.worldContainer.scale.x,i=(this.app.screen.height/2-this.worldContainer.y)/this.worldContainer.scale.y;if(n){const e=this.worldContainer.scale.x,n=300,t=Date.now(),a=()=>{const s=Date.now()-t,l=Math.min(s/n,1),c=l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2,d=e+(r-e)*c;this.worldContainer.scale.set(d),this.worldContainer.x=this.app.screen.width/2-o*d,this.worldContainer.y=this.app.screen.height/2-i*d,l<1&&requestAnimationFrame(a)};requestAnimationFrame(a)}else this.worldContainer.scale.set(r),this.worldContainer.x=this.app.screen.width/2-o*r,this.worldContainer.y=this.app.screen.height/2-i*r}calculatePolygonCenter(e){if(0===e.length)return{x:0,y:0};const n=e.reduce((e,n)=>e+n.x,0),t=e.reduce((e,n)=>e+n.y,0);return{x:n/e.length,y:t/e.length}}isPointInPolygon(e,n,t){let a=!1;for(let r=0,o=t.length-1;r<t.length;o=r++){const i=t[r].x,s=t[r].y,l=t[o].x,c=t[o].y;s>n!=c>n&&e<(l-i)*(n-s)/(c-s)+i&&(a=!a)}return a}calculatePolygonArea(e){let n=0;for(let t=0;t<e.length;t++){const a=(t+1)%e.length;n+=e[t].x*e[a].y,n-=e[a].x*e[t].y}return Math.abs(n/2)}on(e,n){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(n)}emit(e,n){const t=this.eventCallbacks.get(e);t&&t.forEach(e=>e(n))}clear(){this.layers.forEach(e=>{const n=[...e.children];e.removeChildren(),n.forEach(e=>{try{e.destroy({children:!0,texture:!1,baseTexture:!1})}catch{}})}),this.locationSprites.clear(),this.continentBounds.clear(),this.drawBackground(),console.log("[地图管理器] 地图已清空")}resize(e,n){this.app.renderer.resize(e,n),console.log("[地图管理器] 调整大小:",`${e}x${n}`)}destroy(){const e=this.app.view;e.removeEventListener("mousedown",this.boundOnDragStart),e.removeEventListener("mousemove",this.boundOnDragMove),e.removeEventListener("mouseup",this.boundOnDragEnd),e.removeEventListener("mouseleave",this.boundOnDragEnd),e.removeEventListener("touchstart",this.boundOnTouchStart),e.removeEventListener("touchmove",this.boundOnTouchMove),e.removeEventListener("touchend",this.boundOnTouchEnd),e.removeEventListener("wheel",this.boundOnWheel),this.app.ticker.stop();try{this.worldContainer.destroy({children:!0})}catch{}try{this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}catch{}this.layers.clear(),this.locationSprites.clear(),this.eventCallbacks.clear(),this.continentBounds.clear(),console.log("[地图管理器] 已销毁")}}const LK=1e4,EK=1e4,TK={natural_landmark:"#2D7D32",sect_power:"#1565C0",city_town:"#F57C00",blessed_land:"#7B1FA2",treasure_land:"#388E3C",dangerous_area:"#D32F2F",special_other:"#6B7280"},IK=[{match:/(魔|邪|诡|阴|幽)/i,color:"#7F1D1D"},{match:/(正|仙|道|宗门|剑|丹|符|阵)/i,color:"#1D4ED8"},{match:/(世家|门阀|家族)/i,color:"#0F766E"},{match:/(商会|商盟|商号)/i,color:"#B45309"},{match:/(妖|兽|灵族|异族)/i,color:"#047857"},{match:/(联盟|散修)/i,color:"#6B7280"}],RK=(e,n,t)=>Math.max(n,Math.min(t,e));function MK(e,n){const{width:t,height:a}=(e=>({width:Number(e?.width)>0?Number(e?.width):LK,height:Number(e?.height)>0?Number(e?.height):EK}))(n);return e.map((e,n)=>{let r;const o=String(e.type||e.类型||"special_other"),i=((e,n)=>!(e=>Object.prototype.hasOwnProperty.call(TK,e))(n)&&(!!(e.leadership||e.领导层||e.memberCount||e.成员数量)||/(宗门|世家|商会|联盟|势力|妖族|魔道)/i.test(n)))(e,o)?(e=>{for(const n of IK)if(n.match.test(e))return n.color;return"#6B7280"})(o):TK[o]||"#6B7280";let s;void 0!==e.coordinates?.x&&void 0!==e.coordinates?.y?r={x:RK(Number(e.coordinates.x),0,t),y:RK(Number(e.coordinates.y),0,a)}:void 0!==e.位置?.x&&void 0!==e.位置?.y?r={x:RK(Number(e.位置.x),0,t),y:RK(Number(e.位置.y),0,a)}:(r=function(e=5e3,n=5e3,t=3e3,a=1e4,r=1e4){const o=.05*a,i=.05*r;return{x:RK(o+Math.random()*(a-2*o),0,a),y:RK(i+Math.random()*(r-2*i),0,r)}}(t/2,a/2,.4*Math.min(t,a),t,a),console.warn(`[坐标] 地点 "${e.名称||e.name||`地点${n}`}" 缺少坐标，已随机生成: (${r.x.toFixed(0)}, ${r.y.toFixed(0)})`));const l=e.territoryBounds||e.势力范围;return l&&Array.isArray(l)&&l.length>=3&&(s=l.map(e=>({x:RK(Number(e.x),0,t),y:RK(Number(e.y),0,a)})),console.log(`[坐标] 势力 "${e.名称||e.name}" 有势力范围，共 ${s.length} 个边界点`)),{...e,id:e.id||`loc_${n}_${Date.now()}`,name:e.name||e.名称||`未命名地点${n}`,type:o,description:e.description||e.描述||"",coordinates:r,territoryBounds:s,headquarters:r,iconColor:e.iconColor||i,color:e.color||i}})}var PK=t(2347);const DK={class:"game-map-panel"},zK={key:0,class:"world-info-header"},NK={class:"world-name"},$K={class:"world-background"},OK={key:0,class:"initialize-map-overlay"},FK={class:"initialize-prompt"},jK={class:"density-selector"},BK={class:"density-options"},XK=["value"],UK={class:"option-label"},WK={class:"option-desc"},qK={key:1,class:"initialize-map-overlay"},GK={class:"initialize-prompt"},HK={class:"status-text"},VK={class:"popup-header"},QK={class:"popup-content"},KK={class:"location-type"},YK={class:"location-desc"},JK={key:0,class:"location-detail"},ZK={key:1,class:"location-detail"},eY={key:2,class:"location-detail"},nY={class:"popup-header"},tY={class:"popup-content"},aY={class:"location-type"},rY={class:"location-desc"},oY={key:0,class:"location-detail"},iY={key:1,class:"location-detail"},sY={key:0},lY={key:2,class:"location-detail"},cY={key:3,class:"location-detail"},dY={key:4,class:"location-detail"},uY={class:"popup-header"},pY={class:"popup-content"},vY={class:"location-desc"},fY={key:0,class:"location-detail"},hY={key:1,class:"location-detail"},mY={key:2,class:"location-detail"},gY={key:3,class:"location-detail"},bY={key:4,class:"location-detail"},yY={class:"legend-title"},xY={class:"legend-toggle"},kY={key:0,class:"legend-items"},wY={class:"legend-item"},_Y={class:"legend-item"},CY={class:"legend-item"},AY={class:"legend-item"},SY={class:"legend-item"},LY={class:"legend-item"},EY={class:"legend-item"},TY={class:"legend-item"},IY={class:"legend-item"},RY={key:0,class:"actions-content"},MY=["disabled"],PY={class:"generate-modal"},DY={class:"modal-header"},zY={class:"modal-body"},NY={class:"generate-option"},$Y=["disabled"],OY={class:"generate-option"},FY=["disabled"],jY={class:"modal-footer"},BY=["disabled"],XY=(0,r.pM)({__name:"GameMapPanel",props:{isOnline:{type:Boolean}},emits:["toggle-text-mode"],setup(e,{emit:n}){const t=e,a=n,l=(0,Hu.useGameStateStore)(),c=(0,i.KR)(null),d=(0,i.KR)(null),u=(0,i.KR)(null),p=(0,i.KR)(null),v=(0,i.KR)(null),f=(0,i.KR)("初始化中..."),h=(0,i.KR)({x:0,y:0}),m=(0,i.KR)(!1),g=(0,i.KR)(!1),b=(0,i.KR)(!1),y=(0,i.KR)(!1),x=(0,i.KR)(!1),k=(0,i.KR)({locations:!0,locationCount:3,factions:!1,factionCount:1}),w=(0,i.KR)("normal"),_=[{value:"sparse",label:"稀疏",desc:"势力3-4个，地点6-8个"},{value:"normal",label:"正常",desc:"势力5-8个，地点12-16个"},{value:"dense",label:"密集",desc:"势力8-12个，地点20-30个"}],C={sparse:{faction:.5,location:.5},normal:{faction:1,location:1},dense:{faction:1.5,location:1.5}},A=(0,r.EW)(()=>l.worldInfo?.世界名称||"混沌纪元"),S=(0,r.EW)(()=>l.worldInfo?.世界背景||""),L=(0,r.EW)(()=>{const e=l.worldInfo?.["地图配置"],n=Number(e?.width)||1e4,t=Number(e?.height)||1e4;return{width:n,height:t,tileSize:Math.max(80,Math.round(Math.min(n,t)/80)),minZoom:.1,maxZoom:4}}),E=(0,r.EW)(()=>`${L.value.width}x${L.value.height}`),T=e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const n=Number(e);return Number.isFinite(n)?n:null}return null},I=(e,n)=>{const t=n?.["当前位置"]||n?.["位置"]||n?.coordinates;if(!t||"object"!=typeof t)return null;const a=t;let r=T(a.x??a["坐标"]?.x??a.coordinates?.x)??NaN,o=T(a.y??a["坐标"]?.y??a.coordinates?.y)??NaN;if(!Number.isFinite(r)||!Number.isFinite(o)){const n=L.value,t=`${e}|${a["描述"]||a.description||e||"NPC"}`.split("").reduce((e,n)=>e+n.charCodeAt(0),0);r=.3*n.width+t%100*(.004*n.width),o=.3*n.height+7*t%100*(.004*n.height)}return Number.isFinite(r)&&Number.isFinite(o)?{x:r,y:o}:null},M=(0,r.EW)(()=>{const e=l.worldInfo;if(!e)return!1;const n=e.地点信息?.length>0,t=e.势力信息?.length>0;return n||t}),D={natural_landmark:"自然地标",sect_power:"势力据点",city_town:"聚居地",blessed_land:"遗迹设施",treasure_land:"资源点",dangerous_area:"危险区域",special_other:"其他特殊",自然地标:"自然地标",聚居地:"聚居地",资源点:"资源点",遗迹设施:"遗迹设施",危险区域:"危险区域",其他特殊:"其他特殊",名山大川:"自然地标",城镇坊市:"聚居地",洞天福地:"遗迹设施",奇珍异地:"资源点",凶险之地:"危险区域"},z=e=>!!("修仙宗门"===e.类型||"魔道宗门"===e.类型||"修仙世家"===e.类型||"散修联盟"===e.类型||"商会"===e.类型||"妖族势力"===e.类型||"sect_power"===e.type||e.leadership||e.领导层||e.memberCount||e.成员数量),N=(0,r.EW)(()=>{if(!p.value&&!v.value)return{};const e=d.value?.getBoundingClientRect();if(!e)return{};let n=h.value.x,t=h.value.y,a=!1;return n+160>e.width-20&&(n=e.width-160-20),n-160<20&&(n=180),t-200<20?(t+=20,a=!0):t-=10,{position:"absolute",left:`${n}px`,top:`${t}px`,transform:a?"translate(-50%, 0)":"translate(-50%, -100%)",zIndex:"2000"}}),$=async()=>{if(c.value&&d.value)try{f.value="正在初始化地图...",await new Promise(e=>requestAnimationFrame(e));const e=d.value.getBoundingClientRect(),n=c.value;0===e.width||0===e.height?(console.warn("[地图] 容器尺寸无效，使用默认值"),n.width=800,n.height=600):(n.width=e.width,n.height=e.height),console.log("[地图] Canvas 尺寸:",{width:n.width,height:n.height}),u.value?.destroy(),u.value=new SK(n,L.value),u.value.on("locationClick",e=>{B(e)}),u.value.on("continentClick",e=>{X(e)}),await j({silent:!0,reset:!0}),f.value="地图加载完成"}catch(e){console.error("[地图] 初始化失败:",e),f.value="地图加载失败";const n=e.message;n.includes("shader")||n.includes("WebGL")?_e.o.error("地图初始化失败：显卡不支持或WebGL被禁用。请尝试更新浏览器或显卡驱动。"):n.includes("canvas")?_e.o.error("地图初始化失败：Canvas元素无效。请刷新页面重试。"):_e.o.error("地图初始化失败: "+n)}};(0,r.sV)(async()=>{await $(),window.addEventListener("resize",W),document.addEventListener("fullscreenchange",q)}),(0,r.hi)(()=>{window.removeEventListener("resize",W),document.removeEventListener("fullscreenchange",q),u.value?.destroy()}),(0,r.wB)(()=>l.location,e=>{if(e&&u.value){const n=l.character?.名字||"道友";u.value.updatePlayerPosition(e,n)}},{deep:!0}),(0,r.wB)(()=>l.relationships,e=>{if(!e||!u.value)return;const n=[];Object.entries(e).forEach(([e,t])=>{const a=I(e,t);a&&n.push({name:e,coordinates:a})}),u.value.updateNPCPositions(n)},{deep:!0}),(0,r.wB)(()=>{const e=l.onlineState;return{isOnline:t.isOnline,ownerLocation:e?.穿越目标?.世界主人位置,ownerName:e?.穿越目标?.世界主人档案?.名字||e?.穿越目标?.主人用户名}},({isOnline:e,ownerLocation:n,ownerName:t})=>{if(u.value)if(console.log("[地图] 联机状态变化:",{isOnline:e,ownerLocation:n,ownerName:t}),e&&n){let e=n.x??n.坐标?.x??n.coordinates?.x,a=n.y??n.坐标?.y??n.coordinates?.y;if(!Number.isFinite(e)||!Number.isFinite(a)){console.warn("[地图] 世界主人位置坐标缺失，使用默认位置:",n);const t=L.value,r=(n.描述||n.description||"未知").split("").reduce((e,n)=>e+n.charCodeAt(0),0);e=.3*t.width+r%100*(.004*t.width),a=.3*t.height+7*r%100*(.004*t.height)}Number.isFinite(e)&&Number.isFinite(a)?(u.value.updateOtherPlayerPosition({x:e,y:a},t||"世界主人"),console.log("[地图] 显示世界主人位置:",{x:e,y:a,ownerName:t})):u.value.updateOtherPlayerPosition(null)}else u.value.updateOtherPlayerPosition(null)},{deep:!0,immediate:!0}),(0,r.wB)(()=>E.value,(e,n)=>{u.value&&e!==n&&$()}),(0,r.wB)(()=>[l.worldInfo?.大陆信息?.length,l.worldInfo?.势力信息?.length,l.worldInfo?.地点信息?.length],(e,n)=>{u.value&&!m.value&&(n&&e.every((e,t)=>e===n[t])||(console.log("[地图] 检测到世界数据变化，重新加载地图",{newLengths:e,oldLengths:n}),j({silent:!0,reset:!0})))});const O=async()=>{const e=l.worldInfo;if(e){m.value=!0,f.value="开始生成地图内容...";try{const n=e.大陆信息?.length||3,t=C[w.value],a=Math.max(3,Math.round(2*n*t.faction)),r=Math.max(6,Math.round(4*n*t.location)),o=Math.max(2,Math.round(.25*r)),i=e?.["地图配置"]||{width:L.value.width,height:L.value.height,minLng:0,maxLng:L.value.width,minLat:0,maxLat:L.value.height};console.log(`[地图] 密度: ${w.value}, 势力: ${a}, 地点: ${r}`);const s=new PK.U({worldName:e.世界名称,worldBackground:e.世界背景,worldEra:e.世界纪元||"修真盛世",factionCount:a,locationCount:r,secretRealmsCount:o,continentCount:n,mapConfig:i,maxRetries:3,retryDelay:1e3,onStreamChunk:e=>{f.value=e}});console.log("[地图] 开始生成地图内容...");const c=await s.generateValidatedWorld();if(c.success&&c.worldInfo){console.log("[地图] 地图生成成功，正在更新游戏状态...");const n={...e,势力信息:c.worldInfo.势力信息||[],地点信息:c.worldInfo.地点信息||[]};l.updateState("worldInfo",n),await j({reset:!0}),_e.o.success("地图初始化完成！"),console.log("[地图] 地图初始化完成")}else{const e=c.errors?.join(", ")||"生成失败";_e.o.error(`地图生成失败: ${e}`),console.error("[地图] 生成失败:",c.errors)}}catch(e){console.error("[地图] 初始化失败:",e),_e.o.error("地图初始化失败: "+e.message)}finally{m.value=!1,f.value="初始化完成"}}else _e.o.error("未找到世界信息")},F=async()=>{const e=l.worldInfo;if(!e)return void _e.o.error("未找到世界信息");const{locations:n,locationCount:t,factions:a,factionCount:r}=k.value;if(n||a){x.value=!0,y.value=!1;try{const o=e?.["地图配置"]||{width:L.value.width,height:L.value.height},i=new PK.U({worldName:e.世界名称,worldBackground:e.世界背景,worldEra:e.世界纪元||"修真盛世",factionCount:a?r:0,locationCount:n?t:0,secretRealmsCount:0,continentCount:e.大陆信息?.length||1,mapConfig:o,maxRetries:2,retryDelay:500,existingFactions:e.势力信息?.map(e=>({名称:e.名称||e.name,位置:e.位置||e.location,势力范围:e.势力范围||e.territory}))||[],existingLocations:e.地点信息?.map(e=>({名称:e.名称||e.name,coordinates:e.coordinates||e.坐标}))||[]}),s=await i.generateValidatedWorld();if(s.success&&s.worldInfo){const n=s.worldInfo.势力信息||[],t=s.worldInfo.地点信息||[],a={...e,势力信息:[...e.势力信息||[],...n],地点信息:[...e.地点信息||[],...t]};l.updateState("worldInfo",a),await j({reset:!0});const r=[];n.length&&r.push(`${n.length}个势力`),t.length&&r.push(`${t.length}个地点`),_e.o.success(`已追加生成: ${r.join("、")}`)}else _e.o.error("生成失败: "+(s.errors?.join(", ")||"未知错误"))}catch(e){console.error("[地图] 追加生成失败:",e),_e.o.error("生成失败: "+e.message)}finally{x.value=!1}}else _e.o.warning("请至少选择一种生成类型")},j=async e=>{try{const{silent:n=!1,reset:a=!0}=e??{};f.value="正在加载世界数据...";const r=l.worldInfo;if(!r)return n||_e.o.warning("未找到世界数据"),void(f.value="未找到世界数据");a&&u.value?.clear();const o=L.value;let i=0;if(r.大陆信息&&Array.isArray(r.大陆信息)&&(r.大陆信息.forEach(e=>{try{if(e.大洲边界||e.continent_bounds){const n=e.大洲边界||e.continent_bounds;e.continent_bounds=function(e,n=1e4,t=1e4){return e.map(e=>({x:RK(Number(e.x),0,n),y:RK(Number(e.y),0,t)}))}(n,o.width,o.height),e.大洲边界=e.continent_bounds}u.value?.addContinent(e)}catch(n){console.error("[地图] 加载大陆失败:",e,n)}}),console.log(`[地图] 已加载 ${r.大陆信息.length} 个大陆`)),r.势力信息&&Array.isArray(r.势力信息)){const e=MK(r.势力信息,o);e.forEach(e=>{try{e.territoryBounds&&e.territoryBounds.length>=3&&u.value?.addTerritory(e)}catch(n){console.error("[地图] 加载势力失败:",e,n)}}),console.log(`[地图] 已加载 ${e.length} 个势力范围`)}if(r.地点信息&&Array.isArray(r.地点信息)){const e=MK(r.地点信息,o);e.forEach(e=>{try{u.value?.addLocation(e),i++}catch(n){console.error("[地图] 加载地点失败:",e,n)}}),console.log(`[地图] 已加载 ${e.length} 个地点`)}const s=l.location;if(s){const e=l.character?.名字||"道友";u.value?.updatePlayerPosition(s,e),console.log("[地图] 已更新玩家位置")}const c=l.relationships;if(c&&"object"==typeof c){const e=[];Object.entries(c).forEach(([n,t])=>{const a=I(n,t);a&&e.push({name:n,coordinates:a})}),e.length>0&&(u.value?.updateNPCPositions(e),console.log(`[Map] Updated ${e.length} NPC positions`))}if(t.isOnline){const e=l.onlineState,n=e?.穿越目标?.世界主人位置,a=e?.穿越目标?.世界主人档案?.名字||e?.穿越目标?.主人用户名;if(console.log("[地图] loadMapData 检查世界主人位置:",{isOnline:t.isOnline,ownerLocation:n,ownerName:a}),n){let e=n.x??n.坐标?.x??n.coordinates?.x,t=n.y??n.坐标?.y??n.coordinates?.y;if(!Number.isFinite(e)||!Number.isFinite(t)){const a=(n.描述||n.description||"未知").split("").reduce((e,n)=>e+n.charCodeAt(0),0);e=.3*o.width+a%100*(.004*o.width),t=.3*o.height+7*a%100*(.004*o.height)}Number.isFinite(e)&&Number.isFinite(t)&&(u.value?.updateOtherPlayerPosition({x:e,y:t},a||"世界主人"),console.log("[地图] 已更新世界主人位置:",{x:e,y:t,ownerName:a}))}}f.value=`已加载 ${i} 个地点`,n||_e.o.success("地图加载完成")}catch(e){console.error("[地图] 加载数据失败:",e),f.value="数据加载失败",_e.o.error("加载地图数据失败: "+e.message)}},B=e=>{if(console.log("[地图] handleLocationClick 被调用，data:",e),!e)return void console.warn("[地图] 点击数据为空");const n=e;v.value=null,p.value=n.location||n,console.log("[地图] selectedLocation 已设置:",p.value),n.clickPosition&&(h.value={x:n.clickPosition.x,y:n.clickPosition.y},console.log("[地图] 弹窗位置（点击位置）:",h.value))},X=e=>{if(console.log("[地图] handleContinentClick 被调用，data:",e),!e)return void console.warn("[地图] 点击数据为空");const n=e;p.value=null,v.value=n,console.log("[地图] selectedContinent 已设置:",v.value),n.clickPosition&&(h.value={x:n.clickPosition.x,y:n.clickPosition.y},console.log("[地图] 弹窗位置（点击位置）:",h.value))},U=()=>{p.value=null,v.value=null},W=()=>{if(d.value&&u.value)try{const e=d.value.getBoundingClientRect();u.value.resize(e.width,e.height)}catch(e){console.warn("[地图] Resize 错误（已忽略）:",e)}},q=()=>{W()};return(e,n)=>{return(0,r.uX)(),(0,r.CE)("div",DK,[(0,r.Q3)(" 世界信息头部 "),S.value?((0,r.uX)(),(0,r.CE)("div",zK,[(0,r.Lk)("div",NK,(0,o.v_)(A.value),1),(0,r.Lk)("div",$K,(0,o.v_)(S.value),1)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" Pixi.js Canvas容器 "),(0,r.Lk)("div",{class:"map-container",ref_key:"mapContainerRef",ref:d},[(0,r.Lk)("canvas",{ref_key:"canvasRef",ref:c},null,512),(0,r.Q3)(" 初始化地图按钮 (仅在地图为空时显示) "),M.value||m.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",OK,[(0,r.Lk)("div",FK,[n[14]||(n[14]=(0,r.Lk)("div",{class:"prompt-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"map-icon"},[(0,r.Lk)("path",{d:"M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3V6z"}),(0,r.Lk)("path",{d:"M9 3v15M15 6v15"})])],-1)),n[15]||(n[15]=(0,r.Lk)("h3",null,"地图尚未初始化",-1)),n[16]||(n[16]=(0,r.Lk)("p",null,"当前世界还没有生成势力和地点，选择密度后点击按钮开始生成",-1)),(0,r.Lk)("div",jK,[n[12]||(n[12]=(0,r.Lk)("label",{class:"density-label"},"地图密度：",-1)),(0,r.Lk)("div",BK,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(_,e=>(0,r.Lk)("label",{key:e.value,class:(0,o.C4)(["density-option",{active:w.value===e.value}])},[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":n[0]||(n[0]=e=>w.value=e)},null,8,XK),[[s.XL,w.value]]),(0,r.Lk)("span",UK,(0,o.v_)(e.label),1),(0,r.Lk)("span",WK,(0,o.v_)(e.desc),1)],2)),64))])]),(0,r.Lk)("button",{onClick:O,class:"initialize-btn"},n[13]||(n[13]=[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"btn-icon"},[(0,r.Lk)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.Lk)("path",{d:"M8 12h8M12 8v8"})],-1),(0,r.eW)(" 初始化地图 ",-1)]))])])),(0,r.Q3)(" 初始化进行中 "),m.value?((0,r.uX)(),(0,r.CE)("div",qK,[(0,r.Lk)("div",GK,[n[17]||(n[17]=(0,r.Lk)("div",{class:"loading-spinner"},null,-1)),n[18]||(n[18]=(0,r.Lk)("h3",null,"正在生成地图内容...",-1)),(0,r.Lk)("p",HK,(0,o.v_)(f.value),1)])])):(0,r.Q3)("v-if",!0)],512),(0,r.Q3)(" 地点信息弹窗 "),p.value&&!z(p.value)?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"location-popup",style:(0,o.Tr)(N.value)},[(0,r.Lk)("div",VK,[(0,r.Lk)("h4",null,(0,o.v_)(p.value.name),1),(0,r.Lk)("button",{onClick:U,class:"close-btn"},"×")]),(0,r.Lk)("div",QK,[(0,r.Lk)("p",KK,(0,o.v_)((u=p.value.type,D[u]||u||"未知类型")),1),(0,r.Lk)("p",YK,(0,o.v_)(p.value.description||p.value.描述),1),p.value.danger_level?((0,r.uX)(),(0,r.CE)("div",JK,[n[19]||(n[19]=(0,r.Lk)("strong",null,"安全等级：",-1)),(0,r.eW)((0,o.v_)(p.value.danger_level),1)])):(0,r.Q3)("v-if",!0),p.value.suitable_for?((0,r.uX)(),(0,r.CE)("div",ZK,[n[20]||(n[20]=(0,r.Lk)("strong",null,"适合觉醒阶段：",-1)),(0,r.eW)((0,o.v_)(p.value.suitable_for),1)])):(0,r.Q3)("v-if",!0),p.value.controlled_by?((0,r.uX)(),(0,r.CE)("div",eY,[n[21]||(n[21]=(0,r.Lk)("strong",null,"控制势力：",-1)),(0,r.eW)((0,o.v_)(p.value.controlled_by),1)])):(0,r.Q3)("v-if",!0)])],4)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 势力信息弹窗 "),p.value&&z(p.value)?((0,r.uX)(),(0,r.CE)("div",{key:2,class:"location-popup faction-popup",style:(0,o.Tr)(N.value)},[(0,r.Lk)("div",nY,[(0,r.Lk)("h4",null,(0,o.v_)(p.value.name||p.value.名称),1),(0,r.Lk)("button",{onClick:U,class:"close-btn"},"×")]),(0,r.Lk)("div",tY,[(0,r.Lk)("p",aY,(0,o.v_)(p.value.类型||p.value.type||"势力"),1),(0,r.Lk)("p",rY,(0,o.v_)(p.value.description||p.value.描述),1),p.value.等级?((0,r.uX)(),(0,r.CE)("div",oY,[n[22]||(n[22]=(0,r.Lk)("strong",null,"势力等级：",-1)),(0,r.eW)((0,o.v_)(p.value.等级),1)])):(0,r.Q3)("v-if",!0),p.value.leadership||p.value.领导层?((0,r.uX)(),(0,r.CE)("div",iY,[n[23]||(n[23]=(0,r.Lk)("strong",null,"掌门：",-1)),(0,r.eW)((0,o.v_)(p.value.leadership?.宗主||p.value.领导层?.宗主)+" ",1),p.value.leadership?.宗主修为||p.value.领导层?.宗主修为?((0,r.uX)(),(0,r.CE)("span",sY," （"+(0,o.v_)(p.value.leadership?.宗主修为||p.value.领导层?.宗主修为)+"） ",1)):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),p.value.memberCount||p.value.成员数量?((0,r.uX)(),(0,r.CE)("div",lY,[n[24]||(n[24]=(0,r.Lk)("strong",null,"成员数量：",-1)),(0,r.eW)((0,o.v_)(p.value.memberCount?.total||p.value.成员数量?.总数||p.value.成员数量?.total)+"人 ",1)])):(0,r.Q3)("v-if",!0),p.value.特色&&p.value.特色.length>0?((0,r.uX)(),(0,r.CE)("div",cY,[n[25]||(n[25]=(0,r.Lk)("strong",null,"势力特色：",-1)),(0,r.eW)((0,o.v_)(Array.isArray(p.value.特色)?p.value.特色.join("、"):p.value.特色),1)])):(0,r.Q3)("v-if",!0),p.value.与玩家关系?((0,r.uX)(),(0,r.CE)("div",dY,[n[26]||(n[26]=(0,r.Lk)("strong",null,"关系：",-1)),(0,r.Lk)("span",{class:(0,o.C4)((l=p.value.与玩家关系,"友好"===l||"盟友"===l?"relation-friendly":"敌对"===l||"仇敌"===l?"relation-hostile":"relation-neutral"))},(0,o.v_)(p.value.与玩家关系),3)])):(0,r.Q3)("v-if",!0)])],4)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 大陆信息弹窗 "),v.value?((0,r.uX)(),(0,r.CE)("div",{key:3,class:"location-popup continent-popup",style:(0,o.Tr)(N.value)},[(0,r.Lk)("div",uY,[(0,r.Lk)("h4",null,(0,o.v_)(v.value.name),1),(0,r.Lk)("button",{onClick:U,class:"close-btn"},"×")]),(0,r.Lk)("div",pY,[n[32]||(n[32]=(0,r.Lk)("p",{class:"location-type"},"区域",-1)),(0,r.Lk)("p",vY,(0,o.v_)(v.value.description||"废墟大陆，异常生态与高风险并存。"),1),v.value.气候?((0,r.uX)(),(0,r.CE)("div",fY,[n[27]||(n[27]=(0,r.Lk)("strong",null,"气候：",-1)),(0,r.eW)((0,o.v_)(v.value.气候),1)])):(0,r.Q3)("v-if",!0),v.value.地理特征&&v.value.地理特征.length>0?((0,r.uX)(),(0,r.CE)("div",hY,[n[28]||(n[28]=(0,r.Lk)("strong",null,"地理特征：",-1)),(0,r.eW)((0,o.v_)(v.value.地理特征.join("、")),1)])):(0,r.Q3)("v-if",!0),v.value.天然屏障&&v.value.天然屏障.length>0?((0,r.uX)(),(0,r.CE)("div",mY,[n[29]||(n[29]=(0,r.Lk)("strong",null,"天然屏障：",-1)),(0,r.eW)((0,o.v_)(v.value.天然屏障.join("、")),1)])):(0,r.Q3)("v-if",!0),v.value.特点?((0,r.uX)(),(0,r.CE)("div",gY,[n[30]||(n[30]=(0,r.Lk)("strong",null,"大陆特点：",-1)),(0,r.eW)((0,o.v_)(v.value.特点),1)])):(0,r.Q3)("v-if",!0),v.value.主要势力&&v.value.主要势力.length>0?((0,r.uX)(),(0,r.CE)("div",bY,[n[31]||(n[31]=(0,r.Lk)("strong",null,"主要势力：",-1)),(0,r.eW)((0,o.v_)(Array.isArray(v.value.主要势力)?v.value.主要势力.join("、"):v.value.主要势力),1)])):(0,r.Q3)("v-if",!0)])],4)):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 地图图例 "),(0,r.Lk)("div",{class:(0,o.C4)(["map-legend",{collapsed:g.value}])},[(0,r.Lk)("div",{class:"legend-header",onClick:n[1]||(n[1]=e=>g.value=!g.value)},[(0,r.Lk)("div",yY,(0,o.v_)(A.value)+"图例"+(0,o.v_)(t.isOnline?"（联机）":""),1),(0,r.Lk)("button",xY,[g.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.Wv)((0,i.R1)(ZB),{key:0,size:16})),g.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(dw),{key:1,size:16})):(0,r.Q3)("v-if",!0)])]),g.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",kY,[(0,r.Q3)(" 自然地标 "),(0,r.Lk)("div",wY,[(0,r.bF)((0,i.R1)(IT),{size:16,class:"legend-icon mountain"}),n[33]||(n[33]=(0,r.Lk)("span",null,"自然地标",-1))]),(0,r.Q3)(" 势力据点 "),(0,r.Lk)("div",_Y,[(0,r.bF)((0,i.R1)(tp),{size:16,class:"legend-icon faction"}),n[34]||(n[34]=(0,r.Lk)("span",null,"势力据点",-1))]),(0,r.Q3)(" 聚居地（城市/避难所） "),(0,r.Lk)("div",CY,[(0,r.bF)((0,i.R1)(zc.A),{size:16,class:"legend-icon town"}),n[35]||(n[35]=(0,r.Lk)("span",null,"聚居地",-1))]),(0,r.Q3)(" 遗迹设施（实验室/旧时代设施） "),(0,r.Lk)("div",AY,[(0,r.bF)((0,i.R1)(up.A),{size:16,class:"legend-icon blessed"}),n[36]||(n[36]=(0,r.Lk)("span",null,"遗迹设施",-1))]),(0,r.Q3)(" 资源点 "),(0,r.Lk)("div",SY,[(0,r.bF)((0,i.R1)(vM),{size:16,class:"legend-icon treasure"}),n[37]||(n[37]=(0,r.Lk)("span",null,"资源点",-1))]),(0,r.Q3)(" 危险区域 "),(0,r.Lk)("div",LY,[(0,r.bF)((0,i.R1)(eX.A),{size:16,class:"legend-icon danger"}),n[38]||(n[38]=(0,r.Lk)("span",null,"危险区域",-1))]),(0,r.Q3)(" 其他特殊 "),(0,r.Lk)("div",EY,[(0,r.bF)((0,i.R1)(Ku),{size:16,class:"legend-icon special"}),n[39]||(n[39]=(0,r.Lk)("span",null,"其他特殊",-1))]),(0,r.Q3)(" 玩家位置 "),(0,r.Lk)("div",TY,[(0,r.bF)((0,i.R1)(R),{size:16,class:"legend-icon player"}),n[40]||(n[40]=(0,r.Lk)("span",null,"玩家位置",-1))]),(0,r.Q3)(" NPC位置 "),(0,r.Lk)("div",IY,[(0,r.bF)((0,i.R1)(P),{size:16,class:"legend-icon npc"}),n[41]||(n[41]=(0,r.Lk)("span",null,"NPC位置",-1))])]))],2),(0,r.Q3)(" 地图操作按钮 "),(0,r.Lk)("div",{class:(0,o.C4)(["map-actions",{expanded:b.value}])},[(0,r.Lk)("div",{class:"actions-header",onClick:n[2]||(n[2]=e=>b.value=!b.value)},[(0,r.bF)((0,i.R1)(nX.A),{size:16}),n[42]||(n[42]=(0,r.Lk)("span",null,"地图功能",-1)),b.value?((0,r.uX)(),(0,r.Wv)((0,i.R1)(ZB),{key:1,size:14,class:"toggle-icon"})):((0,r.uX)(),(0,r.Wv)((0,i.R1)(dw),{key:0,size:14,class:"toggle-icon"}))]),b.value?((0,r.uX)(),(0,r.CE)("div",RY,[M.value?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:n[3]||(n[3]=e=>y.value=!0),class:"action-btn",disabled:x.value},[(0,r.bF)((0,i.R1)(lj.A),{size:14}),n[43]||(n[43]=(0,r.Lk)("span",null,"追加生成",-1))],8,MY)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:n[4]||(n[4]=e=>a("toggle-text-mode")),class:"action-btn text-mode-btn"},[(0,r.bF)((0,i.R1)(Jc.A),{size:14}),n[44]||(n[44]=(0,r.Lk)("span",null,"文字模式",-1))])])):(0,r.Q3)("v-if",!0)],2),(0,r.Q3)(" 追加生成弹窗 "),y.value?((0,r.uX)(),(0,r.CE)("div",{key:4,class:"generate-modal-overlay",onClick:n[11]||(n[11]=(0,s.D$)(e=>y.value=!1,["self"]))},[(0,r.Lk)("div",PY,[(0,r.Lk)("div",DY,[n[45]||(n[45]=(0,r.Lk)("h3",null,"追加生成内容",-1)),(0,r.Lk)("button",{onClick:n[5]||(n[5]=e=>y.value=!1),class:"close-btn"},"×")]),(0,r.Lk)("div",zY,[(0,r.Lk)("div",NY,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[6]||(n[6]=e=>k.value.locations=e)},null,512),[[s.lH,k.value.locations]]),n[46]||(n[46]=(0,r.eW)(" 生成地点 ",-1))]),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[7]||(n[7]=e=>k.value.locationCount=e),min:"1",max:"10",disabled:!k.value.locations,class:"count-input"},null,8,$Y),[[s.Jo,k.value.locationCount,void 0,{number:!0}]]),n[47]||(n[47]=(0,r.Lk)("span",{class:"count-label"},"个",-1))]),(0,r.Lk)("div",OY,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[8]||(n[8]=e=>k.value.factions=e)},null,512),[[s.lH,k.value.factions]]),n[48]||(n[48]=(0,r.eW)(" 生成势力 ",-1))]),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":n[9]||(n[9]=e=>k.value.factionCount=e),min:"1",max:"5",disabled:!k.value.factions,class:"count-input"},null,8,FY),[[s.Jo,k.value.factionCount,void 0,{number:!0}]]),n[49]||(n[49]=(0,r.Lk)("span",{class:"count-label"},"个",-1))])]),(0,r.Lk)("div",jY,[(0,r.Lk)("button",{onClick:n[10]||(n[10]=e=>y.value=!1),class:"cancel-btn"},"取消"),(0,r.Lk)("button",{onClick:F,class:"confirm-btn",disabled:x.value||!k.value.locations&&!k.value.factions},(0,o.v_)(x.value?"生成中...":"开始生成"),9,BY)])])])):(0,r.Q3)("v-if",!0)]);var l,u}}});var UY=t(4574),WY={};WY.styleTagTransform=A(),WY.setAttributes=k(),WY.insert=y().bind(null,"head"),WY.domAPI=g(),WY.insertStyleElement=_(),h()(UY.A,WY),UY.A&&UY.A.locals&&UY.A.locals;const qY=(0,E.A)(XY,[["__scopeId","data-v-736748a1"]]);var GY=t(3825);const HY={class:"online-travel-map-panel"},VY={class:"panel-header"},QY={class:"title"},KY={key:0,class:"meta"},YY={key:1,class:"meta"},JY={key:2,class:"meta"},ZY={class:"actions"},eJ=["disabled"],nJ={key:0,class:"empty-state"},tJ={key:1,class:"content"},aJ={key:0,class:"loading-state"},rJ={key:1,class:"error-state"},oJ={key:2,class:"empty-state"},iJ={key:3,class:"world-info-container"},sJ={class:"info-section"},lJ={class:"info-grid"},cJ={key:0,class:"info-item"},dJ={key:1,class:"info-item"},uJ={key:2,class:"info-item"},pJ={key:0,class:"info-desc"},vJ={key:0,class:"info-section"},fJ={class:"section-title"},hJ={class:"list-container"},mJ={class:"item-name"},gJ={key:0,class:"item-desc"},bJ={key:1,class:"info-section"},yJ={class:"section-title"},xJ={class:"list-container"},kJ={class:"item-name"},wJ={key:0,class:"item-meta"},_J={key:1,class:"item-desc"},CJ={key:2,class:"info-section"},AJ={class:"section-title"},SJ={class:"list-container"},LJ={class:"item-name"},EJ={key:0,class:"item-meta"},TJ={key:1,class:"item-meta"},IJ={key:2,class:"item-desc"},RJ=(0,r.pM)({__name:"OnlineTravelMapPanel",emits:["toggle-graphic-mode"],setup(e,{emit:n}){const t=n,a=(0,Hu.useGameStateStore)(),s=(0,i.KR)(!1),l=(0,i.KR)(""),c=(0,i.KR)(null),d=(0,i.KR)(null),u=(0,r.EW)(()=>a.onlineState),p=(0,r.EW)(()=>{const e=u.value?.房间ID;return e?Number(e):null}),v=(0,r.EW)(()=>{const e=u.value?.穿越目标?.世界ID;return"number"==typeof e?e:e?Number(e):null}),f=(0,r.EW)(()=>u.value?.穿越目标?.主人用户名??null),h=(0,r.EW)(()=>d.value?.world_info??null),m=(0,r.EW)(()=>{const e=h.value;return e?e.大陆信息??e.continents??[]:[]}),g=(0,r.EW)(()=>{const e=h.value;return e?e.势力信息??e.factions??[]:[]}),b=(0,r.EW)(()=>{const e=h.value;return e?e.地点信息??e.locations??[]:[]}),y=async()=>{if(p.value){s.value=!0,l.value="";try{const e=await(0,GY.RZ)();if(!e)return c.value=null,void(d.value=null);c.value=e,d.value=await(0,GY.r9)(e.target_world_instance_id,e.entry_map_id,e.session_id)}catch(e){l.value=e?.message||"加载世界信息失败"}finally{s.value=!1}}};return(0,r.sV)(()=>{y()}),(0,r.wB)([p,v],()=>{y()}),(e,n)=>((0,r.uX)(),(0,r.CE)("div",HY,[(0,r.Lk)("div",VY,[(0,r.Lk)("div",QY,[n[1]||(n[1]=(0,r.Lk)("span",{class:"title-text"},"联机世界信息",-1)),p.value?((0,r.uX)(),(0,r.CE)("span",KY,"· 会话 #"+(0,o.v_)(p.value),1)):(0,r.Q3)("v-if",!0),v.value?((0,r.uX)(),(0,r.CE)("span",YY,"· 世界 #"+(0,o.v_)(v.value),1)):(0,r.Q3)("v-if",!0),f.value?((0,r.uX)(),(0,r.CE)("span",JY,"· 主人："+(0,o.v_)(f.value),1)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",ZY,[(0,r.Lk)("button",{class:"tool-btn graphic-btn",onClick:n[0]||(n[0]=e=>t("toggle-graphic-mode"))},[(0,r.bF)((0,i.R1)(Ju),{size:14}),n[2]||(n[2]=(0,r.eW)(" 图形模式 ",-1))]),(0,r.Lk)("button",{class:"tool-btn",onClick:y,disabled:s.value}," 刷新 ",8,eJ)])]),p.value&&v.value?((0,r.uX)(),(0,r.CE)("div",tJ,[s.value?((0,r.uX)(),(0,r.CE)("div",aJ,"加载中...")):l.value?((0,r.uX)(),(0,r.CE)("div",rJ,(0,o.v_)(l.value),1)):h.value?((0,r.uX)(),(0,r.CE)("div",iJ,[(0,r.Q3)(" 世界基本信息 "),(0,r.Lk)("div",sJ,[n[8]||(n[8]=(0,r.Lk)("div",{class:"section-title"},"世界概况",-1)),(0,r.Lk)("div",lJ,[h.value.世界名称?((0,r.uX)(),(0,r.CE)("div",cJ,[n[5]||(n[5]=(0,r.Lk)("span",{class:"label"},"名称：",-1)),(0,r.eW)((0,o.v_)(h.value.世界名称),1)])):(0,r.Q3)("v-if",!0),h.value.世界纪元?((0,r.uX)(),(0,r.CE)("div",dJ,[n[6]||(n[6]=(0,r.Lk)("span",{class:"label"},"纪元：",-1)),(0,r.eW)((0,o.v_)(h.value.世界纪元),1)])):(0,r.Q3)("v-if",!0),h.value.版本?((0,r.uX)(),(0,r.CE)("div",uJ,[n[7]||(n[7]=(0,r.Lk)("span",{class:"label"},"版本：",-1)),(0,r.eW)((0,o.v_)(h.value.版本),1)])):(0,r.Q3)("v-if",!0)]),h.value.世界背景?((0,r.uX)(),(0,r.CE)("div",pJ,(0,o.v_)(h.value.世界背景),1)):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 大陆信息 "),m.value.length>0?((0,r.uX)(),(0,r.CE)("div",vJ,[(0,r.Lk)("div",fJ,"大陆信息 ("+(0,o.v_)(m.value.length)+")",1),(0,r.Lk)("div",hJ,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"list-item"},[(0,r.Lk)("div",mJ,(0,o.v_)(e.名称||e.name||`大陆${n+1}`),1),e.描述||e.description?((0,r.uX)(),(0,r.CE)("div",gJ,(0,o.v_)(e.描述||e.description),1)):(0,r.Q3)("v-if",!0)]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 势力信息 "),g.value.length>0?((0,r.uX)(),(0,r.CE)("div",bJ,[(0,r.Lk)("div",yJ,"势力信息 ("+(0,o.v_)(g.value.length)+")",1),(0,r.Lk)("div",xJ,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"list-item"},[(0,r.Lk)("div",kJ,(0,o.v_)(e.名称||e.name||`势力${n+1}`),1),e.类型||e.type?((0,r.uX)(),(0,r.CE)("div",wJ,"类型："+(0,o.v_)(e.类型||e.type),1)):(0,r.Q3)("v-if",!0),e.描述||e.description?((0,r.uX)(),(0,r.CE)("div",_J,(0,o.v_)(e.描述||e.description),1)):(0,r.Q3)("v-if",!0)]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 地点信息 "),b.value.length>0?((0,r.uX)(),(0,r.CE)("div",CJ,[(0,r.Lk)("div",AJ,"地点信息 ("+(0,o.v_)(b.value.length)+")",1),(0,r.Lk)("div",SJ,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(b.value,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"list-item"},[(0,r.Lk)("div",LJ,(0,o.v_)(e.名称||e.name||`地点${n+1}`),1),e.类型||e.type?((0,r.uX)(),(0,r.CE)("div",EJ,"类型："+(0,o.v_)(e.类型||e.type),1)):(0,r.Q3)("v-if",!0),e.所属势力?((0,r.uX)(),(0,r.CE)("div",TJ,"所属："+(0,o.v_)(e.所属势力),1)):(0,r.Q3)("v-if",!0),e.描述||e.description?((0,r.uX)(),(0,r.CE)("div",IJ,(0,o.v_)(e.描述||e.description),1)):(0,r.Q3)("v-if",!0)]))),128))])])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",oJ,n[4]||(n[4]=[(0,r.Lk)("div",{class:"empty-title"},"暂无世界数据",-1),(0,r.Lk)("div",{class:"empty-hint"},"对方世界尚未生成或同步世界信息。",-1)])))])):((0,r.uX)(),(0,r.CE)("div",nJ,n[3]||(n[3]=[(0,r.Lk)("div",{class:"empty-title"},"未处于联机穿越中",-1),(0,r.Lk)("div",{class:"empty-hint"},"开始穿越后，这里会展示对方世界的信息。",-1)])))]))}});var MJ=t(4449),PJ={};PJ.styleTagTransform=A(),PJ.setAttributes=k(),PJ.insert=y().bind(null,"head"),PJ.domAPI=g(),PJ.insertStyleElement=_(),h()(MJ.A,PJ),MJ.A&&MJ.A.locals&&MJ.A.locals;const DJ=(0,E.A)(RJ,[["__scopeId","data-v-5bad2f10"]]),zJ={class:"world-map-route"},NJ=(0,r.pM)({__name:"WorldMapRoute",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,i.KR)(!1),a=(0,r.EW)(()=>{const e=n.onlineState,t="联机"===e?.模式&&!!e?.房间ID;return console.log("[WorldMapRoute] isOnlineTraveling:",t,{模式:e?.模式,房间ID:e?.房间ID}),t});return(e,n)=>((0,r.uX)(),(0,r.CE)("div",zJ,[(0,r.Q3)(" 默认显示图形地图，可切换到文字模式 "),t.value?((0,r.uX)(),(0,r.Wv)(DJ,{key:1,onToggleGraphicMode:n[1]||(n[1]=e=>t.value=!1)})):((0,r.uX)(),(0,r.Wv)(qY,{key:0,"is-online":a.value,onToggleTextMode:n[0]||(n[0]=e=>t.value=!0)},null,8,["is-online"]))]))}});var $J=t(7951),OJ={};OJ.styleTagTransform=A(),OJ.setAttributes=k(),OJ.insert=y().bind(null,"head"),OJ.domAPI=g(),OJ.insertStyleElement=_(),h()($J.A,OJ),$J.A&&$J.A.locals&&$J.A.locals;const FJ=(0,E.A)(NJ,[["__scopeId","data-v-7e14997c"]]),jJ={class:"event-panel"},BJ={class:"event-toolbar"},XJ={class:"title"},UJ={class:"meta"},WJ={class:"toolbar-actions"},qJ={key:0,class:"config-section"},GJ={class:"config-group"},HJ={class:"config-item"},VJ={class:"toggle-switch"},QJ={class:"config-item"},KJ={class:"config-item"},YJ={class:"config-group"},JJ={class:"event-types-grid"},ZJ={class:"event-type-label"},eZ=["onUpdate:modelValue"],nZ={class:"event-type-name"},tZ={key:0,class:"config-item config-item-full"},aZ={class:"config-label"},rZ={class:"label-hint"},oZ={class:"config-group"},iZ={class:"config-item config-item-full"},sZ={class:"config-group"},lZ={class:"group-title"},cZ={key:0,class:"empty-hint"},dZ={key:1,class:"custom-events-list"},uZ={class:"custom-event-header"},pZ={class:"custom-event-checkbox"},vZ=["onUpdate:modelValue"],fZ={class:"custom-event-name"},hZ={class:"custom-event-actions"},mZ=["onClick"],gZ=["onClick"],bZ={class:"custom-event-info"},yZ={class:"custom-event-type"},xZ={class:"custom-event-level"},kZ={class:"modal-content"},wZ={class:"modal-header"},_Z={class:"modal-body"},CZ={class:"form-item"},AZ={class:"form-item"},SZ={class:"form-item"},LZ={class:"form-item"},EZ={class:"event-list"},TZ={key:0,class:"empty-state"},IZ={key:1,class:"events"},RZ={class:"event-header"},MZ={class:"event-type"},PZ={class:"event-name"},DZ={class:"event-time"},zZ={class:"event-actions"},NZ=["onClick"],$Z={class:"event-meta"},OZ={key:1,class:"meta-tag scope"},FZ={key:2,class:"meta-tag source"},jZ={key:0,class:"event-relations"},BZ={key:0,class:"relation-group"},XZ={key:1,class:"relation-group"},UZ={class:"event-desc"},WZ=(0,r.pM)({__name:"EventPanel",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)(!1),l=(0,i.KR)(!1),c=(0,i.KR)(null),d=(0,r.EW)(()=>n.eventSystem),u=(0,r.EW)(()=>[...d.value?.事件记录||[]].slice().reverse()),p=(0,r.EW)(()=>{const e=d.value?.下次事件时间;return e?y(e):""}),v=(0,i.Kh)({enabled:!0,minMonths:1,maxMonths:10,prompt:"",eventTypes:{异常地带:!0,突变生物:!0,资源争夺:!0,庇护所危机:!0,觉醒者风波:!0,势力冲突:!0,古老实体:!0,世界变革:!0,特殊NPC:!0},specialNpcProbability:20,customEvents:[]}),f=(0,i.Kh)({名称:"",类型:"世界变革",描述模板:"",影响等级:"中等"}),h=async()=>{try{if(d.value?.配置){const e=d.value.配置;e.启用随机事件=v.enabled,e.最小间隔月=Math.max(1,Math.floor(v.minMonths)),e.最大间隔月=Math.max(e.最小间隔月,Math.floor(v.maxMonths)),e.事件提示词=v.prompt||"",e.启用事件类型||(e.启用事件类型={}),Object.keys(v.eventTypes).forEach(n=>{e.启用事件类型[n]=v.eventTypes[n]}),e.特殊NPC概率=v.specialNpcProbability,e.自定义事件=v.customEvents.map(e=>({...e})),await t.saveCurrentGame(),_e.o.success("事件配置已保存")}}catch(e){console.error("保存事件配置失败:",e),_e.o.error("保存配置失败，请重试")}},m=()=>{l.value=!1,c.value=null,f.名称="",f.类型="世界变革",f.描述模板="",f.影响等级="中等"},g=async()=>{if(!f.名称.trim())return void _e.o.error("请输入事件名称");if(!f.描述模板.trim())return void _e.o.error("请输入事件描述模板");const e={id:null!==c.value?v.customEvents[c.value].id:`custom_${Date.now()}`,名称:f.名称.trim(),类型:f.类型,描述模板:f.描述模板.trim(),影响等级:f.影响等级,启用:!0};null!==c.value?(v.customEvents[c.value]=e,_e.o.success("已更新自定义事件")):(v.customEvents.push(e),_e.o.success("已添加自定义事件")),await h(),m()},b=async()=>{try{const e=n.gameTime;if(!e)return void _e.o.error("无法获取当前游戏时间");const a=Math.max(1,Math.floor(v.minMonths)),r=Math.max(a,Math.floor(v.maxMonths)),o=Math.floor(Math.random()*(r-a+1))+a,i=(0,xp.l)({年:e.年,月:e.月+o,日:e.日,小时:e.小时,分钟:e.分钟});n.updateState("eventSystem.下次事件时间",i),await t.saveCurrentGame(),_e.o.success("已重新抽取下次世界事件时间")}catch(e){console.error("重置下次事件失败:",e),_e.o.error("重置失败，请重试")}};function y(e){const n=String(e.小时??0).padStart(2,"0"),t=String(e.分钟??0).padStart(2,"0");return`${e.年}年${e.月}月${e.日}日 ${n}:${t}`}return(0,r.sV)(()=>{(()=>{if(d.value?.配置){const e=d.value.配置;v.enabled=!1!==e.启用随机事件;const n=e.最小间隔月??("number"==typeof e.最小间隔年?12*e.最小间隔年:1),t=e.最大间隔月??("number"==typeof e.最大间隔年?12*e.最大间隔年:10);v.minMonths=Number(n),v.maxMonths=Number(Math.max(v.minMonths,t)),v.prompt=String(e.事件提示词??""),e.启用事件类型&&Object.keys(v.eventTypes).forEach(n=>{n in e.启用事件类型&&(v.eventTypes[n]=!1!==e.启用事件类型[n])}),v.specialNpcProbability=Number(e.特殊NPC概率??20),v.customEvents=(e.自定义事件||[]).map(e=>({...e}))}})()}),(e,i)=>((0,r.uX)(),(0,r.CE)("div",jJ,[(0,r.Lk)("div",BJ,[(0,r.Lk)("div",XJ,[i[11]||(i[11]=(0,r.Lk)("span",{class:"title-text"},"世界事件",-1)),(0,r.Lk)("span",UJ,"· 下次事件："+(0,o.v_)(p.value||"未卜"),1)]),(0,r.Lk)("div",WJ,[(0,r.Lk)("button",{class:"tool-btn subtle",onClick:b},(0,o.v_)(p.value?"重新抽取":"抽取"),1),(0,r.Lk)("button",{class:"tool-btn",onClick:i[0]||(i[0]=e=>a.value=!a.value)},(0,o.v_)(a.value?"隐藏配置":"事件配置"),1)])]),(0,r.Q3)(" 配置区域 "),a.value?((0,r.uX)(),(0,r.CE)("div",qJ,[(0,r.Q3)(" 基础配置 "),(0,r.Lk)("div",GJ,[i[16]||(i[16]=(0,r.Lk)("div",{class:"group-title"},"基础设置",-1)),(0,r.Lk)("div",HJ,[i[13]||(i[13]=(0,r.Lk)("div",{class:"config-label"},[(0,r.Lk)("span",{class:"label-text"},"启用世界事件"),(0,r.Lk)("span",{class:"label-hint"},"游戏时间推进时自动发生影响世界的事件")],-1)),(0,r.Lk)("label",VJ,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":i[1]||(i[1]=e=>v.enabled=e),onChange:h},null,544),[[s.lH,v.enabled]]),i[12]||(i[12]=(0,r.Lk)("span",{class:"toggle-slider"},null,-1))])]),(0,r.Lk)("div",QJ,[i[14]||(i[14]=(0,r.Lk)("div",{class:"config-label"},[(0,r.Lk)("span",{class:"label-text"},"事件间隔（最小）"),(0,r.Lk)("span",{class:"label-hint"},"随机事件最短间隔（月）")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",class:"config-input",min:"1",step:"1","onUpdate:modelValue":i[2]||(i[2]=e=>v.minMonths=e),onChange:h},null,544),[[s.Jo,v.minMonths,void 0,{number:!0}]])]),(0,r.Lk)("div",KJ,[i[15]||(i[15]=(0,r.Lk)("div",{class:"config-label"},[(0,r.Lk)("span",{class:"label-text"},"事件间隔（最大）"),(0,r.Lk)("span",{class:"label-hint"},"随机事件最长间隔（月）")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",class:"config-input",min:"1",step:"1","onUpdate:modelValue":i[3]||(i[3]=e=>v.maxMonths=e),onChange:h},null,544),[[s.Jo,v.maxMonths,void 0,{number:!0}]])])]),(0,r.Q3)(" 事件类型开关 "),(0,r.Lk)("div",YJ,[i[18]||(i[18]=(0,r.Lk)("div",{class:"group-title"},"事件类型",-1)),(0,r.Lk)("div",JJ,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.eventTypes,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"event-type-item"},[(0,r.Lk)("label",ZJ,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>v.eventTypes[n]=e,onChange:h},null,40,eZ),[[s.lH,v.eventTypes[n]]]),(0,r.Lk)("span",nZ,(0,o.v_)(n),1)])]))),128))]),(0,r.Q3)(" 特殊NPC概率 "),v.eventTypes["特殊NPC"]?((0,r.uX)(),(0,r.CE)("div",tZ,[(0,r.Lk)("div",aZ,[i[17]||(i[17]=(0,r.Lk)("span",{class:"label-text"},"特殊NPC触发概率",-1)),(0,r.Lk)("span",rZ,"当触发事件时，有此概率生成特殊NPC登场事件（"+(0,o.v_)(v.specialNpcProbability)+"%）",1)]),(0,r.bo)((0,r.Lk)("input",{type:"range",class:"config-slider",min:"0",max:"100",step:"5","onUpdate:modelValue":i[4]||(i[4]=e=>v.specialNpcProbability=e),onChange:h},null,544),[[s.Jo,v.specialNpcProbability,void 0,{number:!0}]])])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 自定义提示词 "),(0,r.Lk)("div",oZ,[i[20]||(i[20]=(0,r.Lk)("div",{class:"group-title"},"自定义提示词",-1)),(0,r.Lk)("div",iZ,[i[19]||(i[19]=(0,r.Lk)("div",{class:"config-label"},[(0,r.Lk)("span",{class:"label-hint"},"为世界事件生成添加自定义指令（可选）")],-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":i[5]||(i[5]=e=>v.prompt=e),class:"config-textarea",placeholder:"例如：更偏向异常地带扩张、突变生物袭击、庇护所危机、好友遭遇，并尽量让事件影响玩家...",rows:"3",onChange:h},null,544),[[s.Jo,v.prompt]])])]),(0,r.Q3)(" 自定义事件模板 "),(0,r.Lk)("div",sZ,[(0,r.Lk)("div",lZ,[i[21]||(i[21]=(0,r.eW)(" 自定义事件模板 ",-1)),(0,r.Lk)("button",{class:"add-btn",onClick:i[6]||(i[6]=e=>l.value=!0)},"+ 添加")]),0===v.customEvents.length?((0,r.uX)(),(0,r.CE)("div",cZ,' 暂无自定义事件，点击"添加"创建 ')):((0,r.uX)(),(0,r.CE)("div",dZ,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.customEvents,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"custom-event-item"},[(0,r.Lk)("div",uZ,[(0,r.Lk)("label",pZ,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":n=>e.启用=n,onChange:h},null,40,vZ),[[s.lH,e.启用]]),(0,r.Lk)("span",fZ,(0,o.v_)(e.名称),1)]),(0,r.Lk)("div",hZ,[(0,r.Lk)("button",{class:"icon-btn",onClick:e=>(e=>{const n=v.customEvents[e];f.名称=n.名称,f.类型=n.类型,f.描述模板=n.描述模板,f.影响等级=n.影响等级,c.value=e})(n),title:"编辑"},"✏️",8,mZ),(0,r.Lk)("button",{class:"icon-btn",onClick:e=>(async e=>{confirm("确定要删除这个自定义事件吗？")&&(v.customEvents.splice(e,1),await h(),_e.o.success("已删除自定义事件"))})(n),title:"删除"},"🗑️",8,gZ)])]),(0,r.Lk)("div",bZ,[(0,r.Lk)("span",yZ,(0,o.v_)(e.类型),1),(0,r.Lk)("span",xZ,(0,o.v_)(e.影响等级),1)])]))),128))]))]),(0,r.Lk)("div",{class:"config-actions"},[(0,r.Lk)("button",{class:"action-btn",onClick:b}," 重新抽取下次事件时间 ")])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 自定义事件编辑弹窗 "),l.value||null!==c.value?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"modal-overlay",onClick:(0,s.D$)(m,["self"])},[(0,r.Lk)("div",kZ,[(0,r.Lk)("div",wZ,[(0,r.Lk)("h3",null,(0,o.v_)(null!==c.value?"编辑":"添加")+"自定义事件",1),(0,r.Lk)("button",{class:"close-btn",onClick:m},"✕")]),(0,r.Lk)("div",_Z,[(0,r.Lk)("div",CZ,[i[22]||(i[22]=(0,r.Lk)("label",null,"事件名称",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":i[7]||(i[7]=e=>f.名称=e),type:"text",placeholder:"例如：神秘宝藏现世"},null,512),[[s.Jo,f.名称]])]),(0,r.Lk)("div",AZ,[i[24]||(i[24]=(0,r.Lk)("label",null,"事件类型",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":i[8]||(i[8]=e=>f.类型=e)},i[23]||(i[23]=[(0,r.Fv)('<option value="异常地带" data-v-751578b8>异常地带</option><option value="突变生物" data-v-751578b8>突变生物</option><option value="资源争夺" data-v-751578b8>资源争夺</option><option value="庇护所危机" data-v-751578b8>庇护所危机</option><option value="觉醒者风波" data-v-751578b8>觉醒者风波</option><option value="势力冲突" data-v-751578b8>势力冲突</option><option value="古老实体" data-v-751578b8>古老实体</option><option value="世界变革" data-v-751578b8>世界变革</option>',8)]),512),[[s.u1,f.类型]])]),(0,r.Lk)("div",SZ,[i[26]||(i[26]=(0,r.Lk)("label",null,"影响等级",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":i[9]||(i[9]=e=>f.影响等级=e)},i[25]||(i[25]=[(0,r.Lk)("option",{value:"轻微"},"轻微",-1),(0,r.Lk)("option",{value:"中等"},"中等",-1),(0,r.Lk)("option",{value:"重大"},"重大",-1),(0,r.Lk)("option",{value:"灾难"},"灾难",-1)]),512),[[s.u1,f.影响等级]])]),(0,r.Lk)("div",LZ,[i[27]||(i[27]=(0,r.Lk)("label",null,"事件描述模板",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":i[10]||(i[10]=e=>f.描述模板=e),placeholder:"支持占位符：{玩家名}、{位置}、{觉醒阶段}\n例如：{玩家名}在{位置}遭遇异常地带扩张，庇护所陷入危机...",rows:"4"},null,512),[[s.Jo,f.描述模板]])])]),(0,r.Lk)("div",{class:"modal-footer"},[(0,r.Lk)("button",{class:"cancel-btn",onClick:m},"取消"),(0,r.Lk)("button",{class:"confirm-btn",onClick:g},"保存")])])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",EZ,[0===u.value.length?((0,r.uX)(),(0,r.CE)("div",TZ,i[28]||(i[28]=[(0,r.Lk)("div",{class:"empty-title"},"暂无事件记录",-1),(0,r.Lk)("div",{class:"empty-hint"},"事件会随游戏时间推进自动发生。",-1)]))):((0,r.uX)(),(0,r.CE)("div",IZ,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.事件ID,class:"event-item"},[(0,r.Lk)("div",RZ,[(0,r.Lk)("span",MZ,(0,o.v_)(e.事件类型),1),(0,r.Lk)("span",PZ,(0,o.v_)(e.事件名称),1),(0,r.Lk)("span",DZ,(0,o.v_)(y(e.发生时间)),1),(0,r.Lk)("div",zZ,[(0,r.Lk)("button",{class:"icon-btn event-delete-btn",title:"删除",onClick:a=>(async e=>{try{const a=d.value?.事件记录||[],r=a.findIndex(n=>n.事件ID===e);if(-1===r)return;const o=a[r];if(!confirm(`确定要删除这条事件记录吗？\n\n【${o.事件类型}】${o.事件名称}`))return;const i=[...a];i.splice(r,1),n.updateState("eventSystem.事件记录",i),await t.saveCurrentGame(),_e.o.success("已删除事件记录")}catch(e){console.error("删除事件记录失败:",e),_e.o.error("删除失败，请重试")}})(e.事件ID)},"🗑️",8,NZ)])]),(0,r.Q3)(" 事件元信息 "),(0,r.Lk)("div",$Z,[e.影响等级?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,o.C4)(["meta-tag","level-"+e.影响等级])},(0,o.v_)(e.影响等级),3)):(0,r.Q3)("v-if",!0),e.影响范围?((0,r.uX)(),(0,r.CE)("span",OZ,(0,o.v_)(e.影响范围),1)):(0,r.Q3)("v-if",!0),e.事件来源?((0,r.uX)(),(0,r.CE)("span",FZ,(0,o.v_)(e.事件来源),1)):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 相关人物/势力 "),e.相关人物&&e.相关人物.length||e.相关势力&&e.相关势力.length?((0,r.uX)(),(0,r.CE)("div",jZ,[e.相关人物&&e.相关人物.length?((0,r.uX)(),(0,r.CE)("span",BZ,[i[29]||(i[29]=(0,r.Lk)("span",{class:"relation-label"},"相关人物:",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.相关人物,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:n,class:"relation-item person"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0),e.相关势力&&e.相关势力.length?((0,r.uX)(),(0,r.CE)("span",XZ,[i[30]||(i[30]=(0,r.Lk)("span",{class:"relation-label"},"相关势力:",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.相关势力,(e,n)=>((0,r.uX)(),(0,r.CE)("span",{key:n,class:"relation-item faction"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",UZ,(0,o.v_)(e.事件描述),1)]))),128))]))])]))}});var qZ=t(2094),GZ={};GZ.styleTagTransform=A(),GZ.setAttributes=k(),GZ.insert=y().bind(null,"head"),GZ.domAPI=g(),GZ.insertStyleElement=_(),h()(qZ.A,GZ),qZ.A&&qZ.A.locals&&qZ.A.locals;const HZ=(0,E.A)(WZ,[["__scopeId","data-v-751578b8"]]),VZ=["破损","粗糙","普通","精良","稀有","史诗","传说"];function QZ(e,n,t){return Math.max(n,Math.min(t,Math.round(e)))}function KZ(e){const n=e.rng??Math.random,t=e.materials.filter(Boolean),a=function(e){const n=e.filter(Boolean);return 0===n.length?0:n.reduce((e,n)=>e+function(e){const n=e.品质?.quality??"普通",t=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const n=Number(e);return Number.isFinite(n)?n:0}return 0}(e.品质?.grade);return Math.max(1,VZ.indexOf(n)+1)+Math.max(0,Math.min(10,t))/10}(n),0)/n.length}(t),r=e.innate,o=e.post??null,i=Number(r.意志??0),s=Number(r.敏捷??0),l=Number(o?.意志??0),c=Number(o?.敏捷??0),d=Number(e.options.overrideSuccessRate),u=Number.isFinite(d);let p=u?d:22;u||(p+=2*i+1.5*s),p+=.8*(l+c),p+=6*Math.max(0,a-1),p+=1.5*(t.length-1),p=Math.max(5,Math.min(95,Math.round(p)));const v=100*n()<=p,f=a>0?Math.max(1,Math.min(7,Math.round(a))):1,h=Math.max(1,Math.min(7,f+(v?0:-2))),m=QZ(p/100*10,1,10),g=QZ(4*(n()-.5),-2,2),b=QZ(m+g+(v?0:-5),0,10);return{successRate:p,success:v,resultQuality:{quality:v?VZ[h-1]??"普通":"破损",grade:QZ(v?b:0,0,10)},materialQualityScore:a}}const YZ={破损:{color:"#666666",rarity:"几近报废的垃圾，几乎没有使用价值。"},粗糙:{color:"#808080",rarity:"简陋的拼凑物或磨损严重的旧物，勉强能用。"},普通:{color:"#FFFFFF",rarity:"标准工业制品或合格手工制品，功能正常。"},精良:{color:"#00CED1",rarity:"工艺精良或材质特殊，性能优于普通物品。"},稀有:{color:"#9932CC",rarity:"具备特殊功能或强大属性，是废土强者的标配。"},史诗:{color:"#FFD700",rarity:"顶尖实验室或突变生物核心产出的装备，极其罕见。"},传说:{color:"#FF0000",rarity:"旧时代终极科技或高维存在遗物，拥有扭转战局的力量。"}};function JZ(){return`\n## 物品品质系统 (混沌纪元)\n采用双维度：品质等级 与 品级\n\n### 品质等级（从低到高，仅限以下取值）\n- 破损: ${YZ.破损.rarity}\n- 粗糙: ${YZ.粗糙.rarity}\n- 普通: ${YZ.普通.rarity}\n- 精良: ${YZ.精良.rarity}\n- 稀有: ${YZ.稀有.rarity}\n- 史诗: ${YZ.史诗.rarity}\n- 传说: ${YZ.传说.rarity}\n\n### 品级（0-10，表示完美程度）\n- 残缺 (0): 破损不堪，效果大减\n- 下级 (1-3): 品质一般，淡色光效\n- 中级 (4-6): 品质中等，中等光效\n- 上级 (7-9): 品质上乘，强烈光效\n- 顶级 (10): 完美无瑕，炫目特效\n\n### 属性与价值（速查）\n| 品质等级 | 属性修正 | 耐久系数 | 特殊能力概率 | 价值倍数 |\n|----------|----------|----------|--------------|----------|\n| 破损     | -30%     | 0.3      | 0%           | 0.1-0.3  |\n| 粗糙     | -10%     | 0.5      | 0%           | 0.4-0.7  |\n| 普通     | ±0%      | 1.0      | 0-5%         | 1.0      |\n| 精良     | +10-30%  | 1.5      | 10-20%       | 2-5      |\n| 稀有     | +30-50%  | 2.0      | 30-50%       | 5-20     |\n| 史诗     | +50-80%  | 3.0      | 60-80%       | 20-100   |\n| 传说     | +80-150% | 5.0      | 90-100%      | 100-1000 |\n`.trim()}const ZZ={class:"crafting-panel"},e0={class:"toolbar"},n0={class:"title"},t0={class:"meta"},a0={class:"toolbar-actions"},r0={class:"simulation-toggle",title:"开启后：点击开始制作会先进行推演并弹窗确认"},o0={class:"toggle-switch"},i0={class:"content"},s0={class:"crafting-area"},l0={class:"craft-grid","aria-label":"制作槽位"},c0=["onClick"],d0={class:"slot-item"},u0={class:"slot-item-meta"},p0={class:"meta-pill"},v0={class:"meta-pill"},f0=["onClick"],h0={key:1,class:"slot-empty"},m0={class:"slot-index"},g0=["onClick"],b0={class:"slot-item"},y0={class:"slot-item-meta"},x0={class:"meta-pill"},k0={class:"meta-pill"},w0=["onClick"],_0={key:1,class:"slot-empty"},C0={class:"slot-index"},A0={class:"furnace-cell","aria-label":"制作炉"},S0={class:"furnace-icon"},L0=["onClick"],E0={class:"slot-item"},T0={class:"slot-item-meta"},I0={class:"meta-pill"},R0={class:"meta-pill"},M0=["onClick"],P0={key:1,class:"slot-empty"},D0={class:"slot-index"},z0={class:"actions"},N0=["disabled"],$0={key:0},O0={key:1},F0=["disabled"],j0={class:"materials-area"},B0={class:"materials-header"},X0={class:"materials-tools"},U0={key:0,class:"materials-empty"},W0={key:1,class:"materials-list"},q0=["onClick"],G0={class:"material-main"},H0={class:"material-name"},V0={class:"material-meta"},Q0={class:"meta-pill"},K0={class:"meta-pill"},Y0={class:"material-right"},J0={class:"count"},Z0={key:2,class:"pagination"},e1=["disabled"],n1=["disabled"],t1={class:"page-info"},a1={class:"total-count"},r1=["disabled"],o1=["disabled"],i1={class:"modal"},s1={class:"modal-header"},l1={class:"modal-title"},c1={class:"modal-body"},d1={key:0,class:"result-summary"},u1={class:"summary-row"},p1={class:"v"},v1={class:"summary-row"},f1={class:"v"},h1={key:0,class:"summary-row"},m1={class:"v summary-desc"},g1={class:"narrative"},b1={class:"narrative-text"},y1={class:"modal"},x1={class:"modal-header"},k1={class:"modal-body"},w1={class:"result-summary"},_1={class:"summary-row"},C1={class:"v"},A1={key:0,class:"summary-row"},S1={class:"v"},L1={key:1,class:"summary-row"},E1={class:"v summary-desc"},T1=(0,r.pM)({__name:"CraftingPanel",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)("制药"),l=(0,i.KR)(""),c=(0,i.KR)(1),d=(0,i.KR)(1),u=(0,i.KR)([{slotId:1,itemId:null},{slotId:2,itemId:null},{slotId:3,itemId:null},{slotId:4,itemId:null},{slotId:5,itemId:null}]),p=(0,i.KR)(!1),v=(0,i.KR)(!1),f=(0,i.KR)(null),h=(0,i.KR)(null),m=(0,i.KR)(""),g=(0,i.KR)(!0),b=(0,i.KR)(!1),y=(0,i.KR)(!1),x=(0,i.KR)(null),k=(0,r.EW)(()=>n.inventory?.物品||{}),w=(0,r.EW)(()=>u.value.map(e=>e.itemId?k.value[e.itemId]:null).filter(e=>!!e).filter(e=>_(e))),_=e=>!e.已装备&&("物品"===e.类型||"突变结晶"===e.类型),C=(0,r.EW)(()=>Object.values(k.value).filter(e=>_(e)&&e.数量>0)),A=(0,r.EW)(()=>{const e=l.value.trim(),n=C.value;return e?n.filter(n=>n.名称.includes(e)):n}),S=(0,r.EW)(()=>A.value.length),L=(0,r.EW)(()=>Math.max(1,Math.ceil(S.value/6))),E=(0,r.EW)(()=>{const e=6*(c.value-1),n=e+6;return A.value.slice(e,n)});(0,r.wB)(l,()=>{c.value=1}),(0,r.wB)([S,L],()=>{S.value<=0?c.value=1:(c.value>L.value&&(c.value=L.value),c.value<1&&(c.value=1))});const T=(0,r.EW)(()=>w.value.length>0),I=((0,r.EW)(()=>{const e=x.value?.successRate??0;return e>=75?"high":e>=45?"mid":"low"}),e=>"string"==typeof e?e:0===e?"残缺":e>=1&&e<=3?"下级":e>=4&&e<=6?"中级":e>=7&&e<=9?"上级":10===e?"顶级":"未知"),R=e=>`q-${e?.品质?.quality??"凡"}`,M=e=>{const n=u.value.find(n=>n.slotId===e);n&&(n.itemId=null)},P=()=>{u.value=u.value.map(e=>({...e,itemId:null})),d.value=1,z()},D=()=>{v.value=!1},z=()=>{x.value=null,b.value=!1,y.value=!1};(0,r.wB)([a,u],()=>{g.value&&z()},{deep:!0});const N=()=>{b.value=!1,y.value=!1},$=async()=>{if(b.value=!1,y.value=!0,!p.value){p.value=!0;try{await F()}finally{p.value=!1}}},O=async()=>{if(!p.value)if(n.character?.先天属性)if(n.attributes)if(T.value){p.value=!0;try{const n=new Map;for(const e of u.value)e.itemId&&n.set(e.itemId,(n.get(e.itemId)??0)+1);for(const[e,t]of n.entries()){const n=k.value[e];if(!n)throw new Error(`背包中不存在物品: ${e}`);if(n.已装备)throw new Error(`物品已装备，无法作为材料: ${n.名称}`);if("物品"!==n.类型&&"突变结晶"!==n.类型)throw new Error(`不是材料，无法用于制作：${n.名称}`);if((n.数量??0)<t)throw new Error(`物品数量不足: ${n.名称}`)}const t=w.value.map(e=>({名称:e.名称,类型:e.类型,品质:{quality:e.品质?.quality??"凡",grade:Number(e.品质?.grade??0)},描述:e.描述}));if(g.value&&!y.value){const{systemPrompt:n,userPrompt:r}=(e={type:a.value,materials:t,characterSnapshot:j()},{systemPrompt:`\n你是"混沌纪元制作推演器"。你需要根据材料与角色信息（可选）推演纯手工制作的成功率与预期品质。\n\n硬性规则：\n1) 只输出一个 JSON 对象，禁止输出 Markdown、代码块、解释文字、前后缀。\n2) successRate 必须是 5-95 的整数。\n3) predictedQuality 必须符合物品品质体系：quality 只能是 破损/粗糙/普通/精良/稀有/史诗/传说，grade 只能是 0-10 的整数。\n4) 这是"推演"，不是最终结果：不要输出成品物品，不要输出战斗/剧情延伸。\n5) 禁止出现"能量/精神/阵法/法阵/灵气/修仙"等非混沌纪元手工制作元素。\n\n## 【阶段影响】（非硬性上限）\n觉醒阶段越高通常意味着更高成功率与更优品质，但不得突破材料与工艺门槛。\n\n## 【制作技艺熟练度】限制\n无对应制作技艺（药剂学/装备制造等）或技艺等级过低时：\n- 入门：成功率极低(5-15%)，最高普通下级\n- 略有所得：成功率低(15-30%)，最高普通中级\n- 小有成就：成功率一般(30-50%)，可尝试精良\n- 登堂入室：成功率中等(40-60%)，精良稳定\n- 融会贯通及以上：可尝试稀有及以上，但仍受材料与工艺上限限制\n\n## 【材料品质】限制\n成品品质不可能超过主材料品质，且通常会略低于主材料。\n\n输出 JSON 结构：\n{\n  "successRate": number,\n  "predictedQuality": { "quality": "破损|粗糙|普通|精良|稀有|史诗|传说", "grade": 0-10 },\n  "analysis": "string（简短推演依据，1-3句）",\n  "warnings": ["string"...]\n}\n\n${JZ()}\n`.trim(),userPrompt:`\n请推演一次制作（JSON 输出）。\n\n制作类型：${e.type}\n\n材料清单：\n${JSON.stringify(e.materials,null,2)}\n\n角色信息（可能为空）：\n${JSON.stringify(e.characterSnapshot??{},null,2)}\n  `.trim()});try{const e=B(await(0,ar.e)(r,n,!1,"crafting")),t=Number(e?.successRate);if(!Number.isFinite(t))throw new Error("推演输出缺少 successRate");return x.value={successRate:Math.max(5,Math.min(95,Math.round(t))),predictedQuality:e?.predictedQuality,analysis:"string"==typeof e?.analysis?e.analysis:"",warnings:Array.isArray(e?.warnings)?e.warnings.map(String):[]},void(b.value=!0)}catch(e){console.warn("[Crafting] 推演失败，将直接进入制作",e),z()}}await F(n,t)}catch(e){console.error(e),_e.o.error(e instanceof Error?e.message:"制作失败：发生异常")}finally{p.value=!1}var e}else _e.o.error("请先放入材料");else _e.o.error("角色属性未就绪，无法制作");else _e.o.error("角色数据未就绪，无法制作")},F=async(e,r)=>{const o=r??w.value.map(e=>({名称:e.名称,类型:e.类型,品质:{quality:e.品质?.quality??"凡",grade:Number(e.品质?.grade??0)},描述:e.描述})),i=y.value?Number(x.value?.successRate):void 0,s=KZ({materials:w.value,innate:n.character?.先天属性??{},post:n.character?.后天属性??{},options:{type:a.value,overrideSuccessRate:Number.isFinite(i)?i:void 0}}),l=s.success,c=s.successRate,d=s.resultQuality,{systemPrompt:p,userPrompt:g}=(b={type:a.value,successRate:c,success:l,resultQuality:d,materials:o},{systemPrompt:`\n你是"混沌纪元制作文案生成器"。你的任务是：根据给定的材料/成功率/结果品质，生成纯手工制作过程描写与成品描述。\n\n硬性规则：\n1) 只输出一个 JSON 对象，禁止输出 Markdown、代码块、解释文字、前后缀。\n2) 仅使用输入的材料与关键信息；可合理补全细节（加热/冷却/锤打/研磨/溶媒/滤纸/消毒/封装等纯手工步骤）。\n3) 必须严格遵守结果：success=false 表示失败（成品为次品/报废件/炉渣等），success=true 表示成功。\n4) 必须严格遵守物品品质体系：仅使用给定 resultQuality（quality 与 grade），不要自行更改。\n5) 禁止出现"能量/精神/阵法/法阵/灵气/修仙"等非混沌纪元手工制作元素。\n\n## 【阶段影响】（叙事可体现，不是硬性上限）\n觉醒阶段越高通常意味着更稳定的操作、更低的失误率，但不得突破材料与工艺门槛。\n\n## 【制作技艺熟练度】限制\n无对应制作技艺（药剂学/装备制造等）或技艺等级过低时：\n- 入门：文案应体现手法生疏、险象环生\n- 略有所得/小有成就：文案应体现尚在摸索、偶有失误\n- 登堂入室及以上：文案可体现从容不迫、技艺娴熟\n\n输出 JSON 结构：\n{\n  "processText": "string（制作过程描写，分段可用\\n）",\n  "itemName": "string（成品名称，失败时也要给出名称）",\n  "itemDesc": "string（成品描述，含品质与大致功效/缺陷，失败时突出副作用/无效）",\n  "eventDesc": "string（用于写入事件记录的描述，需包含材料清单与结果概要）"\n}\n\n${JZ()}\n`.trim(),userPrompt:`\n请生成一次制作文案（JSON 输出）。\n\n制作类型：${b.type}\n成功率：${b.successRate}%\n结果是否成功：${b.success?"成功":"失败"}\n结果品质：${b.resultQuality.quality}·${String(b.resultQuality.grade)}\n\n材料清单（仅可使用这些材料）：\n${JSON.stringify(b.materials,null,2)}\n  `.trim()});var b;const k=B(await(0,ar.e)(g,p,!1,"crafting")),_=n.gameTime??{年:0,月:0,日:0,小时:0,分钟:0},C=String(k?.processText??k?.process??"").trim()||"炉火翻卷，灵材于鼎中沉浮，气机收束，尘埃落定。",A=String(k?.eventDesc??"").trim(),S=`craft_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,L=l?"制药"===a.value?"物品":"装备":"物品",E=d.quality,T=Number(d.grade),R=String(k?.itemName??"").trim()||(l?"制药"===a.value?"药剂":"成品":"废品"),M={物品ID:S,名称:R,类型:L,品质:{quality:E,grade:T},数量:1,描述:String(k?.itemDesc??"").trim()||`品质：${E}·${I(T)}(${T})`,可叠加:"装备"!==L},D=n.inventory?.物品;if(!D)throw new Error("背包数据未加载");const N=e??(()=>{const e=new Map;for(const n of u.value)n.itemId&&e.set(n.itemId,(e.get(n.itemId)??0)+1);return e})();for(const[e,n]of N.entries()){const t=D[e];if(!t)throw new Error(`背包中不存在物品: ${e}`);if("物品"!==t.类型&&"突变结晶"!==t.类型)throw new Error(`不是材料，无法用于制作：${t.名称}`);if((t.数量??0)<n)throw new Error(`材料数量不足：${t.名称}`)}for(const[e,n]of N.entries()){const t=D[e],a=(t.数量??0)-n;a<=0?delete D[e]:D[e]={...t,数量:a}}D[S]=M;const $=o.map(e=>e.名称).join("、")||"（无）",O=[`材料：${$}`,`成功率：${c}%；结果：${l?"成功":"失败"}；品质：${E}·${I(T)}(${T})`,"",C].join("\n"),F=[...n.eventSystem?.事件记录||[],{事件ID:`event_craft_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,事件名称:`${a.value}：${R}`,事件类型:a.value,事件描述:A||O,事件来源:"系统",发生时间:_,影响等级:"轻微"}];n.updateState("eventSystem.事件记录",F),await t.saveCurrentGame(),f.value={successRate:c,success:l,resultQuality:{quality:E,grade:T},materialQualityScore:0},m.value=C,h.value=M,v.value=!0,z(),P()},j=()=>{const e=n.character,t=n.attributes;return{先天属性:e?.先天属性??{},后天属性:e?.后天属性??{},觉醒阶段:"string"==typeof t?.觉醒阶段?t.觉醒阶段:""}};function B(e){if(!e||"string"!=typeof e)return null;const n=e.trim(),t=X(n);if(t)return t;const a=n.match(/```(?:json)?\s*([\s\S]*?)(?:```|$)/i);if(a?.[1]){const e=X(a[1].trim());if(e)return e}const r=(0,cr.TK)(n);return r?X(r):null}function X(e){try{return JSON.parse(e)}catch{return null}}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",ZZ,[(0,r.Lk)("div",e0,[(0,r.Lk)("div",n0,[n[8]||(n[8]=(0,r.Lk)("span",{class:"title-text"},"制造工坊",-1)),(0,r.Lk)("span",t0,"· "+(0,o.v_)("制药"===a.value?"药炉":"工作台"),1)]),(0,r.Lk)("div",a0,[(0,r.Lk)("button",{class:(0,o.C4)(["mode-btn",{active:"制药"===a.value}]),onClick:n[0]||(n[0]=e=>a.value="制药")},[(0,r.bF)((0,i.R1)(YL),{size:14}),n[9]||(n[9]=(0,r.Lk)("span",null,"制药",-1))],2),(0,r.Lk)("button",{class:(0,o.C4)(["mode-btn",{active:"制造"===a.value}]),onClick:n[1]||(n[1]=e=>a.value="制造")},[(0,r.bF)((0,i.R1)(ep),{size:14}),n[10]||(n[10]=(0,r.Lk)("span",null,"制造",-1))],2),(0,r.Lk)("div",r0,[n[12]||(n[12]=(0,r.Lk)("span",{class:"toggle-text"},"成功率推演",-1)),(0,r.Lk)("label",o0,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=e=>g.value=e),onChange:z},null,544),[[s.lH,g.value]]),n[11]||(n[11]=(0,r.Lk)("span",{class:"toggle-slider"},null,-1))])])])]),(0,r.Lk)("div",i0,[(0,r.Lk)("div",s0,[(0,r.Lk)("div",l0,[(0,r.Q3)(" 第一行：1 2 3 "),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value.slice(0,3),e=>((0,r.uX)(),(0,r.CE)("button",{key:e.slotId,class:(0,o.C4)(["slot",{active:d.value===e.slotId,filled:!!e.itemId}]),onClick:n=>d.value=e.slotId},[e.itemId&&k.value[e.itemId]?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("div",d0,[(0,r.Lk)("div",{class:(0,o.C4)(["slot-item-name",R(k.value[e.itemId])])},(0,o.v_)(k.value[e.itemId].名称),3),(0,r.Lk)("div",u0,[(0,r.Lk)("span",p0,(0,o.v_)(k.value[e.itemId].类型),1),(0,r.Lk)("span",v0,(0,o.v_)(k.value[e.itemId].品质.quality)+"·"+(0,o.v_)(I(k.value[e.itemId].品质.grade))+" ("+(0,o.v_)(k.value[e.itemId].品质.grade)+") ",1)])]),(0,r.Lk)("button",{class:"slot-remove",title:"移除",onClick:(0,s.D$)(n=>M(e.slotId),["stop"])},[(0,r.bF)((0,i.R1)(ed.A),{size:14})],8,f0)],64)):((0,r.uX)(),(0,r.CE)("div",h0,[(0,r.Lk)("div",m0,(0,o.v_)(e.slotId),1),n[13]||(n[13]=(0,r.Lk)("div",{class:"slot-hint"},"放入材料",-1))]))],10,c0))),128)),(0,r.Q3)(" 第二行：4 炉 5 "),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value.slice(3,4),e=>((0,r.uX)(),(0,r.CE)("button",{key:e.slotId,class:(0,o.C4)(["slot",{active:d.value===e.slotId,filled:!!e.itemId}]),onClick:n=>d.value=e.slotId},[e.itemId&&k.value[e.itemId]?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("div",b0,[(0,r.Lk)("div",{class:(0,o.C4)(["slot-item-name",R(k.value[e.itemId])])},(0,o.v_)(k.value[e.itemId].名称),3),(0,r.Lk)("div",y0,[(0,r.Lk)("span",x0,(0,o.v_)(k.value[e.itemId].类型),1),(0,r.Lk)("span",k0,(0,o.v_)(k.value[e.itemId].品质.quality)+"·"+(0,o.v_)(I(k.value[e.itemId].品质.grade))+" ("+(0,o.v_)(k.value[e.itemId].品质.grade)+") ",1)])]),(0,r.Lk)("button",{class:"slot-remove",title:"移除",onClick:(0,s.D$)(n=>M(e.slotId),["stop"])},[(0,r.bF)((0,i.R1)(ed.A),{size:14})],8,w0)],64)):((0,r.uX)(),(0,r.CE)("div",_0,[(0,r.Lk)("div",C0,(0,o.v_)(e.slotId),1),n[14]||(n[14]=(0,r.Lk)("div",{class:"slot-hint"},"放入材料",-1))]))],10,g0))),128)),(0,r.Lk)("div",A0,[(0,r.Lk)("div",S0,[((0,r.uX)(),(0,r.Wv)((0,r.$y)("制药"===a.value?(0,i.R1)(YL):(0,i.R1)(ep)),{size:24}))])]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value.slice(4,5),e=>((0,r.uX)(),(0,r.CE)("button",{key:e.slotId,class:(0,o.C4)(["slot",{active:d.value===e.slotId,filled:!!e.itemId}]),onClick:n=>d.value=e.slotId},[e.itemId&&k.value[e.itemId]?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("div",E0,[(0,r.Lk)("div",{class:(0,o.C4)(["slot-item-name",R(k.value[e.itemId])])},(0,o.v_)(k.value[e.itemId].名称),3),(0,r.Lk)("div",T0,[(0,r.Lk)("span",I0,(0,o.v_)(k.value[e.itemId].类型),1),(0,r.Lk)("span",R0,(0,o.v_)(k.value[e.itemId].品质.quality)+"·"+(0,o.v_)(I(k.value[e.itemId].品质.grade))+" ("+(0,o.v_)(k.value[e.itemId].品质.grade)+") ",1)])]),(0,r.Lk)("button",{class:"slot-remove",title:"移除",onClick:(0,s.D$)(n=>M(e.slotId),["stop"])},[(0,r.bF)((0,i.R1)(ed.A),{size:14})],8,M0)],64)):((0,r.uX)(),(0,r.CE)("div",P0,[(0,r.Lk)("div",D0,(0,o.v_)(e.slotId),1),n[15]||(n[15]=(0,r.Lk)("div",{class:"slot-hint"},"放入材料",-1))]))],10,L0))),128))]),n[16]||(n[16]=(0,r.Lk)("div",{class:"options"},null,-1)),(0,r.Lk)("div",z0,[(0,r.Lk)("button",{class:"primary-btn",disabled:!T.value||p.value,onClick:O},[p.value?((0,r.uX)(),(0,r.CE)("span",$0,(0,o.v_)(g.value&&!y.value?"推演中...":"制作中..."),1)):((0,r.uX)(),(0,r.CE)("span",O0,"开始"+(0,o.v_)(a.value),1))],8,N0),(0,r.Lk)("button",{class:"secondary-btn",disabled:p.value,onClick:P},"清空材料",8,F0)])]),(0,r.Lk)("div",j0,[(0,r.Lk)("div",B0,[n[17]||(n[17]=(0,r.Lk)("div",{class:"materials-title"},"可用材料",-1)),(0,r.Lk)("div",X0,[(0,r.bF)((0,i.R1)(qc),{size:14,class:"search-icon"}),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>l.value=e),class:"search",type:"text",placeholder:"搜索名称..."},null,512),[[s.Jo,l.value]])])]),0===S.value?((0,r.uX)(),(0,r.CE)("div",U0,n[18]||(n[18]=[(0,r.Lk)("div",{class:"empty-title"},"暂无可用材料",-1),(0,r.Lk)("div",{class:"empty-hint"}," 需要【材料】 ",-1)]))):((0,r.uX)(),(0,r.CE)("div",W0,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(E.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.物品ID,class:(0,o.C4)(["material",R(e)]),onClick:n=>(e=>{const n=(t=e.物品ID,u.value.filter(e=>e.itemId===t).length);var t;if(n>=(e.数量||0))return void _e.o.error("该物品数量不足");const a=d.value,r=u.value.find(e=>e.slotId===a);if(r&&!r.itemId)return void(r.itemId=e.物品ID);const o=u.value.find(e=>!e.itemId);o?(o.itemId=e.物品ID,d.value=o.slotId):_e.o.error("材料槽已满")})(e)},[(0,r.Lk)("div",G0,[(0,r.Lk)("div",H0,(0,o.v_)(e.名称),1),(0,r.Lk)("div",V0,[(0,r.Lk)("span",Q0,(0,o.v_)(e.类型),1),(0,r.Lk)("span",K0,(0,o.v_)(e.品质.quality)+"·"+(0,o.v_)(I(e.品质.grade))+"("+(0,o.v_)(e.品质.grade)+") ",1)])]),(0,r.Lk)("div",Y0,[(0,r.Lk)("span",J0,"×"+(0,o.v_)(e.数量),1),(0,r.bF)((0,i.R1)(lj.A),{size:14,class:"add-icon"})])],10,q0))),128))])),(0,r.Q3)(" 分页控件 "),L.value>1?((0,r.uX)(),(0,r.CE)("div",Z0,[(0,r.Lk)("button",{class:"page-btn",disabled:1===c.value,onClick:n[4]||(n[4]=e=>c.value=1),title:"首页"}," « ",8,e1),(0,r.Lk)("button",{class:"page-btn",disabled:1===c.value,onClick:n[5]||(n[5]=e=>c.value--),title:"上一页"}," ‹ ",8,n1),(0,r.Lk)("span",t1,[(0,r.eW)((0,o.v_)(c.value)+" / "+(0,o.v_)(L.value)+" ",1),(0,r.Lk)("span",a1,"(共"+(0,o.v_)(S.value)+"个)",1)]),(0,r.Lk)("button",{class:"page-btn",disabled:c.value===L.value,onClick:n[6]||(n[6]=e=>c.value++),title:"下一页"}," › ",8,r1),(0,r.Lk)("button",{class:"page-btn",disabled:c.value===L.value,onClick:n[7]||(n[7]=e=>c.value=L.value),title:"末页"}," » ",8,o1)])):(0,r.Q3)("v-if",!0)])]),v.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:(0,s.D$)(D,["self"])},[(0,r.Lk)("div",i1,[(0,r.Lk)("div",s1,[(0,r.Lk)("div",l1,(0,o.v_)(f.value?.success?"制作成功":"制作失败")+" · "+(0,o.v_)(f.value?.successRate)+"% ",1),(0,r.Lk)("button",{class:"icon-btn",onClick:D,title:"关闭"},[(0,r.bF)((0,i.R1)(ed.A),{size:16})])]),(0,r.Lk)("div",c1,[f.value?((0,r.uX)(),(0,r.CE)("div",d1,[(0,r.Lk)("div",u1,[n[19]||(n[19]=(0,r.Lk)("span",{class:"k"},"结果品质",-1)),(0,r.Lk)("span",p1,(0,o.v_)(f.value.resultQuality.quality)+"·"+(0,o.v_)(I(f.value.resultQuality.grade))+"("+(0,o.v_)(f.value.resultQuality.grade)+") ",1)]),(0,r.Lk)("div",v1,[n[20]||(n[20]=(0,r.Lk)("span",{class:"k"},"产物",-1)),(0,r.Lk)("span",f1,(0,o.v_)(h.value?.名称||"（无）"),1)]),h.value?.描述?((0,r.uX)(),(0,r.CE)("div",h1,[n[21]||(n[21]=(0,r.Lk)("span",{class:"k"},"描述",-1)),(0,r.Lk)("span",m1,(0,o.v_)(h.value.描述),1)])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",g1,[n[22]||(n[22]=(0,r.Lk)("div",{class:"narrative-title"},"制作过程",-1)),(0,r.Lk)("div",b1,(0,o.v_)(m.value),1)])]),(0,r.Lk)("div",{class:"modal-footer"},[(0,r.Lk)("button",{class:"primary-btn",onClick:D},"确定")])])])):(0,r.Q3)("v-if",!0),b.value?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"modal-overlay",onClick:(0,s.D$)(N,["self"])},[(0,r.Lk)("div",y1,[(0,r.Lk)("div",x1,[n[23]||(n[23]=(0,r.Lk)("div",{class:"modal-title"},"推演完成 · 是否继续制作？",-1)),(0,r.Lk)("button",{class:"icon-btn",onClick:N,title:"关闭"},[(0,r.bF)((0,i.R1)(ed.A),{size:16})])]),(0,r.Lk)("div",k1,[(0,r.Lk)("div",w1,[(0,r.Lk)("div",_1,[n[24]||(n[24]=(0,r.Lk)("span",{class:"k"},"成功率",-1)),(0,r.Lk)("span",C1,(0,o.v_)(x.value?.successRate??"—")+"%",1)]),x.value?.predictedQuality?((0,r.uX)(),(0,r.CE)("div",A1,[n[25]||(n[25]=(0,r.Lk)("span",{class:"k"},"预期品质",-1)),(0,r.Lk)("span",S1,(0,o.v_)(x.value.predictedQuality.quality)+"·"+(0,o.v_)(I(x.value.predictedQuality.grade))+"("+(0,o.v_)(x.value.predictedQuality.grade)+") ",1)])):(0,r.Q3)("v-if",!0),x.value?.analysis?((0,r.uX)(),(0,r.CE)("div",L1,[n[26]||(n[26]=(0,r.Lk)("span",{class:"k"},"推演",-1)),(0,r.Lk)("span",E1,(0,o.v_)(x.value.analysis),1)])):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",{class:"modal-footer modal-footer-split"},[(0,r.Lk)("button",{class:"secondary-btn",onClick:N},"取消"),(0,r.Lk)("button",{class:"primary-btn",onClick:$},"继续制作")])])])):(0,r.Q3)("v-if",!0)]))}});var I1=t(4950),R1={};R1.styleTagTransform=A(),R1.setAttributes=k(),R1.insert=y().bind(null,"head"),R1.domAPI=g(),R1.insertStyleElement=_(),h()(I1.A,R1),I1.A&&I1.A.locals&&I1.A.locals;const M1=(0,E.A)(T1,[["__scopeId","data-v-72e52e5b"]]),P1=(0,I.A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),D1=(0,I.A)("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);var z1=t(5835),N1=t(8213);const $1={class:"sect-panel"},O1={class:"panel-content"},F1={class:"sect-container"},j1={class:"sect-list"},B1={class:"list-header"},X1={class:"search-bar"},U1={class:"list-content"},W1={key:0,class:"loading-state"},q1={key:1,class:"empty-state"},G1={class:"empty-text"},H1={class:"empty-hint"},V1={key:2,class:"sect-list-content"},Q1=["onClick"],K1={class:"sect-icon"},Y1={class:"sect-emoji"},J1={class:"sect-info"},Z1={class:"sect-name"},e2={class:"sect-meta"},n2={class:"sect-type"},t2={class:"sect-detail"},a2={key:0,class:"detail-content"},r2={class:"detail-header"},o2={class:"detail-icon"},i2={class:"sect-emoji-large"},s2={class:"detail-info"},l2={class:"detail-name"},c2={class:"detail-badges"},d2={class:"detail-actions"},u2=["disabled"],p2={class:"detail-body"},v2={key:0,class:"detail-section"},f2={class:"section-title"},h2={class:"member-stats"},m2={class:"total-members"},g2={class:"total-value"},b2={key:0,class:"realm-distribution"},y2={class:"realm-stats"},x2={class:"realm-name"},k2={class:"realm-count"},w2={key:1,class:"position-distribution"},_2={class:"position-stats"},C2={class:"position-name"},A2={class:"position-count"},S2={class:"detail-section"},L2={class:"section-title"},E2={class:"info-grid"},T2={class:"info-item"},I2={class:"info-value"},R2={class:"info-item"},M2={class:"info-value"},P2={class:"info-item"},D2={class:"info-value"},z2={class:"info-item"},N2={class:"info-value"},$2={key:0,class:"leadership-info"},O2={class:"leader-grid"},F2={class:"leader-item primary-leader"},j2={class:"leader-name"},B2={key:0,class:"leader-realm"},X2={key:0,class:"leader-item"},U2={class:"leader-name"},W2={key:1,class:"leader-item"},q2={class:"leader-name"},G2={class:"sect-strength"},H2={class:"strength-item"},V2={class:"strength-value peak-power"},Q2={key:0,class:"strength-item"},K2={class:"power-level"},Y2={class:"sect-description"},J2={class:"desc-text"},Z2={key:1,class:"sect-specialties"},e5={class:"specialties-tags"},n5={class:"detail-section"},t5={class:"section-title"},a5={class:"relationship-info"},r5={class:"relationship-item"},o5={class:"relationship-item"},i5={class:"reputation-level"},s5={key:1,class:"detail-section"},l5={class:"section-title"},c5={class:"territory-info"},d5={class:"influence-description"},u5={key:0,class:"controlled-areas"},p5={class:"areas-list"},v5={class:"strategic-value"},f5={class:"value-display"},h5={class:"value-bar"},m5={class:"value-text"},g5={key:2,class:"detail-section"},b5={class:"section-title"},y5={class:"join-requirements"},x5={key:0,class:"requirements-list"},k5={class:"requirement-text"},w5={key:1,class:"no-requirements"},_5={key:0,class:"join-benefits"},C5={class:"benefits-list"},A5={class:"benefit-text"},S5={class:"join-actions"},L5={key:1,class:"no-selection"},E5=(0,r.pM)({__name:"SectPanel",setup(e){const n=(0,Ec.useCharacterStore)(),t=(0,Hu.useGameStateStore)(),c=(0,a.rd)(),{t:d}=(0,l.s)(),u=(0,r.EW)(()=>"联机"===n.activeCharacterProfile?.模式),p=(0,i.KR)(!1),v=(0,i.KR)(null),f=(0,i.KR)(""),h=(0,r.EW)(()=>{const e=v.value;return e?.领导层||e?.leadership||null}),m=()=>{c.push({name:"WorldMap"})},g=(0,r.EW)(()=>{const e=t.getCurrentSaveData(),n=t.worldInfo;if(!e&&!n)return{availableSects:[]};let a=[];const r=t.sectSystem,o=n??e?.世界?.信息,i=o?.势力信息;if(Array.isArray(i)?a=i:i&&"object"==typeof i&&(a=Object.values(i)),a.length>0){const e=["秘境","遗迹","禁地","森林","山脉","湖泊","城池"];a=a.filter(n=>{const t=String(n.类型||"").toLowerCase();return(!t||!e.some(e=>t.includes(e.toLowerCase())))&&(!!String(n.名称||n?.name||"").trim()&&!!(t||n?.领导层||n?.leadership||n?.成员数量||n?.memberCount||n?.可否加入||n?.canJoin||n?.加入条件||n?.joinRequirements||n?.加入好处||n?.benefits||n?.描述||n?.description))})}0===a.length&&r?.势力档案&&Object.keys(r.势力档案).length>0&&(a=Object.values(r.势力档案));const s=a.filter((e,n,t)=>t.findIndex(n=>(n.名称||n.name)===(e.名称||e.name))===n);return{availableSects:(0,z1.c3)(s)}}),b=(0,r.EW)(()=>t.character?.名字||""),y=(0,r.EW)(()=>t.sectMemberInfo||void 0),x=(0,r.EW)(()=>g.value.availableSects),k=(0,r.EW)(()=>{const e=b.value;if(!e)return null;for(const n of x.value){const t=n?.领导层||n?.leadership;if(t){if(t.宗主===e||t.掌门===e||t.首领===e)return{sect:n,position:"首领"};if(t.副宗主===e||t.副掌门===e||t.副首领===e)return{sect:n,position:"副首领"}}}return null}),w=((0,r.EW)(()=>{const e=y.value?.职位;return!!["首领","副首领","宗主","掌门","副宗主","副掌门"].includes(e||"")||!!k.value}),(0,r.EW)(()=>k.value?k.value.sect:y.value?.势力名称&&x.value.find(e=>e.名称===y.value?.势力名称)||null),(0,r.EW)(()=>k.value?k.value.position:y.value?.职位||""),(0,r.EW)(()=>{let e=[...x.value];if(f.value.trim()){const n=f.value.toLowerCase();e=e.filter(e=>e.名称.toLowerCase().includes(n)||e.类型.toLowerCase().includes(n)||e.描述&&e.描述.toLowerCase().includes(n))}const n=["超级","一流","二流","三流","末流"],t=e=>{if(!e)return 999;const t=n.findIndex(n=>e.includes(n));return-1===t?999:t};return e.sort((e,n)=>t(e.等级)-t(n.等级))})),_=e=>{if(e.所在大洲)return e.所在大洲;const n=t.worldInfo,a=n?.continents||n?.大陆信息;if(a)for(const n of a){if(e.id&&(n.主要势力?.includes(e.id)||n.factions?.includes(e.id)))return n.名称||n.name||"未命名大洲";if(n.主要势力?.includes(e.名称)||n.factions?.includes(e.名称))return n.名称||n.name||"未命名大洲"}if(n?.势力信息)for(const t of n.势力信息)if((t.id&&e.id&&t.id===e.id||t.名称===e.名称)&&t.所在大洲)return t.所在大洲;if(e.位置&&"object"==typeof e.位置&&"x"in e.位置&&"y"in e.位置){const n=e.位置.x,t=e.位置.y;return n<110&&t>40?"北境冻土":n<110&&t<30?"南疆荒原":n>120&&t>35?"东海废墟":n>120&&t<35?"东南丛林":"中土废土"}return"未知区域"},C=e=>{const n=e;if(n.主要资源&&Array.isArray(n.主要资源))return n.主要资源.slice(0,3).join("、");if(n.resources&&Array.isArray(n.resources))return n.resources.slice(0,3).join("、");const t=e.类型||"";return t.includes("格斗")||t.includes("武")?"强化剂、合金、训练场":t.includes("科技")||t.includes("械")?"芯片、能源核心、蓝图":t.includes("生化")||t.includes("变异")?"基因液、培养皿、异兽":t.includes("异能")||t.includes("灵")?"突变结晶、古遗物、秘术":t.includes("商")?"信用点、情报、稀有物资":t.includes("世家")||t.includes("家族")?"人脉、地盘、私军":"突变结晶、补给、装备"},A=e=>{const n=[];return e.特色列表&&Array.isArray(e.特色列表)&&n.push(...e.特色列表),e.特色&&(Array.isArray(e.特色)?n.push(...e.特色):"string"==typeof e.特色&&n.push(e.特色)),Array.from(new Set(n))},S=e=>String("object"==typeof e&&null!==e&&"name"in e?e.name:e||"中立"),L=e=>"object"==typeof e&&null!==e&&"value"in e?Number(e.value):Number(e)||0,E=e=>({秩序势力:"🛡️",正道宗门:"🛡️",掠夺者:"☠️",魔道宗门:"☠️",中立势力:"⚖️",中立宗门:"⚖️",家族势力:"🏰",修仙世家:"🏰",商会:"💰",幸存者联盟:"🤝",散修联盟:"🤝",武装集团:"🔫"}[e]||"🏢"),T=e=>({秩序势力:"righteous",正道宗门:"righteous",掠夺者:"demonic",魔道宗门:"demonic",中立势力:"neutral",中立宗门:"neutral",家族势力:"family",修仙世家:"family",商会:"merchant",幸存者联盟:"alliance",散修联盟:"alliance",武装集团:"righteous"}[e]||"neutral"),I=e=>e>=90?"天下无双":e>=80?"称霸一方":e>=70?"实力雄厚":e>=60?"颇有实力":e>=50?"中等水平":e>=40?"略有实力":"实力一般",R=e=>e>=25?"声名远扬":e>=20?"享有盛誉":e>=15?"名声在外":e>=10?"小有名气":e>=5?"略有声望":"默默无闻",M=e=>e||"未知";return(e,a)=>{return(0,r.uX)(),(0,r.CE)("div",$1,[(0,r.Lk)("div",O1,[(0,r.Lk)("div",F1,[(0,r.Q3)(" 左侧：宗门列表 "),(0,r.Lk)("div",j1,[(0,r.Lk)("div",B1,[a[3]||(a[3]=(0,r.Lk)("h3",{class:"panel-title"},"势力一览",-1)),(0,r.Lk)("div",X1,[(0,r.bF)((0,i.R1)(qc),{size:16}),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),placeholder:"搜索势力...",class:"search-input"},null,512),[[s.Jo,f.value]])])]),(0,r.Lk)("div",U1,[p.value?((0,r.uX)(),(0,r.CE)("div",W1,[(0,r.bF)((0,i.R1)(Oc),{size:32,class:"animate-spin"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(d)("正在读取势力信息...")),1)])):0===w.value.length?((0,r.uX)(),(0,r.CE)("div",q1,[(0,r.bF)((0,i.R1)(P1),{size:48,class:"empty-icon"}),(0,r.Lk)("p",G1,(0,o.v_)((0,i.R1)(d)("暂无势力信息")),1),(0,r.Lk)("p",H1,(0,o.v_)((0,i.R1)(d)("世界信息将由AI根据游戏进程生成")),1),(0,r.Lk)("div",{class:"empty-actions"},[(0,r.Lk)("button",{class:"empty-action-btn primary",onClick:m},"去初始化世界（世界地图）")])])):((0,r.uX)(),(0,r.CE)("div",V1,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(w.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.名称,class:(0,o.C4)(["sect-card",{selected:v.value?.名称===e.名称,[`type-${T(e.类型)}`]:!0,"can-join":e.可否加入}]),onClick:n=>(e=>{v.value=v.value?.名称===e.名称?null:e})(e)},[(0,r.Lk)("div",K1,[(0,r.Lk)("span",Y1,(0,o.v_)(E(e.类型)),1)]),(0,r.Lk)("div",J1,[(0,r.Lk)("div",Z1,(0,o.v_)(e.名称),1),(0,r.Lk)("div",e2,[(0,r.Lk)("span",n2,(0,o.v_)(e.类型),1)])]),(0,r.bF)((0,i.R1)(Yc),{size:16,class:"arrow-icon"})],10,Q1))),128))]))])]),(0,r.Q3)(" 右侧：宗门详情 "),(0,r.Lk)("div",t2,[v.value?((0,r.uX)(),(0,r.CE)("div",a2,[(0,r.Q3)(" 详情头部 "),(0,r.Lk)("div",r2,[(0,r.Lk)("div",o2,[(0,r.Lk)("span",i2,(0,o.v_)(E(v.value.类型)),1)]),(0,r.Lk)("div",s2,[(0,r.Lk)("h3",l2,(0,o.v_)(v.value.名称),1),(0,r.Lk)("div",c2,[(0,r.Lk)("span",{class:(0,o.C4)(["type-badge",`type-${T(v.value.类型)}`])},(0,o.v_)(v.value.类型),3),(0,r.Lk)("span",{class:(0,o.C4)(["level-badge",`level-${v.value.等级}`])},(0,o.v_)((b=v.value.等级,b?b.includes("势力")?b:b+"势力":"未知")),3)]),(0,r.Lk)("div",d2,[(0,r.Lk)("button",{class:"danger-btn",disabled:u.value,onClick:a[1]||(a[1]=(0,s.D$)(e=>(async e=>{if(u.value)_e.o.warning("联机模式下不允许直接修改势力信息");else if(e?.名称&&window.confirm(`确认从势力信息中移除「${e.名称}」？\n\n该操作会同时尝试从：\n- 世界.信息.势力信息\n- 社交.势力.势力档案\n中删除该势力。`))try{const a=t.getCurrentSaveData();if(!a)return void _e.o.error("存档数据不完整或未加载，无法删除");const r=JSON.parse(JSON.stringify(a)),o=r?.世界?.信息;if(o?.势力信息&&Array.isArray(o.势力信息)){const n=String(e.名称).trim(),t=String(e.id||"").trim();o.势力信息=o.势力信息.filter(e=>{const a=String(e?.名称||"").trim(),r=String(e?.id||"").trim();return!(t&&r&&r===t||n&&a&&a===n)})}const i=r?.社交?.势力;if(i?.势力档案&&"object"==typeof i.势力档案){const n=String(e.名称).trim(),t=String(e.id||"").trim();n&&n in i.势力档案&&delete i.势力档案[n];for(const e of Object.keys(i.势力档案)){const a=i.势力档案[e],r=String(a?.名称||e||"").trim(),o=String(a?.id||"").trim();(t&&o&&o===t||n&&r&&r===n)&&delete i.势力档案[e]}}t.loadFromSaveData(r),await n.saveCurrentGame(),v.value?.名称===e.名称&&(v.value=null),_e.o.success(`已移除势力：${e.名称}`)}catch(e){console.error("[SectPanel] deleteFaction failed",e),_e.o.error("删除失败，请稍后重试")}})(v.value),["stop"]))},[(0,r.bF)((0,i.R1)(ba.A),{size:14}),a[4]||(a[4]=(0,r.Lk)("span",null,"删除势力",-1))],8,u2)])])]),(0,r.Q3)(" 详情主体 "),(0,r.Lk)("div",p2,[(0,r.Q3)(" 成员统计 "),v.value.成员数量?((0,r.uX)(),(0,r.CE)("div",v2,[(0,r.Lk)("h5",f2,[(0,r.bF)((0,i.R1)(P),{size:16}),a[5]||(a[5]=(0,r.Lk)("span",null,"成员统计",-1))]),(0,r.Lk)("div",h2,[(0,r.Q3)(" 总体统计 "),(0,r.Lk)("div",m2,[a[6]||(a[6]=(0,r.Lk)("span",{class:"total-label"},"总人数",-1)),(0,r.Lk)("span",g2,(0,o.v_)(v.value.成员数量?.总数||v.value.成员数量?.total||0)+"人",1)]),(0,r.Q3)(" 觉醒阶段分布 "),v.value.成员数量?.按觉醒阶段||v.value.成员数量?.byAwakening?((0,r.uX)(),(0,r.CE)("div",b2,[a[7]||(a[7]=(0,r.Lk)("h6",{class:"distribution-title"},"觉醒阶段分布",-1)),(0,r.Lk)("div",y2,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value.成员数量?.按觉醒阶段||v.value.成员数量?.byAwakening,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:n,class:"realm-item"},[(0,r.Lk)("span",x2,(0,o.v_)(M(String(n))),1),(0,r.Lk)("span",k2,(0,o.v_)(e)+"人",1)]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 职位分布 "),v.value.成员数量?.按职位||v.value.成员数量?.byPosition?((0,r.uX)(),(0,r.CE)("div",w2,[a[8]||(a[8]=(0,r.Lk)("h6",{class:"distribution-title"},"职位分布",-1)),(0,r.Lk)("div",_2,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value.成员数量?.按职位||v.value.成员数量?.byPosition,(e,n)=>(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",{key:n,class:"position-item"},[(0,r.Lk)("span",C2,(0,o.v_)(n),1),(0,r.Lk)("span",A2,(0,o.v_)(e)+"人",1)])),[[s.aG,e>0]])),128))])])):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 基础信息 "),(0,r.Lk)("div",S2,[(0,r.Lk)("h5",L2,[(0,r.bF)((0,i.R1)(P1),{size:16}),a[9]||(a[9]=(0,r.Lk)("span",null,"基础信息",-1))]),(0,r.Lk)("div",E2,[(0,r.Lk)("div",T2,[a[10]||(a[10]=(0,r.Lk)("span",{class:"info-label"},"势力类型",-1)),(0,r.Lk)("span",I2,(0,o.v_)(v.value.类型),1)]),(0,r.Lk)("div",R2,[a[11]||(a[11]=(0,r.Lk)("span",{class:"info-label"},"势力等级",-1)),(0,r.Lk)("span",M2,(0,o.v_)(v.value.等级),1)]),(0,r.Lk)("div",P2,[a[12]||(a[12]=(0,r.Lk)("span",{class:"info-label"},"所在大洲",-1)),(0,r.Lk)("span",D2,(0,o.v_)(_(v.value)),1)]),(0,r.Lk)("div",z2,[a[13]||(a[13]=(0,r.Lk)("span",{class:"info-label"},"主要资源",-1)),(0,r.Lk)("span",N2,(0,o.v_)(C(v.value)),1)])]),(0,r.Q3)(" 势力领导层 "),h.value?((0,r.uX)(),(0,r.CE)("div",$2,[a[19]||(a[19]=(0,r.Lk)("h6",{class:"leadership-title"},"势力领导",-1)),(0,r.Lk)("div",O2,[(0,r.Lk)("div",F2,[a[14]||(a[14]=(0,r.Lk)("span",{class:"leader-role"},"首领",-1)),(0,r.Lk)("span",j2,(0,o.v_)(h.value.首领||h.value.宗主),1),h.value.首领觉醒阶段||h.value.宗主修为?((0,r.uX)(),(0,r.CE)("span",B2,(0,o.v_)(h.value.首领觉醒阶段||h.value.宗主修为),1)):(0,r.Q3)("v-if",!0)]),h.value.副首领||h.value.副宗主?((0,r.uX)(),(0,r.CE)("div",X2,[a[15]||(a[15]=(0,r.Lk)("span",{class:"leader-role"},"副首领",-1)),(0,r.Lk)("span",U2,(0,o.v_)(h.value.副首领||h.value.副宗主),1)])):(0,r.Q3)("v-if",!0),h.value.精英||h.value.圣女?((0,r.uX)(),(0,r.CE)("div",W2,[a[16]||(a[16]=(0,r.Lk)("span",{class:"leader-role"},"精英",-1)),(0,r.Lk)("span",q2,(0,o.v_)(h.value.精英||h.value.圣女),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",G2,[(0,r.Lk)("div",H2,[a[17]||(a[17]=(0,r.Lk)("span",{class:"strength-label"},"最强觉醒阶段",-1)),(0,r.Lk)("span",V2,(0,o.v_)(h.value.最强觉醒者||h.value.领袖觉醒阶段||h.value.最强修为||h.value.宗主修为),1)]),h.value?.综合战力?((0,r.uX)(),(0,r.CE)("div",Q2,[a[18]||(a[18]=(0,r.Lk)("span",{class:"strength-label"},"战力",-1)),(0,r.Lk)("span",{class:(0,o.C4)(["strength-value power-rating",(g=h.value.综合战力||0,g>=90?"power-legendary":g>=80?"power-supreme":g>=70?"power-strong":g>=60?"power-good":g>=50?"power-average":g>=40?"power-weak":"power-poor")])},[(0,r.eW)((0,o.v_)(h.value.综合战力||0)+"/100 ",1),(0,r.Lk)("span",K2,"("+(0,o.v_)(I(h.value.综合战力||0))+")",1)],2)])):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",Y2,[a[20]||(a[20]=(0,r.Lk)("h6",{class:"desc-title"},"势力描述",-1)),(0,r.Lk)("p",J2,(0,o.v_)(v.value.描述),1)]),(0,r.Q3)(" 宗门特色 "),A(v.value).length>0?((0,r.uX)(),(0,r.CE)("div",Z2,[a[21]||(a[21]=(0,r.Lk)("h6",{class:"specialties-title"},"势力特色",-1)),(0,r.Lk)("div",e5,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(A(v.value),e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"specialty-tag"},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("v-if",!0)]),(0,r.Q3)(" 关系状态 "),(0,r.Lk)("div",n5,[(0,r.Lk)("h5",t5,[(0,r.bF)((0,i.R1)(Wp.A),{size:16}),a[22]||(a[22]=(0,r.Lk)("span",null,"关系状态",-1))]),(0,r.Lk)("div",a5,[(0,r.Lk)("div",r5,[a[23]||(a[23]=(0,r.Lk)("span",{class:"relationship-label"},"与你的关系",-1)),(0,r.Lk)("span",{class:(0,o.C4)(["relationship-value",(c=S(v.value.与玩家关系),{仇敌:"enemy",敌对:"hostile",冷淡:"cold",中立:"neutral",友好:"friendly",盟友:"ally",附庸:"vassal"}[c]||"neutral")])},(0,o.v_)(S(v.value.与玩家关系)),3)]),(0,r.Lk)("div",o5,[a[24]||(a[24]=(0,r.Lk)("span",{class:"relationship-label"},"声望值",-1)),(0,r.Lk)("span",{class:(0,o.C4)(["relationship-value reputation-value",(l=L(v.value.声望值),l>=25?"reputation-legendary":l>=20?"reputation-excellent":l>=15?"reputation-good":l>=10?"reputation-fair":l>=5?"reputation-low":"reputation-none")])},[(0,r.eW)((0,o.v_)(L(v.value.声望值))+" ",1),(0,r.Lk)("span",i5,"("+(0,o.v_)(R(L(v.value.声望值)))+")",1)],2)])])]),(0,r.Q3)(" 势力范围 "),v.value.势力范围详情?((0,r.uX)(),(0,r.CE)("div",s5,[(0,r.Lk)("h5",l5,[(0,r.bF)((0,i.R1)(Ju),{size:16}),a[25]||(a[25]=(0,r.Lk)("span",null,"势力范围",-1))]),(0,r.Lk)("div",c5,[(0,r.Lk)("div",d5,[a[26]||(a[26]=(0,r.Lk)("strong",null,"影响范围：",-1)),(0,r.eW)((0,o.v_)(v.value.势力范围详情.影响范围||"未知"),1)]),v.value.势力范围详情.控制区域?.length?((0,r.uX)(),(0,r.CE)("div",u5,[a[27]||(a[27]=(0,r.Lk)("strong",null,"控制区域：",-1)),(0,r.Lk)("div",p5,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value.势力范围详情.控制区域,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"area-tag"},(0,o.v_)(e),1))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",v5,[a[28]||(a[28]=(0,r.Lk)("strong",null,"战略价值：",-1)),(0,r.Lk)("div",f5,[(0,r.Lk)("div",h5,[(0,r.Lk)("div",{class:"value-fill",style:(0,o.Tr)({width:10*(v.value.势力范围详情.战略价值||5)+"%"})},null,4)]),(0,r.Lk)("span",m5,(0,o.v_)(v.value.势力范围详情.战略价值||5)+"/10",1)])])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 加入条件 "),v.value.可否加入?((0,r.uX)(),(0,r.CE)("div",g5,[(0,r.Lk)("h5",b5,[(0,r.bF)((0,i.R1)(bg),{size:16}),a[29]||(a[29]=(0,r.Lk)("span",null,"加入条件",-1))]),(0,r.Lk)("div",y5,[v.value.加入条件?.length?((0,r.uX)(),(0,r.CE)("div",x5,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value.加入条件,e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:"requirement-item"},[(0,r.bF)((0,i.R1)(Nc),{size:14,class:"requirement-icon"}),(0,r.Lk)("span",k5,(0,o.v_)(e),1)]))),128))])):((0,r.uX)(),(0,r.CE)("div",w5,a[30]||(a[30]=[(0,r.Lk)("p",null,"暂无特殊加入条件",-1)])))]),(0,r.Q3)(" 加入好处 "),v.value.加入好处?.length?((0,r.uX)(),(0,r.CE)("div",_5,[a[31]||(a[31]=(0,r.Lk)("h6",{class:"benefits-title"},"加入好处",-1)),(0,r.Lk)("div",C5,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(v.value.加入好处,e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:"benefit-item"},[(0,r.bF)((0,i.R1)(D1),{size:14,class:"benefit-icon"}),(0,r.Lk)("span",A5,(0,o.v_)(e),1)]))),128))])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 加入按钮 "),(0,r.Lk)("div",S5,[(0,r.Lk)("button",{class:"join-btn",onClick:a[2]||(a[2]=e=>(e=>{if(!e.可否加入)return void _e.o.warning("该势力暂不接受加入");const n=y.value?.势力名称;if(n===e.名称)return void _e.o.info(`你已加入 ${e.名称}`);if(n&&n!==e.名称){if(!((e,n)=>{const t=n?`你已加入${e}，是否退出并加入${n}？退出后将清空该势力的贡献与兑换数据。`:`确定退出${e}？退出后将清空该势力的贡献与兑换数据。`;return window.confirm(t)})(n,e.名称))return;a=n,t.updateState("sectMemberInfo",null),t.updateState("sectSystem",null),_e.o.success(`已退出 ${a}`)}var a;const{sectSystem:r,memberInfo:o}=(0,N1.createJoinedSectState)(e);t.updateState("sectMemberInfo",o),t.updateState("sectSystem",r),_e.o.success(`已加入 ${e.名称}`)})(v.value))},[(0,r.bF)((0,i.R1)(bg),{size:16}),a[32]||(a[32]=(0,r.Lk)("span",null,"申请加入",-1))])])])):(0,r.Q3)("v-if",!0)])])):((0,r.uX)(),(0,r.CE)("div",L5,[(0,r.bF)((0,i.R1)(P1),{size:64,class:"placeholder-icon"}),a[33]||(a[33]=(0,r.Lk)("p",{class:"placeholder-text"},"选择一个势力查看详细信息",-1)),a[34]||(a[34]=(0,r.Lk)("p",{class:"placeholder-hint"},"世界中的势力等你探索",-1))]))])])])]);var l,c,g,b}}});var T5=t(6193),I5={};I5.styleTagTransform=A(),I5.setAttributes=k(),I5.insert=y().bind(null,"head"),I5.domAPI=g(),I5.insertStyleElement=_(),h()(T5.A,I5),T5.A&&T5.A.locals&&T5.A.locals;const R5=(0,E.A)(E5,[["__scopeId","data-v-6986c140"]]),M5=(0,I.A)("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);var P5=t(960);const D5={class:"sect-system-panel"},z5={class:"sect-header"},N5={class:"sect-headline"},$5={class:"sect-title"},O5={class:"sect-mark","aria-hidden":"true"},F5={class:"sect-title-text"},j5={class:"sect-name"},B5={key:0},X5={key:1},U5={key:3,class:"role-pill none"},W5={class:"sect-subtitle"},q5={key:0,class:"sub-strong"},G5={key:1},H5={key:2},V5={key:0,class:"sect-metrics"},Q5={class:"metric"},K5={class:"v"},Y5={class:"metric"},J5={class:"v"},Z5={key:0,class:"metric"},e6={class:"v"},n6={class:"sect-tabs",role:"tablist","aria-label":"势力功能导航"},t6={class:"tab-group-label","aria-hidden":"true"},a6=["aria-selected","onClick"],r6={key:0,class:"tab-group-divider","aria-hidden":"true"},o6={class:"sect-system-content"},i6=(0,r.pM)({__name:"SectSystemPanel",setup(e){const n=(0,a.lq)(),t=(0,a.rd)(),i=(0,Hu.useGameStateStore)(),s=(0,r.EW)(()=>i.character?.名字||""),l=(0,r.EW)(()=>{const e=i.getCurrentSaveData(),n=e?.世界?.信息;return n?.势力信息||[]}),c=(0,r.EW)(()=>(0,P5.Z)(s.value,l.value,i.sectMemberInfo)),d=(0,r.EW)(()=>{const e=String(i.sectMemberInfo?.势力名称||"").trim();if(e)return e;return String(i.sectSystem?.当前势力||"").trim()||String(c.value.sectName||"").trim()}),u=(0,r.EW)(()=>c.value.isLeader&&c.value.position?c.value.position:i.sectMemberInfo?.职位||""),p=(0,r.EW)(()=>i.sectMemberInfo?.贡献??0),v=(0,r.EW)(()=>i.sectMemberInfo?.声望??0),f=(0,r.EW)(()=>i.sectMemberInfo?.加入日期||""),h=(0,r.EW)(()=>!!(String(i.sectMemberInfo?.势力名称||"").trim()||String(i.sectSystem?.当前势力||"").trim()||String(c.value.sectName||"").trim())),m=(0,r.EW)(()=>c.value.isLeader||(0,P5.b)(String(i.sectMemberInfo?.职位||""))),g=[{group:"概览",name:"SectOverview",label:"概览",icon:np,requireJoin:!1},{group:"内务",name:"SectMembers",label:"成员",icon:P,requireJoin:!0},{group:"内务",name:"SectTasks",label:"任务",icon:ap,requireJoin:!0},{group:"内务",name:"SectContribution",label:"兑换",icon:rp,requireJoin:!0},{group:"首领",name:"SectManagement",label:"经营",icon:tp,requireJoin:!0,requireLeader:!0},{group:"首领",name:"SectWar",label:"战争",icon:op,requireJoin:!0,requireLeader:!0}],b=(0,r.EW)(()=>g.filter(e=>!(e.requireJoin&&!h.value||e.requireLeader&&!m.value))),y=(0,r.EW)(()=>{const e=["概览","内务","首领"],n=new Map;for(const t of e)n.set(t,[]);for(const e of b.value){const t=n.get(e.group)??[];t.push(e),n.set(e.group,t)}return e.map(e=>({group:e,tabs:n.get(e)??[]})).filter(e=>e.tabs.length>0)}),x=(0,r.EW)(()=>d.value?c.value.isMaster?M5:tp:P1),k=(0,r.EW)(()=>d.value?c.value.isMaster?"master":c.value.isLeader?"leader":"member":"none"),w=e=>{const n=String(e||"").trim(),t=n.match(/^(\d{4}-\d{2}-\d{2})/);return t?t[1]:n},_=e=>String(n.name)===e;return(e,n)=>{const a=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",D5,[(0,r.Lk)("div",z5,[(0,r.Lk)("div",N5,[(0,r.Lk)("div",$5,[(0,r.Lk)("div",O5,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(x.value),{size:16}))]),(0,r.Lk)("div",F5,[(0,r.Lk)("div",j5,[d.value?((0,r.uX)(),(0,r.CE)("span",B5,(0,o.v_)(d.value),1)):((0,r.uX)(),(0,r.CE)("span",X5,"势力")),d.value&&u.value?((0,r.uX)(),(0,r.CE)("span",{key:2,class:(0,o.C4)(["role-pill",k.value])},(0,o.v_)(u.value),3)):d.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("span",U5,"未加入"))]),(0,r.Lk)("div",W5,[d.value&&m.value?((0,r.uX)(),(0,r.CE)("span",q5,"可管理势力事务")):d.value?((0,r.uX)(),(0,r.CE)("span",G5,"势力事务与发展")):((0,r.uX)(),(0,r.CE)("span",H5,"先在「势力概览」选择势力，或创建/加入自己的势力"))])])]),d.value?((0,r.uX)(),(0,r.CE)("div",V5,[(0,r.Lk)("div",Q5,[n[0]||(n[0]=(0,r.Lk)("div",{class:"k"},"贡献",-1)),(0,r.Lk)("div",K5,(0,o.v_)(p.value),1)]),(0,r.Lk)("div",Y5,[n[1]||(n[1]=(0,r.Lk)("div",{class:"k"},"声望",-1)),(0,r.Lk)("div",J5,(0,o.v_)(v.value),1)]),f.value?((0,r.uX)(),(0,r.CE)("div",Z5,[n[2]||(n[2]=(0,r.Lk)("div",{class:"k"},"加入",-1)),(0,r.Lk)("div",e6,(0,o.v_)(w(f.value)),1)])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",n6,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.value,(e,n)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:e.group},[(0,r.Lk)("div",t6,(0,o.v_)(e.group),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.tabs,e=>((0,r.uX)(),(0,r.CE)("button",{key:e.name,class:(0,o.C4)(["sect-tab",{active:_(e.name)}]),role:"tab","aria-selected":_(e.name),onClick:n=>{return a=e.name,void t.push({name:a});var a}},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:14})),(0,r.Lk)("span",null,(0,o.v_)(e.label),1)],10,a6))),128)),n!==y.value.length-1?((0,r.uX)(),(0,r.CE)("div",r6)):(0,r.Q3)("v-if",!0)],64))),128))])]),(0,r.Lk)("div",o6,[(0,r.bF)(a)])])}}});var s6=t(4899),l6={};l6.styleTagTransform=A(),l6.setAttributes=k(),l6.insert=y().bind(null,"head"),l6.domAPI=g(),l6.insertStyleElement=_(),h()(s6.A,l6),s6.A&&s6.A.locals&&s6.A.locals;const c6=(0,E.A)(i6,[["__scopeId","data-v-13a1052a"]]),d6={class:"sect-members"},u6={class:"my-sect-identity"},p6={class:"identity-header"},v6={class:"identity-content"},f6={class:"identity-stats"},h6={class:"stat-item"},m6={class:"stat-value sect-name"},g6={class:"stat-item"},b6={class:"stat-value position"},y6={class:"stat-item"},x6={class:"stat-value contribution"},k6={class:"stat-item"},w6={class:"stat-value reputation"},_6={class:"stat-item"},C6={class:"stat-value join-date"},A6={class:"identity-actions"},S6={key:0,class:"leadership-card"},L6={class:"leadership-header"},E6={class:"leadership-title"},T6=["disabled"],I6={key:0,class:"leadership-grid"},R6={class:"leader-item primary"},M6={class:"name"},P6={key:0,class:"realm"},D6={key:0,class:"leader-item"},z6={class:"name"},N6={key:1,class:"leader-item"},$6={class:"name"},O6={key:0,class:"realm"},F6={key:2,class:"leader-item"},j6={class:"name"},B6={key:3,class:"leader-item"},X6={class:"name"},U6={key:4,class:"leader-item"},W6={class:"name"},q6={key:1,class:"leadership-empty"},G6={class:"member-tabs"},H6=["onClick"],V6={key:0,class:"count-badge"},Q6={class:"member-list"},K6={key:0,class:"empty-state"},Y6=["disabled"],J6={key:1,class:"members"},Z6=["onClick"],e3={class:"member-avatar"},n3={class:"avatar-text"},t3={class:"member-info"},a3={class:"member-header"},r3={class:"member-name"},o3={class:"member-details"},i3={class:"detail-item realm"},s3={key:0,class:"detail-item combat"},l3={class:"members-notice"},c3=(0,r.pM)({__name:"SectMembersContent",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)("all"),s=(0,i.KR)(!1),l=(0,i.KR)(!1),c=(0,r.EW)(()=>n.character?.名字||""),d=(0,r.EW)(()=>{const e=n.getCurrentSaveData(),t=e?.世界?.信息;return t?.势力信息||[]}),u=(0,r.EW)(()=>(0,P5.Z)(c.value,d.value,n.sectMemberInfo)),p=[{key:"all",label:"全部",icon:P},{key:"长老",label:"长老",icon:M5},{key:"真传",label:"真传",icon:Qc.A},{key:"同辈",label:"同辈",icon:R}],v=(0,r.EW)(()=>n.sectMemberInfo),f=(0,r.EW)(()=>u.value.sectName||v.value?.势力名称||"未加入势力"),h=(0,r.EW)(()=>u.value.position||v.value?.职位||"散修"),m=(0,r.EW)(()=>v.value?.贡献||0),g=(0,r.EW)(()=>v.value?.声望||0),b=(0,r.EW)(()=>v.value?.加入日期||"");function y(e){if(!e)return"未知";try{const n=new Date(e);return`${n.getFullYear()}/${n.getMonth()+1}/${n.getDate()}`}catch{return e}}function x(){v.value?.势力名称?(n.sectMemberInfo=null,_e.o.success("已退出势力")):_e.o.error("你还未加入任何势力")}const k=(0,r.EW)(()=>{const e=String(f.value||"").trim();if(!e||"未加入势力"===e)return null;const t=n.sectSystem?.势力档案?.[e]??null;if(t)return t;const a=n.worldInfo?.势力信息;return Array.isArray(a)?a.find(n=>n?.名称===e)??null:null}),w=(0,r.EW)(()=>{const e=k.value?.领导层;return e&&"object"==typeof e&&String(e.宗主||"").trim()?e:null}),_=(0,r.EW)(()=>{const e=n.relationships||{};return Object.entries(e).filter(([e,n])=>(n.势力归属||n.宗门)===f.value).map(([e,n])=>{return{id:e,name:n.名字||e,gender:n.性别||"男",position:n.职位||"弟子",realm:(a=n?.属性?.觉醒阶段,a&&"string"==typeof a?a:"未知"),relation:L(n.好感度),favorability:n.好感度||50,isSelf:!1,category:(t=n.职位,t?t.includes("宗主")||t.includes("掌门")||t.includes("副宗主")||t.includes("副掌门")||t.includes("长老")||t.includes("太上")?"长老":t.includes("真传")||t.includes("核心")?"真传":"同辈":"同辈"),combat:S(n)};var t,a})}),C=(0,r.EW)(()=>"all"===a.value?_.value:_.value.filter(e=>e.category===a.value));function A(e){return"all"===e?_.value.length:_.value.filter(n=>n.category===e).length}function S(e){try{const n=e?.先天属性||e?.核心属性;if(!n)return null;const t={STR:Number(n.力量??0),AGI:Number(n.敏捷??0),CON:Number(n.体质??0),WIL:Number(n.意志??0),CHA:Number(n.魅力??0),LCK:Number(n.幸运??0)},a="string"==typeof e?.属性?.觉醒阶段?e.属性.觉醒阶段:"string"==typeof e?.觉醒阶段?e.觉醒阶段:"凡人";return(0,lh._p)(t,a,{})}catch{return null}}function L(e){const n=e||50;return n>=90?"挚友":n>=75?"好友":n>=60?"友好":n>=40?"普通":n>=20?"冷淡":"敌视"}function E(e){hw(e),_e.o.success("已发送到对话")}async function T(){if(s.value)return;const e=f.value;if(e&&"未加入势力"!==e){s.value=!0;try{const a=n.worldInfo,r=n.sectSystem?.势力档案?.[e]??null,o=a?{世界名称:a.世界名称,世界背景:a.世界背景}:null,i=`\n# 任务：生成【势力高层】信息\n为势力「${e}」生成领导层信息。\n\n## 输出格式\n只输出 1 个 JSON 对象：\n{"leadership":{...}}\n\n## leadership 对象字段\n{\n  "宗主": "string（名字）",\n  "宗主修为": "string（觉醒阶段）",\n  "副宗主": "string（可选）",\n  "太上长老": "string（可选）",\n  "太上长老修为": "string（可选）",\n  "长老数量": number,\n  "最强修为": "string",\n  "综合战力": number（1-100）\n}\n\n## 世界背景\n${JSON.stringify(o).slice(0,400)}\n\n## 势力档案\n${JSON.stringify(r).slice(0,800)}\n    `.trim(),s=await(0,ar.e)("生成势力高层",i,!1,"sect_generation"),l=(0,cr.$6)(s,bw.aiService.isForceJsonEnabled("sect_generation"));if(!l.leadership)throw new Error("leadership 字段缺失");const c=n.getCurrentSaveData();if(c){const a="function"==typeof structuredClone?structuredClone(c):JSON.parse(JSON.stringify(c)),r=a.社交??={},o=r.势力??={},i=o.势力档案??={};(i[e]??={}).领导层=l.leadership,n.loadFromSaveData(a),await t.saveCurrentGame()}_e.o.success("势力高层信息已生成")}catch(e){console.error("[SectMembers] generate leadership failed",e),_e.o.error("生成失败")}finally{s.value=!1}}else _e.o.warning("未加入势力")}async function I(){if(l.value)return;const e=f.value;if(e&&"未加入势力"!==e){l.value=!0;try{const a=n.worldInfo,r=n.sectSystem?.势力档案?.[e]??null,o=a?{世界名称:a.世界名称,世界背景:a.世界背景}:null,i=`\n# 任务：生成【势力同门】信息\n为势力「${e}」生成同门弟子信息。\n\n## 输出格式\n只输出 1 个 JSON 对象：\n{"members":[...]}\n\n## member 对象字段\n{\n  "名字": "string",\n  "性别": "男|女",\n  "职位": "外门弟子|内门弟子|真传弟子|核心弟子|长老",\n  "觉醒阶段": "string",\n  "势力归属": "${e}",\n  "好感度": number（30-70）\n}\n\n## 约束\n- 生成 5-10 个同门\n- 职位分布合理\n\n## 世界背景\n${JSON.stringify(o).slice(0,400)}\n\n## 势力档案\n${JSON.stringify(r).slice(0,600)}\n    `.trim(),s=await(0,ar.e)("生成同门信息",i,!1,"sect_generation"),l=(0,cr.$6)(s,bw.aiService.isForceJsonEnabled("sect_generation"));if(!Array.isArray(l.members))throw new Error("members 字段缺失");const c=n.getCurrentSaveData();if(c){const a="function"==typeof structuredClone?structuredClone(c):JSON.parse(JSON.stringify(c)),r=a.社交??={},o=r.关系??={};for(const n of l.members){const t=n.名字;t&&(o[t]={...n,势力归属:e})}n.loadFromSaveData(a),await t.saveCurrentGame()}_e.o.success("同门信息已生成")}catch(e){console.error("[SectMembers] generate members failed",e),_e.o.error("生成失败")}finally{l.value=!1}}else _e.o.warning("未加入势力")}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",d6,[(0,r.Q3)(" 我的势力身份 "),(0,r.Lk)("div",u6,[(0,r.Lk)("div",p6,[(0,r.bF)((0,i.R1)(M5),{size:16}),n[3]||(n[3]=(0,r.Lk)("span",null,"我的势力身份",-1))]),(0,r.Lk)("div",v6,[(0,r.Lk)("div",f6,[(0,r.Lk)("div",h6,[n[4]||(n[4]=(0,r.Lk)("span",{class:"stat-label"},"所属势力",-1)),(0,r.Lk)("span",m6,(0,o.v_)(f.value),1)]),(0,r.Lk)("div",g6,[n[5]||(n[5]=(0,r.Lk)("span",{class:"stat-label"},"职位",-1)),(0,r.Lk)("span",b6,(0,o.v_)(h.value),1)]),(0,r.Lk)("div",y6,[n[6]||(n[6]=(0,r.Lk)("span",{class:"stat-label"},"贡献点",-1)),(0,r.Lk)("span",x6,(0,o.v_)(m.value),1)]),(0,r.Lk)("div",k6,[n[7]||(n[7]=(0,r.Lk)("span",{class:"stat-label"},"声望",-1)),(0,r.Lk)("span",w6,(0,o.v_)(g.value),1)]),(0,r.Lk)("div",_6,[n[8]||(n[8]=(0,r.Lk)("span",{class:"stat-label"},"加入时间",-1)),(0,r.Lk)("span",C6,(0,o.v_)(y(b.value)),1)])]),(0,r.Lk)("div",A6,[(0,r.Lk)("button",{class:"leave-sect-btn",onClick:x},[(0,r.bF)((0,i.R1)(Up),{size:14}),n[9]||(n[9]=(0,r.Lk)("span",null,"退出势力",-1))])])])]),(0,r.Q3)(" 势力领导层（来自势力信息/宗门档案，不依赖NPC关系） "),"未加入势力"!==f.value?((0,r.uX)(),(0,r.CE)("div",S6,[(0,r.Lk)("div",L6,[(0,r.Lk)("div",E6,[(0,r.bF)((0,i.R1)(M5),{size:14}),n[10]||(n[10]=(0,r.Lk)("span",null,"势力高层",-1))]),w.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"ask-btn small",onClick:T,disabled:s.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14,class:(0,o.C4)({spin:s.value})},null,8,["class"]),(0,r.Lk)("span",null,(0,o.v_)(s.value?"生成中...":"生成高层"),1)],8,T6))]),w.value?((0,r.uX)(),(0,r.CE)("div",I6,[(0,r.Lk)("div",R6,[n[11]||(n[11]=(0,r.Lk)("span",{class:"role"},"首领",-1)),(0,r.Lk)("span",M6,(0,o.v_)(w.value.首领),1),w.value.首领觉醒阶段?((0,r.uX)(),(0,r.CE)("span",P6,(0,o.v_)(w.value.首领觉醒阶段),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{class:"link",onClick:n[0]||(n[0]=e=>E(`我想拜见${f.value}首领「${w.value.宗主}」`))},"拜见")]),w.value.副宗主?((0,r.uX)(),(0,r.CE)("div",D6,[n[12]||(n[12]=(0,r.Lk)("span",{class:"role"},"副首领",-1)),(0,r.Lk)("span",z6,(0,o.v_)(w.value.副宗主),1),(0,r.Lk)("button",{class:"link",onClick:n[1]||(n[1]=e=>E(`我想向${f.value}副首领「${w.value.副宗主}」请教`))},"请教")])):(0,r.Q3)("v-if",!0),w.value.太上长老?((0,r.uX)(),(0,r.CE)("div",N6,[n[13]||(n[13]=(0,r.Lk)("span",{class:"role"},"太上长老",-1)),(0,r.Lk)("span",$6,(0,o.v_)(w.value.太上长老),1),w.value.太上长老修为?((0,r.uX)(),(0,r.CE)("span",O6,(0,o.v_)(w.value.太上长老修为),1)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{class:"link",onClick:n[2]||(n[2]=e=>E(`我想拜见${f.value}太上长老「${w.value.太上长老}」`))},"拜见")])):(0,r.Q3)("v-if",!0),w.value.长老数量?((0,r.uX)(),(0,r.CE)("div",F6,[n[14]||(n[14]=(0,r.Lk)("span",{class:"role"},"长老数量",-1)),(0,r.Lk)("span",j6,(0,o.v_)(w.value.长老数量)+"位",1)])):(0,r.Q3)("v-if",!0),w.value.最强修为?((0,r.uX)(),(0,r.CE)("div",B6,[n[15]||(n[15]=(0,r.Lk)("span",{class:"role"},"最强觉醒阶段",-1)),(0,r.Lk)("span",X6,(0,o.v_)(w.value.最强修为),1)])):(0,r.Q3)("v-if",!0),w.value.综合战力?((0,r.uX)(),(0,r.CE)("div",U6,[n[16]||(n[16]=(0,r.Lk)("span",{class:"role"},"战力",-1)),(0,r.Lk)("span",W6,(0,o.v_)(w.value.综合战力)+"/100",1)])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",q6,n[17]||(n[17]=[(0,r.Lk)("span",null,"暂无势力高层信息（可在“势力概览”生成势力信息，或点击上方“生成高层”）",-1)])))])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 成员分类 "),(0,r.Lk)("div",G6,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(p,e=>(0,r.Lk)("button",{key:e.key,class:(0,o.C4)(["tab-btn",{active:a.value===e.key}]),onClick:n=>a.value=e.key},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:14})),(0,r.Lk)("span",null,(0,o.v_)(e.label),1),A(e.key)>0?((0,r.uX)(),(0,r.CE)("span",V6,(0,o.v_)(A(e.key)),1)):(0,r.Q3)("v-if",!0)],10,H6)),64))]),(0,r.Q3)(" 成员列表 "),(0,r.Lk)("div",Q6,[0===C.value.length?((0,r.uX)(),(0,r.CE)("div",K6,[(0,r.bF)((0,i.R1)(P),{size:48,class:"empty-icon"}),n[18]||(n[18]=(0,r.Lk)("p",{class:"empty-text"},"暂无同门信息",-1)),n[19]||(n[19]=(0,r.Lk)("p",{class:"empty-hint"},"同门信息由AI根据剧情生成",-1)),(0,r.Lk)("button",{class:"ask-btn",onClick:I,disabled:l.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14,class:(0,o.C4)({spin:l.value})},null,8,["class"]),(0,r.Lk)("span",null,(0,o.v_)(l.value?"生成中...":"生成同门"),1)],8,Y6)])):((0,r.uX)(),(0,r.CE)("div",J6,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(C.value,e=>{return(0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["member-card",{"is-self":e.isSelf}]),onClick:n=>function(e){E(`我想和${e.name}交谈`)}(e)},[(0,r.Lk)("div",e3,[(0,r.Lk)("span",n3,(0,o.v_)(e.name.charAt(0)),1),(0,r.Lk)("span",{class:(0,o.C4)(["gender-badge","女"===e.gender?"female":"male"])},(0,o.v_)("女"===e.gender?"♀":"♂"),3)]),(0,r.Lk)("div",t3,[(0,r.Lk)("div",a3,[(0,r.Lk)("span",r3,(0,o.v_)(e.name),1),(0,r.Lk)("span",{class:(0,o.C4)(["member-position",(t=e.position,t.includes("宗主")||t.includes("掌门")||t.includes("副宗主")||t.includes("副掌门")?"position-leader":t.includes("长老")?"position-elder":t.includes("真传")?"position-true":t.includes("内门")?"position-inner":"position-outer")])},(0,o.v_)(e.position),3)]),(0,r.Lk)("div",o3,[(0,r.Lk)("span",i3,[(0,r.bF)((0,i.R1)(Ku),{size:12}),(0,r.eW)(" "+(0,o.v_)(e.realm),1)]),(0,r.Lk)("span",{class:(0,o.C4)(["detail-item relation",(n=e.relation,{挚友:"relation-best",好友:"relation-good",友好:"relation-friendly",普通:"relation-normal",冷淡:"relation-cold",敌视:"relation-hostile"}[n]||"relation-normal")])},[(0,r.bF)((0,i.R1)(Wp.A),{size:12}),(0,r.eW)(" "+(0,o.v_)(e.relation),1)],2),e.combat?((0,r.uX)(),(0,r.CE)("span",s3,[(0,r.bF)((0,i.R1)(Ku),{size:12}),(0,r.eW)(" 物"+(0,o.v_)(e.combat.physAtk)+" 特"+(0,o.v_)(e.combat.specAtk)+" 防"+(0,o.v_)(e.combat.physDef)+" 抗"+(0,o.v_)(e.combat.specDef),1)])):(0,r.Q3)("v-if",!0)])]),(0,r.bF)((0,i.R1)(Yc),{size:16,class:"arrow-icon"})],10,Z6);var n,t}),128))]))]),(0,r.Q3)(" 提示信息 "),(0,r.Lk)("div",l3,[(0,r.bF)((0,i.R1)(jc.A),{size:14}),n[20]||(n[20]=(0,r.Lk)("span",null,"同门关系会影响游戏发展，可在对话中与同门互动",-1))])]))}});var d3=t(387),u3={};u3.styleTagTransform=A(),u3.setAttributes=k(),u3.insert=y().bind(null,"head"),u3.domAPI=g(),u3.insertStyleElement=_(),h()(d3.A,u3),d3.A&&d3.A.locals&&d3.A.locals;const p3=(0,E.A)(c3,[["__scopeId","data-v-286f4f64"]]),v3=(0,I.A)("pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),f3=(0,I.A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),h3={class:"sect-contribution"},m3={class:"player-info-bar"},g3={class:"info-item"},b3={class:"info-value position"},y3={class:"info-item highlight"},x3={class:"info-value contribution"},k3={class:"info-actions"},w3=["disabled"],_3={class:"exchange-tabs"},C3=["onClick"],A3={class:"exchange-list"},S3={key:0,class:"empty-state"},L3={key:1,class:"items-grid"},E3={class:"item-header"},T3={class:"item-icon"},I3={class:"item-info"},R3={class:"item-name"},M3={class:"item-desc"},P3={class:"item-footer"},D3={class:"item-cost"},z3={key:0,class:"item-stock"},N3=["disabled","onClick"],$3={class:"exchange-notice"},O3=(0,r.pM)({__name:"SectContributionContent",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)("all"),s=(0,i.KR)(!1),l=[{key:"all",label:"全部",icon:Hc},{key:"药剂",label:"药剂",icon:v3},{key:"功法",label:"技艺",icon:Qu.A},{key:"装备",label:"装备",icon:pM},{key:"材料",label:"材料",icon:vM}],c=(0,r.EW)(()=>n.sectMemberInfo),d=(0,r.EW)(()=>c.value?.职位||"散修"),u=(0,r.EW)(()=>c.value?.贡献||0),p=(0,r.EW)(()=>!!c.value?.势力名称&&!!n.sectSystem),v=(e,n)=>({id:e?.id||e?.物品ID||`sect_item_${n}`,name:e?.name||e?.名称||"未知物品",icon:e?.icon||"O",type:b(String(e?.type||e?.类型||"其他")),quality:e?.quality||e?.品质||"凡品",description:e?.description||e?.描述||"",cost:Number(e?.cost??e?.价格??0),stock:e?.stock??e?.库存}),f=(0,r.EW)(()=>{const e=c.value?.势力名称;if(!e)return[];const t=n.sectSystem?.势力贡献商店?.[e];return Array.isArray(t)?t.map(v):[]}),h=(0,r.EW)(()=>f.value.length>0),m=(0,r.EW)(()=>"all"===a.value?f.value:f.value.filter(e=>e.type===a.value));function g(e){return 0===e.stock?"已售罄":u.value<e.cost?"贡献不足":"兑换"}function b(e){const n=String(e||"").trim();return["药剂","技艺","装备","材料","其他"].includes(n)?n:"丹药"===n||n.includes("丹")||n.includes("药")?"药剂":n.includes("功")||n.includes("技")?"技艺":n.includes("装")||n.includes("器")?"装备":n.includes("材")?"材料":"其他"}async function y(){if(p.value){if(!s.value){s.value=!0;try{const e=String(c.value?.势力名称||"").trim();if(!e)return void _e.o.warning("未加入势力");const a=n.getCurrentSaveData();if(!a)return void _e.o.error("未加载存档，无法生成");const r=n.sectSystem?.势力档案?.[e]??null,o=n.worldInfo,i=n.sectSystem,s=i?.势力贡献商店?.[e]??[],l=Array.isArray(s)?s.map(e=>String(e?.name||e?.名称||"").trim()).filter(Boolean).slice(0,20):[],p=(new Date).toISOString(),v=o?{世界名称:o.世界名称,世界背景:o.世界背景,世界纪元:o.世界纪元}:null,f={势力档案:r,势力成员:i?.势力成员?.[e]},h=`\n# 任务：生成【势力贡献商店】可兑换物品\n你将为势力「${e}」生成贡献点兑换商店的物品条目。\n\n## 输出格式\n只输出 1 个 JSON 对象：\n{"text":"...","items":[...],"evolve_count":1,"last_updated":"${p}"}\n\n## 顶层字段限制\n- 只允许：text / items / evolve_count / last_updated\n- items 必须是数组\n\n## 物品对象字段\n{\n  "id": "string（唯一）",\n  "name": "string（物品名）",\n  "icon": "string（1-2字符）",\n  "type": "药剂|技艺|装备|材料|其他",\n  "quality": "破损|粗糙|普通|精良|稀有|史诗|传说",\n  "description": "string（20-80字）",\n  "cost": number（贡献点）\n}\n可选字段："stock" "使用效果" "限购数量" "职位要求"\n\n## 约束\n- 生成 12-24 件物品，type 至少覆盖 4 类\n- cost 需拉开梯度，高品阶更贵（参考价值倍率：破损0.1x, 粗糙0.5x, 普通1x, 精良5x, 稀有20x, 史诗100x, 传说1000x...）\n- 物品风格必须与势力特色和世界背景匹配\n- description 必须包含具体功效描述\n- stock 为 -1 表示无限，否则为具体库存数（稀有物品库存少）\n\n## 世界背景\n${JSON.stringify(v).slice(0,600)}\n\n## 势力信息\n- 玩家职位：${d.value}\n- 玩家贡献点：${u.value}\n- 势力详情：${JSON.stringify(f).slice(0,1200)}\n\n## 现有物品（避免重复）\n${l.join("，")||"（无）"}\n    `.trim(),m=await(0,ar.e)("生成势力贡献商店",h,!1,"sect_generation"),g=(0,cr.$6)(m,bw.aiService.isForceJsonEnabled("sect_generation"));if(!Array.isArray(g.items))throw new Error("items 字段缺失或不是数组");const b="function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a)),y=b.社交??={},x=y.势力??={};(x.势力贡献商店??={})[e]=g.items;const k=x.内容状态??={},w=k[e]??={},_="number"==typeof w.演变次数?w.演变次数:0,C="number"==typeof g.evolve_count&&Number.isFinite(g.evolve_count)?g.evolve_count:_+1,A="string"==typeof g.last_updated&&g.last_updated.trim()?g.last_updated:p;w.贡献商店已初始化=!0,w.最后更新时间=A,w.演变次数=C,n.loadFromSaveData(b),await t.saveCurrentGame(),_e.o.success("势力贡献商店已更新")}catch(e){console.error("[SectShop] generate failed",e),_e.o.error("生成失败，请稍后重试")}finally{s.value=!1}}}else _e.o.warning("未加入势力或势力数据未加载")}return(e,v)=>((0,r.uX)(),(0,r.CE)("div",h3,[(0,r.Q3)(" 玩家信息栏 "),(0,r.Lk)("div",m3,[(0,r.Lk)("div",g3,[v[0]||(v[0]=(0,r.Lk)("span",{class:"info-label"},"职位",-1)),(0,r.Lk)("span",b3,(0,o.v_)(d.value),1)]),(0,r.Lk)("div",y3,[v[1]||(v[1]=(0,r.Lk)("span",{class:"info-label"},"可用贡献点",-1)),(0,r.Lk)("span",x3,(0,o.v_)(u.value),1)]),(0,r.Lk)("div",k3,[(0,r.Lk)("button",{class:"gen-btn",onClick:y,disabled:s.value||!p.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14,class:(0,o.C4)({spin:s.value})},null,8,["class"]),(0,r.Lk)("span",null,(0,o.v_)(h.value?"换一批":"生成商店"),1)],8,w3)])]),(0,r.Q3)(" 兑换分类 "),(0,r.Lk)("div",_3,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(l,e=>(0,r.Lk)("button",{key:e.key,class:(0,o.C4)(["tab-btn",{active:a.value===e.key}]),onClick:n=>a.value=e.key},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:14})),(0,r.Lk)("span",null,(0,o.v_)(e.label),1)],10,C3)),64))]),(0,r.Q3)(" 兑换物品列表 "),(0,r.Lk)("div",A3,[0===m.value.length?((0,r.uX)(),(0,r.CE)("div",S3,[(0,r.bF)((0,i.R1)(Hc),{size:48,class:"empty-icon"}),v[2]||(v[2]=(0,r.Lk)("p",{class:"empty-text"},"暂无可兑换物品",-1)),v[3]||(v[3]=(0,r.Lk)("p",{class:"empty-hint"},"可兑换物品由AI根据势力设定生成（可在上方点击“生成商店”）",-1))])):((0,r.uX)(),(0,r.CE)("div",L3,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,e=>{return(0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["item-card",{"can-afford":u.value>=e.cost,"out-of-stock":0===e.stock}])},[(0,r.Lk)("div",E3,[(0,r.Lk)("span",T3,(0,o.v_)(e.icon),1),(0,r.Lk)("div",I3,[(0,r.Lk)("span",R3,(0,o.v_)(e.name),1),(0,r.Lk)("span",{class:(0,o.C4)(["item-quality",(a=e.quality,a.includes("传说")?"quality-legend":a.includes("史诗")?"quality-epic":a.includes("稀有")?"quality-rare":a.includes("精良")?"quality-fine":a.includes("普通")?"quality-common":a.includes("粗糙")?"quality-rough":a.includes("破损")?"quality-broken":a.includes("凡")?"quality-common":a.includes("黄")?"quality-fine":a.includes("玄")?"quality-rare":a.includes("地")?"quality-epic":a.includes("天")?"quality-legend":"quality-common")])},(0,o.v_)(e.quality),3)])]),(0,r.Lk)("p",M3,(0,o.v_)(e.description),1),(0,r.Lk)("div",P3,[(0,r.Lk)("div",D3,[(0,r.bF)((0,i.R1)(rp),{size:14}),(0,r.Lk)("span",null,(0,o.v_)(e.cost)+" 贡献",1)]),void 0!==e.stock?((0,r.uX)(),(0,r.CE)("div",z3,[(0,r.bF)((0,i.R1)(Hc),{size:12}),(0,r.Lk)("span",null,(0,o.v_)(e.stock>0?`剩余 ${e.stock}`:"已售罄"),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("button",{class:"exchange-btn",disabled:u.value<e.cost||0===e.stock,onClick:a=>async function(e){if(p.value)if(u.value<e.cost)_e.o.warning("贡献不足");else if(0!==e.stock)try{const a=String(c.value?.势力名称||"").trim();if(!a)return void _e.o.warning("未加入势力");const r=n.getCurrentSaveData();if(!r)return void _e.o.error("未加载存档，无法兑换");const o="function"==typeof structuredClone?structuredClone(r):JSON.parse(JSON.stringify(r)),i=o.社交??={},s=i.势力??={},l=s.成员信息??={},d=Number(l.贡献??0);if(!Number.isFinite(d)||d<e.cost)return void _e.o.warning("贡献不足（存档数据不同步）");l.贡献=Math.max(0,Math.floor(d-e.cost));const u=s.势力贡献商店??={},p=Array.isArray(u[a])?u[a]:[],v=p.findIndex(n=>String(n?.id||n?.物品ID||"")===e.id);if(v>=0){const e=p[v],n=e?.库存??e?.stock,t=void 0===n?void 0:Number(n);if(void 0!==t&&Number.isFinite(t)){const n=Math.max(0,Math.floor(t)-1);"库存"in e&&(e.库存=n),"stock"in e&&(e.stock=n),"库存"in e||"stock"in e||(e.库存=n)}p[v]=e,u[a]=p}const f=(o.角色??={}).背包??={},h=f.物品??={},m=`item_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,g=function(e){const n=String(e||"").trim()||"凡品";return n.endsWith("品")?n:`${n}品`}(String(e.quality||"凡品")),y=b(String(e.type||"其他"));h[m]={物品ID:m,名称:e.name,类型:y,品质:{quality:g,grade:0},数量:1,描述:e.description||`势力兑换所得之物：${e.name}。`,..."技艺"===y?{技艺效果:e.description||"",技艺条目:[{技能名称:`${e.name}·入门`,技能描述:"基础训练条目。",熟练度要求:0,消耗:"能量5%"}],修炼进度:0,已解锁技能:[],已装备:!1}:{}},n.loadFromSaveData(o),n.addToShortTermMemory(`【势力兑换】以${e.cost}贡献兑换「${e.name}」。`),await t.saveCurrentGame(),_e.o.success("兑换成功，已放入背包")}catch(e){console.error("[SectContribution] exchange failed",e),_e.o.error("兑换失败")}else _e.o.warning("已售罄");else _e.o.warning("未加入势力或势力数据未加载")}(e)},[(0,r.bF)((0,i.R1)(f3),{size:14}),(0,r.Lk)("span",null,(0,o.v_)(g(e)),1)],8,N3)],2);var a}),128))]))]),(0,r.Q3)(" 贡献获取途径 "),(0,r.Lk)("div",$3,[(0,r.bF)((0,i.R1)(jc.A),{size:14}),v[4]||(v[4]=(0,r.Lk)("span",null,"兑换会直接扣除贡献并把物品放入背包（不会发送到主对话）。",-1))])]))}});var F3=t(8179),j3={};j3.styleTagTransform=A(),j3.setAttributes=k(),j3.insert=y().bind(null,"head"),j3.domAPI=g(),j3.insertStyleElement=_(),h()(F3.A,j3),F3.A&&F3.A.locals&&F3.A.locals;const B3=(0,E.A)(O3,[["__scopeId","data-v-2e20bd6d"]]),X3=(0,I.A)("list",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),U3=(0,I.A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),W3={class:"sect-tasks"},q3={class:"player-info-bar"},G3={class:"info-item"},H3={class:"info-value position"},V3={class:"info-item highlight"},Q3={class:"info-value contribution"},K3={class:"info-actions"},Y3=["disabled"],J3={class:"task-filters"},Z3=["onClick"],e8={class:"task-list"},n8={key:0,class:"empty-state"},t8={key:1,class:"task-grid"},a8={class:"task-header"},r8={class:"task-title"},o8={class:"task-name"},i8={class:"task-desc"},s8={class:"task-meta"},l8={class:"meta-item"},c8={class:"meta-item"},d8={key:0,class:"meta-item"},u8={key:1,class:"meta-item"},p8={key:2,class:"meta-item"},v8={key:3,class:"meta-item"},f8={class:"task-actions"},h8=["onClick"],m8={key:1,class:"task-in-progress"},g8=["onClick"],b8={key:3,class:"task-done"},y8={class:"task-notice"},x8=(0,r.pM)({__name:"SectTasksContent",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)("all"),s=(0,i.KR)(!1),l=[{key:"all",label:"全部",icon:X3},{key:"可接取",label:"可接取",icon:cj},{key:"进行中",label:"进行中",icon:ap},{key:"已完成",label:"已完成",icon:U3}],c=(0,r.EW)(()=>n.sectMemberInfo),d=(0,r.EW)(()=>c.value?.职位||"散修"),u=(0,r.EW)(()=>c.value?.贡献||0),p=(0,r.EW)(()=>!!c.value?.势力名称&&!!n.sectSystem),v=(0,r.EW)(()=>h().length>0);function f(e,n){const t=Number(e?.贡献奖励??e?.reward_contribution??e?.reward?.贡献??e?.reward??0),a=function(e){const n=String(e??"").trim();return n?n.includes("可接取")||/available|open|accept/i.test(n)?"可接取":n.includes("进行")||/in[- ]?progress|ongoing/i.test(n)?"进行中":n.includes("完成")||/done|completed|finished/i.test(n)?"已完成":n:"可接取"}(e?.状态??e?.status),r=function(e){const n=String(e??"").trim();return n?n.includes("低")||/low/i.test(n)?"低":n.includes("中")||/mid|medium/i.test(n)?"中":n.includes("高")||/high/i.test(n)?"高":n.includes("极")||/extreme|legendary/i.test(n)?"极":n:"中"}(e?.难度??e?.difficulty);return{任务ID:e?.任务ID||e?.id||`sect_task_${n}`,任务名称:e?.任务名称||e?.name||"任务",任务描述:e?.任务描述||e?.description||"",任务类型:e?.任务类型||e?.type||"日常",难度:r,贡献奖励:Number.isFinite(t)?t:0,额外奖励:e?.额外奖励||e?.reward_extra||e?.reward?.额外奖励||"",状态:a,期限:e?.期限||e?.deadline||"",发布人:e?.发布人||e?.publisher||"",要求:e?.要求||e?.requirements||""}}function h(){const e=c.value?.势力名称;if(!e)return[];const t=n.sectSystem?.势力任务?.[e];return Array.isArray(t)?t.map(f):[]}const m=(0,r.EW)(()=>{const e=h().map(e=>({...e,statusClass:"进行中"===e.状态?"in-progress":"已完成"===e.状态?"completed":"available"}));return"all"===a.value?e:e.filter(e=>e.状态===a.value)});async function g(e){const a=String(c.value?.势力名称||"").trim();if(!a)return;const r=n.getCurrentSaveData();if(!r)return void _e.o.error("未找到当前存档");const o="function"==typeof structuredClone?structuredClone(r):JSON.parse(JSON.stringify(r)),i=o.社交??={},s=i.势力??={},l=s.势力任务??={},d=Array.isArray(l[a])?l[a].map(f):[];l[a]=e(d),n.loadFromSaveData(o),await t.saveCurrentGame()}async function b(){if(p.value){if(!s.value){s.value=!0;try{const e=String(c.value?.势力名称||"").trim();if(!e)return void _e.o.warning("无法识别势力名称");const a=n.getCurrentSaveData();if(!a)return void _e.o.error("未找到当前存档");const r=n.sectSystem?.势力档案?.[e]??null,o=n.worldInfo,i=n.sectSystem,s=i?.势力任务?.[e]??[],l=Array.isArray(s)?s.map(e=>String(e?.任务名称||e?.name||"").trim()).filter(Boolean).slice(0,20):[],p=(new Date).toISOString(),v=o?{世界名称:o.世界名称,世界背景:o.世界背景,世界纪元:o.世界纪元,大陆信息:(o.大陆信息||[]).slice(0,3).map(e=>e.名称||e.name)}:null,h={势力档案:r,势力成员:i?.势力成员?.[e],势力关系:i?.势力关系?.[e]},m=`\n# 任务：生成【势力任务】列表（单次功能请求）\n你将为势力「${e}」生成任务条目。\n\n## 输出格式（必须）\n只输出 1 个 JSON 对象：\n{"text":"...","tasks":[...],"evolve_count":1,"last_updated":"${p}"}\n\n## 顶层字段严格限制\n- 顶层只允许：text / tasks / evolve_count / last_updated\n- 禁止输出额外字段（tavern_commands / action_options / 社交 / 宗门 / 系统 等）\n- tasks 必须是数组\n- 禁止输出代码块或额外文本\n\n## 任务对象字段\n{\n  "任务ID": "string（唯一）",\n  "任务名称": "string",\n  "任务描述": "string（20-100字）",\n  "任务类型": "巡逻|采集|护送|清理异常|求援|侦查|制药|制造|内门事务|秘境",\n  "难度": "低|中|高|极",\n  "贡献奖励": number,\n  "额外奖励": "string or empty",\n  "状态": "可接取"\n}\n可选字段："期限", "发布人", "要求"\n\n## 约束\n- 生成 6-12 个任务，至少 4 个可接取\n- 奖励梯度：低(10-80) 中(80-200) 高(200-400) 极(400-800)\n- 任务内容必须与宗门特色和世界背景匹配\n- text 字段写简短提示即可\n\n## 世界背景\n${JSON.stringify(v).slice(0,800)}\n\n    ## 势力信息\n- 玩家职位：${d.value}\n- 玩家贡献点：${u.value}\n- 势力详情：${JSON.stringify(h).slice(0,1500)}\n\n## 现有任务（避免重复）\n${l.join("，")||"（无）"}\n    `.trim(),g=await(0,ar.e)("生成势力任务",m,!1,"sect_generation"),b=(0,cr.$6)(g,bw.aiService.isForceJsonEnabled("sect_generation"));if(!Array.isArray(b.tasks))throw new Error("tasks field missing or invalid");const y=b.tasks.map((e,n)=>f(e,n)),x="function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a)),k=x.社交??={},w=k.势力??={};(w.势力任务??={})[e]=y;const _=w.势力任务状态??={},C=_[e]??={},A="number"==typeof C.演变次数?C.演变次数:0,S="number"==typeof b.evolve_count&&Number.isFinite(b.evolve_count)?b.evolve_count:A+1,L="string"==typeof b.last_updated&&b.last_updated.trim()?b.last_updated:p;C.已初始化=!0,C.最后更新时间=L,C.演变次数=S,n.loadFromSaveData(x),await t.saveCurrentGame(),_e.o.success("势力任务已更新")}catch(e){console.error("[SectTasks] generate failed",e),_e.o.error("生成势力任务失败")}finally{s.value=!1}}}else _e.o.warning("未加入势力或势力数据未加载")}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",W3,[(0,r.Lk)("div",q3,[(0,r.Lk)("div",G3,[n[0]||(n[0]=(0,r.Lk)("span",{class:"info-label"},"职位",-1)),(0,r.Lk)("span",H3,(0,o.v_)(d.value),1)]),(0,r.Lk)("div",V3,[n[1]||(n[1]=(0,r.Lk)("span",{class:"info-label"},"当前贡献点",-1)),(0,r.Lk)("span",Q3,(0,o.v_)(u.value),1)]),(0,r.Lk)("div",K3,[(0,r.Lk)("button",{class:"gen-btn",onClick:b,disabled:s.value||!p.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14,class:(0,o.C4)({spin:s.value})},null,8,["class"]),(0,r.Lk)("span",null,(0,o.v_)(v.value?"刷新任务":"生成任务"),1)],8,Y3)])]),(0,r.Lk)("div",J3,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(l,e=>(0,r.Lk)("button",{key:e.key,class:(0,o.C4)(["filter-btn",{active:a.value===e.key}]),onClick:n=>a.value=e.key},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:14})),(0,r.Lk)("span",null,(0,o.v_)(e.label),1)],10,Z3)),64))]),(0,r.Lk)("div",e8,[0===m.value.length?((0,r.uX)(),(0,r.CE)("div",n8,[(0,r.bF)((0,i.R1)(ap),{size:48,class:"empty-icon"}),n[2]||(n[2]=(0,r.Lk)("p",{class:"empty-text"},"暂无势力任务",-1)),n[3]||(n[3]=(0,r.Lk)("p",{class:"empty-hint"},"任务将由AI根据势力设定生成（可在上方点击“生成任务”）",-1))])):((0,r.uX)(),(0,r.CE)("div",t8,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,e=>{return(0,r.uX)(),(0,r.CE)("div",{key:e.任务ID,class:(0,o.C4)(["task-card",e.statusClass])},[(0,r.Lk)("div",a8,[(0,r.Lk)("div",r8,[(0,r.Lk)("span",o8,(0,o.v_)(e.任务名称),1),(0,r.Lk)("span",{class:(0,o.C4)(["task-difficulty",(n=e.难度,n.includes("低")?"diff-low":n.includes("中")?"diff-mid":n.includes("高")?"diff-high":n.includes("极")?"diff-extreme":"diff-mid")])},(0,o.v_)(e.难度),3)]),(0,r.Lk)("span",{class:(0,o.C4)(["task-status",e.statusClass])},(0,o.v_)(e.状态),3)]),(0,r.Lk)("p",i8,(0,o.v_)(e.任务描述),1),(0,r.Lk)("div",s8,[(0,r.Lk)("span",l8,"类型："+(0,o.v_)(e.任务类型),1),(0,r.Lk)("span",c8,"贡献奖励："+(0,o.v_)(e.贡献奖励),1),e.额外奖励?((0,r.uX)(),(0,r.CE)("span",d8,"额外奖励："+(0,o.v_)(e.额外奖励),1)):(0,r.Q3)("v-if",!0),e.期限?((0,r.uX)(),(0,r.CE)("span",u8,"期限："+(0,o.v_)(e.期限),1)):(0,r.Q3)("v-if",!0),e.发布人?((0,r.uX)(),(0,r.CE)("span",p8,"发布人："+(0,o.v_)(e.发布人),1)):(0,r.Q3)("v-if",!0),e.要求?((0,r.uX)(),(0,r.CE)("span",v8,"要求："+(0,o.v_)(e.要求),1)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",f8,["可接取"===e.状态?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"task-btn primary",onClick:n=>async function(e){await g(n=>n.map(n=>n.任务ID!==e||"可接取"!==n.状态?n:{...n,状态:"进行中"})),hw(`已接取势力任务：${e}`),_e.o.success("已接取任务")}(e.任务ID)}," 接取 ",8,h8)):(0,r.Q3)("v-if",!0),"进行中"===e.状态?((0,r.uX)(),(0,r.CE)("span",m8,"进行中")):(0,r.Q3)("v-if",!0),"进行中"===e.状态?((0,r.uX)(),(0,r.CE)("button",{key:2,class:"task-btn ghost",onClick:n=>async function(e){await g(n=>n.map(n=>n.任务ID!==e||"进行中"!==n.状态?n:{...n,状态:"可接取"})),_e.o.info("已放弃任务")}(e.任务ID)}," 放弃 ",8,g8)):(0,r.Q3)("v-if",!0),"已完成"===e.状态?((0,r.uX)(),(0,r.CE)("span",b8,"已完成")):(0,r.Q3)("v-if",!0)])],2);var n}),128))]))]),(0,r.Lk)("div",y8,[(0,r.bF)((0,i.R1)(jc.A),{size:14}),n[4]||(n[4]=(0,r.Lk)("span",null,"任务完成由AI根据剧情判断，完成后自动发放奖励",-1))])]))}});var k8=t(7228),w8={};w8.styleTagTransform=A(),w8.setAttributes=k(),w8.insert=y().bind(null,"head"),w8.domAPI=g(),w8.insertStyleElement=_(),h()(k8.A,w8),k8.A&&k8.A.locals&&k8.A.locals;const _8=(0,E.A)(x8,[["__scopeId","data-v-643b56f2"]]),C8=(0,I.A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),A8={class:"sect-manage"},S8={class:"header"},L8={class:"kv"},E8={class:"v"},T8={class:"kv"},I8={class:"v"},R8={class:"actions"},M8=["disabled"],P8=["disabled"],D8={key:0,class:"notice"},z8={key:1,class:"empty"},N8={key:2,class:"content"},$8={class:"grid"},O8={class:"card"},F8={class:"row"},j8={class:"v"},B8={class:"row"},X8={class:"v"},U8={class:"row"},W8={class:"v"},q8={class:"row"},G8={class:"v"},H8={class:"card"},V8={class:"row"},Q8={class:"v"},K8={class:"row"},Y8={class:"v"},J8={class:"row"},Z8={class:"v"},e4={class:"row"},n4={class:"v"},t4={class:"card"},a4={class:"row"},r4={class:"v"},o4={class:"row"},i4={class:"v"},s4={class:"row"},l4={class:"v"},c4={class:"row"},d4={class:"v"},u4={class:"card logs"},p4={key:0,class:"muted"},v4={key:1,class:"log-list"},f4={class:"log-top"},h4={class:"badge"},m4={key:0,class:"muted"},g4={class:"log-text"},b4={class:"tip"},y4=(0,r.pM)({__name:"SectManagementContent",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)(!1),s=(0,r.EW)(()=>n.character?.名字||""),l=(0,r.EW)(()=>{const e=n.getCurrentSaveData(),t=e?.世界?.信息;return t?.势力信息||[]}),c=(0,r.EW)(()=>(0,P5.Z)(s.value,l.value,n.sectMemberInfo)),d=(0,r.EW)(()=>n.sectMemberInfo),u=(0,r.EW)(()=>String(n.sectSystem?.当前势力||"").trim()),p=(0,r.EW)(()=>{const e=String(d.value?.势力名称||"").trim();if(e)return e;const t=String(c.value.sectName||"").trim();return t||(u.value?u.value:String((n.sectSystem?.成员信息?.势力名称??"")||"").trim())}),v=(0,r.EW)(()=>p.value||"未加入势力"),f=(0,r.EW)(()=>{const e=String(c.value.position||"").trim();if(e)return e;return String(d.value?.职位||"").trim()||"散修"}),h=(0,r.EW)(()=>c.value.isLeader||(0,P5.b)(f.value)),m=(0,r.EW)(()=>!!p.value&&h.value),g=(0,r.EW)(()=>{const e=String(p.value||"").trim();return e?n.sectSystem?.势力经营?.[e]??null:null});function b(e){const n=Number(e);return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function y(e,n){const t=g.value;if(!t||!t.府库||"object"!=typeof t.府库)return 0;const a=t.府库;return b(a[e]??a[n])}function x(e,n){const t=g.value;if(!t||!t.设施||"object"!=typeof t.设施)return 0;const a=t.设施;return b(a[e]??a[n])}function k(e){return Object.entries(e).slice(0,6).map(([e,n])=>`${e}${n>=0?"+":""}${n}`).join("，")}async function w(e,a){const r=(0,cr.p_)(e),{saveData:o}=await gw.J.processGmResponse(r,a,!1,void 0,{appendNarrativeHistory:!1});try{if(String(p.value||"").trim()){const e=o.社交??={},n=e.势力??={};n.势力经营??={}}}catch{}n.loadFromSaveData(o),await t.saveCurrentGame()}async function _(){if(d.value?.势力名称)return;const e=String(c.value.sectName||"").trim();if(!e)return;const a=(new Date).toISOString(),r=l.value.find(n=>String(n.名称||"").trim()===e)??null,o={势力名称:e,势力类型:r?.类型||"正道势力",职位:c.value.position||"首领",贡献:0,关系:"友好",声望:0,加入日期:a,描述:r?.描述||""};n.updateState("sectMemberInfo",o),n.sectSystem?u.value||n.updateState("sectSystem.当前势力",e):n.updateState("sectSystem",{版本:2,当前势力:e,势力档案:r?{[e]:r}:{},势力成员:{},势力功法库:{},势力贡献商店:{},势力任务:{},势力任务状态:{}}),await t.saveCurrentGame()}async function C(){if(m.value&&!a.value){a.value=!0;try{await _();const e=String(p.value||"").trim();if(!e)return void _e.o.warning("未加入势力");const t=n.getCurrentSaveData();if(!t)return void _e.o.error("存档数据不完整或未加载，无法生成");const a=n.sectSystem?.势力档案?.[e]??null,r=`\n# 任务：初始化【势力经营】数据（单次功能请求）\n为势力「${e}」写入轻度经营数据，用于首领面板与势力大战结算。\n\n## 输出格式（必须）\n只输出 1 个 JSON 对象：\n{"text":"...","mid_term_memory":"（50-100字：本次初始化的关键摘要）","tavern_commands":[...],"action_options":[]}\n\n## 写入路径（必须）\n- 社交.势力.势力经营.${e} : 完整覆盖\n\n## 对象结构（必须）\n{"势力名称":"${e}","战力":number,"安定":number,"外门训练度":number,"府库":{"突变结晶":number,"稀有材料":number,"药剂":number,"防御模块":number},"设施":{"训练室":number,"技艺档案库":number,"制造车间":number,"防御网络":number},"最近结算":"${(new Date).toISOString()}","月报":[]}\n\n## 数值约束（必须）\n- 战力：优先用势力档案.领导层.综合战力（若缺失则 30-80）\n- 安定 55-85，外门训练度 35-75\n- 突变结晶 20000-200000，灵材/药剂/阵材 0-5000，设施等级 0-5\n- 所有数值不得为负\n\n## 势力档案（参考）\n${JSON.stringify(a).slice(0,1200)}\n    `.trim(),o=await(0,ar.e)("初始化势力经营",r,!1,"sect_generation");await w(o,t),_e.o.success("势力经营数据已更新")}catch(e){console.error("[SectManage] init failed",e),_e.o.error("初始化失败")}finally{a.value=!1}}}async function A(){if(m.value&&g.value&&!a.value){a.value=!0;try{await _();const e=String(p.value||"").trim();if(!e)return void _e.o.warning("未加入势力");const t=n.getCurrentSaveData();if(!t)return void _e.o.error("存档数据不完整或未加载，无法结算");const a=(new Date).toISOString(),r=`\n# 任务：势力经营【结算一旬】（单次功能请求）\n为势力「${e}」进行一次轻度结算（不推进元数据.时间），更新府库/安定/训练度/战力，并追加一条月报记录。\n\n## 随机因子（必须使用，不要自行重掷）\nd20=${function(){const e=Math.floor(20*Math.random())+1;return 1===e&&Math.random()<.5?Math.floor(20*Math.random())+1:e}()}\n\n## 输出格式（必须）\n只输出 1 个 JSON 对象：\n{"text":"...","mid_term_memory":"（50-100字：本次结算的关键摘要）","tavern_commands":[...],"action_options":[]}\n\n## 写入路径（必须）\n- 社交.势力.势力经营.${e} : 建议 set 完整覆盖（或精准修改）\n\n## 约束（必须）\n- 不允许修改：元数据.时间\n- 所有数值不得为负\n- 战力/安定/训练度 单次变化不超过 8 点\n- 府库.突变结晶 单次变化建议在 -3000~+12000（根据d20与设施等级）\n- 必须追加月报：push 到 社交.势力.势力经营.${e}.月报 一个对象：\n  {"时间":"${a}","摘要":"...","变化":{"突变结晶":+n,"安定":+n,"外门训练度":+n,"战力":+n}}\n- 更新 最近结算 为 "${a}"\n\n## 当前经营数据（必须以此为准）\n${JSON.stringify(g.value).slice(0,1200)}\n    `.trim(),o=await(0,ar.e)("势力经营-结算一旬",r,!1,"sect_generation");await w(o,t),_e.o.success("已结算一旬")}catch(e){console.error("[SectManage] settle failed",e),_e.o.error("结算失败")}finally{a.value=!1}}}return(e,n)=>((0,r.uX)(),(0,r.CE)("div",A8,[(0,r.Lk)("div",S8,[(0,r.Lk)("div",L8,[n[0]||(n[0]=(0,r.Lk)("span",{class:"k"},"所属势力",-1)),(0,r.Lk)("span",E8,(0,o.v_)(v.value),1)]),(0,r.Lk)("div",T8,[n[1]||(n[1]=(0,r.Lk)("span",{class:"k"},"职位",-1)),(0,r.Lk)("span",I8,(0,o.v_)(f.value),1)]),(0,r.Lk)("div",R8,[(0,r.Lk)("button",{class:"btn",onClick:C,disabled:a.value||!m.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14,class:(0,o.C4)({spin:a.value})},null,8,["class"]),(0,r.Lk)("span",null,(0,o.v_)(g.value?"重置":"初始化"),1)],8,M8),(0,r.Lk)("button",{class:"btn primary",onClick:A,disabled:a.value||!m.value||!g.value},[(0,r.bF)((0,i.R1)(C8),{size:14}),n[2]||(n[2]=(0,r.Lk)("span",null,"结算一旬",-1))],8,P8)])]),m.value?g.value?((0,r.uX)(),(0,r.CE)("div",N8,[(0,r.Lk)("div",$8,[(0,r.Lk)("div",O8,[n[10]||(n[10]=(0,r.Lk)("div",{class:"card-title"},"核心面板",-1)),(0,r.Lk)("div",F8,[n[6]||(n[6]=(0,r.Lk)("span",{class:"k"},"战力",-1)),(0,r.Lk)("span",j8,(0,o.v_)(b(g.value.战力))+"/100",1)]),(0,r.Lk)("div",B8,[n[7]||(n[7]=(0,r.Lk)("span",{class:"k"},"安定",-1)),(0,r.Lk)("span",X8,(0,o.v_)(b(g.value.安定))+"/100",1)]),(0,r.Lk)("div",U8,[n[8]||(n[8]=(0,r.Lk)("span",{class:"k"},"外门训练度",-1)),(0,r.Lk)("span",W8,(0,o.v_)(b(g.value.外门训练度))+"/100",1)]),(0,r.Lk)("div",q8,[n[9]||(n[9]=(0,r.Lk)("span",{class:"k"},"最近结算",-1)),(0,r.Lk)("span",G8,(0,o.v_)(g.value.最近结算||"未知"),1)])]),(0,r.Lk)("div",H8,[n[15]||(n[15]=(0,r.Lk)("div",{class:"card-title"},"仓库",-1)),(0,r.Lk)("div",V8,[n[11]||(n[11]=(0,r.Lk)("span",{class:"k"},"突变结晶",-1)),(0,r.Lk)("span",Q8,(0,o.v_)(y("突变结晶","突变结晶")),1)]),(0,r.Lk)("div",K8,[n[12]||(n[12]=(0,r.Lk)("span",{class:"k"},"稀有材料",-1)),(0,r.Lk)("span",Y8,(0,o.v_)(y("稀有材料","灵材")),1)]),(0,r.Lk)("div",J8,[n[13]||(n[13]=(0,r.Lk)("span",{class:"k"},"药剂",-1)),(0,r.Lk)("span",Z8,(0,o.v_)(y("药剂","药剂")),1)]),(0,r.Lk)("div",e4,[n[14]||(n[14]=(0,r.Lk)("span",{class:"k"},"防御模块",-1)),(0,r.Lk)("span",n4,(0,o.v_)(y("防御模块","阵材")),1)])]),(0,r.Lk)("div",t4,[n[20]||(n[20]=(0,r.Lk)("div",{class:"card-title"},"设施等级",-1)),(0,r.Lk)("div",a4,[n[16]||(n[16]=(0,r.Lk)("span",{class:"k"},"训练室",-1)),(0,r.Lk)("span",r4,(0,o.v_)(x("训练室","练功房")),1)]),(0,r.Lk)("div",o4,[n[17]||(n[17]=(0,r.Lk)("span",{class:"k"},"技艺档案库",-1)),(0,r.Lk)("span",i4,(0,o.v_)(x("技艺档案库","藏经阁")),1)]),(0,r.Lk)("div",s4,[n[18]||(n[18]=(0,r.Lk)("span",{class:"k"},"制造车间",-1)),(0,r.Lk)("span",l4,(0,o.v_)(x("制造车间","制造车间")),1)]),(0,r.Lk)("div",c4,[n[19]||(n[19]=(0,r.Lk)("span",{class:"k"},"防御网络",-1)),(0,r.Lk)("span",d4,(0,o.v_)(x("防御网络","护山大阵")),1)])])]),(0,r.Lk)("div",u4,[n[21]||(n[21]=(0,r.Lk)("div",{class:"card-title"},"月报（最近）",-1)),g.value.月报?.length?((0,r.uX)(),(0,r.CE)("div",v4,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value.月报.slice(-8).reverse(),(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.时间}-${n}`,class:"log"},[(0,r.Lk)("div",f4,[(0,r.Lk)("span",h4,(0,o.v_)(e.时间),1),e.变化?((0,r.uX)(),(0,r.CE)("span",m4,"变化："+(0,o.v_)(k(e.变化)),1)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",g4,(0,o.v_)(e.摘要),1)]))),128))])):((0,r.uX)(),(0,r.CE)("div",p4,"暂无月报"))]),(0,r.Lk)("div",b4,[(0,r.bF)((0,i.R1)(jc.A),{size:14}),n[22]||(n[22]=(0,r.Lk)("span",null,"该面板为轻度经营：一键结算即可，不推进游戏时间；势力大战会读取这里的府库/训练度做修正。",-1))])])):((0,r.uX)(),(0,r.CE)("div",z8,[(0,r.bF)((0,i.R1)(tp),{size:42}),n[4]||(n[4]=(0,r.Lk)("div",{class:"empty-text"},"尚未初始化势力经营数据",-1)),n[5]||(n[5]=(0,r.Lk)("div",{class:"empty-hint"},"点击“初始化”生成府库、安定、训练度与设施等级。",-1))])):((0,r.uX)(),(0,r.CE)("div",D8,[(0,r.bF)((0,i.R1)(jc.A),{size:14}),n[3]||(n[3]=(0,r.Lk)("span",null,"需要加入势力且担任首领/副首领后，才能使用势力经营面板。",-1))]))]))}});var x4=t(3466),k4={};k4.styleTagTransform=A(),k4.setAttributes=k(),k4.insert=y().bind(null,"head"),k4.domAPI=g(),k4.insertStyleElement=_(),h()(x4.A,k4),x4.A&&x4.A.locals&&x4.A.locals;const w4=(0,E.A)(y4,[["__scopeId","data-v-4c00416a"]]),_4=(0,I.A)("fast-forward",[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]]),C4=(0,I.A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),A4=(e,n,t)=>Math.max(n,Math.min(t,e)),S4=(e,n=0)=>{const t=Number(e);return Number.isFinite(t)?t:n},L4=(e,n=0)=>Math.max(0,Math.floor(S4(e,n)));function E4(e,n){const t=Math.ceil(e),a=Math.floor(n);return Math.floor(Math.random()*(a-t+1))+t}function T4(e,n){const t=function(e,n){const t=e?.世界?.信息?.势力信息??[],a=String(n||"").trim();return a?t.find(e=>String(e?.名称||"").trim()===a)??null:null}(e,n),a=function(e,n){const t=String(n||"").trim();return t?(e?.社交?.势力?.势力经营??e?.社交?.宗门?.宗门经营??null)?.[t]??null:null}(e,n),{value:r,from:o}=function(e){const n=e?.领导层??null,t=S4(n?.综合战力,NaN);if(Number.isFinite(t)&&t>0)return{value:A4(Math.round(t),1,100),from:"势力档案.领导层.综合战力"};const a=S4(e?.综合战力,NaN);return Number.isFinite(a)&&a>0?{value:A4(Math.round(a),1,100),from:"势力档案.综合战力"}:{value:55,from:"默认值(55)"}}(t),i=function(e){const n=L4(e?.成员数量?.总数,0),t=e?.成员数量?.按阶段??e?.成员数量?.按觉醒阶段??null;if(t&&"object"==typeof t){const e=L4(t.觉醒期,0)+L4(t.觉醒,0),n=L4(t.掌控期,0)+L4(t.掌控,0),a=L4(t.精通期,0)+L4(t.精通,0),r=L4(t.质变期,0)+L4(t.质变,0),o=L4(t.突破期,0)+L4(t.突破,0),i=L4(t.练气,0)+L4(t.练气期,0),s=L4(t.筑基,0)+L4(t.筑基期,0),l=L4(t.金丹,0)+L4(t.金丹期,0),c=Object.entries(t).reduce((e,[n,t])=>["觉醒期","觉醒","掌控期","掌控","精通期","精通","质变期","质变","突破期","突破","练气","练气期","筑基","筑基期","金丹","金丹期"].includes(n)?e:e+L4(t,0),0);return{outer:e+i,inner:n+s,core:a+r+o+l+c}}return n?{outer:Math.max(0,Math.round(.75*n)),inner:Math.max(0,Math.round(.22*n)),core:Math.max(0,n-Math.round(.75*n)-Math.round(.22*n))}:{outer:50,inner:20,core:5}}(t),s=i.outer+i.inner+i.core,l=A4(L4(a?.战力,0),0,100),c=A4(L4(a?.安定,60),0,100),d=A4(L4(a?.外门训练度,55),0,100),u=L4(a?.府库?.突变结晶,0),p=function(e){const n=e?.设施??null;if(!n||"object"!=typeof n)return 0;const t=Object.values(n).map(e=>S4(e,0)).filter(e=>Number.isFinite(e));return t.length?t.reduce((e,n)=>e+n,0)/t.length:0}(a),v=A4(Math.round((.02*i.outer+.06*i.inner+.25*i.core)/10),0,15),f=Math.round((c-60)/10),h=Math.round((d-55)/12),m=A4(Math.round(p/2),0,6),g=A4(Math.round(Math.log10(Math.max(10,u))-3),0,5),b=[{label:`基准战力（${o}）`,value:r}];let y=r;if(l>0){const e=Math.round((l-50)/10);b.push({label:"经营战力修正",value:e,note:`宗门经营.战力=${l}`}),y+=e}b.push({label:"成员结构修正",value:v,note:`外门${i.outer}/内门${i.inner}/核心${i.core}`}),b.push({label:"安定修正",value:f,note:`安定=${c}`}),b.push({label:"训练度修正",value:h,note:`外门训练度=${d}`}),b.push({label:"设施修正",value:m,note:`设施均值≈${p.toFixed(1)}`}),b.push({label:"府库修正",value:g,note:`突变结晶=${u}`});const x=A4(Math.round(y+v+f+h+m+g),1,100),k=A4(60+3*f+2*h,35,95);return{side:{势力名称:String(n||"").trim(),战力:x,外门:i.outer,内门:i.inner,核心:i.core,士气:k},breakdown:b,meta:{baseFrom:o,totalMembers:s,facilityAvg:p,treasuryStone:u}}}function I4(e,n){return{...e,外门:A4(e.外门-n.外门,0,1e6),内门:A4(e.内门-n.内门,0,1e6),核心:A4(e.核心-n.核心,0,1e6)}}function R4(e,n,t){const a=Math.max(1,Math.round(e*n*.03*t));return A4(a,0,Math.max(1,Math.round(.25*e)))}function M4(e,n){const t=n.外门+n.内门+n.核心;if(t<=0)return{外门:e,内门:0,核心:0};const a=Math.round(e*n.外门/t),r=Math.round(e*n.内门/t);return{外门:a,内门:r,核心:Math.max(0,e-a-r)}}function P4(e){const{war:n,stage:t,nowIso:a}=e,r="number"==typeof e.roll?A4(Math.floor(e.roll),1,20):E4(1,20),o=n.我方,i=n.敌方,s=function(e){switch(e){case"侦察":return.35;case"交锋":return.9;case"破阵":return.75;case"攻山":return 1.15;case"善后":return.25;default:return.8}}(t),l=S4(o.战力,50)+S4(o.士气,60)/10,c=S4(i.战力,50)+S4(i.士气,60)/10,d=Math.round(l-c+(r-10)),u=function(e){return e>=14?"大成功":e>=7?"成功":e>=0?"小胜":e>=-7?"小败":e>=-14?"失败":"大失败"}(d),p=Math.max(1,o.外门+o.内门+o.核心),v=Math.max(1,i.外门+i.内门+i.核心),f=d>=0?1.25:.75,h=R4(p,s,d>=0?.75:1.25),m=R4(v,s,f),g=d>=0?{外门:70,内门:24,核心:6}:{外门:82,内门:16,核心:2},b=M4(h,d>=0?{外门:82,内门:16,核心:2}:{外门:70,内门:24,核心:6}),y=M4(m,g),x=A4(Math.round(d/6),-8,6),k=A4(Math.round(-d/6),-8,6);return{war:{...n,我方:I4({...o,士气:A4(S4(o.士气,60)+x,0,100),战力:A4(S4(o.战力,50)+Math.round(d/20),1,100)},b),敌方:I4({...i,士气:A4(S4(i.士气,60)+k,0,100),战力:A4(S4(i.战力,50)+Math.round(-d/20),1,100)},y),累计伤亡:{我方:{外门:(n.累计伤亡?.我方?.外门??0)+b.外门,内门:(n.累计伤亡?.我方?.内门??0)+b.内门,核心:(n.累计伤亡?.我方?.核心??0)+b.核心},敌方:{外门:(n.累计伤亡?.敌方?.外门??0)+y.外门,内门:(n.累计伤亡?.敌方?.内门??0)+y.内门,核心:(n.累计伤亡?.敌方?.核心??0)+y.核心}}},report:{时间:a,阶段:t,摘要:`阶段「${t}」：${u}（d20=${r}，优势=${d>=0?"+":""}${d}）。我方伤亡 外门-${b.外门}/内门-${b.内门}/核心-${b.核心}；敌方伤亡 外门-${y.外门}/内门-${y.内门}/核心-${y.核心}。`,我方变化:{士气:x,战力:Math.round(d/20),伤亡:b},敌方变化:{士气:k,战力:Math.round(-d/20),伤亡:y}},resolution:{stage:t,roll:r,advantage:d,grade:u,ourLoss:b,enemyLoss:y,moraleDelta:{我方:x,敌方:k}}}}function D4(e){const n="number"==typeof e.roll?A4(Math.floor(e.roll),1,20):E4(1,20),{war:t,nowIso:a}=e,r=t.我方,o=t.敌方,i=r.战力+S4(r.士气,60)/10-(o.战力+S4(o.士气,60)/10)+(n-10),s=i>=0?"胜利":"失败",l={...t,状态:s,当前阶段:"终局"};return{war:l,report:{时间:a,阶段:"终局",摘要:`终局判定：${s}（d20=${n}，终局差值=${i>=0?"+":""}${Math.round(i)}）。累计伤亡：我方 外门-${l.累计伤亡?.我方?.外门??0}/内门-${l.累计伤亡?.我方?.内门??0}/核心-${l.累计伤亡?.我方?.核心??0}；敌方 外门-${l.累计伤亡?.敌方?.外门??0}/内门-${l.累计伤亡?.敌方?.内门??0}/核心-${l.累计伤亡?.敌方?.核心??0}。`}}}function z4(e){const n=e.状态,t=e.发起方,a=e.守方,r=e.累计伤亡?.我方??{},o=e.累计伤亡?.敌方??{},i=`外门-${r.外门??0}/内门-${r.内门??0}/核心-${r.核心??0}`,s=`外门-${o.外门??0}/内门-${o.内门??0}/核心-${o.核心??0}`;return`【势力战争】${t} 对 ${a}${e.目标?`，目标：${e.目标}`:""} —— 结果：${n}。累计伤亡：我方(${i})，敌方(${s})。`}const N4={class:"sect-war"},$4={class:"war-shell"},O4={class:"war-header"},F4={class:"left"},j4={key:0,class:"subtitle"},B4={key:1,class:"subtitle muted"},X4={class:"right"},U4=["disabled"],W4={key:0,class:"notice"},q4={class:"notice-body"},G4={class:"fix-box"},H4={class:"fix-row"},V4={id:"my-sect-candidates"},Q4=["value"],K4=["disabled"],Y4={key:1,class:"war-body"},J4={key:0,class:"start-panel"},Z4={class:"card"},e7={class:"field"},n7={id:"sect-targets"},t7=["value"],a7={key:0,class:"muted small"},r7={class:"field"},o7={class:"hint-row"},i7={class:"muted"},s7={class:"field"},l7={class:"actions"},c7=["disabled"],d7={key:0,class:"muted small"},u7={key:1,class:"war-panel"},p7={class:"grid"},v7={class:"card"},f7={class:"kv"},h7={class:"kv"},m7={class:"v"},g7={class:"kv"},b7={class:"v"},y7={key:0,class:"kv"},x7={class:"v"},k7={class:"kv"},w7={class:"v"},_7={class:"card"},C7={class:"row"},A7={class:"badge blue"},S7={class:"kv"},L7={class:"v"},E7={class:"kv"},T7={class:"v"},I7={class:"kv"},R7={class:"v"},M7={class:"card"},P7={class:"row"},D7={class:"badge red"},z7={class:"kv"},N7={class:"v"},$7={class:"kv"},O7={class:"v"},F7={class:"kv"},j7={class:"v"},B7={key:0,class:"details"},X7={class:"summary"},U7={class:"detail-grid"},W7={class:"detail-card"},q7={class:"detail-title"},G7={class:"k"},H7={class:"v"},V7={key:0,class:"note"},Q7={class:"detail-card"},K7={class:"detail-title"},Y7={class:"k"},J7={class:"v"},Z7={key:0,class:"note"},e9={class:"card"},n9={class:"stage-strip"},t9={class:"actions"},a9=["disabled"],r9=["disabled"],o9=["disabled"],i9=["disabled"],s9=["disabled"],l9={key:0,class:"ai-summary"},c9={class:"ai-text"},d9={class:"card logs"},u9={key:0,class:"muted"},p9={key:1,class:"log-list"},v9={class:"log-top"},f9={class:"badge"},h9={class:"muted"},m9={class:"log-text"},g9={key:1,class:"card history"},b9={class:"history-list"},y9={class:"history-top"},x9={class:"badge"},k9={class:"name"},w9={class:"muted"},_9={key:0,class:"muted small"},C9=(0,r.pM)({__name:"SectWarContent",setup(e){const n=(0,Hu.useGameStateStore)(),t=(0,Ec.useCharacterStore)(),a=(0,i.KR)(!1),l=(0,i.KR)(!1),c=(0,i.KR)(""),d=(0,i.KR)(""),u=(0,i.KR)(""),p=(0,i.KR)(""),v=(0,i.KR)("首领"),f=(0,r.EW)(()=>n.character?.名字||""),h=(0,r.EW)(()=>{const e=n.getCurrentSaveData(),t=e?.世界?.信息;return t?.势力信息||[]}),m=(0,r.EW)(()=>h.value.map(e=>String(e?.名称||"").trim()).filter(Boolean).slice(0,200)),g=(0,r.EW)(()=>(0,P5.Z)(f.value,h.value,n.sectMemberInfo)),b=(0,r.EW)(()=>n.sectMemberInfo),y=(0,r.EW)(()=>String(n.sectSystem?.当前势力||"").trim()),x=(0,r.EW)(()=>{const e=String(b.value?.势力名称||"").trim();if(e)return e;const t=String(g.value.sectName||"").trim();return t||(y.value?y.value:String((n.sectSystem?.成员信息?.势力名称??"")||"").trim())}),k=(0,r.EW)(()=>x.value||""),w=(0,r.EW)(()=>{const e=String(g.value.position||"").trim();if(e)return e;return String(b.value?.职位||"").trim()||""}),_=(0,r.EW)(()=>g.value.isLeader||(0,P5.b)(w.value)),C=(0,r.EW)(()=>!!x.value&&_.value),A=(0,r.EW)(()=>!!String(p.value||x.value||"").trim()&&(0,P5.b)(v.value));(0,r.wB)(x,e=>{const n=String(e||"").trim();!p.value&&n&&(p.value=n)},{immediate:!0});const S=(0,r.EW)(()=>n.sectSystem?.势力战争??null),L=(0,r.EW)(()=>S.value?.当前??null),E=(0,r.EW)(()=>Array.isArray(S.value?.历史)?S.value.历史:[]),T=(0,r.EW)(()=>{const e=k.value;return h.value.map(e=>String(e?.名称||"").trim()).filter(Boolean).filter(n=>n!==e).slice(0,200)}),I=(0,r.EW)(()=>{const e=u.value.trim();if(!e)return"请先填写目标势力";if(e===k.value.trim())return!1;const n=c.value.trim();return!(n.length<2||n.length>200)}),R=(0,r.EW)(()=>{const e=u.value.trim();if(!e)return"请先填写目标势力";if(e===k.value.trim())return"不能对自己宣战";const n=c.value.trim();return n.length<2?"宣战理由至少 2 字":n.length>200?"宣战理由最多 200 字":""}),M=(0,r.EW)(()=>{const e=L.value;return!!e&&["胜利","失败","停战"].includes(e.状态)}),P=(0,r.EW)(()=>{const e=L.value;return!!e&&("进行中"===e.状态||"备战"===e.状态)&&e.阶段索引<(e.阶段列表?.length??0)}),D=(0,r.EW)(()=>{const e=L.value;return!!e&&("进行中"===e.状态||"备战"===e.状态)}),z=(0,r.EW)(()=>{const e=L.value;if(!e)return"";const n=(e.战报??[]).slice().reverse().find(e=>String(e.阶段).includes("AI战报摘要"));return n?.摘要??""}),N=(0,r.EW)(()=>{const e=L.value;if(!e)return null;const n=e?.上一次?.战力计算??null;return n&&"object"==typeof n?n:null});function $(){const e=n.getCurrentSaveData();e&&n.loadFromSaveData(e)}async function O(){if(a.value)return;const e=String(p.value||x.value||"").trim();if(e){a.value=!0;try{const a=(new Date).toISOString(),r=h.value.find(n=>String(n?.名称||"").trim()===e)??null,o=b.value&&"object"==typeof b.value?b.value:null,i={势力名称:e,势力类型:o?.势力类型||r?.类型||"修仙势力",职位:v.value,贡献:o?.贡献??0,关系:o?.关系??"友好",声望:o?.声望??0,加入日期:o?.加入日期||a,描述:o?.描述||r?.描述||""};n.updateState("sectMemberInfo",i),n.sectSystem?y.value||n.updateState("sectSystem.当前势力",e):n.updateState("sectSystem",{版本:2,当前势力:e,势力档案:r?{[e]:r}:{},势力成员:{},势力功法库:{},势力贡献商店:{},势力任务:{},势力任务状态:{}}),await t.saveCurrentGame(),_e.o.success("已修复势力身份")}catch(e){console.error("[SectWar] applyMembershipFix failed",e),_e.o.error("修复失败")}finally{a.value=!1}}else _e.o.error("请填写势力名称")}async function F(e){const a=n.getCurrentSaveData();if(!a)throw new Error("存档未加载");const r="function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a)),o=r.社交??={},i=o.势力??={},s=i.势力战争??={};s.当前=e,Array.isArray(s.历史)||(s.历史=[]),n.loadFromSaveData(r),await t.saveCurrentGame()}async function j(){if(C.value&&!a.value&&I.value){a.value=!0;try{await async function(){if(b.value?.势力名称)return;const e=String(g.value.sectName||"").trim();if(!e)return;const a=(new Date).toISOString(),r=h.value.find(n=>String(n?.名称||"").trim()===e)??null,o={势力名称:e,势力类型:r?.类型||"修仙势力",职位:g.value.position||"首领",贡献:0,关系:"友好",声望:0,加入日期:a,描述:r?.描述||""};n.updateState("sectMemberInfo",o),n.sectSystem?y.value||n.updateState("sectSystem.当前势力",e):n.updateState("sectSystem",{版本:2,当前势力:e,势力档案:r?{[e]:r}:{},势力成员:{},势力功法库:{},势力贡献商店:{},势力任务:{},势力任务状态:{}}),await t.saveCurrentGame()}();const e=n.getCurrentSaveData();if(!e)throw new Error("存档未加载");const a=k.value,r=u.value.trim(),o=c.value.trim(),i=d.value.trim(),s=T4(e,a),l=T4(e,r),p=(new Date).toISOString(),v={战争ID:`war_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,状态:"进行中",发起方:a,守方:r,目标:i||void 0,阶段列表:["侦察","交锋","破阵","攻山","善后"],阶段索引:0,当前阶段:"侦察",我方:s.side,敌方:l.side,累计伤亡:{我方:{外门:0,内门:0,核心:0},敌方:{外门:0,内门:0,核心:0}},战报:[{时间:p,阶段:"宣战",摘要:`宣战：${a} 向 ${r} 发起势力战争。理由：${o}${i?`；目标：${i}`:""}`}],上一次:{宣战理由:o,战力计算:{our:s,enemy:l}}};await F(v),n.addToShortTermMemory(`【势力战争】${a} 向 ${r} 宣战：${o}${i?`（目标：${i}）`:""}`),await t.saveCurrentGame(),_e.o.success("已宣战，进入推演")}catch(e){console.error("[SectWar] start failed",e),_e.o.error("宣战失败")}finally{a.value=!1}}}async function B(){const e=L.value;if(e&&P.value&&!a.value){a.value=!0;try{const a=(new Date).toISOString(),r=e.阶段列表?.[e.阶段索引]??e.当前阶段,{war:o,report:i}=P4({war:e,stage:r,nowIso:a}),s=e.阶段索引+1,l={...o,阶段索引:s,当前阶段:s>=(e.阶段列表?.length??0)?"终局":e.阶段列表?.[s]??o.当前阶段,战报:[...o.战报??[],i]};if(s>=(e.阶段列表?.length??0)){const{war:e,report:r}=D4({war:l,nowIso:a}),o={...e,战报:[...l.战报??[],r],当前阶段:"终局"};await F(o),n.addToShortTermMemory(z4(o)),await t.saveCurrentGame(),_e.o.success(`势力战争已结束：${o.状态}`)}else await F(l),_e.o.success(`已推进：${r}`)}catch(e){console.error("[SectWar] advance failed",e),_e.o.error("推进失败")}finally{a.value=!1}}}async function X(){const e=L.value;if(e&&P.value&&!a.value){a.value=!0;try{let a=e;for(;a.阶段索引<(a.阶段列表?.length??0)&&"进行中"===a.状态;){const e=(new Date).toISOString(),n=a.阶段列表?.[a.阶段索引]??a.当前阶段,{war:t,report:r}=P4({war:a,stage:n,nowIso:e}),o=a.阶段索引+1;a={...t,阶段索引:o,当前阶段:o>=(a.阶段列表?.length??0)?"终局":a.阶段列表?.[o]??t.当前阶段,战报:[...t.战报??[],r]}}const r=(new Date).toISOString(),{war:o,report:i}=D4({war:a,nowIso:r}),s={...o,战报:[...a.战报??[],i],当前阶段:"终局"};await F(s),n.addToShortTermMemory(z4(s)),await t.saveCurrentGame(),_e.o.success(`已推演至终局：${s.状态}`)}catch(e){console.error("[SectWar] autoResolve failed",e),_e.o.error("推演失败")}finally{a.value=!1}}}async function U(){const e=L.value;if(e&&D.value&&!a.value){a.value=!0;try{const a=(new Date).toISOString(),r={...e,状态:"停战",当前阶段:"停战",战报:[...e.战报??[],{时间:a,阶段:"停战",摘要:"停战：双方收兵，暂止战火（由首领面板操作）。"}]};await F(r),n.addToShortTermMemory(z4(r)),await t.saveCurrentGame(),_e.o.success("已停战")}catch(e){console.error("[SectWar] ceasefire failed",e),_e.o.error("停战失败")}finally{a.value=!1}}}async function W(){const e=L.value;if(e&&M.value&&!a.value){a.value=!0;try{const a=n.getCurrentSaveData();if(!a)throw new Error("存档未加载");const r="function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a)),o=r.社交??={},i=o.势力??={},s=i.势力战争??={};Array.isArray(s.历史)||(s.历史=[]),s.历史.push(e),s.当前=null,n.loadFromSaveData(r),await t.saveCurrentGame(),_e.o.success("已归档")}catch(e){console.error("[SectWar] archive failed",e),_e.o.error("归档失败")}finally{a.value=!1}}}async function q(){const e=L.value;if(e&&M.value&&!a.value&&!l.value){l.value=!0;try{const a=String(e?.上一次?.宣战理由??"").trim(),r=Array.isArray(e.战报)?e.战报.slice(-12):[],o=`\n# 任务：生成【势力大战】战报摘要（仅摘要，不写入任何数据）\n\n你将根据提供的结构化战报与胜负结果，写一段“战报摘要”，用于势力系统面板展示与短期记忆记录。\n\n## 输出格式（必须）\n只输出 1 个 JSON 对象：\n{"summary":"...（200-450字）","tldr":"...（不超过60字）"}\n\n## 约束（必须）\n- 禁止输出 tavern_commands / action_options / 任何额外字段\n- 禁止输出代码块或额外文本\n- 文风：修仙正剧风，客观凝练\n\n## 基础信息\n- 发起方：${e.发起方}\n- 守方：${e.守方}\n- 目标：${e.目标||"（无）"}\n- 宣战理由（玩家输入）：${a||"（未提供）"}\n- 最终结果：${e.状态}\n- 累计伤亡：我方=${JSON.stringify(e.累计伤亡?.我方??{})} 敌方=${JSON.stringify(e.累计伤亡?.敌方??{})}\n\n## 阶段战报（结构化）\n${JSON.stringify(r).slice(0,3500)}\n    `.trim(),i=await(0,ar.e)("势力大战-战报摘要",o,!1,"sect_generation"),s=(0,cr.$6)(i,bw.aiService.isForceJsonEnabled("sect_generation")),l=String(s?.summary??"").trim(),c=String(s?.tldr??"").trim();if(!l)throw new Error("summary missing");const d=(new Date).toISOString(),u={...e,战报:[...e.战报??[],{时间:d,阶段:"AI战报摘要",摘要:l,我方变化:c?{tldr:c}:void 0}]};await F(u);const p=c?`【势力战争】战报：${c}`:"【势力战争】战报已生成（详见势力战争面板）";n.addToShortTermMemory(p),await t.saveCurrentGame(),_e.o.success("战报摘要已生成")}catch(e){console.error("[SectWar] ai summary failed",e),_e.o.error("生成战报摘要失败")}finally{l.value=!1}}}return(e,n)=>{return(0,r.uX)(),(0,r.CE)("div",N4,[(0,r.Lk)("div",$4,[(0,r.Lk)("div",O4,[(0,r.Lk)("div",F4,[n[5]||(n[5]=(0,r.Lk)("div",{class:"title"},"势力大战",-1)),k.value?((0,r.uX)(),(0,r.CE)("div",j4,(0,o.v_)(k.value)+" · "+(0,o.v_)(w.value),1)):((0,r.uX)(),(0,r.CE)("div",B4,"未加入势力"))]),(0,r.Lk)("div",X4,[(0,r.Lk)("button",{class:"btn",onClick:$,disabled:a.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14,class:(0,o.C4)({spin:a.value})},null,8,["class"]),n[6]||(n[6]=(0,r.Lk)("span",null,"刷新",-1))],8,U4)])]),C.value?((0,r.uX)(),(0,r.CE)("div",Y4,[L.value?((0,r.uX)(),(0,r.CE)("div",u7,[(0,r.Lk)("div",p7,[(0,r.Lk)("div",v7,[n[23]||(n[23]=(0,r.Lk)("div",{class:"card-title"},"战局概览",-1)),(0,r.Lk)("div",f7,[n[18]||(n[18]=(0,r.Lk)("span",{class:"k"},"状态",-1)),(0,r.Lk)("span",{class:(0,o.C4)(["v",(t=L.value.状态,"胜利"===t?"ok":"失败"===t?"bad":"停战"===t?"warn":"mid")])},(0,o.v_)(L.value.状态),3)]),(0,r.Lk)("div",h7,[n[19]||(n[19]=(0,r.Lk)("span",{class:"k"},"发起方",-1)),(0,r.Lk)("span",m7,(0,o.v_)(L.value.发起方),1)]),(0,r.Lk)("div",g7,[n[20]||(n[20]=(0,r.Lk)("span",{class:"k"},"守方",-1)),(0,r.Lk)("span",b7,(0,o.v_)(L.value.守方),1)]),L.value.目标?((0,r.uX)(),(0,r.CE)("div",y7,[n[21]||(n[21]=(0,r.Lk)("span",{class:"k"},"目标",-1)),(0,r.Lk)("span",x7,(0,o.v_)(L.value.目标),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",k7,[n[22]||(n[22]=(0,r.Lk)("span",{class:"k"},"当前阶段",-1)),(0,r.Lk)("span",w7,(0,o.v_)(L.value.当前阶段),1)])]),(0,r.Lk)("div",_7,[n[27]||(n[27]=(0,r.Lk)("div",{class:"card-title"},"我方",-1)),(0,r.Lk)("div",C7,[(0,r.Lk)("div",A7,(0,o.v_)(L.value.我方.势力名称),1)]),(0,r.Lk)("div",S7,[n[24]||(n[24]=(0,r.Lk)("span",{class:"k"},"战力",-1)),(0,r.Lk)("span",L7,(0,o.v_)(L.value.我方.战力)+"/100",1)]),(0,r.Lk)("div",E7,[n[25]||(n[25]=(0,r.Lk)("span",{class:"k"},"士气",-1)),(0,r.Lk)("span",T7,(0,o.v_)(L.value.我方.士气??0)+"/100",1)]),(0,r.Lk)("div",I7,[n[26]||(n[26]=(0,r.Lk)("span",{class:"k"},"兵力",-1)),(0,r.Lk)("span",R7,"外"+(0,o.v_)(L.value.我方.外门)+" · 内"+(0,o.v_)(L.value.我方.内门)+" · 核"+(0,o.v_)(L.value.我方.核心),1)])]),(0,r.Lk)("div",M7,[n[31]||(n[31]=(0,r.Lk)("div",{class:"card-title"},"敌方",-1)),(0,r.Lk)("div",P7,[(0,r.Lk)("div",D7,(0,o.v_)(L.value.敌方.势力名称),1)]),(0,r.Lk)("div",z7,[n[28]||(n[28]=(0,r.Lk)("span",{class:"k"},"战力",-1)),(0,r.Lk)("span",N7,(0,o.v_)(L.value.敌方.战力)+"/100",1)]),(0,r.Lk)("div",$7,[n[29]||(n[29]=(0,r.Lk)("span",{class:"k"},"士气",-1)),(0,r.Lk)("span",O7,(0,o.v_)(L.value.敌方.士气??0)+"/100",1)]),(0,r.Lk)("div",F7,[n[30]||(n[30]=(0,r.Lk)("span",{class:"k"},"兵力",-1)),(0,r.Lk)("span",j7,"外"+(0,o.v_)(L.value.敌方.外门)+" · 内"+(0,o.v_)(L.value.敌方.内门)+" · 核"+(0,o.v_)(L.value.敌方.核心),1)])])]),N.value?((0,r.uX)(),(0,r.CE)("details",B7,[(0,r.Lk)("summary",X7,[(0,r.bF)((0,i.R1)(Mc.A),{size:14}),n[32]||(n[32]=(0,r.Lk)("span",null,"战力计算（本地可解释）",-1))]),(0,r.Lk)("div",U7,[(0,r.Lk)("div",W7,[(0,r.Lk)("div",q7,"我方："+(0,o.v_)(N.value.our.side.势力名称),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(N.value.our.breakdown,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{class:"detail-line",key:`o-${n}`},[(0,r.Lk)("span",G7,(0,o.v_)(e.label),1),(0,r.Lk)("span",H7,(0,o.v_)(e.value>=0?"+":"")+(0,o.v_)(e.value),1),e.note?((0,r.uX)(),(0,r.CE)("span",V7,"("+(0,o.v_)(e.note)+")",1)):(0,r.Q3)("v-if",!0)]))),128))]),(0,r.Lk)("div",Q7,[(0,r.Lk)("div",K7,"敌方："+(0,o.v_)(N.value.enemy.side.势力名称),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(N.value.enemy.breakdown,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{class:"detail-line",key:`e-${n}`},[(0,r.Lk)("span",Y7,(0,o.v_)(e.label),1),(0,r.Lk)("span",J7,(0,o.v_)(e.value>=0?"+":"")+(0,o.v_)(e.value),1),e.note?((0,r.uX)(),(0,r.CE)("span",Z7,"("+(0,o.v_)(e.note)+")",1)):(0,r.Q3)("v-if",!0)]))),128))])])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",e9,[n[39]||(n[39]=(0,r.Lk)("div",{class:"card-title"},"推进与结算",-1)),(0,r.Lk)("div",n9,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.value.阶段列表,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e}-${n}`,class:(0,o.C4)(["stage-pill",{active:n===L.value.阶段索引,done:n<L.value.阶段索引}])},[(0,r.bF)((0,i.R1)(cp),{size:14}),(0,r.Lk)("span",null,(0,o.v_)(e),1)],2))),128))]),(0,r.Lk)("div",t9,[(0,r.Lk)("button",{class:"btn primary",onClick:B,disabled:a.value||!P.value},[(0,r.bF)((0,i.R1)(cj),{size:16}),n[33]||(n[33]=(0,r.Lk)("span",null,"推进下一阶段",-1))],8,a9),(0,r.Lk)("button",{class:"btn",onClick:X,disabled:a.value||!P.value},[(0,r.bF)((0,i.R1)(_4),{size:16}),n[34]||(n[34]=(0,r.Lk)("span",null,"一键推演到终局",-1))],8,r9),(0,r.Lk)("button",{class:"btn danger",onClick:U,disabled:a.value||!D.value},[(0,r.bF)((0,i.R1)(C4),{size:16}),n[35]||(n[35]=(0,r.Lk)("span",null,"停战",-1))],8,o9),M.value?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn",onClick:W,disabled:a.value},n[36]||(n[36]=[(0,r.Lk)("span",null,"归档",-1)]),8,i9)):(0,r.Q3)("v-if",!0),M.value?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn",onClick:q,disabled:a.value||l.value},[(0,r.bF)((0,i.R1)(Mc.A),{size:16,class:(0,o.C4)({spin:l.value})},null,8,["class"]),n[37]||(n[37]=(0,r.Lk)("span",null,"生成战报摘要（AI）",-1))],8,s9)):(0,r.Q3)("v-if",!0)]),z.value?((0,r.uX)(),(0,r.CE)("div",l9,[n[38]||(n[38]=(0,r.Lk)("div",{class:"ai-title"},"AI 战报摘要",-1)),(0,r.Lk)("div",c9,(0,o.v_)(z.value),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",d9,[n[40]||(n[40]=(0,r.Lk)("div",{class:"card-title"},"战报日志",-1)),L.value.战报?.length?((0,r.uX)(),(0,r.CE)("div",p9,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.value.战报,(e,n)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.时间}-${n}`,class:"log"},[(0,r.Lk)("div",v9,[(0,r.Lk)("span",f9,(0,o.v_)(e.阶段),1),(0,r.Lk)("span",h9,(0,o.v_)(e.时间),1)]),(0,r.Lk)("div",m9,(0,o.v_)(e.摘要),1)]))),128))])):((0,r.uX)(),(0,r.CE)("div",u9,"暂无记录"))]),E.value.length?((0,r.uX)(),(0,r.CE)("div",g9,[n[41]||(n[41]=(0,r.Lk)("div",{class:"card-title"},"历史（最近）",-1)),(0,r.Lk)("div",b9,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(E.value.slice(-6).reverse(),e=>((0,r.uX)(),(0,r.CE)("div",{key:e.战争ID,class:"history-item"},[(0,r.Lk)("div",y9,[(0,r.Lk)("span",x9,(0,o.v_)(e.状态),1),(0,r.Lk)("span",k9,(0,o.v_)(e.发起方)+" vs "+(0,o.v_)(e.守方),1),(0,r.Lk)("span",w9,(0,o.v_)(e.战争ID),1)]),e.战报?.length?((0,r.uX)(),(0,r.CE)("div",_9,(0,o.v_)(e.战报[e.战报.length-1].摘要),1)):(0,r.Q3)("v-if",!0)]))),128))])])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",J4,[(0,r.Lk)("div",Z4,[n[16]||(n[16]=(0,r.Lk)("div",{class:"card-title"},"宣战准备",-1)),(0,r.Lk)("div",e7,[n[10]||(n[10]=(0,r.Lk)("div",{class:"label"},"目标势力",-1)),(0,r.bo)((0,r.Lk)("input",{class:"input","onUpdate:modelValue":n[2]||(n[2]=e=>u.value=e),list:"sect-targets",placeholder:"输入或选择目标势力"},null,512),[[s.Jo,u.value]]),(0,r.Lk)("datalist",n7,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(T.value,e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e},null,8,t7))),128))]),0===T.value.length?((0,r.uX)(),(0,r.CE)("div",a7," 当前世界未加载“势力”列表：可直接手动输入目标势力名称（不影响推演）。 ")):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",r7,[n[12]||(n[12]=(0,r.Lk)("div",{class:"label"},"宣战理由（由你决定）",-1)),(0,r.bo)((0,r.Lk)("textarea",{class:"textarea","onUpdate:modelValue":n[3]||(n[3]=e=>c.value=e),placeholder:"例如：对方屡次截杀外门弟子，侵占灵脉，辱我势力名号……（建议20-200字）"},null,512),[[s.Jo,c.value]]),(0,r.Lk)("div",o7,[n[11]||(n[11]=(0,r.Lk)("span",{class:"muted"},"该理由将写入势力大战记录与短期记忆（不进入主对话正文）。",-1)),(0,r.Lk)("span",i7,(0,o.v_)(c.value.length)+"/200",1)])]),(0,r.Lk)("div",s7,[n[13]||(n[13]=(0,r.Lk)("div",{class:"label"},"目标（可选）",-1)),(0,r.bo)((0,r.Lk)("input",{class:"input","onUpdate:modelValue":n[4]||(n[4]=e=>d.value=e),placeholder:"例如：夺回灵脉/逼迫停战/惩戒首恶"},null,512),[[s.Jo,d.value]])]),(0,r.Lk)("div",l7,[(0,r.Lk)("button",{class:"btn primary",onClick:j,disabled:a.value||!I.value},[(0,r.bF)((0,i.R1)(op),{size:16}),n[14]||(n[14]=(0,r.Lk)("span",null,"宣战并进入推演",-1))],8,c7),I.value?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",d7,(0,o.v_)(R.value),1)),n[15]||(n[15]=(0,r.Lk)("div",{class:"muted small"},"战力为本地可解释计算；AI仅用于生成“战报摘要”。",-1))])]),n[17]||(n[17]=(0,r.Fv)('<div class="card slim" data-v-6b6d0227><div class="card-title" data-v-6b6d0227>提示</div><div class="tip-list" data-v-6b6d0227><div class="tip" data-v-6b6d0227>- 推演分 5 个阶段：侦察 → 交锋 → 破阵 → 攻山 → 善后</div><div class="tip" data-v-6b6d0227>- 每一步都有可见日志与数值变化</div><div class="tip" data-v-6b6d0227>- 终局后可生成 AI 战报摘要（走 sect_generation）</div></div></div>',1))]))])):((0,r.uX)(),(0,r.CE)("div",W4,[(0,r.bF)((0,i.R1)(eX.A),{size:16}),(0,r.Lk)("div",q4,[n[9]||(n[9]=(0,r.Lk)("div",null,"需要加入势力且担任首领或副首领，才能发起势力大战。",-1)),(0,r.Lk)("div",G4,[n[8]||(n[8]=(0,r.Lk)("div",{class:"muted small"},"若你确实是势力高层但系统未识别，可在此修复（单机存档生效）：",-1)),(0,r.Lk)("div",H4,[(0,r.bo)((0,r.Lk)("input",{class:"input","onUpdate:modelValue":n[0]||(n[0]=e=>p.value=e),list:"my-sect-candidates",placeholder:"你的势力名称"},null,512),[[s.Jo,p.value]]),(0,r.Lk)("datalist",V4,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e},null,8,Q4))),128))]),(0,r.bo)((0,r.Lk)("select",{class:"select","onUpdate:modelValue":n[1]||(n[1]=e=>v.value=e)},n[7]||(n[7]=[(0,r.Lk)("option",{value:"首领"},"首领",-1),(0,r.Lk)("option",{value:"副首领"},"副首领",-1)]),512),[[s.u1,v.value]]),(0,r.Lk)("button",{class:"btn",onClick:O,disabled:a.value||!A.value},"修复并继续",8,K4)])])])]))])]);var t}}});var A9=t(1575),S9={};S9.styleTagTransform=A(),S9.setAttributes=k(),S9.insert=y().bind(null,"head"),S9.domAPI=g(),S9.insertStyleElement=_(),h()(A9.A,S9),A9.A&&A9.A.locals&&A9.A.locals;const L9=(0,E.A)(C9,[["__scopeId","data-v-6b6d0227"]]),E9={class:"game-variable-data-header"},T9={class:"panel-header"},I9={class:"panel-title"},R9={class:"header-actions"},M9={class:"search-bar"},P9=["value"],D9=(0,r.pM)({__name:"GameVariableDataHeader",props:{searchQuery:{},isRefreshing:{type:Boolean}},emits:["update:search-query","show-format-guide","refresh","export","show-stats"],setup:e=>(e,n)=>((0,r.uX)(),(0,r.CE)("div",E9,[(0,r.Lk)("div",T9,[(0,r.Lk)("h2",I9,[(0,r.bF)((0,i.R1)(ip),{size:20}),n[2]||(n[2]=(0,r.Lk)("span",null,"游戏变量查看",-1))]),(0,r.Lk)("div",R9,[(0,r.Lk)("div",M9,[(0,r.bF)((0,i.R1)(qc),{size:16}),(0,r.Lk)("input",{value:e.searchQuery,onInput:n[0]||(n[0]=n=>e.$emit("update:search-query",n.target.value)),placeholder:"搜索数据...",class:"search-input"},null,40,P9)]),(0,r.Lk)("button",{class:"format-guide-btn",onClick:n[1]||(n[1]=n=>e.$emit("show-format-guide")),title:"查看数据格式说明"},[(0,r.bF)((0,i.R1)(Qu.A),{size:16}),n[3]||(n[3]=(0,r.Lk)("span",null,"格式说明",-1))])])])]))});var z9=t(6119),N9={};N9.styleTagTransform=A(),N9.setAttributes=k(),N9.insert=y().bind(null,"head"),N9.domAPI=g(),N9.insertStyleElement=_(),h()(z9.A,N9),z9.A&&z9.A.locals&&z9.A.locals;const $9=(0,E.A)(D9,[["__scopeId","data-v-759e00bb"]]),O9=(0,I.A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),F9=(0,I.A)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),j9=(0,I.A)("book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),B9=(0,I.A)("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),X9={class:"data-type-selector"},U9=["onClick"],W9={key:0,class:"count-badge"},q9=(0,r.pM)({__name:"GameVariableDataSelector",props:{dataTypes:{},selectedType:{},getDataCount:{type:Function}},emits:["update:selected-type"],setup:e=>(e,n)=>((0,r.uX)(),(0,r.CE)("div",X9,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.dataTypes,n=>{return(0,r.uX)(),(0,r.CE)("button",{key:n.key,onClick:t=>e.$emit("update:selected-type",n.key),class:(0,o.C4)(["type-btn",{active:e.selectedType===n.key}])},[((0,r.uX)(),(0,r.Wv)((0,r.$y)((t=n.icon,{MessageSquare:O9,Globe:lp.A,Users:P,Archive:F9,Book:j9,Brain:Vu,Code:B9}[t]||B9)),{size:16})),(0,r.Lk)("span",null,(0,o.v_)(n.label),1),e.getDataCount(n.key)>0?((0,r.uX)(),(0,r.CE)("span",W9,(0,o.v_)(e.getDataCount(n.key)),1)):(0,r.Q3)("v-if",!0)],10,U9);var t}),128))]))});var G9=t(1703),H9={};H9.styleTagTransform=A(),H9.setAttributes=k(),H9.insert=y().bind(null,"head"),H9.domAPI=g(),H9.insertStyleElement=_(),h()(G9.A,H9),G9.A&&G9.A.locals&&G9.A.locals;const V9=(0,E.A)(q9,[["__scopeId","data-v-2d9375b2"]]),Q9=(0,I.A)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),K9=(0,I.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Y9={class:"variable-section"},J9={class:"section-header"},Z9={class:"section-title"},eee=["disabled"],nee={class:"variable-content"},tee={key:0,class:"variable-list"},aee={class:"variable-header"},ree={class:"variable-key"},oee={class:"variable-type"},iee={class:"variable-actions"},see=["onClick","disabled"],lee=["onClick"],cee=["onClick","disabled"],dee={class:"variable-value"},uee={key:0,class:"code-pre"},pee={key:1},vee={key:1,class:"empty-state"},fee={key:0},hee={key:1},mee={class:"debug-info"},gee={class:"debug-content"},bee={class:"debug-actions"},yee=(0,r.pM)({__name:"CustomOptionsSection",props:{type:{},variables:{},searchQuery:{},readOnly:{type:Boolean,default:!1},chatVariables:{},customOptions:{},coreDataViews:{}},emits:["edit-variable","copy-variable","delete-variable","add-new-variable","debug-log"],setup(e){const n=e,t=(0,r.EW)(()=>"chat"===n.type),a=e=>null===e?"null":void 0===e?"undefined":Array.isArray(e)?`array[${e.length}]`:"object"==typeof e?`object{${Object.keys(e).length}}`:typeof e;return(e,n)=>((0,r.uX)(),(0,r.CE)("div",Y9,[(0,r.Lk)("div",J9,[(0,r.Lk)("h3",Z9,(0,o.v_)("chat"===e.type?"Chat Variables (聊天变量)":"core"===e.type?"Core Data (核心数据)":"Custom Options (自定义选项)"),1),t.value?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:n[0]||(n[0]=n=>e.$emit("add-new-variable",e.type)),class:"add-btn",disabled:e.readOnly},[(0,r.bF)((0,i.R1)(lj.A),{size:14}),n[2]||(n[2]=(0,r.Lk)("span",null,"新增变量",-1))],8,eee)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",nee,[Object.keys(e.variables).length>0?((0,r.uX)(),(0,r.CE)("div",tee,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.variables,(n,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:"variable-item"},[(0,r.Lk)("div",aee,[(0,r.Lk)("span",ree,(0,o.v_)(s),1),(0,r.Lk)("span",oee,(0,o.v_)(a(n)),1),(0,r.Lk)("div",iee,[t.value?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t=>e.$emit("edit-variable",{type:e.type,key:s,value:n}),class:"action-btn edit",title:"编辑",disabled:e.readOnly},[(0,r.bF)((0,i.R1)(Q9),{size:12})],8,see)):(0,r.Q3)("v-if",!0),(0,r.Lk)("button",{onClick:t=>e.$emit("copy-variable",{key:s,value:n}),class:"action-btn copy",title:"复制"},[(0,r.bF)((0,i.R1)(K9),{size:12})],8,lee),t.value?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:n=>e.$emit("delete-variable",{type:e.type,key:s}),class:"action-btn delete",title:"删除",disabled:e.readOnly},[(0,r.bF)((0,i.R1)(ba.A),{size:12})],8,cee)):(0,r.Q3)("v-if",!0)])]),(0,r.Lk)("div",dee,["object"==typeof n?((0,r.uX)(),(0,r.CE)("pre",uee,(0,o.v_)(JSON.stringify(n,null,2)),1)):((0,r.uX)(),(0,r.CE)("span",pee,(0,o.v_)(n),1))])]))),128))])):((0,r.uX)(),(0,r.CE)("div",vee,[(0,r.bF)((0,i.R1)(Hc),{size:32}),e.searchQuery?((0,r.uX)(),(0,r.CE)("p",fee,"无匹配的变量")):((0,r.uX)(),(0,r.CE)("p",hee,(0,o.v_)("chat"===e.type?"暂无聊天变量":"core"===e.type?"暂无核心数据":"暂无自定义选项"),1)),(0,r.Lk)("div",mee,[(0,r.Lk)("details",null,[n[5]||(n[5]=(0,r.Lk)("summary",null,"🔍 调试信息 (点击展开)",-1)),(0,r.Lk)("div",gee,[n[4]||(n[4]=(0,r.Lk)("p",null,[(0,r.Lk)("strong",null,"连接状态:"),(0,r.eW)(" ✅已连接")],-1)),(0,r.Lk)("p",null,[n[3]||(n[3]=(0,r.Lk)("strong",null,"变量数量:",-1)),(0,r.eW)(" "+(0,o.v_)(Object.keys(e.variables).length),1)]),(0,r.Lk)("div",bee,[(0,r.Lk)("button",{onClick:n[1]||(n[1]=n=>e.$emit("debug-log")),class:"debug-btn"}," 🖼️ 控制台输出 ")])])])])]))])]))}});var xee=t(8129),kee={};kee.styleTagTransform=A(),kee.setAttributes=k(),kee.insert=y().bind(null,"head"),kee.domAPI=g(),kee.insertStyleElement=_(),h()(xee.A,kee),xee.A&&xee.A.locals&&xee.A.locals;const wee=(0,E.A)(yee,[["__scopeId","data-v-0e56e6f2"]]),_ee={class:"character-section"},Cee={key:0,class:"character-info"},Aee={class:"info-grid"},See={class:"info-item"},Lee={class:"info-value"},Eee={class:"info-item"},Tee={class:"info-value"},Iee={class:"data-detail"},Ree={class:"code-pre"},Mee={key:1,class:"empty-state"},Pee=(0,r.pM)({__name:"GameVariableCharacterSection",props:{characterData:{}},setup:e=>(e,n)=>((0,r.uX)(),(0,r.CE)("div",_ee,[n[4]||(n[4]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",{class:"section-title"},"Character Data (角色数据)")],-1)),e.characterData?((0,r.uX)(),(0,r.CE)("div",Cee,[(0,r.Lk)("div",Aee,[(0,r.Lk)("div",See,[n[0]||(n[0]=(0,r.Lk)("span",{class:"info-label"},"角色名称:",-1)),(0,r.Lk)("span",Lee,(0,o.v_)(e.characterData?.name||e.characterData?.名字||"未知"),1)]),(0,r.Lk)("div",Eee,[n[1]||(n[1]=(0,r.Lk)("span",{class:"info-label"},"角色ID:",-1)),(0,r.Lk)("span",Tee,(0,o.v_)(e.characterData?.id||"未知"),1)])]),(0,r.Lk)("div",Iee,[n[2]||(n[2]=(0,r.Lk)("h4",{class:"detail-title"},"完整角色数据:",-1)),(0,r.Lk)("pre",Ree,(0,o.v_)(JSON.stringify(e.characterData,null,2)),1)])])):((0,r.uX)(),(0,r.CE)("div",Mee,[(0,r.bF)((0,i.R1)(P),{size:32}),n[3]||(n[3]=(0,r.Lk)("p",null,"暂无角色数据",-1))]))]))});var Dee=t(3509),zee={};zee.styleTagTransform=A(),zee.setAttributes=k(),zee.insert=y().bind(null,"head"),zee.domAPI=g(),zee.insertStyleElement=_(),h()(Dee.A,zee),Dee.A&&Dee.A.locals&&Dee.A.locals;const Nee=(0,E.A)(Pee,[["__scopeId","data-v-6cf48088"]]),$ee={class:"save-data-section"},Oee={class:"save-data-content"},Fee={key:0,class:"data-tree"},jee={key:1,class:"empty-state"},Bee=(0,r.pM)({__name:"GameVariableSaveDataSection",props:{saveData:{},readOnly:{type:Boolean,default:!1}},emits:["edit-variable"],setup(e,{emit:n}){const a=(0,r.$V)(()=>Promise.resolve().then(t.bind(t,1419))),o=e,s=n,l=(0,Hu.useGameStateStore)(),c=(0,r.EW)(()=>{const e=o.saveData??{},n=(0,Ic.ru)(e)?e:(0,Ic.jj)(e).migrated;return{元数据:n.元数据,角色:n.角色,社交:n.社交,世界:n.世界,系统:n.系统}}),d=(e,n)=>{o.readOnly?_e.o.warning("联机模式下不允许直接修改存档数据（服务器权威控制）"):["元数据.存档ID","元数据.角色ID","元数据.模式","元数据.游玩时长","元数据.创建时间","元数据.更新时间","系统.联机.同步状态"].some(n=>e===n||e.startsWith(`${n}.`))?_e.o.warning("该字段为界面展示信息，无法直接修改（请修改实际存档字段）"):s("edit-variable",{type:"saveData",key:e,value:n})},u=async e=>{if(o.readOnly)_e.o.warning("联机模式下不允许直接删除存档数据（服务器权威控制）");else if(TA.Yz.log("[TavernSaveData]",`请求删除: ${e}`),confirm(`确定要删除此项目吗？\n路径: ${e}\n\n此操作不可撤销！`))try{const n=e.split("."),t=e.startsWith("角色.背包.物品.")&&4===n.length,a=e.startsWith("社交.关系.")&&3===n.length;if(!t&&!a)return void _e.o.warning("该路径暂不支持删除，请通过游戏内操作处理");if(t){const e=n[3],t=l.inventory;if(!t?.物品?.[e])throw new Error(`物品不存在: ${e}`);const a=JSON.parse(JSON.stringify(t));delete a.物品[e],l.updateState("inventory",a)}else{const e=n[2],t=l.relationships;if(!t?.[e])throw new Error(`NPC不存在: ${e}`);const a=JSON.parse(JSON.stringify(t));delete a[e],l.updateState("relationships",a)}await l.saveGame(),_e.o.success(`项目 ${e} 已删除`),TA.Yz.log("[TavernSaveData]",`成功删除并同步: ${e}`)}catch(e){TA.Yz.error("[TavernSaveData]","删除失败",e),_e.o.error(`删除失败: ${e instanceof Error?e.message:"未知错误"}`)}};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",$ee,[n[1]||(n[1]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",{class:"section-title"},"Save Data (存档数据)")],-1)),(0,r.Lk)("div",Oee,[c.value&&Object.keys(c.value).length>0?((0,r.uX)(),(0,r.CE)("div",Fee,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.value,(n,t)=>((0,r.uX)(),(0,r.Wv)((0,i.R1)(a),{key:t,"node-key":t,value:n,path:String(t),"read-only":e.readOnly,onDeleteItem:u,onEditItem:d},null,8,["node-key","value","path","read-only"]))),128))])):((0,r.uX)(),(0,r.CE)("div",jee,[(0,r.bF)((0,i.R1)(F9),{size:32}),n[0]||(n[0]=(0,r.Lk)("p",null,"暂无存档数据",-1))]))])]))}});var Xee=t(7869),Uee={};Uee.styleTagTransform=A(),Uee.setAttributes=k(),Uee.insert=y().bind(null,"head"),Uee.domAPI=g(),Uee.insertStyleElement=_(),h()(Xee.A,Uee),Xee.A&&Xee.A.locals&&Xee.A.locals;const Wee=(0,E.A)(Bee,[["__scopeId","data-v-0294732f"]]),qee={class:"world-info-section"},Gee={class:"world-info-content"},Hee={key:0,class:"data-display"},Vee={class:"code-pre"},Qee={key:1,class:"empty-state"},Kee=(0,r.pM)({__name:"GameVariableWorldInfoSection",props:{worldInfo:{}},setup:e=>(e,n)=>((0,r.uX)(),(0,r.CE)("div",qee,[n[1]||(n[1]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",{class:"section-title"},"World Info (世界信息)")],-1)),(0,r.Lk)("div",Gee,[e.worldInfo&&Object.keys(e.worldInfo).length>0?((0,r.uX)(),(0,r.CE)("div",Hee,[(0,r.Lk)("pre",Vee,(0,o.v_)(JSON.stringify(e.worldInfo,null,2)),1)])):((0,r.uX)(),(0,r.CE)("div",Qee,[(0,r.bF)((0,i.R1)(j9),{size:32}),n[0]||(n[0]=(0,r.Lk)("p",null,"暂无世界信息",-1))]))])]))});var Yee=t(2748),Jee={};Jee.styleTagTransform=A(),Jee.setAttributes=k(),Jee.insert=y().bind(null,"head"),Jee.domAPI=g(),Jee.insertStyleElement=_(),h()(Yee.A,Jee),Yee.A&&Yee.A.locals&&Yee.A.locals;const Zee=(0,E.A)(Kee,[["__scopeId","data-v-dbebcd90"]]),ene={class:"memory-section"},nne={class:"memory-content"},tne={key:0,class:"data-display"},ane={class:"code-pre"},rne={key:1,class:"empty-state"},one=(0,r.pM)({__name:"GameVariableMemorySection",props:{memoryData:{}},setup:e=>(e,n)=>((0,r.uX)(),(0,r.CE)("div",ene,[n[1]||(n[1]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",{class:"section-title"},"Memory Data (记忆数据)")],-1)),(0,r.Lk)("div",nne,[e.memoryData&&Object.keys(e.memoryData).length>0?((0,r.uX)(),(0,r.CE)("div",tne,[(0,r.Lk)("pre",ane,(0,o.v_)(JSON.stringify(e.memoryData,null,2)),1)])):((0,r.uX)(),(0,r.CE)("div",rne,[(0,r.bF)((0,i.R1)(Vu),{size:32}),n[0]||(n[0]=(0,r.Lk)("p",null,"暂无记忆数据",-1))]))])]))});var ine=t(8092),sne={};sne.styleTagTransform=A(),sne.setAttributes=k(),sne.insert=y().bind(null,"head"),sne.domAPI=g(),sne.insertStyleElement=_(),h()(ine.A,sne),ine.A&&ine.A.locals&&ine.A.locals;const lne=(0,E.A)(one,[["__scopeId","data-v-04e0cd04"]]),cne={class:"raw-data-section"},dne={class:"raw-data-content"},une={key:0,class:"data-display"},pne={class:"code-pre"},vne={key:1,class:"empty-state"},fne=(0,r.pM)({__name:"GameVariableRawDataSection",props:{allTavernData:{}},setup:e=>(e,n)=>((0,r.uX)(),(0,r.CE)("div",cne,[n[1]||(n[1]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",{class:"section-title"},"Raw Data (原始数据)")],-1)),(0,r.Lk)("div",dne,[e.allTavernData&&Object.keys(e.allTavernData).length>0?((0,r.uX)(),(0,r.CE)("div",une,[(0,r.Lk)("pre",pne,(0,o.v_)(JSON.stringify(e.allTavernData,null,2)),1)])):((0,r.uX)(),(0,r.CE)("div",vne,[(0,r.bF)((0,i.R1)(B9),{size:32}),n[0]||(n[0]=(0,r.Lk)("p",null,"暂无原始数据",-1))]))])]))});var hne=t(1021),mne={};mne.styleTagTransform=A(),mne.setAttributes=k(),mne.insert=y().bind(null,"head"),mne.domAPI=g(),mne.insertStyleElement=_(),h()(hne.A,mne),hne.A&&hne.A.locals&&hne.A.locals;const gne=(0,E.A)(fne,[["__scopeId","data-v-2cab0dce"]]),bne={class:"data-display"},yne={key:0,class:"loading-state"},xne={key:1,class:"data-content"},kne={key:0,class:"error-state"},wne=(0,r.pM)({__name:"GameVariableDataDisplay",props:{isLoading:{type:Boolean},selectedDataType:{},searchQuery:{},readOnly:{type:Boolean,default:!1},coreDataViews:{},customOptions:{},characterData:{},saveData:{},worldInfo:{},memoryData:{},allGameData:{},filteredCoreDataViews:{},filteredCustomOptions:{},filteredChatVariables:{}},emits:["edit-variable","copy-variable","delete-variable","add-new-variable","debug-log"],setup(e){const n=e,t=(0,i.KR)(!1),a=()=>{t.value=!1},o=()=>{switch(n.selectedDataType){case"core":case"custom":default:return wee;case"character":return Nee;case"saveData":return Wee;case"worldInfo":return Zee;case"memory":return lne;case"raw":return gne}},s=()=>{const e={searchQuery:n.searchQuery,coreDataViews:n.coreDataViews||{},customOptions:n.customOptions||{},readOnly:n.readOnly};switch(n.selectedDataType){case"core":return{...e,type:"core",variables:n.filteredCoreDataViews||{}};case"custom":return{...e,type:"custom",variables:n.filteredCustomOptions||{}};case"character":return{characterData:n.characterData};case"saveData":return{saveData:n.saveData,readOnly:n.readOnly};case"worldInfo":return{worldInfo:n.worldInfo};case"memory":return{memoryData:n.memoryData};case"raw":return{allGameData:n.allGameData};default:return{...e,type:"chat",variables:n.filteredChatVariables||{}}}};return(e,n)=>((0,r.uX)(),(0,r.CE)("div",bne,[e.isLoading?((0,r.uX)(),(0,r.CE)("div",yne,[(0,r.bF)((0,i.R1)(Oc),{size:32,class:"animate-spin"}),n[5]||(n[5]=(0,r.Lk)("p",null,"正在加载数据...",-1))])):((0,r.uX)(),(0,r.CE)("div",xne,[t.value?((0,r.uX)(),(0,r.CE)("div",kne,[(0,r.bF)((0,i.R1)($c),{size:48}),n[6]||(n[6]=(0,r.Lk)("p",null,"数据显示出错",-1)),n[7]||(n[7]=(0,r.Lk)("p",{class:"hint"},"请尝试刷新数据",-1)),(0,r.Lk)("button",{onClick:a,class:"retry-btn"},"重试")])):((0,r.uX)(),(0,r.Wv)((0,r.$y)(o()),(0,r.v6)({key:1},s(),{onEditVariable:n[0]||(n[0]=n=>e.$emit("edit-variable",n)),onCopyVariable:n[1]||(n[1]=n=>e.$emit("copy-variable",n)),onDeleteVariable:n[2]||(n[2]=n=>e.$emit("delete-variable",n)),onAddNewVariable:n[3]||(n[3]=n=>e.$emit("add-new-variable",n)),onDebugLog:n[4]||(n[4]=n=>e.$emit("debug-log"))}),null,16))]))]))}});var _ne=t(7816),Cne={};Cne.styleTagTransform=A(),Cne.setAttributes=k(),Cne.insert=y().bind(null,"head"),Cne.domAPI=g(),Cne.insertStyleElement=_(),h()(_ne.A,Cne),_ne.A&&_ne.A.locals&&_ne.A.locals;const Ane=(0,E.A)(wne,[["__scopeId","data-v-3e8f894e"]]),Sne={class:"modal-header"},Lne={class:"modal-body"},Ene={class:"form-group"},Tne=["disabled"],Ine={key:0,class:"form-hint-text"},Rne={class:"form-group"},Mne={class:"value-type-selector"},Pne=["onClick"],Dne=["placeholder"],zne={key:0,class:"error-message"},Nne={key:1,class:"form-hint"},$ne={key:0,class:"preview-section"},One={class:"preview-content"},Fne={class:"modal-footer"},jne=["disabled"],Bne=(0,r.pM)({__name:"GameVariableEditModal",props:{editingItem:{}},emits:["close","save"],setup(e,{emit:n}){const t=e,a=n,l=(0,i.KR)({type:"",key:"",value:""}),c=(0,i.KR)("string"),d=(0,i.KR)(""),u=[{value:"string",label:"字符串"},{value:"number",label:"数字"},{value:"boolean",label:"布尔值"},{value:"object",label:"对象"},{value:"array",label:"数组"}],p=(0,r.EW)({get:()=>{if(!l.value)return"";const e=l.value.value;return"object"==typeof e&&null!==e?JSON.stringify(e,null,2):String(e??"")},set:e=>{l.value&&(l.value.value=e,h())}}),v=(0,r.EW)(()=>{if(d.value||!p.value)return null;try{if("object"===c.value||"array"===c.value){const e=JSON.parse(p.value);return JSON.stringify(e,null,2)}return null}catch{return null}}),f=(0,r.EW)(()=>""!==l.value.key.trim()&&""!==p.value.trim()&&!d.value),h=()=>{if(d.value="",p.value.trim()&&("object"===c.value||"array"===c.value))try{const e=JSON.parse(p.value);"array"!==c.value||Array.isArray(e)?"object"!==c.value||!Array.isArray(e)&&"object"==typeof e||(d.value="期望是对象类型，但解析结果不是对象"):d.value="期望是数组类型，但解析结果不是数组"}catch(e){d.value="JSON 格式错误: "+(e instanceof Error?e.message:"未知错误")}},m=()=>{switch(c.value){case"string":return"请输入字符串值，例如: Hello World";case"number":return"请输入数字值，例如: 123 或 3.14";case"boolean":return"请输入 true 或 false";case"object":return'请输入 JSON 对象，例如: {"name": "张三", "age": 25}';case"array":return'请输入 JSON 数组，例如: [1, 2, 3] 或 ["a", "b", "c"]';default:return"请输入值"}},g=()=>{switch(c.value){case"string":return"✅ 直接输入文本内容即可";case"number":return"✅ 输入数字，支持整数和小数";case"boolean":return"✅ 输入 true 或 false";case"object":return'✅ 使用 JSON 格式，例如: {"key": "value"}';case"array":return"✅ 使用 JSON 数组格式，例如: [1, 2, 3]";default:return"支持字符串、数字、布尔值、对象和数组"}},b=()=>{if(f.value)try{console.log("=== [Modal诊断] 开始保存 ==="),console.log("[Modal-1] editingValue.value (原始字符串):",p.value),console.log("[Modal-2] selectedType:",c.value);let e=p.value;switch(c.value){case"number":if(e=Number(p.value),isNaN(e))return void(d.value="无效的数字格式");break;case"boolean":e="true"===p.value.toLowerCase();break;case"object":case"array":console.log("[Modal-3] 解析前的JSON字符串:",p.value),e=JSON.parse(p.value),console.log("[Modal-4] 解析后的对象:",e),console.log("[Modal-5] 解析后的JSON:",JSON.stringify(e));break;default:e=p.value}l.value.value=e,console.log("[Modal-6] 即将emit的localEditingItem:",l.value),console.log("[Modal-7] 即将emit的finalValue:",e,"JSON:",JSON.stringify(e)),a("save",l.value)}catch(e){d.value="保存失败: "+(e instanceof Error?e.message:"未知错误")}};return(0,r.wB)(()=>t.editingItem,e=>{var n;e&&(l.value={...e},c.value=null==(n=e.value)?"string":Array.isArray(n)?"array":"object"==typeof n?"object":"boolean"==typeof n?"boolean":"number"==typeof n?"number":"string",d.value="",h())},{immediate:!0}),(e,n)=>e.editingItem?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:n[5]||(n[5]=n=>e.$emit("close"))},[(0,r.Lk)("div",{class:"modal-content",onClick:n[4]||(n[4]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",Sne,[(0,r.Lk)("h3",null,(0,o.v_)(l.value.key?"编辑变量":"新增变量"),1),(0,r.Lk)("button",{onClick:n[0]||(n[0]=n=>e.$emit("close")),class:"close-btn"},[(0,r.bF)((0,i.R1)(ed.A),{size:16})])]),(0,r.Lk)("div",Lne,[(0,r.Lk)("div",Ene,[n[6]||(n[6]=(0,r.Lk)("label",null,"变量名 (Key)",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>l.value.key=e),class:"form-input",disabled:!!e.editingItem.key,placeholder:"请输入变量名"},null,8,Tne),[[s.Jo,l.value.key]]),e.editingItem.key?((0,r.uX)(),(0,r.CE)("p",Ine," ℹ️ 编辑模式下无法修改变量名 ")):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Rne,[n[7]||(n[7]=(0,r.Lk)("label",null,"变量值 (Value)",-1)),(0,r.Lk)("div",Mne,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(u,e=>(0,r.Lk)("button",{key:e.value,onClick:n=>(e=>{if(c.value=e,!p.value)switch(e){case"string":p.value="";break;case"number":p.value="0";break;case"boolean":p.value="true";break;case"object":p.value="{}";break;case"array":p.value="[]"}h()})(e.value),class:(0,o.C4)(["type-btn",{active:c.value===e.value}])},(0,o.v_)(e.label),11,Pne)),64))]),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>p.value=e),class:(0,o.C4)(["form-textarea",{"has-error":d.value}]),rows:"10",placeholder:m()},null,10,Dne),[[s.Jo,p.value]]),d.value?((0,r.uX)(),(0,r.CE)("div",zne," ⚠️ "+(0,o.v_)(d.value),1)):((0,r.uX)(),(0,r.CE)("div",Nne,[(0,r.Lk)("p",null,(0,o.v_)(g()),1)]))]),v.value?((0,r.uX)(),(0,r.CE)("div",$ne,[n[8]||(n[8]=(0,r.Lk)("label",null,"预览",-1)),(0,r.Lk)("pre",One,(0,o.v_)(v.value),1)])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Fne,[(0,r.Lk)("button",{onClick:n[3]||(n[3]=n=>e.$emit("close")),class:"cancel-btn"},"取消"),(0,r.Lk)("button",{onClick:b,class:"save-btn",disabled:!f.value},[(0,r.bF)((0,i.R1)(Pc.A),{size:14}),n[9]||(n[9]=(0,r.Lk)("span",null,"保存",-1))],8,jne)])])])):(0,r.Q3)("v-if",!0)}});var Xne=t(8470),Une={};Une.styleTagTransform=A(),Une.setAttributes=k(),Une.insert=y().bind(null,"head"),Une.domAPI=g(),Une.insertStyleElement=_(),h()(Xne.A,Une),Xne.A&&Xne.A.locals&&Xne.A.locals;const Wne=(0,E.A)(Bne,[["__scopeId","data-v-01a0fb92"]]),qne={class:"modal-header"},Gne={class:"modal-body"},Hne={class:"stats-grid"},Vne={class:"stat-card"},Qne={class:"stat-icon core"},Kne={class:"stat-info"},Yne={class:"stat-value"},Jne={class:"stat-card"},Zne={class:"stat-icon global"},ete={class:"stat-info"},nte={class:"stat-value"},tte={class:"stat-card"},ate={class:"stat-icon memory"},rte={class:"stat-info"},ote={class:"stat-value"},ite={class:"stat-card"},ste={class:"stat-icon world"},lte={class:"stat-info"},cte={class:"stat-value"},dte={class:"data-size-info"},ute={class:"size-list"},pte={class:"size-item"},vte={class:"size-item"},fte={class:"size-item"},hte={class:"data-size-info",style:{"margin-top":"1rem"}},mte={class:"size-list"},gte={style:{"font-family":"monospace","font-size":"0.8rem"}},bte=(0,r.pM)({__name:"GameVariableStatsModal",props:{coreDataViews:{},customOptions:{},allGameData:{},getMemoryCount:{type:Function},getWorldItemCount:{type:Function}},emits:["close"],setup(e){const n=e,t=e=>new Blob([JSON.stringify(e)]).size,a=e=>{if(0===e)return"0 Bytes";const n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+["Bytes","KB","MB","GB"][n]};return(e,l)=>((0,r.uX)(),(0,r.CE)("div",{class:"modal-overlay",onClick:l[2]||(l[2]=n=>e.$emit("close"))},[(0,r.Lk)("div",{class:"modal-content stats-modal",onClick:l[1]||(l[1]=(0,s.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",qne,[l[3]||(l[3]=(0,r.Lk)("h3",null,"数据统计",-1)),(0,r.Lk)("button",{onClick:l[0]||(l[0]=n=>e.$emit("close")),class:"close-btn"},[(0,r.bF)((0,i.R1)(ed.A),{size:16})])]),(0,r.Lk)("div",Gne,[(0,r.Lk)("div",Hne,[(0,r.Lk)("div",Vne,[(0,r.Lk)("div",Qne,[(0,r.bF)((0,i.R1)(ip),{size:24})]),(0,r.Lk)("div",Kne,[(0,r.Lk)("div",Yne,(0,o.v_)(Object.keys(e.coreDataViews).length),1),l[4]||(l[4]=(0,r.Lk)("div",{class:"stat-label"},"核心数据",-1))])]),(0,r.Lk)("div",Jne,[(0,r.Lk)("div",Zne,[(0,r.bF)((0,i.R1)(ya.A),{size:24})]),(0,r.Lk)("div",ete,[(0,r.Lk)("div",nte,(0,o.v_)(Object.keys(e.customOptions).length),1),l[5]||(l[5]=(0,r.Lk)("div",{class:"stat-label"},"自定义选项",-1))])]),(0,r.Lk)("div",tte,[(0,r.Lk)("div",ate,[(0,r.bF)((0,i.R1)(Vu),{size:24})]),(0,r.Lk)("div",rte,[(0,r.Lk)("div",ote,(0,o.v_)(e.getMemoryCount()),1),l[6]||(l[6]=(0,r.Lk)("div",{class:"stat-label"},"记忆条目",-1))])]),(0,r.Lk)("div",ite,[(0,r.Lk)("div",ste,[(0,r.bF)((0,i.R1)(j9),{size:24})]),(0,r.Lk)("div",lte,[(0,r.Lk)("div",cte,(0,o.v_)(e.getWorldItemCount()),1),l[7]||(l[7]=(0,r.Lk)("div",{class:"stat-label"},"世界元素",-1))])])]),(0,r.Lk)("div",dte,[l[11]||(l[11]=(0,r.Lk)("h4",null,"数据大小统计",-1)),(0,r.Lk)("div",ute,[(0,r.Lk)("div",pte,[l[8]||(l[8]=(0,r.Lk)("span",null,"核心数据大小:",-1)),(0,r.Lk)("span",null,(0,o.v_)(a(t(e.coreDataViews))),1)]),(0,r.Lk)("div",vte,[l[9]||(l[9]=(0,r.Lk)("span",null,"自定义选项大小:",-1)),(0,r.Lk)("span",null,(0,o.v_)(a(t(e.customOptions))),1)]),(0,r.Lk)("div",fte,[l[10]||(l[10]=(0,r.Lk)("span",null,"总数据大小:",-1)),(0,r.Lk)("span",null,(0,o.v_)(a(t(e.allGameData))),1)])])]),(0,r.Lk)("div",hte,[l[12]||(l[12]=(0,r.Lk)("h4",null,"核心数据详细大小（前10个最大的）",-1)),(0,r.Lk)("div",mte,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Object.entries(n.coreDataViews).map(([e,n])=>({key:e,size:t(n)})).sort((e,n)=>n.size-e.size).slice(0,10),e=>((0,r.uX)(),(0,r.CE)("div",{key:e.key,class:"size-item"},[(0,r.Lk)("span",gte,(0,o.v_)(e.key),1),(0,r.Lk)("span",{style:(0,o.Tr)({color:e.size>5e4?"#ef4444":e.size>1e4?"#f59e0b":"inherit"})},(0,o.v_)(a(e.size)),5)]))),128))])])])])]))}});var yte=t(8537),xte={};xte.styleTagTransform=A(),xte.setAttributes=k(),xte.insert=y().bind(null,"head"),xte.domAPI=g(),xte.insertStyleElement=_(),h()(yte.A,xte),yte.A&&yte.A.locals&&yte.A.locals;const kte=(0,E.A)(bte,[["__scopeId","data-v-594e2d00"]]);var wte=t(406);const _te={class:"format-guide-modal"},Cte={class:"modal-header"},Ate={class:"modal-title"},Ste={class:"modal-body"},Lte={class:"format-guide-content"},Ete={class:"quick-nav"},Tte=["onClick"],Ite={class:"modal-footer"},Rte=(0,r.pM)({__name:"GameVariableFormatGuideModal",emits:["close"],setup(e){const n=(0,i.KR)("character"),t=(0,wte.lS)(!1),a=[{id:"character",title:"角色/状态"},{id:"ability",title:"异能"},{id:"inventory",title:"背包物品"},{id:"relationships",title:"关系"},{id:"world",title:"世界"},{id:"event",title:"事件"}],l=async()=>{try{await navigator.clipboard.writeText(t),_e.o.success("已复制完整数据格式说明")}catch(e){console.error("复制失败:",e),_e.o.error("复制失败")}};return(e,t)=>((0,r.uX)(),(0,r.CE)("div",{class:"format-guide-modal-overlay",onClick:t[2]||(t[2]=(0,s.D$)(n=>e.$emit("close"),["self"]))},[(0,r.Lk)("div",_te,[(0,r.Lk)("div",Cte,[(0,r.Lk)("h3",Ate,[(0,r.bF)((0,i.R1)(Qu.A),{size:20}),t[3]||(t[3]=(0,r.eW)(" 数据格式说明 ",-1))]),(0,r.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=n=>e.$emit("close")),title:"关闭"},[(0,r.bF)((0,i.R1)(ed.A),{size:20})])]),(0,r.Lk)("div",Ste,[(0,r.Lk)("div",Lte,[(0,r.Q3)(" 快速导航 "),(0,r.Lk)("div",Ete,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(a,e=>(0,r.Lk)("button",{key:e.id,class:(0,o.C4)(["nav-btn",{active:n.value===e.id}]),onClick:t=>(e=>{n.value=e;const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})})(e.id)},(0,o.v_)(e.title),11,Tte)),64))]),(0,r.Q3)(" 格式说明内容 "),t[4]||(t[4]=(0,r.Fv)('<div class="format-sections" data-v-6ab4ee13>\x3c!-- 角色信息 --\x3e<section id="character" class="format-section" data-v-6ab4ee13><h4 class="section-title" data-v-6ab4ee13>1. 角色与状态</h4><div class="section-content" data-v-6ab4ee13><h5 data-v-6ab4ee13>1.1 角色（基础档案）</h5><pre class="code-block" data-v-6ab4ee13>名字: string (只读)\n性别: &quot;男&quot;|&quot;女&quot;|&quot;其他&quot; (只读)\n年龄: number (自动计算)\n出生日期: {年, 月, 日, 小时?, 分钟?} (只读)\n先天属性: {力量, 敏捷, 意志, 幸运, 魅力, 体质} (只读，1-10)\n后天属性: {力量, 敏捷, 意志, 幸运, 魅力, 体质} (可修改，用add)</pre><h5 data-v-6ab4ee13>1.2 属性（可修改）</h5><pre class="code-block" data-v-6ab4ee13>觉醒阶段: {名称, 阶段, 当前进度, 下一级所需, 突破描述}\n  → 用set更新整个对象\n  → 突破时必须更新突破描述\n\n生命值/精神力/理智值/体力: {当前, 上限}\n  → 当前用add，上限突破时用add\n\n寿命: {当前, 上限}\n  → 当前用add/或在时间推进时由系统更新，上限突破时用add\n\n声望: number\n  → 用add增减或set覆盖\n\n位置: {描述:&quot;区域·地点&quot;, x, y}\n  → 顶级字段 key=&quot;位置&quot;，用set更新整个对象，三个字段必须同时设置\n\n效果: [{状态名称, 类型, 生成时间, 持续时间分钟, 状态描述}]\n  → 只能用push添加\n  → 类型必须是&quot;buff&quot;或&quot;debuff&quot;（全小写）\n  → 生成时间使用当前游戏时间\n  → 持续时间分钟：数值类型（99999表示永久）</pre><div class="example-box" data-v-6ab4ee13><strong data-v-6ab4ee13>示例：</strong><pre class="code-block" data-v-6ab4ee13>// 添加增益状态\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;效果&quot;,\n  &quot;value&quot;: {\n    &quot;状态名称&quot;: &quot;能量充盈&quot;,\n    &quot;类型&quot;: &quot;buff&quot;,\n    &quot;生成时间&quot;: {&quot;年&quot;: 1000, &quot;月&quot;: 3, &quot;日&quot;: 15, &quot;小时&quot;: 10, &quot;分钟&quot;: 30},\n    &quot;持续时间分钟&quot;: 120,\n    &quot;状态描述&quot;: &quot;能量恢复速度提升50%&quot;\n  }\n}</pre></div></div></section>\x3c!-- 背包与物品 --\x3e<section id="inventory" class="format-section" data-v-6ab4ee13><h4 class="section-title" data-v-6ab4ee13>3. 背包与物品</h4><div class="section-content" data-v-6ab4ee13><pre class="code-block" data-v-6ab4ee13>背包:\n  - 突变结晶: {下级, 中级, 上级, 顶级} (用add增减)\n  - 物品: {物品ID: Item对象}\n\n物品类型:\n  - 装备: {物品ID, 名称, 类型:&quot;装备&quot;, 品质, 数量, 描述, 装备增幅, 特殊效果}\n  - 消耗品/材料: {物品ID, 名称, 类型:&quot;药剂&quot;|&quot;材料&quot;|&quot;其他&quot;, 品质, 数量, 描述, 使用效果?}\n\n品质格式: {quality:&quot;凡&quot;|&quot;黄&quot;|&quot;玄&quot;|&quot;地&quot;|&quot;天&quot;|&quot;仙&quot;|&quot;神&quot;, grade:0-10}</pre><div class="warning-box" data-v-6ab4ee13><strong data-v-6ab4ee13>⚠️ 重要：</strong><ul data-v-6ab4ee13><li data-v-6ab4ee13>修炼进度和已解锁技能存储在<strong data-v-6ab4ee13>角色.背包.物品.{功法ID}</strong>中</li><li data-v-6ab4ee13>❌ 错误：修改&quot;角色.修炼.修炼功法&quot;字段（这是引用槽位，不是进度来源）</li><li data-v-6ab4ee13>✅ 正确：修改&quot;角色.背包.物品.{功法ID}.修炼进度&quot;</li></ul></div><div class="example-box" data-v-6ab4ee13><strong data-v-6ab4ee13>示例：</strong><pre class="code-block" data-v-6ab4ee13>// 增加功法修炼进度\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;角色.背包.物品.gongfa_001.修炼进度&quot;,\n  &quot;value&quot;: 10\n}\n\n// 解锁新技能\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;角色.背包.物品.gongfa_001.已解锁技能&quot;,\n  &quot;value&quot;: &quot;御剑术&quot;\n}</pre></div></div></section>\x3c!-- 人物关系 --\x3e<section id="relationships" class="format-section" data-v-6ab4ee13><h4 class="section-title" data-v-6ab4ee13>4. 关系</h4><div class="section-content" data-v-6ab4ee13><pre class="code-block" data-v-6ab4ee13>关系: {NPC名字: NPC档案对象}\n  - 名字: string\n  - 性别: &quot;男&quot;|&quot;女&quot;|&quot;其他&quot;\n  - 觉醒阶段: {名称, 阶段} (⚠️ NPC觉醒阶段是简化结构，严禁添加&quot;当前进度&quot;等玩家专属字段)\n  - 与玩家关系: string\n  - 好感度: number (-100~100，用add)\n  - 记忆: [string] (用push添加)\n  - 当前外貌状态: string (用set实时更新)\n  - 当前内心想法: string (用set实时更新)</pre><div class="warning-box" data-v-6ab4ee13><strong data-v-6ab4ee13>⚠️ NPC觉醒阶段格式：</strong><ul data-v-6ab4ee13><li data-v-6ab4ee13>✅ 正确：{&quot;名称&quot;: &quot;掌控期&quot;, &quot;阶段&quot;: &quot;适应&quot;}</li><li data-v-6ab4ee13>❌ 错误：{&quot;名称&quot;: &quot;掌控期&quot;, &quot;阶段&quot;: &quot;适应&quot;, &quot;当前进度&quot;: 0}</li></ul></div><div class="example-box" data-v-6ab4ee13><strong data-v-6ab4ee13>示例：</strong><pre class="code-block" data-v-6ab4ee13>// 增加好感度\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;关系.张三.好感度&quot;,\n  &quot;value&quot;: 10\n}\n\n// 添加记忆\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;关系.张三.记忆&quot;,\n  &quot;value&quot;: &quot;【1000年3月15日】与玩家一起探索废墟，感觉很愉快&quot;\n}\n\n// 更新关系\n{\n  &quot;action&quot;: &quot;set&quot;,\n  &quot;key&quot;: &quot;关系.张三.与玩家关系&quot;,\n  &quot;value&quot;: &quot;战友&quot;\n}</pre></div></div></section>\x3c!-- 世界信息 --\x3e<section id="world" class="format-section" data-v-6ab4ee13><h4 class="section-title" data-v-6ab4ee13>5. 世界</h4><div class="section-content" data-v-6ab4ee13><pre class="code-block" data-v-6ab4ee13>世界:\n  - 势力信息: [{名称, 类型, 等级, 位置, 与玩家关系, 声望值, ...}]\n  - 地点信息: [{名称, 类型, 位置, coordinates, ...}]\n\n势力信息字段:\n  - 名称: string\n  - 类型: &quot;避难所&quot;|&quot;流浪团伙&quot;|&quot;公司组织&quot;\n  - 等级: &quot;S级&quot;|&quot;A级&quot;|&quot;B级&quot;|&quot;C级&quot;\n  - 与玩家关系: &quot;敌对&quot;|&quot;中立&quot;|&quot;友好&quot;\n  - 声望值: number\n  - 领导层: {首领, 首领能力, 综合战力}\n  - 成员数量: {总数, 按觉醒阶段, 按职位}</pre><div class="example-box" data-v-6ab4ee13><strong data-v-6ab4ee13>示例：</strong><pre class="code-block" data-v-6ab4ee13>// 修改首领\n{\n  &quot;action&quot;: &quot;set&quot;,\n  &quot;key&quot;: &quot;世界.势力信息[0].领导层.首领&quot;,\n  &quot;value&quot;: &quot;新首领名字&quot;\n}\n\n// 增加声望\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;世界.势力信息[2].声望值&quot;,\n  &quot;value&quot;: 50\n}\n\n// 添加新地点\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;世界.地点信息&quot;,\n  &quot;value&quot;: {\n    &quot;名称&quot;: &quot;xx废墟&quot;,\n    &quot;类型&quot;: &quot;危险区域&quot;,\n    &quot;位置&quot;: &quot;废墟城联邦·北区&quot;,\n    &quot;coordinates&quot;: {&quot;x&quot;: 108.5, &quot;y&quot;: 28.3},\n    &quot;描述&quot;: &quot;...&quot;,\n    &quot;安全等级&quot;: &quot;危险&quot;\n  }\n}</pre></div></div></section>\x3c!-- 世界事件系统 --\x3e<section id="event" class="format-section" data-v-6ab4ee13><h4 class="section-title" data-v-6ab4ee13>6. 事件</h4><div class="section-content" data-v-6ab4ee13><pre class="code-block" data-v-6ab4ee13>社交.事件:\n  - 配置: {启用随机事件, 最小间隔月, 最大间隔月, 事件提示词}\n  - 下次事件时间: {年, 月, 日, 小时, 分钟} | null\n  - 事件记录: [事件对象]\n\n事件对象结构:\n  - 事件ID: string (格式: event_时间戳_随机数)\n  - 事件名称: string\n  - 事件类型: string (势力战争/世界变异/空投物资/异常区域/好友遭遇等)\n  - 事件描述: string\n  - 影响等级: &quot;轻微&quot;|&quot;中等&quot;|&quot;重大&quot;|&quot;灾难&quot;\n  - 影响范围: string\n  - 相关人物: string[]\n  - 相关势力: string[]\n  - 事件来源: &quot;随机&quot;|&quot;玩家行为&quot;|&quot;剧情&quot;\n  - 发生时间: {年, 月, 日, 小时, 分钟}</pre><div class="example-box" data-v-6ab4ee13><strong data-v-6ab4ee13>示例：</strong><pre class="code-block" data-v-6ab4ee13>// 添加一条刚刚发生的世界事件\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;社交.事件.事件记录&quot;,\n  &quot;value&quot;: {\n    &quot;事件ID&quot;: &quot;event_1700000000000_42&quot;,\n    &quot;事件名称&quot;: &quot;黑铁堡与废土帮开战&quot;,\n    &quot;事件类型&quot;: &quot;势力战争&quot;,\n    &quot;事件描述&quot;: &quot;……&quot;,\n    &quot;影响等级&quot;: &quot;重大&quot;,\n    &quot;影响范围&quot;: &quot;废墟城联邦北区&quot;,\n    &quot;相关人物&quot;: [],\n    &quot;相关势力&quot;: [&quot;黑铁堡&quot;, &quot;废土帮&quot;],\n    &quot;事件来源&quot;: &quot;随机&quot;,\n    &quot;发生时间&quot;: {&quot;年&quot;: 12, &quot;月&quot;: 3, &quot;日&quot;: 18, &quot;小时&quot;: 14, &quot;分钟&quot;: 0}\n  }\n}</pre></div></div></section></div>',1))])]),(0,r.Lk)("div",Ite,[(0,r.Lk)("button",{class:"copy-btn",onClick:l},[(0,r.bF)((0,i.R1)(K9),{size:16}),t[5]||(t[5]=(0,r.eW)(" 复制全部格式 ",-1))]),(0,r.Lk)("button",{class:"close-footer-btn",onClick:t[1]||(t[1]=n=>e.$emit("close"))}," 关闭 ")])])]))}});var Mte=t(8153),Pte={};Pte.styleTagTransform=A(),Pte.setAttributes=k(),Pte.insert=y().bind(null,"head"),Pte.domAPI=g(),Pte.insertStyleElement=_(),h()(Mte.A,Pte),Mte.A&&Mte.A.locals&&Mte.A.locals;const Dte=(0,E.A)(Rte,[["__scopeId","data-v-6ab4ee13"]]),zte={class:"game-variable-panel"},Nte=(0,r.pM)({__name:"GameVariablePanel",setup(e){const{t:n}=(0,l.s)(),t=(0,Hu.useGameStateStore)(),a=(0,Ec.useCharacterStore)(),o=(0,r.EW)(()=>"联机"===a.activeCharacterProfile?.模式),s=(0,i.KR)(!1),c=(0,i.KR)(!1),d=(0,i.KR)(""),u=(0,i.KR)("saveData"),p=(0,i.KR)(""),v=(0,i.KR)(!1),f=(0,i.KR)(!1),h=(0,i.KR)(null),m=(0,i.KR)(!1),g=(0,r.EW)(()=>{if(!t.isGameLoaded)return{};const e=a.activeSaveSlot,n=a.activeCharacterProfile,r="联机"===n?.模式?n.存档?.云端同步信息:void 0,o=t.toSaveData()||{},i=(0,Ic.ru)(o)?o:(0,Ic.jj)(o).migrated,s={元数据:i.元数据,角色:i.角色,社交:i.社交,世界:i.世界,系统:i.系统};return s.元数据={...s.元数据&&"object"==typeof s.元数据?s.元数据:{},存档ID:e?.id??e?.存档名??void 0,角色ID:a.rootState.当前激活存档?.角色ID,模式:n?.模式,游玩时长:e?.游戏时长,创建时间:e?.保存时间??void 0,更新时间:e?.最后保存时间??e?.保存时间??void 0},r&&(s.系统&&"object"==typeof s.系统||(s.系统={}),s.系统.联机&&"object"==typeof s.系统.联机||(s.系统.联机={}),s.系统.联机.同步状态=r),s}),b=(0,r.EW)(()=>t.isGameLoaded?(t.$state,{[n("存档数据 (短路径)")]:g.value,[n("角色")]:t.character,[n("记忆")]:t.memory,[n("世界")]:t.worldInfo}):{}),y=(0,r.EW)(()=>({[n("游戏版本")]:"2.0.0",[n("架构模式")]:"Pinia内存 + DB持久化"})),x=(0,r.EW)(()=>t.character||{}),k=(0,r.EW)(()=>t.isGameLoaded?g.value:{}),w=(0,r.EW)(()=>t.worldInfo||{}),_=(0,r.EW)(()=>t.memory||{}),C=(0,r.EW)(()=>({...b.value,...y.value})),A=(0,r.EW)(()=>{if(!p.value)return b.value;const e=p.value.toLowerCase();return Object.fromEntries(Object.entries(b.value).filter(([n])=>n.toLowerCase().includes(e)))}),S=(0,r.EW)(()=>{if(!p.value)return y.value;const e=p.value.toLowerCase();return Object.fromEntries(Object.entries(y.value).filter(([n])=>n.toLowerCase().includes(e)))}),L=e=>{switch(e){case"core":return Object.keys(b.value).length;case"custom":return Object.keys(y.value).length;case"character":return Object.keys(x.value).length;case"saveData":return Object.keys(k.value).length;case"worldInfo":return T();case"memory":return E();case"raw":return Object.keys(C.value).length;default:return 0}},E=()=>"object"==typeof _.value&&null!==_.value?Object.keys(_.value).length:0,T=()=>"object"==typeof w.value&&null!==w.value?Object.keys(w.value).length:0,I=[{key:"saveData",label:n("存档数据(短路径)"),icon:"Archive"},{key:"core",label:n("核心数据"),icon:"Database"},{key:"character",label:n("角色数据"),icon:"Users"},{key:"worldInfo",label:n("世界信息"),icon:"Book"},{key:"memory",label:n("记忆数据"),icon:"Brain"},{key:"custom",label:n("自定义选项"),icon:"Settings"},{key:"raw",label:n("原始数据"),icon:"Code"}],R=async()=>{c.value=!0,s.value=!0;try{if(!t.isGameLoaded)return void _e.o.warning(n("请先加载游戏存档"));d.value=(new Date).toLocaleString("zh-CN"),_e.o.success(n("数据已从Pinia Store刷新"))}catch(e){console.error("[游戏变量] 刷新失败:",e),_e.o.error(n("数据刷新失败: ")+(e instanceof Error?e.message:n("未知错误")))}finally{s.value=!1,c.value=!1}},M=()=>{try{const e=JSON.stringify(C.value,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`game-variables-${Date.now()}.json`,r.click(),URL.revokeObjectURL(a),_e.o.success(n("数据导出成功"))}catch(e){console.error("[游戏变量] 导出失败:",e),_e.o.error(n("数据导出失败"))}},P=()=>{v.value=!0},D=()=>{_e.o.warning(n("新架构下不支持直接添加变量，请通过游戏操作修改数据"))},z=e=>{o.value?_e.o.warning(n("联机模式下不允许直接修改变量（服务器权威控制）")):"saveData"===e.type?(h.value={...e},m.value=!0):_e.o.warning(n("该视图为只读展示，请切换到「存档数据(短路径)」后再编辑具体路径"))},N=async e=>{try{const t="object"==typeof e.value?JSON.stringify(e.value,null,2):String(e.value);await navigator.clipboard.writeText(`${e.key}: ${t}`),_e.o.success(n("已复制到剪贴板"))}catch(e){console.error("[游戏变量] 复制失败:",e),_e.o.error(n("复制失败"))}},$=async()=>{o.value?_e.o.warning(n("联机模式下不允许直接删除变量（服务器权威控制）")):_e.o.warning(n("新架构下不支持直接删除变量，请通过游戏操作修改数据"))},O=async e=>{if(e)if(t.isGameLoaded)if(o.value)_e.o.warning(n("联机模式下不允许直接修改变量（服务器权威控制）"));else if("saveData"===e.type)try{const{key:a,value:r}=e;let o=r;if("string"==typeof r&&(r.trim().startsWith("{")||r.trim().startsWith("[")))try{o=JSON.parse(r)}catch{}const i=t.toSaveData();if(!i)return void _e.o.error(n("未获取到存档数据（存档可能未完整加载）"));const s=(0,Ic.ru)(i)?i:(0,Ic.jj)(i).migrated,l=JSON.parse(JSON.stringify(s));return(0,HD.set)(l,a,o),t.loadFromSaveData(l),await t.saveGame(),_e.o.success(n("✅ 已成功更新 ")+`${a}`),F(),void await R()}catch(e){const t=e instanceof Error?e.message:n("未知错误");_e.o.error(n("保存失败: ")+`${t}`),console.error("[游戏变量] 保存失败:",e)}else _e.o.warning(n("该视图不支持保存修改，请在「存档数据(短路径)」中编辑具体路径"));else _e.o.warning(n("请先加载游戏存档"));else _e.o.error(n("没有要保存的数据"))},F=()=>{m.value=!1,h.value=null},j=()=>{console.group("[游戏变量] 详细调试信息 (Pinia模式)"),console.log(n("基本统计:"),{[n("游戏已加载")]:t.isGameLoaded,[n("角色名")]:t.character?.名字,coreDataViewsCount:Object.keys(b.value).length,customOptionsCount:Object.keys(y.value).length,lastUpdateTime:d.value}),console.log(n("核心数据键名:"),Object.keys(b.value)),console.log(n("自定义选项键名:"),Object.keys(y.value)),console.log(n("完整SaveData:"),t.toSaveData()),console.groupEnd(),_e.o.success(n("调试信息已输出到控制台"))};return(0,r.sV)(()=>{R(),fp.on("refresh",()=>R()),fp.on("export",()=>M()),fp.on("stats",()=>P())}),(e,n)=>((0,r.uX)(),(0,r.CE)("div",zte,[(0,r.bF)($9,{isRefreshing:c.value,searchQuery:p.value,"onUpdate:searchQuery":n[0]||(n[0]=e=>p.value=e),onRefresh:R,onExport:M,onShowStats:P,onShowFormatGuide:n[1]||(n[1]=e=>f.value=!0)},null,8,["isRefreshing","searchQuery"]),(0,r.bF)(V9,{dataTypes:I,selectedType:u.value,getDataCount:L,"onUpdate:selectedType":n[2]||(n[2]=e=>u.value=e)},null,8,["selectedType"]),(0,r.bF)(Ane,{isLoading:s.value,selectedDataType:u.value,searchQuery:p.value,readOnly:o.value,coreDataViews:b.value,customOptions:y.value,characterData:x.value,saveData:k.value,worldInfo:w.value,memoryData:_.value,allGameData:C.value,filteredCoreDataViews:A.value,filteredCustomOptions:S.value,onEditVariable:z,onCopyVariable:N,onDeleteVariable:$,onAddNewVariable:D,onDebugLog:j},null,8,["isLoading","selectedDataType","searchQuery","readOnly","coreDataViews","customOptions","characterData","saveData","worldInfo","memoryData","allGameData","filteredCoreDataViews","filteredCustomOptions"]),m.value?((0,r.uX)(),(0,r.Wv)(Wne,{key:0,editingItem:h.value,onClose:F,onSave:O},null,8,["editingItem"])):(0,r.Q3)("v-if",!0),v.value?((0,r.uX)(),(0,r.Wv)(kte,{key:1,coreDataViews:b.value,customOptions:y.value,allGameData:C.value,getMemoryCount:E,getWorldItemCount:T,onClose:n[3]||(n[3]=e=>v.value=!1)},null,8,["coreDataViews","customOptions","allGameData"])):(0,r.Q3)("v-if",!0),f.value?((0,r.uX)(),(0,r.Wv)(Dte,{key:2,onClose:n[4]||(n[4]=e=>f.value=!1)})):(0,r.Q3)("v-if",!0)]))}});var $te=t(4559),Ote={};Ote.styleTagTransform=A(),Ote.setAttributes=k(),Ote.insert=y().bind(null,"head"),Ote.domAPI=g(),Ote.insertStyleElement=_(),h()($te.A,Ote),$te.A&&$te.A.locals&&$te.A.locals;const Fte=(0,E.A)(Nte,[["__scopeId","data-v-d867d926"]]);var jte=t(9313);const Bte=(0,I.A)("calendar-check",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),Xte=(0,I.A)("corner-up-left",[["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}],["path",{d:"M9 14 4 9l5-5",key:"102s5s"}]]);var Ute=t(4804),Wte=t(1875);const qte={class:"online-travel-panel"},Gte={key:0,class:"notice error-indicator"},Hte={key:1,class:"notice error-indicator"},Vte={key:2,class:"notice warning-indicator"},Qte={class:"tabs-header"},Kte={class:"tabs-nav"},Yte=["onClick"],Jte={class:"header-actions"},Zte=["disabled"],eae=["disabled"],nae={class:"tab-content"},tae={key:0,class:"travel-tab"},aae={class:"travel-layout"},rae={class:"worlds-list-panel"},oae={class:"filter-bar"},iae={class:"search-box"},sae=["placeholder","disabled"],lae=["disabled"],cae={value:""},dae={value:"public"},uae={value:"hidden"},pae={class:"travel-points-bar"},vae={class:"points-label"},fae={class:"points-value"},hae={class:"worlds-list"},mae={key:0,class:"loading-state"},gae={key:1,class:"empty-state"},bae={key:2},yae=["onClick"],xae={class:"world-info"},kae={class:"owner-name"},wae={class:"world-meta"},_ae={class:"world-id"},Cae=["disabled"],Aae={class:"travel-action-panel"},Sae={class:"action-panel-header"},Lae={class:"action-panel-body"},Eae={key:0,class:"session-info-box session-info-standalone"},Tae={class:"session-header"},Iae={class:"session-label"},Rae={class:"heartbeat-text"},Mae=["disabled"],Pae=["disabled"],Dae={key:0,class:"selected-world-detail"},zae={class:"detail-info"},Nae={class:"info-row"},$ae={class:"info-label"},Oae={class:"info-value"},Fae={class:"info-row"},jae={class:"info-label"},Bae={class:"info-row"},Xae={class:"info-label"},Uae={key:0,class:"invite-code-section"},Wae=["placeholder","disabled"],qae={class:"action-buttons"},Gae=["disabled"],Hae={key:0,class:"inline-hint danger"},Vae={key:1,class:"inline-hint danger"},Qae={key:1,class:"empty-selection"},Kae={key:0,class:"my-world-info"},Yae={class:"info-title"},Jae={class:"info-row"},Zae={class:"info-row"},ere={class:"muted"},nre={class:"info-row"},tre={class:"muted"},are={key:0,class:"info-row"},rre={class:"muted"},ore={key:1,class:"invite-code-section"},ire={class:"section-label"},sre={class:"hint-text"},lre={class:"invite-code-row"},cre=["value"],dre=["disabled"],ure=["disabled"],pre={key:0,class:"inline-hint danger"},vre={class:"my-world-actions"},fre=["disabled"],hre=["disabled"],mre=["disabled"],gre={key:2,class:"offline-prompt-section"},bre={class:"section-label"},yre={class:"hint-text"},xre=["placeholder","disabled"],kre={class:"prompt-actions"},wre=["disabled"],_re={key:0,class:"unsaved-hint"},Cre={key:1,class:"empty-selection"},Are={class:"reports-tab"},Sre={class:"reports-header"},Lre={class:"muted"},Ere=["disabled"],Tre={key:0,class:"empty-state"},Ire={key:1,class:"report-list"},Rre={class:"muted"},Mre=["onClick","disabled"],Pre={key:1,class:"report-preview"},Dre={class:"logs-tab"},zre={key:0,class:"empty-state"},Nre={key:0,class:"quick-session-list"},$re=["onClick","disabled"],Ore={key:1,class:"logs-layout"},Fre={class:"reports-header"},jre={class:"muted"},Bre=["disabled"],Xre={key:0,class:"empty-state"},Ure={key:1,class:"log-list"},Wre={class:"log-time"},qre={class:"log-type"},Gre={key:0,class:"log-meta"},Hre={key:1,class:"log-meta"},Vre={key:2,class:"log-meta note"},Qre="dad_online_world_backup_",Kre=(0,r.pM)({__name:"OnlineTravelPanel",setup(e){const n=[{id:"travel",label:"穿越",icon:lp.A},{id:"reports",label:"入侵报告",icon:Mc.A},{id:"logs",label:"会话日志",icon:Jc.A}],t=(0,i.KR)("travel"),{t:a}=(0,l.s)(),c=(0,$.useUIStore)(),d=(0,Ec.useCharacterStore)(),u=(0,Hu.useGameStateStore)(),p=(0,i.KR)(!1),v=(0,i.KR)(0),f=(0,i.KR)(!1),h=(0,i.KR)(""),m=(0,i.KR)(""),g=(0,i.KR)(""),b=(0,i.KR)(null),y=(0,i.KR)(null),x=(0,i.KR)(null),k=(0,i.KR)(null),w=(0,i.KR)([]),_=(0,i.KR)(null),C=(0,i.KR)(null),A=(0,i.KR)(""),S=(0,i.KR)([]),L=(0,i.KR)(null),E=(0,i.KR)(""),T=(0,i.KR)(""),I=(0,i.KR)(!1),R=(0,i.KR)(0),M=(0,i.KR)(!0),P=(0,i.KR)(null),z=(0,i.KR)(null),N=(0,i.KR)("normal"),O=(0,i.KR)(null),F=(0,i.KR)(""),j=e=>({public:a("公开"),hidden:a("隐藏"),locked:a("上锁")}[e]||e),B=async()=>{const e=b.value?.invite_code;e&&await(async e=>{try{await navigator.clipboard.writeText(e),_e.o.success(a("已复制"))}catch{_e.o.warning(a("复制失败"))}})(e)},X=async()=>{if(b.value)if("public"!==b.value.visibility_mode){if(!p.value){p.value=!0;try{b.value=await(0,GY.xV)(),b.value.invite_code&&_e.o.success(a("邀请码已重新生成"))}catch{}finally{p.value=!1}}}else _e.o.info(a("公开世界无需邀请码"))},U=async()=>{y.value&&(t.value="logs",await oe(y.value.session_id))},W=e=>{const n=e.summary;if(!n||"object"!=typeof n)return null;const t=n.session_id??n.sessionId;return"number"==typeof t&&Number.isFinite(t)?t:"string"==typeof t&&/^\d+$/.test(t)?Number(t):null},q=(0,r.EW)(()=>{const e=w.value.map(W).filter(e=>"number"==typeof e&&Number.isFinite(e));return Array.from(new Set(e)).slice(0,10)}),G=(0,r.EW)(()=>c.isBackendAvailable),H=(0,r.EW)(()=>"联机"===d.activeCharacterProfile?.模式),V=((0,r.EW)(()=>v.value>0&&h.value.trim().length>0&&G.value&&H.value),(0,i.KR)("target")),Q=(0,r.EW)(()=>null!==L.value&&!y.value&&v.value>0&&G.value&&H.value&&!0!==L.value.owner_online&&!1!==L.value.allow_offline_travel&&("public"===L.value.visibility_mode||m.value.trim().length>0)),K=e=>JSON.parse(JSON.stringify(e)),Y=()=>{const e=d.rootState?.当前激活存档;return`${Qre}${e?.角色ID??"unknown"}`},J=()=>{const e=d.rootState?.当前激活存档;return`dad_travel_full_backup_${e?.角色ID??"unknown"}_${e?.存档槽位??"unknown"}`},Z=(e=!1)=>{const n=Y();if(!e&&localStorage.getItem(n))return void console.log("[联机穿越] 世界备份已存在，跳过");const t={worldInfo:u.worldInfo?K(u.worldInfo):null,location:u.location?K(u.location):null,relationships:u.relationships?K(u.relationships):null,onlineState:u.onlineState?K(u.onlineState):null,timestamp:(new Date).toISOString(),characterId:d.rootState?.当前激活存档?.角色ID};console.log("[联机穿越] 保存世界备份:",{key:n,hasWorldInfo:!!t.worldInfo,hasLocation:!!t.location,hasRelationships:!!t.relationships,hasOnlineState:!!t.onlineState,characterId:t.characterId}),localStorage.setItem(n,JSON.stringify(t)),localStorage.setItem(`${Qre}latest`,JSON.stringify(t))},ee=async(e={})=>{const n=await(async()=>{try{const e=J(),n=await(0,Xx.loadFromIndexedDB)(e);return n&&n.saveData?(console.log("[联机穿越] 找到完整存档备份:",{key:e,characterId:n.characterId,slotId:n.slotId,timestamp:n.timestamp}),n):(console.warn("[联机穿越] 未找到完整存档备份:",e),null)}catch(e){return console.error("[联机穿越] 读取完整存档备份失败:",e),null}})();if(n&&n.saveData){console.log("[联机穿越] 从IndexedDB恢复完整存档...");const t=d.rootState?.当前激活存档?.角色ID;if(!n.characterId||!t||n.characterId===t)return await u.loadFromSaveData(n.saveData),await(async()=>{try{const e=J();await(0,Xx.saveData)(e,null),console.log("[联机穿越] 完整存档备份已清理:",e)}catch(e){console.warn("[联机穿越] 清理完整存档备份失败:",e)}})(),localStorage.removeItem(Y()),localStorage.removeItem(`${Qre}latest`),e.persist&&await d.saveCurrentGame(),console.log("[联机穿越] ✅ 完整存档恢复成功"),!0;console.warn("[联机穿越] 完整备份角色ID不匹配，跳过完整恢复",{current:t,backup:n.characterId})}const t=(()=>{const e=d.rootState?.当前激活存档,n=[`${Qre}${e?.角色ID??"unknown"}`,`${Qre}latest`];for(const e of n){const n=localStorage.getItem(e);if(n)try{const t=JSON.parse(n);if(t&&"object"==typeof t)return console.log(`[联机穿越] 找到备份: ${e}`,{hasWorldInfo:!!t.worldInfo,hasLocation:!!t.location,hasRelationships:!!t.relationships,hasOnlineState:!!t.onlineState}),{...t,backupKey:e}}catch(n){console.warn(`[联机穿越] 备份解析失败: ${e}`,n),localStorage.removeItem(e)}}return null})();if(t){console.log("[联机穿越] 降级：从localStorage恢复部分世界备份:",{hasWorldInfo:!!t.worldInfo,hasLocation:!!t.location,hasRelationships:!!t.relationships,hasOnlineState:!!t.onlineState,backupKey:t.backupKey,timestamp:t.timestamp,characterId:t.characterId});const n=d.rootState?.当前激活存档?.角色ID,r=t.characterId;return r&&n&&r!==n&&(console.warn("[联机穿越] 备份角色ID不匹配，但仍然恢复",{current:n,backup:r}),_e.o.warning(a("备份角色ID不匹配，可能存在数据不一致"))),t.worldInfo&&u.updateState("worldInfo",t.worldInfo),t.location&&u.updateState("location",t.location),t.relationships&&u.updateState("relationships",t.relationships),t.onlineState&&u.updateState("onlineState",t.onlineState),t.backupKey&&localStorage.removeItem(t.backupKey),localStorage.removeItem(Y()),localStorage.removeItem(`${Qre}latest`),e.persist&&await d.saveCurrentGame(),console.log("[联机穿越] 世界备份恢复成功"),!0}if(console.warn("[联机穿越] 未找到任何世界备份，尝试清理联机状态"),u.onlineState&&u.onlineState.房间ID){const n=u.onlineState;console.log("[联机穿越] 清理联机状态:",{房间ID:n.房间ID,模式:n.模式}),u.updateState("onlineState",{...u.onlineState||{},房间ID:null,穿越目标:null}),e.persist&&await d.saveCurrentGame(),console.log("[联机穿越] 联机状态已清理")}return!1},ne=async()=>{try{const e=await(0,GY._m)();v.value=e.travel_points,f.value=!!e.signed_in,g.value=""}catch(e){g.value=e?.message||"穿越服务暂不可用"}},te=async()=>{try{w.value=await(0,GY.rz)()}catch{w.value=[]}},ae=async()=>{try{b.value=await(0,GY.uQ)()}catch{b.value=null}},re=async()=>{try{C.value=await(0,Wte.gz)()}catch{C.value=null}},oe=async e=>{try{_.value=await(0,GY.ih)(e)}catch{_.value=null}},ie=e=>{const n=e?.payload;if(!n||"object"!=typeof n)return null;const t=n?.note;if("string"==typeof t&&t.trim())return t.trim();const a=n?.message;return"string"==typeof a&&a.trim()?a.trim():null},se=async(e=!1)=>{if(y.value){x.value=await(0,GY.r9)(y.value.target_world_instance_id,y.value.entry_map_id,y.value.session_id),k.value=null;try{k.value=await(0,GY.zx)(y.value.session_id)}catch{k.value=null}x.value&&await(async(e,n,t,a=!1)=>{Z();const r=L.value?.owner_username?`${L.value.owner_username}的世界`:`联机世界 #${n.target_world_instance_id}`,o=e.world_info??t?.world_info,i=o&&"object"==typeof o?o:{世界名称:r,大陆信息:[],势力信息:[],地点信息:[],地图配置:{width:1200,height:900},生成时间:(new Date).toISOString(),世界背景:"",世界纪元:"联机",特殊设定:[],版本:"online"};if(u.updateState("worldInfo",i),a){const n=((e,n)=>{const t=e.world_info,a=t?.["地图配置"]||{width:1e4,height:1e4},r=Number(a.width)||1e4,o=Number(a.height)||1e4;return{描述:`${n}（穿越落点）`,x:Math.round(.1*r+Math.random()*r*.8),y:Math.round(.1*o+Math.random()*o*.8),区域等级:"绿区"}})(e,r);u.updateState("location",n)}const s=e.relationships??t?.relationships;if(s&&"object"==typeof s){const e=(e=>{const n={};for(const[t,a]of Object.entries(e))n[t]=a&&"object"==typeof a?{...a,与玩家关系:"陌生人",好感度:0,记忆:[],记忆总结:[],当前内心想法:"...",实时关注:!1}:a;return n})(s);u.updateState("relationships",e)}const l=u.onlineState??{模式:"联机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"},c=e.owner_location??t?.owner_location??null;console.log("[联机穿越] 世界主人位置数据:",{"mapGraph.owner_location":e.owner_location,"snapshot?.owner_location":t?.owner_location,最终使用:c});const d=L.value?.allow_map_overwrite??l?.穿越目标?.允许地图覆盖??null;u.updateState("onlineState",{...l,模式:"联机",房间ID:String(n.session_id),只读路径:l.只读路径??["世界"],穿越目标:{...l.穿越目标??{},世界ID:n.target_world_instance_id,主人用户名:t?.owner_username??L.value?.owner_username??null,允许地图覆盖:d,世界主人位置:c,世界主人档案:(()=>{const n=e.owner_base_info??t?.owner_base_info;if(!n||"object"!=typeof n)return null;const a=n;return{名字:a.名字??a.name??null,性别:a.性别??a.gender??null,种族:a.种族??a.race??null,世界:a.世界?.name??a.世界??null,觉醒阶段:a.觉醒阶段??a.cultivation_level??null,生命值:a.生命值??null,精神力:a.精神力??null,理智值:a.理智值??null,体力:a.体力??null,寿命:a.寿命??null,先天属性:a.先天属性??null,后天属性:a.后天属性??null,门派:a.门派??a.sect??null,功法:a.功法??null,技能:a.技能??a.skills??null,特质:a.特质??a.traits??null,_raw:a}})(),存档版本:t?.save_version??null,游戏时间:t?.game_time??null}})})(x.value,y.value,k.value,e)}else x.value=null},le=async()=>{try{const e=await(0,GY.RZ)();e?(y.value=e,await se(),ce()):(y.value=null,x.value=null,de(),await ee())}catch{}},ce=()=>{de(),y.value&&(z.value=window.setInterval(()=>{(async()=>{if(y.value)try{const e=await(0,GY.RJ)(y.value.session_id);if(O.value=new Date,N.value="normal",F.value="通信正常","active"!==e.state){const n="owner_online"===e.end_reason||"kicked"===e.end_reason,r=y.value.session_id;de(),y.value=null,x.value=null,await ee({persist:!0});let o="";o=n?"owner_online"===e.end_reason?"【强制驱逐】你突然感到一股强大的排斥力量！世界主人已经上线，这个世界的真正主人回归了。虚空裂隙被强行撕开，你被一股不可抗拒的力量推出了这个世界。\n\n当你回过神来，发现自己已经回到了自己的世界。":"【强制驱逐】你突然感到一股强大的排斥力量！世界主人发现了你的存在，决定将你驱逐出境。虚空裂隙被强行撕开，你被一股不可抗拒的力量推出了这个世界。\n\n当你回过神来，发现自己已经回到了自己的世界。":"【穿越结束】虚空裂隙再次出现，将你从异世界拉回。当你睁开眼睛时，发现自己已经回到了熟悉的世界。周围的一切都如你离开时一样，仿佛时间在你离开期间被冻结了。";const i={type:"system",content:o,time:(new Date).toISOString(),actionOptions:["查看自身状态","回忆穿越经历","继续当前活动"]};u.narrativeHistory&&u.narrativeHistory.push(i),u.addToShortTermMemory("你的联机穿越结束了，已返回自己的世界。原世界在你离开期间处于时间冻结状态，一切如你离开时一样。"),await d.saveCurrentGame(),await te(),await oe(r),t.value="logs",n&&("owner_online"===e.end_reason?_e.o.warning(a("世界主人已上线，你被驱逐出了该世界")):_e.o.warning(a("你已被驱逐出该世界")))}}catch(e){if(404===e?.status||404===e?.response?.status){const e=y.value?.session_id;de(),y.value=null,x.value=null,await ee({persist:!0});const n={type:"system",content:"【穿越结束】虚空裂隙突然消失，你被强制拉回了自己的世界。当你回过神来，发现自己已经回到了熟悉的地方。周围的一切都如你离开时一样。",time:(new Date).toISOString(),actionOptions:["查看自身状态","继续当前活动"]};u.narrativeHistory&&u.narrativeHistory.push(n),u.addToShortTermMemory("你的联机穿越会话已结束，已返回自己的世界。"),await d.saveCurrentGame(),e&&await oe(e),t.value="logs",_e.o.warning(a("穿越会话已结束"))}else N.value="warning",F.value="通信异常，正在重试...",console.warn("[联机穿越] 心跳检测失败:",e)}})()},3e4))},de=()=>{z.value&&(clearInterval(z.value),z.value=null)},ue=async()=>{if(G.value){p.value=!0;try{await ne(),await ae(),await re(),await te(),await le()}finally{p.value=!1}}},pe=async()=>{if(!p.value&&!f.value){p.value=!0;try{const e=await(0,GY.Z3)();v.value=e.travel_points,f.value=!!e.signed_in,_e.o.success(e.message)}catch{}finally{p.value=!1}}},ve=async()=>{if(b.value&&!p.value){p.value=!0;try{const e="public"===b.value.visibility_mode?"hidden":"hidden"===b.value.visibility_mode?"locked":"public";b.value=await(0,GY.S3)(e),_e.o.success(`${a("世界隐私已切换为")} ${j(b.value.visibility_mode)}`)}catch{}finally{p.value=!1}}},fe=async()=>{if(b.value&&!p.value){p.value=!0;try{const e=!(b.value.allow_offline_travel??1);b.value=await(0,GY.mS)(e),_e.o.success(a(e?"已开启下线代理":"已关闭下线代理"))}catch{}finally{p.value=!1}}},he=async()=>{if(b.value&&!p.value){p.value=!0;try{b.value=await(0,GY.X4)(A.value.trim()),_e.o.success(a("离线代理提示词已保存"))}catch{}finally{p.value=!1}}},me=async()=>{if(y.value&&!p.value){p.value=!0;try{const e=y.value.session_id;console.log("[OnlineTravel] 结束穿越会话:",e),await(async e=>{if(!y.value)return;const n=u.onlineState?.穿越目标;if(!1===n?.允许地图覆盖)return void console.log(`[联机穿越] 地图覆盖被禁用，跳过同步 (${e})`);const t=(()=>{const e=u.worldInfo;if(!e)return[];const n=e.地点信息??e.locations??[];return Array.isArray(n)&&0!==n.length?MK(n,e["地图配置"]||e.mapConfig||{width:1e4,height:1e4}).map((e,n)=>{const t=e.coordinates||{x:0,y:0},a=e.name||e.名称||`地点${n+1}`,r=e.type||e.类型,o=e.description||e.描述,i=e.所属势力||e.faction,s=e.标签??e.tags,l={名称:a,类型:r,坐标:{x:Math.round(t.x),y:Math.round(t.y)},状态:{名称:a,类型:r,描述:o,所属势力:i}};return void 0!==s&&(l.标签=s),l}):[]})();if(0!==t.length)try{await(0,GY.Kg)(y.value.target_world_instance_id,t,y.value.session_id,x.value?.map_id??y.value.entry_map_id),console.log(`[联机穿越] 已同步地图覆盖 (${e})`,{count:t.length})}catch(n){console.warn(`[联机穿越] 同步地图覆盖失败 (${e})`,n)}})("manual_end");const n=await(0,GY.IK)(e);console.log("[OnlineTravel] 结束穿越成功:",n),_e.o.success(n.message),de(),y.value=null,x.value=null,k.value=null,await ee({persist:!0});const a={type:"system",content:"【穿越结束】虚空裂隙再次出现，将你从异世界拉回。当你睁开眼睛时，发现自己已经回到了熟悉的世界。周围的一切都如你离开时一样，仿佛时间在你离开期间被冻结了。NPC们并不知道你曾经离开过，对他们来说，你只是短暂地失神了片刻。\n\n你的联机穿越之旅结束了，但那段经历将永远留在你的记忆中。",time:(new Date).toISOString(),actionOptions:["查看自身状态","回忆穿越经历","继续当前活动"]};u.narrativeHistory&&u.narrativeHistory.push(a),u.addToShortTermMemory("你结束了联机穿越，通过虚空通道返回了自己的世界。原世界在你离开期间处于时间冻结状态，一切如你离开时一样，NPC们并不知道你曾经离开过。"),await d.saveCurrentGame(),await te(),console.log("[OnlineTravel] 准备加载会话日志:",e),await oe(e),console.log("[OnlineTravel] 会话日志加载完成"),t.value="logs"}catch(e){console.error("[OnlineTravel] 结束穿越失败:",e)}finally{p.value=!1}}},ge=async(e=!1)=>{if(G.value){e&&(R.value=0,S.value=[],M.value=!0),I.value=!0;try{const n=await(0,GY.Cp)(20*R.value,20,T.value||void 0,E.value.trim()||void 0);n.length<20&&(M.value=!1),S.value=e?n:[...S.value,...n]}catch{}finally{I.value=!1}}},be=()=>{!I.value&&M.value&&(R.value++,ge(!1))},ye=e=>{const n=e?.summary;if(!n||"object"!=typeof n)return"";const t=n.notes;if(!Array.isArray(t)||0===t.length)return"";const a=t[0],r=a&&"object"==typeof a?a.note:null;return"string"==typeof r&&r.trim()?r.trim():""},xe=async()=>{if(L.value)if(y.value)_e.o.info(a("已有进行中的穿越，会话结束后才能继续"));else if(!p.value){p.value=!0;try{const e=await(async()=>{try{const e=J(),n=u.toSaveData();if(!n)return console.error("[联机穿越] 无法生成完整存档备份：toSaveData返回空"),!1;const t={saveData:K(n),timestamp:(new Date).toISOString(),characterId:d.rootState?.当前激活存档?.角色ID,slotId:d.rootState?.当前激活存档?.存档槽位};return await(0,Xx.saveData)(e,t),console.log("[联机穿越] ✅ 完整存档已备份到IndexedDB:",{key:e,characterId:t.characterId,slotId:t.slotId,timestamp:t.timestamp}),!0}catch(e){return console.error("[联机穿越] ❌ 保存完整存档备份失败:",e),!1}})();e||(_e.o.warning(a("备份本地存档失败，但仍将继续穿越")),console.warn("[联机穿越] 完整存档备份失败，继续穿越但可能有数据丢失风险")),y.value=await(0,GY.TY)(L.value.owner_username,m.value.trim()||void 0),v.value=y.value.travel_points_left,Z(!0),(y.value.owner_offline_agent_prompt||y.value.owner_character_info)&&u.updateState("onlineState",{...u.onlineState||{},穿越目标:{世界ID:y.value.target_world_instance_id,离线代理提示词:y.value.owner_offline_agent_prompt||null,角色信息:y.value.owner_character_info||null}}),await d.saveCurrentGame(),await se(!0),ce();const n=L.value?.owner_username||"对方",t=u.worldInfo?.大陆信息||[],r=t.length>0&&(t[0].名称||t[0].name)||"未知大陆",o=u.location,i={type:"system",content:`【穿越事件】时空裂隙突然出现，你被一股神秘力量卷入其中。当你再次睁开眼睛时，发现自己已经来到了一个完全陌生的世界——「${n}」的世界。你降临在${o?.描述||r}，坐标(${o?.x??"未知"}, ${o?.y??"未知"})。\n\n这里的一切都是陌生的，没有人认识你。你是一个外来者，一个穿越者。你保留着原世界的所有记忆，但这个世界的人并不知道"穿越"是什么。如果你提到原世界、寻找原世界的人、或者说一些这个世界的人听不懂的话，他们可能会觉得你在说胡话，或者认为你修炼走火入魔了。\n\n你需要小心行事，探索这个新世界。世界主人「${n}」可能在某处活动，你可以选择寻找他，或者独自探索。`,time:(new Date).toISOString(),actionOptions:["观察四周环境","寻找附近的人","查看自己的状态",`打听「${n}」的消息`]};u.narrativeHistory&&u.narrativeHistory.push(i),u.addToShortTermMemory(`【穿越到异世界】你通过虚空裂隙穿越到了「${n}」的世界。这是一个完全陌生的世界，你降临在${r}，坐标(${o?.x??"未知"}, ${o?.y??"未知"})。你是一个外来者，保留着原世界的记忆，但这里的人都不认识你。如果你提到原世界或说一些奇怪的话，这里的人可能会觉得你在说胡话。世界主人「${n}」可能在某处活动，你可以选择寻找他或独自探索。`),await d.saveCurrentGame(),_e.o.success(a("穿越成功"))}catch{}finally{p.value=!1}}};return(0,r.wB)([E,T],()=>{P.value&&clearTimeout(P.value),P.value=window.setTimeout(()=>{ge(!0)},500)}),(0,r.wB)(b,e=>{e&&(A.value=e.offline_agent_prompt||"")},{immediate:!0}),(0,r.sV)(async()=>{try{if(await c.checkBackendConnection(),!G.value)return;await ne(),await ae(),await re(),await te(),await le(),await ge(!0)}catch(e){console.warn("[OnlineTravelPanel] init failed",e)}}),(0,r.hi)(()=>{de(),P.value&&(clearTimeout(P.value),P.value=null)}),(e,l)=>((0,r.uX)(),(0,r.CE)("div",qte,[(0,r.Q3)(" 状态提示 "),(0,i.R1)(c).isBackendConfiguredComputed?G.value?H.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Q3)(" 标签页导航 "),(0,r.Lk)("div",Qte,[(0,r.Lk)("div",Kte,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(n,e=>(0,r.Lk)("button",{key:e.id,class:(0,o.C4)(["tab-btn",{active:t.value===e.id}]),onClick:n=>t.value=e.id},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon),{size:16})),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(a)(e.label)),1)],10,Yte)),64))]),(0,r.Lk)("div",Jte,[(0,r.Lk)("button",{class:"action-btn",onClick:ue,disabled:p.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:16})],8,Zte),(0,r.Lk)("button",{class:"action-btn primary",onClick:pe,disabled:p.value||f.value},[(0,r.bF)((0,i.R1)(Bte),{size:16}),(0,r.Lk)("span",null,(0,o.v_)(f.value?(0,i.R1)(a)("已签到"):(0,i.R1)(a)("签到")),1)],8,eae)])]),(0,r.Q3)(" 标签内容 "),(0,r.Lk)("div",nae,[(0,r.Q3)(" 穿越标签 "),"travel"===t.value?((0,r.uX)(),(0,r.CE)("div",tae,[(0,r.Lk)("div",aae,[(0,r.Q3)(" 左侧: 世界列表 "),(0,r.Lk)("div",rae,[(0,r.Q3)(" 搜索和筛选 "),(0,r.Lk)("div",oae,[(0,r.Lk)("div",iae,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),placeholder:(0,i.R1)(a)("搜索用户名..."),class:"search-input",disabled:I.value},null,8,sae),[[s.Jo,E.value]])]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>T.value=e),class:"filter-select",disabled:I.value},[(0,r.Lk)("option",cae,(0,o.v_)((0,i.R1)(a)("全部")),1),(0,r.Lk)("option",dae,(0,o.v_)((0,i.R1)(a)("公开")),1),(0,r.Lk)("option",uae,(0,o.v_)((0,i.R1)(a)("隐藏")),1)],8,lae),[[s.u1,T.value]])]),(0,r.Q3)(" 穿越点显示 "),(0,r.Lk)("div",pae,[(0,r.bF)((0,i.R1)(rp),{size:16,class:"points-icon"}),(0,r.Lk)("span",vae,(0,o.v_)((0,i.R1)(a)("穿越点"))+":",1),(0,r.Lk)("span",fae,(0,o.v_)(v.value),1)]),(0,r.Q3)(" 世界列表 "),(0,r.Lk)("div",hae,[I.value&&0===S.value.length?((0,r.uX)(),(0,r.CE)("div",mae,(0,o.v_)((0,i.R1)(a)("加载中...")),1)):0===S.value.length?((0,r.uX)(),(0,r.CE)("div",gae,[(0,r.bF)((0,i.R1)(lp.A),{size:48,class:"empty-icon"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(a)("暂无可穿越的世界")),1)])):((0,r.uX)(),(0,r.CE)("div",bae,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(S.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.world_instance_id,class:(0,o.C4)(["world-card",{selected:L.value?.world_instance_id===e.world_instance_id}]),onClick:n=>(e=>{L.value=e,m.value="",V.value="target"})(e)},[(0,r.Lk)("div",xae,[(0,r.Lk)("div",kae,(0,o.v_)(e.owner_username),1),(0,r.Lk)("div",wae,[(0,r.Lk)("span",{class:(0,o.C4)(["badge",`badge-${e.visibility_mode}`])},(0,o.v_)(j(e.visibility_mode)),3),(0,r.Lk)("span",{class:(0,o.C4)(["badge",e.owner_online?"badge-online":"badge-offline"])},(0,o.v_)(e.owner_online?(0,i.R1)(a)("在线"):(0,i.R1)(a)("离线")),3),(0,r.Lk)("span",_ae,"#"+(0,o.v_)(e.world_instance_id),1)])])],10,yae))),128)),(0,r.Q3)(" 加载更多 "),M.value?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"load-more-btn",onClick:be,disabled:I.value},(0,o.v_)(I.value?(0,i.R1)(a)("加载中..."):(0,i.R1)(a)("加载更多")),9,Cae)):(0,r.Q3)("v-if",!0)]))])]),(0,r.Q3)(" 右侧: 操作面板（顶部栏切换：穿越目标 / 我的世界） "),(0,r.Lk)("div",Aae,[(0,r.Lk)("div",Sae,[(0,r.Lk)("button",{class:(0,o.C4)(["panel-tab",{active:"target"===V.value}]),onClick:l[2]||(l[2]=e=>V.value="target")},(0,o.v_)((0,i.R1)(a)("穿越目标")),3),(0,r.Lk)("button",{class:(0,o.C4)(["panel-tab",{active:"myworld"===V.value}]),onClick:l[3]||(l[3]=e=>V.value="myworld")},(0,o.v_)((0,i.R1)(a)("我的世界")),3)]),(0,r.Lk)("div",Lae,[y.value?((0,r.uX)(),(0,r.CE)("div",Eae,[(0,r.Lk)("div",Tae,[(0,r.Lk)("div",Iae,(0,o.v_)((0,i.R1)(a)("当前会话"))+" #"+(0,o.v_)(y.value.session_id),1),(0,r.Q3)(" 🔥 心跳状态指示器 "),(0,r.Lk)("div",{class:(0,o.C4)(["heartbeat-indicator",`heartbeat-${N.value}`])},[l[7]||(l[7]=(0,r.Lk)("div",{class:"heartbeat-dot"},null,-1)),(0,r.Lk)("span",Rae,(0,o.v_)(F.value||"通信正常"),1)],2)]),(0,r.Lk)("button",{class:"action-btn sm",onClick:U,disabled:p.value},[(0,r.bF)((0,i.R1)(Jc.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("查看会话日志")),1)],8,Mae),(0,r.Lk)("button",{class:"action-btn",onClick:me,disabled:p.value},[(0,r.bF)((0,i.R1)(Xte),{size:16}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(a)("返回原世界")),1)],8,Pae)])):(0,r.Q3)("v-if",!0),"target"===V.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[L.value?((0,r.uX)(),(0,r.CE)("div",Dae,[(0,r.Lk)("h3",null,(0,o.v_)(L.value.owner_username)+" "+(0,o.v_)((0,i.R1)(a)("的世界")),1),(0,r.Lk)("div",zae,[(0,r.Lk)("div",Nae,[(0,r.Lk)("span",$ae,(0,o.v_)((0,i.R1)(a)("世界ID")),1),(0,r.Lk)("span",Oae,"#"+(0,o.v_)(L.value.world_instance_id),1)]),(0,r.Lk)("div",Fae,[(0,r.Lk)("span",jae,(0,o.v_)((0,i.R1)(a)("可见性")),1),(0,r.Lk)("span",{class:(0,o.C4)(["badge",`badge-${L.value.visibility_mode}`])},(0,o.v_)(j(L.value.visibility_mode)),3)]),(0,r.Lk)("div",Bae,[(0,r.Lk)("span",Xae,(0,o.v_)((0,i.R1)(a)("状态")),1),(0,r.Lk)("span",{class:(0,o.C4)(["badge",L.value.owner_online?"badge-online":"badge-offline"])},(0,o.v_)(L.value.owner_online?(0,i.R1)(a)("在线"):(0,i.R1)(a)("离线")),3)])]),(0,r.Q3)(" 邀请码输入(仅hidden/locked) "),"public"!==L.value.visibility_mode?((0,r.uX)(),(0,r.CE)("div",Uae,[(0,r.Lk)("label",null,(0,o.v_)((0,i.R1)(a)("邀请码（世界主人提供）")),1),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>m.value=e),placeholder:(0,i.R1)(a)("向世界主人索要邀请码..."),class:"invite-code-input",disabled:p.value},null,8,Wae),[[s.Jo,m.value]])])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 穿越按钮 "),(0,r.Lk)("div",qae,[(0,r.Lk)("button",{class:"action-btn primary",onClick:xe,disabled:!Q.value||p.value},[(0,r.bF)((0,i.R1)(Ute.A),{size:16}),(0,r.eW)(" "+(0,o.v_)((0,i.R1)(a)("穿越到此世界")),1)],8,Gae),L.value.owner_online?((0,r.uX)(),(0,r.CE)("div",Hae,(0,o.v_)((0,i.R1)(a)("世界主人在线中，需等待下线才能进入")),1)):!1===L.value.allow_offline_travel?((0,r.uX)(),(0,r.CE)("div",Vae,(0,o.v_)((0,i.R1)(a)("该世界未开启下线代理，无法穿越")),1)):(0,r.Q3)("v-if",!0)])])):((0,r.uX)(),(0,r.CE)("div",Qae,[(0,r.bF)((0,i.R1)(lp.A),{size:64,class:"empty-icon"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(a)("请从左侧选择一个世界")),1)]))],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[b.value?((0,r.uX)(),(0,r.CE)("div",Kae,[(0,r.Lk)("div",Yae,[(0,r.bF)((0,i.R1)(cp),{size:16}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("我的世界")),1)]),(0,r.Lk)("div",Jae,[l[8]||(l[8]=(0,r.Lk)("span",{class:"muted"},"ID",-1)),(0,r.Lk)("span",null,"#"+(0,o.v_)(b.value.world_instance_id),1)]),(0,r.Lk)("div",Zae,[(0,r.Lk)("span",ere,(0,o.v_)((0,i.R1)(a)("隐私")),1),(0,r.Lk)("span",{class:(0,o.C4)(["badge",`badge-${b.value.visibility_mode}`])},(0,o.v_)(j(b.value.visibility_mode)),3)]),(0,r.Lk)("div",nre,[(0,r.Lk)("span",tre,(0,o.v_)((0,i.R1)(a)("下线代理")),1),(0,r.Lk)("span",{class:(0,o.C4)(["badge",b.value.allow_offline_travel??1?"badge-online":"badge-locked"])},(0,o.v_)(b.value.allow_offline_travel??1?(0,i.R1)(a)("开启"):(0,i.R1)(a)("关闭")),3)]),C.value?((0,r.uX)(),(0,r.CE)("div",are,[(0,r.Lk)("span",rre,(0,o.v_)((0,i.R1)(a)("在线状态")),1),(0,r.Lk)("span",{class:(0,o.C4)(["badge",C.value.is_online?"badge-online":"badge-offline"])},(0,o.v_)(C.value.is_online?(0,i.R1)(a)("在线"):(0,i.R1)(a)("离线")),3)])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" 我的邀请码（仅hidden/locked） "),"public"!==b.value.visibility_mode?((0,r.uX)(),(0,r.CE)("div",ore,[(0,r.Lk)("div",ire,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(a)("我的邀请码")),1),(0,r.Lk)("span",sre,(0,o.v_)((0,i.R1)(a)("把它发给想来你世界的人")),1)]),(0,r.Lk)("div",lre,[(0,r.Lk)("input",{class:"invite-code-input",value:b.value.invite_code||"",readonly:""},null,8,cre),(0,r.Lk)("button",{class:"action-btn sm",onClick:B,disabled:p.value||!b.value.invite_code},[(0,r.bF)((0,i.R1)(K9),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("复制")),1)],8,dre),(0,r.Lk)("button",{class:"action-btn sm",onClick:X,disabled:p.value},[(0,r.bF)((0,i.R1)(uw.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("重新生成")),1)],8,ure)]),b.value.invite_code?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",pre,(0,o.v_)((0,i.R1)(a)("邀请码未生成，请点击重新生成")),1))])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",vre,[(0,r.Lk)("button",{class:"action-btn sm",onClick:ve,disabled:p.value},[(0,r.bF)((0,i.R1)(D),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("切换隐私")),1)],8,fre),(0,r.Lk)("button",{class:"action-btn sm",onClick:fe,disabled:p.value},[(0,r.bF)((0,i.R1)(lp.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("切换下线代理")),1)],8,hre),(0,r.Lk)("button",{class:"action-btn sm",onClick:re,disabled:p.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("刷新状态")),1)],8,mre)]),(0,r.Q3)(" 离线代理提示词配置 "),b.value.allow_offline_travel??1?((0,r.uX)(),(0,r.CE)("div",gre,[(0,r.Lk)("div",bre,[(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(a)("离线代理提示词")),1),(0,r.Lk)("span",yre,(0,o.v_)((0,i.R1)(a)("其他玩家遇到你时，AI将根据此提示词扮演你的角色")),1)]),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":l[5]||(l[5]=e=>A.value=e),placeholder:(0,i.R1)(a)("例如：我是一个冷静理智的觉醒者，不喜欢多话，遇到危险会优先自保..."),class:"offline-prompt-textarea",rows:"4",disabled:p.value},null,8,xre),[[s.Jo,A.value]]),(0,r.Lk)("div",kre,[(0,r.Lk)("button",{class:"action-btn sm primary",onClick:he,disabled:p.value||A.value===(b.value.offline_agent_prompt||"")},[(0,r.bF)((0,i.R1)(Pc.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("保存提示词")),1)],8,wre),A.value!==(b.value.offline_agent_prompt||"")?((0,r.uX)(),(0,r.CE)("span",_re,(0,o.v_)((0,i.R1)(a)("有未保存的更改")),1)):(0,r.Q3)("v-if",!0)])])):(0,r.Q3)("v-if",!0)])):((0,r.uX)(),(0,r.CE)("div",Cre,[(0,r.bF)((0,i.R1)(cp),{size:64,class:"empty-icon"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(a)("我的世界加载失败")),1)]))],64))])])])])):"reports"===t.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Q3)(" 报告标签 "),(0,r.Lk)("div",Are,[(0,r.Lk)("div",Sre,[(0,r.Lk)("span",Lre,(0,o.v_)((0,i.R1)(a)("最近 50 条入侵报告")),1),(0,r.Lk)("button",{class:"action-btn sm",onClick:te,disabled:p.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("刷新")),1)],8,Ere)]),0===w.value.length?((0,r.uX)(),(0,r.CE)("div",Tre,[(0,r.bF)((0,i.R1)(Mc.A),{size:48,class:"empty-icon"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(a)("暂无报告")),1)])):((0,r.uX)(),(0,r.CE)("div",Ire,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(w.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"report-item"},[(0,r.Lk)("span",{class:(0,o.C4)(["badge",e.unread?"unread":"read"])},(0,o.v_)(e.unread?(0,i.R1)(a)("未读"):(0,i.R1)(a)("已读")),3),(0,r.Lk)("span",null,"world: "+(0,o.v_)(e.world_instance_id),1),(0,r.Lk)("span",Rre,(0,o.v_)(e.created_at),1),W(e)?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"action-btn sm",onClick:n=>(async e=>{const n=W(e);n&&(t.value="logs",await oe(n))})(e),disabled:p.value},[(0,r.bF)((0,i.R1)(Jc.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("查看会话日志")),1)],8,Mre)):(0,r.Q3)("v-if",!0),ye(e)?((0,r.uX)(),(0,r.CE)("div",Pre,(0,o.v_)(ye(e)),1)):(0,r.Q3)("v-if",!0)]))),128))]))])],2112)):"logs"===t.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[(0,r.Q3)(" 会话日志 "),(0,r.Lk)("div",Dre,[_.value?((0,r.uX)(),(0,r.CE)("div",Ore,[(0,r.Lk)("div",Fre,[(0,r.Lk)("span",jre,(0,o.v_)((0,i.R1)(a)("会话"))+" #"+(0,o.v_)(_.value.session_id)+" · "+(0,o.v_)((0,i.R1)(a)("事件"))+" "+(0,o.v_)(_.value.events.length),1),(0,r.Lk)("button",{class:"action-btn sm",onClick:l[6]||(l[6]=e=>oe(_.value.session_id)),disabled:p.value},[(0,r.bF)((0,i.R1)(Fc.A),{size:14}),(0,r.eW)((0,o.v_)((0,i.R1)(a)("刷新")),1)],8,Bre)]),0===_.value.events.length?((0,r.uX)(),(0,r.CE)("div",Xre,[(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(a)("暂无事件")),1)])):((0,r.uX)(),(0,r.CE)("div",Ure,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.value.events,(e,n)=>{return(0,r.uX)(),(0,r.CE)("div",{key:n,class:"log-item"},[(0,r.Lk)("span",Wre,(0,o.v_)(e.created_at),1),(0,r.Lk)("span",qre,(0,o.v_)((t=e.event_type,{travel_start:"穿越开始",travel_end:"返回原世界",travel_evicted:"被驱逐（主人上线）",note:"日志",move:"移动",world_action_move:"移动"}[t]||t)),1),null!=e.map_id?((0,r.uX)(),(0,r.CE)("span",Gre,"map #"+(0,o.v_)(e.map_id),1)):(0,r.Q3)("v-if",!0),null!=e.poi_id?((0,r.uX)(),(0,r.CE)("span",Hre,"poi #"+(0,o.v_)(e.poi_id),1)):(0,r.Q3)("v-if",!0),ie(e)?((0,r.uX)(),(0,r.CE)("span",Vre,(0,o.v_)(ie(e)),1)):(0,r.Q3)("v-if",!0)]);var t}),128))]))])):((0,r.uX)(),(0,r.CE)("div",zre,[(0,r.bF)((0,i.R1)(Jc.A),{size:48,class:"empty-icon"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(a)("暂无会话日志")),1),q.value.length>0?((0,r.uX)(),(0,r.CE)("div",Nre,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(q.value,e=>((0,r.uX)(),(0,r.CE)("button",{key:e,class:"action-btn sm",onClick:n=>oe(e),disabled:p.value},(0,o.v_)((0,i.R1)(a)("会话"))+" #"+(0,o.v_)(e),9,$re))),128))])):(0,r.Q3)("v-if",!0)]))])],2112)):(0,r.Q3)("v-if",!0)])],64)):((0,r.uX)(),(0,r.CE)("div",Vte,(0,o.v_)((0,i.R1)(a)("当前不是联机存档，无法使用穿越功能")),1)):((0,r.uX)(),(0,r.CE)("div",Hte,(0,o.v_)((0,i.R1)(a)("后端未连接，联机/穿越不可用")),1)):((0,r.uX)(),(0,r.CE)("div",Gte,(0,o.v_)((0,i.R1)(a)("未配置后端服务器，联机/穿越不可用")),1))]))}});var Yre=t(9409),Jre={};Jre.styleTagTransform=A(),Jre.setAttributes=k(),Jre.insert=y().bind(null,"head"),Jre.domAPI=g(),Jre.insertStyleElement=_(),h()(Yre.A,Jre),Yre.A&&Yre.A.locals&&Yre.A.locals;const Zre=(0,E.A)(Kre,[["__scopeId","data-v-2831c8c3"]]);var eoe=t(1363);const noe=(0,I.A)("skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]),toe=(0,I.A)("ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]),aoe=(0,I.A)("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),roe={class:"mutant-panel"},ooe={class:"panel-header"},ioe={class:"header-left"},soe={class:"panel-title"},loe={key:0,class:"creature-count"},coe={key:0,class:"empty-state"},doe={class:"empty-hint"},uoe={key:1,class:"creature-grid"},poe={class:"card-header"},voe={class:"creature-name"},foe=["title","onClick"],hoe={class:"delete-text"},moe={class:"card-body"},goe={class:"info-row"},boe={class:"label"},yoe={class:"value"},xoe={key:0,class:"info-row"},koe={class:"label"},woe={class:"value"},_oe={class:"appearance-text"},Coe={key:1,class:"stats-grid"},Aoe={class:"stat-item"},Soe={class:"stat-value"},Loe={class:"stat-item"},Eoe={class:"stat-value"},Toe={class:"stat-item"},Ioe={class:"stat-value"},Roe={class:"stat-item"},Moe={class:"stat-value"},Poe={class:"stat-item"},Doe={class:"stat-value"},zoe={class:"stat-item"},Noe={class:"stat-value"},$oe={class:"stat-item"},Ooe={class:"stat-value"},Foe={class:"stat-item"},joe={class:"stat-value"},Boe={class:"stat-item"},Xoe={class:"stat-value"},Uoe={class:"stat-item"},Woe={class:"stat-value"},qoe={class:"stat-item"},Goe={class:"stat-value"},Hoe={key:2,class:"mutation-section"},Voe={class:"mutation-title"},Qoe={class:"mutation-desc"},Koe={key:3,class:"weakness-tags"},Yoe=(0,r.pM)({__name:"MutantCreaturePanel",setup(e){const{t:n}=(0,l.s)(),t=(0,Hu.useGameStateStore)(),a=(0,r.EW)(()=>t.worldInfo?.生物||[]);return(e,s)=>((0,r.uX)(),(0,r.CE)("div",roe,[(0,r.Lk)("div",ooe,[(0,r.Lk)("div",ioe,[(0,r.Lk)("h2",soe,[(0,r.bF)((0,i.R1)(noe),{size:24,class:"title-icon"}),(0,r.Lk)("span",null,(0,o.v_)((0,i.R1)(n)("突变生物图鉴")),1)]),a.value.length?((0,r.uX)(),(0,r.CE)("span",loe,(0,o.v_)(a.value.length)+" "+(0,o.v_)((0,i.R1)(n)("个记录")),1)):(0,r.Q3)("v-if",!0)])]),0===a.value.length?((0,r.uX)(),(0,r.CE)("div",coe,[(0,r.bF)((0,i.R1)(toe),{size:48,class:"empty-icon"}),(0,r.Lk)("p",null,(0,o.v_)((0,i.R1)(n)("暂无突变生物记录")),1),(0,r.Lk)("p",doe,(0,o.v_)((0,i.R1)(n)("在探索中遇到的突变生物将显示在这里")),1)])):((0,r.uX)(),(0,r.CE)("div",uoe,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["creature-card",e.level])},[(0,r.Lk)("div",poe,[(0,r.Lk)("div",{class:(0,o.C4)(["level-badge",e.level])},(0,o.v_)(e.level)+"级",3),(0,r.Lk)("h3",voe,(0,o.v_)(e.name),1),(0,r.Lk)("button",{class:"delete-btn",title:(0,i.R1)(n)("删除该图鉴"),onClick:a=>(async e=>{try{if(!window.confirm(n("确认删除该图鉴？")))return;const a=(Array.isArray(t.worldInfo?.生物)?t.worldInfo.生物:[]).filter(n=>n&&n.id!==e),r={...t.worldInfo||{},生物:a};t.updateState("worldInfo",r),await t.saveGame()}catch(e){console.warn("[突变生物图鉴] 删除失败:",e)}})(e.id)},[(0,r.bF)((0,i.R1)(aoe),{size:18}),(0,r.Lk)("span",hoe,(0,o.v_)((0,i.R1)(n)("删除")),1)],8,foe)]),(0,r.Lk)("div",moe,[(0,r.Lk)("div",goe,[(0,r.Lk)("span",boe,(0,o.v_)((0,i.R1)(n)("栖息地"))+":",1),(0,r.Lk)("span",yoe,(0,o.v_)(e.habitat),1)]),e.size?((0,r.uX)(),(0,r.CE)("div",xoe,[(0,r.Lk)("span",koe,(0,o.v_)((0,i.R1)(n)("体型"))+":",1),(0,r.Lk)("span",woe,(0,o.v_)(e.size),1)])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",_oe,(0,o.v_)(e.appearance),1),e.attributes?((0,r.uX)(),(0,r.CE)("div",Coe,[(0,r.Lk)("div",Aoe,[s[0]||(s[0]=(0,r.Lk)("span",{class:"stat-label"},"HP",-1)),(0,r.Lk)("span",Soe,(0,o.v_)(e.attributes.hp?.max||"??"),1)]),(0,r.Lk)("div",Loe,[s[1]||(s[1]=(0,r.Lk)("span",{class:"stat-label"},"物攻",-1)),(0,r.Lk)("span",Eoe,(0,o.v_)(e.attributes.physAtk||"??"),1)]),(0,r.Lk)("div",Toe,[s[2]||(s[2]=(0,r.Lk)("span",{class:"stat-label"},"物防",-1)),(0,r.Lk)("span",Ioe,(0,o.v_)(e.attributes.physDef||"??"),1)]),(0,r.Lk)("div",Roe,[s[3]||(s[3]=(0,r.Lk)("span",{class:"stat-label"},"特攻",-1)),(0,r.Lk)("span",Moe,(0,o.v_)(e.attributes.specAtk||"0"),1)]),(0,r.Lk)("div",Poe,[s[4]||(s[4]=(0,r.Lk)("span",{class:"stat-label"},"特防",-1)),(0,r.Lk)("span",Doe,(0,o.v_)(e.attributes.specDef||"0"),1)]),(0,r.Q3)(" 六维属性 "),(0,r.Lk)("div",zoe,[s[5]||(s[5]=(0,r.Lk)("span",{class:"stat-label"},"力",-1)),(0,r.Lk)("span",Noe,(0,o.v_)(e.attributes.strength||"??"),1)]),(0,r.Lk)("div",$oe,[s[6]||(s[6]=(0,r.Lk)("span",{class:"stat-label"},"敏",-1)),(0,r.Lk)("span",Ooe,(0,o.v_)(e.attributes.agility||"??"),1)]),(0,r.Lk)("div",Foe,[s[7]||(s[7]=(0,r.Lk)("span",{class:"stat-label"},"体",-1)),(0,r.Lk)("span",joe,(0,o.v_)(e.attributes.constitution||"??"),1)]),(0,r.Lk)("div",Boe,[s[8]||(s[8]=(0,r.Lk)("span",{class:"stat-label"},"意",-1)),(0,r.Lk)("span",Xoe,(0,o.v_)(e.attributes.willpower||"??"),1)]),(0,r.Lk)("div",Uoe,[s[9]||(s[9]=(0,r.Lk)("span",{class:"stat-label"},"魅",-1)),(0,r.Lk)("span",Woe,(0,o.v_)(e.attributes.charm||"??"),1)]),(0,r.Lk)("div",qoe,[s[10]||(s[10]=(0,r.Lk)("span",{class:"stat-label"},"运",-1)),(0,r.Lk)("span",Goe,(0,o.v_)(e.attributes.luck||"??"),1)])])):(0,r.Q3)("v-if",!0),e.mutation?((0,r.uX)(),(0,r.CE)("div",Hoe,[(0,r.Lk)("div",Voe,[(0,r.bF)((0,i.R1)(Ku),{size:12}),(0,r.Lk)("span",null,(0,o.v_)(e.mutation.name),1)]),(0,r.Lk)("div",Qoe,(0,o.v_)(e.mutation.desc),1)])):(0,r.Q3)("v-if",!0),e.weaknesses&&e.weaknesses.length?((0,r.uX)(),(0,r.CE)("div",Koe,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.weaknesses,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"tag weakness"},(0,o.v_)(e),1))),128))])):(0,r.Q3)("v-if",!0)])],2))),128))]))]))}});var Joe=t(5349),Zoe={};Zoe.styleTagTransform=A(),Zoe.setAttributes=k(),Zoe.insert=y().bind(null,"head"),Zoe.domAPI=g(),Zoe.insertStyleElement=_(),h()(Joe.A,Zoe),Joe.A&&Joe.A.locals&&Joe.A.locals;const eie=(0,E.A)(Yoe,[["__scopeId","data-v-085cad4a"]]),nie={setup(){const e=(0,a.rd)(),n=()=>{e.push("/")},t=n=>{e.push("/game")};return()=>(0,r.h)(Mx,{fullscreen:!0,onClose:n,onCharacterSelected:t})}},tie=[{path:"/",name:"ModeSelection",component:we},{path:"/creation",name:"CharacterCreation",component:ql},{path:"/login",name:"Login",component:Sc},{path:"/workshop",name:"Workshop",component:Gu},{path:"/account",name:"AccountCenter",component:lw},{path:"/prompts",name:"PromptsStandalone",component:jte.A},{path:"/game",name:"Game",component:Wk,children:[{path:"",name:"GameMain",component:SA},{path:"memory",name:"Memory",component:HL},{path:"character-details",name:"CharacterDetails",component:uM},{path:"inventory",name:"Inventory",component:BD},{path:"relationships",name:"Relationships",component:ij},{path:"settings",name:"Settings",component:sj.A},{path:"save",name:"Save",component:JB},{path:"world-map",name:"WorldMap",component:FJ},{path:"events",name:"Events",component:HZ},{path:"mutants",name:"Mutants",component:eie},{path:"crafting",name:"Crafting",component:M1},{path:"sect",name:"Sect",component:c6,children:[{path:"",redirect:{name:"SectOverview"}},{path:"overview",name:"SectOverview",component:R5},{path:"members",name:"SectMembers",component:p3},{path:"management",name:"SectManagement",component:w4},{path:"tasks",name:"SectTasks",component:_8},{path:"contribution",name:"SectContribution",component:B3},{path:"war",name:"SectWar",component:L9}]},{path:"game-variables",name:"GameVariables",component:Fte},{path:"prompts",name:"Prompts",component:jte.A},{path:"travel",name:"Travel",component:Zre},{path:"api-management",name:"APIManagement",component:eoe.A}]},{path:"/management",name:"CharacterManagement",component:nie}],aie=(0,a.aE)({history:(0,a.sC)(),routes:tie})},9992:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});const a=(0,t(9596).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])}},n={};function t(a){var r=n[a];if(void 0!==r)return r.exports;var o=n[a]={id:a,loaded:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}t.m=e,t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),t.b=document.baseURI||self.location.href,t.nc=void 0,(()=>{"use strict";var e=t(3751),n=t(810),a=t(641),r=t(953),o=t(33),i=t(4965),s=t(4692),l=t.n(s),c=t(9037),d=t(1412),u=t(9992),p=t(7271),v=t(7754),f=t(9596);const h=(0,f.A)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),m=(0,f.A)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]),g=(0,f.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),b=(0,f.A)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);var y=t(2794),x=t(5726),k=t(6494),w=t(4091),_=t(4804),C=t(4270);const A={class:"toast-container"},S={key:0,class:"toast-icon"},L=["innerHTML"],E=(0,a.pM)({__name:"ToastContainer",setup:n=>(n,t)=>((0,a.uX)(),(0,a.CE)("div",A,[(0,a.bF)(e.F,{name:"toast-fade",tag:"div"},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,r.R1)(C.T),e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,o.C4)(["toast",`toast-${e.type}`])},["loading"===e.type?((0,a.uX)(),(0,a.CE)("div",S,t[0]||(t[0]=[(0,a.Lk)("div",{class:"spinner"},null,-1)]))):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",{class:"toast-message",innerHTML:e.message},null,8,L)],2))),128))]),_:1})]))});var T=t(5072),I=t.n(T),R=t(7825),M=t.n(R),P=t(7659),D=t.n(P),z=t(5056),N=t.n(z),$=t(540),O=t.n($),F=t(1113),j=t.n(F),B=t(1547),X={};X.styleTagTransform=j(),X.setAttributes=N(),X.insert=D().bind(null,"head"),X.domAPI=M(),X.insertStyleElement=O(),I()(B.A,X),B.A&&B.A.locals&&B.A.locals;var U=t(6262);const W=(0,U.A)(E,[["__scopeId","data-v-25ec8c07"]]);var q=t(9173);const G={key:0,class:"loading-overlay"},H={class:"loading-content"},V=["innerHTML"],Q=(0,a.pM)({__name:"GlobalLoadingOverlay",setup(n){const t=(0,q.useUIStore)();return(n,o)=>((0,a.uX)(),(0,a.Wv)(e.eB,{name:"fade"},{default:(0,a.k6)(()=>[(0,r.R1)(t).isLoading?((0,a.uX)(),(0,a.CE)("div",G,[(0,a.Lk)("div",H,[o[0]||(o[0]=(0,a.Lk)("div",{class:"spinner"},null,-1)),(0,a.Lk)("p",{class:"loading-text",innerHTML:(0,r.R1)(t).loadingText},null,8,V)])])):(0,a.Q3)("v-if",!0)]),_:1}))}});var K=t(6533),Y={};Y.styleTagTransform=j(),Y.setAttributes=N(),Y.insert=D().bind(null,"head"),Y.domAPI=M(),Y.insertStyleElement=O(),I()(K.A,Y),K.A&&K.A.locals&&K.A.locals;const J=(0,U.A)(Q,[["__scopeId","data-v-c8648b8a"]]);var Z=t(31);const ee={class:"dialog-header"},ne={class:"dialog-content"},te={class:"error-icon"},ae={class:"message"},re={class:"dialog-actions"},oe=(0,a.pM)({__name:"RetryConfirmDialog",setup(n){const t=(0,q.useUIStore)(),i=(0,a.EW)(()=>t.showRetryDialogState),s=(0,a.EW)(()=>t.retryDialogConfig),l=()=>{t.confirmRetry()},c=()=>{t.cancelRetry()};return(n,t)=>i.value?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"retry-dialog-overlay",onClick:c},[(0,a.Lk)("div",{class:"retry-dialog",onClick:t[0]||(t[0]=(0,e.D$)(()=>{},["stop"]))},[(0,a.Lk)("div",ee,[(0,a.Lk)("h3",null,(0,o.v_)(s.value?.title||n.$t("AI生成失败")),1)]),(0,a.Lk)("div",ne,[(0,a.Lk)("div",te,[(0,a.bF)((0,r.R1)(Z.A),{size:48})]),(0,a.Lk)("p",ae,(0,o.v_)(s.value?.message||n.$t("生成过程遇到问题")),1)]),(0,a.Lk)("div",re,[(0,a.Lk)("button",{class:"btn-secondary",onClick:c},(0,o.v_)(s.value?.cancelText||n.$t("取消")),1),(0,a.Lk)("button",{class:"btn-primary",onClick:l},(0,o.v_)(s.value?.confirmText||n.$t("重试")),1)])])])):(0,a.Q3)("v-if",!0)}});var ie=t(5218),se={};se.styleTagTransform=j(),se.setAttributes=N(),se.insert=D().bind(null,"head"),se.domAPI=M(),se.insertStyleElement=O(),I()(ie.A,se),ie.A&&ie.A.locals&&ie.A.locals;const le=(0,U.A)(oe,[["__scopeId","data-v-67dbe82b"]]);var ce=t(8684);const de={key:0,class:"dialog-overlay"},ue={class:"dialog-container"},pe={class:"dialog-header"},ve={class:"dialog-content"},fe={class:"error-list-container"},he={class:"error-list"},me={class:"content-suggestion"},ge={class:"dialog-actions"},be=(0,a.pM)({__name:"DataValidationErrorDialog",setup(e){const n=(0,q.useUIStore)(),t=()=>{n.confirmDataValidationError()},i=(0,a.EW)(()=>"loading"===n.dataValidationContext?{suggestion:"我们建议您立即修复此问题。修复过程将尝试在保留您核心进度的前提下，修正存档的数据结构。",warning:"注意：修复主要针对结构性问题，无法恢复已损坏或丢失的数据。建议您在修复前备份存档。",buttonText:"修复存档并继续"}:{suggestion:"我们建议您立即修复此问题。修复过程将根据您现有的角色基础信息，重新生成一份健康的初始存档数据。",warning:"注意：这将会重置您的游戏进度（如觉醒阶段、背包物品等），但角色核心设定（如姓名、天赋、异能）将保留。",buttonText:"重新初始化并修复"});return(e,s)=>(0,r.R1)(n).showDataValidationError?((0,a.uX)(),(0,a.CE)("div",de,[(0,a.Lk)("div",ue,[(0,a.Lk)("div",pe,[(0,a.bF)((0,r.R1)(Z.A),{size:28,class:"header-icon"}),s[0]||(s[0]=(0,a.Lk)("h2",{class:"header-title"},"存档数据异常",-1))]),(0,a.Lk)("div",ve,[s[2]||(s[2]=(0,a.Lk)("p",{class:"content-lead"},"系统检测到您的存档文件存在严重结构问题，可能导致游戏无法正常运行。这通常是由于版本更新或数据损坏导致的。",-1)),(0,a.Lk)("div",fe,[s[1]||(s[1]=(0,a.Lk)("strong",{class:"error-list-title"},"具体问题如下：",-1)),(0,a.Lk)("ul",he,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,r.R1)(n).dataValidationErrorMessages,(e,n)=>((0,a.uX)(),(0,a.CE)("li",{key:n,class:"error-item"},(0,o.v_)(e),1))),128))])]),(0,a.Lk)("p",me,[(0,a.eW)((0,o.v_)(i.value.suggestion)+" ",1),(0,a.Lk)("strong",null,(0,o.v_)(i.value.warning),1)])]),(0,a.Lk)("div",ge,[(0,a.Lk)("button",{class:"action-button confirm-button",onClick:t},[(0,a.bF)((0,r.R1)(ce.A),{size:16}),(0,a.eW)(" "+(0,o.v_)(i.value.buttonText),1)])])])])):(0,a.Q3)("v-if",!0)}});var ye=t(4093),xe={};xe.styleTagTransform=j(),xe.setAttributes=N(),xe.insert=D().bind(null,"head"),xe.domAPI=M(),xe.insertStyleElement=O(),I()(ye.A,xe),ye.A&&ye.A.locals&&ye.A.locals;const ke=(0,U.A)(be,[["__scopeId","data-v-b9efa476"]]);var we=t(2543);function _e(e){return(0,we.isObject)(e)?e.名称||e.name||"无名物品":"未知物品"}function Ce(e){return(0,we.isObject)(e)&&e.数量||1}function Ae(e){const{key:n,action:t,oldValue:a,newValue:r}=e;if(n.includes("角色.背包.物品")){if("set"===t&&r&&!a){const e=r;return{icon:"add",color:"green",title:"获得物品",description:`【${_e(e)}】x ${Ce(e)}`}}if("push"===t){const e=r;return{icon:"add",color:"green",title:"获得物品",description:`【${_e(e)}】x ${Ce(e)}`}}if("delete"===t||"pull"===t||"set"===t&&!r&&a){const e=a;return{icon:"remove",color:"red",title:"失去物品",description:`【${_e(e)}】x ${Ce(e)}`}}if("set"===t&&a&&r){const e=Ce(a),n=Ce(r);if(e!==n){const t=n-e;return{icon:t>0?"add":"remove",color:t>0?"green":"red",title:t>0?"获得物品":"消耗物品",description:`【${_e(r)}】${t>0?"+":""}${t}`}}}}if(n.startsWith("角色.背包.货币.")&&n.endsWith(".数量")){const e=n.split("."),t=e.length>=4?e[3]:"货币",o=("number"==typeof r?r:0)-("number"==typeof a?a:0);if(o>0)return{icon:"add",color:"green",title:`获得${t}`,description:`+ ${o}`};if(o<0)return{icon:"remove",color:"red",title:`消耗${t}`,description:`${o}`}}return null}function Se(e){const{key:n,action:t,oldValue:a,newValue:r}=e,o=n.startsWith("角色.属性.")||n.startsWith("角色.位置.")||n.includes(".角色.属性.")||n.includes(".角色.位置.")||n.includes(".生命值")||n.includes(".灵气")||n.includes(".神识")||n.includes(".寿命"),i=n.startsWith("社交.关系.")&&n.includes(".属性."),s=n.startsWith("社交.关系.")&&n.endsWith(".觉醒阶段");if(!o&&!i&&!s)return null;let l=null;if(i){const e=n.split(".");e.length>=3&&"社交"===e[0]&&"关系"===e[1]&&(l=e[2])}const c=n.split(".").pop()||"属性";if("角色.身份.觉醒阶段"===n||n.endsWith(".属性.觉醒阶段")||s)return{icon:"add",color:"green",title:l?`【${l}】觉醒阶段变更`:"觉醒阶段变更",description:`${a||"凡人"} → ${r||"未知"}`};if("角色.位置.描述"===n||n.endsWith(".位置.描述")){const e=e=>{if(!e)return"未知";if("string"==typeof e)return e;if("object"==typeof e&&null!==e){const n=e;if("string"==typeof n.描述)return n.描述;if("string"==typeof n.description)return n.description}return String(e)};return{icon:"update",color:"blue",title:l?`【${l}】位置变更`:"位置变更",description:`${e(a)} → ${e(r)}`}}const d=n.split("."),u=d[d.length-1],p=d[d.length-2]||c;if(("上限"===u||"最大"===u)&&"number"==typeof r){const e="number"==typeof a?r-a:r;let n="";return"number"==typeof a?(n=`${a} -> ${r}`,e>0&&(n+=` (+${e})`)):n=`设为 ${r}`,{icon:"update",color:"blue",title:l?`【${l}】${p}上限变化`:`${p}上限变化`,description:n}}if("当前"===u&&"number"==typeof r){const e="number"==typeof a?r-a:r;let n="";return"number"==typeof a?(n=`${a} -> ${r}`,e>0&&(n+=` (+${e})`),e<0&&(n+=` (${e})`)):n=`设为 ${r}`,{icon:"update",color:"blue",title:l?`【${l}】${p}当前值变化`:`${p}当前值变化`,description:n}}if((0,we.isObject)(r)&&"当前"in r&&(0,we.isObject)(a)&&"当前"in a){const e=r.当前-a.当前,n=r.最大!==a.最大;let t=`${a.当前} -> ${r.当前}`;return e>0&&(t+=` (+${e})`),e<0&&(t+=` (${e})`),n&&(t+=` (上限变为 ${r.最大})`),{icon:"update",color:"blue",title:l?`【${l}】${c}变化`:`${c}变化`,description:t}}if("number"==typeof r&&"number"==typeof a){const e=r-a;let n=`${a} -> ${r}`;return e>0&&(n+=` (+${e})`),e<0&&(n+=` (${e})`),{icon:"update",color:"blue",title:l?`【${l}】${c}变化`:`${c}变化`,description:n}}return null}function Le(e){const{key:n,action:t,oldValue:a,newValue:r}=e;if(n.startsWith("社交.关系.")||n.includes(".社交.关系.")){const e=n.split("."),o=e[2]||"某人",i=e[e.length-1];if("好感度"===i&&"number"==typeof a&&"number"==typeof r){const e=r-a;return{icon:e>0?"add":"remove",color:e>0?"green":"red",title:`【${o}】好感度变化`,description:`${a} → ${r} (${e>0?"+":""}${e})`}}if("人物记忆"===i&&"push"===t){let e="新增了关于你的记忆";if(r)if((0,we.isObject)(r)&&"__last"in r){const n=r.__last;"string"==typeof n&&(e=n.length>50?n.substring(0,50)+"...":n)}else"string"==typeof r&&(e=r.length>50?r.substring(0,50)+"...":r);return{icon:"add",color:"blue",title:`【${o}】记忆更新`,description:e}}if("关系状态"===i)return{icon:"update",color:"blue",title:`【${o}】关系变化`,description:`${a||"初识"} → ${r}`};const s=e.slice(2);if(s.length>0){const e=s.join(".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]");let n=`'${e}' 已更新`;return"object"==typeof r&&null!==r||"object"==typeof a&&null!==a||(n=`'${e}' 从 ${JSON.stringify(a)} 变为 ${JSON.stringify(r)}`),{icon:"update",color:"blue",title:`【${o}】信息更新`,description:n}}}return null}function Ee(e){const{key:n,action:t,newValue:a}=e;if("validation_error"===t&&("❌ 错误指令"===n||"❌ 格式错误（已拒绝）"===n)){const e=a,n=e?.errors||[];return{icon:"error",color:"red",title:"❌ AI指令格式错误",description:"以下指令验证失败，未被执行",details:[`指令内容:\n${e?.command||"未知指令"}`,"\n错误原因:",...n.map(e=>`  • ${e}`)]}}return null}function Te(e){const{key:n,action:t,oldValue:a,newValue:r}=e;if("execution_error"===t&&("? 执行失败"===n||n.includes("执行失败"))){const e=(0,we.isObject)(r)?r:{};return{icon:"error",color:"red",title:"? AI指令执行失败",description:"指令在执行阶段报错，已跳过（存档未被该指令修改）。",details:[`指令内容:\n${"string"==typeof e?.command?e.command:"未知指令"}`,`\n错误原因:\n${"string"==typeof e?.error?e.error:"未知错误"}`]}}if((n.includes("社交.事件")||n.includes("系统.事件"))&&"push"===t){let e="新增事件";if(r)if((0,we.isObject)(r)&&"__last"in r){const n=r.__last;if((0,we.isObject)(n)){const t=n;e=t.描述||t.description||t.事件||"新增事件"}}else if((0,we.isObject)(r)){const n=r;e=n.描述||n.description||n.事件||"新增事件"}return{icon:"add",color:"blue",title:"事件记录",description:e.length>60?e.substring(0,60)+"...":e}}if((n.includes("短期记忆")||n.includes("中期记忆")||n.includes("隐式中期记忆"))&&"push"===t){let e="新增记忆";if(r)if((0,we.isObject)(r)&&"__last"in r){const n=r.__last;"string"==typeof n&&(e=n)}else"string"==typeof r&&(e=r);return{icon:"add",color:"blue",title:(n.includes("短期记忆")?"短期记忆":n.includes("隐式中期记忆")?"隐式中期记忆":"中期记忆")+"更新",description:e.length>60?e.substring(0,60)+"...":e}}let o="";return o="set"===t||"update"===t?`值从 ${JSON.stringify(a)} 变为 ${JSON.stringify(r)}`:"add"===t?`数值增加了 ${r}`:"delete"===t?"移除了该字段":`执行了 ${t} 操作`,{icon:"info",color:"gray",title:`数据变更: ${n}`,description:o}}var Ie=t(8381);const Re=(0,f.A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Me=(0,f.A)("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);var Pe=t(6680);const De=(0,f.A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var ze=t(5976);const Ne={class:"state-change-viewer"},$e={class:"viewer-header"},Oe={class:"viewer-summary"},Fe={class:"summary-item added"},je={class:"summary-item removed"},Be={class:"summary-item updated"},Xe={key:0,class:"summary-item errors"},Ue={class:"viewer-content"},We={key:0,class:"no-changes"},qe={key:1,class:"changes-list"},Ge={class:"item-icon"},He={class:"item-content"},Ve={class:"item-title"},Qe={class:"item-description"},Ke={key:0,class:"item-details"},Ye=(0,a.pM)({__name:"StateChangeViewer",props:{log:{}},emits:["close"],setup(n){const t=n,i=(0,a.EW)(()=>function(e){const n={summary:{added:0,removed:0,updated:0,errors:0},changes:[]};if(!e||!(0,we.isArray)(e.changes))return n;for(const t of e.changes){let e=null;e=Ee(t),e||(e=Ae(t)),e||(e=Se(t)),e||(e=Le(t)),e||(e=Te(t)),n.changes.push(e),"add"===e.icon?n.summary.added++:"remove"===e.icon?n.summary.removed++:"update"===e.icon?n.summary.updated++:"error"===e.icon&&n.summary.errors++}return n}(t.log));return(n,t)=>((0,a.uX)(),(0,a.CE)("div",{class:"state-change-overlay",onClick:t[1]||(t[1]=(0,e.D$)(e=>n.$emit("close"),["self"]))},[(0,a.Lk)("div",Ne,[(0,a.Lk)("div",$e,[(0,a.Lk)("h3",null,[(0,a.bF)((0,r.R1)(Ie.A),{size:18}),(0,a.eW)(" "+(0,o.v_)(n.$t("变更日志")),1)]),(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>n.$emit("close")),class:"close-btn"},[(0,a.bF)((0,r.R1)(k.A),{size:20})])]),(0,a.Lk)("div",Oe,[(0,a.Lk)("div",Fe,[(0,a.bF)((0,r.R1)(Re),{size:16}),(0,a.Lk)("span",null,(0,o.v_)(n.$t("新增"))+" "+(0,o.v_)(i.value.summary.added),1)]),(0,a.Lk)("div",je,[(0,a.bF)((0,r.R1)(Me),{size:16}),(0,a.Lk)("span",null,(0,o.v_)(n.$t("移除"))+" "+(0,o.v_)(i.value.summary.removed),1)]),(0,a.Lk)("div",Be,[(0,a.bF)((0,r.R1)(ce.A),{size:16}),(0,a.Lk)("span",null,(0,o.v_)(n.$t("更新"))+" "+(0,o.v_)(i.value.summary.updated),1)]),i.value.summary.errors>0?((0,a.uX)(),(0,a.CE)("div",Xe,[(0,a.bF)((0,r.R1)(k.A),{size:16}),(0,a.Lk)("span",null,(0,o.v_)(n.$t("错误"))+" "+(0,o.v_)(i.value.summary.errors),1)])):(0,a.Q3)("v-if",!0)]),(0,a.Lk)("div",Ue,[0===i.value.changes.length?((0,a.uX)(),(0,a.CE)("div",We,[(0,a.Lk)("p",null,(0,o.v_)(n.$t("本次操作没有产生可见的状态变更。")),1)])):((0,a.uX)(),(0,a.CE)("div",qe,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.value.changes,(e,n)=>((0,a.uX)(),(0,a.CE)("div",{key:n,class:(0,o.C4)(["change-item",`item-${e.color}`])},[(0,a.Lk)("div",Ge,["add"===e.icon?((0,a.uX)(),(0,a.Wv)((0,r.R1)(Pe.A),{key:0,size:18})):"remove"===e.icon?((0,a.uX)(),(0,a.Wv)((0,r.R1)(De),{key:1,size:18})):"update"===e.icon?((0,a.uX)(),(0,a.Wv)((0,r.R1)(ce.A),{key:2,size:18})):"error"===e.icon?((0,a.uX)(),(0,a.Wv)((0,r.R1)(k.A),{key:3,size:18})):((0,a.uX)(),(0,a.Wv)((0,r.R1)(ze.A),{key:4,size:18}))]),(0,a.Lk)("div",He,[(0,a.Lk)("p",Ve,(0,o.v_)(e.title),1),(0,a.Lk)("p",Qe,(0,o.v_)(e.description),1),e.details&&e.details.length>0?((0,a.uX)(),(0,a.CE)("div",Ke,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.details,(e,n)=>((0,a.uX)(),(0,a.CE)("p",{key:n},(0,o.v_)(e),1))),128))])):(0,a.Q3)("v-if",!0)])],2))),128))]))])])]))}});var Je=t(3353),Ze={};Ze.styleTagTransform=j(),Ze.setAttributes=N(),Ze.insert=D().bind(null,"head"),Ze.domAPI=M(),Ze.insertStyleElement=O(),I()(Je.A,Ze),Je.A&&Je.A.locals&&Je.A.locals;const en=(0,U.A)(Ye,[["__scopeId","data-v-a2a95590"]]);var nn=t(8275),tn=t(2815);const an=["title","aria-label","aria-expanded"],rn=(0,a.pM)({__name:"ActionMenu",props:{position:{default:"bottom-right"},offsetPx:{default:24},openTitle:{default:"菜单"},closeTitle:{default:"关闭"}},setup(n){const t=n,i=(0,r.KR)(!1),s=()=>{i.value=!1},l=()=>{i.value=!i.value},c=(0,a.EW)(()=>"top-right"===t.position?"pos-top-right":"pos-bottom-right"),d=(0,a.EW)(()=>{const e=`${t.offsetPx}px`;return"top-right"===t.position?{top:e,right:e}:{bottom:e,right:e}});return(n,t)=>((0,a.uX)(),(0,a.CE)("div",{class:(0,o.C4)(["action-menu",c.value]),style:(0,o.Tr)(d.value)},[(0,a.bF)(e.eB,{name:"menu-fade"},{default:(0,a.k6)(()=>[i.value?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"overlay",onClick:s})):(0,a.Q3)("v-if",!0)]),_:1}),(0,a.bF)(e.eB,{name:"menu-pop"},{default:(0,a.k6)(()=>[i.value?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"menu",onClick:t[0]||(t[0]=(0,e.D$)(()=>{},["stop"]))},[(0,a.RG)(n.$slots,"menu",{close:s})])):(0,a.Q3)("v-if",!0)]),_:3}),(0,a.Lk)("button",{class:"fab",title:i.value?n.closeTitle:n.openTitle,"aria-label":i.value?n.closeTitle:n.openTitle,"aria-expanded":i.value,onClick:l},[((0,a.uX)(),(0,a.Wv)((0,a.$y)(i.value?(0,r.R1)(k.A):(0,r.R1)(tn.A)),{size:22}))],8,an)],6))}});var on=t(4227),sn={};sn.styleTagTransform=j(),sn.setAttributes=N(),sn.insert=D().bind(null,"head"),sn.domAPI=M(),sn.insertStyleElement=O(),I()(on.A,sn),on.A&&on.A.locals&&on.A.locals;const ln=(0,U.A)(rn,[["__scopeId","data-v-4273a3ac"]]);var cn=t(5327),dn=t(1363),un=t(9313),pn=(t(4511),t(1211)),vn=t(8220),fn=t(1184),hn=t(8651),mn=t(8546),gn=t(1875),bn=t(3825),yn=t(1040);const xn={id:"app-container"},kn=["onClick"],wn=["onClick"],_n=["onClick"],Cn=["onClick"],An=["onClick"],Sn=["onClick"],Ln=["onClick"],En=["onClick"],Tn=["onClick"],In={class:"settings-modal-content"},Rn={class:"settings-modal-header"},Mn={class:"settings-modal-body"},Pn={class:"settings-modal-content"},Dn={class:"settings-modal-header"},zn={class:"settings-modal-body"},Nn={class:"settings-modal-content prompt-modal-content"},$n={class:"settings-modal-header"},On={class:"settings-modal-body"},Fn={class:"settings-modal-content sponsor-modal-content"},jn={class:"settings-modal-header"},Bn={class:"help-modal"},Xn={class:"help-header"},Un={class:"help-body"},Wn={class:"help-version"},qn={href:"https://ddct.top/",target:"_blank",class:"help-link-card"},Gn=(0,a.pM)({__name:"App",setup(n){const t=(0,r.KR)(null),s=(0,r.KR)(!1),f=(0,r.KR)("light"===(A=localStorage.getItem("theme"))||"dark"===A?A:"dark");var A;const S=(0,r.KR)("true"===localStorage.getItem("fullscreen")),L=(0,r.KR)(!1),E=(0,r.KR)(!1),T=(0,r.KR)(!1),I=(0,r.KR)(!1),R=(0,r.KR)(!1),M=(0,r.KR)((0,mn.isBackendConfigured)()),P=(0,a.EW)(()=>M.value?t.value??"同步中":""),D=(0,i.rd)(),z=(0,i.lq)(),N=(0,a.EW)(()=>z.path.startsWith("/game"));(0,a.wB)(N,e=>{e&&(E.value=!1)});const $=e=>{const n={ModeSelection:"/",CharacterCreation:"/creation",Login:"/login",CharacterManagement:"/management",GameView:"/game"}[e];n?D.push(n):(console.warn(`未知的视图名称: ${e}，将导航至首页。`),D.push("/"))},O=(0,pn.N)(),F=(0,vn.useCharacterStore)(),j=(0,q.useUIStore)(),B=(0,fn.useGameStateStore)(),X=(0,r.KR)(null),U=(0,a.EW)(()=>N.value&&"联机"===F.activeCharacterProfile?.模式),G=()=>{X.value&&(clearInterval(X.value),X.value=null)};(0,a.wB)([U,M],()=>{U.value&&M.value?(G(),M.value&&U.value&&((0,gn.js)(),X.value=window.setInterval(()=>{(0,gn.js)()},15e3))):G()});const H=async e=>{try{if("cloud"===e&&!M.value)return C.o.info("未配置后端服务器，联机共修不可用"),void $("ModeSelection");const n="cloud"===e?"cloud":"single";O.setMode(n),$("CharacterCreation")}catch(e){console.error("Failed to initialize creation data:",e),C.o.error("初始化创角数据失败，请稍后重试。"),$("ModeSelection")}},V=()=>{D.push("/management")},Q=()=>{O.resetCharacter(),$("ModeSelection")},K=()=>{s.value=!0,$("ModeSelection")},Y=()=>{M.value?$("Login"):C.o.info("未配置后端服务器，登录不可用")},Z=async e=>{if(console.log("接收到创角指令...",e),console.log("[App.vue] 种族字段检查:",e.race),j.isLoading)return void console.warn("[App.vue] 角色创建已在进行中，忽略重复请求");F.initialized||(console.log("[App.vue] characterStore 未初始化，等待初始化完成..."),await F.initializeStore()),j.startLoading("开始铸造法身...");const n=`char_${Date.now()}`,t=async()=>{try{F.rootState.角色列表[n]&&(console.log("[角色创建] 检测到残留数据，清理中..."),delete F.rootState.角色列表[n],await F.commitMetadataToStorage());let t="无名道友";try{const n=(0,hn.getTavernHelper)();if(n){const a=await n.getVariables({type:"global"}),r=a["persona.name"]||a.name||e.characterName;t=("string"==typeof r?r:e.characterName)||"无名道友",console.log("[创角完成] 从酒馆Personas获取名字:",t)}}catch(n){console.warn("[创角完成] 无法从酒馆获取Persona名字，使用用户输入:",n),t=e.characterName||"无名道友"}const a=e.baseAttributes?{力量:e.baseAttributes.strength??0,敏捷:e.baseAttributes.agility??0,体质:e.baseAttributes.constitution??0,意志:e.baseAttributes.willpower??0,魅力:e.baseAttributes.charm??0,幸运:e.baseAttributes.luck??0}:{力量:0,敏捷:0,体质:0,意志:0,魅力:0,幸运:0},r={名字:t,性别:"女"===e.gender||"其他"===e.gender?e.gender:"男",出生日期:{年:0,月:1,日:1},种族:e.race??"人族",世界:e.world||{name:"未知世界"},天资:e.talentTier||{name:"凡品"},出生:e.origin||"随机出身",天赋:e.talents?.map(e=>({id:e.id,name:e.name,description:e.description||"",talent_cost:e.talent_cost,rarity:e.rarity}))||[],先天属性:a,后天属性:{力量:0,敏捷:0,体质:0,意志:0,魅力:0,幸运:0}},o={charId:n,baseInfo:r,world:e.world,mode:e.mode,age:e.age},i=await F.createNewCharacter(o);if(!i)throw new Error("角色创建失败，请检查 characterStore 的日志。");const s=F.rootState.角色列表[n];if(!s)throw new Error("严重错误：角色创建后无法在角色列表中找到！");const l="单机"===s.模式?"存档1":"云端修行";return F.rootState.当前激活存档={角色ID:n,存档槽位:l},await F.commitMetadataToStorage(),await new Promise(e=>setTimeout(e,500)),C.o.success(`【${i.名字}】已成功踏入修行之路！`),await D.push("/game"),await new Promise(e=>setTimeout(e,100)),ee(),!0}catch(e){console.error("角色创建过程出错：",e);const a=e instanceof Error?e.message:"法身铸造过程中出现意外";return F.rootState.角色列表[n]&&(console.log("[角色创建] 创建失败，清理残留数据..."),delete F.rootState.角色列表[n],await F.commitMetadataToStorage()),a.includes("用户选择终止角色创建")||a.includes("用户选择不继续重试")?(console.log("[角色创建] 用户主动取消创建流程"),C.o.info("角色创建已取消"),!1):new Promise(e=>{j.showRetryDialog({title:"角色创建失败",message:`角色创建过程中遇到问题：\n\n${a}\n\n是否重新尝试创建角色？`,confirmText:"重新创建",cancelText:"返回主页重新开始",onConfirm:async()=>{console.log("[角色创建] 用户选择重新创建"),e(await t())},onCancel:()=>{console.log("[角色创建] 用户选择返回主页重新开始"),C.o.info("已返回主页，可重新开始生成"),O.resetCharacter(),D.push("/"),e(!1)}})})}};try{console.log("[App.vue] 开始执行attemptCreation...");const e=await t();console.log("[App.vue] attemptCreation执行完成,结果:",e),e||console.log("[角色创建] 保持在角色创建页面")}catch(e){console.error("[App.vue] 角色创建流程出现严重错误：",e);const n=e instanceof Error?e.message:String(e);C.o.error(`角色创建失败: ${n}`),n.includes("超时")&&C.o.error("创建过程超时,请检查网络连接和SillyTavern状态")}finally{console.log("[App.vue] finally: 停止loading并重置创建状态"),j.stopLoading(),O.resetCreationState()}};(0,a.nT)(()=>{document.documentElement.setAttribute("data-theme",f.value),localStorage.setItem("theme",f.value)});const ee=()=>{S.value&&!(0,yn.Kn)()&&(console.log("[全屏] 检测到需要恢复全屏状态"),console.warn("[全屏] 浏览器限制：无法自动恢复全屏，请手动点击全屏按钮。"),S.value=!1,localStorage.setItem("fullscreen","false"))},ne=()=>{L.value=!0};return(0,a.sV)(async()=>{if(M.value){const e=await(0,mn.d9)();e&&(t.value=e)}console.log("[App] 等待 characterStore 初始化..."),await F.initializeStore(),console.log("[App] ✅ characterStore 初始化完成");let e=null;const n=()=>{try{if(window.parent===window)return;document.documentElement.classList.add("is-iframe");let n=window;for(let t=0;t<5;t++)try{if(!n.parent||n.parent===n)break;{const a=l()("#chat",n.parent.document);if(a.length>0){const r=a.height();if(r){const a=.9*r+"px";return document.documentElement.style.minHeight=a,console.log(`[App.vue] 在第${t+1}层父窗口找到#chat，应用min-height: ${a}`),void(e=n.parent)}}n=n.parent}}catch{break}console.warn("[App.vue] 在所有可访问的父窗口中未找到 #chat 元素，无法自动调整高度。")}catch(e){console.error("[App.vue] 访问父窗口DOM失败，可能是跨域限制。",e)}};n();try{e?l()(e).on("resize",n):window.parent!==window&&l()(parent.window).on("resize",n)}catch{}const r=()=>{const e=!!(0,yn.Kn)();S.value=e,localStorage.setItem("fullscreen",e.toString())};document.addEventListener("fullscreenchange",r),document.addEventListener("webkitfullscreenchange",r),document.addEventListener("mozfullscreenchange",r),document.addEventListener("MSFullscreenChange",r),r(),setTimeout(()=>{ee()},500);const o=setInterval(async()=>{try{if(!B.isGameLoaded)return;if(!F.activeSaveSlot)return;console.log("[定时保存] 保存当前存档..."),await F.saveCurrentGame(),console.log("[定时保存] 保存成功")}catch(e){console.error("[定时保存] 保存失败:",e)}},3e5),i=()=>{const e=B.onlineState,n=e?.房间ID;n&&"联机"===F.activeCharacterProfile?.模式&&((0,bn.ep)(Number(n)),console.log("[App] beforeunload: 尝试结束穿越会话",n))};window.addEventListener("beforeunload",i),(0,a.hi)(()=>{G(),clearInterval(o),window.removeEventListener("beforeunload",i);try{e?l()(e).off("resize",n):window.parent!==window&&l()(parent.window).off("resize",n)}catch{}document.removeEventListener("fullscreenchange",r),document.removeEventListener("webkitfullscreenchange",r),document.removeEventListener("mozfullscreenchange",r),document.removeEventListener("MSFullscreenChange",r)})}),(0,a.wB)(z,(e,n)=>{e.path!==n?.path&&(console.log(`[全屏] 路由从 ${n?.path} 切换到 ${e.path}`),setTimeout(()=>{ee()},200))},{immediate:!1}),(n,t)=>{const i=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.CE)("div",xn,[(0,a.bF)(W),(0,a.bF)(J),(0,a.bF)(le),(0,a.bF)(ke),(0,r.R1)(j).showStateChangeViewer?((0,a.uX)(),(0,a.Wv)(en,{key:0,log:(0,r.R1)(j).stateChangeLogToShow,onClose:(0,r.R1)(j).closeStateChangeViewer},null,8,["log","onClose"])):(0,a.Q3)("v-if",!0),(0,a.bF)(nn.A),(0,a.Q3)(" 全局操作按钮 - 只在非游戏界面显示 "),(0,a.Q3)('\n    <div v-if="!isInGameView" class="global-actions">\n      <label class="theme-toggle" @click.prevent="toggleTheme">\n        <input type="checkbox" ref="globalThemeCheckbox" :checked="!isDarkMode" />\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="moon">\n          <path\n            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"\n          ></path>\n        </svg>\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="sun">\n          <path\n            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"\n          ></path>\n        </svg>\n      </label>\n      <label class="fullscreen-toggle" @click.prevent="toggleFullscreen">\n        <input type="checkbox" ref="globalFullscreenCheckbox" />\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="expand">\n          <path\n            d="M32 32C14.3 32 0 46.3 0 64v96c0 17.7 14.3 32 32 32s32-14.3 32-32V96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H64V352zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h64v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H320zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V352z"\n          ></path>\n        </svg>\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="compress">\n          <path\n            d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V64zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32H96v64c0 17.7 14.3 32 32 32s32-14.3 32-32V352c0-17.7-14.3-32-32-32H32zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V64zM320 320c-17.7 0-32 14.3-32 32v96c0 17.7 14.3 32 32 32s32-14.3 32-32V384h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H320z"\n          ></path>\n        </svg>\n      </label>\n      <a\n        href="https://ddct.top"\n        target="_blank"\n        rel="noopener noreferrer"\n        class="theme-toggle"\n        title="教程"\n      >\n        <HelpCircle :size="24" />\n      </a>\n    </div>\n    '),(0,a.Q3)(" 全局操作按钮（合并菜单） - 只在非游戏界面显示 "),N.value?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.Wv)(ln,{key:1,position:"top-right",openTitle:"功能",closeTitle:"关闭"},{menu:(0,a.k6)(({close:e})=>[(0,a.Lk)("button",{class:"action-menu-item",onClick:n=>{E.value=!0,e()}},[(0,a.bF)((0,r.R1)(c.A),{size:18}),t[10]||(t[10]=(0,a.Lk)("span",null,"全局设置",-1))],8,kn),(0,a.Lk)("button",{class:"action-menu-item",onClick:n=>{T.value=!0,e()}},[(0,a.bF)((0,r.R1)(d.A),{size:18}),t[11]||(t[11]=(0,a.Lk)("span",null,"API管理",-1))],8,wn),(0,a.Lk)("button",{class:"action-menu-item",onClick:n=>{R.value=!0,e()}},[(0,a.bF)((0,r.R1)(u.A),{size:18}),t[12]||(t[12]=(0,a.Lk)("span",null,"提示词管理",-1))],8,_n),(0,a.Lk)("button",{class:(0,o.C4)(["action-menu-item",{"is-disabled":!M.value}]),onClick:n=>(e=>{M.value?(D.push("/workshop"),e()):C.o.info("未配置后端服务器，创意工坊不可用")})(e)},[(0,a.bF)((0,r.R1)(p.A),{size:18}),t[13]||(t[13]=(0,a.Lk)("span",null,"创意工坊",-1))],10,Cn),(0,a.Lk)("button",{class:(0,o.C4)(["action-menu-item",{"is-disabled":!M.value}]),onClick:n=>(e=>{M.value?(D.push("/account"),e()):C.o.info("未配置后端服务器，账号中心不可用")})(e)},[(0,a.bF)((0,r.R1)(v.A),{size:18}),t[14]||(t[14]=(0,a.Lk)("span",null,"账号中心",-1))],10,An),(0,a.Lk)("button",{class:"action-menu-item",onClick:n=>{f.value="dark"===f.value?"light":"dark",e()}},[((0,a.uX)(),(0,a.Wv)((0,a.$y)("dark"===f.value?(0,r.R1)(h):(0,r.R1)(m)),{size:18})),(0,a.Lk)("span",null,(0,o.v_)("dark"===f.value?"切换亮色":"切换暗色"),1)],8,Sn),(0,a.Lk)("button",{class:"action-menu-item",onClick:n=>{(0,yn.Kn)()?(0,yn.Eh)().then(()=>{S.value=!1,localStorage.setItem("fullscreen","false"),console.log("[全屏] 已退出全屏模式并保存状态")}).catch(e=>{console.error("无法退出全屏模式:",e),C.o.error((0,yn.zp)(e))}):(0,yn.lh)(document.documentElement).then(()=>{S.value=!0,localStorage.setItem("fullscreen","true"),console.log("[全屏] 已进入全屏模式并保存状态")}).catch(e=>{console.error("无法进入全屏模式:",e),C.o.error((0,yn.zp)(e))}),e()}},[((0,a.uX)(),(0,a.Wv)((0,a.$y)(S.value?(0,r.R1)(g):(0,r.R1)(b)),{size:18})),(0,a.Lk)("span",null,(0,o.v_)(S.value?"退出全屏":"进入全屏"),1)],8,Ln),(0,a.Lk)("button",{class:"action-menu-item",onClick:n=>{ne(),e()}},[(0,a.bF)((0,r.R1)(y.A),{size:18}),t[15]||(t[15]=(0,a.Lk)("span",null,"教程说明",-1))],8,En),(0,a.Lk)("button",{class:"action-menu-item sponsor-item",onClick:n=>{I.value=!0,e()}},[(0,a.bF)((0,r.R1)(x.A),{size:18}),t[16]||(t[16]=(0,a.Lk)("span",null,"赞助支持",-1))],8,Tn)]),_:1})),(0,a.Q3)(" 路由视图将在这里渲染所有页面 "),(0,a.bF)(i,null,{default:(0,a.k6)(({Component:e})=>[((0,a.uX)(),(0,a.Wv)((0,a.$y)(e),{onStartCreation:H,onShowCharacterList:V,onGoToLogin:Y,onBack:Q,onCreationComplete:Z,onLoggedIn:K,onLogin:Y,onShowHelp:ne},null,32))]),_:1}),(0,a.Q3)(" Settings Modal "),E.value?((0,a.uX)(),(0,a.CE)("div",{key:2,class:"settings-modal-overlay",onClick:t[1]||(t[1]=(0,e.D$)(e=>E.value=!1,["self"]))},[(0,a.Lk)("div",In,[(0,a.Lk)("div",Rn,[t[17]||(t[17]=(0,a.Lk)("h3",null,"设置",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=e=>E.value=!1)},"×")]),(0,a.Lk)("div",Mn,[(0,a.bF)(cn.A)])])])):(0,a.Q3)("v-if",!0),(0,a.Q3)(" API管理弹窗 "),T.value?((0,a.uX)(),(0,a.CE)("div",{key:3,class:"settings-modal-overlay",onClick:t[3]||(t[3]=(0,e.D$)(e=>T.value=!1,["self"]))},[(0,a.Lk)("div",Pn,[(0,a.Lk)("div",Dn,[t[18]||(t[18]=(0,a.Lk)("h3",null,"API管理",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[2]||(t[2]=e=>T.value=!1)},"×")]),(0,a.Lk)("div",zn,[(0,a.bF)(dn.A)])])])):(0,a.Q3)("v-if",!0),(0,a.Q3)(" 提示词管理弹窗 "),R.value?((0,a.uX)(),(0,a.CE)("div",{key:4,class:"settings-modal-overlay",onClick:t[5]||(t[5]=(0,e.D$)(e=>R.value=!1,["self"]))},[(0,a.Lk)("div",Nn,[(0,a.Lk)("div",$n,[t[19]||(t[19]=(0,a.Lk)("h3",null,"提示词管理",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[4]||(t[4]=e=>R.value=!1)},"×")]),(0,a.Lk)("div",On,[(0,a.bF)(un.A)])])])):(0,a.Q3)("v-if",!0),(0,a.Q3)(" 赞助支持弹窗 "),I.value?((0,a.uX)(),(0,a.CE)("div",{key:5,class:"settings-modal-overlay",onClick:t[7]||(t[7]=(0,e.D$)(e=>I.value=!1,["self"]))},[(0,a.Lk)("div",Fn,[(0,a.Lk)("div",jn,[t[20]||(t[20]=(0,a.Lk)("h3",null,"赞助支持（自愿）",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[6]||(t[6]=e=>I.value=!1)},"×")]),t[21]||(t[21]=(0,a.Fv)('<div class="settings-modal-body sponsor-modal-body" data-v-12d7ca97><div class="sponsor-qr" data-v-12d7ca97><img src="https://ddct.top/zhifubao.jpg" alt="支付宝赞助二维码" loading="lazy" data-v-12d7ca97><span data-v-12d7ca97>支付宝</span></div><div class="sponsor-qr" data-v-12d7ca97><img src="https://ddct.top/weixing.jpg" alt="微信赞助二维码" loading="lazy" data-v-12d7ca97><span data-v-12d7ca97>微信</span></div></div>',1))])])):(0,a.Q3)("v-if",!0),(0,a.Q3)(" 教程弹窗 "),L.value?((0,a.uX)(),(0,a.CE)("div",{key:6,class:"help-overlay",onClick:t[9]||(t[9]=(0,e.D$)(e=>L.value=!1,["self"]))},[(0,a.Lk)("div",Bn,[(0,a.Lk)("div",Xn,[t[22]||(t[22]=(0,a.Lk)("h2",{class:"help-title"},"仙途教程",-1)),(0,a.Lk)("button",{class:"help-close",onClick:t[8]||(t[8]=e=>L.value=!1)},[(0,a.bF)((0,r.R1)(k.A),{size:18})])]),(0,a.Lk)("div",Un,[(0,a.Lk)("div",Wn,"v"+(0,o.v_)(P.value),1),t[24]||(t[24]=(0,a.Lk)("p",{class:"help-desc"},"AI驱动的沉浸式修仙文字冒险游戏",-1)),(0,a.Lk)("a",qn,[(0,a.bF)((0,r.R1)(w.A),{size:18}),t[23]||(t[23]=(0,a.Lk)("span",null,"查看官网介绍",-1)),(0,a.bF)((0,r.R1)(_.A),{size:16})]),t[25]||(t[25]=(0,a.Fv)('<div class="help-warning" data-v-12d7ca97><span data-v-12d7ca97>⚠️ 游玩尽量使用推荐预设，了解原理后可自行调整</span></div><div class="help-section" data-v-12d7ca97><h3 data-v-12d7ca97>核心功能</h3><div class="help-features" data-v-12d7ca97><span data-v-12d7ca97>🎲 智能判定</span><span data-v-12d7ca97>🌟 三千大道</span><span data-v-12d7ca97>📖 动态剧情</span><span data-v-12d7ca97>💾 多存档</span><span data-v-12d7ca97>⚔️ 深度RPG</span><span data-v-12d7ca97>🗺️ 世界探索</span></div></div><div class="help-footer" data-v-12d7ca97><div class="help-author" data-v-12d7ca97><span data-v-12d7ca97>作者：千夜</span><a href="https://github.com/qianye60/XianTu" target="_blank" data-v-12d7ca97>GitHub</a></div><div class="help-license" data-v-12d7ca97>CC BY-NC-SA 4.0</div></div>',3))])])])):(0,a.Q3)("v-if",!0)])}}});var Hn=t(3024),Vn={};Vn.styleTagTransform=j(),Vn.setAttributes=N(),Vn.insert=D().bind(null,"head"),Vn.domAPI=M(),Vn.insertStyleElement=O(),I()(Hn.A,Vn),Hn.A&&Hn.A.locals&&Hn.A.locals;const Qn=(0,U.A)(Gn,[["__scopeId","data-v-12d7ca97"]]);var Kn=t(9969),Yn=t(1606),Jn={};Jn.styleTagTransform=j(),Jn.setAttributes=N(),Jn.insert=D().bind(null,"head"),Jn.domAPI=M(),Jn.insertStyleElement=O(),I()(Yn.A,Jn),Yn.A&&Yn.A.locals&&Yn.A.locals;var Zn=t(6627),et={};et.styleTagTransform=j(),et.setAttributes=N(),et.insert=D().bind(null,"head"),et.domAPI=M(),et.insertStyleElement=O(),I()(Zn.A,et),Zn.A&&Zn.A.locals&&Zn.A.locals;var nt=t(8396),tt={};tt.styleTagTransform=j(),tt.setAttributes=N(),tt.insert=D().bind(null,"head"),tt.domAPI=M(),tt.insertStyleElement=O(),I()(nt.A,tt),nt.A&&nt.A.locals&&nt.A.locals;var at=t(3302);const rt={log:console.log.bind(console),warn:console.warn.bind(console),info:console.info.bind(console),debug:console.debug?console.debug.bind(console):void 0,table:console.table?console.table.bind(console):void 0,group:console.group?console.group.bind(console):void 0,groupCollapsed:console.groupCollapsed?console.groupCollapsed.bind(console):void 0,groupEnd:console.groupEnd?console.groupEnd.bind(console):void 0,error:console.error.bind(console)},ot=()=>at.w9.isConsoleDebugEnabled();console.log=(...e)=>{ot()&&rt.log(...e)},console.warn=(...e)=>{ot()&&rt.warn(...e)},console.info=(...e)=>{at.w9.isDebugMode()&&rt.info(...e)},rt.debug&&(console.debug=(...e)=>{ot()&&rt.debug(...e)}),rt.table&&(console.table=(...e)=>{ot()&&rt.table(...e)}),rt.group&&(console.group=(...e)=>{ot()&&rt.group(...e)}),rt.groupCollapsed&&(console.groupCollapsed=(...e)=>{ot()&&rt.groupCollapsed(...e)}),rt.groupEnd&&(console.groupEnd=(...e)=>{ot()&&rt.groupEnd(...e)});var it=t(5099),st=t(876);!async function(){console.log("【应用启动】开始初始化流程..."),await(0,it.YK)(),console.log("【应用启动】数据迁移检查完成，开始挂载Vue应用");const t=(0,e.Ef)(Qn),{t:a}=(0,st.s)();t.config.globalProperties.$t=a,t.mixin({methods:{t:e=>a(e)}}),t.use((0,n.Ey)()),t.use(Kn.default),t.mount("#app"),console.log("【应用启动】✅ Vue应用已成功挂载")}()})()})();